{"version":3,"file":"pivot.min.js","sources":["../node_modules/webix-jet/dist/es6/jet.js","../node_modules/@xbs/jet-helpers/rLayout.js","../node_modules/@xbs/jet-helpers/jetWin.js","../node_modules/jet-restate/index.js","../sources/helpers/portlet.js","../sources/views/config/properties/index.js","../sources/helpers/complex.js","../sources/views/config/properties/values.js","../sources/views/config/properties/group.js","../sources/views/config/properties/chart.js","../sources/views/config/properties/table.js","../sources/views/filter.js","../sources/views/mode.js","../sources/views/toolbar.js","../sources/export_views.js","../sources/views/chart.js","../sources/views/config/index.js","../sources/views/config/popup.js","../sources/views/main.js","../sources/views/table.js","../node_modules/@xbs/rengine/dist/rengine.es6.js","../sources/models/LocalData.js","../sources/models/Backend.js","../sources/app.js","../sources/locales/en.js"],"sourcesContent":["class NavigationBlocked {\r\n}\n\nclass JetBase {\r\n    constructor(webix, config) {\r\n        this.webixJet = true;\r\n        this.webix = webix;\r\n        this._events = [];\r\n        this._subs = {};\r\n        this._data = {};\r\n        if (config && config.params)\r\n            webix.extend(this._data, config.params);\r\n    }\r\n    getRoot() {\r\n        return this._root;\r\n    }\r\n    destructor() {\r\n        this._detachEvents();\r\n        this._destroySubs();\r\n        this._events = this._container = this.app = this._parent = this._root = null;\r\n    }\r\n    setParam(id, value, url) {\r\n        if (this._data[id] !== value) {\r\n            this._data[id] = value;\r\n            this._segment.update(id, value, 0);\r\n            if (url) {\r\n                return this.show(null);\r\n            }\r\n        }\r\n    }\r\n    getParam(id, parent) {\r\n        const value = this._data[id];\r\n        if (typeof value !== \"undefined\" || !parent) {\r\n            return value;\r\n        }\r\n        const view = this.getParentView();\r\n        if (view) {\r\n            return view.getParam(id, parent);\r\n        }\r\n    }\r\n    getUrl() {\r\n        return this._segment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._segment.toString();\r\n    }\r\n    getParentView() {\r\n        return this._parent;\r\n    }\r\n    $$(id) {\r\n        if (typeof id === \"string\") {\r\n            const root = this.getRoot();\r\n            return root.queryView((obj => (obj.config.id === id || obj.config.localId === id) &&\r\n                (obj.$scope === root.$scope)), \"self\");\r\n        }\r\n        else {\r\n            return id;\r\n        }\r\n    }\r\n    on(obj, name, code) {\r\n        const id = obj.attachEvent(name, code);\r\n        this._events.push({ obj, id });\r\n        return id;\r\n    }\r\n    contains(view) {\r\n        for (const key in this._subs) {\r\n            const kid = this._subs[key].view;\r\n            if (kid === view || kid.contains(view)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    getSubView(name) {\r\n        const sub = this.getSubViewInfo(name);\r\n        if (sub) {\r\n            return sub.subview.view;\r\n        }\r\n    }\r\n    getSubViewInfo(name) {\r\n        const sub = this._subs[name || \"default\"];\r\n        if (sub) {\r\n            return { subview: sub, parent: this };\r\n        }\r\n        if (name === \"_top\") {\r\n            this._subs[name] = { url: \"\", id: null, popup: true };\r\n            return this.getSubViewInfo(name);\r\n        }\r\n        // when called from a child view, searches for nearest parent with subview\r\n        if (this._parent) {\r\n            return this._parent.getSubViewInfo(name);\r\n        }\r\n        return null;\r\n    }\r\n    _detachEvents() {\r\n        const events = this._events;\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            events[i].obj.detachEvent(events[i].id);\r\n        }\r\n    }\r\n    _destroySubs() {\r\n        // destroy sub views\r\n        for (const key in this._subs) {\r\n            const subView = this._subs[key].view;\r\n            // it possible that subview was not loaded with any content yet\r\n            // so check on null\r\n            if (subView) {\r\n                subView.destructor();\r\n            }\r\n        }\r\n        // reset to prevent memory leaks\r\n        this._subs = {};\r\n    }\r\n    _init_url_data() {\r\n        const url = this._segment.current();\r\n        this._data = {};\r\n        this.webix.extend(this._data, url.params, true);\r\n    }\r\n    _getDefaultSub() {\r\n        if (this._subs.default) {\r\n            return this._subs.default;\r\n        }\r\n        for (const key in this._subs) {\r\n            const sub = this._subs[key];\r\n            if (!sub.branch && sub.view && key !== \"_top\") {\r\n                const child = sub.view._getDefaultSub();\r\n                if (child) {\r\n                    return child;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _routed_view() {\r\n        const parent = this.getParentView();\r\n        if (!parent) {\r\n            return true;\r\n        }\r\n        const sub = parent._getDefaultSub();\r\n        if (!sub && sub !== this) {\r\n            return false;\r\n        }\r\n        return parent._routed_view();\r\n    }\r\n}\n\nfunction parse(url) {\r\n    // remove starting /\r\n    if (url[0] === \"/\") {\r\n        url = url.substr(1);\r\n    }\r\n    // split url by \"/\"\r\n    const parts = url.split(\"/\");\r\n    const chunks = [];\r\n    // for each page in url\r\n    for (let i = 0; i < parts.length; i++) {\r\n        const test = parts[i];\r\n        const result = {};\r\n        // detect params\r\n        // support old \t\t\tsome:a=b:c=d\r\n        // and new notation\t\tsome?a=b&c=d\r\n        let pos = test.indexOf(\":\");\r\n        if (pos === -1) {\r\n            pos = test.indexOf(\"?\");\r\n        }\r\n        if (pos !== -1) {\r\n            const params = test.substr(pos + 1).split(/[\\:\\?\\&]/g);\r\n            // create hash of named params\r\n            for (const param of params) {\r\n                const dchunk = param.split(\"=\");\r\n                result[dchunk[0]] = decodeURIComponent(dchunk[1]);\r\n            }\r\n        }\r\n        // store parsed values\r\n        chunks[i] = {\r\n            page: (pos > -1 ? test.substr(0, pos) : test),\r\n            params: result,\r\n            isNew: true\r\n        };\r\n    }\r\n    // return array of page objects\r\n    return chunks;\r\n}\r\nfunction url2str(stack) {\r\n    const url = [];\r\n    for (const chunk of stack) {\r\n        url.push(\"/\" + chunk.page);\r\n        const params = obj2str(chunk.params);\r\n        if (params) {\r\n            url.push(\"?\" + params);\r\n        }\r\n    }\r\n    return url.join(\"\");\r\n}\r\nfunction obj2str(obj) {\r\n    const str = [];\r\n    for (const key in obj) {\r\n        if (typeof obj[key] === \"object\")\r\n            continue;\r\n        if (str.length) {\r\n            str.push(\"&\");\r\n        }\r\n        str.push(key + \"=\" + encodeURIComponent(obj[key]));\r\n    }\r\n    return str.join(\"\");\r\n}\n\nclass Route {\r\n    constructor(route, index) {\r\n        this._next = 1;\r\n        if (typeof route === \"string\") {\r\n            this.route = {\r\n                url: parse(route),\r\n                path: route\r\n            };\r\n        }\r\n        else {\r\n            this.route = route;\r\n        }\r\n        this.index = index;\r\n    }\r\n    current() {\r\n        return this.route.url[this.index];\r\n    }\r\n    next() {\r\n        return this.route.url[this.index + this._next];\r\n    }\r\n    suburl() {\r\n        return this.route.url.slice(this.index);\r\n    }\r\n    shift(params) {\r\n        const route = new Route(this.route, this.index + this._next);\r\n        route.setParams(route.route.url, params, route.index);\r\n        return route;\r\n    }\r\n    setParams(url, params, index) {\r\n        if (params) {\r\n            const old = url[index].params;\r\n            for (var key in params)\r\n                old[key] = params[key];\r\n        }\r\n    }\r\n    refresh() {\r\n        const url = this.route.url;\r\n        for (let i = this.index + 1; i < url.length; i++) {\r\n            url[i].isNew = true;\r\n        }\r\n    }\r\n    toString() {\r\n        const str = url2str(this.suburl());\r\n        return str ? str.substr(1) : \"\";\r\n    }\r\n    _join(path, kids) {\r\n        let url = this.route.url;\r\n        if (path === null) { // change of parameters, route elements are not affected\r\n            return url;\r\n        }\r\n        const old = this.route.url;\r\n        let reset = true;\r\n        url = old.slice(0, this.index + (kids ? this._next : 0));\r\n        if (path) {\r\n            url = url.concat(parse(path));\r\n            for (let i = 0; i < url.length; i++) {\r\n                if (old[i]) {\r\n                    url[i].view = old[i].view;\r\n                }\r\n                if (reset && old[i] && url[i].page === old[i].page) {\r\n                    url[i].isNew = false;\r\n                }\r\n                else if (url[i].isNew) {\r\n                    // if some segment was marked as new, all subsegments must be updated as well\r\n                    reset = false;\r\n                }\r\n            }\r\n        }\r\n        return url;\r\n    }\r\n    append(path) {\r\n        const url = this._join(path, true);\r\n        this.route.path = url2str(url);\r\n        this.route.url = url;\r\n        return this.route.path;\r\n    }\r\n    show(path, view, kids) {\r\n        const url = this._join(path.url, kids);\r\n        this.setParams(url, path.params, this.index + (kids ? this._next : 0));\r\n        return new Promise((res, rej) => {\r\n            const redirect = url2str(url);\r\n            const obj = {\r\n                url,\r\n                redirect,\r\n                confirm: Promise.resolve()\r\n            };\r\n            const app = view ? view.app : null;\r\n            // when creating a new route, it possible that it will not have any content\r\n            // guard is not necessary in such case\r\n            if (app) {\r\n                const result = app.callEvent(\"app:guard\", [obj.redirect, view, obj]);\r\n                if (!result) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n            }\r\n            obj.confirm.catch(err => rej(err)).then(() => {\r\n                if (obj.redirect === null) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                if (obj.redirect !== redirect) {\r\n                    app.show(obj.redirect);\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                this.route.path = redirect;\r\n                this.route.url = url;\r\n                res();\r\n            });\r\n        });\r\n    }\r\n    size(n) {\r\n        this._next = n;\r\n    }\r\n    split() {\r\n        const route = {\r\n            url: this.route.url.slice(this.index + 1),\r\n            path: \"\"\r\n        };\r\n        if (route.url.length) {\r\n            route.path = url2str(route.url);\r\n        }\r\n        return new Route(route, 0);\r\n    }\r\n    update(name, value, index) {\r\n        const chunk = this.route.url[this.index + (index || 0)];\r\n        if (!chunk) {\r\n            this.route.url.push({ page: \"\", params: {} });\r\n            return this.update(name, value, index);\r\n        }\r\n        if (name === \"\") {\r\n            chunk.page = value;\r\n        }\r\n        else {\r\n            chunk.params[name] = value;\r\n        }\r\n        this.route.path = url2str(this.route.url);\r\n    }\r\n}\n\nclass JetView extends JetBase {\r\n    constructor(app, config) {\r\n        super(app.webix);\r\n        this.app = app;\r\n        //this.$config = config;\r\n        this._children = [];\r\n    }\r\n    ui(ui, config) {\r\n        config = config || {};\r\n        const container = config.container || ui.container;\r\n        const jetview = this.app.createView(ui);\r\n        this._children.push(jetview);\r\n        jetview.render(container, this._segment, this);\r\n        if (typeof ui !== \"object\" || (ui instanceof JetBase)) {\r\n            // raw webix UI\r\n            return jetview;\r\n        }\r\n        else {\r\n            return jetview.getRoot();\r\n        }\r\n    }\r\n    show(path, config) {\r\n        config = config || {};\r\n        // convert parameters object to url\r\n        if (typeof path === \"object\") {\r\n            for (const key in path) {\r\n                this.setParam(key, path[key]);\r\n            }\r\n            path = null;\r\n        }\r\n        else {\r\n            // deligate to app in case of root prefix\r\n            if (path.substr(0, 1) === \"/\") {\r\n                return this.app.show(path, config);\r\n            }\r\n            // local path, do nothing\r\n            if (path.indexOf(\"./\") === 0) {\r\n                path = path.substr(2);\r\n            }\r\n            // parent path, call parent view\r\n            if (path.indexOf(\"../\") === 0) {\r\n                const parent = this.getParentView();\r\n                if (parent) {\r\n                    return parent.show(path.substr(3), config);\r\n                }\r\n                else {\r\n                    return this.app.show(\"/\" + path.substr(3));\r\n                }\r\n            }\r\n            const sub = this.getSubViewInfo(config.target);\r\n            if (sub) {\r\n                if (sub.parent !== this) {\r\n                    return sub.parent.show(path, config);\r\n                }\r\n                else if (config.target && config.target !== \"default\") {\r\n                    return this._renderFrameLock(config.target, sub.subview, {\r\n                        url: path,\r\n                        params: config.params,\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                if (path) {\r\n                    return this.app.show(\"/\" + path, config);\r\n                }\r\n            }\r\n        }\r\n        return this._show(this._segment, { url: path, params: config.params }, this);\r\n    }\r\n    _show(segment, path, view) {\r\n        return segment.show(path, view, true).then(() => {\r\n            this._init_url_data();\r\n            return this._urlChange();\r\n        }).then(() => {\r\n            if (segment.route.linkRouter) {\r\n                this.app.getRouter().set(segment.route.path, { silent: true });\r\n                this.app.callEvent(\"app:route\", [segment.route.path]);\r\n            }\r\n        });\r\n    }\r\n    init(_$view, _$) {\r\n        // stub\r\n    }\r\n    ready(_$view, _$url) {\r\n        // stub\r\n    }\r\n    config() {\r\n        this.app.webix.message(\"View:Config is not implemented\");\r\n    }\r\n    urlChange(_$view, _$url) {\r\n        // stub\r\n    }\r\n    destroy() {\r\n        // stub\r\n    }\r\n    destructor() {\r\n        this.destroy();\r\n        this._destroyKids();\r\n        // destroy actual UI\r\n        if (this._root) {\r\n            this._root.destructor();\r\n            super.destructor();\r\n        }\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this.app, this, config);\r\n    }\r\n    refresh() {\r\n        const url = this.getUrl();\r\n        this.destroy();\r\n        this._destroyKids();\r\n        this._destroySubs();\r\n        this._detachEvents();\r\n        if (this._container.tagName) {\r\n            this._root.destructor();\r\n        }\r\n        this._segment.refresh();\r\n        return this._render(this._segment);\r\n    }\r\n    render(root, url, parent) {\r\n        if (typeof url === \"string\") {\r\n            url = new Route(url, 0);\r\n        }\r\n        this._segment = url;\r\n        this._parent = parent;\r\n        this._init_url_data();\r\n        root = root || document.body;\r\n        const _container = (typeof root === \"string\") ? this.webix.toNode(root) : root;\r\n        if (this._container !== _container) {\r\n            this._container = _container;\r\n            return this._render(url);\r\n        }\r\n        else {\r\n            return this._urlChange().then(() => this.getRoot());\r\n        }\r\n    }\r\n    _render(url) {\r\n        const config = this.config();\r\n        if (config.then) {\r\n            return config.then(cfg => this._render_final(cfg, url));\r\n        }\r\n        else {\r\n            return this._render_final(config, url);\r\n        }\r\n    }\r\n    _render_final(config, url) {\r\n        // get previous view in the same slot\r\n        let slot = null;\r\n        let container = null;\r\n        let show = false;\r\n        if (!this._container.tagName) {\r\n            slot = this._container;\r\n            if (slot.popup) {\r\n                container = document.body;\r\n                show = true;\r\n            }\r\n            else {\r\n                container = this.webix.$$(slot.id);\r\n            }\r\n        }\r\n        else {\r\n            container = this._container;\r\n        }\r\n        // view already destroyed\r\n        if (!this.app || !container) {\r\n            return Promise.reject(null);\r\n        }\r\n        let response;\r\n        const current = this._segment.current();\r\n        // using wrapper object, so ui can be changed from app:render event\r\n        const result = { ui: {} };\r\n        this.app.copyConfig(config, result.ui, this._subs);\r\n        this.app.callEvent(\"app:render\", [this, url, result]);\r\n        result.ui.$scope = this;\r\n        /* destroy old HTML attached views before creating new one */\r\n        if (!slot && current.isNew && current.view) {\r\n            current.view.destructor();\r\n        }\r\n        try {\r\n            // special handling for adding inside of multiview - preserve old id\r\n            if (slot && !show) {\r\n                const oldui = container;\r\n                const parent = oldui.getParentView();\r\n                if (parent && parent.name === \"multiview\" && !result.ui.id) {\r\n                    result.ui.id = oldui.config.id;\r\n                }\r\n            }\r\n            this._root = this.app.webix.ui(result.ui, container);\r\n            const asWin = this._root;\r\n            // check for url added to ignore this.ui calls\r\n            if (show && asWin.setPosition && !asWin.isVisible()) {\r\n                asWin.show();\r\n            }\r\n            // check, if we are replacing some older view\r\n            if (slot) {\r\n                if (slot.view && slot.view !== this && slot.view !== this.app) {\r\n                    slot.view.destructor();\r\n                }\r\n                slot.id = this._root.config.id;\r\n                if (this.getParentView() || !this.app.app)\r\n                    slot.view = this;\r\n                else {\r\n                    // when we have subapp, set whole app as a view\r\n                    // so on destruction, the whole app will be destroyed\r\n                    slot.view = this.app;\r\n                }\r\n            }\r\n            if (current.isNew) {\r\n                current.view = this;\r\n                current.isNew = false;\r\n            }\r\n            response = Promise.resolve(this._init(this._root, url)).then(() => {\r\n                return this._urlChange().then(() => {\r\n                    this._initUrl = null;\r\n                    return this.ready(this._root, url.suburl());\r\n                });\r\n            });\r\n        }\r\n        catch (e) {\r\n            response = Promise.reject(e);\r\n        }\r\n        return response.catch(err => this._initError(this, err));\r\n    }\r\n    _init(view, url) {\r\n        return this.init(view, url.suburl());\r\n    }\r\n    _urlChange() {\r\n        this.app.callEvent(\"app:urlchange\", [this, this._segment]);\r\n        const waits = [];\r\n        for (const key in this._subs) {\r\n            const frame = this._subs[key];\r\n            const wait = this._renderFrameLock(key, frame, null);\r\n            if (wait) {\r\n                waits.push(wait);\r\n            }\r\n        }\r\n        return Promise.all(waits).then(() => {\r\n            return this.urlChange(this._root, this._segment.suburl());\r\n        });\r\n    }\r\n    _renderFrameLock(key, frame, path) {\r\n        // if subview is not occupied by some rendering yet\r\n        if (!frame.lock) {\r\n            // retreive and store rendering end promise\r\n            const lock = this._renderFrame(key, frame, path);\r\n            if (lock) {\r\n                // clear lock after frame rendering\r\n                // as promise.finally is not supported by  Webix lesser than 6.2\r\n                // using a more verbose notation\r\n                frame.lock = lock.then(() => frame.lock = null, () => frame.lock = null);\r\n            }\r\n        }\r\n        // return rendering end promise\r\n        return frame.lock;\r\n    }\r\n    _renderFrame(key, frame, path) {\r\n        //default route\r\n        if (key === \"default\") {\r\n            if (this._segment.next()) {\r\n                // we have a next segment in url, render it\r\n                let params = path ? path.params : null;\r\n                if (frame.params) {\r\n                    params = this.webix.extend(params || {}, frame.params);\r\n                }\r\n                return this._createSubView(frame, this._segment.shift(params));\r\n            }\r\n            else if (frame.view && frame.popup) {\r\n                // there is no next segment, delete the existing sub-view\r\n                frame.view.destructor();\r\n                frame.view = null;\r\n            }\r\n        }\r\n        //if new path provided, set it to the frame\r\n        if (path !== null) {\r\n            frame.url = path.url;\r\n            if (frame.params) {\r\n                path.params = this.webix.extend(path.params || {}, frame.params);\r\n            }\r\n        }\r\n        // in case of routed sub-view\r\n        if (frame.route) {\r\n            // we have a new path for sub-view\r\n            if (path !== null) {\r\n                return frame.route.show(path, frame.view).then(() => {\r\n                    return this._createSubView(frame, frame.route);\r\n                });\r\n            }\r\n            // do not trigger onChange for isolated sub-views\r\n            if (frame.branch) {\r\n                return;\r\n            }\r\n        }\r\n        let view = frame.view;\r\n        // if view doesn't exists yet, init it\r\n        if (!view && frame.url) {\r\n            if (typeof frame.url === \"string\") {\r\n                // string, so we have isolated subview url\r\n                frame.route = new Route(frame.url, 0);\r\n                if (path)\r\n                    frame.route.setParams(frame.route.route.url, path.params, 0);\r\n                if (frame.params)\r\n                    frame.route.setParams(frame.route.route.url, frame.params, 0);\r\n                return this._createSubView(frame, frame.route);\r\n            }\r\n            else {\r\n                // object, so we have an embeded subview\r\n                if (typeof frame.url === \"function\" && !(view instanceof frame.url)) {\r\n                    view = new (this.app._override(frame.url))(this.app, \"\");\r\n                }\r\n                if (!view) {\r\n                    view = frame.url;\r\n                }\r\n            }\r\n        }\r\n        // trigger onChange for already existed view\r\n        if (view) {\r\n            return view.render(frame, (frame.route || this._segment), this);\r\n        }\r\n    }\r\n    _initError(view, err) {\r\n        /*\r\n            if view is destroyed, ignore any view related errors\r\n        */\r\n        if (this.app) {\r\n            this.app.error(\"app:error:initview\", [err, view]);\r\n        }\r\n        return true;\r\n    }\r\n    _createSubView(sub, suburl) {\r\n        return this.app.createFromURL(suburl.current()).then(view => {\r\n            return view.render(sub, suburl, this);\r\n        });\r\n    }\r\n    _destroyKids() {\r\n        // destroy child views\r\n        const uis = this._children;\r\n        for (let i = uis.length - 1; i >= 0; i--) {\r\n            if (uis[i] && uis[i].destructor) {\r\n                uis[i].destructor();\r\n            }\r\n        }\r\n        // reset vars for better GC processing\r\n        this._children = [];\r\n    }\r\n}\n\n// wrapper for raw objects and Jet 1.x structs\r\nclass JetViewRaw extends JetView {\r\n    constructor(app, config) {\r\n        super(app, config);\r\n        this._ui = config.ui;\r\n    }\r\n    config() {\r\n        return this._ui;\r\n    }\r\n}\n\nclass SubRouter {\r\n    constructor(cb, config, app) {\r\n        this.path = \"\";\r\n        this.app = app;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        const a = this.app;\r\n        a.app.getRouter().set(a._segment.append(this.path), { silent: true });\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nlet _once = true;\r\nclass JetAppBase extends JetBase {\r\n    constructor(config) {\r\n        const webix = (config || {}).webix || window.webix;\r\n        config = webix.extend({\r\n            name: \"App\",\r\n            version: \"1.0\",\r\n            start: \"/home\"\r\n        }, config, true);\r\n        super(webix, config);\r\n        this.config = config;\r\n        this.app = this.config.app;\r\n        this.ready = Promise.resolve();\r\n        this._services = {};\r\n        this.webix.extend(this, this.webix.EventSystem);\r\n    }\r\n    getUrl() {\r\n        return this._subSegment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._subSegment.toString();\r\n    }\r\n    getService(name) {\r\n        let obj = this._services[name];\r\n        if (typeof obj === \"function\") {\r\n            obj = this._services[name] = obj(this);\r\n        }\r\n        return obj;\r\n    }\r\n    setService(name, handler) {\r\n        this._services[name] = handler;\r\n    }\r\n    destructor() {\r\n        this.getSubView().destructor();\r\n        super.destructor();\r\n    }\r\n    // copy object and collect extra handlers\r\n    copyConfig(obj, target, config) {\r\n        // raw ui config\r\n        if (obj instanceof JetBase ||\r\n            (typeof obj === \"function\" && obj.prototype instanceof JetBase)) {\r\n            obj = { $subview: obj };\r\n        }\r\n        // subview placeholder\r\n        if (typeof obj.$subview != \"undefined\") {\r\n            return this.addSubView(obj, target, config);\r\n        }\r\n        // process sub-properties\r\n        const isArray = obj instanceof Array;\r\n        target = target || (isArray ? [] : {});\r\n        for (const method in obj) {\r\n            let point = obj[method];\r\n            // view class\r\n            if (typeof point === \"function\" && point.prototype instanceof JetBase) {\r\n                point = { $subview: point };\r\n            }\r\n            if (point && typeof point === \"object\" &&\r\n                !(point instanceof this.webix.DataCollection) && !(point instanceof RegExp) && !(point instanceof Map)) {\r\n                if (point instanceof Date) {\r\n                    target[method] = new Date(point);\r\n                }\r\n                else {\r\n                    const copy = this.copyConfig(point, (point instanceof Array ? [] : {}), config);\r\n                    if (copy !== null) {\r\n                        if (isArray)\r\n                            target.push(copy);\r\n                        else\r\n                            target[method] = copy;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                target[method] = point;\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n    getRouter() {\r\n        return this.$router;\r\n    }\r\n    clickHandler(e, target) {\r\n        if (e) {\r\n            target = target || (e.target || e.srcElement);\r\n            if (target && target.getAttribute) {\r\n                const trigger = target.getAttribute(\"trigger\");\r\n                if (trigger) {\r\n                    this._forView(target, view => view.app.trigger(trigger));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n                const route = target.getAttribute(\"route\");\r\n                if (route) {\r\n                    this._forView(target, view => view.show(route));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n            }\r\n        }\r\n        const parent = target.parentNode;\r\n        if (parent) {\r\n            this.clickHandler(e, parent);\r\n        }\r\n    }\r\n    getRoot() {\r\n        return this.getSubView().getRoot();\r\n    }\r\n    refresh() {\r\n        if (!this._subSegment) {\r\n            return Promise.resolve(null);\r\n        }\r\n        return this.getSubView().refresh().then(view => {\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return view;\r\n        });\r\n    }\r\n    loadView(url) {\r\n        const views = this.config.views;\r\n        let result = null;\r\n        if (url === \"\") {\r\n            return Promise.resolve(this._loadError(\"\", new Error(\"Webix Jet: Empty url segment\")));\r\n        }\r\n        try {\r\n            if (views) {\r\n                if (typeof views === \"function\") {\r\n                    // custom loading strategy\r\n                    result = views(url);\r\n                }\r\n                else {\r\n                    // predefined hash\r\n                    result = views[url];\r\n                }\r\n                if (typeof result === \"string\") {\r\n                    url = result;\r\n                    result = null;\r\n                }\r\n            }\r\n            if (!result) {\r\n                if (url === \"_hidden\") {\r\n                    result = { hidden: true };\r\n                }\r\n                else if (url === \"_blank\") {\r\n                    result = {};\r\n                }\r\n                else {\r\n                    url = url.replace(/\\./g, \"/\");\r\n                    result = this.require(\"jet-views\", url);\r\n                }\r\n            }\r\n        }\r\n        catch (e) {\r\n            result = this._loadError(url, e);\r\n        }\r\n        // custom handler can return view or its promise\r\n        if (!result.then) {\r\n            result = Promise.resolve(result);\r\n        }\r\n        // set error handler\r\n        result = result\r\n            .then(module => module.__esModule ? module.default : module)\r\n            .catch(err => this._loadError(url, err));\r\n        return result;\r\n    }\r\n    _forView(target, handler) {\r\n        const view = this.webix.$$(target);\r\n        if (view) {\r\n            handler(view.$scope);\r\n        }\r\n    }\r\n    _loadViewDynamic(url) {\r\n        return null;\r\n    }\r\n    createFromURL(chunk) {\r\n        let view;\r\n        if (chunk.isNew || !chunk.view) {\r\n            view = this.loadView(chunk.page)\r\n                .then(ui => this.createView(ui, name, chunk.params));\r\n        }\r\n        else {\r\n            view = Promise.resolve(chunk.view);\r\n        }\r\n        return view;\r\n    }\r\n    _override(ui) {\r\n        const over = this.config.override;\r\n        if (over) {\r\n            let dv;\r\n            while (ui) {\r\n                dv = ui;\r\n                ui = over.get(ui);\r\n            }\r\n            return dv;\r\n        }\r\n        return ui;\r\n    }\r\n    createView(ui, name, params) {\r\n        ui = this._override(ui);\r\n        let obj;\r\n        if (typeof ui === \"function\") {\r\n            if (ui.prototype instanceof JetAppBase) {\r\n                // UI class\r\n                return new ui({ app: this, name, params, router: SubRouter });\r\n            }\r\n            else if (ui.prototype instanceof JetBase) {\r\n                // UI class\r\n                return new ui(this, { name, params });\r\n            }\r\n            else {\r\n                // UI factory functions\r\n                ui = ui(this);\r\n            }\r\n        }\r\n        if (ui instanceof JetBase) {\r\n            obj = ui;\r\n        }\r\n        else {\r\n            // UI object\r\n            obj = new JetViewRaw(this, { name, ui });\r\n        }\r\n        return obj;\r\n    }\r\n    // show view path\r\n    show(url, config) {\r\n        if (url && this.app && url.indexOf(\"//\") == 0)\r\n            return this.app.show(url.substr(1), config);\r\n        return this.render(this._container, url || this.config.start, config);\r\n    }\r\n    // event helpers\r\n    trigger(name, ...rest) {\r\n        this.apply(name, rest);\r\n    }\r\n    apply(name, data) {\r\n        this.callEvent(name, data);\r\n    }\r\n    action(name) {\r\n        return this.webix.bind(function (...rest) {\r\n            this.apply(name, rest);\r\n        }, this);\r\n    }\r\n    on(name, handler) {\r\n        this.attachEvent(name, handler);\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this, null, config);\r\n    }\r\n    error(name, er) {\r\n        this.callEvent(name, er);\r\n        this.callEvent(\"app:error\", er);\r\n        /* tslint:disable */\r\n        if (this.config.debug) {\r\n            for (var i = 0; i < er.length; i++) {\r\n                console.error(er[i]);\r\n                if (er[i] instanceof Error) {\r\n                    let text = er[i].message;\r\n                    if (text.indexOf(\"Module build failed\") === 0) {\r\n                        text = text.replace(/\\x1b\\[[0-9;]*m/g, \"\");\r\n                        document.body.innerHTML = `<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>${text}</pre>`;\r\n                    }\r\n                    else {\r\n                        text += \"<br><br>Check console for more details\";\r\n                        this.webix.message({ type: \"error\", text: text, expire: -1 });\r\n                    }\r\n                }\r\n            }\r\n            debugger;\r\n        }\r\n        /* tslint:enable */\r\n    }\r\n    // renders top view\r\n    render(root, url, config) {\r\n        this._container = (typeof root === \"string\") ?\r\n            this.webix.toNode(root) :\r\n            (root || document.body);\r\n        const firstInit = !this.$router;\r\n        let path = null;\r\n        if (firstInit) {\r\n            if (_once && \"tagName\" in this._container) {\r\n                this.webix.event(document.body, \"click\", e => this.clickHandler(e));\r\n                _once = false;\r\n            }\r\n            if (typeof url === \"string\") {\r\n                url = new Route(url, 0);\r\n            }\r\n            this._subSegment = this._first_start(url);\r\n            this._subSegment.route.linkRouter = true;\r\n        }\r\n        else {\r\n            if (typeof url === \"string\") {\r\n                path = url;\r\n            }\r\n            else {\r\n                if (this.app) {\r\n                    path = url.split().route.path || this.config.start;\r\n                }\r\n                else {\r\n                    path = url.toString();\r\n                }\r\n            }\r\n        }\r\n        const params = config ? config.params : this.config.params || null;\r\n        const top = this.getSubView();\r\n        const segment = this._subSegment;\r\n        const ready = segment\r\n            .show({ url: path, params }, top)\r\n            .then(() => this.createFromURL(segment.current()))\r\n            .then(view => view.render(root, segment))\r\n            .then(base => {\r\n            this.$router.set(segment.route.path, { silent: true });\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return base;\r\n        });\r\n        this.ready = this.ready.then(() => ready);\r\n        return ready;\r\n    }\r\n    getSubView() {\r\n        if (this._subSegment) {\r\n            const view = this._subSegment.current().view;\r\n            if (view)\r\n                return view;\r\n        }\r\n        return new JetView(this, {});\r\n    }\r\n    require(type, url) { return null; }\r\n    _first_start(route) {\r\n        this._segment = route;\r\n        const cb = (a) => setTimeout(() => {\r\n            this.show(a).catch(e => {\r\n                if (!(e instanceof NavigationBlocked))\r\n                    throw e;\r\n            });\r\n        }, 1);\r\n        this.$router = new (this.config.router)(cb, this.config, this);\r\n        // start animation for top-level app\r\n        if (this._container === document.body && this.config.animation !== false) {\r\n            const node = this._container;\r\n            this.webix.html.addCss(node, \"webixappstart\");\r\n            setTimeout(() => {\r\n                this.webix.html.removeCss(node, \"webixappstart\");\r\n                this.webix.html.addCss(node, \"webixapp\");\r\n            }, 10);\r\n        }\r\n        if (!route) {\r\n            // if no url defined, check router first\r\n            let urlString = this.$router.get();\r\n            if (!urlString) {\r\n                urlString = this.config.start;\r\n                this.$router.set(urlString, { silent: true });\r\n            }\r\n            route = new Route(urlString, 0);\r\n        }\r\n        else if (this.app) {\r\n            const now = route.current().view;\r\n            route.current().view = this;\r\n            if (route.next()) {\r\n                route.refresh();\r\n                route = route.split();\r\n            }\r\n            else {\r\n                route = new Route(this.config.start, 0);\r\n            }\r\n            route.current().view = now;\r\n        }\r\n        return route;\r\n    }\r\n    // error during view resolving\r\n    _loadError(url, err) {\r\n        this.error(\"app:error:resolve\", [err, url]);\r\n        return { template: \" \" };\r\n    }\r\n    addSubView(obj, target, config) {\r\n        const url = obj.$subview !== true ? obj.$subview : null;\r\n        const name = obj.name || (url ? this.webix.uid() : \"default\");\r\n        target.id = obj.id || \"s\" + this.webix.uid();\r\n        const view = config[name] = {\r\n            id: target.id,\r\n            url,\r\n            branch: obj.branch,\r\n            popup: obj.popup,\r\n            params: obj.params\r\n        };\r\n        return view.popup ? null : target;\r\n    }\r\n}\n\nclass HashRouter {\r\n    constructor(cb, config) {\r\n        this.config = config || {};\r\n        this._detectPrefix();\r\n        this.cb = cb;\r\n        window.onpopstate = () => this.cb(this.get());\r\n    }\r\n    set(path, config) {\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            for (const key in this.config.routes) {\r\n                if (this.config.routes[key] === compare[0]) {\r\n                    path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (this.get() !== path) {\r\n            window.history.pushState(null, null, this.prefix + this.sufix + path);\r\n        }\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        let path = this._getRaw().replace(this.prefix, \"\").replace(this.sufix, \"\");\r\n        path = (path !== \"/\" && path !== \"#\") ? path : \"\";\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            const key = this.config.routes[compare[0]];\r\n            if (key) {\r\n                path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n            }\r\n        }\r\n        return path;\r\n    }\r\n    _detectPrefix() {\r\n        // use \"#!\" for backward compatibility\r\n        const sufix = this.config.routerPrefix;\r\n        this.sufix = \"#\" + ((typeof sufix === \"undefined\") ? \"!\" : sufix);\r\n        this.prefix = document.location.href.split(\"#\", 2)[0];\r\n    }\r\n    _getRaw() {\r\n        return document.location.href;\r\n    }\r\n}\n\nlet isPatched = false;\r\nfunction patch(w) {\r\n    if (isPatched || !w) {\r\n        return;\r\n    }\r\n    isPatched = true;\r\n    // custom promise for IE8\r\n    const win = window;\r\n    if (!win.Promise) {\r\n        win.Promise = w.promise;\r\n    }\r\n    const version = w.version.split(\".\");\r\n    // will be fixed in webix 5.3\r\n    if (version[0] * 10 + version[1] * 1 < 53) {\r\n        w.ui.freeze = function (handler) {\r\n            // disabled because webix jet 5.0 can't handle resize of scrollview correctly\r\n            // w.ui.$freeze = true;\r\n            const res = handler();\r\n            if (res && res.then) {\r\n                res.then(function (some) {\r\n                    w.ui.$freeze = false;\r\n                    w.ui.resize();\r\n                    return some;\r\n                });\r\n            }\r\n            else {\r\n                w.ui.$freeze = false;\r\n                w.ui.resize();\r\n            }\r\n            return res;\r\n        };\r\n    }\r\n    // adding views as classes\r\n    const baseAdd = w.ui.baselayout.prototype.addView;\r\n    const baseRemove = w.ui.baselayout.prototype.removeView;\r\n    const config = {\r\n        addView(view, index) {\r\n            // trigger logic only for widgets inside of jet-view\r\n            // ignore case when addView used with already initialized widget\r\n            if (this.$scope && this.$scope.webixJet && !view.queryView) {\r\n                const jview = this.$scope;\r\n                const subs = {};\r\n                view = jview.app.copyConfig(view, {}, subs);\r\n                baseAdd.apply(this, [view, index]);\r\n                for (const key in subs) {\r\n                    jview._renderFrame(key, subs[key], null).then(() => {\r\n                        jview._subs[key] = subs[key];\r\n                    });\r\n                }\r\n                return view.id;\r\n            }\r\n            else {\r\n                return baseAdd.apply(this, arguments);\r\n            }\r\n        },\r\n        removeView() {\r\n            baseRemove.apply(this, arguments);\r\n            if (this.$scope && this.$scope.webixJet) {\r\n                const subs = this.$scope._subs;\r\n                // check all sub-views, destroy and clean the removed one\r\n                for (const key in subs) {\r\n                    const test = subs[key];\r\n                    if (!w.$$(test.id)) {\r\n                        test.view.destructor();\r\n                        delete subs[key];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    w.extend(w.ui.layout.prototype, config, true);\r\n    w.extend(w.ui.baselayout.prototype, config, true);\r\n    // wrapper for using Jet Apps as views\r\n    w.protoUI({\r\n        name: \"jetapp\",\r\n        $init(cfg) {\r\n            this.$app = new this.app(cfg);\r\n            const id = w.uid().toString();\r\n            cfg.body = { id };\r\n            this.$ready.push(function () {\r\n                this.callEvent(\"onInit\", [this.$app]);\r\n                this.$app.render({ id });\r\n            });\r\n        }\r\n    }, w.ui.proxy, w.EventSystem);\r\n}\n\nclass JetApp extends JetAppBase {\r\n    constructor(config) {\r\n        config.router = config.router || HashRouter;\r\n        super(config);\r\n        patch(this.webix);\r\n    }\r\n    require(type, url) {\r\n        return require(type + \"/\" + url);\r\n    }\r\n}\n\nclass StoreRouter {\r\n    constructor(cb, config, app) {\r\n        this.storage = config.storage || app.webix.storage.session;\r\n        this.name = (config.storeName || config.id + \":route\");\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.storage.put(this.name, path);\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.storage.get(this.name);\r\n    }\r\n}\n\nclass UrlRouter extends HashRouter {\r\n    _detectPrefix() {\r\n        this.prefix = \"\";\r\n        this.sufix = this.config.routerPrefix || \"\";\r\n    }\r\n    _getRaw() {\r\n        return document.location.pathname + (document.location.search || \"\");\r\n    }\r\n}\n\nclass EmptyRouter {\r\n    constructor(cb, _$config) {\r\n        this.path = \"\";\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nfunction UnloadGuard(app, view, config) {\r\n    view.on(app, `app:guard`, function (_$url, point, promise) {\r\n        if (point === view || point.contains(view)) {\r\n            const res = config();\r\n            if (res === false) {\r\n                promise.confirm = Promise.reject(new NavigationBlocked());\r\n            }\r\n            else {\r\n                promise.confirm = promise.confirm.then(() => res);\r\n            }\r\n        }\r\n    });\r\n}\n\n//     (c) 2012-2018 Airbnb, Inc.\n\n// var has = require('has');\nfunction has(store, key) {\n  return Object.prototype.hasOwnProperty.call(store, key);\n}\n// var forEach = require('for-each');\nfunction forEach(obj, handler, context) {\n  for (var key in obj) {\n    if (has(obj, key)) {\n      handler.call((context || obj), obj[key], key, obj);\n    }\n  }\n}\n// var trim = require('string.prototype.trim');\nfunction trim(str) {\n  return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n}\n// var warning = require('warning');\nfunction warn(message) {\n  message = 'Warning: ' + message;\n  if (typeof console !== 'undefined') {\n    console.error(message);\n  }\n\n  try { throw new Error(message); } catch (x) {}\n}\n\nvar replace = String.prototype.replace;\nvar split = String.prototype.split;\n\n// #### Pluralization methods\n// The string that separates the different phrase possibilities.\nvar delimiter = '||||';\n\nvar russianPluralGroups = function (n) {\n  var end = n % 10;\n  if (n !== 11 && end === 1) {\n    return 0;\n  }\n  if (2 <= end && end <= 4 && !(n >= 12 && n <= 14)) {\n    return 1;\n  }\n  return 2;\n};\n\n// Mapping from pluralization group plural logic.\nvar pluralTypes = {\n  arabic: function (n) {\n    // http://www.arabeyes.org/Plural_Forms\n    if (n < 3) { return n; }\n    var lastTwo = n % 100;\n    if (lastTwo >= 3 && lastTwo <= 10) return 3;\n    return lastTwo >= 11 ? 4 : 5;\n  },\n  bosnian_serbian: russianPluralGroups,\n  chinese: function () { return 0; },\n  croatian: russianPluralGroups,\n  french: function (n) { return n > 1 ? 1 : 0; },\n  german: function (n) { return n !== 1 ? 1 : 0; },\n  russian: russianPluralGroups,\n  lithuanian: function (n) {\n    if (n % 10 === 1 && n % 100 !== 11) { return 0; }\n    return n % 10 >= 2 && n % 10 <= 9 && (n % 100 < 11 || n % 100 > 19) ? 1 : 2;\n  },\n  czech: function (n) {\n    if (n === 1) { return 0; }\n    return (n >= 2 && n <= 4) ? 1 : 2;\n  },\n  polish: function (n) {\n    if (n === 1) { return 0; }\n    var end = n % 10;\n    return 2 <= end && end <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n  },\n  icelandic: function (n) { return (n % 10 !== 1 || n % 100 === 11) ? 1 : 0; },\n  slovenian: function (n) {\n    var lastTwo = n % 100;\n    if (lastTwo === 1) {\n      return 0;\n    }\n    if (lastTwo === 2) {\n      return 1;\n    }\n    if (lastTwo === 3 || lastTwo === 4) {\n      return 2;\n    }\n    return 3;\n  }\n};\n\n\n// Mapping from pluralization group to individual language codes/locales.\n// Will look up based on exact match, if not found and it's a locale will parse the locale\n// for language code, and if that does not exist will default to 'en'\nvar pluralTypeToLanguages = {\n  arabic: ['ar'],\n  bosnian_serbian: ['bs-Latn-BA', 'bs-Cyrl-BA', 'srl-RS', 'sr-RS'],\n  chinese: ['id', 'id-ID', 'ja', 'ko', 'ko-KR', 'lo', 'ms', 'th', 'th-TH', 'zh'],\n  croatian: ['hr', 'hr-HR'],\n  german: ['fa', 'da', 'de', 'en', 'es', 'fi', 'el', 'he', 'hi-IN', 'hu', 'hu-HU', 'it', 'nl', 'no', 'pt', 'sv', 'tr'],\n  french: ['fr', 'tl', 'pt-br'],\n  russian: ['ru', 'ru-RU'],\n  lithuanian: ['lt'],\n  czech: ['cs', 'cs-CZ', 'sk'],\n  polish: ['pl'],\n  icelandic: ['is'],\n  slovenian: ['sl-SL']\n};\n\nfunction langToTypeMap(mapping) {\n  var ret = {};\n  forEach(mapping, function (langs, type) {\n    forEach(langs, function (lang) {\n      ret[lang] = type;\n    });\n  });\n  return ret;\n}\n\nfunction pluralTypeName(locale) {\n  var langToPluralType = langToTypeMap(pluralTypeToLanguages);\n  return langToPluralType[locale]\n    || langToPluralType[split.call(locale, /-/, 1)[0]]\n    || langToPluralType.en;\n}\n\nfunction pluralTypeIndex(locale, count) {\n  return pluralTypes[pluralTypeName(locale)](count);\n}\n\nfunction escape(token) {\n  return token.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction constructTokenRegex(opts) {\n  var prefix = (opts && opts.prefix) || '%{';\n  var suffix = (opts && opts.suffix) || '}';\n\n  if (prefix === delimiter || suffix === delimiter) {\n    throw new RangeError('\"' + delimiter + '\" token is reserved for pluralization');\n  }\n\n  return new RegExp(escape(prefix) + '(.*?)' + escape(suffix), 'g');\n}\n\nvar dollarRegex = /\\$/g;\nvar dollarBillsYall = '$$';\nvar defaultTokenRegex = /%\\{(.*?)\\}/g;\n\n// ### transformPhrase(phrase, substitutions, locale)\n//\n// Takes a phrase string and transforms it by choosing the correct\n// plural form and interpolating it.\n//\n//     transformPhrase('Hello, %{name}!', {name: 'Spike'});\n//     // \"Hello, Spike!\"\n//\n// The correct plural form is selected if substitutions.smart_count\n// is set. You can pass in a number instead of an Object as `substitutions`\n// as a shortcut for `smart_count`.\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 1}, 'en');\n//     // \"1 new message\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 2}, 'en');\n//     // \"2 new messages\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', 5, 'en');\n//     // \"5 new messages\"\n//\n// You should pass in a third argument, the locale, to specify the correct plural type.\n// It defaults to `'en'` with 2 plural forms.\nfunction transformPhrase(phrase, substitutions, locale, tokenRegex) {\n  if (typeof phrase !== 'string') {\n    throw new TypeError('Polyglot.transformPhrase expects argument #1 to be string');\n  }\n\n  if (substitutions == null) {\n    return phrase;\n  }\n\n  var result = phrase;\n  var interpolationRegex = tokenRegex || defaultTokenRegex;\n\n  // allow number as a pluralization shortcut\n  var options = typeof substitutions === 'number' ? { smart_count: substitutions } : substitutions;\n\n  // Select plural form: based on a phrase text that contains `n`\n  // plural forms separated by `delimiter`, a `locale`, and a `substitutions.smart_count`,\n  // choose the correct plural form. This is only done if `count` is set.\n  if (options.smart_count != null && result) {\n    var texts = split.call(result, delimiter);\n    result = trim(texts[pluralTypeIndex(locale || 'en', options.smart_count)] || texts[0]);\n  }\n\n  // Interpolate: Creates a `RegExp` object for each interpolation placeholder.\n  result = replace.call(result, interpolationRegex, function (expression, argument) {\n    if (!has(options, argument) || options[argument] == null) { return expression; }\n    // Ensure replacement value is escaped to prevent special $-prefixed regex replace tokens.\n    return replace.call(options[argument], dollarRegex, dollarBillsYall);\n  });\n\n  return result;\n}\n\n// ### Polyglot class constructor\nfunction Polyglot(options) {\n  var opts = options || {};\n  this.phrases = {};\n  this.extend(opts.phrases || {});\n  this.currentLocale = opts.locale || 'en';\n  var allowMissing = opts.allowMissing ? transformPhrase : null;\n  this.onMissingKey = typeof opts.onMissingKey === 'function' ? opts.onMissingKey : allowMissing;\n  this.warn = opts.warn || warn;\n  this.tokenRegex = constructTokenRegex(opts.interpolation);\n}\n\n// ### polyglot.locale([locale])\n//\n// Get or set locale. Internally, Polyglot only uses locale for pluralization.\nPolyglot.prototype.locale = function (newLocale) {\n  if (newLocale) this.currentLocale = newLocale;\n  return this.currentLocale;\n};\n\n// ### polyglot.extend(phrases)\n//\n// Use `extend` to tell Polyglot how to translate a given key.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The key can be any string.  Feel free to call `extend` multiple times;\n// it will override any phrases with the same key, but leave existing phrases\n// untouched.\n//\n// It is also possible to pass nested phrase objects, which get flattened\n// into an object with the nested keys concatenated using dot notation.\n//\n//     polyglot.extend({\n//       \"nav\": {\n//         \"hello\": \"Hello\",\n//         \"hello_name\": \"Hello, %{name}\",\n//         \"sidebar\": {\n//           \"welcome\": \"Welcome\"\n//         }\n//       }\n//     });\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}',\n//     //   'nav.sidebar.welcome': 'Welcome'\n//     // }\n//\n// `extend` accepts an optional second argument, `prefix`, which can be used\n// to prefix every key in the phrases object with some string, using dot\n// notation.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     }, \"nav\");\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}'\n//     // }\n//\n// This feature is used internally to support nested phrase objects.\nPolyglot.prototype.extend = function (morePhrases, prefix) {\n  forEach(morePhrases, function (phrase, key) {\n    var prefixedKey = prefix ? prefix + '.' + key : key;\n    if (typeof phrase === 'object') {\n      this.extend(phrase, prefixedKey);\n    } else {\n      this.phrases[prefixedKey] = phrase;\n    }\n  }, this);\n};\n\n// ### polyglot.unset(phrases)\n// Use `unset` to selectively remove keys from a polyglot instance.\n//\n//     polyglot.unset(\"some_key\");\n//     polyglot.unset({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The unset method can take either a string (for the key), or an object hash with\n// the keys that you would like to unset.\nPolyglot.prototype.unset = function (morePhrases, prefix) {\n  if (typeof morePhrases === 'string') {\n    delete this.phrases[morePhrases];\n  } else {\n    forEach(morePhrases, function (phrase, key) {\n      var prefixedKey = prefix ? prefix + '.' + key : key;\n      if (typeof phrase === 'object') {\n        this.unset(phrase, prefixedKey);\n      } else {\n        delete this.phrases[prefixedKey];\n      }\n    }, this);\n  }\n};\n\n// ### polyglot.clear()\n//\n// Clears all phrases. Useful for special cases, such as freeing\n// up memory if you have lots of phrases but no longer need to\n// perform any translation. Also used internally by `replace`.\nPolyglot.prototype.clear = function () {\n  this.phrases = {};\n};\n\n// ### polyglot.replace(phrases)\n//\n// Completely replace the existing phrases with a new set of phrases.\n// Normally, just use `extend` to add more phrases, but under certain\n// circumstances, you may want to make sure no old phrases are lying around.\nPolyglot.prototype.replace = function (newPhrases) {\n  this.clear();\n  this.extend(newPhrases);\n};\n\n\n// ### polyglot.t(key, options)\n//\n// The most-used method. Provide a key, and `t` will return the\n// phrase.\n//\n//     polyglot.t(\"hello\");\n//     => \"Hello\"\n//\n// The phrase value is provided first by a call to `polyglot.extend()` or\n// `polyglot.replace()`.\n//\n// Pass in an object as the second argument to perform interpolation.\n//\n//     polyglot.t(\"hello_name\", {name: \"Spike\"});\n//     => \"Hello, Spike\"\n//\n// If you like, you can provide a default value in case the phrase is missing.\n// Use the special option key \"_\" to specify a default.\n//\n//     polyglot.t(\"i_like_to_write_in_language\", {\n//       _: \"I like to write in %{language}.\",\n//       language: \"JavaScript\"\n//     });\n//     => \"I like to write in JavaScript.\"\n//\nPolyglot.prototype.t = function (key, options) {\n  var phrase, result;\n  var opts = options == null ? {} : options;\n  if (typeof this.phrases[key] === 'string') {\n    phrase = this.phrases[key];\n  } else if (typeof opts._ === 'string') {\n    phrase = opts._;\n  } else if (this.onMissingKey) {\n    var onMissingKey = this.onMissingKey;\n    result = onMissingKey(key, opts, this.currentLocale, this.tokenRegex);\n  } else {\n    this.warn('Missing translation for key: \"' + key + '\"');\n    result = key;\n  }\n  if (typeof phrase === 'string') {\n    result = transformPhrase(phrase, opts, this.currentLocale, this.tokenRegex);\n  }\n  return result;\n};\n\n\n// ### polyglot.has(key)\n//\n// Check if polyglot has a translation for given key\nPolyglot.prototype.has = function (key) {\n  return has(this.phrases, key);\n};\n\n// export transformPhrase\nPolyglot.transformPhrase = function transform(phrase, substitutions, locale) {\n  return transformPhrase(phrase, substitutions, locale);\n};\n\nvar webixPolyglot = Polyglot;\n\nfunction Locale(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let lang = storage ? (storage.get(\"lang\") || \"en\") : (config.lang || \"en\");\r\n    function setLangData(name, data, silent) {\r\n        if (data.__esModule) {\r\n            data = data.default;\r\n        }\r\n        const pconfig = { phrases: data };\r\n        if (config.polyglot) {\r\n            app.webix.extend(pconfig, config.polyglot);\r\n        }\r\n        const poly = service.polyglot = new webixPolyglot(pconfig);\r\n        poly.locale(name);\r\n        service._ = app.webix.bind(poly.t, poly);\r\n        lang = name;\r\n        if (storage) {\r\n            storage.put(\"lang\", lang);\r\n        }\r\n        if (config.webix) {\r\n            const locName = config.webix[name];\r\n            if (locName) {\r\n                app.webix.i18n.setLocale(locName);\r\n            }\r\n        }\r\n        if (!silent) {\r\n            return app.refresh();\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    function getLang() { return lang; }\r\n    function setLang(name, silent) {\r\n        // ignore setLang if loading by path is disabled\r\n        if (config.path === false) {\r\n            return;\r\n        }\r\n        const path = (config.path ? config.path + \"/\" : \"\") + name;\r\n        const data = app.require(\"jet-locales\", path);\r\n        setLangData(name, data, silent);\r\n    }\r\n    const service = {\r\n        getLang, setLang, setLangData, _: null, polyglot: null\r\n    };\r\n    app.setService(\"locale\", service);\r\n    setLang(lang, true);\r\n}\n\nfunction show(view, config, value) {\r\n    if (config.urls) {\r\n        value = config.urls[value] || value;\r\n    }\r\n    else if (config.param) {\r\n        value = { [config.param]: value };\r\n    }\r\n    view.show(value);\r\n}\r\nfunction Menu(app, view, config) {\r\n    const frame = view.getSubViewInfo().parent;\r\n    const ui = view.$$(config.id || config);\r\n    let silent = false;\r\n    ui.attachEvent(\"onchange\", function () {\r\n        if (!silent) {\r\n            show(frame, config, this.getValue());\r\n        }\r\n    });\r\n    ui.attachEvent(\"onafterselect\", function () {\r\n        if (!silent) {\r\n            let id = null;\r\n            if (ui.setValue) {\r\n                id = this.getValue();\r\n            }\r\n            else if (ui.getSelectedId) {\r\n                id = ui.getSelectedId();\r\n            }\r\n            show(frame, config, id);\r\n        }\r\n    });\r\n    view.on(app, `app:route`, function () {\r\n        let name = \"\";\r\n        if (config.param) {\r\n            name = view.getParam(config.param, true);\r\n        }\r\n        else {\r\n            const segment = frame.getUrl()[1];\r\n            if (segment) {\r\n                name = segment.page;\r\n            }\r\n        }\r\n        if (name) {\r\n            silent = true;\r\n            if (ui.setValue && ui.getValue() !== name) {\r\n                ui.setValue(name);\r\n            }\r\n            else if (ui.select && ui.exists(name) && ui.getSelectedId() !== name) {\r\n                ui.select(name);\r\n            }\r\n            silent = false;\r\n        }\r\n    });\r\n}\n\nconst baseicons = {\r\n    good: \"check\",\r\n    error: \"warning\",\r\n    saving: \"refresh fa-spin\"\r\n};\r\nconst basetext = {\r\n    good: \"Ok\",\r\n    error: \"Error\",\r\n    saving: \"Connecting...\"\r\n};\r\nfunction Status(app, view, config) {\r\n    let status = \"good\";\r\n    let count = 0;\r\n    let iserror = false;\r\n    let expireDelay = config.expire;\r\n    if (!expireDelay && expireDelay !== false) {\r\n        expireDelay = 2000;\r\n    }\r\n    const texts = config.texts || basetext;\r\n    const icons = config.icons || baseicons;\r\n    if (typeof config === \"string\") {\r\n        config = { target: config };\r\n    }\r\n    function refresh(content) {\r\n        const area = view.$$(config.target);\r\n        if (area) {\r\n            if (!content) {\r\n                content = \"<div class='status_\" +\r\n                    status +\r\n                    \"'><span class='webix_icon fa-\" +\r\n                    icons[status] + \"'></span> \" + texts[status] + \"</div>\";\r\n            }\r\n            area.setHTML(content);\r\n        }\r\n    }\r\n    function success() {\r\n        count--;\r\n        setStatus(\"good\");\r\n    }\r\n    function fail(err) {\r\n        count--;\r\n        setStatus(\"error\", err);\r\n    }\r\n    function start(promise) {\r\n        count++;\r\n        setStatus(\"saving\");\r\n        if (promise && promise.then) {\r\n            promise.then(success, fail);\r\n        }\r\n    }\r\n    function getStatus() {\r\n        return status;\r\n    }\r\n    function hideStatus() {\r\n        if (count === 0) {\r\n            refresh(\" \");\r\n        }\r\n    }\r\n    function setStatus(mode, err) {\r\n        if (count < 0) {\r\n            count = 0;\r\n        }\r\n        if (mode === \"saving\") {\r\n            status = \"saving\";\r\n            refresh();\r\n        }\r\n        else {\r\n            iserror = (mode === \"error\");\r\n            if (count === 0) {\r\n                status = iserror ? \"error\" : \"good\";\r\n                if (iserror) {\r\n                    app.error(\"app:error:server\", [err.responseText || err]);\r\n                }\r\n                else {\r\n                    if (expireDelay) {\r\n                        setTimeout(hideStatus, expireDelay);\r\n                    }\r\n                }\r\n                refresh();\r\n            }\r\n        }\r\n    }\r\n    function track(data) {\r\n        const dp = app.webix.dp(data);\r\n        if (dp) {\r\n            view.on(dp, \"onAfterDataSend\", start);\r\n            view.on(dp, \"onAfterSaveError\", (_id, _obj, response) => fail(response));\r\n            view.on(dp, \"onAfterSave\", success);\r\n        }\r\n    }\r\n    app.setService(\"status\", {\r\n        getStatus,\r\n        setStatus,\r\n        track\r\n    });\r\n    if (config.remote) {\r\n        view.on(app.webix, \"onRemoteCall\", start);\r\n    }\r\n    if (config.ajax) {\r\n        view.on(app.webix, \"onBeforeAjax\", (_mode, _url, _data, _request, _headers, _files, promise) => {\r\n            start(promise);\r\n        });\r\n    }\r\n    if (config.data) {\r\n        track(config.data);\r\n    }\r\n}\n\nfunction Theme(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let theme = storage ?\r\n        (storage.get(\"theme\") || \"flat-default\")\r\n        :\r\n            (config.theme || \"flat-default\");\r\n    const service = {\r\n        getTheme() { return theme; },\r\n        setTheme(name, silent) {\r\n            const parts = name.split(\"-\");\r\n            const links = document.getElementsByTagName(\"link\");\r\n            for (let i = 0; i < links.length; i++) {\r\n                const lname = links[i].getAttribute(\"title\");\r\n                if (lname) {\r\n                    if (lname === name || lname === parts[0]) {\r\n                        links[i].disabled = false;\r\n                    }\r\n                    else {\r\n                        links[i].disabled = true;\r\n                    }\r\n                }\r\n            }\r\n            app.webix.skin.set(parts[0]);\r\n            // remove old css\r\n            app.webix.html.removeCss(document.body, \"theme-\" + theme);\r\n            // add new css\r\n            app.webix.html.addCss(document.body, \"theme-\" + name);\r\n            theme = name;\r\n            if (storage) {\r\n                storage.put(\"theme\", name);\r\n            }\r\n            if (!silent) {\r\n                app.refresh();\r\n            }\r\n        }\r\n    };\r\n    app.setService(\"theme\", service);\r\n    service.setTheme(theme, true);\r\n}\n\nfunction copyParams(data, url, route) {\r\n    for (let i = 0; i < route.length; i++) {\r\n        data[route[i]] = url[i + 1] ? url[i + 1].page : \"\";\r\n    }\r\n}\r\nfunction UrlParam(app, view, config) {\r\n    const route = config.route || config;\r\n    const data = {};\r\n    view.on(app, \"app:urlchange\", function (subview, segment) {\r\n        if (view === subview) {\r\n            copyParams(data, segment.suburl(), route);\r\n            segment.size(route.length + 1);\r\n        }\r\n    });\r\n    const os = view.setParam;\r\n    const og = view.getParam;\r\n    view.setParam = function (name, value, show) {\r\n        const index = route.indexOf(name);\r\n        if (index >= 0) {\r\n            data[name] = value;\r\n            this._segment.update(\"\", value, index + 1);\r\n            if (show) {\r\n                return view.show(null);\r\n            }\r\n        }\r\n        else {\r\n            return os.call(this, name, value, show);\r\n        }\r\n    };\r\n    view.getParam = function (key, mode) {\r\n        const val = data[key];\r\n        if (typeof val !== \"undefined\") {\r\n            return val;\r\n        }\r\n        return og.call(this, key, mode);\r\n    };\r\n    copyParams(data, view.getUrl(), route);\r\n}\n\nfunction User(app, _view, config) {\r\n    config = config || {};\r\n    const login = config.login || \"/login\";\r\n    const logout = config.logout || \"/logout\";\r\n    const afterLogin = config.afterLogin || app.config.start;\r\n    const afterLogout = config.afterLogout || \"/login\";\r\n    const ping = config.ping || 5 * 60 * 1000;\r\n    const model = config.model;\r\n    let user = config.user;\r\n    const service = {\r\n        getUser() {\r\n            return user;\r\n        },\r\n        getStatus(server) {\r\n            if (!server) {\r\n                return user !== null;\r\n            }\r\n            return model.status().catch(() => null).then(data => {\r\n                user = data;\r\n            });\r\n        },\r\n        login(name, pass) {\r\n            return model.login(name, pass).then(data => {\r\n                user = data;\r\n                if (!data) {\r\n                    throw new Error(\"Access denied\");\r\n                }\r\n                app.callEvent(\"app:user:login\", [user]);\r\n                app.show(afterLogin);\r\n            });\r\n        },\r\n        logout() {\r\n            user = null;\r\n            return model.logout().then(res => {\r\n                app.callEvent(\"app:user:logout\", []);\r\n                return res;\r\n            });\r\n        }\r\n    };\r\n    function canNavigate(url, obj) {\r\n        if (url === logout) {\r\n            service.logout();\r\n            obj.redirect = afterLogout;\r\n        }\r\n        else if (url !== login && !service.getStatus()) {\r\n            obj.redirect = login;\r\n        }\r\n    }\r\n    app.setService(\"user\", service);\r\n    app.attachEvent(`app:guard`, function (url, _$root, obj) {\r\n        if (config.public && config.public(url)) {\r\n            return true;\r\n        }\r\n        if (typeof user === \"undefined\") {\r\n            obj.confirm = service.getStatus(true).then(() => canNavigate(url, obj));\r\n        }\r\n        return canNavigate(url, obj);\r\n    });\r\n    if (ping) {\r\n        setInterval(() => service.getStatus(true), ping);\r\n    }\r\n}\n\n/*\r\nMIT License\r\nCopyright (c) 2019 XB Software\r\n*/\r\nlet webix = window.webix;\r\nif (webix) {\r\n    patch(webix);\r\n}\r\nconst plugins = {\r\n    UnloadGuard, Locale, Menu, Theme, User, Status, UrlParam\r\n};\r\nconst errors = { NavigationBlocked };\r\nconst w = window;\r\nif (!w.Promise) {\r\n    w.Promise = w.webix.promise;\r\n}\n\nexport { plugins, errors, JetApp, JetView, HashRouter, StoreRouter, UrlRouter, EmptyRouter, SubRouter };\n//# sourceMappingURL=jet.js.map\n","let once = false;\n\nexport function initRLayout(){\n    if (once) return;\n    once = true;\n\n    webix.protoUI(\n        {\n            name: \"r-layout\",\n            sizeTrigger(app, handler, value) {\n                this._compactValue = value;\n                this._compactHandler = handler;\n                this._app = app;\n\n                const config = app.config;\n                this._forceCompact = typeof config.params.forceCompact !== \"undefined\";\n                this._compactWidth = config.compactWidth;\n\n                if (!this._forceCompact) this._checkTrigger(this.$view.width, value);\n            },\n            _checkTrigger(x, value) {\n                if (this._compactWidth) {\n                    if (\n                        (x <= this._compactWidth && !value) ||\n                        (x > this._compactWidth && value)\n                    ) {\n                        this._compactWidth = null;\n                        this._compactHandler(!value);\n                        return false;\n                    }\n                }\n                return true;\n            },\n            $setSize(x, y) {\n                if (this._forceCompact || this._checkTrigger(x, this._compactValue))\n                    webix.ui.layout.prototype.$setSize.call(this, x, y);\n                if (this._app) this._app.callEvent(\"view:resize\", []); //edit popup resize\n            },\n        },\n        webix.ui.layout\n    );\n}\n","export function initJetWin(app) {\n\tlet appId;\n\n\tconst service = {\n\t\tupdateConfig(config){\n\t\t\tconst appView = app.getRoot();\n\t\t\tconst appNode = appView.$view;\n\n\t\t\tif(!appId){\n\t\t\t\tif(appNode.id)\n\t\t\t\t\tappId = appNode.id;\n\t\t\t\telse \n\t\t\t\t\tappNode.id = appId = \"webix_\" + webix.uid();\n\n\t\t\t\twebix.html.addStyle(`.webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }`);\n\t\t\t\twebix.html.addStyle(`#${appId}{ position: relative; }`);\n\t\t\t\twebix.html.addStyle(`#${appId} .webix_window{ z-index:2 !important; }`);\n\t\t\t\twebix.html.addStyle(`#${appId} .webix_disabled{ z-index:1 !important; }`);\n\t\t\t}\n\t\t\telse if(appId && !appNode.id) //app refresh\n\t\t\t\tappNode.id = appId;\n\n\t\t\tconfig.container = appId;\n\n\t\t\tif(config.fullscreen){\n\t\t\t\tconfig._fillApp = true;\n\t\t\t\tdelete config.fullscreen;\n\t\t\t}\n\n\t\t\tif(!config.on)\n\t\t\t\tconfig.on = {};\n\n\t\t\tlet firstShow = true;\n\t\t\tconst defaultHandler = config.on.onShow;\n\n\t\t\tconfig.on.onShow = function(){\n\t\t\t\tif(defaultHandler)\n\t\t\t\t\tdefaultHandler.apply(this, arguments);\n\n\t\t\t\tif(firstShow){\n\t\t\t\t\tthis.$setSize = (x, y) => {\n\t\t\t\t\t\tsetSize(this, appView, true);\n\t\t\t\t\t\twebix.ui.window.prototype.$setSize.apply(this, [x, y]);\n\t\t\t\t\t};\n\t\t\t\t\tsetHandlers(this, app);\n\t\t\t\t\tfirstShow = null;\n\t\t\t\t}\n\n\t\t\t\twebix.callEvent(\"onClick\", []);\n\t\t\t\twebix.html.addCss(appNode, \"webix_win_inside\");\n\t\t\t\tappView.disable();\n\n\t\t\t\tsetSize(this, appView);\n\t\t\t}\n\n\t\t\treturn config;\n\t\t}\n\t};\n\n\tapp.setService(\"jet-win\", service);\n}\n\nfunction setSize(win, appView, silent){\n\tconst appWidth = appView.$width;\n\tconst appHeight = appView.$height;\n\n\tif(win.config._fillApp)\n\t\twin.define({\n\t\t\twidth: appWidth,\n\t\t\theight: appHeight,\n\t\t});\n\telse {\n\t\twin.define({\n\t\t\tleft: (appWidth - win.$width) / 2,\n\t\t\ttop: (appHeight - win.$height) / 2,\n\t\t});\n\t}\n\n\tif(!silent)\n\t\twin.resize();\n}\n\nfunction setHandlers(win, app){\n\tconst appView = app.getRoot();\n\n\twin.attachEvent(\"onHide\", ()=> {\n\t\tif(!appView.$destructed){\n\t\t\twebix.html.removeCss(appView.$view, \"webix_win_inside\");\n\t\t\tappView.enable();\n\t\t}\n\t});\n\n\tconst resizeEv = app.attachEvent(\"view:resize\", ()=> {\n\t\tsetSize(win, appView);\n\t});\n\n\twin.attachEvent(\"onDestruct\", ()=> {\n\t\tapp.detachEvent(resizeEv);\n\t});\n}\n","var index = 1;\nfunction uid() {\n\treturn index++;\n}\n\nvar empty = undefined;\n\nexport function ignoreInitial(code) {\n\tlet init = false;\n\treturn function() {\n\t\tif (init) return code.apply(this, arguments);\n\t\telse init = true;\n\t};\n}\n\nvar context = null;\nexport function withContext(value, code) {\n\tcontext = value;\n\tcode();\n\tcontext = null;\n}\n\nexport function filter(rule, handler) {\n\treturn function(v, o, obj, meta) {\n\t\tif (rule(v, meta)) handler.apply(this, arguments);\n\t};\n}\n\nexport function link(source, target, key) {\n\tObject.defineProperty(target, key, {\n\t\tget: () => source[key],\n\t\tset: value => (source[key] = value),\n\t});\n}\n\nexport function debounce(handler, delay) {\n\tdelay = delay || 200;\n\tlet timer = null;\n\tlet data = null;\n\treturn function() {\n\t\tdata = arguments;\n\t\tif (!timer) {\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttimer = null;\n\n\t\t\t\thandler.apply(this, data);\n\t\t\t}, delay);\n\t\t}\n\t};\n}\n\nexport function createState(data, config) {\n\tconfig = config || {};\n\tconst handlers = {};\n\tconst out = {};\n\n\tconst observe = function(mask, handler) {\n\t\tconst key = uid();\n\t\thandlers[key] = { mask, handler };\n\t\tif (mask === \"*\") handler(out, empty, mask);\n\t\telse handler(out[mask], empty, mask);\n\n\t\treturn key;\n\t};\n\n\tconst extend = function(data, sconfig){\n\t\tsconfig = sconfig || config;\n\t\t// normal js object\n\t\tfor (const key in data) {\n\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\tconst test = data[key];\n\t\t\t\tif (sconfig.nested && typeof test === \"object\" && test) {\n\t\t\t\t\tout[key] = createState(test, sconfig);\n\t\t\t\t} else {\n\t\t\t\t\treactive(out, test, key, notify);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tconst observeEnd = function(id) {\n\t\tdelete handlers[id];\n\t};\n\n\tconst queue = [];\n\tlet waitInQueue = false;\n\n\tvar batch = function(code) {\n\t\tif (typeof code !== \"function\") {\n\t\t\tconst values = code;\n\t\t\tcode = () => {\n\t\t\t\tfor (const key in values) out[key] = values[key];\n\t\t\t};\n\t\t}\n\n\t\twaitInQueue = true;\n\t\tcode(out);\n\t\twaitInQueue = false;\n\t\twhile (queue.length) {\n\t\t\tconst obj = queue.shift();\n\t\t\tnotify.apply(this, obj);\n\t\t}\n\t};\n\n\tconst notify = function(key, old, value, meta) {\n\t\tif (waitInQueue) {\n\t\t\tqueue.push([key, old, value, meta]);\n\t\t\treturn;\n\t\t}\n\n\t\tconst list = Object.keys(handlers);\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tconst obj = handlers[list[i]];\n\t\t\tif (!obj) continue;\n\t\t\tif (obj.mask === \"*\" || obj.mask === key) {\n\t\t\t\tobj.handler(value, old, key, meta);\n\t\t\t}\n\t\t}\n\t};\n\n\tObject.defineProperty(out, \"$changes\", {\n\t\tvalue: {\n\t\t\tattachEvent: observe,\n\t\t\tdetachEvent: observeEnd,\n\t\t},\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$observe\", {\n\t\tvalue: observe,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$batch\", {\n\t\tvalue: batch,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$extend\", {\n\t\tvalue: extend,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\n\tout.$extend(data, config);\n\treturn out;\n}\n\nfunction reactive(obj, val, key, notify) {\n\tObject.defineProperty(obj, key, {\n\t\tget: function() {\n\t\t\treturn val;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar changed = false;\n\t\t\tif (val === null || value === null) {\n\t\t\t\tchanged = val !== value;\n\t\t\t} else {\n\t\t\t\tchanged = val.valueOf() != value.valueOf();\n\t\t\t}\n\n\t\t\tif (changed) {\n\t\t\t\tvar old = val;\n\t\t\t\tval = value;\n\t\t\t\tnotify(key, old, value, context);\n\t\t\t}\n\t\t},\n\t\tenumerable: true,\n\t\tconfigurable: false,\n\t});\n}","webix.protoUI(\n\t{\n\t\tname: \"pivot-portlet\",\n\t\t$reorderOnly: true,\n\t\t$drag: function(object) {\n\t\t\twebix.html.addCss(this.$view, \"portlet_in_drag\");\n\t\t\tconst ctx = webix.DragControl.getContext();\n\t\t\tctx.source = ctx.from = object;\n\n\t\t\t// hide suggests\n\t\t\twebix.callEvent(\"onClick\", []);\n\n\t\t\tconst local = this.$scope.app.getService(\"local\");\n\t\t\tconst values = this.getChildViews()[0].getValues();\n\n\t\t\tlet text = \"\";\n\n\t\t\tif (values.operation == \"complex\") text = local.fixMath(values.math);\n\t\t\telse {\n\t\t\t\ttext = values.name ? local.getField(values.name).value : \"\";\n\n\t\t\t\tif (values.name2)\n\t\t\t\t\ttext += (text ? \", \" : \"\") + local.getField(values.name2).value;\n\t\t\t\telse if (!text) {\n\t\t\t\t\tconst _ = this.$scope.app.getService(\"locale\")._;\n\t\t\t\t\ttext = _(\"Field not defined\");\n\t\t\t\t} else if (values.operation) text += ` (${values.operation})`;\n\t\t\t}\n\n\t\t\tconst askin = webix.skin.$active;\n\t\t\tconst style = `width:${this.$width - askin.inputHeight}px;height:${\n\t\t\t\tthis.$height\n\t\t\t}px;`;\n\t\t\treturn `<div class=\"webix_pivot_portlet_drag\" style=\"${style}\">\n\t\t\t\t<span class=\"webix_icon ${this.config.icon}\"></span>${text}\n\t\t\t</div>`;\n\t\t},\n\t},\n\twebix.ui.portlet\n);\n","import { JetView } from \"webix-jet\";\n\nimport \"helpers/portlet\";\n\nexport default class Property extends JetView {\n\tconstructor(app, name, config) {\n\t\tsuper(app, name);\n\n\t\tif (!config) config = {};\n\n\t\tthis.plusLabel = config.plusLabel;\n\t\tthis.field = config.field;\n\t}\n\tconfig() {\n\t\tconst askin = webix.skin.$active;\n\t\treturn {\n\t\t\tborderless: true,\n\t\t\ttype: \"clean\",\n\t\t\tpaddingY: 8,\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"forms\",\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\trows: [],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttemplate: `<div class=\"webix_pivot_handle_add_value\">\n\t\t\t\t\t\t<span class=\"webix_icon wxi-plus-circle\"></span><span>${this.plusLabel}</span>\n\t\t\t\t\t</div>`,\n\t\t\t\t\tcss: \"webix_pivot_add_value\",\n\t\t\t\t\theight: askin.inputHeight - 2 * askin.inputPadding,\n\t\t\t\t\tlocalId: \"addValue\",\n\t\t\t\t\tonClick: {\n\t\t\t\t\t\twebix_pivot_handle_add_value: () => {\n\t\t\t\t\t\t\tconst forms = this.$$(\"forms\").getChildViews();\n\n\t\t\t\t\t\t\tthis.Add(null, forms.length);\n\t\t\t\t\t\t\tconst input = forms[forms.length - 1].queryView({ name: \"name\" });\n\n\t\t\t\t\t\t\tif (input) {\n\t\t\t\t\t\t\t\tinput.focus();\n\t\t\t\t\t\t\t\twebix.html.triggerEvent(\n\t\t\t\t\t\t\t\t\tinput.getInputNode(),\n\t\t\t\t\t\t\t\t\t\"MouseEvent\",\n\t\t\t\t\t\t\t\t\t\"click\"\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\tthis.field != \"values\" &&\n\t\t\t\t\t\t\t\tforms.length == this.app.getState().fields.length\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\tthis.$$(\"addValue\").hide();\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\tinit() {\n\t\tthis.on(webix, \"onAfterPortletMove\", source => {\n\t\t\tif (source == this.$$(\"forms\"))\n\t\t\t\tthis.app.callEvent(\"property:change\", [this.field, this.GetValue()]);\n\t\t});\n\t\tthis.on(webix, \"onPortletDrag\", function(active, target) {\n\t\t\tif (active.$reorderOnly)\n\t\t\t\treturn active.getParentView() === target.getParentView();\n\t\t});\n\t}\n\tListTemplate(obj) {\n\t\tconst input = this._activeInput;\n\n\t\t//wavg - complex operation, no need to correct inputs\n\t\tconst wavg =\n\t\t\tthis.field == \"values\" &&\n\t\t\tinput &&\n\t\t\t!input.$destructed && // CorrectInputs calls SetValue, which recreates inputs\n\t\t\tinput.getFormView().elements.operation.getValue() == \"wavg\";\n\n\t\tconst corrections = this.getParentView().GetCorrections()[this.field];\n\t\tconst value = obj.value;\n\n\t\tif (!wavg && corrections) {\n\t\t\tconst includes = this.CheckCorrections(corrections, obj.id);\n\n\t\t\tlet css = \"webix_pivot_list_marker\";\n\t\t\tif (includes) css += \" webix_pivot_list_marker_fill\";\n\n\t\t\treturn `<div class=\"${css}\"> ${value}</div>`;\n\t\t} else return value;\n\t}\n\tCheckCorrections(corrections, id) {\n\t\tif (this._activeInput && id == this._activeInput.getValue()) return true;\n\n\t\tconst structure = this.app.getStructure();\n\n\t\tfor (let i = 0; i < corrections.length; i++) {\n\t\t\tconst name = corrections[i];\n\t\t\tconst val = structure[name];\n\n\t\t\tif (val) {\n\t\t\t\tif (typeof val == \"string\") {\n\t\t\t\t\tif (val == id) return true;\n\t\t\t\t} else {\n\t\t\t\t\tfor (let j = 0; j < val.length; j++) {\n\t\t\t\t\t\tlet value = val[j];\n\t\t\t\t\t\tif (value.name) value = value.name;\n\n\t\t\t\t\t\tif (value == id) return true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\tGetValue() {\n\t\tconst forms = this.$$(\"forms\").getChildViews();\n\t\tlet arr = [];\n\n\t\tforms.forEach(form => {\n\t\t\tconst val = form.getChildViews()[0].getValues().name;\n\n\t\t\tif (val) arr.push(val);\n\t\t});\n\n\t\treturn arr;\n\t}\n\tSetValue(val) {\n\t\tconst layout = this.$$(\"forms\");\n\t\tconst forms = layout.getChildViews();\n\n\t\tfor (let i = forms.length - 1; i >= 0; i--) layout.removeView(forms[i]);\n\t\tfor (let i = 0; i < val.length; i++) {\n\t\t\tif (!val[i].external) this.Add(val[i], i);\n\t\t}\n\t}\n\tAdd(val, i) {\n\t\tthis.$$(\"forms\").addView({\n\t\t\tview: \"pivot-portlet\",\n\t\t\tmode: \"replace\",\n\t\t\tborderless: true,\n\t\t\tbody: {\n\t\t\t\tview: \"form\",\n\t\t\t\tpaddingY: 0,\n\t\t\t\tpaddingX: 2,\n\t\t\t\telements: [\n\t\t\t\t\t{\n\t\t\t\t\t\tmargin: 2,\n\t\t\t\t\t\tcols: this.ItemConfig(val, i),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\ton: {\n\t\t\t\t\tonChange: (val, old, config) => {\n\t\t\t\t\t\tif (config == \"user\")\n\t\t\t\t\t\t\tthis.app.callEvent(\"property:change\", [\n\t\t\t\t\t\t\t\tthis.field,\n\t\t\t\t\t\t\t\tthis.GetValue(),\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\tItemConfig(val) {\n\t\treturn [\n\t\t\t{ width: webix.skin.$active.inputHeight }, //for portlet icon\n\t\t\t{\n\t\t\t\tview: \"richselect\",\n\t\t\t\tname: \"name\",\n\t\t\t\tvalue: this.PrepareValue(val),\n\t\t\t\thidden: val && val.operation == \"complex\",\n\t\t\t\toptions: {\n\t\t\t\t\tcss: \"webix_pivot_suggest\",\n\t\t\t\t\tdata: this.app.getState().fields,\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonBeforeShow: function() {\n\t\t\t\t\t\t\tconst input = webix.$$(this.config.master);\n\t\t\t\t\t\t\tconst master = input.$scope;\n\n\t\t\t\t\t\t\tconst data = master.GetValue();\n\t\t\t\t\t\t\tmaster._activeInput = input;\n\n\t\t\t\t\t\t\tthis.getList().filter(val =>\n\t\t\t\t\t\t\t\tmaster.FilterSuggest(data, input.getValue(), val)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tbody: {\n\t\t\t\t\t\ttemplate: obj => this.ListTemplate(obj),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\t{\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-close\",\n\t\t\t\tcss: \"webix_pivot_close_icon\",\n\t\t\t\tpivotPropertyRemove: true,\n\t\t\t\tclick: function() {\n\t\t\t\t\tconst master = this.$scope;\n\t\t\t\t\tmaster.$$(\"addValue\").show();\n\t\t\t\t\tmaster\n\t\t\t\t\t\t.$$(\"forms\")\n\t\t\t\t\t\t.removeView(this.queryView(\"pivot-portlet\", \"parent\"));\n\t\t\t\t\tmaster.app.callEvent(\"property:change\", [\n\t\t\t\t\t\tmaster.field,\n\t\t\t\t\t\tmaster.GetValue(),\n\t\t\t\t\t]);\n\t\t\t\t},\n\t\t\t},\n\t\t];\n\t}\n\tPrepareValue(val) {\n\t\tif (val) {\n\t\t\tif (typeof val == \"object\") val = val.name;\n\t\t\tif (webix.isArray(val)) val = val[0];\n\t\t} else val = \"\";\n\n\t\treturn val;\n\t}\n\tFilterSuggest(data, activeVal, val) {\n\t\tval = val.id;\n\n\t\tif (val == activeVal) return true;\n\n\t\treturn !data.find(item => {\n\t\t\tif (item.name) item = item.name;\n\n\t\t\treturn val == item;\n\t\t});\n\t}\n}\n","function isSymbolAllowed(char) {\n\tconst code = char.charCodeAt(0);\n\treturn code <= 122 ? (code >= 48 && code <= 57) || code >= 65 : code > 191;\n}\n\nfunction getLastSymbolIndex(str, right) {\n\tif (right) {\n\t\tfor (let i = 0; i < str.length; i++) if (!isSymbolAllowed(str[i])) return i;\n\t\treturn str.length;\n\t} else\n\t\tfor (let i = str.length - 1; i >= 0; i--)\n\t\t\tif (!isSymbolAllowed(str[i])) return i + 1;\n\n\treturn 0;\n}\n\nfunction startsWith(text, start) {\n\treturn text.toLowerCase().indexOf(start.toLowerCase()) === 0;\n}\n\nwebix.protoUI(\n\t{\n\t\tname: \"suggest-math\",\n\t\t$enterKey() {\n\t\t\tconst list = this.getList();\n\t\t\tif (this.isVisible() && !list.getSelectedId() && list.count()) {\n\t\t\t\tlist.select(list.data.order[1]);\n\t\t\t\tthis._addFirst = 1;\n\t\t\t}\n\n\t\t\twebix.ui.suggest.prototype.$enterKey.apply(this, arguments);\n\n\t\t\twebix.delay(() => {\n\t\t\t\tdelete this._addFirst; //wait for input node change event\n\t\t\t});\n\t\t},\n\t\tdefaults: {\n\t\t\tfilter(item, value) {\n\t\t\t\tconst editor = webix.$$(this.config.master);\n\t\t\t\tconst cursor = editor.getInputNode().selectionStart;\n\t\t\t\tconst str = value.substring(0, cursor);\n\t\t\t\tconst search = str.substring(getLastSymbolIndex(str));\n\t\t\t\tconst nextSymbol = value.charAt(cursor);\n\n\t\t\t\tif (search && (cursor === value.length || !isSymbolAllowed(nextSymbol)))\n\t\t\t\t\tvalue = search;\n\n\t\t\t\t//groups\n\t\t\t\tif (item.disabled) {\n\t\t\t\t\tconst app = editor.$scope.app;\n\n\t\t\t\t\tif (item.id == \"$fields\") {\n\t\t\t\t\t\tconst fields = app.getState().fields;\n\t\t\t\t\t\treturn !!fields.find(obj => startsWith(obj.value, value));\n\t\t\t\t\t} else if (item.id == \"$methods\") {\n\t\t\t\t\t\tconst _ = app.getService(\"locale\")._;\n\t\t\t\t\t\tconst operations = app.getService(\"local\").operations;\n\t\t\t\t\t\treturn !!operations.find(method => startsWith(_(method.id), value));\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn startsWith(item.value, value);\n\t\t\t},\n\t\t},\n\t},\n\twebix.ui.suggest\n);\n\nwebix.protoUI(\n\t{\n\t\tname: \"math-editor\",\n\t\t$init() {\n\t\t\tthis.$view.className += \" webix_el_text\";\n\t\t},\n\t\t$onBlur() {\n\t\t\tconst suggest = webix.$$(this.config.suggest);\n\t\t\tconst suggestClick = suggest.$view.contains(document.activeElement);\n\n\t\t\twebix.delay(() => {\n\t\t\t\tconst focus = webix.UIManager.getFocus();\n\t\t\t\tif (focus && focus.config.pivotPropertyRemove) return;\n\n\t\t\t\tif (!suggestClick)\n\t\t\t\t\tthis.callEvent(\"onChange\", [this.getValue(), null, \"user\"]);\n\t\t\t});\n\t\t},\n\t\tsetValue() {\n\t\t\tconst suggest = webix.$$(this.config.suggest);\n\n\t\t\t//handle clicks on suggest items and add first suggest value via enter\n\t\t\tif (suggest.isVisible() || suggest._addFirst) return;\n\n\t\t\twebix.ui.text.prototype.setValue.apply(this, arguments);\n\t\t},\n\t\t$setValueHere(value) {\n\t\t\tthis.setValueHere(value);\n\t\t},\n\t\tsetValueHere(value) {\n\t\t\tconst formula = this.getValue();\n\t\t\tconst cursor = this.getInputNode().selectionStart;\n\n\t\t\tlet str1 = formula.substring(0, cursor);\n\t\t\tlet str2 = formula.substring(cursor);\n\n\t\t\tconst lastSymbol = getLastSymbolIndex(str2, true);\n\t\t\tstr1 += str2.substring(0, lastSymbol);\n\t\t\tstr2 = str2.substring(lastSymbol);\n\n\t\t\tif (str1[str1.length - 1] == \"(\")\n\t\t\t\tstr1 = str1.substring(0, str1.length - 1);\n\n\t\t\tstr1 = str1.substring(0, getLastSymbolIndex(str1)) + value;\n\n\t\t\tconst operations = this.$scope.app.getService(\"local\").operations;\n\t\t\tconst isMethod = operations.find(obj => obj.value == value);\n\n\t\t\tif (isMethod)\n\t\t\t\t//suggest called via up/down key\n\t\t\t\tstr1 += str2[0] == \"(\" ? \"\" : \"(\";\n\n\t\t\tthis.$setValue(str1 + str2);\n\t\t\tthis.getInputNode().setSelectionRange(str1.length, str1.length);\n\t\t},\n\t},\n\twebix.ui.text\n);\n","import \"helpers/complex\";\nimport Property from \"views/config/properties\";\n\nexport default class ValuesProperty extends Property {\n\tconstructor(app, name, config) {\n\t\tsuper(app, name, config);\n\t\tthis.Local = this.app.getService(\"local\");\n\n\t\tthis._ = this.app.getService(\"locale\")._;\n\n\t\tthis.typeName = \"operation\";\n\t\tthis.plusLabel = this._(\"Add value\");\n\t\tthis.field = \"values\";\n\n\t\tthis.operations = this.Local.operations;\n\n\t\tthis.operations.map(operation => {\n\t\t\toperation.value = this._(operation.id);\n\t\t\treturn operation;\n\t\t});\n\t}\n\tinit() {\n\t\tsuper.init();\n\n\t\tthis.State = this.app.getState();\n\n\t\tthis.on(this.State.$changes, \"mode\", () => {\n\t\t\tthis.ToggleColors();\n\t\t});\n\t}\n\tGetValue() {\n\t\tconst forms = this.$$(\"forms\").getChildViews();\n\t\tconst arr = [];\n\n\t\tforms.forEach(form => {\n\t\t\tconst values = form.getChildViews()[0].getValues({ hidden: false });\n\t\t\tif (!webix.isUndefined(values.name2)) {\n\t\t\t\t//wavg\n\t\t\t\tif (values.name && values.name2) {\n\t\t\t\t\tvalues.name = [values.name, values.name2];\n\t\t\t\t\tdelete values.name2;\n\t\t\t\t} else values.name = \"\";\n\t\t\t}\n\n\t\t\tif (values.name == \"\" || values.math == \"\") return;\n\t\t\tif (values.math) values.math = this.OutComplexMath(values.math);\n\t\t\tarr.push(values);\n\t\t});\n\n\t\treturn arr;\n\t}\n\tItemConfig(val, i) {\n\t\tconst config = super.ItemConfig(val);\n\n\t\tlet operation;\n\t\tif (val) operation = val.operation;\n\t\telse {\n\t\t\tconst def = this.app.config.defaultOperation;\n\t\t\tconst defIndex = Math.max(this.operations.findIndex(a => a.id == def), 0);\n\t\t\toperation = this.operations[defIndex].id;\n\t\t}\n\n\t\tconfig.splice(2, 0, {\n\t\t\tview: \"richselect\",\n\t\t\tname: \"operation\",\n\t\t\twidth: 110,\n\t\t\tvalue: operation,\n\t\t\toptions: {\n\t\t\t\tcss: \"webix_pivot_suggest\",\n\t\t\t\tdata: this.operations.filter(\n\t\t\t\t\tobj => obj.fields <= 2 || obj.id == \"complex\"\n\t\t\t\t),\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonChange: function(v) {\n\t\t\t\t\tthis.$scope.SetOperation(v, this);\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tconfig.splice(2, 0, {\n\t\t\tview: \"richselect\",\n\t\t\thidden: this.Local.getOperation(operation).fields != 2,\n\t\t\tvalue: val && webix.isArray(val.name) ? val.name[1] : \"\",\n\t\t\tname: \"name2\",\n\t\t\toptions: {\n\t\t\t\tcss: \"webix_pivot_suggest\",\n\t\t\t\tdata: this.app.getState().fields,\n\t\t\t},\n\t\t});\n\n\t\t//custom math\n\t\tconfig.splice(1, 0, {\n\t\t\tview: \"math-editor\",\n\t\t\tname: \"math\",\n\t\t\thidden: !val || val.operation != \"complex\",\n\t\t\tvalue: val && val.math ? this.Local.fixMath(val.math) : \"\",\n\t\t\tsuggest: {\n\t\t\t\tview: \"suggest-math\",\n\t\t\t\tdata: this.SuggestData(),\n\t\t\t},\n\t\t});\n\n\t\tconst mini = webix.skin.$name == \"mini\" || webix.skin.$name == \"compact\";\n\t\tconst palette = this.Local.getPalette();\n\t\tconst color = (val && val.color) || this.Local.getValueColor(i);\n\n\t\tconfig.splice(1, 0, {\n\t\t\tview: \"colorpicker\",\n\t\t\thidden: this.State.mode != \"chart\",\n\t\t\tname: \"color\",\n\t\t\tcss: \"webix_pivot_value_color\",\n\t\t\tvalue: color,\n\t\t\twidth: mini ? 30 : 38,\n\t\t\tsuggest: {\n\t\t\t\ttype: \"colorboard\",\n\t\t\t\tbody: {\n\t\t\t\t\twidth: 150,\n\t\t\t\t\theight: 150,\n\t\t\t\t\tview: \"colorboard\",\n\t\t\t\t\tpalette,\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\treturn config;\n\t}\n\tToggleColors() {\n\t\tconst mode = this.State.mode;\n\n\t\tconst layout = this.$$(\"forms\");\n\t\tconst forms = layout.getChildViews();\n\n\t\tfor (let i = 0; i < forms.length; i++) {\n\t\t\tconst input = forms[i].getChildViews()[0].elements.color;\n\t\t\tif (mode == \"chart\") input.show();\n\t\t\telse input.hide();\n\t\t}\n\t}\n\tFilterSuggest() {\n\t\treturn true;\n\t}\n\tSetOperation(val, view) {\n\t\tconst form = view.getFormView();\n\t\tconst elements = form.elements;\n\n\t\tif (val == \"complex\") {\n\t\t\telements.name.hide();\n\t\t\telements.name2.hide();\n\t\t\telements.math.show();\n\n\t\t\telements.name.setValue();\n\t\t\telements.name2.setValue();\n\t\t} else if (this.Local.getOperation(val).fields == 2) {\n\t\t\telements.name.show();\n\t\t\telements.name2.show();\n\t\t\telements.math.hide();\n\t\t} else {\n\t\t\telements.name.show();\n\t\t\telements.name2.hide();\n\t\t\telements.math.hide();\n\t\t}\n\t}\n\tSuggestData() {\n\t\treturn [\n\t\t\t{\n\t\t\t\tvalue: this._(\"Fields\"),\n\t\t\t\tid: \"$fields\",\n\t\t\t\tdisabled: true,\n\t\t\t\t$css: \"webix_pivot_values_section\",\n\t\t\t},\n\t\t\t...this.app.getState().fields,\n\t\t\t{\n\t\t\t\tvalue: this._(\"Methods\"),\n\t\t\t\tid: \"$methods\",\n\t\t\t\tdisabled: true,\n\t\t\t\t$css: \"webix_pivot_values_section\",\n\t\t\t},\n\t\t\t...this.operations.filter(obj => obj.id != \"complex\"),\n\t\t];\n\t}\n\tOutComplexMath(math) {\n\t\tconst fields = this.app.getState().fields;\n\t\tconst fieldsRegex = new RegExp(\n\t\t\t\"(\\\\(|\\\\s|,|^)(\" +\n\t\t\t\tfields\n\t\t\t\t\t.map(field => field.value.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\"))\n\t\t\t\t\t.join(\"|\") +\n\t\t\t\t\")(\\\\)|\\\\s|,|$)\",\n\t\t\t\"g\"\n\t\t);\n\n\t\tconst fieldsMatch = Array.from(math.matchAll(fieldsRegex));\n\t\tfor (let i = fieldsMatch.length - 1; i >= 0; i--) {\n\t\t\tconst match = fieldsMatch[i];\n\t\t\tmath =\n\t\t\t\tmath.substring(0, match.index + match[1].length) +\n\t\t\t\tfields.find(obj => obj.value == match[2]).id +\n\t\t\t\tmath.substring(\n\t\t\t\t\tmatch.index + match[0].length - match[3].length,\n\t\t\t\t\tmath.length\n\t\t\t\t);\n\t\t}\n\n\t\tconst methods = this.operations;\n\t\tconst methodsRegex = new RegExp(\n\t\t\t\"(\\\\(|,|\\\\+|-|\\\\/|\\\\*|\\\\s|^)(\" +\n\t\t\t\tmethods\n\t\t\t\t\t.map(method =>\n\t\t\t\t\t\tmethod.value.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g, \"\\\\$&\")\n\t\t\t\t\t)\n\t\t\t\t\t.join(\"|\") +\n\t\t\t\t\")\\\\(\",\n\t\t\t\"g\"\n\t\t);\n\n\t\tconst methodsMatch = Array.from(math.matchAll(methodsRegex));\n\t\tfor (let i = methodsMatch.length - 1; i >= 0; i--) {\n\t\t\tconst match = methodsMatch[i];\n\t\t\tmath =\n\t\t\t\tmath.substring(0, match.index + match[1].length) +\n\t\t\t\tthis.operations.find(operation => operation.value == match[2]).id +\n\t\t\t\tmath.substring(match.index + match[0].length - 1, math.length);\n\t\t}\n\n\t\treturn math;\n\t}\n}\n","import Property from \"views/config/properties\";\n\nexport default class GroupProperty extends Property {\n\tconstructor(app, name) {\n\t\tsuper(app, name);\n\n\t\tthis.field = \"groupBy\";\n\t}\n\tconfig() {\n\t\treturn {\n\t\t\tpadding: 10,\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\tlocalId: \"group\",\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tcss: \"webix_pivot_suggest\",\n\t\t\t\t\t\tdata: this.app.getState().fields,\n\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\ttemplate: obj => this.ListTemplate(obj),\n\t\t\t\t\t\t},\n\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\tonBeforeShow: () => {\n\t\t\t\t\t\t\t\tthis._activeInput = this.$$(\"group\");\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: (value, oldValue, source) => {\n\t\t\t\t\t\t\tif (source == \"user\")\n\t\t\t\t\t\t\t\tthis.app.callEvent(\"property:change\", [this.field, value]);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t}\n\tGetValue() {\n\t\treturn this.$$(\"group\").getValue();\n\t}\n\tSetValue(val) {\n\t\tthis.$$(\"group\").setValue(val);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class ChartSettings extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn {\n\t\t\tview: \"form\",\n\t\t\tcomplexData: true,\n\t\t\tpadding: 10,\n\t\t\telementsConfig: {\n\t\t\t\tlabelWidth: 120,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tname: \"type\",\n\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\tvalue: \"bar\",\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tcss: \"webix_pivot_suggest\",\n\t\t\t\t\t\tdata: [\n\t\t\t\t\t\t\t{ id: \"bar\", value: _(\"Bar\") },\n\t\t\t\t\t\t\t{ id: \"line\", value: _(\"Line\") },\n\t\t\t\t\t\t\t{ id: \"radar\", value: _(\"Radar\") },\n\t\t\t\t\t\t\t{ id: \"area\", value: _(\"Area\") },\n\t\t\t\t\t\t\t{ id: \"spline\", value: _(\"Spline\") },\n\t\t\t\t\t\t\t{ id: \"splineArea\", value: _(\"Spline Area\") },\n\t\t\t\t\t\t\t{ id: \"pie\", value: _(\"Pie\") },\n\t\t\t\t\t\t\t{ id: \"donut\", value: _(\"Donut\") },\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: \"xAxis.title\",\n\t\t\t\t\tview: \"text\",\n\t\t\t\t\tlabel: _(\"X axis title\"),\n\t\t\t\t\tbatch: \"axis\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: \"yAxis.title\",\n\t\t\t\t\tview: \"text\",\n\t\t\t\t\tlabel: _(\"Y axis title\"),\n\t\t\t\t\tbatch: \"axis\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: \"scaleColor\",\n\t\t\t\t\tbatch: \"scale\",\n\t\t\t\t\tview: \"colorpicker\",\n\t\t\t\t\teditable: true,\n\t\t\t\t\tlabel: _(\"Scale color\"),\n\t\t\t\t\tsuggest: {\n\t\t\t\t\t\ttype: \"colorboard\",\n\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\twidth: 150,\n\t\t\t\t\t\t\theight: 150,\n\t\t\t\t\t\t\tview: \"colorboard\",\n\t\t\t\t\t\t\tpalette: this.app.getService(\"local\").getPalette(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: \"3D\",\n\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\tbatch: \"pie\",\n\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\tlabelRight: _(\"3D\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: \"pieInnerText\",\n\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\tbatch: \"pie\",\n\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\tlabelRight: _(\"Show values inside\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: \"stacked\",\n\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\tbatch: \"stacked\",\n\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\tlabelRight: _(\"Stacked\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: \"horizontal\",\n\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\tbatch: \"bar\",\n\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\tlabelRight: _(\"Horizontal\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: \"scale\",\n\t\t\t\t\tbatch: \"scale\",\n\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\tcheckValue: \"logarithmic\",\n\t\t\t\t\tuncheckValue: \"linear\",\n\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\tlabelRight: _(\"Logarithmic scale\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: \"yAxis.lineShape\",\n\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\tbatch: \"radar\",\n\t\t\t\t\tcheckValue: \"arc\",\n\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\tlabelRight: _(\"Circled lines\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: \"lines\",\n\t\t\t\t\tbatch: \"scale\",\n\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\tlabelRight: _(\"Lines\"),\n\t\t\t\t},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonChange: (value, oldValue, source) => {\n\t\t\t\t\tif (source == \"user\") {\n\t\t\t\t\t\tconst out = this.OutValues(this.getRoot().getValues());\n\n\t\t\t\t\t\tthis.innerChange = true;\n\t\t\t\t\t\tthis.State.chart = Object.assign({}, out);\n\t\t\t\t\t\tthis.HandleVisibility();\n\t\t\t\t\t\tdelete this.innerChange;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\n\t\tthis.on(this.State.$changes, \"chart\", chart => {\n\t\t\tif (!this.innerChange) {\n\t\t\t\tthis.getRoot().setValues(this.InValues(chart));\n\t\t\t\tthis.HandleVisibility();\n\t\t\t}\n\t\t});\n\t}\n\tHandleVisibility() {\n\t\tconst form = this.getRoot();\n\t\tconst type = form.getValues().type;\n\t\tconst pieBased = type == \"pie\" || type == \"donut\";\n\n\t\tif (pieBased) form.showBatch(\"pie\");\n\t\telse {\n\t\t\tform.showBatch(\"scale\");\n\t\t\tif (type == \"radar\") form.showBatch(\"radar\", true);\n\t\t\telse {\n\t\t\t\tform.showBatch(\"axis\", true);\n\t\t\t\tconst bar = type == \"bar\";\n\t\t\t\tif (bar || type == \"area\") {\n\t\t\t\t\tif (bar) form.showBatch(\"bar\", true);\n\t\t\t\t\tform.showBatch(\"stacked\", true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tInValues(values) {\n\t\tvalues = webix.copy(values);\n\t\tconst type = values.type.toLowerCase();\n\t\tconst stackedArea = type == \"stackedarea\";\n\n\t\tif (type.indexOf(\"bar\") != -1 || stackedArea) {\n\t\t\tif (type.indexOf(\"stacked\") != -1) values.stacked = 1;\n\t\t\tif (type.indexOf(\"h\") != -1) values.horizontal = 1;\n\t\t\tvalues.type = stackedArea ? \"area\" : \"bar\";\n\t\t}\n\n\t\treturn values;\n\t}\n\tOutValues(values) {\n\t\tconst bar = values.type == \"bar\";\n\t\tif (bar || values.type == \"area\") {\n\t\t\tif (bar && values.horizontal) {\n\t\t\t\tvalues.type += \"H\";\n\t\t\t\tdelete values.horizontal;\n\t\t\t}\n\t\t\tif (values.stacked) {\n\t\t\t\tvalues.type =\n\t\t\t\t\t\"stacked\" + values.type[0].toUpperCase() + values.type.slice(1);\n\t\t\t\tdelete values.stacked;\n\t\t\t}\n\t\t}\n\n\t\treturn values;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class TableSettings extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"form\",\n\t\t\tpadding: 10,\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tname: \"cleanRows\",\n\t\t\t\t\tlocalId: \"cleanRows\",\n\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\tlabelRight: _(\"Clean rows\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"label\",\n\t\t\t\t\theight: 20,\n\t\t\t\t\tlabel: _(\"Highlight\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"minX\",\n\t\t\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\t\t\tlabelRight: _(\"Min X\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"maxX\",\n\t\t\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\t\t\tlabelRight: _(\"Max X\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"minY\",\n\t\t\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\t\t\tlabelRight: _(\"Min Y\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"maxY\",\n\t\t\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\t\t\tlabelRight: _(\"Max Y\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"label\",\n\t\t\t\t\theight: 20,\n\t\t\t\t\tlabel: _(\"Footer\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"radio\",\n\t\t\t\t\tname: \"footer\",\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ id: 1, value: _(\"Off\") },\n\t\t\t\t\t\t{ id: 2, value: _(\"On\") },\n\t\t\t\t\t\t{ id: 3, value: _(\"Sum Only\") },\n\t\t\t\t\t],\n\t\t\t\t\tvalue: 1,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"label\",\n\t\t\t\t\theight: 20,\n\t\t\t\t\tlabel: _(\"Total Column\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"radio\",\n\t\t\t\t\tname: \"totalColumn\",\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ id: 1, value: _(\"Off\") },\n\t\t\t\t\t\t{ id: 2, value: _(\"On\") },\n\t\t\t\t\t\t{ id: 3, value: _(\"Sum Only\") },\n\t\t\t\t\t],\n\t\t\t\t\tvalue: 1,\n\t\t\t\t},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonChange: (value, oldValue, source) => {\n\t\t\t\t\tif (source == \"user\") {\n\t\t\t\t\t\tconst out = this.OutValues(this.getRoot().getValues());\n\n\t\t\t\t\t\tthis.innerChange = true;\n\t\t\t\t\t\tthis.State.datatable = Object.assign({}, out);\n\t\t\t\t\t\tdelete this.innerChange;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\n\t\tthis.on(this.State.$changes, \"datatable\", datatable => {\n\t\t\tif (!this.innerChange) this.getRoot().setValues(this.InValues(datatable));\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"mode\", mode => {\n\t\t\tif (mode == \"table\") this.$$(\"cleanRows\").show();\n\t\t\telse this.$$(\"cleanRows\").hide();\n\t\t});\n\t}\n\tInValues(values) {\n\t\tvalues = webix.copy(values);\n\n\t\tif (values.footer) values.footer = values.footer == \"sumOnly\" ? 3 : 2;\n\t\telse values.footer = 1;\n\n\t\tif (values.totalColumn)\n\t\t\tvalues.totalColumn = values.totalColumn == \"sumOnly\" ? 3 : 2;\n\t\telse values.totalColumn = 1;\n\n\t\treturn values;\n\t}\n\tOutValues(values) {\n\t\tswitch (values.footer) {\n\t\t\tcase \"1\":\n\t\t\t\tdelete values.footer;\n\t\t\t\tbreak;\n\t\t\tcase \"2\":\n\t\t\t\tvalues.footer = true;\n\t\t\t\tbreak;\n\t\t\tcase \"3\":\n\t\t\t\tvalues.footer = \"sumOnly\";\n\t\t\t\tbreak;\n\t\t}\n\n\t\tswitch (values.totalColumn) {\n\t\t\tcase \"1\":\n\t\t\t\tdelete values.totalColumn;\n\t\t\t\tbreak;\n\t\t\tcase \"2\":\n\t\t\t\tvalues.totalColumn = true;\n\t\t\t\tbreak;\n\t\t\tcase \"3\":\n\t\t\t\tvalues.totalColumn = \"sumOnly\";\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn values;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class FilterView extends JetView {\n\tconfig() {\n\t\tthis.Local = this.app.getService(\"local\");\n\n\t\treturn {\n\t\t\tview: \"popup\",\n\t\t\tcss: \"webix_pivot_filter_popup\",\n\t\t\ttemplate: item => item.label,\n\t\t\tbody: {\n\t\t\t\tview: \"filter\",\n\t\t\t\tfield: \"value\",\n\t\t\t\ton: {\n\t\t\t\t\tonChange: config => {\n\t\t\t\t\t\tif (config == \"user\") {\n\t\t\t\t\t\t\tconst state = this.app.getState();\n\t\t\t\t\t\t\tconst structure = webix.copy(state.structure);\n\n\t\t\t\t\t\t\tlet value;\n\t\t\t\t\t\t\tstructure.filters = structure.filters.filter(filter => {\n\t\t\t\t\t\t\t\tconst exists = filter.name == this.field;\n\t\t\t\t\t\t\t\tconst inner = exists && !filter.external;\n\n\t\t\t\t\t\t\t\tif (inner) value = filter.value = this.filter.getValue();\n\n\t\t\t\t\t\t\t\treturn !exists || inner;\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tstate.structure = structure;\n\n\t\t\t\t\t\t\tthis.app.callEvent(\"filter:change\", [this.field, value]);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\tShow(pos, filterObj) {\n\t\tconst popup = this.getRoot();\n\t\tconst filter = (this.filter = popup.getBody());\n\t\tthis.field = filterObj.name;\n\t\tconst list = filter.getChildViews()[2];\n\n\t\tconst field = this.Local.getField(this.field);\n\n\t\tthis.Local.collectFieldValues(this.field).then(values => {\n\t\t\tlist.clearAll();\n\t\t\tlist.parse(webix.copy(values));\n\n\t\t\tfilter.define({ mode: field.type });\n\t\t\tfilter.config.value = \"\";\n\t\t\tfilter.setValue(webix.copy(filterObj.value || {}));\n\n\t\t\tpopup.show(pos);\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class ModeView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\");\n\n\t\tconst askin = webix.skin.$active;\n\t\tconst mini = webix.skin.$name == \"mini\" || webix.skin.$name == \"compact\";\n\t\tconst config = {\n\t\t\theight: askin.toolbarHeight,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"segmented\",\n\t\t\t\t\tlocalId: \"modes\",\n\t\t\t\t\talign: \"middle\",\n\t\t\t\t\tinputHeight: askin.inputHeight - askin.inputPadding * (mini ? 0 : 2),\n\t\t\t\t\toptionWidth: 80,\n\t\t\t\t\twidth: 244,\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ id: \"table\", value: _(\"Table\") },\n\t\t\t\t\t\t{ id: \"tree\", value: _(\"Tree\") },\n\t\t\t\t\t\t{ id: \"chart\", value: _(\"Chart\") },\n\t\t\t\t\t],\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: (v, o, c) => {\n\t\t\t\t\t\t\tif (c == \"user\") this.SetMode(v);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{ width: askin.dataPadding },\n\t\t\t],\n\t\t};\n\n\t\tif (this.Compact) {\n\t\t\tconfig.css = \"webix_pivot_footer\";\n\t\t\tconfig.cols[1].width = 0;\n\t\t\tconfig.cols.unshift({});\n\t\t}\n\n\t\treturn config;\n\t}\n\n\tinit() {\n\t\tthis.State = this.getParam(\"state\");\n\n\t\tthis.on(this.State.$changes, \"mode\", mode => {\n\t\t\tthis.$$(\"modes\").setValue(mode);\n\t\t});\n\t}\n\n\t/**\n\t * Sets Pivot mode\n\t * @param {string} desired mode (\"table\", \"tree\", \"data\")\n\t */\n\tSetMode(value) {\n\t\tthis.State.mode = value;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport ModeView from \"views/mode\";\nimport filterPopup from \"views/filter\";\n\nexport default class ToolbarView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\");\n\t\tthis.State = this.getParam(\"state\");\n\n\t\tlet config;\n\t\tif (this.Compact) {\n\t\t\tconfig = {\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"pt-settings\",\n\t\t\t\tinputHeight: webix.skin.$active.buttonHeight,\n\t\t\t\ton: {\n\t\t\t\t\tonItemClick: () => this.ToggleConfig(),\n\t\t\t\t},\n\t\t\t};\n\t\t} else {\n\t\t\tconst label = _(\"Configure Pivot\");\n\t\t\tconst css = \"webix_template webix_pivot_measure_size\";\n\n\t\t\t// 20px icon width and 8px additional padding\n\t\t\tconst width = 20 + 8 + webix.html.getTextSize(label, css).width;\n\t\t\tconfig = {\n\t\t\t\tview: \"template\",\n\t\t\t\tborderless: true,\n\t\t\t\twidth,\n\t\t\t\ttemplate: () => {\n\t\t\t\t\treturn `\n\t\t\t\t\t\t<span>${label}</span>\n\t\t\t\t\t\t<span class=\"pt-settings webix_pivot_toolbar_icon\"></span>`;\n\t\t\t\t},\n\t\t\t\tonClick: {\n\t\t\t\t\twebix_pivot_settings: () => this.ToggleConfig(),\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tconfig.localId = \"config\";\n\t\tconfig.css = \"webix_pivot_settings\";\n\t\tconfig.tooltip = _(\"Click to configure\");\n\n\t\tconst scrollSize = webix.env.$customScroll ? 0 : this._GetScrollWidth();\n\t\tconst height = webix.skin.$active.toolbarHeight + scrollSize;\n\n\t\tlet css = \"webix_pivot_toolbar\";\n\t\tif (scrollSize) {\n\t\t\twebix.html.addStyle(\n\t\t\t\t`.webix_pivot_bar_with_scroll .webix_pivot_settings>.webix_template{ line-height: ${height}px; }`\n\t\t\t);\n\t\t\tcss += \" webix_pivot_bar_with_scroll\";\n\t\t}\n\n\t\tconst result = {\n\t\t\tcss,\n\t\t\tmargin: this.Compact ? 12 : 0,\n\t\t\tpadding: {\n\t\t\t\tleft: this.Compact ? webix.skin.$active.inputPadding : 0,\n\t\t\t},\n\t\t\theight,\n\t\t\tcols: [config, this.GetFilters()],\n\t\t};\n\n\t\tif (!this.Compact) result.cols.push(ModeView);\n\n\t\treturn result;\n\t}\n\n\tinit() {\n\t\tthis.filterPopup = this.ui(filterPopup);\n\n\t\tthis.on(this.State.$changes, \"fields\", fields => {\n\t\t\tif (fields.length) {\n\t\t\t\t// render filters after fields set\n\t\t\t\tconst filtersView = this.$$(\"filters\").getParentView();\n\t\t\t\twebix.ui(this.GetFilters(), filtersView);\n\t\t\t}\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"structure\", (structure, old) => {\n\t\t\tif (old && this.FiltersChanged(structure, old)) {\n\t\t\t\tconst filtersView = this.$$(\"filters\").getParentView();\n\t\t\t\twebix.ui(this.GetFilters(), filtersView);\n\t\t\t}\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"readonly\", val => {\n\t\t\tthis.ToggleReadonly(val);\n\t\t});\n\t}\n\t/**\n\t * Compares filters when structure changes\n\t * @param {Object} structure - current structure\n\t * @param {Object} oldStructure - previous structure\n\t * @returns {boolean} result of comparison\n\t */\n\tFiltersChanged(structure, oldStructure) {\n\t\tif (structure.filters.length == oldStructure.filters.length) {\n\t\t\tfor (let i = 0; i < structure.filters.length; i++) {\n\t\t\t\tconst filter = structure.filters[i];\n\t\t\t\tconst old = oldStructure.filters[i];\n\t\t\t\tif (filter.name != old.name || filter.external != old.external)\n\t\t\t\t\treturn true;\n\t\t\t\tif (JSON.stringify(filter.value) != JSON.stringify(old.value))\n\t\t\t\t\treturn true;\n\t\t\t}\n\t\t} else return true;\n\n\t\treturn false;\n\t}\n\t/**\n\t * Toggles the configuration window\n\t */\n\tToggleConfig() {\n\t\tthis.State.config = !this.State.config;\n\t}\n\t/**\n\t * Controls visibility of a button with Pivot settings\n\t * @param {boolean} val - indicates whether Pivot is in a readonly mode\n\t */\n\tToggleReadonly(val) {\n\t\tif (val) this.$$(\"config\").hide();\n\t\telse this.$$(\"config\").show();\n\t}\n\t/**\n\t * Gets configuration for toolbar filters\n\t * @returns {Object} layout with all filters\n\t */\n\tGetFilters() {\n\t\tconst structure = this.State.structure;\n\t\tconst filters = [];\n\n\t\tif (this.State.fields.length)\n\t\t\t// toolbar renders before fields set\n\t\t\tstructure.filters.forEach(filter => {\n\t\t\t\tif (!filter.external) filters.push(this.FilterConfig(filter));\n\t\t\t});\n\n\t\tconst askin = webix.skin.$active;\n\t\tconst padding = (askin.toolbarHeight - askin.buttonHeight) / 2;\n\t\treturn {\n\t\t\tview: \"scrollview\",\n\t\t\tborderless: true,\n\t\t\tscroll: \"x\",\n\t\t\tbody: {\n\t\t\t\tmargin: 8,\n\t\t\t\tpadding: {\n\t\t\t\t\tleft: this.Compact ? 0 : 8,\n\t\t\t\t\ttop: padding + askin.inputPadding,\n\t\t\t\t\tbottom: padding + askin.inputPadding,\n\t\t\t\t},\n\t\t\t\tlocalId: \"filters\",\n\t\t\t\tcols: filters,\n\t\t\t},\n\t\t};\n\t}\n\t/**\n\t * Gets configuration a single toolbar filter\n\t * @param {Object} filter - filter object from structure\n\t * @returns {Object} filter UI\n\t */\n\tFilterConfig(filter) {\n\t\tconst label = this.app.getService(\"local\").getField(filter.name).value;\n\t\tconst css = \"webix_template webix_pivot_measure_size\";\n\n\t\t// 20px icon width and 8px additional padding\n\t\tconst width =\n\t\t\t(this.Compact ? 0 : 20 + 8) + webix.html.getTextSize(label, css).width;\n\t\treturn {\n\t\t\tview: \"template\",\n\t\t\tborderless: true,\n\t\t\twidth,\n\t\t\tcss: \"webix_pivot_filter\",\n\t\t\ttemplate: () => {\n\t\t\t\tconst value = filter.value;\n\t\t\t\tconst activeCss =\n\t\t\t\t\tvalue && (value.includes || value.condition.filter)\n\t\t\t\t\t\t? \"webix_pivot_active_filter\"\n\t\t\t\t\t\t: \"\";\n\t\t\t\tconst icon = !this.Compact\n\t\t\t\t\t? \"<span class='pt-filter webix_pivot_toolbar_icon'></span>\"\n\t\t\t\t\t: \"\";\n\t\t\t\treturn `<div class=\"webix_pivot_filter_inner ${activeCss}\">\n\t\t\t\t\t<span>${label}</span>\n\t\t\t\t\t${icon}\n\t\t\t\t</div>`;\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_pivot_filter: function() {\n\t\t\t\t\tthis.$scope.filterPopup.Show(this.$view, filter);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\t_GetScrollWidth() {\n\t\tconst outer = webix.html.create(\"DIV\", {\n\t\t\tstyle: \"visibility:hidden;overflow:scroll;\",\n\t\t});\n\t\tconst inner = webix.html.create(\"DIV\");\n\n\t\tdocument.body.appendChild(outer);\n\t\touter.appendChild(inner);\n\n\t\tconst scrollbarWidth = outer.offsetWidth - inner.offsetWidth;\n\n\t\touter.parentNode.removeChild(outer);\n\t\treturn scrollbarWidth;\n\t}\n}\n","import m0 from \"views/chart\";\nimport m1 from \"views/config/index.js\";\nimport m2 from \"views/config/popup\";\nimport m3 from \"views/config/properties/chart\";\nimport m4 from \"views/config/properties/group\";\nimport m5 from \"views/config/properties/index.js\";\nimport m6 from \"views/config/properties/table\";\nimport m7 from \"views/config/properties/values\";\nimport m8 from \"views/filter\";\nimport m9 from \"views/main\";\nimport m10 from \"views/mode\";\nimport m11 from \"views/table\";\nimport m12 from \"views/toolbar\";\nimport { JetView } from \"webix-jet\";\n\nconst views = { JetView };\nviews[\"chart\"] = m0;\nviews[\"config\"] = m1;\nviews[\"config/popup\"] = m2;\nviews[\"config/properties/chart\"] = m3;\nviews[\"config/properties/group\"] = m4;\nviews[\"config/properties\"] = m5;\nviews[\"config/properties/table\"] = m6;\nviews[\"config/properties/values\"] = m7;\nviews[\"filter\"] = m8;\nviews[\"main\"] = m9;\nviews[\"mode\"] = m10;\nviews[\"table\"] = m11;\nviews[\"toolbar\"] = m12;\n\nexport default views;\n","import { JetView } from \"webix-jet\";\n\nexport default class ChartView extends JetView {\n\tconfig() {\n\t\tconst state = (this.State = this.getParam(\"state\", true));\n\n\t\tconst chart = {\n\t\t\tview: \"chart\",\n\t\t\t$mainView: true,\n\t\t\tborderless: true,\n\t\t\tlocalId: \"data\",\n\t\t\txAxis: {},\n\t\t\tyAxis: {},\n\t\t};\n\n\t\twebix.extend(chart, webix.copy(state.chart), true);\n\n\t\tconst type = chart.type;\n\t\tif (type == \"barH\" || type == \"stackedBarH\") {\n\t\t\tif (!chart.yAxis.template)\n\t\t\t\tchart.yAxis.template = obj => obj[obj.length - 1];\n\t\t} else if (!chart.xAxis.template)\n\t\t\tchart.xAxis.template = obj => obj[obj.length - 1];\n\n\t\tconst commonAxisSettings = {\n\t\t\tlines: chart.lines,\n\t\t};\n\n\t\t//save default chart line color\n\t\tif (chart.scaleColor)\n\t\t\tcommonAxisSettings.color = commonAxisSettings.lineColor =\n\t\t\t\tchart.scaleColor;\n\n\t\twebix.extend(chart.xAxis, commonAxisSettings, true);\n\t\twebix.extend(chart.yAxis, commonAxisSettings, true);\n\n\t\tif (this.IsPieBased()) {\n\t\t\twebix.extend(\n\t\t\t\tchart,\n\t\t\t\t{\n\t\t\t\t\tmultilevel: true,\n\t\t\t\t\ttooltip: this.ValueFormat,\n\t\t\t\t\tcolor: \"#color#\",\n\t\t\t\t\ttype: type + (chart[\"3D\"] ? \"3D\" : \"\"),\n\t\t\t\t\tpieInnerText: chart[\"pieInnerText\"] ? this.ValueFormat : \"\",\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\n\t\treturn chart;\n\t}\n\n\tinit() {\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tthis.LoadData();\n\n\t\tthis.on(this.State.$changes, \"structure\", (structure, old) => {\n\t\t\tif (old) this.LoadData();\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"chart\", (val, o) => {\n\t\t\tif (o) this.refresh();\n\t\t});\n\t}\n\t/**\n\t * Loads data to a chart\n\t * @returns {Promise} promise that resolves when data is parsed\n\t */\n\tLoadData() {\n\t\treturn this.Local.getData().then(data => {\n\t\t\tthis.UpdateChart(data);\n\t\t});\n\t}\n\t/**\n\t * Updates chart data\n\t * @param {Array} data - array of data\n\t */\n\tUpdateChart(data) {\n\t\tthis.$$(\"data\").clearAll();\n\n\t\tif (!this.IsPieBased()) {\n\t\t\tthis.$$(\"data\").removeAllSeries();\n\t\t\tthis.SetSeries(data.values);\n\t\t}\n\n\t\tthis.SetLegend(data.values);\n\t\tthis.$$(\"data\").parse(data.data);\n\t}\n\t/**\n\t * Checks if chart is pie based\n\t * @param {string} type (optional) - chart type\n\t * @returns {boolean} is pie based\n\t */\n\tIsPieBased(type) {\n\t\tif (!type) type = this.State.chart.type;\n\t\treturn type == \"pie\" || type == \"donut\";\n\t}\n\t/**\n\t * Sets chart series\n\t * @param {Array} values - array of values for series\n\t */\n\tSetSeries(values) {\n\t\tfor (let i = 0; i < values.length; i++)\n\t\t\tthis.$$(\"data\").addSeries(this.GetSeriesConfig(values[i], i));\n\t}\n\t/**\n\t * Prepares chart series\n\t * @param {object} settings - values for series\n\t * @param {number} i - index\n\t * @param {string} type - chart type (customizations)\n\t */\n\tGetSeriesConfig(settings, i, type) {\n\t\ttype = type || this.State.chart.type;\n\t\treturn {\n\t\t\ttype,\n\t\t\tvalue: obj => obj[i],\n\t\t\talpha: type == \"area\" || type == \"splineArea\" ? 0.7 : 1,\n\t\t\tcolor: settings.color,\n\t\t\ttooltip: obj => this.ValueFormat({ value: obj[i] }),\n\t\t\titem: {\n\t\t\t\tcolor: settings.color,\n\t\t\t\tborderColor: settings.color,\n\t\t\t},\n\t\t\tline: {\n\t\t\t\tcolor: settings.color,\n\t\t\t},\n\t\t};\n\t}\n\t/**\n\t * Prepares and sets chart legend\n\t * @param {Array} values - array of values for legend\n\t */\n\tSetLegend(values) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tvalues = values.map(v => {\n\t\t\tconst operation = v.operation;\n\t\t\tlet text = v.text;\n\t\t\tif (operation == \"complex\") text = this.Local.fixMath(text);\n\t\t\telse if (operation) {\n\t\t\t\ttext = text\n\t\t\t\t\t.split(\",\")\n\t\t\t\t\t.map(t => this.Local.getField(t).value)\n\t\t\t\t\t.join(\", \");\n\t\t\t\ttext = `${text} (${_(operation)})`;\n\t\t\t}\n\t\t\treturn { color: v.color, text };\n\t\t});\n\n\t\tconst legend = webix.extend(\n\t\t\t{\n\t\t\t\tvalues,\n\t\t\t\tvalign: \"middle\",\n\t\t\t\talign: \"right\",\n\t\t\t\tlayout: \"y\",\n\t\t\t},\n\t\t\tthis.State.chart.legend || {},\n\t\t\ttrue\n\t\t);\n\t\tthis.$$(\"data\").define({ legend });\n\t}\n\t/**\n\t * Formats tooltip values / inner text\n\t * @param {object} item - data item\n\t * @returns {number} formatted value\n\t */\n\tValueFormat(item) {\n\t\treturn item.text || parseFloat(item.value || 0).toFixed(3);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport Property from \"views/config/properties\";\nimport ValuesProperty from \"views/config/properties/values\";\nimport GroupProperty from \"views/config/properties/group\";\nimport ChartSettings from \"views/config/properties/chart\";\nimport TableSettings from \"views/config/properties/table\";\n\nexport default class ConfigView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tthis.State = this.app.getState();\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tconst toolbar = {\n\t\t\ttype: \"form\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: 16,\n\t\t\t\tright: 14, //button\n\t\t\t\ttop: 8,\n\t\t\t\tbottom: 4,\n\t\t\t},\n\t\t\tcols: [\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tlabel: _(\"Done\"),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tautowidth: true,\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tclick: () => this.ToggleForm(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst structure = {\n\t\t\tborderless: true,\n\t\t\tview: \"scrollview\",\n\t\t\tscroll: \"y\",\n\t\t\tbody: {\n\t\t\t\tview: \"accordion\",\n\t\t\t\tcss: \"webix_pivot_configuration\",\n\t\t\t\tlocalId: \"settings\",\n\t\t\t\tmulti: true,\n\t\t\t\ttype: \"space\",\n\t\t\t\tpadding: {\n\t\t\t\t\tleft: 16,\n\t\t\t\t\tright: 16,\n\t\t\t\t\ttop: 4,\n\t\t\t\t\tbottom: 16,\n\t\t\t\t},\n\t\t\t\tmargin: 20,\n\t\t\t\trows: [\n\t\t\t\t\tthis.GroupConfig(\n\t\t\t\t\t\t_(\"Rows\"),\n\t\t\t\t\t\t\"pt-rows\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"rows\",\n\t\t\t\t\t\t\t$subview: new Property(this.app, \"\", {\n\t\t\t\t\t\t\t\tfield: \"rows\",\n\t\t\t\t\t\t\t\tplusLabel: _(\"Add row\"),\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"table\"\n\t\t\t\t\t),\n\t\t\t\t\tthis.GroupConfig(\n\t\t\t\t\t\t_(\"Columns\"),\n\t\t\t\t\t\t\"pt-columns\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"columns\",\n\t\t\t\t\t\t\t$subview: new Property(this.app, \"\", {\n\t\t\t\t\t\t\t\tfield: \"columns\",\n\t\t\t\t\t\t\t\tplusLabel: _(\"Add column\"),\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"table\"\n\t\t\t\t\t),\n\t\t\t\t\tthis.GroupConfig(_(\"Values\"), \"pt-values\", {\n\t\t\t\t\t\tname: \"values\",\n\t\t\t\t\t\t$subview: ValuesProperty,\n\t\t\t\t\t}),\n\t\t\t\t\tthis.GroupConfig(\n\t\t\t\t\t\t_(\"Group By\"),\n\t\t\t\t\t\t\"pt-group\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"groupBy\",\n\t\t\t\t\t\t\t$subview: GroupProperty,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"chart\"\n\t\t\t\t\t),\n\t\t\t\t\tthis.GroupConfig(_(\"Filters\"), \"pt-filter\", {\n\t\t\t\t\t\tname: \"filters\",\n\t\t\t\t\t\t$subview: new Property(this.app, \"\", {\n\t\t\t\t\t\t\tfield: \"filters\",\n\t\t\t\t\t\t\tplusLabel: _(\"Add filter\"),\n\t\t\t\t\t\t}),\n\t\t\t\t\t}),\n\t\t\t\t\tthis.GroupConfig(\n\t\t\t\t\t\t_(\"Chart\"),\n\t\t\t\t\t\t\"pt-chart\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$subview: ChartSettings,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"chart\"\n\t\t\t\t\t),\n\t\t\t\t\tthis.GroupConfig(\n\t\t\t\t\t\t_(\"Table\"),\n\t\t\t\t\t\t\"wxi-columns\",\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$subview: TableSettings,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"table\"\n\t\t\t\t\t),\n\t\t\t\t\t{},\n\t\t\t\t],\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tmargin: 0,\n\t\t\trows: [toolbar, structure],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.on(this.State.$changes, \"readonly\", (_v, o) => {\n\t\t\tif (!webix.isUndefined(o)) this.ToggleForm();\n\t\t});\n\t}\n\n\tready() {\n\t\tthis.on(this.app, \"property:change\", (field, value) => {\n\t\t\tthis.HandleFieldChange(field, value);\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"structure\", () => {\n\t\t\tif (!this.innerChange) this.SetValues();\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"mode\", (mode, oldMode) => {\n\t\t\tconst isChart = mode == \"chart\";\n\n\t\t\tthis.$$(\"settings\").showBatch(isChart ? \"chart\" : \"table\");\n\n\t\t\t//columns can be updated in structure via groupBy\n\t\t\tif (oldMode && (isChart || oldMode == \"chart\")) this.SetValues();\n\t\t});\n\t}\n\t/** Toggles configuration form */\n\tToggleForm() {\n\t\tthis.State.config = !this.State.config;\n\t}\n\t/** Sets values into a  configuration form */\n\tSetValues() {\n\t\tconst structure = this.State.structure;\n\t\tconst inputs = [\"rows\", \"columns\", \"values\", \"filters\", \"groupBy\"];\n\n\t\tinputs.forEach(input => {\n\t\t\tconst value = structure[input] || this.State[input];\n\t\t\tconst view = this.getSubView(input);\n\t\t\tview.SetValue(value);\n\t\t});\n\t}\n\t/**\n\t * Applies changes in form fields to data structure\n\t * @param {string} field - field name\n\t * @param {string|Array} value - field value\n\t */\n\tHandleFieldChange(field, value) {\n\t\tconst structure = webix.copy(this.State.structure);\n\n\t\tif (field == \"filters\") value = this.CorrectFilters(structure, value);\n\t\telse this.CorrectInputs(structure, field, value);\n\n\t\tstructure[field] = value;\n\t\tthis.innerChange = true;\n\t\tthis.app.setStructure(structure);\n\t\tdelete this.innerChange;\n\t}\n\t/**\n\t * Prepares configuration for an accordion item with form fields\n\t * @param {string} name - accordion item header name\n\t * @param {string} icon - accordion item icon\n\t * @param {Object} config - object with form fields for this accordion item\n\t * @param {string} batch - batch name, used to control visibility\n\t * @returns {Object} configuration of the accordion item body\n\t */\n\tGroupConfig(name, icon, config, batch) {\n\t\treturn {\n\t\t\tbatch,\n\t\t\theader: `\n\t\t\t\t<span class=\"webix_icon webix_pivot_config_icon ${icon}\"></span>\n\t\t\t\t<span class=\"webix_pivot_config_label\">${name}</span>\n\t\t\t`,\n\t\t\tbody: config,\n\t\t\tborderless: true,\n\t\t};\n\t}\n\t/** Returns an object with fields that need to be corrected when some field changes */\n\tGetCorrections() {\n\t\treturn {\n\t\t\trows: [\"columns\", \"values\", \"groupBy\"],\n\t\t\tcolumns: [\"rows\", \"values\"],\n\t\t\tvalues: [\"rows\", \"columns\", \"groupBy\"],\n\t\t\tgroupBy: [\"rows\", \"values\"],\n\t\t};\n\t}\n\t/**\n\t * Prepares filters before applying them to data structure\n\t * @param {Object} structure - a copy of the current data structure\n\t * @param {Array} value - \"filters\" field value\n\t */\n\tCorrectFilters(structure, value) {\n\t\tfor (let i = 0; i < value.length; i++) {\n\t\t\tconst active = structure.filters.find(filter => {\n\t\t\t\tif (filter.name == value[i]) return true;\n\t\t\t});\n\t\t\tvalue[i] = { name: value[i] };\n\t\t\tif (active && !active.external) value[i].value = active.value;\n\t\t}\n\n\t\tconst external = structure.filters.filter(filter => filter.external);\n\t\tvalue = value.concat(external);\n\n\t\treturn value;\n\t}\n\t/**\n\t * Prepares form fields before applying them to data structure\n\t * @param {Object} structure - a copy of the current data structure\n\t * @param {string} field -  field name\n\t * @param {string|Array} value -  field value\n\t */\n\tCorrectInputs(structure, field, value) {\n\t\tconst inputs = this.GetCorrections()[field];\n\n\t\tif (inputs) {\n\t\t\tif (typeof value == \"string\") value = [value];\n\n\t\t\tvalue = value.map(v => (v.name ? v.name : v));\n\n\t\t\tinputs.forEach(input => {\n\t\t\t\tconst view = this.getSubView(input);\n\t\t\t\tlet values = view.GetValue();\n\n\t\t\t\tif (typeof values == \"string\") {\n\t\t\t\t\tif (value.find(v => v == values)) values = \"\";\n\t\t\t\t} else\n\t\t\t\t\tvalues = values.filter(v => {\n\t\t\t\t\t\tif (v.name) v = v.name;\n\n\t\t\t\t\t\treturn value.indexOf(v) == -1;\n\t\t\t\t\t});\n\n\t\t\t\tstructure[input] = values;\n\t\t\t\tview.SetValue(values);\n\t\t\t});\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class Popup extends JetView {\n\tconfig() {\n\t\treturn this.app.getService(\"jet-win\").updateConfig({\n\t\t\tview: \"window\",\n\t\t\tborderless: true,\n\t\t\tfullscreen: true,\n\t\t\thead: false,\n\t\t\tbody: { $subview: true },\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport ModeView from \"views/mode\";\nimport ToolbarView from \"views/toolbar\";\n\nimport { initRLayout } from \"@xbs/jet-helpers\";\n\nexport default class MainView extends JetView {\n\tconfig() {\n\t\tinitRLayout();\n\n\t\tconst fCompact = this.getParam(\"forceCompact\");\n\t\tif (!webix.isUndefined(fCompact)) this.setParam(\"compact\", fCompact);\n\t\tthis.Compact = this.getParam(\"compact\");\n\n\t\tconst rows = [\n\t\t\tToolbarView,\n\t\t\t{\n\t\t\t\tview: \"r-layout\",\n\t\t\t\tlocalId: \"main\",\n\t\t\t\tcols: [{ $subview: true }],\n\t\t\t},\n\t\t];\n\n\t\tif (this.Compact) {\n\t\t\trows.push(ModeView, {\n\t\t\t\t$subview: true,\n\t\t\t\tname: \"edit\",\n\t\t\t\tpopup: true,\n\t\t\t});\n\t\t} else {\n\t\t\trows[1].cols.push({\n\t\t\t\tview: \"proxy\",\n\t\t\t\tmaxWidth: 450,\n\t\t\t\tlocalId: \"edit\",\n\t\t\t\tcss: \"webix_pivot_config_container webix_shadow_medium\",\n\t\t\t\tborderless: true,\n\t\t\t\thidden: true,\n\t\t\t\tbody: { $subview: true, name: \"edit\" },\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tmargin: 0,\n\t\t\trows,\n\t\t\tview: webix.isUndefined(fCompact) ? \"r-layout\" : \"layout\",\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst state = this.getParam(\"state\");\n\n\t\tthis.$$(\"main\").sizeTrigger(\n\t\t\tthis.app,\n\t\t\tmode => this.SetCompactMode(mode),\n\t\t\t!!this.Compact\n\t\t);\n\n\t\tthis.on(state.$changes, \"mode\", mode => {\n\t\t\tthis.show(\"./\" + (mode == \"chart\" ? \"chart\" : \"table\"));\n\t\t});\n\n\t\tthis.on(state.$changes, \"config\", val => {\n\t\t\tif (val) this.ShowConfig();\n\t\t\telse this.HideConfig();\n\t\t});\n\t}\n\n\t/** Shows configuration window*/\n\tShowConfig() {\n\t\tif (this.Compact) {\n\t\t\tthis.show(\"config.popup/config\", {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t} else {\n\t\t\tthis.$$(\"edit\").show();\n\t\t\tthis.show(\"config\", {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t}\n\t}\n\n\t/** Hides configuration window*/\n\tHideConfig() {\n\t\t// we need to destroy the view inside first\n\t\tthis.show(\"_blank\", { target: \"edit\" });\n\n\t\tif (!this.Compact) this.$$(\"edit\").hide();\n\t}\n\n\tSetCompactMode(mode) {\n\t\t//let it render, then recreate\n\t\twebix.delay(() => {\n\t\t\tthis.setParam(\"compact\", mode);\n\t\t\tif (!mode) webix.fullscreen.exit();\n\t\t\tthis.refresh();\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class TableView extends JetView {\n\tconfig() {\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tconst state = (this.State = this.getParam(\"state\", true));\n\t\tconst rows = state.structure.rows.length;\n\n\t\tconst table = {\n\t\t\tview: \"treetable\",\n\t\t\t$mainView: true,\n\t\t\tlocalId: \"data\",\n\t\t\tcss: \"webix_data_border webix_header_border\",\n\t\t\tselect: true,\n\t\t\tleftSplit: state.mode == \"table\" ? rows : rows ? 1 : 0,\n\t\t\tresizeColumn: true,\n\t\t\tborderless: true,\n\t\t\tcolumns: [],\n\t\t\tfooter: state.datatable.footer,\n\t\t};\n\n\t\twebix.extend(table, state.datatable, true);\n\n\t\treturn table;\n\t}\n\n\tinit() {\n\t\tthis.LoadData();\n\n\t\tthis.on(this.State.$changes, \"structure\", (structure, old) => {\n\t\t\tif (old) this.LoadData();\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"datatable\", (val, o) => {\n\t\t\tif (o) this.refresh();\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"mode\", (val, o) => {\n\t\t\tif (o && o != \"chart\" && val != \"chart\") this.refresh();\n\t\t});\n\t}\n\t/**\n\t * Loads data to a table\n\t * @returns {Promise} promise that resolves when data is parsed\n\t */\n\tLoadData() {\n\t\treturn this.Local.getData().then(data => {\n\t\t\tthis.UpdateTable(data);\n\t\t});\n\t}\n\t/**\n\t * Updates table data\n\t * @param {Array} data - array of data\n\t */\n\tUpdateTable(data) {\n\t\tconst state = this.State;\n\t\tconst structure = state.structure;\n\n\t\tconst freeze = this.CheckFreeze();\n\n\t\tlet rightSplit = 0;\n\t\tconst totalCols = state.datatable.totalColumn;\n\t\tlet totalOps;\n\t\tif (totalCols) {\n\t\t\tconst vals = structure.values;\n\t\t\ttotalOps =\n\t\t\t\ttotalCols == \"sumOnly\" ? vals.filter(v => v.operation == \"sum\") : vals;\n\t\t\tif (freeze) rightSplit = totalOps.length;\n\t\t}\n\n\t\tlet leftSplit = 0;\n\t\tif (freeze) {\n\t\t\tconst rows = structure.rows.length;\n\t\t\tleftSplit = state.mode == \"table\" ? rows : rows ? 1 : 0;\n\t\t}\n\n\t\tif (!data.$ready) {\n\t\t\tconst total = data.totalColumn;\n\t\t\tlet lastId;\n\n\t\t\tif (total) {\n\t\t\t\tlastId = data.header[data.header.length - 1].id;\n\n\t\t\t\tfor (let i = 0; i < totalOps.length; i++) {\n\t\t\t\t\tlet name = totalOps[i].name;\n\t\t\t\t\tif (webix.isArray(name)) name = name.join();\n\n\t\t\t\t\tdata.header.push({\n\t\t\t\t\t\theader: [\n\t\t\t\t\t\t\t{ name: \"total\", colspan: rightSplit },\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext: name || totalOps[i].operation,\n\t\t\t\t\t\t\t\toperation: totalOps[i].operation,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t\tid: lastId + i + 1,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst totalIndex = { i: 0 };\n\t\t\tdata = this.Local._store = {\n\t\t\t\tdata: data.data.map(item =>\n\t\t\t\t\tthis._prepareData(item, total, totalIndex, lastId)\n\t\t\t\t),\n\t\t\t\tcolumns: this.SetColumns(data.header, data.footer, data.marks),\n\t\t\t\t$ready: 1,\n\t\t\t};\n\t\t}\n\n\t\tconst table = this.$$(\"data\");\n\t\ttable.clearAll();\n\t\ttable.define({ leftSplit, rightSplit }, true);\n\t\ttable.refreshColumns(data.columns);\n\t\ttable.parse(data.data);\n\t}\n\t/**\n\t * Prepares table item (updates id, adds total cols, etc.)\n\t * @param {Array} obj - data item\n\t * @param {Array} total - array with total values for columns\n\t * @param {Object} index - current total index\n\t * @param {number} lastId - last column id\n\t * @returns {Proxy} prepared item\n\t */\n\t_prepareData(obj, total, index, lastId) {\n\t\tconst table = this.State.mode == \"table\";\n\t\tlet totalIndex;\n\n\t\tif (table || (total && !obj.data)) totalIndex = index.i++;\n\n\t\tconst item = new Proxy(obj, {\n\t\t\tget: (item, prop) => {\n\t\t\t\tif (prop == \"data\") return item.vals;\n\t\t\t\tif (table && prop == \"id\") return totalIndex + 1;\n\n\t\t\t\tconst id = prop * 1;\n\t\t\t\tif (!isNaN(id)) {\n\t\t\t\t\tconst vals = typeof item.values == \"object\" ? item.values : item;\n\n\t\t\t\t\tif (total && id > lastId && (totalIndex || totalIndex === 0)) {\n\t\t\t\t\t\treturn total[totalIndex][id - lastId - 1];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn vals[id - 1];\n\t\t\t\t}\n\n\t\t\t\treturn item[prop];\n\t\t\t},\n\t\t});\n\n\t\tif (obj.data) {\n\t\t\titem.open = true;\n\t\t\titem.vals = obj.data.map(r => {\n\t\t\t\treturn this._prepareData(r, total, index, lastId);\n\t\t\t});\n\t\t}\n\n\t\treturn item;\n\t}\n\t/**\n\t * Checks if columns should be frozen\n\t */\n\tCheckFreeze() {\n\t\tconst freezeColumns = this.app.config.freezeColumns;\n\t\tconst compact = this.getParam(\"compact\", true);\n\n\t\treturn webix.isUndefined(freezeColumns) ? !compact : freezeColumns;\n\t}\n\t/**\n\t * Prepares table columns\n\t * @param {Array} columns - array with columns\n\t * @param {Array} footer - array with total values for columns\n\t * @param {Array} marks - array with min/max marks for columns\n\t * @returns {Array} column configurations\n\t */\n\tSetColumns(columns, footer, marks) {\n\t\tcolumns = webix.copy(columns);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst rows = this.State.structure.rows.length;\n\t\tconst left = this.State.mode == \"table\" ? rows : rows ? 1 : 0;\n\n\t\tfor (let i = 0; i < columns.length; i++) {\n\t\t\tif (i < left) {\n\t\t\t\tthis.SetFirstColumn(columns[i], !i && this.State.datatable.footer, _);\n\t\t\t} else {\n\t\t\t\tcolumns[i].sort = \"int\";\n\n\t\t\t\tif (!columns[i].format) columns[i].format = this.CellFormat;\n\n\t\t\t\tif (marks.length)\n\t\t\t\t\tcolumns[i].cssFormat = (v, row, rid, cid) => {\n\t\t\t\t\t\tconst col = marks[rid - 1];\n\t\t\t\t\t\tconst css = col ? col[cid - 1] : null;\n\t\t\t\t\t\treturn css ? css.join(\" \") : \"\";\n\t\t\t\t\t};\n\n\t\t\t\tconst header = columns[i].header;\n\t\t\t\tfor (let j = 0; j < header.length; j++) {\n\t\t\t\t\tlet h = header[j];\n\t\t\t\t\tif (h) {\n\t\t\t\t\t\tif (!j && h.name == \"total\") {\n\t\t\t\t\t\t\th.text = _(\"Total\");\n\t\t\t\t\t\t} else if (j == header.length - 1) {\n\t\t\t\t\t\t\th.text = this.HeaderTemplate(h, _);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (footer.length) {\n\t\t\t\t\tcolumns[i].footer = this.CellFormat(footer[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn columns;\n\t}\n\t/**\n\t * Prepares first column\n\t * @param {Object} column - column configuration\n\t * @param {boolean} footer - column with footer name\n\t * @param {function} _ - function for translating text labels\n\t */\n\tSetFirstColumn(column, footer, _) {\n\t\tif (this.State.mode == \"tree\") {\n\t\t\tcolumn.header = {\n\t\t\t\ttext: this.State.structure.rows\n\t\t\t\t\t.map(field => this.Local.getField(field).value)\n\t\t\t\t\t.join(\"<span class='webix_icon wxi-angle-right'></span>\"),\n\t\t\t\tcss: \"webix_pivot_tree_header\",\n\t\t\t};\n\t\t\tcolumn.width = 300;\n\t\t\tcolumn.template = (obj, common) => {\n\t\t\t\treturn common.treetable(obj, common) + obj[1];\n\t\t\t};\n\t\t} else {\n\t\t\tcolumn.header = this.Local.getField(column.header[0].text).value;\n\t\t\tcolumn.width = 200;\n\t\t}\n\t\tif (footer) column.footer = _(\"Total\");\n\t}\n\t/**\n\t * Sets a template for column header\n\t * @param {Object} line - object with header line properties\n\t * @param {function} _ - function for translating text labels\n\t * @returns {string} string with header text\n\t */\n\tHeaderTemplate(line, _) {\n\t\tif (!line.operation || line.operation == \"complex\")\n\t\t\treturn this.Local.fixMath(line.text);\n\t\telse {\n\t\t\tlet text = line.text.split(\",\");\n\t\t\ttext = text.map(t => this.Local.getField(t).value).join(\", \");\n\t\t\treturn `${text} <span class=\"webix_pivot_operation\">${_(\n\t\t\t\tline.operation\n\t\t\t)}</span>`;\n\t\t}\n\t}\n\t/**\n\t * Formats a cell value\n\t * @param {(number|string)} value - raw value\n\t * @returns {(number|string)} formatted value\n\t */\n\tCellFormat(value) {\n\t\tif (!value) value = value === 0 ? \"0\" : \"\";\n\n\t\treturn value ? parseFloat(value).toFixed(3) : value;\n\t}\n}\n","const asc = (a, b) => (a.key > b.key ? 1 : -1);\nconst desc = (a, b) => (a.key < b.key ? 1 : -1);\nclass DataDimension {\n    constructor(table, getValue, label, meta, sort) {\n        if (sort === \"desc\") {\n            this._sort = desc;\n        }\n        else if (sort === \"asc\") {\n            this._sort = asc;\n        }\n        else if (sort) {\n            this._sort = (a, b) => sort(a.key, b.key);\n        }\n        this._label = label;\n        this._meta = meta || null;\n        this._table = table;\n        this._getter = getValue;\n        this._prepared = 0;\n    }\n    getIndexes() {\n        return this._indexes;\n    }\n    getValue(i) {\n        return this._values[i].key;\n    }\n    getSize() {\n        return this._values.length;\n    }\n    getLabel() {\n        return this._label;\n    }\n    getOptions() {\n        this._prepareOptions();\n        return this._values.map(a => a.key);\n    }\n    getMeta() {\n        return this._meta;\n    }\n    reset() {\n        this._prepared = 0;\n    }\n    prepare() {\n        // eslint-disable-next-line\n        if (this._prepared & 1)\n            return;\n        // eslint-disable-next-line\n        this._prepared = this._prepared | 1;\n        this._prepareOptions();\n        const { _table, _getter, _keys } = this;\n        const fSize = _table.count();\n        this._values.forEach((a, i) => (a.index = i));\n        const indexes = (this._indexes = new Array(fSize));\n        for (let i = 0; i < fSize; i++) {\n            const key = _getter(i);\n            indexes[i] = _keys.get(key).index;\n        }\n    }\n    _prepareOptions() {\n        // eslint-disable-next-line\n        if (this._prepared & 2)\n            return;\n        // eslint-disable-next-line\n        this._prepared = this._prepared | 2;\n        const { _table, _getter } = this;\n        const fSize = _table.count();\n        const keys = (this._keys = new Map());\n        const values = (this._values = []);\n        for (let i = 0; i < fSize; i++) {\n            const key = _getter(i);\n            const index = keys.get(key);\n            if (typeof index === \"undefined\") {\n                keys.set(key, (values[values.length] = { key, index: 0 }));\n            }\n        }\n        if (this._sort)\n            values.sort(this._sort);\n    }\n}\n\nclass DataExport {\n    constructor(pivot) {\n        this._pivot = pivot;\n    }\n    toArray({ cleanRows, filters, ops }) {\n        const out = [];\n        const limit = this._pivot.getLimit();\n        const maxRow = limit.rows || 0;\n        this._pivot.filter(filters);\n        this._pivot.operations(ops);\n        this._pivot.resetCursor();\n        let count = 0;\n        const header = new Set();\n        const rAggr = new Map();\n        const rowData = [];\n        // eslint-disable-next-line\n        while (true) {\n            const cAggr = {};\n            const row = this._pivot.next(header, out.length, rAggr, cAggr);\n            if (!row)\n                break;\n            out.push(row);\n            rowData.push(cAggr);\n            count++;\n            if (maxRow === count)\n                break;\n        }\n        const [scaleWidth, width] = this._pivot.getWidth();\n        if (cleanRows)\n            this._cleanRows(out, scaleWidth);\n        const result = {\n            data: out,\n            columns: Array.from(header).sort((a, b) => (a > b ? 1 : -1)),\n            width: width + scaleWidth,\n            scaleWidth,\n            rowData,\n        };\n        result.columnData = this._pivot.aggregateColumns(result, rAggr);\n        result.marks = this._pivot.mark(result, rAggr);\n        return result;\n    }\n    toNested({ filters, ops }) {\n        this._pivot.filter(filters);\n        this._pivot.operations(ops);\n        this._pivot.resetCursor();\n        const rAggr = new Map();\n        const result = this._pivot.nested(rAggr);\n        result.columnData = this._pivot.aggregateColumns(result, rAggr);\n        result.marks = this._pivot.mark(result, rAggr);\n        return result;\n    }\n    toXHeader(data, config) {\n        return this._pivot.getXHeader(data, config);\n    }\n    _cleanRows(data, rowsLength) {\n        const count = data.length;\n        const prev = new Array(rowsLength);\n        for (let j = 0; j < count; j++) {\n            const row = data[j];\n            for (let i = 0; i < rowsLength; i++) {\n                if (prev[i] !== row[i]) {\n                    for (let j = i; j < rowsLength; j++)\n                        prev[j] = row[j];\n                    break;\n                }\n                row[i] = \"\";\n            }\n        }\n    }\n}\n\nfunction t(t,e){let n=\"\";const o=t.length;let r=0,i=!1,s=!1,u=0;for(;r<o;){const o=t[r];if(r++,'\"'===o)i?n+=t.substr(u,r-u):u=r-1,i=!i;else {if(i)continue;const c=\",\"===o||\"/\"===o||\"*\"===o||\"+\"===o||\"-\"===o||\"(\"===o||\")\"===o,f=\" \"===o||\"\\t\"===o||\" \\n\"===o||\"\\r\"===o;if(s){if(!c&&!f)continue;{const i=t.substr(u,r-u-1);n+=\"(\"===o?e.method(i):e.property(i),s=!1;}}if(f)continue;if(c)n+=o;else {\"0\"===o||\"1\"===o||\"2\"===o||\"3\"===o||\"4\"===o||\"5\"===o||\"6\"===o||\"7\"===o||\"8\"===o||\"9\"===o?n+=o:(s=!0,u=r-1);}}}return s&&(n+=e.property(t.substr(u,r-u))),n}function e(e,n){return new Function(n.propertyName,n.methodName,n.contextName,\"return \"+t(e,n))}\n\nfunction optimize(table, order, code, allMath) {\n    const math = getMath(table, code);\n    const ctx = {\n        table,\n        order,\n        from: 0,\n        to: 0,\n        array: (i, c) => {\n            const size = c.to - c.from;\n            const temp = new Array(size);\n            const getter = cache[i];\n            for (let j = 0; j < size; j++) {\n                temp[j] = getter(c.order[j + c.from]);\n            }\n            return temp;\n        },\n    };\n    return function (from, to) {\n        ctx.from = from;\n        ctx.to = to;\n        return math(0, allMath, ctx);\n    };\n}\nfunction optimizeRangeGroup(table, order, code, allMath) {\n    const math = getMath(table, code);\n    const ctx = {\n        table,\n        order,\n        range: [],\n        array: (i, c) => {\n            const size = ctx.range.length;\n            const temp = [];\n            const getter = cache[i];\n            for (let j = 0; j < size; j += 2) {\n                const from = ctx.range[j];\n                const to = ctx.range[j + 1];\n                for (let i = from; i < to; i++) {\n                    temp.push(getter(c.order[i]));\n                }\n            }\n            return temp;\n        },\n    };\n    return function (range) {\n        ctx.range = range;\n        return math(0, allMath, ctx);\n    };\n}\nfunction optimizeGroup(code, allMath) {\n    const math = getGroupMath(code);\n    return function (v) {\n        return math(v, allMath, null);\n    };\n}\nlet id = 0;\nconst cache = [];\nfunction getMath(table, rule) {\n    return e(rule, {\n        propertyName: \"d\",\n        methodName: \"m\",\n        contextName: \"c\",\n        property: (a) => {\n            const i = id;\n            cache[i] = table.getColumn(a).getter;\n            id += 1;\n            return `c.array(\"${i}\", c)`;\n        },\n        method: (a) => {\n            return `m.${a.toLowerCase()}`;\n        },\n    });\n}\nfunction getGroupMath(rule) {\n    return e(rule, {\n        propertyName: \"d\",\n        methodName: \"m\",\n        contextName: \"c\",\n        property: () => {\n            return `d`;\n        },\n        method: (a) => {\n            return `m.${a.toLowerCase()}`;\n        },\n    });\n}\n\nconst and = (a, b) => c => a(c) && b(c);\nfunction buildFinder(data, key, value, context) {\n    const getValue = context.getter(data, key);\n    if (typeof value !== \"object\") {\n        const check = context.compare[\"eq\"](value);\n        return i => check(getValue(i));\n    }\n    else {\n        const ops = Object.keys(value);\n        let result = null;\n        for (let i = 0; i < ops.length; i++) {\n            const check = context.compare[ops[i].toLowerCase()](value[ops[i]]);\n            const step = i => check(getValue(i));\n            result = result ? and(result, step) : step;\n        }\n        return result;\n    }\n}\nfunction build(table, rule, context) {\n    const keys = Object.keys(rule);\n    let result = null;\n    for (let i = 0; i < keys.length; i++) {\n        const key = keys[i];\n        const step = buildFinder(table, key, rule[key], context);\n        result = result ? and(result, step) : step;\n    }\n    return result;\n}\nfunction filter(order, table, rule, context) {\n    const filter = build(table, rule, context);\n    return order.filter(n => filter(n));\n}\n\nclass DataPivot {\n    constructor(table, rows, cols, filters, config) {\n        this._rows = rows;\n        this._cols = cols;\n        this._dims = rows.concat(cols);\n        this._table = table;\n        this._context = config;\n        this._cursor = -1;\n        this._order = this._base_order = this._sort();\n        this._data = this._dims.map(a => a.getIndexes());\n        this.filter(filters, true);\n    }\n    resetCursor() {\n        this._cursor = 0;\n        this._group = this._dims.map(() => null);\n        if (this._order.length) {\n            if (this._rows.length)\n                this._nextRow();\n            if (this._cols.length)\n                this._nextColumn();\n        }\n    }\n    next(header, index, rAggr, cAggr) {\n        const { _cursor, _cols, _order, _group, _ops, _rows } = this;\n        if (this._cursor >= _order.length)\n            return null;\n        const dimsSize = _rows.length;\n        const out = new Array(dimsSize + _ops.length * _cols.length);\n        // dimensions\n        for (let i = 0; i < dimsSize; i++)\n            out[i] = _rows[i].getValue(_group[i]);\n        // get end of next line ( all dataset for columns mode )\n        const to = this._rows.length\n            ? this._nextRow(_cols.length > 0)\n            : _order.length;\n        this._fillRow(out, index, _cursor, to, dimsSize, header, rAggr, cAggr);\n        this._cursor = to;\n        return out;\n    }\n    nested(rAggr) {\n        const { _cols, _order, _rows } = this;\n        const header = new Set();\n        const dimSize = _rows.length;\n        const dimOutSize = dimSize > 0 ? 1 : 0;\n        const levels = [{ data: [], values: [] }];\n        const data = [];\n        let prev = [];\n        let now = [];\n        let from = this._cursor;\n        let count = 0;\n        const { _groupOps } = this;\n        const _groupLength = [{}].concat(_rows.map(() => ({})));\n        const rowData = [];\n        const limit = this._context.limit.rows;\n        const width = Math.min(this._context.limit.columns, (_cols.length ? this._sizes[0] * _cols[0].getSize() : 0) + dimOutSize);\n        const closeLevels = function (j) {\n            // ignore not created, during first iteration\n            if (!levels[j])\n                return;\n            // each sub-level\n            for (; j < dimSize; j++) {\n                // get all known columns\n                for (const [kAgr, vAgr] of rAggr) {\n                    // get start of related rows\n                    const prev = _groupLength[j][kAgr] || 0;\n                    // if have new rows\n                    if (prev === 0 || vAgr.length > prev) {\n                        // check and calcualte op\n                        for (let z = 0; z < _groupOps.length; z++) {\n                            const math = _groupOps[z];\n                            if (math) {\n                                levels[j].values[dimOutSize + kAgr + z] = math(vAgr.slice(prev + 1));\n                                _groupLength[j][kAgr] = vAgr.length - 1;\n                            }\n                        }\n                    }\n                }\n            }\n        };\n        while (this._cursor < _order.length) {\n            const out = new Array(width);\n            prev = now;\n            now = [].concat(this._group);\n            // get end of next line ( all dataset for columns mode )\n            const to = this._rows.length\n                ? this._nextRow(_cols.length > 0)\n                : _order.length;\n            // calculate finished branches\n            if (_groupOps !== null) {\n                for (let level = 0; level < dimSize; level++) {\n                    // find level at which route differs\n                    if (now[level] != prev[level]) {\n                        closeLevels(level + 1);\n                        break;\n                    }\n                }\n            }\n            const cAggr = {};\n            this._fillRow(out, data.length, from, to, dimOutSize, header, rAggr, cAggr);\n            rowData.push(cAggr);\n            // if we have row-dimensions\n            if (dimSize > 0) {\n                for (let level = 0; level < dimSize; level++) {\n                    // find level at which route differs\n                    if (now[level] != prev[level]) {\n                        // starting from that level and below\n                        for (let j = level; j < dimSize; j++) {\n                            const index = j + 1;\n                            const last = index === dimSize;\n                            // create new nodes\n                            const obj = (levels[index] = {\n                                id: last ? data.length + 1 : 0,\n                                data: last ? null : [],\n                                values: last ? out : [_rows[j].getValue(now[j])],\n                            });\n                            // store node in the parents branch\n                            levels[j].data.push(obj);\n                        }\n                        break;\n                    }\n                }\n                // store scale value in the first cell of the new row\n                out[0] = _rows[dimSize - 1].getValue(now[dimSize - 1]);\n                // store value line of the pivot ( leaf of the tree )\n                levels[dimSize].values = out;\n            }\n            else {\n                // if we have not row-dimensions, store plain data only\n                levels[0].data.push({ data: null, values: out });\n            }\n            data.push(out);\n            count++;\n            if (count >= limit)\n                break;\n            this._cursor = from = to;\n        }\n        if (_groupOps !== null) {\n            closeLevels(1);\n        }\n        const columns = Array.from(header).sort((a, b) => (a > b ? 1 : -1));\n        const result = {\n            tree: levels[0].data,\n            data,\n            width,\n            scaleWidth: dimOutSize,\n            columns,\n            rowData,\n        };\n        this._fillGroupRow(levels[0], result, rAggr, _rows.length - 1);\n        return result;\n    }\n    getLimit() {\n        return this._context.limit;\n    }\n    getWidth() {\n        return [\n            this._rows.length,\n            this._cols.length && this._ops.length\n                ? this._cols[0].getSize() * this._sizes[0]\n                : 0,\n            this._ops.length,\n        ];\n    }\n    getXHeader(result, hConfig) {\n        const { _cols, _rows, _ops, _opInfo } = this;\n        const { nonEmpty, meta } = hConfig || {};\n        const isNested = result.tree;\n        // compressed line\n        const line = [];\n        // rows prefix\n        const rpref = result.tree ? Math.min(_rows.length, 1) : _rows.length;\n        // count of operations, repeat step of bottom scale\n        const ostep = _ops.length;\n        // how many scale units in one parent\n        const unitsInParent = _cols.map(a => a.getSize());\n        // calculate full width of data\n        const length = unitsInParent.reduce((prev, value) => prev * value, ostep);\n        const columns = result.columns;\n        const fullLength = rpref +\n            Math.min(nonEmpty ? columns.length * ostep : length, this._context.limit.columns);\n        // how many data points per unit\n        let temp = length;\n        const unitSizes = unitsInParent.map(a => (temp = temp / a));\n        // result header\n        const out = [];\n        this._cols.forEach(() => out.push(new Array(fullLength)));\n        // build compressed order\n        if (nonEmpty) {\n            //check all cells, include columns of cells with data\n            for (let i = 0; i < rpref; i++)\n                line.push(i);\n            for (let j = 0; j < columns.length; j++) {\n                const base = rpref + columns[j];\n                for (let i = 0; i < ostep; i++)\n                    line.push(base + i);\n            }\n            // now check each scale line\n            for (let j = 0; j < _cols.length; j++) {\n                const step = unitSizes[j];\n                let start = -1;\n                let end = 0;\n                let colspan = 0;\n                let text;\n                // against each non-empty column\n                for (let i = rpref; i < line.length; i += ostep) {\n                    const test = line[i];\n                    // if we inside of span\n                    if (test < end) {\n                        colspan += ostep;\n                    }\n                    else {\n                        // we have reached the new span\n                        // setting old one if any\n                        if (colspan !== 0) {\n                            out[j][start] = { colspan, text };\n                        }\n                        // store position of new span\n                        const ind = Math.floor((test - rpref) / step);\n                        start = i;\n                        end = (ind + 1) * step + rpref;\n                        colspan = ostep;\n                        // store related text\n                        text = _cols[j].getValue(ind % unitsInParent[j]);\n                    }\n                }\n                // setting last span\n                if (colspan !== 0)\n                    out[j][start] = { colspan, text };\n            }\n        }\n        else {\n            // for each scale\n            for (let i = 0; i < _cols.length; i++) {\n                const size = unitsInParent[i];\n                const step = unitSizes[i];\n                let ind = 0;\n                // set value at n-th cell\n                for (let j = rpref; j < fullLength; j += step) {\n                    if (step === 1) {\n                        out[i][j] = _cols[i].getValue(ind++);\n                    }\n                    else {\n                        out[i][j] = { text: _cols[i].getValue(ind++), colspan: step };\n                    }\n                    // repeat dimension values\n                    if (ind >= size)\n                        ind = 0;\n                }\n            }\n        }\n        // add bottom line, with operations\n        if (this._ops) {\n            const opNames = new Array(fullLength);\n            const step = _ops.length;\n            for (let j = rpref; j < fullLength; j += step)\n                for (let z = 0; z < step; z++)\n                    opNames[j + z] = _opInfo[z].label;\n            out.push(opNames);\n        }\n        // prepend row labels\n        for (let i = 0; i < rpref; i++) {\n            const rowspan = _cols.length + (this._ops ? 1 : 0);\n            if (isNested) {\n                out[0][0] = { text: \"\", rowspan };\n                break;\n            }\n            const text = _rows[i].getLabel();\n            out[0][i] = rowspan > 1 ? { text, rowspan } : text;\n        }\n        const res = { data: out };\n        // add compression line to output\n        if (nonEmpty)\n            res.nonEmpty = line;\n        if (meta) {\n            const metaLine = new Array(fullLength);\n            for (let i = 0; i < rpref; i++)\n                metaLine[i] = _rows[i].getMeta();\n            const step = _ops.length;\n            for (let j = rpref; j < fullLength; j += step)\n                for (let z = 0; z < step; z++)\n                    metaLine[j + z] = _opInfo[z].meta;\n            res.meta = metaLine;\n        }\n        return res;\n    }\n    filter(rules, master) {\n        if (!rules || Object.keys(rules).length === 0) {\n            if (!master && this._masterRules)\n                rules = Object.assign(Object.assign({}, this._masterRules), rules);\n            else {\n                this._order = this._base_order;\n                return;\n            }\n        }\n        if (master)\n            this._masterRules = rules;\n        this._order = filter(this._base_order, this._table, rules, this._context);\n    }\n    operations(ops) {\n        const { _table, _order, _context } = this;\n        ops = ops || [];\n        this._ops = ops.map(p => optimize(_table, _order, typeof p === \"string\" ? p : p.math, _context.math));\n        this._groupResultOps = ops.map(p => p.branchMode === \"result\"\n            ? optimizeGroup(typeof p === \"string\" ? p : p.branchMath || p.math, _context.math)\n            : null);\n        if (!this._groupResultOps.find(a => a !== null))\n            this._groupResultOps = null;\n        this._groupOps = ops.map(p => p.branchMode === \"raw\"\n            ? optimizeRangeGroup(_table, _order, typeof p === \"string\" ? p : p.branchMath || p.math, _context.math)\n            : null);\n        if (!this._groupOps.find(a => a !== null))\n            this._groupOps = null;\n        this._opInfo = ops.map(p => {\n            if (typeof p === \"string\") {\n                return { label: p, math: p };\n            }\n            else {\n                return Object.assign(Object.assign({}, p), { label: p.label || p.math });\n            }\n        });\n        this._rowResultOps = compactOps(ops, \"row\", \"result\", (x, name) => ({\n            name,\n            op: optimizeGroup(x, _context.math),\n        }));\n        this._rowOps = compactOps(ops, \"row\", \"raw\", (x, name) => ({\n            name,\n            op: optimize(_table, _order, x, _context.math),\n        }));\n        this._colResultOps = compactOps(ops, \"column\", \"result\", (x, name) => ({\n            name,\n            op: optimizeGroup(x, _context.math),\n        }));\n        this._colOps = compactOps(ops, \"column\", \"raw\", (x, name) => ({\n            name,\n            op: optimizeRangeGroup(_table, _order, x, _context.math),\n        }));\n        this._marks = ops.map(a => a.marks || null);\n        if (!this._marks.find(a => a !== null))\n            this._marks = null;\n        this._setSizes();\n    }\n    aggregateColumns(result, rAggr) {\n        const { _colOps, _colResultOps } = this;\n        const { columns, data, scaleWidth } = result;\n        if (!_colOps && !_colResultOps)\n            return [];\n        const step = this._ops.length;\n        const out = [];\n        for (let i = 0; i < columns.length; i++) {\n            const ind = columns[i];\n            const dmr = rAggr.get(ind);\n            if (!dmr)\n                continue;\n            const keys = Array.from(dmr[0].keys());\n            for (let j = 0; j < step; j++) {\n                const column = {};\n                if (_colResultOps) {\n                    const op = _colResultOps[j];\n                    if (op) {\n                        const values = keys.map(a => data[a][ind + j + scaleWidth]);\n                        op.forEach(x => (column[x.name] = x.op(values)));\n                    }\n                }\n                if (_colOps) {\n                    const op = _colOps[j];\n                    if (op) {\n                        op.forEach(x => (column[x.name] = x.op(dmr.slice(1))));\n                    }\n                }\n                out[scaleWidth + ind + j] = column;\n            }\n        }\n        return out;\n    }\n    _optimizeGroup(ops) {\n        const config = {};\n        let exit = true;\n        for (const key in ops) {\n            const test = ops[key];\n            config[key] = optimizeGroup(test, this._context.math);\n            exit = false;\n        }\n        return exit ? null : config;\n    }\n    mark(result, rAggr) {\n        const out = [];\n        const { _marks, _ops } = this;\n        if (!_marks)\n            return out;\n        const opsLength = _ops.length;\n        const { scaleWidth, data, columnData, rowData } = result;\n        for (const [k, v] of rAggr) {\n            const r = v[0];\n            for (let i = 0; i < opsLength; i++) {\n                const marks = this._marks[i];\n                if (marks === null)\n                    continue;\n                for (const z of r) {\n                    const cid = k + i + scaleWidth;\n                    const rid = z;\n                    const cell = [];\n                    for (let j = 0; j < marks.length; j++) {\n                        if (marks[j].check(data[rid][cid], columnData[cid] || {}, rowData[rid] || {}))\n                            cell.push(marks[j].name);\n                    }\n                    if (cell.length) {\n                        let rarr = out[rid];\n                        if (typeof rarr === \"undefined\")\n                            rarr = out[rid] = [];\n                        rarr[cid] = cell;\n                    }\n                }\n            }\n        }\n        return out;\n    }\n    __getHeaderStub() {\n        return {};\n    }\n    _fillGroupRow(obj, result, rAggr, level) {\n        const { _groupResultOps } = this;\n        const { columns, scaleWidth } = result;\n        if (_groupResultOps) {\n            for (let i = 0; i < columns.length; i++) {\n                const ind = columns[i];\n                for (let j = 0; j < _groupResultOps.length; j++) {\n                    const op = _groupResultOps[j];\n                    if (!op)\n                        continue;\n                    if (level > 0)\n                        this._fillGroupRowInner(obj, op, ind + j + scaleWidth, level);\n                }\n            }\n        }\n    }\n    _fillGroupRowInner(obj, op, ind, level) {\n        const arr = [];\n        if (level > 0) {\n            obj.data.forEach(a => {\n                const res = this._fillGroupRowInner(a, op, ind, level - 1);\n                if (res !== null) {\n                    arr.push(res);\n                }\n            });\n        }\n        else {\n            for (let i = 0; i < obj.data.length; i++) {\n                const test = obj.data[i].values[ind];\n                if (typeof test !== \"undefined\")\n                    arr.push(test);\n            }\n        }\n        if (arr.length)\n            return (obj.values[ind] = op(arr));\n        return null;\n    }\n    _fillRow(out, index, from, to, dimsSize, header, rAggr, cAggr) {\n        const { _cols, _group, _ops, _sizes, _rows, _rowResultOps, _rowOps } = this;\n        const rl = _rows.length;\n        const collectRaggr = this._colResultOps !== null ||\n            this._colOps !== null ||\n            this._marks !== null;\n        let ctemp = [];\n        if (_rowResultOps !== null)\n            ctemp = _rowResultOps.map(() => []);\n        // calculations\n        if (_ops.length) {\n            if (_cols.length) {\n                let cfrom = from;\n                while (cfrom < to) {\n                    let cind = 0;\n                    for (let i = 0; i < _cols.length; i++)\n                        cind += _sizes[i] * _group[rl + i];\n                    const cto = this._nextColumn();\n                    for (let i = 0; i < _ops.length; i++) {\n                        const temp = (out[cind + dimsSize + i] = _ops[i](cfrom, cto));\n                        if (_rowResultOps !== null)\n                            ctemp[i].push(temp);\n                    }\n                    if (collectRaggr) {\n                        let arr = rAggr.get(cind);\n                        if (!arr)\n                            rAggr.set(cind, (arr = [new Set(), cfrom, cto]));\n                        else\n                            arr.push(cfrom, cto);\n                        arr[0].add(index);\n                    }\n                    header.add(cind);\n                    this._cursor = cfrom = cto;\n                }\n            }\n            else {\n                for (let i = 0; i < _ops.length; i++) {\n                    out[i + dimsSize] = _ops[i](from, to);\n                }\n                if (collectRaggr) {\n                    let arr = rAggr.get(0);\n                    if (!arr)\n                        rAggr.set(0, (arr = [new Set(), from, to]));\n                    else\n                        arr.push(from, to);\n                    arr[0].add(index);\n                }\n                header.add(0);\n            }\n        }\n        if (_rowResultOps !== null) {\n            _rowResultOps.forEach((opset, i) => {\n                const dataset = ctemp[i];\n                if (opset && dataset.length)\n                    opset.forEach(op => {\n                        cAggr[op.name] = op.op(ctemp[i]);\n                    });\n            });\n        }\n        if (_rowOps !== null) {\n            _rowOps.forEach(opset => {\n                opset === null || opset === void 0 ? void 0 : opset.forEach(op => {\n                    cAggr[op.name] = op.op(from, to);\n                });\n            });\n        }\n    }\n    _sort() {\n        const { _table, _dims } = this;\n        const size = Math.min(_table.count(), this._context.limit.raws);\n        const order = new Array(size);\n        for (let i = 0; i < size; i++) {\n            order[i] = i;\n        }\n        const dimsSize = _dims.length;\n        const dimsData = _dims.map(a => a.getIndexes());\n        order.sort((a, b) => {\n            for (let j = 0; j < dimsSize; j++) {\n                const left = dimsData[j][a];\n                const right = dimsData[j][b];\n                if (left > right)\n                    return 1;\n                if (left < right)\n                    return -1;\n            }\n            return 0;\n        });\n        return order;\n    }\n    _nextRow(silent) {\n        const { _data, _order, _group, _rows } = this;\n        const dimsSize = _rows.length;\n        let ok = true;\n        let to = this._cursor;\n        // eslint-disable-next-line\n        while (true) {\n            const ind = _order[to];\n            for (let i = 0; i < dimsSize; i++) {\n                if (_data[i][ind] != _group[i]) {\n                    if (!silent)\n                        _group[i] = _data[i][ind];\n                    ok = false;\n                }\n            }\n            if (!ok)\n                break;\n            to++;\n        }\n        return to;\n    }\n    _nextColumn() {\n        const { _data, _order, _group, _rows, _cols } = this;\n        const dimsSize = _cols.length + _rows.length;\n        let ok = true;\n        let to = this._cursor;\n        // eslint-disable-next-line\n        while (true) {\n            const ind = _order[to];\n            for (let i = 0; i < dimsSize; i++) {\n                if (_data[i][ind] != _group[i]) {\n                    _group[i] = _data[i][ind];\n                    ok = false;\n                }\n            }\n            if (!ok)\n                break;\n            to++;\n        }\n        return to;\n    }\n    _setSizes() {\n        const sizes = this._cols.map(a => a.getSize());\n        let sum = this._ops.length || 1;\n        for (let i = sizes.length - 1; i >= 0; i--) {\n            const now = sum;\n            sum *= sizes[i];\n            sizes[i] = now;\n        }\n        this._sizes = sizes;\n    }\n}\nfunction compactOps(ops, kind, mode, optimizer) {\n    const result = ops.map(p => {\n        const row = p[kind];\n        if (!row)\n            return null;\n        const out = row\n            .map(op => {\n            const source = op.source || \"raw\";\n            if (source === mode)\n                if (typeof op === \"string\")\n                    return optimizer(op, getName(op));\n                else\n                    return optimizer(op.math, op.as || getName(op.math));\n            return null;\n        })\n            .filter(a => a !== null);\n        if (!out.length)\n            return null;\n        return out;\n    });\n    if (!result.find(a => !!a))\n        return null;\n    return result;\n}\nfunction getName(x) {\n    const end = x.indexOf(\"(\");\n    if (end === -1)\n        return x.trim();\n    return x.substring(0, end).trim();\n}\n\nclass RawTable {\n    constructor(config) {\n        this._columns = config.fields;\n        this.parse(config.data);\n    }\n    parse(data) {\n        this._raw = data;\n        this._parse_inner();\n    }\n    prepare() {\n        if (this._prepared)\n            return;\n        this._prepared = true;\n        const data = this._raw;\n        const fields = this._columns;\n        const cols = fields.filter(a => a.type === 3);\n        if (!data || !cols.length)\n            return;\n        const dataLength = data.length;\n        const columnsLength = cols.length;\n        for (let i = 0; i < dataLength; i++) {\n            for (let j = 0; j < columnsLength; j++) {\n                const col = cols[j];\n                const text = col.getter(i);\n                if (typeof text === \"string\")\n                    col.setter(i, new Date(text));\n            }\n        }\n    }\n    _parse_inner() {\n        this._columns.forEach(a => {\n            const key = a.id;\n            a.getter = i => this._raw[i][key];\n            a.setter = (i, v) => (this._raw[i][key] = v);\n        });\n    }\n    getColumn(id) {\n        return this._columns.find(a => a.id === id);\n    }\n    count() {\n        return this._raw.length;\n    }\n}\n\nclass ColumnTable extends RawTable {\n    parse(data) {\n        this._parse_init(data.length);\n        const dataLength = data.length;\n        const columnsLength = this._columns.length;\n        for (let i = 0; i < dataLength; i++) {\n            const obj = data[i];\n            for (let j = 0; j < columnsLength; j++) {\n                const col = this._columns[j];\n                col.data[i] = obj[col.id];\n            }\n        }\n    }\n    _parse_init(n) {\n        this._columns.forEach(a => {\n            const data = (a.data = new Array(n));\n            a.getter = i => data[i];\n            a.setter = (i, v) => (data[i] = v);\n        });\n    }\n    count() {\n        return this._columns[0].data.length;\n    }\n}\n\nconst methods = {\n    round: (v) => Math.round(v),\n    sum: (arr) => arr.reduce((acc, a) => acc + a, 0),\n    min: (arr) => arr.reduce((acc, a) => (a < acc ? a : acc), arr.length ? arr[0] : 0),\n    max: (arr) => arr.reduce((acc, a) => (a > acc ? a : acc), arr.length ? arr[0] : 0),\n    avg: (arr) => arr.length ? arr.reduce((acc, a) => acc + a, 0) / arr.length : 0,\n    wavg: (arr, w) => {\n        if (!arr.length)\n            return 0;\n        let count = 0;\n        let summ = 0;\n        for (let i = arr.length - 1; i >= 0; i--) {\n            count += w[i];\n            summ += arr[i] * w[i];\n        }\n        return summ / count;\n    },\n    count: (arr) => arr.length,\n    any: (arr) => (arr.length ? arr[0] : null),\n};\nconst filters = {\n    eq: (v) => (x) => x == v,\n    neq: (v) => (x) => x != v,\n    gt: (v) => (x) => x > v,\n    gte: (v) => (x) => x >= v,\n    lt: (v) => (x) => x < v,\n    lte: (v) => (x) => x <= v,\n    in: (v) => (x) => v[x],\n    hasPrefix: (v) => (x) => x.indexOf(v) === 0,\n    contains: (v) => (x) => x.indexOf(v) !== -1,\n};\nconst predicates = {\n    year: (v) => v.getFullYear(),\n    month: (v) => v.getMonth(),\n    day: (v) => v.getDate(),\n    hour: (v) => v.getHours(),\n    minute: (v) => v.getMinutes(),\n};\n\nclass Analytic {\n    constructor(cfg) {\n        this._tables = {};\n        this._dimensions = {};\n        this._preds = Object.assign({}, predicates);\n        this._maths = Object.assign({}, methods);\n        this._comps = Object.assign({}, filters);\n        if (cfg && cfg.tables)\n            cfg.tables.forEach(s => this.addTable(s));\n        if (cfg && cfg.dimensions)\n            cfg.dimensions.forEach(s => this.addDimension(s));\n    }\n    addPredicate(name, code) {\n        this._preds[name.toLowerCase()] = code;\n    }\n    addMath(name, code) {\n        this._maths[name.toLowerCase()] = code;\n    }\n    addComparator(name, code) {\n        this._comps[name.toLowerCase()] = code;\n    }\n    getDimension(id) {\n        return this._dimensions[id];\n    }\n    addDimension(s) {\n        if (this._dimensions[s.id])\n            return;\n        const table = this._tables[s.table];\n        const getter = this._predicateGetter(table, s.rule.by);\n        this._dimensions[s.id] = new DataDimension(table, getter, s.label || s.id, s.meta || s, s.sort);\n    }\n    resetDimensions(s, preserve) {\n        const prev = this._dimensions;\n        this._dimensions = {};\n        if (s)\n            s.forEach(a => {\n                const used = prev[a.id];\n                if (preserve && used)\n                    this._dimensions[a.id] = used;\n                else\n                    this.addDimension(a);\n            });\n    }\n    addTable(s) {\n        const driver = (s.driver || \"raw\") === \"raw\" ? RawTable : ColumnTable;\n        const t = (this._tables[s.id] = new driver(s));\n        if (s.prepare)\n            t.prepare();\n    }\n    getTable(id) {\n        return this._tables[id];\n    }\n    compact(table, config) {\n        const { rows, cols, filters, limit } = config;\n        const base = this._tables[table];\n        const rDims = rows ? rows.map(a => this._dimensions[a]) : [];\n        const cDims = cols ? cols.map(a => this._dimensions[a]) : [];\n        [...rDims, ...cDims].forEach(a => a.prepare());\n        const pivot = new DataPivot(base, rDims, cDims, filters, {\n            getter: this._predicateGetter.bind(this),\n            math: this._maths,\n            compare: this._comps,\n            limit: Object.assign({ rows: 10000, columns: 5000, raws: Infinity }, (limit || {})),\n        });\n        return new DataExport(pivot);\n    }\n    _predicateGetter(table, key) {\n        const find = key.indexOf(\"(\");\n        if (find !== -1) {\n            const fn = this._preds[key.substr(0, find).toLowerCase()];\n            key = key.substr(find + 1, key.length - find - 2);\n            const getter = table.getColumn(key).getter;\n            return i => fn(getter(i));\n        }\n        else {\n            return table.getColumn(key).getter;\n        }\n    }\n}\n\nexport { Analytic };\n//# sourceMappingURL=rengine.es6.js.map\n","import * as rengine from \"@xbs/rengine\";\n\nexport default class LocalData {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t */\n\tconstructor(app) {\n\t\tthis._app = app;\n\t\tthis._store = {}; //aggregated data\n\n\t\tthis._filtersHash = {};\n\t\tthis._state = app.getState();\n\n\t\tif (app.config.externalProcessing) this._setOperations();\n\t\telse {\n\t\t\tthis._data = [];\n\t\t\tthis._initRengine();\n\t\t}\n\t}\n\t/** Set list of avaible operations; adds custom operations from config */\n\t_setOperations() {\n\t\tthis.operations = [\n\t\t\t{ id: \"sum\", fields: 1, branchMode: \"result\" },\n\t\t\t{ id: \"min\", fields: 1, branchMode: \"result\" },\n\t\t\t{ id: \"max\", fields: 1, branchMode: \"result\" },\n\t\t\t{ id: \"avg\", fields: 1, branchMode: \"raw\" },\n\t\t\t{ id: \"wavg\", fields: 2, branchMode: \"raw\" },\n\t\t\t{ id: \"count\", fields: 1, branchMode: \"raw\" },\n\t\t\t{ id: \"any\", fields: 1, branchMode: \"result\" },\n\t\t\t{ id: \"complex\" },\n\t\t];\n\n\t\tconst config = this._app.config;\n\t\tconst extraOperations = this._app.config.operations;\n\t\tif (extraOperations) {\n\t\t\tif (config.externalProcessing)\n\t\t\t\tthis.operations = this.operations.concat(extraOperations);\n\t\t\telse\n\t\t\t\tfor (let name in extraOperations) {\n\t\t\t\t\tlet operation = extraOperations[name];\n\t\t\t\t\tlet fields, branchMode, hidden;\n\n\t\t\t\t\tif (typeof operation == \"object\") {\n\t\t\t\t\t\tfields = operation.fields || operation.handler.length;\n\t\t\t\t\t\tbranchMode = operation.branchMode;\n\t\t\t\t\t\thidden = operation.hidden;\n\t\t\t\t\t\toperation = operation.handler;\n\t\t\t\t\t} else fields = operation.length;\n\n\t\t\t\t\tthis._reng.addMath(name, operation);\n\n\t\t\t\t\tif (!hidden)\n\t\t\t\t\t\tthis.operations.push({\n\t\t\t\t\t\t\tid: name,\n\t\t\t\t\t\t\tfields,\n\t\t\t\t\t\t\tbranchMode,\n\t\t\t\t\t\t});\n\t\t\t\t}\n\t\t}\n\t}\n\t/** Set list of avaible total operations */\n\t_setTotalOperations() {\n\t\tthis.totalOperations = {};\n\t\tconst totalOps = this._app.config.totalOperations;\n\n\t\tif (totalOps)\n\t\t\tfor (let name in totalOps) {\n\t\t\t\tconst op = totalOps[name];\n\t\t\t\tconst all = typeof totalOps[name] == \"string\";\n\t\t\t\t[\"footer\", \"group\", \"column\"].forEach(type => {\n\t\t\t\t\tif (all || op[type]) {\n\t\t\t\t\t\tif (!this.totalOperations[type]) this.totalOperations[type] = {};\n\t\t\t\t\t\tthis.totalOperations[type][name] = all ? op : op[type];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t}\n\t/** Sets default filter rules */\n\t_setFilters() {\n\t\tfor (let type in webix.filters) {\n\t\t\tthis._reng.addComparator(type, v => test => {\n\t\t\t\tif (type == \"date\") test = test.valueOf();\n\n\t\t\t\tif (!v) return true;\n\t\t\t\telse if (v.includes) return v.includes.indexOf(test) != -1;\n\t\t\t\telse if (!v.condition.filter) return true;\n\t\t\t\telse\n\t\t\t\t\treturn webix.filters[type][v.condition.type](\n\t\t\t\t\t\ttest,\n\t\t\t\t\t\tv.condition.filter\n\t\t\t\t\t);\n\t\t\t});\n\t\t}\n\t}\n\t/** Adds predicates from config */\n\t_setPredicates() {\n\t\tconst predicates = this._app.config.predicates;\n\t\tif (predicates)\n\t\t\tfor (let name in predicates)\n\t\t\t\tthis._reng.addPredicate(name, predicates[name]);\n\t}\n\t/**\n\t * Returns fields that contain data\n\t * @param {object} firstRow - first row in data\n\t * @returns {array} data fields\n\t */\n\tgetFields(firstRow) {\n\t\tlet fields = this._app.config.fields;\n\n\t\tif (!fields) {\n\t\t\tfields = [];\n\n\t\t\tfor (let i in firstRow) {\n\t\t\t\tlet type;\n\n\t\t\t\tconst dataType = typeof firstRow[i];\n\t\t\t\tswitch (dataType) {\n\t\t\t\t\tcase \"string\":\n\t\t\t\t\t\ttype = \"text\";\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase \"number\":\n\t\t\t\t\t\ttype = dataType;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\ttype = \"date\";\n\t\t\t\t}\n\n\t\t\t\tfields.push({ id: i, value: i, type });\n\t\t\t}\n\t\t}\n\n\t\treturn fields;\n\t}\n\t/**\n\t * Loads data and populates store\n\t * @param {boolean} force - if true, data will be reloaded\n\t * @returns {Promise} promise that resolves with store array\n\t */\n\tgetData(force) {\n\t\tif (!force && this.useOldData())\n\t\t\treturn this._dataLoad || webix.promise.resolve(this._store);\n\n\t\tconst externalProcessing = this._app.config.externalProcessing;\n\t\tif (externalProcessing || !Object.keys(this._store).length || force) {\n\t\t\treturn (this._dataLoad = this._app\n\t\t\t\t.getService(\"backend\")\n\t\t\t\t.data()\n\t\t\t\t.then(data => {\n\t\t\t\t\tif (externalProcessing)\n\t\t\t\t\t\tthis._store = this._rengineToWebix(data.result, data.header);\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis._table = this.getTable(data);\n\t\t\t\t\t\tthis._reng.addTable(this._table);\n\t\t\t\t\t\tthis._store = this.getPivotData();\n\t\t\t\t\t}\n\t\t\t\t\tthis._filtersHash = {};\n\t\t\t\t\treturn this._store;\n\t\t\t\t})\n\t\t\t\t.catch(error => this.loadError(error))\n\t\t\t\t.finally(() => delete this._dataLoad));\n\t\t} else {\n\t\t\tthis._store = this.getPivotData();\n\t\t\treturn webix.promise.resolve(this._store);\n\t\t}\n\t}\n\t/** Checks if pivot should use last aggregated data **/\n\tuseOldData() {\n\t\tconst state = this._state;\n\t\tlet newConfig = `${state.mode}|${JSON.stringify(state.structure)}`;\n\t\tif (state.mode == \"chart\") {\n\t\t\tconst type = state.chart.type;\n\t\t\tnewConfig += `|${type == \"pie\" || type == \"donut\"}`;\n\t\t} else newConfig += `|${JSON.stringify(state.datatable)}`;\n\n\t\tconst refresh = this._old == newConfig;\n\t\tthis._old = newConfig;\n\t\treturn refresh;\n\t}\n\t/** Inits math module */\n\t_initRengine() {\n\t\tthis._reng = new rengine.Analytic();\n\n\t\tthis._setFilters();\n\t\tthis._setOperations();\n\t\tthis._setTotalOperations();\n\t\tthis._setPredicates();\n\t}\n\t/**\n\t * Сonverts data to pivot readable form\n\t * @returns {Object} object with aggregated data and its parameters\n\t */\n\tgetPivotData() {\n\t\tif (!this._table)\n\t\t\treturn {\n\t\t\t\tdata: [],\n\t\t\t\theader: [],\n\t\t\t\ttotal: [],\n\t\t\t\tmarks: [],\n\t\t\t};\n\n\t\tconst structure = this._state.structure;\n\t\tconst mode = this._state.mode;\n\t\tconst table = this._state.datatable;\n\n\t\tthis.setDimensions();\n\n\t\tconst filters = {};\n\t\tfor (let i = 0; i < structure.filters.length; i++) {\n\t\t\tconst filter = structure.filters[i];\n\n\t\t\tconst fields = this._state.fields;\n\t\t\tconst field = fields.find(field => field.id == filter.name);\n\n\t\t\tfilters[filter.name] = { [field.type]: filter.value };\n\t\t}\n\n\t\t//groups data\n\t\tconst res = this._reng.compact(this._table.id, {\n\t\t\trows: this.getRows(),\n\t\t\tcols: this.getColumns(),\n\t\t\tlimit: this.getLimits(),\n\t\t});\n\n\t\tconst ops = this.getOps();\n\n\t\ttry {\n\t\t\tlet result;\n\n\t\t\t//plain data\n\t\t\tif (mode == \"table\")\n\t\t\t\tresult = res.toArray({\n\t\t\t\t\tfilters,\n\t\t\t\t\tops,\n\t\t\t\t\t//remove repetitions in 'parent' col in 'table' mode\n\t\t\t\t\tcleanRows: table.cleanRows,\n\t\t\t\t});\n\t\t\t//groupped data\n\t\t\telse\n\t\t\t\tresult = res.toNested({\n\t\t\t\t\tfilters,\n\t\t\t\t\tops,\n\t\t\t\t});\n\n\t\t\tlet headerConfig;\n\t\t\tif (mode != \"chart\") headerConfig = { meta: true, nonEmpty: true };\n\n\t\t\treturn this._rengineToWebix(result, res.toXHeader(result, headerConfig));\n\t\t} catch (e) {\n\t\t\treturn this.loadError();\n\t\t}\n\t}\n\t/**\n\t * Updates math with custom total methods\n\t * @param {string} type - total operation type (group/footer/total)\n\t * @param {string} math - operation math\n\t * @param {Array} methodsMatch - math methods pos\n\t * @returns {string} updated math\n\t */\n\t_updateTotalMath(type, math, methodsMatch) {\n\t\tfor (let i = methodsMatch.length - 1; i >= 0; i--) {\n\t\t\tconst match = methodsMatch[i];\n\t\t\tmath =\n\t\t\t\tmath.substring(0, match.index + match[1].length) +\n\t\t\t\t(this.totalOperations[type][match[2]] || match[2]) +\n\t\t\t\tmath.substring(match.index + match[0].length - 1, math.length);\n\t\t}\n\t\treturn math;\n\t}\n\t/**\n\t * Applies math operations to data and groups\n\t * @returns {Object} ops\n\t */\n\tgetOps() {\n\t\tconst state = this._state;\n\t\tconst table = state.datatable;\n\t\tconst mode = state.mode;\n\t\tconst vals = state.structure.values;\n\t\tconst ops = [];\n\n\t\tfor (let i = 0; i < vals.length; i++) {\n\t\t\tconst format = vals[i].format;\n\t\t\tconst operation = vals[i].operation;\n\t\t\tconst color = vals[i].color;\n\n\t\t\tconst isComplex = operation == \"complex\";\n\t\t\tlet name = isComplex ? vals[i].math : vals[i].name;\n\t\t\tname = webix.isArray(name) ? name.join(\",\") : name;\n\n\t\t\tconst math = isComplex ? name : `${operation}(${name})`;\n\n\t\t\tlet branchMode;\n\t\t\tif (!isComplex) branchMode = this.getOperation(operation).branchMode;\n\n\t\t\tconst op = {\n\t\t\t\tmath,\n\t\t\t\tbranchMode: branchMode || \"raw\",\n\t\t\t\tlabel: name,\n\t\t\t\tmeta: { operation, format, color },\n\t\t\t\tcolumn: [],\n\t\t\t\trow: [],\n\t\t\t\tmarks: [],\n\t\t\t};\n\n\t\t\tconst total = this.totalOperations;\n\t\t\tlet methodsMatch;\n\t\t\tif (Object.keys(total).length) {\n\t\t\t\tconst methodsRegex = new RegExp(\n\t\t\t\t\t\"(\\\\(|,|\\\\+|-|\\\\/|\\\\*|\\\\s|^)(\" +\n\t\t\t\t\t\tthis.operations.map(method => method.id).join(\"|\") +\n\t\t\t\t\t\t\")\\\\(\",\n\t\t\t\t\t\"g\"\n\t\t\t\t);\n\t\t\t\tmethodsMatch = Array.from(math.matchAll(methodsRegex));\n\t\t\t}\n\n\t\t\tif (total.group)\n\t\t\t\top.branchMath = this._updateTotalMath(\"group\", math, methodsMatch);\n\n\t\t\tif (mode != \"chart\") {\n\t\t\t\tif (\n\t\t\t\t\ttable.footer &&\n\t\t\t\t\t((table.footer == \"sumOnly\" && operation == \"sum\") ||\n\t\t\t\t\t\ttable.footer != \"sumOnly\")\n\t\t\t\t)\n\t\t\t\t\top.column.push({\n\t\t\t\t\t\tmath: total.footer\n\t\t\t\t\t\t\t? this._updateTotalMath(\"footer\", math, methodsMatch)\n\t\t\t\t\t\t\t: math,\n\t\t\t\t\t\tas: \"value\",\n\t\t\t\t\t});\n\n\t\t\t\tif (\n\t\t\t\t\ttable.totalColumn &&\n\t\t\t\t\t((table.totalColumn == \"sumOnly\" && operation == \"sum\") ||\n\t\t\t\t\t\ttable.totalColumn != \"sumOnly\")\n\t\t\t\t)\n\t\t\t\t\top.row.push({\n\t\t\t\t\t\tmath: total.column\n\t\t\t\t\t\t\t? this._updateTotalMath(\"column\", math, methodsMatch)\n\t\t\t\t\t\t\t: math,\n\t\t\t\t\t\tas: \"\" + i,\n\t\t\t\t\t});\n\n\t\t\t\tif (table.minY) {\n\t\t\t\t\top.column.push({\n\t\t\t\t\t\tas: \"minY\",\n\t\t\t\t\t\tmath: \"min(group)\",\n\t\t\t\t\t\tsource: \"result\",\n\t\t\t\t\t});\n\t\t\t\t\top.marks.push({\n\t\t\t\t\t\tname: \"webix_min_y\",\n\t\t\t\t\t\tcheck: (v, column) => v == column.minY,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (table.maxY) {\n\t\t\t\t\top.column.push({\n\t\t\t\t\t\tas: \"maxY\",\n\t\t\t\t\t\tmath: \"max(group)\",\n\t\t\t\t\t\tsource: \"result\",\n\t\t\t\t\t});\n\t\t\t\t\top.marks.push({\n\t\t\t\t\t\tname: \"webix_max_y\",\n\t\t\t\t\t\tcheck: (v, column) => v == column.maxY,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (table.minX) {\n\t\t\t\t\top.row.push({\n\t\t\t\t\t\tas: \"minX\" + math,\n\t\t\t\t\t\tmath: \"min(group)\",\n\t\t\t\t\t\tsource: \"result\",\n\t\t\t\t\t});\n\t\t\t\t\top.marks.push({\n\t\t\t\t\t\tname: \"webix_min_x\",\n\t\t\t\t\t\tcheck: (v, column, row) => v == row[\"minX\" + math],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (table.maxX) {\n\t\t\t\t\top.row.push({\n\t\t\t\t\t\tas: \"maxX\" + math,\n\t\t\t\t\t\tmath: \"max(group)\",\n\t\t\t\t\t\tsource: \"result\",\n\t\t\t\t\t});\n\t\t\t\t\top.marks.push({\n\t\t\t\t\t\tname: \"webix_max_x\",\n\t\t\t\t\t\tcheck: (v, column, row) => v == row[\"maxX\" + math],\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tops.push(op);\n\t\t}\n\t\treturn ops;\n\t}\n\t/** Convert rengine output data to pivot readable form **/\n\t_rengineToWebix(result, header) {\n\t\tconst state = this._state;\n\n\t\tif (state.mode == \"chart\") return this.getChartData(result, header);\n\n\t\tconst footer = header.nonEmpty.map(i =>\n\t\t\tresult.columnData[i] ? result.columnData[i].value : \"\"\n\t\t);\n\n\t\theader = this.getHeader(header);\n\n\t\tlet column;\n\t\tif (state.datatable.totalColumn) {\n\t\t\tcolumn = result.rowData.map(obj => {\n\t\t\t\tconst res = [];\n\t\t\t\tfor (let key in obj) {\n\t\t\t\t\tif (key.indexOf(\"minX\") == -1 && key.indexOf(\"maxX\") == -1)\n\t\t\t\t\t\tres[key] = obj[key];\n\t\t\t\t}\n\t\t\t\treturn res.filter(v => v || v === 0);\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tdata: result.tree || result.data,\n\t\t\theader,\n\t\t\tmarks: result.marks,\n\t\t\tfooter,\n\t\t\ttotalColumn: column,\n\t\t};\n\t}\n\t/**\n\t * Handle load error\n\t * @param {XMLHttpRequest} server error (customizations)\n\t * @returns {Object} empty data\n\t */\n\tloadError() {\n\t\twebix.message({\n\t\t\ttext: this._app.getService(\"locale\")._(\"Incorrect formula in values\"),\n\t\t\ttype: \"error\",\n\t\t});\n\n\t\treturn {\n\t\t\tdata: [],\n\t\t\tvalues: [],\n\t\t\theader: [],\n\t\t\tmarks: [],\n\t\t\tfooter: [],\n\t\t\ttotalColumn: [],\n\t\t};\n\t}\n\t/**\n\t * Prepares data for tree nodes\n\t * @param {Object} obj - item data as returted by Pivot engine\n\t * @returns {Object} item data ready for parsing in Webix Tree\n\t */\n\t_toTree(obj) {\n\t\tlet item = obj.values;\n\n\t\t// server returns object\n\t\tif (!webix.isArray(item)) {\n\t\t\tlet arr = [];\n\t\t\tfor (let name in item) arr[name] = item[name];\n\t\t\titem = arr;\n\t\t}\n\n\t\titem.unshift(\"\"); //header ids start from 1\n\t\tif (obj.data) {\n\t\t\titem.open = true;\n\t\t\titem.data = obj.data.map(r => {\n\t\t\t\treturn this._toTree(r);\n\t\t\t});\n\t\t} else item.id = obj.id; //row ids\n\t\treturn item;\n\t}\n\t/**\n\t * Prepares a storage for raw data before aggregation\n\t * @param {Array} data - initial data set\n\t * @returns {Object} object with storage data and parameters\n\t */\n\tgetTable(data) {\n\t\tconst fields = this.getFields(data[0]);\n\t\tthis._state.fields = fields;\n\t\tthis._data = data = this.prepareData(data, fields);\n\n\t\treturn {\n\t\t\tid: \"webixpivot\",\n\t\t\tprepare: true,\n\t\t\tdriver: \"raw\", //or \"columns\"\n\t\t\tfields: webix.copy(fields),\n\t\t\tdata,\n\t\t};\n\t}\n\t/**\n\t * Prepares data: parse dates, values template\n\t * @param {Array} data - initial data set\n\t * @returns {Array} data ready to parse\n\t */\n\tprepareData(data, fields) {\n\t\tfields = fields.filter(field => field.prepare || field.type == \"date\");\n\n\t\tif (fields.length) {\n\t\t\tdata = data.map(item => {\n\t\t\t\tfields.forEach(field => {\n\t\t\t\t\titem[field.id] = field.prepare\n\t\t\t\t\t\t? field.prepare(item[field.id])\n\t\t\t\t\t\t: new Date(item[field.id]);\n\t\t\t\t});\n\t\t\t\treturn item;\n\t\t\t});\n\t\t}\n\n\t\treturn data;\n\t}\n\t/**\n\t * Gets field values\n\t * @param {string} field name\n\t * @returns {Promise} promise that resolves with field values\n\t */\n\tcollectFieldValues(field) {\n\t\tif (this._filtersHash[field])\n\t\t\treturn webix.promise.resolve(this._filtersHash[field]);\n\n\t\tconst app = this._app;\n\t\tif (app.config.externalProcessing)\n\t\t\treturn (this._filtersHash[field] = app\n\t\t\t\t.getService(\"backend\")\n\t\t\t\t.collectFieldValues(field));\n\n\t\tconst fieldObj = this.getField(field);\n\n\t\tconst hash = {};\n\t\tconst values = [];\n\t\tfor (let i = 0; i < this._data.length; i++) {\n\t\t\tlet value = this._data[i][field];\n\t\t\tif (value || value === 0) {\n\t\t\t\tlet label = value;\n\n\t\t\t\tif (fieldObj.type == \"date\") value = value.valueOf();\n\n\t\t\t\tif (!hash[value]) {\n\t\t\t\t\thash[value] = true;\n\n\t\t\t\t\tif (fieldObj.predicate)\n\t\t\t\t\t\tlabel = app.config.predicates[fieldObj.predicate](label);\n\n\t\t\t\t\tvalues.push({ value, id: value, label });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._filtersHash[field] = values;\n\t\treturn webix.promise.resolve(values);\n\t}\n\t/**\n\t * Apply custom fields names and methods locale to complex math\n\t * @param {String} complex math\n\t * @returns {String} complex math with correct fields and math methods names\n\t */\n\tfixMath(math) {\n\t\tconst _ = this._app.getService(\"locale\")._;\n\n\t\tconst fields = this._state.fields;\n\t\tconst fieldsRegex = new RegExp(\n\t\t\tfields.map(field => \"\\\\b\" + field.id + \"\\\\b(?!\\\\()\").join(\"|\"),\n\t\t\t\"g\"\n\t\t);\n\n\t\tconst methods = this.operations;\n\t\tconst methodsRegex = new RegExp(\n\t\t\tmethods.map(method => \"\\\\b\" + method.id + \"\\\\b\\\\(\").join(\"|\"),\n\t\t\t\"g\"\n\t\t);\n\n\t\treturn math\n\t\t\t.replaceAll(fieldsRegex, id => fields.find(obj => obj.id == id).value)\n\t\t\t.replaceAll(\n\t\t\t\tmethodsRegex,\n\t\t\t\tmethod => _(method.substring(0, method.length - 1)) + \"(\"\n\t\t\t);\n\t}\n\t/**\n\t * Finds field\n\t * @param {String} field id\n\t * @returns {Object} field\n\t */\n\tgetField(id) {\n\t\treturn this._state.fields.find(obj => obj.id == id);\n\t}\n\t/**\n\t * Finds operation\n\t * @param {String} operation id\n\t * @returns {Object} operation\n\t */\n\tgetOperation(id) {\n\t\treturn this.operations.find(obj => obj.id == id);\n\t}\n\t/**\n\t * Returns columns for aggregation\n\t * @returns {Array} array of field names for columns\n\t */\n\tgetColumns() {\n\t\tconst struct = this._state.structure;\n\t\tif (this._state.mode == \"chart\" && struct.groupBy) return [struct.groupBy];\n\t\telse return struct.columns;\n\t}\n\t/**\n\t * Returns for aggregation\n\t * @returns {Array} array of field names for rows\n\t */\n\tgetRows() {\n\t\treturn this._state.mode == \"chart\" ? [] : this._state.structure.rows;\n\t}\n\t/** Sets limits for raw and output data\n\t * @returns {Object} object with limits. By default math engine uses\n\t * { rows: 10000, columns: 5000, raws: Infinity }\n\t */\n\tgetLimits() {\n\t\treturn {};\n\t}\n\t/**\n\t * Prepares table header\n\t * @param {Object} hdata - object with header config\n\t * @returns {Array} array with header lines\n\t */\n\tgetHeader(hdata) {\n\t\tconst header = hdata.data;\n\t\tconst rows = [];\n\n\t\thdata.nonEmpty.forEach((v, i) => {\n\t\t\trows.push({\n\t\t\t\tid: v + 1,\n\t\t\t\theader: header.map(h => {\n\t\t\t\t\th =\n\t\t\t\t\t\th[i] && !webix.isUndefined(h[i].text) ? h[i] : { text: h[i] || \"\" };\n\t\t\t\t\tconst op = hdata.meta[i] && hdata.meta[i].operation;\n\t\t\t\t\tif (op) h.operation = op;\n\t\t\t\t\treturn h;\n\t\t\t\t}),\n\t\t\t\tformat: hdata.meta[i] && hdata.meta[i].format,\n\t\t\t});\n\t\t});\n\n\t\treturn rows;\n\t}\n\t/**\n\t * Sets dimensions based on rows/columns from structure\n\t */\n\tsetDimensions() {\n\t\tthis._reng.resetDimensions();\n\t\tconst columns = this.getColumns();\n\t\tconst fields = columns.concat(this.getRows() || []);\n\n\t\tfor (let i = 0; i < fields.length; i++) {\n\t\t\tconst field = this.getField(fields[i]);\n\t\t\tthis._reng.addDimension({\n\t\t\t\tid: fields[i],\n\t\t\t\ttable: this._table.id,\n\t\t\t\tlabel: fields[i],\n\t\t\t\trule: {\n\t\t\t\t\tby: field.predicate ? `${field.predicate}(${fields[i]})` : fields[i],\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\t/**\n\t * Prepares chart data\n\t * @param {Object} res - object with groupped data\n\t * @param {Object} result - object with aggregated data and its parameters\n\t * @returns {Array} array with chart data\n\t */\n\tgetChartData(result, header) {\n\t\tconst state = this._state;\n\t\tconst ops = state.structure.values;\n\n\t\tlet data = [];\n\t\tlet values = [];\n\n\t\tif (result.data.length) {\n\t\t\tconst chartType = state.chart.type;\n\t\t\tconst groupBy = state.structure.groupBy;\n\n\t\t\tconst first = webix.copy(result.data[0]);\n\t\t\tconst axis = groupBy ? header.data[0] : first.map(() => \"\");\n\n\t\t\tlet count = 0;\n\t\t\twhile (first.length) {\n\t\t\t\tlet item = first.splice(0, ops.length);\n\t\t\t\tif (item.length) {\n\t\t\t\t\tlet text = axis[count].text;\n\t\t\t\t\tif (text === 0) text = \"0\";\n\n\t\t\t\t\tif (chartType == \"pie\" || chartType == \"donut\") {\n\t\t\t\t\t\tfor (let i = 0; i < item.length; i++)\n\t\t\t\t\t\t\titem[i] = { value: item[i], color: ops[i].color };\n\n\t\t\t\t\t\tif (groupBy)\n\t\t\t\t\t\t\tdata.push({\n\t\t\t\t\t\t\t\ttext: text || axis[count],\n\t\t\t\t\t\t\t\tcolor: this.getValueColor(count / ops.length, true),\n\t\t\t\t\t\t\t\tdata: item,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\telse data = item;\n\t\t\t\t\t} else {\n\t\t\t\t\t\titem.push(text || axis[count]);\n\t\t\t\t\t\tdata.push(item);\n\t\t\t\t\t}\n\t\t\t\t\tcount += ops.length;\n\t\t\t\t} else break;\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < ops.length; i++) {\n\t\t\tconst op = ops[i];\n\n\t\t\tlet name = op.operation == \"complex\" ? op.math : op.name;\n\t\t\tname = Array.isArray(name) ? name.join(\",\") : name;\n\n\t\t\tvalues.push({\n\t\t\t\ttext: name || op.operation,\n\t\t\t\toperation: op.operation,\n\t\t\t\tcolor: op.color,\n\t\t\t});\n\t\t}\n\n\t\treturn { data, values };\n\t}\n\t/**\n\t * Gets built-in colors for chart values\n\t * @param {boolean} pieGroup - is palette for pie group (customizations)\n\t * @returns {Array} color palette\n\t */\n\tgetPalette() {\n\t\treturn [\n\t\t\t[\"#e33fc7\", \"#a244ea\", \"#476cee\", \"#36abee\", \"#58dccd\", \"#a7ee70\"],\n\t\t\t[\"#d3ee36\", \"#eed236\", \"#ee9336\", \"#ee4339\", \"#595959\", \"#b85981\"],\n\t\t\t[\"#c670b8\", \"#9984ce\", \"#b9b9e2\", \"#b0cdfa\", \"#a0e4eb\", \"#7faf1b\"],\n\t\t\t[\"#b4d9a4\", \"#f2f79a\", \"#ffaa7d\", \"#d6806f\", \"#939393\", \"#d9b0d1\"],\n\t\t\t[\"#780e3b\", \"#684da9\", \"#242464\", \"#205793\", \"#5199a4\", \"#065c27\"],\n\t\t\t[\"#54b15a\", \"#ecf125\", \"#c65000\", \"#990001\", \"#363636\", \"#800f3e\"],\n\t\t];\n\t}\n\t/**\n\t * Gets a color from the palette\n\t * @param {number} i - row number of the required value\n\t * @param {boolean} pieGroup - is palette for pie group (customizations)\n\t * @returns {string} HEX color\n\t */\n\tgetValueColor(i, pieGroup) {\n\t\tconst palette = this.getPalette(pieGroup);\n\t\tlet rowIndex = i / palette[0].length;\n\t\trowIndex = rowIndex == palette.length ? 0 : parseInt(rowIndex, 10);\n\t\tconst columnIndex = i % palette[0].length;\n\t\treturn palette[rowIndex][columnIndex];\n\t}\n\n\tclearAll() {\n\t\t// fields\n\t\tthis._app.config.fields = null;\n\t\tthis._state.fields = [];\n\t\t// structure\n\t\tthis._app.setStructure({});\n\t\t// reset aggregated data/table config\n\t\tdelete this._table;\n\t\tthis._store = this.getPivotData();\n\t\tthis._data = [];\n\t\tthis._filtersHash = {};\n\t}\n}\n","export default class Backend {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t * @param {string} url - the URL to load/save data\n\t */\n\tconstructor(app, url) {\n\t\tthis.app = app;\n\t\tthis._url = url;\n\t}\n\t/**\n\t * Prepares url\n\t * @param {string} path - end of url\n\t * @returns {string} ready url\n\t */\n\turl(path) {\n\t\treturn this._url + (path || \"\");\n\t}\n\t/**\n\t * Gets data from backend\n\t * @returns {Promise} response from server\n\t */\n\tdata() {\n\t\tlet config;\n\t\tlet url = this.url();\n\n\t\tif (this.app.config.externalProcessing) {\n\t\t\turl += \"/data\";\n\t\t\tconst state = this.app.getState();\n\t\t\tconst mode = state.mode;\n\n\t\t\tconfig = {\n\t\t\t\tstructure: state.structure,\n\t\t\t\tmode,\n\t\t\t};\n\n\t\t\tif (mode != \"chart\") config.table = state.datatable;\n\t\t}\n\n\t\treturn webix.ajax(url, config).then(res => res.json());\n\t}\n\t/**\n\t * Gets field values from backend\n\t * @returns {Promise} response from server\n\t */\n\tcollectFieldValues(field) {\n\t\treturn webix.ajax(this.url(\"/fields/\" + field)).then(res => res.json());\n\t}\n}\n","import { JetApp, plugins, EmptyRouter } from \"webix-jet\";\nimport { initJetWin } from \"@xbs/jet-helpers\";\nimport { createState, link } from \"jet-restate\";\n\nimport views from \"./export_views\";\nimport en from \"locales/en\";\n\nimport LocalData from \"models/LocalData\";\nimport Backend from \"./models/Backend\";\n\nexport class App extends JetApp {\n\tconstructor(config) {\n\t\tconst mode = config.mode || \"tree\";\n\t\tlet structure = config.structure || {};\n\n\t\tconst chart = config.chart || {};\n\t\twebix.extend(chart, { type: \"bar\", scale: \"linear\", lines: true });\n\t\tdelete chart.id;\n\n\t\tconst datatable = config.datatable || {};\n\t\tdelete datatable.id;\n\n\t\tconst state = createState({\n\t\t\tmode,\n\t\t\tstructure,\n\t\t\treadonly: config.readonly || false,\n\t\t\tfields: config.fields || [],\n\t\t\tdatatable,\n\t\t\tchart,\n\t\t\tconfig: false,\n\t\t});\n\n\t\tconst defaults = {\n\t\t\trouter: EmptyRouter,\n\t\t\tversion: VERSION,\n\t\t\tdebug: DEBUG,\n\t\t\tcompactWidth: 720,\n\t\t\tstart: \"main/\" + (mode == \"chart\" ? \"chart\" : \"table\"),\n\t\t\tparams: { state, forceCompact: config.compact },\n\t\t};\n\n\t\tsuper({ ...defaults, ...config });\n\n\t\t// order matters!\n\t\tthis.setService(\n\t\t\t\"backend\",\n\t\t\tnew (this.dynamic(Backend))(this, this.config.url)\n\t\t);\n\t\tthis.setService(\"local\", new (this.dynamic(LocalData))(this, config));\n\t\tinitJetWin(this);\n\n\t\tstructure = this.prepareStructure(structure, true);\n\n\t\tthis.use(\n\t\t\tplugins.Locale,\n\t\t\tthis.config.locale || {\n\t\t\t\tlang: \"en\",\n\t\t\t\twebix: {\n\t\t\t\t\ten: \"en-US\",\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tdynamic(obj) {\n\t\treturn this.config.override ? this.config.override.get(obj) || obj : obj;\n\t}\n\n\trequire(type, name) {\n\t\tif (type === \"jet-views\") return views[name];\n\t\telse if (type === \"jet-locales\") return locales[name];\n\n\t\treturn null;\n\t}\n\n\tgetState() {\n\t\treturn this.config.params.state;\n\t}\n\n\tsetStructure(structure) {\n\t\tthis.getState().structure = this.prepareStructure(structure);\n\t}\n\n\tgetStructure() {\n\t\treturn this.getState().structure;\n\t}\n\n\tprepareStructure(structure, initial) {\n\t\tconst mode = this.getState().mode;\n\n\t\twebix.extend(structure, {\n\t\t\trows: [],\n\t\t\tcolumns: [],\n\t\t\tvalues: [],\n\t\t\tfilters: [],\n\t\t});\n\n\t\t/* sync columns and groupBy depending on current mode*/\n\t\tif (initial) {\n\t\t\tif ((mode != \"chart\" || !structure.groupBy) && structure.columns.length)\n\t\t\t\tstructure.groupBy = structure.columns[0];\n\t\t\telse if (structure.groupBy) structure.columns = [structure.groupBy];\n\t\t} else {\n\t\t\tif (mode != \"chart\") structure.groupBy = structure.columns[0];\n\t\t\telse {\n\t\t\t\tif (!structure.groupBy) structure.columns = [];\n\t\t\t\telse if (structure.columns[0] !== structure.groupBy)\n\t\t\t\t\tstructure.columns = [structure.groupBy];\n\t\t\t}\n\t\t}\n\n\t\tconst values = [];\n\n\t\t/* backward compatibility: \n\t\t\tturn values like {name:\"balance\", operation:[\"min\",\"max\"]}\n\t\t\tinto {name:\"balance\", operation:\"min\"}, {name:\"balance\", operation:\"max\"}\n\t\t*/\n\t\tfor (let i = 0; i < structure.values.length; i++) {\n\t\t\tconst value = structure.values[i];\n\t\t\tif (webix.isArray(value.operation)) {\n\t\t\t\tvalue.color =\n\t\t\t\t\t(webix.isArray(value.color) ? value.color : [value.color]) || [];\n\t\t\t\tfor (let i = 0; i < value.operation.length; i++) {\n\t\t\t\t\tconst obj = { ...value };\n\t\t\t\t\tobj.operation = value.operation[i];\n\t\t\t\t\tobj.color = value.color && value.color[i];\n\n\t\t\t\t\tvalues.push(obj);\n\t\t\t\t}\n\t\t\t} else values.push(value);\n\t\t}\n\n\t\tfor (let i = 0; i < values.length; i++) {\n\t\t\tconst local = this.getService(\"local\");\n\n\t\t\t//assign colors for values if missing\n\t\t\tif (!values[i].color) values[i].color = local.getValueColor(i);\n\n\t\t\t//backward compatibility for complex math\n\t\t\tif (!values[i].name && !values[i].math) {\n\t\t\t\tvalues[i].math = values[i].operation;\n\t\t\t\tvalues[i].operation = \"complex\";\n\t\t\t}\n\t\t\t//operation with more than 2 fields\n\t\t\telse if (local.getOperation(values[i].operation).fields > 2) {\n\t\t\t\tconst name = values[i].name;\n\t\t\t\tvalues[i].math = `${values[i].operation}(${\n\t\t\t\t\twebix.isArray(name) ? name.join() : name\n\t\t\t\t})`;\n\t\t\t\tvalues[i].operation = \"complex\";\n\t\t\t}\n\t\t}\n\t\tstructure.values = values;\n\n\t\treturn structure;\n\t}\n}\n\nwebix.protoUI(\n\t{\n\t\tname: \"pivot\",\n\t\tapp: App,\n\t\tdefaults: {\n\t\t\tborderless: false,\n\t\t},\n\t\t$init: function() {\n\t\t\tthis.name = \"pivot\";\n\n\t\t\tthis.$view.className += \" webix_pivot\";\n\n\t\t\tconst state = this.$app.getState();\n\t\t\tfor (let key in state) {\n\t\t\t\tlink(state, this.config, key);\n\t\t\t}\n\n\t\t\tthis.$app.attachEvent(\"filter:change\", (field, value) =>\n\t\t\t\tthis.callEvent(\"onFilterChange\", [field, value])\n\t\t\t);\n\t\t},\n\t\t$exportView: function(options) {\n\t\t\tconst exportView = this.$app.getRoot().queryView({ $mainView: true });\n\n\t\t\treturn exportView.$exportView\n\t\t\t\t? exportView.$exportView(options)\n\t\t\t\t: exportView;\n\t\t},\n\t\tgetState() {\n\t\t\treturn this.$app.getState();\n\t\t},\n\t\tgetService(name) {\n\t\t\treturn this.$app.getService(name);\n\t\t},\n\t\tsetStructure: function(structure) {\n\t\t\tthis.$app.setStructure(structure);\n\t\t},\n\t\tgetStructure: function() {\n\t\t\treturn this.$app.getStructure();\n\t\t},\n\t\tclearAll: function() {\n\t\t\tthis.$app.getService(\"local\").clearAll();\n\t\t},\n\t},\n\twebix.ui.jetapp\n);\n\n// re-export for customization\nconst services = { Backend, LocalData };\nconst locales = { en };\nexport { views, services, locales };\n","export default {\n\t//general\n\tDone: \"Done\",\n\tTable: \"Table\",\n\tTree: \"Tree\",\n\tChart: \"Chart\",\n\t\"Click to configure\": \"Click to configure\",\n\t\"Configure Pivot\": \"Configure Pivot\",\n\tTotal: \"Total\",\n\t//settings\n\tFields: \"Fields\",\n\tMethods: \"Methods\",\n\tColumns: \"Columns\",\n\t\"Add column\": \"Add column\",\n\tRows: \"Rows\",\n\t\"Add row\": \"Add row\",\n\t\"Clean rows\": \"Clean rows\",\n\tFilters: \"Filters\",\n\t\"Add filter\": \"Add filter\",\n\t\"Group By\": \"Group By\",\n\t\"Chart type\": \"Chart type\",\n\t\"Logarithmic scale\": \"Logarithmic scale\",\n\t\"X axis title\": \"X axis title\",\n\t\"Y axis title\": \"Y axis title\",\n\t\"Scale color\": \"Scale color\",\n\t\"Circled lines\": \"Circled lines\",\n\tHorizontal: \"Horizontal\",\n\tStacked: \"Stacked\",\n\tLines: \"Lines\",\n\tLine: \"Line\",\n\tRadar: \"Radar\",\n\tBar: \"Bar\",\n\tArea: \"Area\",\n\tSpline: \"Spline\",\n\t\"Spline Area\": \"Spline Area\",\n\tPie: \"Pie\",\n\tDonut: \"Donut\",\n\tValues: \"Values\",\n\t\"Add value\": \"Add value\",\n\t\"Field not defined\": \"Field not defined\",\n\tHighlight: \"Highlight\",\n\t\"Min X\": \"Min X\",\n\t\"Max X\": \"Max X\",\n\t\"Min Y\": \"Min Y\",\n\t\"Max Y\": \"Max Y\",\n\tFooter: \"Footer\",\n\t\"Total Column\": \"Total Column\",\n\tOff: \"Off\",\n\tOn: \"On\",\n\t\"Sum Only\": \"Sum Only\",\n\t\"3D\": \"3D\",\n\t\"Show values inside\": \"Show values inside\",\n\t//operations\n\tcount: \"count\",\n\tmax: \"max\",\n\tmin: \"min\",\n\tavg: \"avg\",\n\twavg: \"wavg\",\n\tany: \"any\",\n\tsum: \"sum\",\n\tcomplex: \"complex\",\n\t\"Incorrect formula in values\": \"Incorrect formula in values\",\n};\n"],"names":["NavigationBlocked","JetBase","[object Object]","webix","config","this","webixJet","_events","_subs","_data","params","extend","_root","_detachEvents","_destroySubs","_container","app","_parent","id","value","url","_segment","update","show","parent","view","getParentView","getParam","suburl","toString","root","getRoot","queryView","obj","localId","$scope","name","code","attachEvent","push","key","kid","contains","sub","getSubViewInfo","subview","popup","events","i","length","detachEvent","subView","destructor","current","default","branch","child","_getDefaultSub","_routed_view","parse","substr","parts","split","chunks","test","result","pos","indexOf","param","dchunk","decodeURIComponent","page","isNew","url2str","stack","chunk","obj2str","join","str","encodeURIComponent","Route","route","index","_next","path","slice","setParams","old","kids","reset","concat","_join","Promise","res","rej","redirect","confirm","resolve","callEvent","catch","err","then","n","JetView","super","_children","ui","container","jetview","createView","render","setParam","target","_renderFrameLock","_show","segment","_init_url_data","_urlChange","linkRouter","getRouter","set","silent","_$view","_$","_$url","message","destroy","_destroyKids","plugin","getUrl","tagName","refresh","_render","document","body","toNode","cfg","_render_final","response","slot","$$","reject","copyConfig","oldui","asWin","setPosition","isVisible","_init","_initUrl","ready","e","_initError","init","waits","frame","wait","all","urlChange","lock","_renderFrame","next","_createSubView","shift","_override","error","createFromURL","uis","JetViewRaw","_ui","SubRouter","cb","a","append","_once","JetAppBase","window","version","start","_services","EventSystem","_subSegment","handler","getSubView","prototype","$subview","addSubView","isArray","Array","method","point","DataCollection","RegExp","Map","Date","copy","$router","srcElement","getAttribute","trigger","_forView","cancelBubble","preventDefault","parentNode","clickHandler","views","_loadError","Error","hidden","replace","require","module","__esModule","loadView","over","override","dv","get","router","rest","apply","data","bind","er","debug","console","text","innerHTML","type","expire","event","_first_start","top","base","setTimeout","animation","node","html","addCss","removeCss","now","urlString","template","uid","HashRouter","_detectPrefix","onpopstate","routes","compare","history","pushState","prefix","sufix","_getRaw","routerPrefix","location","href","isPatched","patch","w","win","promise","freeze","some","$freeze","resize","baseAdd","baselayout","addView","baseRemove","removeView","jview","subs","arguments","layout","protoUI","$app","$ready","proxy","JetApp","EmptyRouter","_$config","has","store","Object","hasOwnProperty","call","forEach","context","warn","x","String","russianPluralGroups","end","pluralTypes","arabic","lastTwo","bosnian_serbian","chinese","croatian","french","german","russian","lithuanian","czech","polish","icelandic","slovenian","pluralTypeToLanguages","pluralTypeName","locale","ret","langToPluralType","langs","lang","en","escape","token","dollarRegex","defaultTokenRegex","transformPhrase","phrase","substitutions","tokenRegex","TypeError","interpolationRegex","options","smart_count","texts","count","pluralTypeIndex","expression","argument","Polyglot","opts","phrases","currentLocale","allowMissing","onMissingKey","suffix","RangeError","constructTokenRegex","interpolation","newLocale","morePhrases","prefixedKey","unset","clear","newPhrases","t","_","webixPolyglot","plugins","_view","storage","setLangData","pconfig","polyglot","poly","service","put","locName","i18n","setLocale","setLang","getLang","setService","once","setSize","appView","appWidth","$width","appHeight","$height","_fillApp","define","width","height","left","setHandlers","$destructed","$view","enable","resizeEv","link","source","defineProperty","createState","handlers","out","observe","mask","undefined","queue","waitInQueue","notify","meta","list","keys","enumerable","configurable","values","sconfig","nested","reactive","$extend","val","valueOf","$reorderOnly","$drag","object","ctx","DragControl","getContext","from","local","getService","getChildViews","getValues","operation","fixMath","math","getField","name2","askin","skin","$active","inputHeight","icon","portlet","Property","plusLabel","field","borderless","paddingY","rows","css","inputPadding","onClick","webix_pivot_handle_add_value","forms","Add","input","focus","triggerEvent","getInputNode","getState","fields","hide","on","GetValue","active","_activeInput","wavg","getFormView","elements","getValue","corrections","GetCorrections","CheckCorrections","structure","getStructure","j","arr","form","external","mode","paddingX","margin","cols","ItemConfig","onChange","PrepareValue","onBeforeShow","master","getList","filter","FilterSuggest","ListTemplate","pivotPropertyRemove","click","activeVal","find","item","isSymbolAllowed","char","charCodeAt","getLastSymbolIndex","right","startsWith","toLowerCase","getSelectedId","select","order","_addFirst","suggest","$enterKey","delay","defaults","editor","cursor","selectionStart","substring","search","nextSymbol","charAt","disabled","operations","className","suggestClick","activeElement","UIManager","getFocus","setValue","setValueHere","formula","str1","str2","lastSymbol","$setValue","setSelectionRange","ValuesProperty","Local","typeName","map","State","$changes","ToggleColors","isUndefined","OutComplexMath","def","defaultOperation","defIndex","Math","max","findIndex","splice","v","SetOperation","getOperation","SuggestData","mini","$name","palette","getPalette","color","getValueColor","$css","fieldsRegex","fieldsMatch","matchAll","match","methods","methodsRegex","methodsMatch","GroupProperty","padding","oldValue","ChartSettings","complexData","elementsConfig","labelWidth","label","batch","editable","labelRight","checkValue","uncheckValue","OutValues","innerChange","chart","assign","HandleVisibility","setValues","InValues","showBatch","bar","stackedArea","stacked","horizontal","toUpperCase","TableSettings","datatable","footer","totalColumn","FilterView","state","filters","exists","inner","filterObj","getBody","collectFieldValues","clearAll","ModeView","Compact","toolbarHeight","align","optionWidth","o","c","SetMode","dataPadding","unshift","ToolbarView","buttonHeight","onItemClick","ToggleConfig","getTextSize","webix_pivot_settings","tooltip","scrollSize","env","$customScroll","_GetScrollWidth","addStyle","GetFilters","filterPopup","filtersView","FiltersChanged","ToggleReadonly","oldStructure","JSON","stringify","FilterConfig","scroll","bottom","activeCss","includes","condition","webix_pivot_filter","Show","outer","create","style","appendChild","scrollbarWidth","offsetWidth","removeChild","$mainView","xAxis","yAxis","commonAxisSettings","lines","scaleColor","lineColor","IsPieBased","multilevel","ValueFormat","pieInnerText","LoadData","getData","UpdateChart","removeAllSeries","SetSeries","SetLegend","addSeries","GetSeriesConfig","settings","alpha","borderColor","line","legend","valign","parseFloat","toFixed","hotkey","autowidth","ToggleForm","multi","GroupConfig","_v","HandleFieldChange","SetValues","oldMode","isChart","SetValue","CorrectFilters","CorrectInputs","setStructure","header","columns","groupBy","inputs","updateConfig","fullscreen","head","m3","m4","m5","m6","m7","m8","_compactValue","_compactHandler","_app","_forceCompact","forceCompact","_compactWidth","compactWidth","_checkTrigger","y","$setSize","fCompact","maxWidth","sizeTrigger","SetCompactMode","ShowConfig","HideConfig","exit","m10","table","leftSplit","resizeColumn","UpdateTable","CheckFreeze","rightSplit","totalCols","totalOps","vals","total","lastId","colspan","totalIndex","_store","_prepareData","SetColumns","marks","refreshColumns","Proxy","prop","isNaN","open","r","freezeColumns","compact","SetFirstColumn","sort","format","CellFormat","cssFormat","row","rid","cid","col","h","HeaderTemplate","column","common","treetable","m12","asc","b","desc","DataDimension","_sort","_label","_meta","_table","_getter","_prepared","_indexes","_values","_prepareOptions","_keys","fSize","indexes","DataExport","pivot","_pivot","cleanRows","ops","maxRow","getLimit","resetCursor","Set","rAggr","rowData","cAggr","scaleWidth","getWidth","_cleanRows","columnData","aggregateColumns","mark","getXHeader","rowsLength","prev","Function","propertyName","methodName","contextName","s","u","f","property","optimize","allMath","getMath","to","array","size","temp","getter","cache","optimizeRangeGroup","range","optimizeGroup","rule","getColumn","and","buildFinder","check","step","build","DataPivot","_rows","_cols","_dims","_context","_cursor","_order","_base_order","getIndexes","_group","_nextRow","_nextColumn","_ops","dimsSize","_fillRow","dimSize","dimOutSize","levels","_groupOps","_groupLength","limit","min","_sizes","getSize","closeLevels","kAgr","vAgr","z","level","last","tree","_fillGroupRow","hConfig","_opInfo","nonEmpty","isNested","rpref","ostep","unitsInParent","reduce","fullLength","unitSizes","ind","floor","opNames","rowspan","getLabel","metaLine","getMeta","rules","_masterRules","p","_groupResultOps","branchMode","branchMath","_rowResultOps","compactOps","op","_rowOps","_colResultOps","_colOps","_marks","_setSizes","dmr","opsLength","k","cell","rarr","_fillGroupRowInner","rl","collectRaggr","ctemp","cfrom","cind","cto","add","opset","dataset","raws","dimsData","ok","sizes","sum","kind","optimizer","getName","as","trim","RawTable","_columns","_raw","_parse_inner","dataLength","columnsLength","setter","ColumnTable","_parse_init","round","acc","avg","summ","any","eq","neq","gt","gte","lt","lte","in","hasPrefix","predicates","year","getFullYear","month","getMonth","day","getDate","hour","getHours","minute","getMinutes","Analytic","_tables","_dimensions","_preds","_maths","_comps","tables","addTable","dimensions","addDimension","_predicateGetter","by","preserve","used","driver","prepare","rDims","cDims","Infinity","fn","LocalData","_filtersHash","_state","externalProcessing","_setOperations","_initRengine","extraOperations","_reng","addMath","totalOperations","addComparator","addPredicate","firstRow","dataType","force","useOldData","_dataLoad","_rengineToWebix","getTable","getPivotData","loadError","finally","newConfig","_old","rengine.Analytic","_setFilters","_setTotalOperations","_setPredicates","setDimensions","getRows","getColumns","getLimits","getOps","headerConfig","toArray","toNested","toXHeader","isComplex","group","_updateTotalMath","minY","maxY","minX","maxX","getChartData","getHeader","_toTree","getFields","prepareData","fieldObj","hash","predicate","replaceAll","struct","hdata","resetDimensions","chartType","first","axis","pieGroup","rowIndex","parseInt","columnIndex","Backend","_url","ajax","json","App","scale","readonly","dynamic","appId","appNode","firstShow","defaultHandler","onShow","disable","initJetWin","prepareStructure","use","locales","initial","$init","$exportView","exportView","jetapp","services","Done","Table","Tree","Chart","Click to configure","Configure Pivot","Total","Fields","Methods","Columns","Add column","Rows","Add row","Clean rows","Filters","Add filter","Group By","Chart type","Logarithmic scale","X axis title","Y axis title","Scale color","Circled lines","Horizontal","Stacked","Lines","Line","Radar","Bar","Area","Spline","Spline Area","Pie","Donut","Values","Add value","Field not defined","Highlight","Min X","Max X","Min Y","Max Y","Footer","Total Column","Off","On","Sum Only","3D","Show values inside","complex","Incorrect formula in values"],"mappings":"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"}