<<<<<<< HEAD
{"version":3,"file":"scheduler.min.js","sources":["../node_modules/webix-jet/dist/es6/jet.js","../node_modules/jet-restate/index.js","../sources/views/bars/add.js","../sources/views/bars/date.js","../sources/views/bars/nav.js","../sources/helpers/palette.js","../sources/views/side/editor.js","../sources/views/side/popup.js","../sources/views/side/index.js","../sources/views/bars/navpopup.js","../sources/views/bars/index.js","../sources/views/event/actionmenu.js","../sources/helpers/ical.js","../sources/helpers/recurring.js","../sources/views/event/recurringform.js","../sources/helpers/editrecurring.js","../sources/views/event/form.js","../sources/views/event/formpopup.js","../sources/views/event/info.js","../sources/views/modes/common/actionpopup.js","../sources/helpers/responsive.js","../sources/views/main.js","../sources/helpers/templates.js","../sources/helpers/dates.js","../sources/views/modes/common/unitlist.js","../sources/views/modes/agenda/index.js","../sources/views/modes/common/hourscale.js","../sources/views/modes/common/multimore.js","../sources/helpers/selection.js","../sources/helpers/resizer.js","../sources/helpers/dnd.js","../sources/views/modes/day/events.js","../sources/views/modes/day/multiday.js","../sources/views/modes/day/index.js","../sources/views/modes/month/compact.js","../sources/views/modes/month/more.js","../sources/views/modes/month/events.js","../sources/views/modes/month/header.js","../sources/views/modes/month/list.js","../sources/views/modes/month/index.js","../sources/views/modes/week/compact.js","../sources/views/modes/week/header.js","../sources/views/modes/week/multiday.js","../sources/views/modes/week/index.js","../sources/export_views.js","../sources/models/LocalData.js","../sources/models/Operations.js","../sources/models/Backend.js","../sources/app.js","../sources/locales/en.js"],"sourcesContent":["class NavigationBlocked {\r\n}\n\nclass JetBase {\r\n    constructor(webix, config) {\r\n        this.webixJet = true;\r\n        this.webix = webix;\r\n        this._events = [];\r\n        this._subs = {};\r\n        this._data = {};\r\n        if (config && config.params)\r\n            webix.extend(this._data, config.params);\r\n    }\r\n    getRoot() {\r\n        return this._root;\r\n    }\r\n    destructor() {\r\n        this._detachEvents();\r\n        this._destroySubs();\r\n        this._events = this._container = this.app = this._parent = this._root = null;\r\n    }\r\n    setParam(id, value, url) {\r\n        if (this._data[id] !== value) {\r\n            this._data[id] = value;\r\n            this._segment.update(id, value, 0);\r\n            if (url) {\r\n                return this.show(null);\r\n            }\r\n        }\r\n    }\r\n    getParam(id, parent) {\r\n        const value = this._data[id];\r\n        if (typeof value !== \"undefined\" || !parent) {\r\n            return value;\r\n        }\r\n        const view = this.getParentView();\r\n        if (view) {\r\n            return view.getParam(id, parent);\r\n        }\r\n    }\r\n    getUrl() {\r\n        return this._segment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._segment.toString();\r\n    }\r\n    getParentView() {\r\n        return this._parent;\r\n    }\r\n    $$(id) {\r\n        if (typeof id === \"string\") {\r\n            const root = this.getRoot();\r\n            return root.queryView((obj => (obj.config.id === id || obj.config.localId === id) &&\r\n                (obj.$scope === root.$scope)), \"self\");\r\n        }\r\n        else {\r\n            return id;\r\n        }\r\n    }\r\n    on(obj, name, code) {\r\n        const id = obj.attachEvent(name, code);\r\n        this._events.push({ obj, id });\r\n        return id;\r\n    }\r\n    contains(view) {\r\n        for (const key in this._subs) {\r\n            const kid = this._subs[key].view;\r\n            if (kid === view || kid.contains(view)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    getSubView(name) {\r\n        const sub = this.getSubViewInfo(name);\r\n        if (sub) {\r\n            return sub.subview.view;\r\n        }\r\n    }\r\n    getSubViewInfo(name) {\r\n        const sub = this._subs[name || \"default\"];\r\n        if (sub) {\r\n            return { subview: sub, parent: this };\r\n        }\r\n        if (name === \"_top\") {\r\n            this._subs[name] = { url: \"\", id: null, popup: true };\r\n            return this.getSubViewInfo(name);\r\n        }\r\n        // when called from a child view, searches for nearest parent with subview\r\n        if (this._parent) {\r\n            return this._parent.getSubViewInfo(name);\r\n        }\r\n        return null;\r\n    }\r\n    _detachEvents() {\r\n        const events = this._events;\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            events[i].obj.detachEvent(events[i].id);\r\n        }\r\n    }\r\n    _destroySubs() {\r\n        // destroy sub views\r\n        for (const key in this._subs) {\r\n            const subView = this._subs[key].view;\r\n            // it possible that subview was not loaded with any content yet\r\n            // so check on null\r\n            if (subView) {\r\n                subView.destructor();\r\n            }\r\n        }\r\n        // reset to prevent memory leaks\r\n        this._subs = {};\r\n    }\r\n    _init_url_data() {\r\n        const url = this._segment.current();\r\n        this._data = {};\r\n        this.webix.extend(this._data, url.params, true);\r\n    }\r\n    _getDefaultSub() {\r\n        if (this._subs.default) {\r\n            return this._subs.default;\r\n        }\r\n        for (const key in this._subs) {\r\n            const sub = this._subs[key];\r\n            if (!sub.branch && sub.view && key !== \"_top\") {\r\n                const child = sub.view._getDefaultSub();\r\n                if (child) {\r\n                    return child;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _routed_view() {\r\n        const parent = this.getParentView();\r\n        if (!parent) {\r\n            return true;\r\n        }\r\n        const sub = parent._getDefaultSub();\r\n        if (!sub && sub !== this) {\r\n            return false;\r\n        }\r\n        return parent._routed_view();\r\n    }\r\n}\n\nfunction parse(url) {\r\n    // remove starting /\r\n    if (url[0] === \"/\") {\r\n        url = url.substr(1);\r\n    }\r\n    // split url by \"/\"\r\n    const parts = url.split(\"/\");\r\n    const chunks = [];\r\n    // for each page in url\r\n    for (let i = 0; i < parts.length; i++) {\r\n        const test = parts[i];\r\n        const result = {};\r\n        // detect params\r\n        // support old \t\t\tsome:a=b:c=d\r\n        // and new notation\t\tsome?a=b&c=d\r\n        let pos = test.indexOf(\":\");\r\n        if (pos === -1) {\r\n            pos = test.indexOf(\"?\");\r\n        }\r\n        if (pos !== -1) {\r\n            const params = test.substr(pos + 1).split(/[\\:\\?\\&]/g);\r\n            // create hash of named params\r\n            for (const param of params) {\r\n                const dchunk = param.split(\"=\");\r\n                result[dchunk[0]] = decodeURIComponent(dchunk[1]);\r\n            }\r\n        }\r\n        // store parsed values\r\n        chunks[i] = {\r\n            page: (pos > -1 ? test.substr(0, pos) : test),\r\n            params: result,\r\n            isNew: true\r\n        };\r\n    }\r\n    // return array of page objects\r\n    return chunks;\r\n}\r\nfunction url2str(stack) {\r\n    const url = [];\r\n    for (const chunk of stack) {\r\n        url.push(\"/\" + chunk.page);\r\n        const params = obj2str(chunk.params);\r\n        if (params) {\r\n            url.push(\"?\" + params);\r\n        }\r\n    }\r\n    return url.join(\"\");\r\n}\r\nfunction obj2str(obj) {\r\n    const str = [];\r\n    for (const key in obj) {\r\n        if (typeof obj[key] === \"object\")\r\n            continue;\r\n        if (str.length) {\r\n            str.push(\"&\");\r\n        }\r\n        str.push(key + \"=\" + encodeURIComponent(obj[key]));\r\n    }\r\n    return str.join(\"\");\r\n}\n\nclass Route {\r\n    constructor(route, index) {\r\n        this._next = 1;\r\n        if (typeof route === \"string\") {\r\n            this.route = {\r\n                url: parse(route),\r\n                path: route\r\n            };\r\n        }\r\n        else {\r\n            this.route = route;\r\n        }\r\n        this.index = index;\r\n    }\r\n    current() {\r\n        return this.route.url[this.index];\r\n    }\r\n    next() {\r\n        return this.route.url[this.index + this._next];\r\n    }\r\n    suburl() {\r\n        return this.route.url.slice(this.index);\r\n    }\r\n    shift(params) {\r\n        const route = new Route(this.route, this.index + this._next);\r\n        route.setParams(route.route.url, params, route.index);\r\n        return route;\r\n    }\r\n    setParams(url, params, index) {\r\n        if (params) {\r\n            const old = url[index].params;\r\n            for (var key in params)\r\n                old[key] = params[key];\r\n        }\r\n    }\r\n    refresh() {\r\n        const url = this.route.url;\r\n        for (let i = this.index + 1; i < url.length; i++) {\r\n            url[i].isNew = true;\r\n        }\r\n    }\r\n    toString() {\r\n        const str = url2str(this.suburl());\r\n        return str ? str.substr(1) : \"\";\r\n    }\r\n    _join(path, kids) {\r\n        let url = this.route.url;\r\n        if (path === null) { // change of parameters, route elements are not affected\r\n            return url;\r\n        }\r\n        const old = this.route.url;\r\n        let reset = true;\r\n        url = old.slice(0, this.index + (kids ? this._next : 0));\r\n        if (path) {\r\n            url = url.concat(parse(path));\r\n            for (let i = 0; i < url.length; i++) {\r\n                if (old[i]) {\r\n                    url[i].view = old[i].view;\r\n                }\r\n                if (reset && old[i] && url[i].page === old[i].page) {\r\n                    url[i].isNew = false;\r\n                }\r\n                else if (url[i].isNew) {\r\n                    // if some segment was marked as new, all subsegments must be updated as well\r\n                    reset = false;\r\n                }\r\n            }\r\n        }\r\n        return url;\r\n    }\r\n    append(path) {\r\n        const url = this._join(path, true);\r\n        this.route.path = url2str(url);\r\n        this.route.url = url;\r\n        return this.route.path;\r\n    }\r\n    show(path, view, kids) {\r\n        const url = this._join(path.url, kids);\r\n        this.setParams(url, path.params, this.index + (kids ? this._next : 0));\r\n        return new Promise((res, rej) => {\r\n            const redirect = url2str(url);\r\n            const obj = {\r\n                url,\r\n                redirect,\r\n                confirm: Promise.resolve()\r\n            };\r\n            const app = view ? view.app : null;\r\n            // when creating a new route, it possible that it will not have any content\r\n            // guard is not necessary in such case\r\n            if (app) {\r\n                const result = app.callEvent(\"app:guard\", [obj.redirect, view, obj]);\r\n                if (!result) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n            }\r\n            obj.confirm.catch(err => rej(err)).then(() => {\r\n                if (obj.redirect === null) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                if (obj.redirect !== redirect) {\r\n                    app.show(obj.redirect);\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                this.route.path = redirect;\r\n                this.route.url = url;\r\n                res();\r\n            });\r\n        });\r\n    }\r\n    size(n) {\r\n        this._next = n;\r\n    }\r\n    split() {\r\n        const route = {\r\n            url: this.route.url.slice(this.index + 1),\r\n            path: \"\"\r\n        };\r\n        if (route.url.length) {\r\n            route.path = url2str(route.url);\r\n        }\r\n        return new Route(route, 0);\r\n    }\r\n    update(name, value, index) {\r\n        const chunk = this.route.url[this.index + (index || 0)];\r\n        if (!chunk) {\r\n            this.route.url.push({ page: \"\", params: {} });\r\n            return this.update(name, value, index);\r\n        }\r\n        if (name === \"\") {\r\n            chunk.page = value;\r\n        }\r\n        else {\r\n            chunk.params[name] = value;\r\n        }\r\n        this.route.path = url2str(this.route.url);\r\n    }\r\n}\n\nclass JetView extends JetBase {\r\n    constructor(app, config) {\r\n        super(app.webix);\r\n        this.app = app;\r\n        //this.$config = config;\r\n        this._children = [];\r\n    }\r\n    ui(ui, config) {\r\n        config = config || {};\r\n        const container = config.container || ui.container;\r\n        const jetview = this.app.createView(ui);\r\n        this._children.push(jetview);\r\n        jetview.render(container, this._segment, this);\r\n        if (typeof ui !== \"object\" || (ui instanceof JetBase)) {\r\n            // raw webix UI\r\n            return jetview;\r\n        }\r\n        else {\r\n            return jetview.getRoot();\r\n        }\r\n    }\r\n    show(path, config) {\r\n        config = config || {};\r\n        // convert parameters object to url\r\n        if (typeof path === \"object\") {\r\n            for (const key in path) {\r\n                this.setParam(key, path[key]);\r\n            }\r\n            path = null;\r\n        }\r\n        else {\r\n            // deligate to app in case of root prefix\r\n            if (path.substr(0, 1) === \"/\") {\r\n                return this.app.show(path, config);\r\n            }\r\n            // local path, do nothing\r\n            if (path.indexOf(\"./\") === 0) {\r\n                path = path.substr(2);\r\n            }\r\n            // parent path, call parent view\r\n            if (path.indexOf(\"../\") === 0) {\r\n                const parent = this.getParentView();\r\n                if (parent) {\r\n                    return parent.show(path.substr(3), config);\r\n                }\r\n                else {\r\n                    return this.app.show(\"/\" + path.substr(3));\r\n                }\r\n            }\r\n            const sub = this.getSubViewInfo(config.target);\r\n            if (sub) {\r\n                if (sub.parent !== this) {\r\n                    return sub.parent.show(path, config);\r\n                }\r\n                else if (config.target && config.target !== \"default\") {\r\n                    return this._renderFrameLock(config.target, sub.subview, {\r\n                        url: path,\r\n                        params: config.params,\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                if (path) {\r\n                    return this.app.show(\"/\" + path, config);\r\n                }\r\n            }\r\n        }\r\n        return this._show(this._segment, { url: path, params: config.params }, this);\r\n    }\r\n    _show(segment, path, view) {\r\n        return segment.show(path, view, true).then(() => {\r\n            this._init_url_data();\r\n            return this._urlChange();\r\n        }).then(() => {\r\n            if (segment.route.linkRouter) {\r\n                this.app.getRouter().set(segment.route.path, { silent: true });\r\n                this.app.callEvent(\"app:route\", [segment.route.path]);\r\n            }\r\n        });\r\n    }\r\n    init(_$view, _$) {\r\n        // stub\r\n    }\r\n    ready(_$view, _$url) {\r\n        // stub\r\n    }\r\n    config() {\r\n        this.app.webix.message(\"View:Config is not implemented\");\r\n    }\r\n    urlChange(_$view, _$url) {\r\n        // stub\r\n    }\r\n    destroy() {\r\n        // stub\r\n    }\r\n    destructor() {\r\n        this.destroy();\r\n        this._destroyKids();\r\n        // destroy actual UI\r\n        if (this._root) {\r\n            this._root.destructor();\r\n            super.destructor();\r\n        }\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this.app, this, config);\r\n    }\r\n    refresh() {\r\n        const url = this.getUrl();\r\n        this.destroy();\r\n        this._destroyKids();\r\n        this._destroySubs();\r\n        this._detachEvents();\r\n        if (this._container.tagName) {\r\n            this._root.destructor();\r\n        }\r\n        this._segment.refresh();\r\n        return this._render(this._segment);\r\n    }\r\n    render(root, url, parent) {\r\n        if (typeof url === \"string\") {\r\n            url = new Route(url, 0);\r\n        }\r\n        this._segment = url;\r\n        this._parent = parent;\r\n        this._init_url_data();\r\n        root = root || document.body;\r\n        const _container = (typeof root === \"string\") ? this.webix.toNode(root) : root;\r\n        if (this._container !== _container) {\r\n            this._container = _container;\r\n            return this._render(url);\r\n        }\r\n        else {\r\n            return this._urlChange().then(() => this.getRoot());\r\n        }\r\n    }\r\n    _render(url) {\r\n        const config = this.config();\r\n        if (config.then) {\r\n            return config.then(cfg => this._render_final(cfg, url));\r\n        }\r\n        else {\r\n            return this._render_final(config, url);\r\n        }\r\n    }\r\n    _render_final(config, url) {\r\n        // get previous view in the same slot\r\n        let slot = null;\r\n        let container = null;\r\n        let show = false;\r\n        if (!this._container.tagName) {\r\n            slot = this._container;\r\n            if (slot.popup) {\r\n                container = document.body;\r\n                show = true;\r\n            }\r\n            else {\r\n                container = this.webix.$$(slot.id);\r\n            }\r\n        }\r\n        else {\r\n            container = this._container;\r\n        }\r\n        // view already destroyed\r\n        if (!this.app || !container) {\r\n            return Promise.reject(null);\r\n        }\r\n        let response;\r\n        const current = this._segment.current();\r\n        // using wrapper object, so ui can be changed from app:render event\r\n        const result = { ui: {} };\r\n        this.app.copyConfig(config, result.ui, this._subs);\r\n        this.app.callEvent(\"app:render\", [this, url, result]);\r\n        result.ui.$scope = this;\r\n        /* destroy old HTML attached views before creating new one */\r\n        if (!slot && current.isNew && current.view) {\r\n            current.view.destructor();\r\n        }\r\n        try {\r\n            // special handling for adding inside of multiview - preserve old id\r\n            if (slot && !show) {\r\n                const oldui = container;\r\n                const parent = oldui.getParentView();\r\n                if (parent && parent.name === \"multiview\" && !result.ui.id) {\r\n                    result.ui.id = oldui.config.id;\r\n                }\r\n            }\r\n            this._root = this.app.webix.ui(result.ui, container);\r\n            const asWin = this._root;\r\n            // check for url added to ignore this.ui calls\r\n            if (show && asWin.setPosition && !asWin.isVisible()) {\r\n                asWin.show();\r\n            }\r\n            // check, if we are replacing some older view\r\n            if (slot) {\r\n                if (slot.view && slot.view !== this && slot.view !== this.app) {\r\n                    slot.view.destructor();\r\n                }\r\n                slot.id = this._root.config.id;\r\n                if (this.getParentView() || !this.app.app)\r\n                    slot.view = this;\r\n                else {\r\n                    // when we have subapp, set whole app as a view\r\n                    // so on destruction, the whole app will be destroyed\r\n                    slot.view = this.app;\r\n                }\r\n            }\r\n            if (current.isNew) {\r\n                current.view = this;\r\n                current.isNew = false;\r\n            }\r\n            response = Promise.resolve(this._init(this._root, url)).then(() => {\r\n                return this._urlChange().then(() => {\r\n                    this._initUrl = null;\r\n                    return this.ready(this._root, url.suburl());\r\n                });\r\n            });\r\n        }\r\n        catch (e) {\r\n            response = Promise.reject(e);\r\n        }\r\n        return response.catch(err => this._initError(this, err));\r\n    }\r\n    _init(view, url) {\r\n        return this.init(view, url.suburl());\r\n    }\r\n    _urlChange() {\r\n        this.app.callEvent(\"app:urlchange\", [this, this._segment]);\r\n        const waits = [];\r\n        for (const key in this._subs) {\r\n            const frame = this._subs[key];\r\n            const wait = this._renderFrameLock(key, frame, null);\r\n            if (wait) {\r\n                waits.push(wait);\r\n            }\r\n        }\r\n        return Promise.all(waits).then(() => {\r\n            return this.urlChange(this._root, this._segment.suburl());\r\n        });\r\n    }\r\n    _renderFrameLock(key, frame, path) {\r\n        // if subview is not occupied by some rendering yet\r\n        if (!frame.lock) {\r\n            // retreive and store rendering end promise\r\n            const lock = this._renderFrame(key, frame, path);\r\n            if (lock) {\r\n                // clear lock after frame rendering\r\n                // as promise.finally is not supported by  Webix lesser than 6.2\r\n                // using a more verbose notation\r\n                frame.lock = lock.then(() => frame.lock = null, () => frame.lock = null);\r\n            }\r\n        }\r\n        // return rendering end promise\r\n        return frame.lock;\r\n    }\r\n    _renderFrame(key, frame, path) {\r\n        //default route\r\n        if (key === \"default\") {\r\n            if (this._segment.next()) {\r\n                // we have a next segment in url, render it\r\n                let params = path ? path.params : null;\r\n                if (frame.params) {\r\n                    params = this.webix.extend(params || {}, frame.params);\r\n                }\r\n                return this._createSubView(frame, this._segment.shift(params));\r\n            }\r\n            else if (frame.view && frame.popup) {\r\n                // there is no next segment, delete the existing sub-view\r\n                frame.view.destructor();\r\n                frame.view = null;\r\n            }\r\n        }\r\n        //if new path provided, set it to the frame\r\n        if (path !== null) {\r\n            frame.url = path.url;\r\n            if (frame.params) {\r\n                path.params = this.webix.extend(path.params || {}, frame.params);\r\n            }\r\n        }\r\n        // in case of routed sub-view\r\n        if (frame.route) {\r\n            // we have a new path for sub-view\r\n            if (path !== null) {\r\n                return frame.route.show(path, frame.view).then(() => {\r\n                    return this._createSubView(frame, frame.route);\r\n                });\r\n            }\r\n            // do not trigger onChange for isolated sub-views\r\n            if (frame.branch) {\r\n                return;\r\n            }\r\n        }\r\n        let view = frame.view;\r\n        // if view doesn't exists yet, init it\r\n        if (!view && frame.url) {\r\n            if (typeof frame.url === \"string\") {\r\n                // string, so we have isolated subview url\r\n                frame.route = new Route(frame.url, 0);\r\n                if (path)\r\n                    frame.route.setParams(frame.route.route.url, path.params, 0);\r\n                if (frame.params)\r\n                    frame.route.setParams(frame.route.route.url, frame.params, 0);\r\n                return this._createSubView(frame, frame.route);\r\n            }\r\n            else {\r\n                // object, so we have an embeded subview\r\n                if (typeof frame.url === \"function\" && !(view instanceof frame.url)) {\r\n                    view = new (this.app._override(frame.url))(this.app, \"\");\r\n                }\r\n                if (!view) {\r\n                    view = frame.url;\r\n                }\r\n            }\r\n        }\r\n        // trigger onChange for already existed view\r\n        if (view) {\r\n            return view.render(frame, (frame.route || this._segment), this);\r\n        }\r\n    }\r\n    _initError(view, err) {\r\n        /*\r\n            if view is destroyed, ignore any view related errors\r\n        */\r\n        if (this.app) {\r\n            this.app.error(\"app:error:initview\", [err, view]);\r\n        }\r\n        return true;\r\n    }\r\n    _createSubView(sub, suburl) {\r\n        return this.app.createFromURL(suburl.current()).then(view => {\r\n            return view.render(sub, suburl, this);\r\n        });\r\n    }\r\n    _destroyKids() {\r\n        // destroy child views\r\n        const uis = this._children;\r\n        for (let i = uis.length - 1; i >= 0; i--) {\r\n            if (uis[i] && uis[i].destructor) {\r\n                uis[i].destructor();\r\n            }\r\n        }\r\n        // reset vars for better GC processing\r\n        this._children = [];\r\n    }\r\n}\n\n// wrapper for raw objects and Jet 1.x structs\r\nclass JetViewRaw extends JetView {\r\n    constructor(app, config) {\r\n        super(app, config);\r\n        this._ui = config.ui;\r\n    }\r\n    config() {\r\n        return this._ui;\r\n    }\r\n}\n\nclass SubRouter {\r\n    constructor(cb, config, app) {\r\n        this.path = \"\";\r\n        this.app = app;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        const a = this.app;\r\n        a.app.getRouter().set(a._segment.append(this.path), { silent: true });\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nlet _once = true;\r\nclass JetAppBase extends JetBase {\r\n    constructor(config) {\r\n        const webix = (config || {}).webix || window.webix;\r\n        config = webix.extend({\r\n            name: \"App\",\r\n            version: \"1.0\",\r\n            start: \"/home\"\r\n        }, config, true);\r\n        super(webix, config);\r\n        this.config = config;\r\n        this.app = this.config.app;\r\n        this.ready = Promise.resolve();\r\n        this._services = {};\r\n        this.webix.extend(this, this.webix.EventSystem);\r\n    }\r\n    getUrl() {\r\n        return this._subSegment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._subSegment.toString();\r\n    }\r\n    getService(name) {\r\n        let obj = this._services[name];\r\n        if (typeof obj === \"function\") {\r\n            obj = this._services[name] = obj(this);\r\n        }\r\n        return obj;\r\n    }\r\n    setService(name, handler) {\r\n        this._services[name] = handler;\r\n    }\r\n    destructor() {\r\n        this.getSubView().destructor();\r\n        super.destructor();\r\n    }\r\n    // copy object and collect extra handlers\r\n    copyConfig(obj, target, config) {\r\n        // raw ui config\r\n        if (obj instanceof JetBase ||\r\n            (typeof obj === \"function\" && obj.prototype instanceof JetBase)) {\r\n            obj = { $subview: obj };\r\n        }\r\n        // subview placeholder\r\n        if (typeof obj.$subview != \"undefined\") {\r\n            return this.addSubView(obj, target, config);\r\n        }\r\n        // process sub-properties\r\n        const isArray = obj instanceof Array;\r\n        target = target || (isArray ? [] : {});\r\n        for (const method in obj) {\r\n            let point = obj[method];\r\n            // view class\r\n            if (typeof point === \"function\" && point.prototype instanceof JetBase) {\r\n                point = { $subview: point };\r\n            }\r\n            if (point && typeof point === \"object\" &&\r\n                !(point instanceof this.webix.DataCollection) && !(point instanceof RegExp) && !(point instanceof Map)) {\r\n                if (point instanceof Date) {\r\n                    target[method] = new Date(point);\r\n                }\r\n                else {\r\n                    const copy = this.copyConfig(point, (point instanceof Array ? [] : {}), config);\r\n                    if (copy !== null) {\r\n                        if (isArray)\r\n                            target.push(copy);\r\n                        else\r\n                            target[method] = copy;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                target[method] = point;\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n    getRouter() {\r\n        return this.$router;\r\n    }\r\n    clickHandler(e, target) {\r\n        if (e) {\r\n            target = target || (e.target || e.srcElement);\r\n            if (target && target.getAttribute) {\r\n                const trigger = target.getAttribute(\"trigger\");\r\n                if (trigger) {\r\n                    this._forView(target, view => view.app.trigger(trigger));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n                const route = target.getAttribute(\"route\");\r\n                if (route) {\r\n                    this._forView(target, view => view.show(route));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n            }\r\n        }\r\n        const parent = target.parentNode;\r\n        if (parent) {\r\n            this.clickHandler(e, parent);\r\n        }\r\n    }\r\n    getRoot() {\r\n        return this.getSubView().getRoot();\r\n    }\r\n    refresh() {\r\n        if (!this._subSegment) {\r\n            return Promise.resolve(null);\r\n        }\r\n        return this.getSubView().refresh().then(view => {\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return view;\r\n        });\r\n    }\r\n    loadView(url) {\r\n        const views = this.config.views;\r\n        let result = null;\r\n        if (url === \"\") {\r\n            return Promise.resolve(this._loadError(\"\", new Error(\"Webix Jet: Empty url segment\")));\r\n        }\r\n        try {\r\n            if (views) {\r\n                if (typeof views === \"function\") {\r\n                    // custom loading strategy\r\n                    result = views(url);\r\n                }\r\n                else {\r\n                    // predefined hash\r\n                    result = views[url];\r\n                }\r\n                if (typeof result === \"string\") {\r\n                    url = result;\r\n                    result = null;\r\n                }\r\n            }\r\n            if (!result) {\r\n                if (url === \"_hidden\") {\r\n                    result = { hidden: true };\r\n                }\r\n                else if (url === \"_blank\") {\r\n                    result = {};\r\n                }\r\n                else {\r\n                    url = url.replace(/\\./g, \"/\");\r\n                    result = this.require(\"jet-views\", url);\r\n                }\r\n            }\r\n        }\r\n        catch (e) {\r\n            result = this._loadError(url, e);\r\n        }\r\n        // custom handler can return view or its promise\r\n        if (!result.then) {\r\n            result = Promise.resolve(result);\r\n        }\r\n        // set error handler\r\n        result = result\r\n            .then(module => module.__esModule ? module.default : module)\r\n            .catch(err => this._loadError(url, err));\r\n        return result;\r\n    }\r\n    _forView(target, handler) {\r\n        const view = this.webix.$$(target);\r\n        if (view) {\r\n            handler(view.$scope);\r\n        }\r\n    }\r\n    _loadViewDynamic(url) {\r\n        return null;\r\n    }\r\n    createFromURL(chunk) {\r\n        let view;\r\n        if (chunk.isNew || !chunk.view) {\r\n            view = this.loadView(chunk.page)\r\n                .then(ui => this.createView(ui, name, chunk.params));\r\n        }\r\n        else {\r\n            view = Promise.resolve(chunk.view);\r\n        }\r\n        return view;\r\n    }\r\n    _override(ui) {\r\n        const over = this.config.override;\r\n        if (over) {\r\n            let dv;\r\n            while (ui) {\r\n                dv = ui;\r\n                ui = over.get(ui);\r\n            }\r\n            return dv;\r\n        }\r\n        return ui;\r\n    }\r\n    createView(ui, name, params) {\r\n        ui = this._override(ui);\r\n        let obj;\r\n        if (typeof ui === \"function\") {\r\n            if (ui.prototype instanceof JetAppBase) {\r\n                // UI class\r\n                return new ui({ app: this, name, params, router: SubRouter });\r\n            }\r\n            else if (ui.prototype instanceof JetBase) {\r\n                // UI class\r\n                return new ui(this, { name, params });\r\n            }\r\n            else {\r\n                // UI factory functions\r\n                ui = ui(this);\r\n            }\r\n        }\r\n        if (ui instanceof JetBase) {\r\n            obj = ui;\r\n        }\r\n        else {\r\n            // UI object\r\n            obj = new JetViewRaw(this, { name, ui });\r\n        }\r\n        return obj;\r\n    }\r\n    // show view path\r\n    show(url, config) {\r\n        if (url && this.app && url.indexOf(\"//\") == 0)\r\n            return this.app.show(url.substr(1), config);\r\n        return this.render(this._container, url || this.config.start, config);\r\n    }\r\n    // event helpers\r\n    trigger(name, ...rest) {\r\n        this.apply(name, rest);\r\n    }\r\n    apply(name, data) {\r\n        this.callEvent(name, data);\r\n    }\r\n    action(name) {\r\n        return this.webix.bind(function (...rest) {\r\n            this.apply(name, rest);\r\n        }, this);\r\n    }\r\n    on(name, handler) {\r\n        this.attachEvent(name, handler);\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this, null, config);\r\n    }\r\n    error(name, er) {\r\n        this.callEvent(name, er);\r\n        this.callEvent(\"app:error\", er);\r\n        /* tslint:disable */\r\n        if (this.config.debug) {\r\n            for (var i = 0; i < er.length; i++) {\r\n                console.error(er[i]);\r\n                if (er[i] instanceof Error) {\r\n                    let text = er[i].message;\r\n                    if (text.indexOf(\"Module build failed\") === 0) {\r\n                        text = text.replace(/\\x1b\\[[0-9;]*m/g, \"\");\r\n                        document.body.innerHTML = `<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>${text}</pre>`;\r\n                    }\r\n                    else {\r\n                        text += \"<br><br>Check console for more details\";\r\n                        this.webix.message({ type: \"error\", text: text, expire: -1 });\r\n                    }\r\n                }\r\n            }\r\n            debugger;\r\n        }\r\n        /* tslint:enable */\r\n    }\r\n    // renders top view\r\n    render(root, url, config) {\r\n        this._container = (typeof root === \"string\") ?\r\n            this.webix.toNode(root) :\r\n            (root || document.body);\r\n        const firstInit = !this.$router;\r\n        let path = null;\r\n        if (firstInit) {\r\n            if (_once && \"tagName\" in this._container) {\r\n                this.webix.event(document.body, \"click\", e => this.clickHandler(e));\r\n                _once = false;\r\n            }\r\n            if (typeof url === \"string\") {\r\n                url = new Route(url, 0);\r\n            }\r\n            this._subSegment = this._first_start(url);\r\n            this._subSegment.route.linkRouter = true;\r\n        }\r\n        else {\r\n            if (typeof url === \"string\") {\r\n                path = url;\r\n            }\r\n            else {\r\n                if (this.app) {\r\n                    path = url.split().route.path || this.config.start;\r\n                }\r\n                else {\r\n                    path = url.toString();\r\n                }\r\n            }\r\n        }\r\n        const params = config ? config.params : this.config.params || null;\r\n        const top = this.getSubView();\r\n        const segment = this._subSegment;\r\n        const ready = segment\r\n            .show({ url: path, params }, top)\r\n            .then(() => this.createFromURL(segment.current()))\r\n            .then(view => view.render(root, segment))\r\n            .then(base => {\r\n            this.$router.set(segment.route.path, { silent: true });\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return base;\r\n        });\r\n        this.ready = this.ready.then(() => ready);\r\n        return ready;\r\n    }\r\n    getSubView() {\r\n        if (this._subSegment) {\r\n            const view = this._subSegment.current().view;\r\n            if (view)\r\n                return view;\r\n        }\r\n        return new JetView(this, {});\r\n    }\r\n    require(type, url) { return null; }\r\n    _first_start(route) {\r\n        this._segment = route;\r\n        const cb = (a) => setTimeout(() => {\r\n            this.show(a).catch(e => {\r\n                if (!(e instanceof NavigationBlocked))\r\n                    throw e;\r\n            });\r\n        }, 1);\r\n        this.$router = new (this.config.router)(cb, this.config, this);\r\n        // start animation for top-level app\r\n        if (this._container === document.body && this.config.animation !== false) {\r\n            const node = this._container;\r\n            this.webix.html.addCss(node, \"webixappstart\");\r\n            setTimeout(() => {\r\n                this.webix.html.removeCss(node, \"webixappstart\");\r\n                this.webix.html.addCss(node, \"webixapp\");\r\n            }, 10);\r\n        }\r\n        if (!route) {\r\n            // if no url defined, check router first\r\n            let urlString = this.$router.get();\r\n            if (!urlString) {\r\n                urlString = this.config.start;\r\n                this.$router.set(urlString, { silent: true });\r\n            }\r\n            route = new Route(urlString, 0);\r\n        }\r\n        else if (this.app) {\r\n            const now = route.current().view;\r\n            route.current().view = this;\r\n            if (route.next()) {\r\n                route.refresh();\r\n                route = route.split();\r\n            }\r\n            else {\r\n                route = new Route(this.config.start, 0);\r\n            }\r\n            route.current().view = now;\r\n        }\r\n        return route;\r\n    }\r\n    // error during view resolving\r\n    _loadError(url, err) {\r\n        this.error(\"app:error:resolve\", [err, url]);\r\n        return { template: \" \" };\r\n    }\r\n    addSubView(obj, target, config) {\r\n        const url = obj.$subview !== true ? obj.$subview : null;\r\n        const name = obj.name || (url ? this.webix.uid() : \"default\");\r\n        target.id = obj.id || \"s\" + this.webix.uid();\r\n        const view = config[name] = {\r\n            id: target.id,\r\n            url,\r\n            branch: obj.branch,\r\n            popup: obj.popup,\r\n            params: obj.params\r\n        };\r\n        return view.popup ? null : target;\r\n    }\r\n}\n\nclass HashRouter {\r\n    constructor(cb, config) {\r\n        this.config = config || {};\r\n        this._detectPrefix();\r\n        this.cb = cb;\r\n        window.onpopstate = () => this.cb(this.get());\r\n    }\r\n    set(path, config) {\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            for (const key in this.config.routes) {\r\n                if (this.config.routes[key] === compare[0]) {\r\n                    path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (this.get() !== path) {\r\n            window.history.pushState(null, null, this.prefix + this.sufix + path);\r\n        }\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        let path = this._getRaw().replace(this.prefix, \"\").replace(this.sufix, \"\");\r\n        path = (path !== \"/\" && path !== \"#\") ? path : \"\";\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            const key = this.config.routes[compare[0]];\r\n            if (key) {\r\n                path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n            }\r\n        }\r\n        return path;\r\n    }\r\n    _detectPrefix() {\r\n        // use \"#!\" for backward compatibility\r\n        const sufix = this.config.routerPrefix;\r\n        this.sufix = \"#\" + ((typeof sufix === \"undefined\") ? \"!\" : sufix);\r\n        this.prefix = document.location.href.split(\"#\", 2)[0];\r\n    }\r\n    _getRaw() {\r\n        return document.location.href;\r\n    }\r\n}\n\nlet isPatched = false;\r\nfunction patch(w) {\r\n    if (isPatched || !w) {\r\n        return;\r\n    }\r\n    isPatched = true;\r\n    // custom promise for IE8\r\n    const win = window;\r\n    if (!win.Promise) {\r\n        win.Promise = w.promise;\r\n    }\r\n    const version = w.version.split(\".\");\r\n    // will be fixed in webix 5.3\r\n    if (version[0] * 10 + version[1] * 1 < 53) {\r\n        w.ui.freeze = function (handler) {\r\n            // disabled because webix jet 5.0 can't handle resize of scrollview correctly\r\n            // w.ui.$freeze = true;\r\n            const res = handler();\r\n            if (res && res.then) {\r\n                res.then(function (some) {\r\n                    w.ui.$freeze = false;\r\n                    w.ui.resize();\r\n                    return some;\r\n                });\r\n            }\r\n            else {\r\n                w.ui.$freeze = false;\r\n                w.ui.resize();\r\n            }\r\n            return res;\r\n        };\r\n    }\r\n    // adding views as classes\r\n    const baseAdd = w.ui.baselayout.prototype.addView;\r\n    const baseRemove = w.ui.baselayout.prototype.removeView;\r\n    const config = {\r\n        addView(view, index) {\r\n            // trigger logic only for widgets inside of jet-view\r\n            // ignore case when addView used with already initialized widget\r\n            if (this.$scope && this.$scope.webixJet && !view.queryView) {\r\n                const jview = this.$scope;\r\n                const subs = {};\r\n                view = jview.app.copyConfig(view, {}, subs);\r\n                baseAdd.apply(this, [view, index]);\r\n                for (const key in subs) {\r\n                    jview._renderFrame(key, subs[key], null).then(() => {\r\n                        jview._subs[key] = subs[key];\r\n                    });\r\n                }\r\n                return view.id;\r\n            }\r\n            else {\r\n                return baseAdd.apply(this, arguments);\r\n            }\r\n        },\r\n        removeView() {\r\n            baseRemove.apply(this, arguments);\r\n            if (this.$scope && this.$scope.webixJet) {\r\n                const subs = this.$scope._subs;\r\n                // check all sub-views, destroy and clean the removed one\r\n                for (const key in subs) {\r\n                    const test = subs[key];\r\n                    if (!w.$$(test.id)) {\r\n                        test.view.destructor();\r\n                        delete subs[key];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    w.extend(w.ui.layout.prototype, config, true);\r\n    w.extend(w.ui.baselayout.prototype, config, true);\r\n    // wrapper for using Jet Apps as views\r\n    w.protoUI({\r\n        name: \"jetapp\",\r\n        $init(cfg) {\r\n            this.$app = new this.app(cfg);\r\n            const id = w.uid().toString();\r\n            cfg.body = { id };\r\n            this.$ready.push(function () {\r\n                this.callEvent(\"onInit\", [this.$app]);\r\n                this.$app.render({ id });\r\n            });\r\n        }\r\n    }, w.ui.proxy, w.EventSystem);\r\n}\n\nclass JetApp extends JetAppBase {\r\n    constructor(config) {\r\n        config.router = config.router || HashRouter;\r\n        super(config);\r\n        patch(this.webix);\r\n    }\r\n    require(type, url) {\r\n        return require(type + \"/\" + url);\r\n    }\r\n}\n\nclass StoreRouter {\r\n    constructor(cb, config, app) {\r\n        this.storage = config.storage || app.webix.storage.session;\r\n        this.name = (config.storeName || config.id + \":route\");\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.storage.put(this.name, path);\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.storage.get(this.name);\r\n    }\r\n}\n\nclass UrlRouter extends HashRouter {\r\n    _detectPrefix() {\r\n        this.prefix = \"\";\r\n        this.sufix = this.config.routerPrefix || \"\";\r\n    }\r\n    _getRaw() {\r\n        return document.location.pathname + (document.location.search || \"\");\r\n    }\r\n}\n\nclass EmptyRouter {\r\n    constructor(cb, _$config) {\r\n        this.path = \"\";\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nfunction UnloadGuard(app, view, config) {\r\n    view.on(app, `app:guard`, function (_$url, point, promise) {\r\n        if (point === view || point.contains(view)) {\r\n            const res = config();\r\n            if (res === false) {\r\n                promise.confirm = Promise.reject(new NavigationBlocked());\r\n            }\r\n            else {\r\n                promise.confirm = promise.confirm.then(() => res);\r\n            }\r\n        }\r\n    });\r\n}\n\n//     (c) 2012-2018 Airbnb, Inc.\n\n// var has = require('has');\nfunction has(store, key) {\n  return Object.prototype.hasOwnProperty.call(store, key);\n}\n// var forEach = require('for-each');\nfunction forEach(obj, handler, context) {\n  for (var key in obj) {\n    if (has(obj, key)) {\n      handler.call((context || obj), obj[key], key, obj);\n    }\n  }\n}\n// var trim = require('string.prototype.trim');\nfunction trim(str) {\n  return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n}\n// var warning = require('warning');\nfunction warn(message) {\n  message = 'Warning: ' + message;\n  if (typeof console !== 'undefined') {\n    console.error(message);\n  }\n\n  try { throw new Error(message); } catch (x) {}\n}\n\nvar replace = String.prototype.replace;\nvar split = String.prototype.split;\n\n// #### Pluralization methods\n// The string that separates the different phrase possibilities.\nvar delimiter = '||||';\n\nvar russianPluralGroups = function (n) {\n  var end = n % 10;\n  if (n !== 11 && end === 1) {\n    return 0;\n  }\n  if (2 <= end && end <= 4 && !(n >= 12 && n <= 14)) {\n    return 1;\n  }\n  return 2;\n};\n\n// Mapping from pluralization group plural logic.\nvar pluralTypes = {\n  arabic: function (n) {\n    // http://www.arabeyes.org/Plural_Forms\n    if (n < 3) { return n; }\n    var lastTwo = n % 100;\n    if (lastTwo >= 3 && lastTwo <= 10) return 3;\n    return lastTwo >= 11 ? 4 : 5;\n  },\n  bosnian_serbian: russianPluralGroups,\n  chinese: function () { return 0; },\n  croatian: russianPluralGroups,\n  french: function (n) { return n > 1 ? 1 : 0; },\n  german: function (n) { return n !== 1 ? 1 : 0; },\n  russian: russianPluralGroups,\n  lithuanian: function (n) {\n    if (n % 10 === 1 && n % 100 !== 11) { return 0; }\n    return n % 10 >= 2 && n % 10 <= 9 && (n % 100 < 11 || n % 100 > 19) ? 1 : 2;\n  },\n  czech: function (n) {\n    if (n === 1) { return 0; }\n    return (n >= 2 && n <= 4) ? 1 : 2;\n  },\n  polish: function (n) {\n    if (n === 1) { return 0; }\n    var end = n % 10;\n    return 2 <= end && end <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n  },\n  icelandic: function (n) { return (n % 10 !== 1 || n % 100 === 11) ? 1 : 0; },\n  slovenian: function (n) {\n    var lastTwo = n % 100;\n    if (lastTwo === 1) {\n      return 0;\n    }\n    if (lastTwo === 2) {\n      return 1;\n    }\n    if (lastTwo === 3 || lastTwo === 4) {\n      return 2;\n    }\n    return 3;\n  }\n};\n\n\n// Mapping from pluralization group to individual language codes/locales.\n// Will look up based on exact match, if not found and it's a locale will parse the locale\n// for language code, and if that does not exist will default to 'en'\nvar pluralTypeToLanguages = {\n  arabic: ['ar'],\n  bosnian_serbian: ['bs-Latn-BA', 'bs-Cyrl-BA', 'srl-RS', 'sr-RS'],\n  chinese: ['id', 'id-ID', 'ja', 'ko', 'ko-KR', 'lo', 'ms', 'th', 'th-TH', 'zh'],\n  croatian: ['hr', 'hr-HR'],\n  german: ['fa', 'da', 'de', 'en', 'es', 'fi', 'el', 'he', 'hi-IN', 'hu', 'hu-HU', 'it', 'nl', 'no', 'pt', 'sv', 'tr'],\n  french: ['fr', 'tl', 'pt-br'],\n  russian: ['ru', 'ru-RU'],\n  lithuanian: ['lt'],\n  czech: ['cs', 'cs-CZ', 'sk'],\n  polish: ['pl'],\n  icelandic: ['is'],\n  slovenian: ['sl-SL']\n};\n\nfunction langToTypeMap(mapping) {\n  var ret = {};\n  forEach(mapping, function (langs, type) {\n    forEach(langs, function (lang) {\n      ret[lang] = type;\n    });\n  });\n  return ret;\n}\n\nfunction pluralTypeName(locale) {\n  var langToPluralType = langToTypeMap(pluralTypeToLanguages);\n  return langToPluralType[locale]\n    || langToPluralType[split.call(locale, /-/, 1)[0]]\n    || langToPluralType.en;\n}\n\nfunction pluralTypeIndex(locale, count) {\n  return pluralTypes[pluralTypeName(locale)](count);\n}\n\nfunction escape(token) {\n  return token.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction constructTokenRegex(opts) {\n  var prefix = (opts && opts.prefix) || '%{';\n  var suffix = (opts && opts.suffix) || '}';\n\n  if (prefix === delimiter || suffix === delimiter) {\n    throw new RangeError('\"' + delimiter + '\" token is reserved for pluralization');\n  }\n\n  return new RegExp(escape(prefix) + '(.*?)' + escape(suffix), 'g');\n}\n\nvar dollarRegex = /\\$/g;\nvar dollarBillsYall = '$$';\nvar defaultTokenRegex = /%\\{(.*?)\\}/g;\n\n// ### transformPhrase(phrase, substitutions, locale)\n//\n// Takes a phrase string and transforms it by choosing the correct\n// plural form and interpolating it.\n//\n//     transformPhrase('Hello, %{name}!', {name: 'Spike'});\n//     // \"Hello, Spike!\"\n//\n// The correct plural form is selected if substitutions.smart_count\n// is set. You can pass in a number instead of an Object as `substitutions`\n// as a shortcut for `smart_count`.\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 1}, 'en');\n//     // \"1 new message\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 2}, 'en');\n//     // \"2 new messages\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', 5, 'en');\n//     // \"5 new messages\"\n//\n// You should pass in a third argument, the locale, to specify the correct plural type.\n// It defaults to `'en'` with 2 plural forms.\nfunction transformPhrase(phrase, substitutions, locale, tokenRegex) {\n  if (typeof phrase !== 'string') {\n    throw new TypeError('Polyglot.transformPhrase expects argument #1 to be string');\n  }\n\n  if (substitutions == null) {\n    return phrase;\n  }\n\n  var result = phrase;\n  var interpolationRegex = tokenRegex || defaultTokenRegex;\n\n  // allow number as a pluralization shortcut\n  var options = typeof substitutions === 'number' ? { smart_count: substitutions } : substitutions;\n\n  // Select plural form: based on a phrase text that contains `n`\n  // plural forms separated by `delimiter`, a `locale`, and a `substitutions.smart_count`,\n  // choose the correct plural form. This is only done if `count` is set.\n  if (options.smart_count != null && result) {\n    var texts = split.call(result, delimiter);\n    result = trim(texts[pluralTypeIndex(locale || 'en', options.smart_count)] || texts[0]);\n  }\n\n  // Interpolate: Creates a `RegExp` object for each interpolation placeholder.\n  result = replace.call(result, interpolationRegex, function (expression, argument) {\n    if (!has(options, argument) || options[argument] == null) { return expression; }\n    // Ensure replacement value is escaped to prevent special $-prefixed regex replace tokens.\n    return replace.call(options[argument], dollarRegex, dollarBillsYall);\n  });\n\n  return result;\n}\n\n// ### Polyglot class constructor\nfunction Polyglot(options) {\n  var opts = options || {};\n  this.phrases = {};\n  this.extend(opts.phrases || {});\n  this.currentLocale = opts.locale || 'en';\n  var allowMissing = opts.allowMissing ? transformPhrase : null;\n  this.onMissingKey = typeof opts.onMissingKey === 'function' ? opts.onMissingKey : allowMissing;\n  this.warn = opts.warn || warn;\n  this.tokenRegex = constructTokenRegex(opts.interpolation);\n}\n\n// ### polyglot.locale([locale])\n//\n// Get or set locale. Internally, Polyglot only uses locale for pluralization.\nPolyglot.prototype.locale = function (newLocale) {\n  if (newLocale) this.currentLocale = newLocale;\n  return this.currentLocale;\n};\n\n// ### polyglot.extend(phrases)\n//\n// Use `extend` to tell Polyglot how to translate a given key.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The key can be any string.  Feel free to call `extend` multiple times;\n// it will override any phrases with the same key, but leave existing phrases\n// untouched.\n//\n// It is also possible to pass nested phrase objects, which get flattened\n// into an object with the nested keys concatenated using dot notation.\n//\n//     polyglot.extend({\n//       \"nav\": {\n//         \"hello\": \"Hello\",\n//         \"hello_name\": \"Hello, %{name}\",\n//         \"sidebar\": {\n//           \"welcome\": \"Welcome\"\n//         }\n//       }\n//     });\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}',\n//     //   'nav.sidebar.welcome': 'Welcome'\n//     // }\n//\n// `extend` accepts an optional second argument, `prefix`, which can be used\n// to prefix every key in the phrases object with some string, using dot\n// notation.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     }, \"nav\");\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}'\n//     // }\n//\n// This feature is used internally to support nested phrase objects.\nPolyglot.prototype.extend = function (morePhrases, prefix) {\n  forEach(morePhrases, function (phrase, key) {\n    var prefixedKey = prefix ? prefix + '.' + key : key;\n    if (typeof phrase === 'object') {\n      this.extend(phrase, prefixedKey);\n    } else {\n      this.phrases[prefixedKey] = phrase;\n    }\n  }, this);\n};\n\n// ### polyglot.unset(phrases)\n// Use `unset` to selectively remove keys from a polyglot instance.\n//\n//     polyglot.unset(\"some_key\");\n//     polyglot.unset({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The unset method can take either a string (for the key), or an object hash with\n// the keys that you would like to unset.\nPolyglot.prototype.unset = function (morePhrases, prefix) {\n  if (typeof morePhrases === 'string') {\n    delete this.phrases[morePhrases];\n  } else {\n    forEach(morePhrases, function (phrase, key) {\n      var prefixedKey = prefix ? prefix + '.' + key : key;\n      if (typeof phrase === 'object') {\n        this.unset(phrase, prefixedKey);\n      } else {\n        delete this.phrases[prefixedKey];\n      }\n    }, this);\n  }\n};\n\n// ### polyglot.clear()\n//\n// Clears all phrases. Useful for special cases, such as freeing\n// up memory if you have lots of phrases but no longer need to\n// perform any translation. Also used internally by `replace`.\nPolyglot.prototype.clear = function () {\n  this.phrases = {};\n};\n\n// ### polyglot.replace(phrases)\n//\n// Completely replace the existing phrases with a new set of phrases.\n// Normally, just use `extend` to add more phrases, but under certain\n// circumstances, you may want to make sure no old phrases are lying around.\nPolyglot.prototype.replace = function (newPhrases) {\n  this.clear();\n  this.extend(newPhrases);\n};\n\n\n// ### polyglot.t(key, options)\n//\n// The most-used method. Provide a key, and `t` will return the\n// phrase.\n//\n//     polyglot.t(\"hello\");\n//     => \"Hello\"\n//\n// The phrase value is provided first by a call to `polyglot.extend()` or\n// `polyglot.replace()`.\n//\n// Pass in an object as the second argument to perform interpolation.\n//\n//     polyglot.t(\"hello_name\", {name: \"Spike\"});\n//     => \"Hello, Spike\"\n//\n// If you like, you can provide a default value in case the phrase is missing.\n// Use the special option key \"_\" to specify a default.\n//\n//     polyglot.t(\"i_like_to_write_in_language\", {\n//       _: \"I like to write in %{language}.\",\n//       language: \"JavaScript\"\n//     });\n//     => \"I like to write in JavaScript.\"\n//\nPolyglot.prototype.t = function (key, options) {\n  var phrase, result;\n  var opts = options == null ? {} : options;\n  if (typeof this.phrases[key] === 'string') {\n    phrase = this.phrases[key];\n  } else if (typeof opts._ === 'string') {\n    phrase = opts._;\n  } else if (this.onMissingKey) {\n    var onMissingKey = this.onMissingKey;\n    result = onMissingKey(key, opts, this.currentLocale, this.tokenRegex);\n  } else {\n    this.warn('Missing translation for key: \"' + key + '\"');\n    result = key;\n  }\n  if (typeof phrase === 'string') {\n    result = transformPhrase(phrase, opts, this.currentLocale, this.tokenRegex);\n  }\n  return result;\n};\n\n\n// ### polyglot.has(key)\n//\n// Check if polyglot has a translation for given key\nPolyglot.prototype.has = function (key) {\n  return has(this.phrases, key);\n};\n\n// export transformPhrase\nPolyglot.transformPhrase = function transform(phrase, substitutions, locale) {\n  return transformPhrase(phrase, substitutions, locale);\n};\n\nvar webixPolyglot = Polyglot;\n\nfunction Locale(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let lang = storage ? (storage.get(\"lang\") || \"en\") : (config.lang || \"en\");\r\n    function setLangData(name, data, silent) {\r\n        if (data.__esModule) {\r\n            data = data.default;\r\n        }\r\n        const pconfig = { phrases: data };\r\n        if (config.polyglot) {\r\n            app.webix.extend(pconfig, config.polyglot);\r\n        }\r\n        const poly = service.polyglot = new webixPolyglot(pconfig);\r\n        poly.locale(name);\r\n        service._ = app.webix.bind(poly.t, poly);\r\n        lang = name;\r\n        if (storage) {\r\n            storage.put(\"lang\", lang);\r\n        }\r\n        if (config.webix) {\r\n            const locName = config.webix[name];\r\n            if (locName) {\r\n                app.webix.i18n.setLocale(locName);\r\n            }\r\n        }\r\n        if (!silent) {\r\n            return app.refresh();\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    function getLang() { return lang; }\r\n    function setLang(name, silent) {\r\n        // ignore setLang if loading by path is disabled\r\n        if (config.path === false) {\r\n            return;\r\n        }\r\n        const path = (config.path ? config.path + \"/\" : \"\") + name;\r\n        const data = app.require(\"jet-locales\", path);\r\n        setLangData(name, data, silent);\r\n    }\r\n    const service = {\r\n        getLang, setLang, setLangData, _: null, polyglot: null\r\n    };\r\n    app.setService(\"locale\", service);\r\n    setLang(lang, true);\r\n}\n\nfunction show(view, config, value) {\r\n    if (config.urls) {\r\n        value = config.urls[value] || value;\r\n    }\r\n    else if (config.param) {\r\n        value = { [config.param]: value };\r\n    }\r\n    view.show(value);\r\n}\r\nfunction Menu(app, view, config) {\r\n    const frame = view.getSubViewInfo().parent;\r\n    const ui = view.$$(config.id || config);\r\n    let silent = false;\r\n    ui.attachEvent(\"onchange\", function () {\r\n        if (!silent) {\r\n            show(frame, config, this.getValue());\r\n        }\r\n    });\r\n    ui.attachEvent(\"onafterselect\", function () {\r\n        if (!silent) {\r\n            let id = null;\r\n            if (ui.setValue) {\r\n                id = this.getValue();\r\n            }\r\n            else if (ui.getSelectedId) {\r\n                id = ui.getSelectedId();\r\n            }\r\n            show(frame, config, id);\r\n        }\r\n    });\r\n    view.on(app, `app:route`, function () {\r\n        let name = \"\";\r\n        if (config.param) {\r\n            name = view.getParam(config.param, true);\r\n        }\r\n        else {\r\n            const segment = frame.getUrl()[1];\r\n            if (segment) {\r\n                name = segment.page;\r\n            }\r\n        }\r\n        if (name) {\r\n            silent = true;\r\n            if (ui.setValue && ui.getValue() !== name) {\r\n                ui.setValue(name);\r\n            }\r\n            else if (ui.select && ui.exists(name) && ui.getSelectedId() !== name) {\r\n                ui.select(name);\r\n            }\r\n            silent = false;\r\n        }\r\n    });\r\n}\n\nconst baseicons = {\r\n    good: \"check\",\r\n    error: \"warning\",\r\n    saving: \"refresh fa-spin\"\r\n};\r\nconst basetext = {\r\n    good: \"Ok\",\r\n    error: \"Error\",\r\n    saving: \"Connecting...\"\r\n};\r\nfunction Status(app, view, config) {\r\n    let status = \"good\";\r\n    let count = 0;\r\n    let iserror = false;\r\n    let expireDelay = config.expire;\r\n    if (!expireDelay && expireDelay !== false) {\r\n        expireDelay = 2000;\r\n    }\r\n    const texts = config.texts || basetext;\r\n    const icons = config.icons || baseicons;\r\n    if (typeof config === \"string\") {\r\n        config = { target: config };\r\n    }\r\n    function refresh(content) {\r\n        const area = view.$$(config.target);\r\n        if (area) {\r\n            if (!content) {\r\n                content = \"<div class='status_\" +\r\n                    status +\r\n                    \"'><span class='webix_icon fa-\" +\r\n                    icons[status] + \"'></span> \" + texts[status] + \"</div>\";\r\n            }\r\n            area.setHTML(content);\r\n        }\r\n    }\r\n    function success() {\r\n        count--;\r\n        setStatus(\"good\");\r\n    }\r\n    function fail(err) {\r\n        count--;\r\n        setStatus(\"error\", err);\r\n    }\r\n    function start(promise) {\r\n        count++;\r\n        setStatus(\"saving\");\r\n        if (promise && promise.then) {\r\n            promise.then(success, fail);\r\n        }\r\n    }\r\n    function getStatus() {\r\n        return status;\r\n    }\r\n    function hideStatus() {\r\n        if (count === 0) {\r\n            refresh(\" \");\r\n        }\r\n    }\r\n    function setStatus(mode, err) {\r\n        if (count < 0) {\r\n            count = 0;\r\n        }\r\n        if (mode === \"saving\") {\r\n            status = \"saving\";\r\n            refresh();\r\n        }\r\n        else {\r\n            iserror = (mode === \"error\");\r\n            if (count === 0) {\r\n                status = iserror ? \"error\" : \"good\";\r\n                if (iserror) {\r\n                    app.error(\"app:error:server\", [err.responseText || err]);\r\n                }\r\n                else {\r\n                    if (expireDelay) {\r\n                        setTimeout(hideStatus, expireDelay);\r\n                    }\r\n                }\r\n                refresh();\r\n            }\r\n        }\r\n    }\r\n    function track(data) {\r\n        const dp = app.webix.dp(data);\r\n        if (dp) {\r\n            view.on(dp, \"onAfterDataSend\", start);\r\n            view.on(dp, \"onAfterSaveError\", (_id, _obj, response) => fail(response));\r\n            view.on(dp, \"onAfterSave\", success);\r\n        }\r\n    }\r\n    app.setService(\"status\", {\r\n        getStatus,\r\n        setStatus,\r\n        track\r\n    });\r\n    if (config.remote) {\r\n        view.on(app.webix, \"onRemoteCall\", start);\r\n    }\r\n    if (config.ajax) {\r\n        view.on(app.webix, \"onBeforeAjax\", (_mode, _url, _data, _request, _headers, _files, promise) => {\r\n            start(promise);\r\n        });\r\n    }\r\n    if (config.data) {\r\n        track(config.data);\r\n    }\r\n}\n\nfunction Theme(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let theme = storage ?\r\n        (storage.get(\"theme\") || \"flat-default\")\r\n        :\r\n            (config.theme || \"flat-default\");\r\n    const service = {\r\n        getTheme() { return theme; },\r\n        setTheme(name, silent) {\r\n            const parts = name.split(\"-\");\r\n            const links = document.getElementsByTagName(\"link\");\r\n            for (let i = 0; i < links.length; i++) {\r\n                const lname = links[i].getAttribute(\"title\");\r\n                if (lname) {\r\n                    if (lname === name || lname === parts[0]) {\r\n                        links[i].disabled = false;\r\n                    }\r\n                    else {\r\n                        links[i].disabled = true;\r\n                    }\r\n                }\r\n            }\r\n            app.webix.skin.set(parts[0]);\r\n            // remove old css\r\n            app.webix.html.removeCss(document.body, \"theme-\" + theme);\r\n            // add new css\r\n            app.webix.html.addCss(document.body, \"theme-\" + name);\r\n            theme = name;\r\n            if (storage) {\r\n                storage.put(\"theme\", name);\r\n            }\r\n            if (!silent) {\r\n                app.refresh();\r\n            }\r\n        }\r\n    };\r\n    app.setService(\"theme\", service);\r\n    service.setTheme(theme, true);\r\n}\n\nfunction copyParams(data, url, route) {\r\n    for (let i = 0; i < route.length; i++) {\r\n        data[route[i]] = url[i + 1] ? url[i + 1].page : \"\";\r\n    }\r\n}\r\nfunction UrlParam(app, view, config) {\r\n    const route = config.route || config;\r\n    const data = {};\r\n    view.on(app, \"app:urlchange\", function (subview, segment) {\r\n        if (view === subview) {\r\n            copyParams(data, segment.suburl(), route);\r\n            segment.size(route.length + 1);\r\n        }\r\n    });\r\n    const os = view.setParam;\r\n    const og = view.getParam;\r\n    view.setParam = function (name, value, show) {\r\n        const index = route.indexOf(name);\r\n        if (index >= 0) {\r\n            data[name] = value;\r\n            this._segment.update(\"\", value, index + 1);\r\n            if (show) {\r\n                return view.show(null);\r\n            }\r\n        }\r\n        else {\r\n            return os.call(this, name, value, show);\r\n        }\r\n    };\r\n    view.getParam = function (key, mode) {\r\n        const val = data[key];\r\n        if (typeof val !== \"undefined\") {\r\n            return val;\r\n        }\r\n        return og.call(this, key, mode);\r\n    };\r\n    copyParams(data, view.getUrl(), route);\r\n}\n\nfunction User(app, _view, config) {\r\n    config = config || {};\r\n    const login = config.login || \"/login\";\r\n    const logout = config.logout || \"/logout\";\r\n    const afterLogin = config.afterLogin || app.config.start;\r\n    const afterLogout = config.afterLogout || \"/login\";\r\n    const ping = config.ping || 5 * 60 * 1000;\r\n    const model = config.model;\r\n    let user = config.user;\r\n    const service = {\r\n        getUser() {\r\n            return user;\r\n        },\r\n        getStatus(server) {\r\n            if (!server) {\r\n                return user !== null;\r\n            }\r\n            return model.status().catch(() => null).then(data => {\r\n                user = data;\r\n            });\r\n        },\r\n        login(name, pass) {\r\n            return model.login(name, pass).then(data => {\r\n                user = data;\r\n                if (!data) {\r\n                    throw new Error(\"Access denied\");\r\n                }\r\n                app.callEvent(\"app:user:login\", [user]);\r\n                app.show(afterLogin);\r\n            });\r\n        },\r\n        logout() {\r\n            user = null;\r\n            return model.logout().then(res => {\r\n                app.callEvent(\"app:user:logout\", []);\r\n                return res;\r\n            });\r\n        }\r\n    };\r\n    function canNavigate(url, obj) {\r\n        if (url === logout) {\r\n            service.logout();\r\n            obj.redirect = afterLogout;\r\n        }\r\n        else if (url !== login && !service.getStatus()) {\r\n            obj.redirect = login;\r\n        }\r\n    }\r\n    app.setService(\"user\", service);\r\n    app.attachEvent(`app:guard`, function (url, _$root, obj) {\r\n        if (config.public && config.public(url)) {\r\n            return true;\r\n        }\r\n        if (typeof user === \"undefined\") {\r\n            obj.confirm = service.getStatus(true).then(() => canNavigate(url, obj));\r\n        }\r\n        return canNavigate(url, obj);\r\n    });\r\n    if (ping) {\r\n        setInterval(() => service.getStatus(true), ping);\r\n    }\r\n}\n\n/*\r\nMIT License\r\nCopyright (c) 2019 XB Software\r\n*/\r\nlet webix = window.webix;\r\nif (webix) {\r\n    patch(webix);\r\n}\r\nconst plugins = {\r\n    UnloadGuard, Locale, Menu, Theme, User, Status, UrlParam\r\n};\r\nconst errors = { NavigationBlocked };\r\nconst w = window;\r\nif (!w.Promise) {\r\n    w.Promise = w.webix.promise;\r\n}\n\nexport { plugins, errors, JetApp, JetView, HashRouter, StoreRouter, UrlRouter, EmptyRouter, SubRouter };\n//# sourceMappingURL=jet.js.map\n","var index = 1;\nfunction uid() {\n\treturn index++;\n}\n\nvar empty = undefined;\n\nexport function ignoreInitial(code) {\n\tlet init = false;\n\treturn function() {\n\t\tif (init) return code.apply(this, arguments);\n\t\telse init = true;\n\t};\n}\n\nvar context = null;\nexport function withContext(value, code) {\n\tcontext = value;\n\tcode();\n\tcontext = null;\n}\n\nexport function filter(rule, handler) {\n\treturn function(v, o, obj, meta) {\n\t\tif (rule(v, meta)) handler.apply(this, arguments);\n\t};\n}\n\nexport function link(source, target, key) {\n\tObject.defineProperty(target, key, {\n\t\tget: () => source[key],\n\t\tset: value => (source[key] = value),\n\t});\n}\n\nexport function debounce(handler, delay) {\n\tdelay = delay || 200;\n\tlet timer = null;\n\tlet data = null;\n\treturn function() {\n\t\tdata = arguments;\n\t\tif (!timer) {\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttimer = null;\n\n\t\t\t\thandler.apply(this, data);\n\t\t\t}, delay);\n\t\t}\n\t};\n}\n\nexport function createState(data, config) {\n\tconfig = config || {};\n\tconst handlers = {};\n\tconst out = {};\n\n\tconst observe = function(mask, handler) {\n\t\tconst key = uid();\n\t\thandlers[key] = { mask, handler };\n\t\tif (mask === \"*\") handler(out, empty, mask);\n\t\telse handler(out[mask], empty, mask);\n\n\t\treturn key;\n\t};\n\n\tconst extend = function(data, sconfig){\n\t\tsconfig = sconfig || config;\n\t\t// normal js object\n\t\tfor (const key in data) {\n\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\tconst test = data[key];\n\t\t\t\tif (sconfig.nested && typeof test === \"object\" && test) {\n\t\t\t\t\tout[key] = createState(test, sconfig);\n\t\t\t\t} else {\n\t\t\t\t\treactive(out, test, key, notify);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tconst observeEnd = function(id) {\n\t\tdelete handlers[id];\n\t};\n\n\tconst queue = [];\n\tlet waitInQueue = false;\n\n\tvar batch = function(code) {\n\t\tif (typeof code !== \"function\") {\n\t\t\tconst values = code;\n\t\t\tcode = () => {\n\t\t\t\tfor (const key in values) out[key] = values[key];\n\t\t\t};\n\t\t}\n\n\t\twaitInQueue = true;\n\t\tcode(out);\n\t\twaitInQueue = false;\n\t\twhile (queue.length) {\n\t\t\tconst obj = queue.shift();\n\t\t\tnotify.apply(this, obj);\n\t\t}\n\t};\n\n\tconst notify = function(key, old, value, meta) {\n\t\tif (waitInQueue) {\n\t\t\tqueue.push([key, old, value, meta]);\n\t\t\treturn;\n\t\t}\n\n\t\tconst list = Object.keys(handlers);\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tconst obj = handlers[list[i]];\n\t\t\tif (!obj) continue;\n\t\t\tif (obj.mask === \"*\" || obj.mask === key) {\n\t\t\t\tobj.handler(value, old, key, meta);\n\t\t\t}\n\t\t}\n\t};\n\n\tObject.defineProperty(out, \"$changes\", {\n\t\tvalue: {\n\t\t\tattachEvent: observe,\n\t\t\tdetachEvent: observeEnd,\n\t\t},\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$observe\", {\n\t\tvalue: observe,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$batch\", {\n\t\tvalue: batch,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$extend\", {\n\t\tvalue: extend,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\n\tout.$extend(data, config);\n\treturn out;\n}\n\nfunction reactive(obj, val, key, notify) {\n\tObject.defineProperty(obj, key, {\n\t\tget: function() {\n\t\t\treturn val;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar changed = false;\n\t\t\tif (val === null || value === null) {\n\t\t\t\tchanged = val !== value;\n\t\t\t} else {\n\t\t\t\tchanged = val.valueOf() != value.valueOf();\n\t\t\t}\n\n\t\t\tif (changed) {\n\t\t\t\tvar old = val;\n\t\t\t\tval = value;\n\t\t\t\tnotify(key, old, value, context);\n\t\t\t}\n\t\t},\n\t\tenumerable: true,\n\t\tconfigurable: false,\n\t});\n}","import { JetView } from \"webix-jet\";\n\nexport default class AddView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst cals = this.app.config.calendars;\n\n\t\tconst ui = {\n\t\t\tview: compact ? \"icon\" : \"button\",\n\t\t\ttype: \"icon\",\n\t\t\ticon: \"wxi-plus\",\n\t\t\tcss: \"webix_primary\",\n\t\t\tlabel: _(\"Create\"),\n\t\t\twidth: compact ? 50 : cals ? 185 : 100,\n\t\t\theight: compact ? 50 : webix.skin.$active.inputHeight,\n\t\t\ton: {\n\t\t\t\tonItemClick: () => this.AddEvent(),\n\t\t\t},\n\t\t};\n\n\t\treturn { view: \"align\", body: ui, align: \"middle\" };\n\t}\n\n\tAddEvent() {\n\t\tthis.app.getState().selected = { id: \"0\" };\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class DateView extends JetView {\n\tconfig() {\n\t\tconst toolbar = [\n\t\t\t{\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-angle-left\",\n\t\t\t\ttooltip: () => this.NavLabel(-1),\n\t\t\t\talign: \"left\",\n\t\t\t\ton: { onItemClick: () => this.ChangeDate(-1) },\n\t\t\t},\n\t\t\t{ view: \"label\", localId: \"title\", align: \"center\", width: 160 },\n\t\t\t{\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-angle-right\",\n\t\t\t\ttooltip: () => this.NavLabel(1),\n\t\t\t\talign: \"right\",\n\t\t\t\ton: { onItemClick: () => this.ChangeDate(1) },\n\t\t\t},\n\t\t];\n\n\t\treturn {\n\t\t\tcols: toolbar,\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.on(this.State.$changes, \"date\", () => this.DateLabel());\n\t\tthis.on(this.State.$changes, \"mode\", () => this.DateLabel());\n\t}\n\n\tChangeDate(dir) {\n\t\tconst state = this.State;\n\t\tconst step = state.mode == \"agenda\" ? \"month\" : state.mode;\n\t\tconst next = webix.Date.add(state.date, dir, step, true);\n\n\t\t// fix navigation in month mode when last day of month is selected\n\t\tif (state.mode === \"month\") {\n\t\t\tconst diff = Math.abs(state.date.getMonth() - next.getMonth());\n\t\t\tif (diff != 1 && diff < 6) next.setDate(0);\n\t\t}\n\n\t\tstate.$batch({\n\t\t\tdate: next,\n\t\t\tselected: null,\n\t\t});\n\t}\n\n\tDateLabel() {\n\t\tconst date = this.State.date;\n\t\tconst label =\n\t\t\tthis.State.mode == \"day\"\n\t\t\t\t? webix.i18n.longDateFormatStr(date)\n\t\t\t\t: webix.Date.dateToStr(\"%F %Y\")(date);\n\n\t\tthis.$$(\"title\").setHTML(label);\n\t}\n\n\tNavLabel(dir) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst modes = [\"month\", \"week\", \"day\"];\n\t\tlet mode = this.State.mode;\n\t\tmode = modes.indexOf(mode) !== -1 ? ` ${mode}` : \"\";\n\n\t\tdir = dir > 0 ? \"Next\" : \"Previous\";\n\n\t\treturn _(dir + mode);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class NavBarView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\n\t\tconst toolbar = {\n\t\t\thidden: compact,\n\t\t\tview: \"tabbar\",\n\t\t\tbottomOffset: 0,\n\t\t\tlocalId: \"buttons\",\n\t\t\tborderless: true,\n\t\t\twidth: 320,\n\t\t\toptionWidth: 80,\n\t\t\toptions: [\n\t\t\t\t{ id: \"day\", value: _(\"Day\") },\n\t\t\t\t{ id: \"week\", value: _(\"Week\") },\n\t\t\t\t{ id: \"month\", value: _(\"Month\") },\n\t\t\t\t{ id: \"agenda\", value: _(\"Agenda\") },\n\t\t\t],\n\t\t};\n\n\t\tif (!compact) {\n\t\t\ttoolbar.on = { onChange: val => this.SetMode(val) };\n\t\t}\n\n\t\treturn toolbar;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.on(this.State.$changes, \"mode\", val => {\n\t\t\tthis.$$(\"buttons\").setValue(val);\n\t\t});\n\t}\n\tSetMode(val) {\n\t\tthis.State.$batch({\n\t\t\tmode: val,\n\t\t\tselected: null,\n\t\t});\n\t}\n}\n","export default function getPalette() {\n\tconst aSkin = webix.skin.$active;\n\treturn {\n\t\tview: \"colorboard\",\n\t\tcss: \"webix_scheduler_palette\",\n\t\theight: aSkin.optionHeight * 3 + 4,\n\t\twidth: aSkin.optionHeight * 7 + 4,\n\t\tpalette: [\n\t\t\t[\n\t\t\t\t\"#61AEE6\",\n\t\t\t\t\"#01C2A5\",\n\t\t\t\t\"#E88DD9\",\n\t\t\t\t\"#D2FB9E\",\n\t\t\t\t\"#6BA8CB\",\n\t\t\t\t\"#61BBA5\",\n\t\t\t\t\"#CF89D5\",\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"#EF9C80\",\n\t\t\t\t\"#8289EE\",\n\t\t\t\t\"#74B1A7\",\n\t\t\t\t\"#DD89AF\",\n\t\t\t\t\"#E48882\",\n\t\t\t\t\"#997CEB\",\n\t\t\t\t\"#ADD579\",\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"#F68896\",\n\t\t\t\t\"#FFE999\",\n\t\t\t\t\"#6D4BCE\",\n\t\t\t\t\"#99CA58\",\n\t\t\t\t\"#D352BE\",\n\t\t\t\t\"#F7CC34\",\n\t\t\t\t\"#DA5C53\",\n\t\t\t],\n\t\t],\n\t};\n}\n","import { JetView } from \"webix-jet\";\nimport getPalette from \"helpers/palette\";\n\nexport default class SidePopupView extends JetView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst save = {\n\t\t\tview: \"button\",\n\t\t\tvalue: _(\"Save\"),\n\t\t\talign: \"right\",\n\t\t\tinputWidth: 100,\n\t\t\tcss: \"webix_primary\",\n\t\t\tclick: () => this.Save(),\n\t\t};\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst compactBar = {\n\t\t\tview: \"toolbar\",\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: aSkin.layoutPadding.form,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{ view: \"icon\", icon: \"wxi-close\", click: () => this.getRoot().hide() },\n\t\t\t\t{},\n\t\t\t\tsave,\n\t\t\t],\n\t\t};\n\n\t\tconst controls = [\n\t\t\t{\n\t\t\t\tview: \"button\",\n\t\t\t\tlocalId: \"removeBtn\",\n\t\t\t\tvalue: _(\"Delete\"),\n\t\t\t\tcss: \"webix_danger webix_scheduler_danger\",\n\t\t\t\thidden: true,\n\t\t\t\talign: compact ? \"center\" : \"left\",\n\t\t\t\tinputWidth: compact ? 330 : 100,\n\t\t\t\tclick: () => this.Delete(),\n\t\t\t},\n\t\t];\n\n\t\tif (!compact) controls.push(save);\n\n\t\tconst ui = {\n\t\t\tview: \"window\",\n\t\t\twidth: 400,\n\t\t\tmodal: true,\n\t\t\tclose: true,\n\t\t\tposition: \"center\",\n\t\t\tborderless: compact,\n\t\t\tfullscreen: compact,\n\t\t\tcss: \"webix_scheduler_cal_popup\",\n\t\t\thead: compact ? compactBar : _(\"Edit calendar\"),\n\t\t\tbody: {\n\t\t\t\tview: \"form\",\n\t\t\t\tlocalId: \"calendars:form\",\n\t\t\t\telements: [\n\t\t\t\t\t{ view: \"text\", label: _(\"Title\"), name: \"text\" },\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"colorpicker\",\n\t\t\t\t\t\tlabel: _(\"Color\"),\n\t\t\t\t\t\tname: \"color\",\n\t\t\t\t\t\tsuggest: {\n\t\t\t\t\t\t\ttype: \"colorboard\",\n\t\t\t\t\t\t\tpadding: 3,\n\t\t\t\t\t\t\tbody: getPalette(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{ view: \"checkbox\", label: _(\"Active\"), name: \"active\" },\n\t\t\t\t\t{ cols: controls },\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => {\n\t\t\t\t\tthis.Form.clear();\n\t\t\t\t\tthis.$$(\"removeBtn\").hide();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tif (compact) ui.body.elements.splice(3, 0, {});\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.Cals = this.app.getService(\"local\").calendars(true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tthis.Form = this.$$(\"calendars:form\");\n\t}\n\n\tShow(id) {\n\t\tif (id) {\n\t\t\tconst obj = this.Cals.getItem(id);\n\t\t\tthis.Form.setValues(obj);\n\t\t\tthis.$$(\"removeBtn\").show();\n\t\t} else {\n\t\t\tthis.Form.setValues({\n\t\t\t\tcolor: \"#997CEB\",\n\t\t\t\tactive: 1,\n\t\t\t});\n\t\t}\n\t\tthis.getRoot().show();\n\t\tthis.Form.focus();\n\t}\n\n\tSave() {\n\t\tconst obj = this.Form.getValues();\n\t\tif (obj.id) this.Ops.updateCalendar(obj.id, obj);\n\t\telse this.Ops.addCalendar(obj);\n\t\tthis.getRoot().hide();\n\t}\n\n\tDelete() {\n\t\tconst obj = this.Form.getValues();\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\twebix.confirm(_(\"Do you really want to remove this calendar?\")).then(() => {\n\t\t\tthis.Ops.removeCalendar(obj.id);\n\t\t\tthis.getRoot().hide();\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport EditorView from \"./editor\";\nimport getPalette from \"helpers/palette\";\n\nexport default class SidePopupView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst ui = {\n\t\t\tview: \"popup\",\n\t\t\trelative: \"right\",\n\t\t\tbody: {\n\t\t\t\trows: [\n\t\t\t\t\twebix.extend(getPalette(), {\n\t\t\t\t\t\tlocalId: \"colors\",\n\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\tonItemClick: val => this.UpdateColor(val),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\t{\n\t\t\t\t\t\tcss: \"webix_scheduler_settings\",\n\t\t\t\t\t\ttemplate: _(\"Settings\"),\n\t\t\t\t\t\theight: webix.skin.$active.inputHeight,\n\t\t\t\t\t\tonClick: {\n\t\t\t\t\t\t\twebix_template: () => this.ShowEditor(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => this.app.callEvent(\"side:popup:hide\", []),\n\t\t\t},\n\t\t};\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tthis.Editor = this.ui(EditorView);\n\t}\n\n\tShow(id, node, color) {\n\t\tthis.Cid = id;\n\t\tthis.getRoot().show(node);\n\t\tthis.$$(\"colors\").setValue(color);\n\t}\n\n\tShowEditor() {\n\t\tthis.Editor.Show(this.Cid);\n\t\tthis.getRoot().hide();\n\t}\n\n\tUpdateColor(val) {\n\t\tthis.app.getService(\"operations\").updateCalendar(this.Cid, {\n\t\t\tcolor: val,\n\t\t});\n\t\tthis.getRoot().hide();\n\t}\n\n\tHide() {\n\t\tthis.getRoot().hide();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport PopupView from \"./popup\";\nimport EditorView from \"./editor\";\n\nexport default class SideView extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.app.getState();\n\n\t\tconst calendar = {\n\t\t\tview: \"calendar\",\n\t\t\tlocalId: \"calendar\",\n\t\t\theight: 276,\n\t\t\tmonthSelect: false,\n\t\t\ton: {\n\t\t\t\tonDateSelect: date => {\n\t\t\t\t\tstate.date = webix.Date.dayStart(date);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tconst list = {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"calendars\",\n\t\t\ttype: this.ListType(_, state),\n\t\t\tborderless: true,\n\t\t\tautoheight: true,\n\t\t\tyCount: 5,\n\t\t\teditable: true,\n\t\t\teditValue: \"text\",\n\t\t\teditaction: \"custom\",\n\t\t\teditor: \"text\",\n\t\t\tcss: \"webix_scheduler_cal_list\",\n\t\t\ttooltip: () => \"\",\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_cal_edit: (e, id) => this.ShowPopup(e, id),\n\t\t\t\twebix_scheduler_cal_title: (e, id) => this.ToggleCalendar(id),\n\t\t\t\twebix_scheduler_active: (e, id) => this.ToggleCalendar(id),\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonBeforeEditStop: (v, editor) => this.SetTitle(editor.id, v.value),\n\t\t\t},\n\t\t};\n\n\t\tconst rows = [\n\t\t\t{ maxHeight: 100 },\n\t\t\tlist,\n\t\t\t{\n\t\t\t\tview: \"button\",\n\t\t\t\tlocalId: \"add\",\n\t\t\t\tvalue: _(\"Add calendar\"),\n\t\t\t\thidden: !state.readonly,\n\t\t\t\tinputWidth: 190,\n\t\t\t\talign: \"center\",\n\t\t\t\tclick: () => this.AddCalendar(),\n\t\t\t},\n\t\t\t{},\n\t\t];\n\n\t\tlet side = {\n\t\t\ttype: \"form\",\n\t\t\tpadding: { top: 8 },\n\t\t\trows: rows,\n\t\t};\n\n\t\tif (!this.Compact) {\n\t\t\tlist.on.onAfterScroll = () => this.Popup.Hide();\n\t\t\tside = {\n\t\t\t\tview: \"scrollview\",\n\t\t\t\tbody: {\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\trows: [calendar, side],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\treturn side;\n\t}\n\n\tinit() {\n\t\tthis.Cals = this.$$(\"calendars\");\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tthis.Ops = this.app.getService(\"operations\");\n\n\t\tthis.Popup = this.Compact ? this.ui(EditorView) : this.ui(PopupView);\n\t\twebix.extend(this.Cals, webix.EditAbility);\n\n\t\tthis.Data.calendars().then(data => this.Cals.parse(data));\n\n\t\tconst state = this.app.getState();\n\n\t\tif (!this.Compact) {\n\t\t\tthis.on(state.$changes, \"date\", value => {\n\t\t\t\tthis.$$(\"calendar\").setValue(value);\n\t\t\t});\n\t\t\tthis.on(this.app, \"side:popup:hide\", () => {\n\t\t\t\tthis.Cals.unselectAll();\n\t\t\t});\n\t\t}\n\n\t\tthis.on(state.$changes, \"readonly\", value => this.ToggleState(value));\n\t}\n\n\tListType(_, state) {\n\t\treturn {\n\t\t\tcheckbox: function(obj) {\n\t\t\t\tconst icon =\n\t\t\t\t\tobj.active * 1 ? \"wxi-checkbox-marked\" : \"wxi-checkbox-blank\";\n\t\t\t\treturn `<span style=\"color:${obj.color};\" \n\t\t\t\t\trole=\"checkbox\" tabindex=\"-1\" \n\t\t\t\t\taria-checked=\"${obj.active ? \"true\" : \"false\"}\" \n\t\t\t\t\tclass=\"webix_icon webix_scheduler_active ${icon}\">\n\t\t\t\t</span>`;\n\t\t\t},\n\t\t\ttemplate: (obj, common) => {\n\t\t\t\tconst edit = `\n\t\t\t\t\t<span\n\t\t\t\t\t\twebix_tooltip=\"${_(\"Edit calendar\")}\" \n\t\t\t\t\t\tclass=\"webix_icon wxi-dots webix_scheduler_cal_edit \n\t\t\t\t\t\t\t${webix.env.touch ? \" webix_scheduler_cal_visible\" : \"\"}\n\t\t\t\t\t\t\">\n\t\t\t\t\t</span>\n\t\t\t\t`;\n\n\t\t\t\treturn `\n\t\t\t\t\t${common.checkbox(obj)}\n\t\t\t\t\t<span class=\"webix_scheduler_cal_title\">${obj.text || _(\"(no title)\")}</span>\n\t\t\t\t\t${state.readonly ? \"\" : edit}\n\t\t\t\t`;\n\t\t\t},\n\t\t};\n\t}\n\n\tAddCalendar() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Ops.addCalendar().then(id => {\n\t\t\tthis.Cals.edit(id);\n\t\t\tthis.Cals.getEditor()\n\t\t\t\t.getInputNode()\n\t\t\t\t.setAttribute(\"placeholder\", _(\"(no title)\"));\n\t\t});\n\t}\n\n\tShowPopup(e, id) {\n\t\tif (!this.Compact) {\n\t\t\tthis.Cals.select(id);\n\n\t\t\tconst color = this.Cals.getItem(id).color;\n\t\t\tthis.Popup.Show(id, this.Cals.getItemNode(id), color);\n\t\t} else this.Popup.Show(id);\n\t}\n\n\tToggleCalendar(id) {\n\t\tconst obj = this.Cals.getItem(id);\n\t\tthis.Ops.updateCalendar(id, { active: obj.active ^ 1 });\n\t}\n\n\tToggleState(value) {\n\t\tconst add = this.$$(\"add\");\n\t\tif (value) add.hide();\n\t\telse add.show();\n\n\t\tthis.Cals.refresh();\n\t}\n\n\tSetTitle(id, text) {\n\t\tthis.Ops.updateCalendar(id, { text }).then(\n\t\t\t() => this.EditStopSilent(),\n\t\t\t() => this.EditStopSilent(true)\n\t\t);\n\t\treturn false;\n\t}\n\n\tEditStopSilent(fail) {\n\t\tthis.Cals.blockEvent();\n\t\tif (fail) this.Cals.editCancel();\n\t\telse this.Cals.editStop();\n\t\tthis.Cals.unblockEvent();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport side from \"views/side\";\n\nexport default class NavPopupView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst list = {\n\t\t\tview: \"list\",\n\t\t\tcss: \"webix_scheduler_navlist\",\n\t\t\tlocalId: \"modes\",\n\t\t\tautoheight: true,\n\t\t\tdata: [\n\t\t\t\t{ id: \"day\", value: _(\"Day\"), icon: \"shi-day\" },\n\t\t\t\t{ id: \"week\", value: _(\"Week\"), icon: \"shi-week\" },\n\t\t\t\t{ id: \"month\", value: _(\"Month\"), icon: \"shi-month\" },\n\t\t\t\t{ id: \"agenda\", value: _(\"Agenda\"), icon: \"shi-agenda\" },\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.SetMode(id),\n\t\t\t},\n\t\t};\n\n\t\tconst ui = {\n\t\t\tview: \"sidemenu\",\n\t\t\tborderless: true,\n\t\t\tcss: \"webix_scheduler_sidemenu\",\n\t\t\twidth: 300,\n\t\t\tstate: state => {\n\t\t\t\tconst tHeight = webix.skin.$active.tabbarHeight + 10;\n\t\t\t\tstate.top = tHeight + 2;\n\t\t\t\tstate.height -= tHeight - 2;\n\t\t\t},\n\t\t\tbody: list,\n\t\t};\n\n\t\tif (this.app.config.calendars)\n\t\t\tui.body = {\n\t\t\t\tview: \"scrollview\",\n\t\t\t\tbody: {\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\trows: [list, side],\n\t\t\t\t},\n\t\t\t};\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t}\n\tShow() {\n\t\tconst win = this.getRoot();\n\t\tif (!win.isVisible()) {\n\t\t\tthis.$$(\"modes\").select(this.State.mode);\n\t\t\twin.show();\n\t\t}\n\t}\n\tSetMode(value) {\n\t\tthis.getRoot().hide();\n\n\t\t//wait until hide animation is complete\n\t\tsetTimeout(() => this.State.$batch({ mode: value, selected: null }), 500);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport NavBarView from \"views/bars/nav\";\nimport DateView from \"views/bars/date\";\nimport AddView from \"views/bars/add\";\nimport NavPopupView from \"views/bars/navpopup\";\n\nexport default class TopBarView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tconst todayIcon = {\n\t\t\tview: \"icon\",\n\t\t\ticon: \"wxi-calendar\",\n\t\t\tbatch: \"compact\",\n\t\t\ttooltip: _(\"Today\"),\n\t\t\tclick: () => this.SetToday(),\n\t\t};\n\t\tconst todayBtn = {\n\t\t\tview: \"align\",\n\t\t\talign: \"middle\",\n\t\t\tbatch: \"full\",\n\t\t\tbody: {\n\t\t\t\twidth: 80,\n\t\t\t\tview: \"button\",\n\t\t\t\tcss: \"webix_transparent\",\n\t\t\t\tvalue: _(\"Today\"),\n\t\t\t\tclick: () => this.SetToday(),\n\t\t\t},\n\t\t};\n\n\t\tconst ui = {\n\t\t\tview: \"toolbar\",\n\t\t\tcss: \"webix_scheduler_toolbar webix_dark\",\n\t\t\tresponsive: true,\n\t\t\tpaddingY: 0,\n\t\t\tpaddingX: 4,\n\t\t\theight: webix.skin.$active.tabbarHeight + 10,\n\t\t\tvisibleBatch: this.Compact ? \"compact\" : \"full\",\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"shi-menu\",\n\t\t\t\t\tclick: () => this.ShowNav(),\n\t\t\t\t\thidden: !this.Compact && !this.app.config.calendars,\n\t\t\t\t\tresponsiveCell: false,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tlocalId: \"add\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tbody: AddView,\n\t\t\t\t\tbatch: \"full\",\n\t\t\t\t\t//[ToDO] makes sence to hide it on medium screens to allows smaller compactWidth\n\t\t\t\t\t//in this case click-to-add behaviour for modes must be implemenetd\n\t\t\t\t\tresponsiveCell: false,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tbody: DateView,\n\t\t\t\t\tresponsiveCell: false,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\ttodayBtn,\n\t\t\t\tNavBarView,\n\t\t\t\ttodayIcon,\n\t\t\t],\n\t\t};\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\n\t\tif (this.Compact) this.NavPopup = this.ui(NavPopupView);\n\n\t\tthis.on(this.State.$changes, \"readonly\", value => {\n\t\t\tthis.ToggleAdd(value);\n\t\t});\n\t}\n\tSetToday() {\n\t\tthis.State.date = webix.Date.dayStart(new Date());\n\t}\n\tShowNav() {\n\t\tif (this.Compact) this.NavPopup.Show();\n\t\telse this.app.callEvent(\"show:panel\");\n\t}\n\tToggleAdd(value) {\n\t\tconst add = this.$$(\"add\");\n\t\tif (value) add.hide();\n\t\telse if (!this.Compact) add.show();\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class EventActionMenu extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"popup\",\n\t\t\tbody: {\n\t\t\t\tview: \"menu\",\n\t\t\t\tlayout: \"y\",\n\t\t\t\twidth: 220,\n\t\t\t\tautoheight: true,\n\t\t\t\tdata: [\n\t\t\t\t\t{ id: \"this\", value: _(\"This event\") },\n\t\t\t\t\t{ id: \"next\", value: _(\"This event and the following\") },\n\t\t\t\t\t{ id: \"all\", value: _(\"All events\") },\n\t\t\t\t],\n\t\t\t\ton: {\n\t\t\t\t\tonMenuItemClick: id => {\n\t\t\t\t\t\tif (this.Result) this.Result.resolve(id);\n\t\t\t\t\t\tthis.Result = null;\n\t\t\t\t\t\tthis.Root.hide();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => {\n\t\t\t\t\tif (this.Result) this.Result.reject();\n\t\t\t\t\tthis.Result = null;\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.Root = view;\n\t}\n\n\tShow(node, promise) {\n\t\tthis.Result = promise;\n\t\tthis.Root.show(node);\n\t}\n}\n","const icalFormat = webix.Date.dateToStr(\"%Y%m%dT000000Z\");\n\nexport function parse(string) {\n\t//FREQ=DAILY;INTERVAL=2\n\tconst parts = string.split(\";\");\n\tconst config = {};\n\tfor (let i = 0; i < parts.length; i++) {\n\t\tconst [code, name] = parts[i].split(\"=\");\n\t\tconfig[code] = name;\n\t}\n\n\tif (config.UNTIL) config.UNTIL = strToDate(config.UNTIL);\n\tif (config.EXDATE) {\n\t\tconfig.EXDATE = config.EXDATE.split(\",\").map(d => strToDate(d));\n\t}\n\n\treturn config;\n}\n\nfunction strToDate(str) {\n\treturn new Date(\n\t\tstr.substr(0, 4) * 1,\n\t\tstr.substr(4, 2) * 1 - 1,\n\t\tstr.substr(6, 2) * 1\n\t);\n}\n\nexport function serialize(config) {\n\tconst str = [];\n\tfor (let key in config) {\n\t\tlet value = config[key];\n\t\tif (key === \"UNTIL\") value = icalFormat(value);\n\n\t\tif (key === \"EXDATE\") {\n\t\t\tvalue = value.map(d => icalFormat(d));\n\t\t\tvalue = value.join(\",\");\n\t\t}\n\t\tif (value) str.push(`${key}=${value}`);\n\t}\n\n\treturn str.join(\";\");\n}\n","import { serialize } from \"helpers/ical\";\nexport const WEEKDAYS = [\"SU\", \"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\"];\n\nexport const FREQUENCE = {\n\tDAILY: \"day\",\n\tWEEKLY: \"week\",\n\tMONTHLY: \"month\",\n\tYEARLY: \"year\",\n};\n\nexport function explodeEvent(sdate, edate, ev) {\n\tconst mode = ev.$recurring;\n\n\t// when exact date not configured, fill recurring config\n\tif (mode.FREQ === \"WEEKLY\" && !mode.BYDAY)\n\t\tmode.BYDAY = WEEKDAYS[ev.start_date.getDay()];\n\tif (\n\t\t(mode.FREQ === \"MONTHLY\" || mode.FREQ === \"YEARLY\") &&\n\t\t!mode.BYSETPOS &&\n\t\t!mode.BYMONTHDAY\n\t)\n\t\tmode.BYMONTHDAY = ev.start_date.getDate();\n\tif (mode.FREQ === \"YEARLY\" && !mode.BYMONTH)\n\t\tmode.BYMONTH = ev.start_date.getMonth();\n\n\tconst consts = {};\n\tconst res = [];\n\n\t// when we use week-days in recurring mode, convert structure\n\t// list of days => list of steps to the next allowed day\n\tfillWdays(mode, consts);\n\n\tconst xdate = new Date(ev.start_date);\n\tconst length = ev.end_date - ev.start_date;\n\n\t// occurrences before active window\n\tlet count = 1;\n\twhile (\n\t\t(sdate - xdate >= (length || 1) &&\n\t\t\t(!mode.UNTIL || xdate < mode.UNTIL) &&\n\t\t\t(!mode.COUNT || count <= mode.COUNT)) ||\n\t\tfindDate(mode.EXDATE, xdate)\n\t) {\n\t\t++count;\n\t\tnext(xdate, mode, consts);\n\t}\n\n\t// occurrences inside of window\n\twhile (\n\t\tedate > xdate &&\n\t\t(!mode.UNTIL || xdate < mode.UNTIL) &&\n\t\t(!mode.COUNT || count <= mode.COUNT)\n\t) {\n\t\t// make copy of recurring event\n\t\tif (!findDate(mode.EXDATE, xdate)) {\n\t\t\tconst copy = webix.copy(ev);\n\n\t\t\txdate.setHours(ev.start_date.getHours());\n\t\t\tcopy.start_date = new Date(xdate);\n\t\t\tcopy.end_date = new Date(xdate * 1 + length);\n\n\t\t\tcopy.$id = ev.id;\n\t\t\tcopy.id = copy.start_date.valueOf() + \"_\" + ev.id;\n\t\t\tres.push(copy);\n\t\t}\n\t\tcount++;\n\n\t\tnext(xdate, mode, consts);\n\t}\n\treturn res;\n}\n\n// IE\nfunction findDate(arr, date) {\n\tif (!arr) return false;\n\n\tfor (let i = 0; i < arr.length; ++i) {\n\t\tif (webix.Date.equal(webix.Date.dayStart(date), arr[i])) return true;\n\t}\n\treturn false;\n}\n\nexport function fillWdays(mode, consts) {\n\tif (mode.BYDAY) {\n\t\tconst diff = (consts.wdays = [0, 0, 0, 0, 0, 0, 0]);\n\t\tconst line = mode.BYDAY.split(\",\")\n\t\t\t.map(a => WEEKDAYS.indexOf(a))\n\t\t\t.sort();\n\n\t\t// for each allowed day, fill range with steps\n\t\tfor (let i = 0; i < line.length; i++) {\n\t\t\tconst s = line[i];\n\t\t\tconst e = line[i + 1] || line[0] + 7;\n\n\t\t\tfor (let j = s; j < e; j++) {\n\t\t\t\tdiff[j % 7] = e - j;\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport function next(date, mode, consts) {\n\tlet interval = (mode.INTERVAL || 1) * 1;\n\tif (mode.FREQ == \"YEARLY\") interval *= 12;\n\n\tlet now, step;\n\tswitch (mode.FREQ) {\n\t\tcase \"DAILY\":\n\t\t\tdate.setDate(date.getDate() + interval);\n\t\t\tbreak;\n\t\tcase \"WEEKLY\":\n\t\t\tnow = date.getDay();\n\t\t\tstep = consts.wdays ? consts.wdays[now] : 7;\n\t\t\tif (step + now > 6 && interval > 1) {\n\t\t\t\t// when new day is on the different week\n\t\t\t\t// add week interval as well\n\t\t\t\tstep += 7 * (interval - 1);\n\t\t\t}\n\t\t\tdate.setDate(date.getDate() + step);\n\t\t\tbreak;\n\t\tcase \"YEARLY\":\n\t\tcase \"MONTHLY\":\n\t\t\tnow = date.getMonth();\n\t\t\tdate.setDate(1);\n\t\t\tdate.setMonth(now + interval);\n\t\t\tif (mode.BYMONTHDAY) {\n\t\t\t\tdate.setDate(mode.BYMONTHDAY);\n\t\t\t\t// when date is outside of month bounds, switch to last day of month\n\t\t\t\tif ((now + interval) % 12 != date.getMonth()) date.setDate(0);\n\t\t\t} else if (mode.BYSETPOS) {\n\t\t\t\t// go to last day of month before one in question\n\t\t\t\tdate.setDate(0);\n\t\t\t\t// find the matching day\n\t\t\t\tfor (let i = 0; i < mode.BYSETPOS; i++) {\n\t\t\t\t\tstep = consts.wdays[date.getDay()];\n\t\t\t\t\tdate.setDate(date.getDate() + step);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t}\n\n\treturn date;\n}\n\nfunction checkDay(sdate, mode) {\n\tconst start = new Date(sdate);\n\tconst days = mode.BYDAY.split(\",\");\n\tconst oldDay = WEEKDAYS[start.getDay()];\n\tconst result = days.includes(oldDay);\n\n\treturn { result, start, days, oldDay };\n}\n\nexport function datesToRec(sdate, edate, mode) {\n\tif (mode.FREQ === \"WEEKLY\") {\n\t\tconst { result, start, days } = checkDay(sdate, mode);\n\t\tif (result) {\n\t\t\treturn [null, null];\n\t\t}\n\n\t\tconst diff = WEEKDAYS.indexOf(days[0]) - start.getDay();\n\t\tstart.setDate(start.getDate() + diff);\n\n\t\tconst end = new Date(edate);\n\t\tend.setDate(end.getDate() + diff);\n\n\t\treturn [start, end];\n\t}\n\n\treturn [null, null];\n}\n\nexport function recToDate(sdate, mode) {\n\tlet { result, days, oldDay } = checkDay(sdate, mode);\n\tif (result) {\n\t\treturn mode.BYDAY;\n\t}\n\n\tif (mode.FREQ === \"WEEKLY\") {\n\t\tdays.splice(WEEKDAYS.indexOf(days[0]), 0, oldDay);\n\t} else {\n\t\tdays = [oldDay];\n\t}\n\treturn days.join(\",\");\n}\n\nexport function getParams(obj) {\n\treturn { id: obj.$id || obj.id, date: obj.$recurring ? obj.id : null };\n}\n\nexport function extractDate(sdate) {\n\treturn webix.Date.dayStart(\n\t\tsdate.getDate ? sdate : new Date(sdate.split(\"_\")[0] * 1)\n\t);\n}\n\nexport function clipSequence(sdate, ev, block) {\n\tconst date = extractDate(sdate);\n\n\tif (!block || (!ev.$recurring.UNTIL || ev.$recurring.UNTIL > date))\n\t\tev.$recurring.UNTIL = date;\n\n\tif (ev.$recurring.COUNT) delete ev.$recurring.COUNT;\n\n\tif (ev.$recurring.EXDATE) {\n\t\tev.$recurring.EXDATE = ev.$recurring.EXDATE.filter(d => d < date);\n\t}\n\n\treturn serialize(ev.$recurring);\n}\n\nexport function cutOccurrence(sdate, ev) {\n\tconst date = extractDate(sdate);\n\n\tif (!ev.$recurring.EXDATE) ev.$recurring.EXDATE = [];\n\tev.$recurring.EXDATE.push(date);\n\n\treturn serialize(ev.$recurring);\n}\n\nexport function separateSequence(obj, sdate) {\n\tconst start_date =\n\t\ttypeof sdate === \"string\"\n\t\t\t? new Date(sdate.split(\"_\")[0] * 1)\n\t\t\t: new Date(sdate);\n\tconst len = (obj.end_date - obj.start_date) / 1000 / 60; // mins\n\tconst end_date = webix.Date.add(start_date, len, \"minute\", true);\n\treturn { start_date, end_date };\n}\n\nexport function isFirstOccurrence(sdate, evStart) {\n\t// editing 'this' event as next\n\tif (!sdate) return false;\n\n\tconst od = sdate.getDate ? sdate : new Date(sdate.split(\"_\")[0] * 1);\n\treturn od <= evStart;\n}\n\nexport function correctMode(obj, mode) {\n\tif (!obj.origin_id || !obj.recurring) {\n\t\tmode = \"all\";\n\t} else {\n\t\t// if this is 1st occ in 'next' which is the last part of 'all'\n\t\tif (this.app.getService(\"local\").isLastPart(obj)) {\n\t\t\tmode = \"\";\n\t\t}\n\t}\n\treturn mode;\n}\n\nexport function movePattern(rec, newEvent, obj) {\n\tlet days =\n\t\twebix.Date.dayStart(newEvent.start_date) -\n\t\twebix.Date.dayStart(obj.start_date);\n\tif (days) days /= 1000 * 60 * 60 * 24;\n\n\tif (rec.UNTIL && days) {\n\t\trec.UNTIL = webix.Date.add(rec.UNTIL, days, \"day\", true);\n\t}\n\n\t// day of start_date changed and pattern doesn't have in anymore\n\tif (rec.BYDAY && days) {\n\t\tdays %= 7;\n\t\tif (days < 0) days += 7;\n\t\trec.BYDAY = rec.BYDAY.split(\",\")\n\t\t\t.map(d => WEEKDAYS[(WEEKDAYS.indexOf(d) + days) % 7])\n\t\t\t.join(\",\");\n\t}\n\n\t// in case day of start_date changed in monthly or yearly\n\tif (rec.BYMONTHDAY && days) {\n\t\tconst nmd = newEvent.start_date.getDate();\n\t\tif (nmd != rec.BYMONTHDAY) {\n\t\t\trec.BYMONTHDAY = nmd;\n\t\t}\n\t}\n\n\t// week number of start_date changed in yearly or monthly\n\tif (rec.BYSETPOS) {\n\t\tconst nwn = getWeekNum(newEvent.start_date);\n\t\tif (rec.BYSETPOS != nwn) rec.BYSETPOS = nwn;\n\t}\n\n\t// month of start_date changed in a yearly event\n\tif (rec.BYMONTH) {\n\t\tconst nm = newEvent.start_date.getMonth() + 1;\n\t\tif (nm != rec.BYMONTH) rec.BYMONTH = nm;\n\t}\n\n\treturn rec;\n}\n\nfunction getWeekNum(date) {\n\tconst day = date.getDate();\n\treturn Math.floor(day / 7) + (day % 7 ? 1 : 0);\n}\n","import { JetView } from \"webix-jet\";\nimport { WEEKDAYS, fillWdays, next } from \"helpers/recurring\";\n\nexport default class RecurringFormView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"recurringForm\",\n\t\t\thidden: true,\n\t\t\telementsConfig: { labelPosition: \"left\" },\n\t\t\tpadding: {\n\t\t\t\ttop: aSkin.layoutPadding.form,\n\t\t\t\tbottom: 0,\n\t\t\t\tleft: compact ? aSkin.layoutPadding.form : 0,\n\t\t\t\tright: compact ? 14 : 0,\n\t\t\t},\n\t\t\tborderless: true,\n\t\t\trows: [\n\t\t\t\tthis.CreateIntervalControls(_),\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"customRecControls\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\trows: [this.CreateCheckboxes(_), this.CreateSelect()],\n\t\t\t\t},\n\t\t\t\tthis.CreateRadio(_),\n\t\t\t],\n\t\t};\n\n\t\tif (!compact) {\n\t\t\tform.on = {\n\t\t\t\tonChange: () => this.UpdateEvent(),\n\t\t\t};\n\t\t}\n\n\t\treturn form;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.Form = this.$$(\"recurringForm\");\n\t\tthis.Events = this.app.getService(\"local\").events(true);\n\n\t\t// commonly called controls\n\t\tthis.CheckBoxContainer = this.$$(\"weekly\");\n\t\tthis.Checkboxes = this.CheckBoxContainer.getChildViews().slice(1);\n\t\tthis.Checkboxes.pop();\n\t\tthis.PatternSelect = this.$$(\"patternSelect\");\n\t\tthis.UntilDateContainer = this.$$(\"untilDate\");\n\t\tthis.UntilDateCalendar = this.Form.elements.untilDate.getPopup().getBody();\n\t\tthis.UntilNumContainer = this.$$(\"untilCount\");\n\t\tthis.UntilNum = this.UntilNumContainer.getBody();\n\t\tthis.CustomRecControls = this.$$(\"customRecControls\");\n\t}\n\n\t// methods of main controls: counter of INTERVAL and richselect of FREQ\n\tCreateIntervalControls(_) {\n\t\treturn {\n\t\t\tmargin: 8,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"counter\",\n\t\t\t\t\tlabel: _(\"Every\"),\n\t\t\t\t\tlabelWidth: 50,\n\t\t\t\t\tmin: 1,\n\t\t\t\t\tname: \"INTERVAL\",\n\t\t\t\t\tcss: \"webix_scheduler_counter\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\tname: \"FREQ\",\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ id: \"DAILY\", value: _(\"day\") },\n\t\t\t\t\t\t{ id: \"WEEKLY\", value: _(\"week\") },\n\t\t\t\t\t\t{ id: \"MONTHLY\", value: _(\"month\") },\n\t\t\t\t\t\t{ id: \"YEARLY\", value: _(\"year\") },\n\t\t\t\t\t],\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: v => this.ChangeControls(v),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tChangeControls(v) {\n\t\tthis._freq = v;\n\t\tif (v === \"DAILY\") {\n\t\t\tthis.CustomRecControls.hide();\n\t\t} else {\n\t\t\tthis.CustomRecControls.show();\n\t\t\tif (v === \"WEEKLY\") {\n\t\t\t\tthis.CheckBoxContainer.show();\n\t\t\t\tthis.PatternSelect.hide();\n\t\t\t} else {\n\t\t\t\tthis.CheckBoxContainer.hide();\n\t\t\t\tthis.PatternSelect.show();\n\t\t\t\tthis.PatternSelect.refresh();\n\t\t\t}\n\t\t}\n\t}\n\n\t// methods of checkboxes for WEEKLY\n\tCreateCheckboxes(_) {\n\t\tconst days = [];\n\t\tfor (let i = 0; i < 7; ++i) {\n\t\t\tdays.push({\n\t\t\t\tview: \"checkbox\",\n\t\t\t\tlabel: webix.i18n.calendar.dayShort[i],\n\t\t\t\tlabelPosition: \"top\",\n\t\t\t\tlabelAlign: \"center\",\n\t\t\t\tcss: \"webix_scheduler_day_checkbox\",\n\t\t\t\tinputWidth: 26,\n\t\t\t\twidth: 45,\n\t\t\t\talign: \"center\",\n\t\t\t\tname: WEEKDAYS[i],\n\t\t\t\ton: {\n\t\t\t\t\tonChange(v, o) {\n\t\t\t\t\t\tif (!webix.isUndefined(o) && !v && !this.$scope.GetBYDAY()) {\n\t\t\t\t\t\t\tthis.$scope.SetSilently(this, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\treturn {\n\t\t\tlocalId: \"weekly\",\n\t\t\tcols: [\n\t\t\t\t{ view: \"label\", label: _(\"on\"), width: 45 },\n\t\t\t\t...days,\n\t\t\t\t{ gravity: 0.00001 },\n\t\t\t],\n\t\t};\n\t}\n\n\tSetBYDAY(values) {\n\t\tconst days = values.BYDAY.split(\",\");\n\t\tthis.Checkboxes.forEach(check => {\n\t\t\tvalues[check.config.name] = !!days.find(d => d == check.config.name);\n\t\t});\n\t}\n\n\tGetBYDAY() {\n\t\tconst BYDAY = [];\n\t\tthis.Checkboxes.forEach(check => {\n\t\t\tif (check.getValue()) {\n\t\t\t\tBYDAY.push(check.config.name);\n\t\t\t}\n\t\t});\n\t\treturn BYDAY.join(\",\");\n\t}\n\n\t// methods of richselect with MONTHLY and YEARLY patterns\n\tCreateSelect() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"richselect\",\n\t\t\tlocalId: \"patternSelect\",\n\t\t\tname: \"rec_pattern\",\n\t\t\tsuggest: {\n\t\t\t\tdata: [],\n\t\t\t\tbody: {\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\tconst byDay = [];\n\t\t\t\t\t\tif (obj.BYDAY) {\n\t\t\t\t\t\t\tobj.BYDAY.forEach(d =>\n\t\t\t\t\t\t\t\tbyDay.push(webix.i18n.calendar.dayFull[d])\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn `${_(\"Every\")} ${obj.BYMONTHDAY || obj.BYSETPOS} ${\n\t\t\t\t\t\t\tobj.BYDAY ? byDay.join(\", \") : \"\"\n\t\t\t\t\t\t} ${\n\t\t\t\t\t\t\tthis._freq === \"YEARLY\"\n\t\t\t\t\t\t\t\t? webix.i18n.calendar.monthFull[obj.BYMONTH - 1]\n\t\t\t\t\t\t\t\t: \"\"\n\t\t\t\t\t\t}`;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tSetPatternOptions(ev, calculated) {\n\t\tlet byDay;\n\t\tif (ev.BYDAY) {\n\t\t\tbyDay = ev.BYDAY.split(\",\").map(d => WEEKDAYS.indexOf(d));\n\t\t} else {\n\t\t\tbyDay = [calculated.weekday];\n\t\t}\n\t\tthis.PatternSelect.getList().parse([\n\t\t\t{\n\t\t\t\tid: 1,\n\t\t\t\tBYMONTH: ev.BYMONTH || calculated.month + 1,\n\t\t\t\tBYMONTHDAY: ev.BYMONTHDAY || calculated.day,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 2,\n\t\t\t\tBYSETPOS: ev.BYSETPOS || calculated.weekNum,\n\t\t\t\tBYDAY: byDay,\n\t\t\t\tBYMONTH: ev.BYMONTH || calculated.month + 1,\n\t\t\t},\n\t\t]);\n\t\tthis._freq = ev.FREQ;\n\n\t\tev.rec_pattern = ev.BYSETPOS ? 2 : 1;\n\t}\n\n\tGetRecPattern(values) {\n\t\tconst data = webix.copy(\n\t\t\tthis.PatternSelect.getList().getItem(values.rec_pattern)\n\t\t);\n\n\t\tif (this._freq === \"MONTHLY\") delete data.BYMONTH;\n\t\tif (data.BYDAY) data.BYDAY = data.BYDAY.map(d => WEEKDAYS[d]);\n\t\tdelete data.id;\n\n\t\treturn data;\n\t}\n\n\t// methods of radio for UNTIL\n\tCreateRadio(_) {\n\t\tconst selectors = {\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"untilDate\",\n\t\t\t\t\talign: \"middle\",\n\t\t\t\t\tview: \"align\",\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\tname: \"untilDate\",\n\t\t\t\t\t\ticons: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"untilCount\",\n\t\t\t\t\tview: \"align\",\n\t\t\t\t\talign: \"bottom\",\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tname: \"untilCount\",\n\t\t\t\t\t\tview: \"counter\",\n\t\t\t\t\t\tcss: \"webix_scheduler_counter\",\n\t\t\t\t\t\tmin: 1,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn {\n\t\t\trows: [\n\t\t\t\t{ view: \"label\", label: _(\"End repeat\") },\n\t\t\t\t{\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"radio\",\n\t\t\t\t\t\t\tname: \"until\",\n\t\t\t\t\t\t\tlocalId: \"until\",\n\t\t\t\t\t\t\tvertical: true,\n\t\t\t\t\t\t\tgravity: 1.5,\n\t\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t\t{ id: 1, value: _(\"never\") },\n\t\t\t\t\t\t\t\t{ id: 2, value: _(\"date\") },\n\t\t\t\t\t\t\t\t{ id: 3, value: _(\"after several occurrences\") },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\tonChange: v => this.ChangeSelectors(v),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tselectors,\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tChangeSelectors(v) {\n\t\tthis.UntilDateContainer[v === \"2\" ? \"show\" : \"hide\"]();\n\t\tthis.UntilNumContainer[v === \"3\" ? \"show\" : \"hide\"]();\n\t}\n\n\tSetUNTIL(start, values) {\n\t\tvalues.until = values.COUNT ? 3 : values.UNTIL ? 2 : 1;\n\t\tvalues.untilDate = values.UNTIL || webix.Date.add(start, 1, \"year\", true);\n\t\tvalues.untilCount = values.COUNT || this.CountNum(start, values);\n\t\tthis.UntilDateCalendar.define({ minDate: start });\n\t}\n\n\tCountNum(start, values) {\n\t\tlet res = 0;\n\n\t\tif (values.UNTIL) {\n\t\t\tconst consts = {};\n\t\t\tfillWdays(values, consts);\n\t\t\tlet date = webix.Date.copy(start);\n\n\t\t\twhile (date <= values.UNTIL) {\n\t\t\t\tdate = next(date, values, consts);\n\t\t\t\tres++;\n\t\t\t}\n\t\t} else {\n\t\t\tres = 3;\n\t\t}\n\n\t\treturn res;\n\t}\n\n\t// subform methods\n\tSetValues(event, calculated, silent) {\n\t\tthis._StartDate = event.start_date;\n\t\tlet values = event.$recurring;\n\n\t\tif (!values) {\n\t\t\tvalues = { FREQ: \"DAILY\" };\n\t\t}\n\n\t\tif (!values.INTERVAL) values.INTERVAL = 1;\n\t\tif (!values.BYDAY) {\n\t\t\tvalues.BYDAY = WEEKDAYS[calculated.weekday];\n\t\t}\n\n\t\t// for a reset\n\t\tif (!values.EXDATE) values.EXDATE = [];\n\n\t\tthis.SetUNTIL(event.start_date, values);\n\t\tthis.SetBYDAY(values);\n\t\tthis.SetPatternOptions(values, calculated);\n\t\tthis.Form.setValues(values, true);\n\t\tif (silent) this.Form.setDirty();\n\t}\n\n\tGetValues() {\n\t\tlet values = this.Form.getValues();\n\n\t\tlet res = {\n\t\t\tFREQ: values.FREQ,\n\t\t\tINTERVAL: values.INTERVAL,\n\t\t\tUNTIL: values.until == 2 ? values.untilDate : null,\n\t\t\tCOUNT: values.until == 3 ? values.untilCount : null,\n\t\t\tEXDATE: values.EXDATE || [],\n\t\t};\n\n\t\tif (values.FREQ === \"WEEKLY\") {\n\t\t\tres.BYDAY = this.GetBYDAY(values);\n\t\t} else if (values.FREQ === \"MONTHLY\" || values.FREQ === \"YEARLY\") {\n\t\t\tres = webix.extend(res, this.GetRecPattern(values));\n\t\t}\n\n\t\tthis.Form.setDirty();\n\n\t\treturn res;\n\t}\n\n\tUpdateEvent() {\n\t\tif (this.IsDirty()) {\n\t\t\tconst change = this.GetValues();\n\t\t\tthis.app.callEvent(\"form:update:recurring\", [{ $recurring: change }]);\n\t\t\tthis.Form.setDirty();\n\t\t}\n\t}\n\n\tIsDirty() {\n\t\treturn this.Form.isDirty();\n\t}\n\n\tShow() {\n\t\tthis.getRoot().show();\n\t}\n\n\tHide() {\n\t\tthis.getRoot().hide();\n\t}\n\n\t// applies changes in values made by code to form\n\tSetSilently(control, value) {\n\t\tcontrol.blockEvent();\n\t\tcontrol.setValue(value);\n\t\tcontrol.unblockEvent();\n\t}\n\n\tUpdateSilently(values) {\n\t\tthis.Form.blockEvent();\n\t\tthis.Form.setValues(values, true);\n\t\tthis.Form.unblockEvent();\n\t}\n}\n","import {\n\tisFirstOccurrence,\n\tcorrectMode,\n\textractDate,\n\tFREQUENCE,\n\tfillWdays,\n\tnext,\n} from \"./recurring\";\n\n/* public functions */\n\n/**\n * Changes the mode if the user selected the 1st occurrence in whole sequence or in 'next'\n * @param {string} mode - the mode of editing a recurring event (\"all\", \"next\", \"this\")\n * @param {object} obj - the event object\n * @param {Date} start - the start date of the event\n * @param {Date, string} date_id - the ID of an occurrence of a repeated event or the date of this occurrence\n */\nfunction changeMode(mode, obj, start, date_id) {\n\tif (mode && mode === \"next\" && isFirstOccurrence(date_id, start)) {\n\t\tmode = correctMode.call(this, obj, mode);\n\t}\n\n\treturn mode;\n}\n\n/**\n * Corrects recurring.COUNT or recurring.UNTIL based on all sub-events that are included in the edited range\n * @param {Object} obj - the event data\n * @param {string} mode - the mode of recurring editing (\"all\", \"next\")\n * @param {Date} sdate - the date of the currently selected event occurrence\n * @param {Object} collection - DataCollection of events\n */\nfunction correctCountUntil(obj, mode, sdate, collection) {\n\tconst oid = obj.origin_id || obj.$id || obj.id;\n\tconst parts = collection\n\t\t.find(e => {\n\t\t\treturn oid == e.origin_id && sdate < e.start_date;\n\t\t})\n\t\t.sort((a, b) => {\n\t\t\tif (a.start_date > b.start_date) return -1;\n\t\t\tif (a.start_date < b.start_date) return 1;\n\t\t\treturn 0;\n\t\t});\n\n\tconst rec = webix.copy(obj.$recurring);\n\n\tfor (let i = 0, last; i < parts.length; ++i) {\n\t\tlast = parts[i];\n\n\t\tif (last.$recurring) {\n\t\t\tif (last.$recurring.COUNT) {\n\t\t\t\tif (rec.COUNT && obj.$id != last.id) {\n\t\t\t\t\trec.COUNT = rec.COUNT * 1 + last.$recurring.COUNT * 1;\n\t\t\t\t} else {\n\t\t\t\t\trec.UNTIL = countToUntil(last);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trec.UNTIL = last.$recurring.UNTIL;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (mode === \"next\" && !parts.length) {\n\t\tif (rec.COUNT) {\n\t\t\trec.COUNT = cutCount(obj, sdate);\n\t\t} else if (rec.UNTIL && obj.start_date >= rec.UNTIL) {\n\t\t\trec.UNTIL = webix.Date.add(\n\t\t\t\twebix.Date.dayStart(obj.start_date),\n\t\t\t\t1,\n\t\t\t\tFREQUENCE[rec.FREQ],\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t}\n\n\treturn rec;\n}\n\n/**\n * Checks if the selected repeating event has only 1 occurrence\n * @param {Object} obj - the event data\n */\nfunction hasOneOccurrence(obj) {\n\t// as this a 'this' event\n\tif (!obj.recurring) return true;\n\n\t// as 'this' any occurrence in unedited sequence\n\tif (!obj.$recurring.UNTIL) return false;\n\n\tconst end = webix.Date.dayStart(webix.Date.add(obj.end_date, 1, \"day\", true));\n\treturn webix.Date.equal(end, obj.$recurring.UNTIL);\n}\n\n/* EO public functions */\n\n/* private functions */\nfunction countToUntil(last) {\n\tconst lr = last.$recurring;\n\tlet step = lr.COUNT * 1; // !\n\tif (lr.FREQ === \"WEEKLY\") {\n\t\tstep = Math.floor((lr.BYDAY.split(\",\").length / 7) * lr.COUNT);\n\t}\n\treturn webix.Date.add(last.start_date, step, FREQUENCE[lr.FREQ], true);\n}\n\nfunction cutCount(obj, sdate) {\n\tconst date = extractDate(sdate);\n\n\tconst consts = {};\n\tfillWdays(obj.$recurring, consts);\n\tlet nexto = webix.Date.dayStart(obj.start_date);\n\tlet count = 0;\n\twhile (nexto < date) {\n\t\tcount++;\n\t\tnexto = next(nexto, obj.$recurring, consts);\n\t}\n\treturn obj.$recurring.COUNT - count;\n}\n/* EO private functions */\n\nexport default function EditRecurringMixin(child) {\n\tchild.ChangeMode = changeMode;\n\tchild.CorrectCountUntil = correctCountUntil;\n\tchild.HasOneOccurrence = hasOneOccurrence;\n}\n","import { JetView } from \"webix-jet\";\nimport getPalette from \"helpers/palette\";\n\nimport {\n\tWEEKDAYS,\n\tfillWdays,\n\tnext,\n\tdatesToRec,\n\trecToDate,\n\tclipSequence,\n\tcutOccurrence,\n\tseparateSequence,\n} from \"helpers/recurring\";\nimport { serialize } from \"helpers/ical\";\nimport RecurringFormView from \"./recurringform\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\n\nexport default class EventFormView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst toolbar = {\n\t\t\tview: \"toolbar\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: 14,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\ttooltip: _(\"Close\"),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => this.Close(),\n\t\t\t\t},\n\t\t\t\t{ view: \"label\", label: _(\"Edit event\") },\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\twidth: 130,\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tvalue: _(\"Done\"),\n\t\t\t\t\thotkey: \"Ctrl+Enter\",\n\t\t\t\t\tclick: () => this.Done(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"form\",\n\t\t\tscroll: true,\n\t\t\tborderless: true,\n\t\t\tpadding: { right: 14 },\n\t\t\telementsConfig: { labelPosition: \"top\" },\n\t\t\telements: [\n\t\t\t\t{ view: \"text\", label: _(\"Event\"), name: \"text\" },\n\t\t\t\t{\n\t\t\t\t\tmargin: 8,\n\t\t\t\t\trows: [\n\t\t\t\t\t\tthis.GetDateTime(\"start\", _, aSkin),\n\t\t\t\t\t\tthis.GetDateTime(\"end\", _, aSkin),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\tname: \"all_day\",\n\t\t\t\t\tlabelPosition: \"left\",\n\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\tlabelRight: _(\"labelAllday\"),\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: v => this.ToggleTimeControls(v),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.CreateCalendarColor(_),\n\t\t\t\t{\n\t\t\t\t\tview: \"textarea\",\n\t\t\t\t\tlabel: _(\"Notes\"),\n\t\t\t\t\tname: \"details\",\n\t\t\t\t\theight: 150,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t],\n\t\t\ton: {},\n\t\t};\n\n\t\tif (this.app.config.recurring)\n\t\t\tform.elements.splice(3, 0, this.CreateRepeat(_, aSkin));\n\n\t\tif (!this.Compact) {\n\t\t\tform.on.onChange = (v, o) => {\n\t\t\t\tthis.Wait(() => this.UpdateEvent(this.Form.getDirtyValues(), o));\n\t\t\t};\n\t\t}\n\n\t\tconst config = {\n\t\t\tview: \"proxy\", // for borders\n\t\t\tbody: {\n\t\t\t\tmargin: 0,\n\t\t\t\trows: [toolbar, form],\n\t\t\t},\n\t\t};\n\n\t\treturn config;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.Form = this.$$(\"form\");\n\t\tthis.Local = this.app.getService(\"local\").events(true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\n\t\t// extending this class with common methods for editing of recurring events\n\t\tEditRecurringMixin(this);\n\n\t\t// most commonly called controls\n\t\tthis.RecurringOptions = this.$$(\"recOption\");\n\t\tthis.StartTime = this.$$(\"startTime\");\n\t\tthis.EndTime = this.$$(\"endTime\");\n\n\t\tthis.on(this.State.$changes, \"readonly\", (_v, o) => {\n\t\t\tif (!webix.isUndefined(o)) this.Close();\n\t\t});\n\n\t\tthis.on(this.app, \"form:update:recurring\", update => {\n\t\t\t// 'update' as imitated dirty value\n\t\t\tthis.UpdateEvent(update);\n\t\t});\n\n\t\t// parse lists that are not data dependable\n\t\tif (this.app.config.calendars) {\n\t\t\tthis.Calendars = this.app.getService(\"local\").calendars(true);\n\t\t\tthis.$$(\"calendar\")\n\t\t\t\t.getList()\n\t\t\t\t.parse(this.Calendars);\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.SubForm = this.getSubView(\"recurringForm\");\n\t\tthis.on(this.State.$changes, \"selected\", v => {\n\t\t\tif (v) {\n\t\t\t\tthis.ClearTempEvent(); // support double clicks and 'Create' at any moment\n\t\t\t\tthis.Wait(() => this.FillForm(v));\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy() {\n\t\tthis.ClearTempEvent();\n\t}\n\n\t/**\n\t * Returns the config controls for editing recurring patterns of events\n\t * @param {function} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t * @param {Object} aSkin - stores sizes and colors of a currently active Webix skin\n\t */\n\tCreateRepeat(_, aSkin) {\n\t\tconst rows = [\n\t\t\t{ view: \"label\", label: _(\"Repeat\"), height: aSkin.labelTopHeight },\n\t\t\t{\n\t\t\t\tmargin: 4,\n\t\t\t\tcols: [\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\t\tlocalId: \"recOption\",\n\t\t\t\t\t\tname: \"rec_option\",\n\t\t\t\t\t\tsuggest: {\n\t\t\t\t\t\t\tdata: [\n\t\t\t\t\t\t\t\t{ id: \"none\", value: _(\"never\") },\n\t\t\t\t\t\t\t\t{ id: \"daily\", value: _(\"daily\") },\n\t\t\t\t\t\t\t\t{ id: \"weekly\" },\n\t\t\t\t\t\t\t\t{ id: \"monthly\" },\n\t\t\t\t\t\t\t\t{ id: \"yearly\" },\n\t\t\t\t\t\t\t\t{ id: \"work\", value: _(\"every working day\") },\n\t\t\t\t\t\t\t\t{ id: \"custom\", value: _(\"custom\") },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\tonChange: (v, o) => this.ToggleSubform(v, o),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t];\n\n\t\tif (this.Compact) {\n\t\t\trows[1].cols.push({\n\t\t\t\tlocalId: \"editCustomRec\",\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-pencil\",\n\t\t\t\ttooltip: _(\"Change recurring pattern\"),\n\t\t\t\thidden: true,\n\t\t\t\tclick: () => this.ShowSubForm(),\n\t\t\t});\n\t\t}\n\n\t\trows.push({ $subview: RecurringFormView, name: \"recurringForm\" });\n\n\t\treturn { localId: \"repeatControls\", rows: rows };\n\t}\n\n\t/**\n\t * Hides or shows time selectors\n\t * @param {number} v - the value of 'all day' checkbox (1 or 0)\n\t */\n\tToggleTimeControls(v) {\n\t\tif (v == 1) {\n\t\t\tthis.StartTime.hide();\n\t\t\tthis.EndTime.hide();\n\t\t} else {\n\t\t\tthis.StartTime.show();\n\t\t\tthis.EndTime.show();\n\t\t}\n\t}\n\n\t/**\n\t * Shows or hides the subform for editing recurring pattern; the subform is shown when v is 'custom'\n\t * @param {string} v - the new recurring pattern option\n\t * @param {string} o  - the new recurring pattern option\n\t */\n\tToggleSubform(v, o) {\n\t\tif (v === \"custom\") {\n\t\t\tif (this.Compact) {\n\t\t\t\tthis.$$(\"editCustomRec\").show();\n\t\t\t\tif (o) this.ShowSubForm();\n\t\t\t} else {\n\t\t\t\tthis.SubForm.Show();\n\t\t\t}\n\t\t} else {\n\t\t\tthis.SubForm.Hide();\n\t\t\tif (this.Compact) this.$$(\"editCustomRec\").hide();\n\t\t}\n\t}\n\n\t/**\n\t * Returns the config of two controls: a selector of calendar and event color\n\t * @param {function} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t */\n\tCreateCalendarColor(_) {\n\t\tconst ui = {\n\t\t\tmargin: 8,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"colorpicker\",\n\t\t\t\t\tlabel: _(\"Color\"),\n\t\t\t\t\tname: \"color\",\n\t\t\t\t\tvalue: \"#1abc9c\",\n\t\t\t\t\tsuggest: {\n\t\t\t\t\t\ttype: \"colorboard\",\n\t\t\t\t\t\tpadding: 3,\n\t\t\t\t\t\tbody: getPalette(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t\tif (this.app.config.calendars) {\n\t\t\tui.cols.unshift({\n\t\t\t\tview: \"richselect\",\n\t\t\t\tlocalId: \"calendar\",\n\t\t\t\tlabel: _(\"Calendar\"),\n\t\t\t\tname: \"calendar\",\n\t\t\t\tcss: \"webix_scheduler_cal_color\",\n\t\t\t\toptions: {\n\t\t\t\t\tcss: \"webix_scheduler_cal_color_suggest\",\n\t\t\t\t\tdata: [],\n\t\t\t\t\tbody: {\n\t\t\t\t\t\ttooltip: () => \"\",\n\t\t\t\t\t\ttemplate: function(obj) {\n\t\t\t\t\t\t\tconst active = obj.active * 1;\n\t\t\t\t\t\t\tconst css = active ? \"\" : \"class='webix_scheduler_cal_disabled'\";\n\t\t\t\t\t\t\tconst tooltip = active\n\t\t\t\t\t\t\t\t? \"\"\n\t\t\t\t\t\t\t\t: `webix_tooltip=\"${_(\"Inactive calendar\")}\"`;\n\n\t\t\t\t\t\t\treturn `<div style=\"overflow: hidden;\" ${tooltip} ${css}>${obj.text ||\n\t\t\t\t\t\t\t\t_(\"(no title)\")}\n\t\t\t\t\t\t\t\t<span class=\"webix_scheduler_cal_marker\" style=\"background-color:${obj.color};\">\n\t\t\t\t\t\t\t</span></div>`;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\treturn ui;\n\t}\n\n\t/**\n\t * Returns the config of controls for selecting date and time\n\t * @param {string} type - \"start\" or \"end\"\n\t * @param {function*} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t * @param {Object} aSkin - stores sizes and colors of a currently active Webix skin\n\t */\n\tGetDateTime(type, _, aSkin) {\n\t\treturn {\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tview: \"label\",\n\t\t\t\t\theight: aSkin.labelTopHeight,\n\t\t\t\t\tlabel: type === \"start\" ? _(\"Start\") : _(\"End\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmargin: 8,\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\t\tname: `${type}_date`,\n\t\t\t\t\t\t\tsuggest: {\n\t\t\t\t\t\t\t\ttype: \"calendar\",\n\t\t\t\t\t\t\t\ticons: false,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\t\tlocalId: `${type}Time`,\n\t\t\t\t\t\t\tname: `${type}_time`,\n\t\t\t\t\t\t\ttype: \"time\",\n\t\t\t\t\t\t\tformat: \"%H:%i\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\t// general form tasks\n\n\t/**\n\t * Fills the form with relevant values for editing of a selected event or adding a new event\n\t * @param {Object} ev - the current state.selected\n\t */\n\tFillForm(ev) {\n\t\tthis.Form.focus();\n\n\t\tthis.Id = ev.id;\n\n\t\tthis.Form.focus();\n\t\tthis.Date = ev.date;\n\t\tif (typeof this.Date === \"string\") {\n\t\t\tthis.Date = new Date(this.Date.slice(0, this.Date.indexOf(\"_\")) * 1);\n\t\t}\n\n\t\tlet obj;\n\n\t\t// new record\n\t\tif (ev.id == \"0\") {\n\t\t\tobj = this.NewEvent();\n\t\t\tif (obj.then) {\n\t\t\t\treturn obj.then(res => {\n\t\t\t\t\tthis.Local.add({ id: ev.id, ...webix.copy(res) });\n\t\t\t\t\tthis.FillFormContinue(res);\n\t\t\t\t});\n\t\t\t} else this.Local.add({ id: ev.id, ...webix.copy(obj) });\n\t\t} else {\n\t\t\tobj = webix.copy(this.Local.getItem(ev.id));\n\n\t\t\tconst mode = this.getParam(\"mode\", true);\n\t\t\tif (mode) obj = this.AdaptObjToMode(mode, obj);\n\t\t}\n\n\t\tthis.FillFormContinue(obj);\n\t}\n\n\t/**\n\t * Fills the event object with relevant values according to the mode of editing\n\t * @param {string} mode - mode in which a recurring event will be edited (\"all\", \"next\", \"this\")\n\t * @param {Object} obj - event data\n\t */\n\tAdaptObjToMode(mode, obj) {\n\t\tmode = this.ChangeMode(\n\t\t\tmode,\n\t\t\tobj,\n\t\t\tobj.recurring\n\t\t\t\t? obj.start_date\n\t\t\t\t: this.Local.getItem(obj.origin_id).start_date,\n\t\t\tobj.recurring ? this.State.selected.date : obj.start_date\n\t\t);\n\t\tthis.setParam(\"mode\", mode, true);\n\n\t\tif (mode === \"all\" || mode === \"next\") {\n\t\t\tif (mode === \"all\" && obj.origin_id) {\n\t\t\t\tobj = webix.copy(this.Local.getItem(obj.origin_id));\n\t\t\t}\n\n\t\t\t// if this is a \"this\" sub-event\n\t\t\tif (!obj.$recurring)\n\t\t\t\tobj.$recurring = webix.copy(\n\t\t\t\t\tthis.Local.getItem(obj.origin_id).$recurring\n\t\t\t\t);\n\n\t\t\tif (obj.$recurring.COUNT || obj.$recurring.UNTIL) {\n\t\t\t\t// [FIXME] maybe need to store total UNTIL/COUNT on backend (mostly for dynamic loading)\n\t\t\t\tobj.$recurring = this.CorrectCountUntil(\n\t\t\t\t\tobj,\n\t\t\t\t\tmode,\n\t\t\t\t\tobj.start_date,\n\t\t\t\t\tthis.Local\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (mode === \"this\" || mode === \"next\") {\n\t\t\t// split event sequence or cut out an occurrence\n\t\t\tif (this.State.selected.date)\n\t\t\t\tobj = { ...obj, ...separateSequence(obj, this.State.selected.date) };\n\n\t\t\tif (mode === \"this\") {\n\t\t\t\tobj.$recurring = null;\n\t\t\t\tobj.recurring = \"\";\n\t\t\t\tthis.$$(\"repeatControls\").hide();\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Splits start and end dates into date and time parts and fills the form with values\n\t * @param {Object} obj - the event data\n\t */\n\tFillFormContinue(obj) {\n\t\tobj.start_time = webix.Date.copy(obj.start_date);\n\t\tobj.end_time = webix.Date.copy(obj.end_date);\n\n\t\tobj.start_date = webix.Date.datePart(obj.start_date);\n\t\tobj.end_date = webix.Date.datePart(obj.end_date);\n\n\t\tif (this.app.config.recurring) this.SetRecurring(obj);\n\n\t\tthis.Form.setValues(obj);\n\t}\n\n\t/**\n\t * Calculates constants related to the start date of an event\n\t * @param {Date} start - the start date of an event\n\t */\n\tGetFromStartDate(start) {\n\t\tconst res = {\n\t\t\tweekday: start.getDay(),\n\t\t\tday: start.getDate(),\n\t\t\tmonth: start.getMonth(),\n\t\t};\n\t\tres.weekNum = Math.floor(res.day / 7) + (res.day % 7 ? 1 : 0);\n\t\treturn res;\n\t}\n\n\t/**\n\t * Sets controls and their values for recurring patterns\n\t * @param {Object} obj - the event data\n\t */\n\tSetRecurring(obj) {\n\t\tconst today = this.GetFromStartDate(obj.start_date);\n\t\tconst roptions = this.ResetRecurringOptions(today);\n\t\tthis.RecurringOptions.getList().parse(roptions);\n\n\t\tthis.SubForm.SetValues(webix.copy(obj), today, true);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (!obj.$recurring) {\n\t\t\tobj.rec_option = _(\"none\");\n\t\t} else if (obj.$recurring.BYDAY === \"MO,TU,WE,TH,FR\") {\n\t\t\tobj.rec_option = \"work\";\n\t\t} else if (\n\t\t\t!obj.$recurring.UNTIL &&\n\t\t\t!obj.$recurring.COUNT &&\n\t\t\t(!obj.$recurring.INTERVAL || obj.$recurring.INTERVAL == 1) &&\n\t\t\t(obj.$recurring.FREQ === \"DAILY\" ||\n\t\t\t\t(obj.$recurring.FREQ === \"WEEKLY\" &&\n\t\t\t\t\tobj.$recurring.BYDAY == WEEKDAYS[today.weekday]) ||\n\t\t\t\t(obj.$recurring.FREQ === \"MONTHLY\" &&\n\t\t\t\t\tobj.$recurring.BYSETPOS &&\n\t\t\t\t\tobj.$recurring.BYSETPOS == today.weekNum &&\n\t\t\t\t\tobj.$recurring.BYDAY == WEEKDAYS[today.weekday]) ||\n\t\t\t\t(obj.$recurring.FREQ === \"YEARLY\" &&\n\t\t\t\t\tobj.$recurring.BYMONTH == today.month + 1 &&\n\t\t\t\t\tobj.$recurring.BYMONTHDAY == today.day))\n\t\t) {\n\t\t\tobj.rec_option = _(obj.$recurring.FREQ.toLowerCase());\n\t\t} else {\n\t\t\tobj.rec_option = _(\"custom\");\n\t\t}\n\t}\n\n\t/**\n\t * Returns date-dependent options for recurring pattern select list\n\t * @param {Date} start - the start date of an event\n\t */\n\tResetRecurringOptions(start) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: \"weekly\",\n\t\t\t\tvalue: `${_(\"weekly, every\")} ${\n\t\t\t\t\twebix.i18n.calendar.dayFull[start.weekday]\n\t\t\t\t}`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"monthly\",\n\t\t\t\tvalue: `${_(\"monthly, every\")} ${start.weekNum} ${_(\"week on\")} ${\n\t\t\t\t\twebix.i18n.calendar.dayFull[start.weekday]\n\t\t\t\t}`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"yearly\",\n\t\t\t\tvalue: `${_(\"yearly, every\")} ${\n\t\t\t\t\twebix.i18n.calendar.monthFull[start.month]\n\t\t\t\t} ${start.day}`,\n\t\t\t},\n\t\t];\n\t}\n\n\t/**\n\t * Joins date and time into one Date object\n\t * @param {Date} date - a date without a time part\n\t * @param {Date} time - a date with a time part\n\t */\n\tJoin(date, time) {\n\t\treturn webix.Date.add(date, webix.Date.timePart(time) / 60, \"minute\", true);\n\t}\n\n\t/**\n\t * Returns an object with values for adding a new event\n\t */\n\tNewEvent() {\n\t\tconst start = this.GetStartDate();\n\t\tconst end = webix.Date.add(start, 1, \"hour\", true);\n\n\t\tconst obj = {\n\t\t\tstart_date: start,\n\t\t\tend_date: end,\n\t\t\ttext: \"\",\n\t\t};\n\t\tif (this.app.config.recurring) obj.recurring = \"\";\n\t\tif (this.app.config.calendars) {\n\t\t\tlet active = this.State.active[0];\n\t\t\tif (!active) {\n\t\t\t\tconst first = this.Calendars.getFirstId();\n\t\t\t\tconst wait = first\n\t\t\t\t\t? this.Ops.updateCalendar(first, { active: 1 })\n\t\t\t\t\t: this.Ops.addCalendar();\n\n\t\t\t\treturn wait.then(() => {\n\t\t\t\t\tobj.calendar = this.State.active[0];\n\t\t\t\t\tobj.$color = this.Calendars.getItem(obj.calendar).color;\n\t\t\t\t\treturn obj;\n\t\t\t\t});\n\t\t\t}\n\t\t\tobj.calendar = active;\n\t\t\tobj.$color = this.Calendars.getItem(obj.calendar).color;\n\t\t} else obj.$color = \"#01C2A5\"; //same for default color in datacollection\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Returns a start date of a new object based on:\n\t * 1) the origin of the double click of the user\n\t * 2) the current date and time\n\t */\n\tGetStartDate() {\n\t\tif (this.Date) {\n\t\t\treturn webix.Date.copy(this.Date);\n\t\t} else {\n\t\t\tconst date = new Date();\n\t\t\tconst minutes = Math.ceil(date.getMinutes() / 30) * 30;\n\t\t\tconst res = webix.Date.copy(this.State.date);\n\t\t\tres.setHours(date.getHours(), minutes);\n\t\t\treturn res;\n\t\t}\n\t}\n\n\t/**\n\t * Launches saving of changes made in the form\n\t * @param {Object} change - an object with changed values\n\t * @param {any} prev - an old value\n\t */\n\tUpdateEvent(change, prev) {\n\t\t// some fields need preprocessing\n\t\tif (Object.keys(change).length)\n\t\t\tthis.PrepareChange(change, this.Form.getValues(), prev);\n\n\t\t// clear 'dirty' flag so that next change will definitely be 'dirty'\n\t\tthis.Form.setDirty();\n\n\t\tlet sid = this.Id;\n\t\tif (sid === \"0\") {\n\t\t\tthis._inProgress = this.Ops.addEvent(this.PrepareOut(change), sid);\n\t\t} else if (Object.keys(change).length) {\n\t\t\tlet mode = this.getParam(\"mode\", true);\n\t\t\tconst obj = this.Local.getItem(sid);\n\n\t\t\tif ((mode === \"this\" && !this.HasOneOccurrence(obj)) || mode === \"next\") {\n\t\t\t\t// cut out occurrence or split event sequence and save as separate events\n\t\t\t\tchange.origin_id = obj.origin_id || obj.id;\n\t\t\t\tconst newEvent = this.PrepareOut(change);\n\n\t\t\t\tlet recurring = \"\";\n\t\t\t\tif (mode === \"this\") {\n\t\t\t\t\trecurring = cutOccurrence(this.State.selected.date, obj);\n\t\t\t\t} else {\n\t\t\t\t\tlet params;\n\t\t\t\t\tif (obj.recurring) {\n\t\t\t\t\t\tparams = [this.State.selected.date, obj];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsid = obj.origin_id;\n\t\t\t\t\t\tparams = [newEvent.start_date, this.Local.getItem(sid)];\n\t\t\t\t\t}\n\t\t\t\t\trecurring = clipSequence(...params);\n\t\t\t\t}\n\n\t\t\t\tthis._inProgress = this.Ops.updateEvent(\n\t\t\t\t\tsid,\n\t\t\t\t\t{ recurring },\n\t\t\t\t\tmode,\n\t\t\t\t\twebix.Date.dayStart(newEvent.start_date)\n\t\t\t\t).then(() => {\n\t\t\t\t\tif (change.rec_option === \"none\") this.State.selected.date = null;\n\t\t\t\t\treturn this.Ops.addEvent(newEvent);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// non-recurring and recurring in mode \"all\"\n\n\t\t\t\tif (mode === \"all\") {\n\t\t\t\t\tconst recVals = this.Form.getValues().$recurring;\n\t\t\t\t\tif (recVals && webix.isUndefined(change.recurring)) {\n\t\t\t\t\t\tdelete recVals.EXDATE;\n\t\t\t\t\t\tchange.recurring = serialize(recVals); // plus all that's been updated in form silently in FillForm\n\n\t\t\t\t\t\t// [QUESTION] maybe change should become a local reactive state of form and passed to SubForm?\n\t\t\t\t\t\tthis.SetFormSilently({\n\t\t\t\t\t\t\t$recurring: recVals,\n\t\t\t\t\t\t\trecurring: change.recurring,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.SubForm.UpdateSilently({ EXDATE: null });\n\t\t\t\t\t}\n\n\t\t\t\t\tif (obj.origin_id) this.Id = this.State.selected.id = obj.origin_id;\n\t\t\t\t}\n\n\t\t\t\tthis._inProgress = this.Ops.updateEvent(this.Id, change, mode).then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tif (change.rec_option === \"none\") this.State.selected.date = null;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (this._inProgress) {\n\t\t\tthis.app.callEvent(\"backend:operation\", [this._inProgress]);\n\t\t\tthis._inProgress\n\t\t\t\t.then(id => {\n\t\t\t\t\tif (id) this.State.selected.id = this.Id = id;\n\t\t\t\t\tif (!id || change.recurring)\n\t\t\t\t\t\tthis.ChangeDate(change, this.Form.getValues(), prev);\n\n\t\t\t\t\t// continue editing in simple mode\n\t\t\t\t\tthis.setParam(\"mode\", \"\", true);\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis._inProgress = null;\n\t\t\t\t});\n\t\t}\n\n\t\treturn this._inProgress || webix.promise.resolve();\n\t}\n\n\t/**\n\t * Processes changes made in the form and prepares values for saving to the server\n\t * @param {Object} change - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t * @param {any} prev - an old value from the control where a value was changed\n\t */\n\tPrepareChange(change, fvals, prev) {\n\t\tif (change.rec_option) {\n\t\t\tif (change.rec_option === \"custom\") {\n\t\t\t\tif (fvals.$recurring) {\n\t\t\t\t\tthis.SubForm.SetValues(\n\t\t\t\t\t\t{ ...fvals, ...change },\n\t\t\t\t\t\tthis.GetFromStartDate(fvals.start_date)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tchange.$recurring = this.SubForm.GetValues();\n\n\t\t\t\tif (!fvals.$recurring) {\n\t\t\t\t\tthis.SetFormSilently({ $recurring: change.$recurring });\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.GetRecurring(change.rec_option, change, fvals);\n\t\t\t}\n\n\t\t\tdelete change.rec_option;\n\t\t}\n\n\t\t// $recurring change comes from subform or from above\n\t\tif (!webix.isUndefined(change.$recurring)) {\n\t\t\tif (change.$recurring) {\n\t\t\t\tconst recurring = serialize(change.$recurring);\n\t\t\t\tconst old = this.Local.getItem(fvals.id);\n\t\t\t\tif (!old || recurring !== old.recurring) {\n\t\t\t\t\tchange.recurring = recurring;\n\n\t\t\t\t\tconst [ns, es] = datesToRec(\n\t\t\t\t\t\tfvals.start_date,\n\t\t\t\t\t\tfvals.end_date,\n\t\t\t\t\t\tchange.$recurring\n\t\t\t\t\t);\n\t\t\t\t\tif (ns && es) {\n\t\t\t\t\t\t[change.start_date, change.end_date] = [ns, es];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.SetFormSilently(change);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdelete change.$recurring;\n\t\t}\n\n\t\tif (\n\t\t\tchange.start_date ||\n\t\t\tchange.end_date ||\n\t\t\tchange.start_time ||\n\t\t\tchange.end_time\n\t\t) {\n\t\t\tthis.SumupDateTime(change, fvals);\n\t\t} else if (change.all_day == 1) {\n\t\t\tchange.start_date = fvals.start_date;\n\t\t\tchange.end_date = fvals.end_date;\n\t\t} else if (change.all_day == 0) {\n\t\t\tchange.start_date = this.Join(fvals.start_date, fvals.start_time);\n\t\t\tchange.end_date = this.Join(fvals.end_date, fvals.end_time);\n\t\t}\n\n\t\tif (change.start_date || change.end_date) {\n\t\t\tthis.CorrectDateTime(change, fvals);\n\n\t\t\tif (change.start_time) delete change.start_time;\n\t\t\tif (change.end_time) delete change.end_time;\n\n\t\t\tthis.ApplyDatechangeToRecurring(change, fvals);\n\t\t}\n\n\t\tthis.ProcessText(change, \"text\", prev);\n\t\tthis.ProcessText(change, \"details\", prev);\n\t}\n\n\t/**\n\t *\n\t * @param {Object} change - an object with changed values\n\t * @param {string} field - the name of a text field ('text', 'details')\n\t * @param {string} prev - an old value from the control where a value was changed\n\t */\n\tProcessText(change, field, prev) {\n\t\tif (change[field]) {\n\t\t\tchange[field] = webix.template.escape(change[field].trim());\n\t\t\tif (!prev) prev = this.Local.getItem(this.State.selected.id)[field];\n\t\t\tif (change[field] === prev.trim()) delete change[field];\n\t\t}\n\t}\n\n\t/**\n\t * Changes recurring pattern if start date was changed and the pattern no longer fits it\n\t * @param {Object} change - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t */\n\tApplyDatechangeToRecurring(change, fvals) {\n\t\tif (this.app.config.recurring && change.start_date) {\n\t\t\tconst today = this.GetFromStartDate(change.start_date);\n\t\t\t// if date was changed after subform change, ignore\n\t\t\tif (!change.recurring) {\n\t\t\t\tif (fvals.rec_option === \"custom\") {\n\t\t\t\t\tconst recurring = fvals.$recurring;\n\n\t\t\t\t\tif (recurring.BYMONTH) {\n\t\t\t\t\t\trecurring.BYMONTH = today.month + 1;\n\t\t\t\t\t}\n\t\t\t\t\tif (recurring.BYMONTHDAY) {\n\t\t\t\t\t\trecurring.BYMONTHDAY = today.day;\n\t\t\t\t\t}\n\t\t\t\t\tif (recurring.BYSETPOS) {\n\t\t\t\t\t\trecurring.BYSETPOS = today.weekNum;\n\t\t\t\t\t}\n\t\t\t\t\tif (recurring.BYDAY) {\n\t\t\t\t\t\trecurring.BYDAY = recToDate(change.start_date, fvals.$recurring);\n\t\t\t\t\t}\n\t\t\t\t\tif (recurring.UNTIL && recurring.UNTIL < change.start_date) {\n\t\t\t\t\t\tconst oldStart = this.Local.getItem(this.State.selected.id)\n\t\t\t\t\t\t\t.start_date;\n\t\t\t\t\t\tconst length = (fvals.$recurring.UNTIL - oldStart) / 1000 / 60; // minutes\n\t\t\t\t\t\trecurring.UNTIL = webix.Date.add(\n\t\t\t\t\t\t\tchange.start_date,\n\t\t\t\t\t\t\tlength,\n\t\t\t\t\t\t\t\"minute\",\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tchange.recurring = serialize(recurring);\n\n\t\t\t\t\tthis.SubForm.SetValues({ ...fvals, ...change }, today);\n\t\t\t\t} else {\n\t\t\t\t\tthis.GetRecurring(fvals.rec_option, change, fvals);\n\t\t\t\t\tdelete change.$recurring;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.RecurringOptions.getList().parse(this.ResetRecurringOptions(today));\n\t\t\tthis.RecurringOptions.refresh();\n\t\t}\n\t}\n\n\t/**\n\t * Switches Scheduler to another date if the event after change is no longer visible\n\t * @param {Object} dirty - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t * @param {any} prev - an old value from the control where a value was changed\n\t */\n\tChangeDate(dirty, fvals, prev) {\n\t\t// start date of non-repeating event changed or repeating event became non-repeating\n\t\tif ((dirty.start_date && !fvals.$recurring) || dirty.recurring === \"\") {\n\t\t\tthis.UpdateStateDate(\n\t\t\t\twebix.Date.datePart(dirty.start_date || fvals.start_date, true)\n\t\t\t);\n\t\t} else if (dirty.start_date || dirty.recurring) {\n\t\t\t/* start date of repeating event or recurring pattern of a repeating event changed */\n\n\t\t\t// no need to change date if day was changed in BYDAY\n\t\t\t// and current day was not removed or if current occurrence is 1st in sequence\n\t\t\tif (\n\t\t\t\tdirty.recurring &&\n\t\t\t\t(((fvals.$recurring.FREQ === \"WEEKLY\" ||\n\t\t\t\t\tfvals.$recurring.FREQ === \"DAILY\") &&\n\t\t\t\t\t(!fvals.$recurring.INTERVAL || fvals.$recurring.INTERVAL == 1)) ||\n\t\t\t\t\t(this.Date &&\n\t\t\t\t\t\twebix.Date.equal(\n\t\t\t\t\t\t\tthis.Date,\n\t\t\t\t\t\t\tthis.Join(fvals.start_date, fvals.start_time)\n\t\t\t\t\t\t)))\n\t\t\t) {\n\t\t\t\tconst wday = (this.Date || fvals.start_date).getDay();\n\t\t\t\tif (\n\t\t\t\t\t!fvals.$recurring.BYDAY ||\n\t\t\t\t\tfvals.$recurring.BYDAY.split(\",\").includes(WEEKDAYS[wday])\n\t\t\t\t) {\n\t\t\t\t\tif (prev === \"none\") {\n\t\t\t\t\t\tthis.State.selected.date =\n\t\t\t\t\t\t\tthis.Join(fvals.start_date, fvals.start_time).valueOf() +\n\t\t\t\t\t\t\t\"_\" +\n\t\t\t\t\t\t\tthis.State.selected.id;\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst consts = {};\n\t\t\tfillWdays(fvals.$recurring, consts);\n\n\t\t\tlet date = webix.Date.copy(\n\t\t\t\tdirty.start_date || this.Join(fvals.start_date, fvals.start_time)\n\t\t\t);\n\t\t\tlet { end } = this.GetModeBounds();\n\t\t\twhile (date >= end) {\n\t\t\t\tend = webix.Date.add(end, 1, this.State.mode, true);\n\t\t\t}\n\n\t\t\tlet start;\n\t\t\tconst sdate = new Date(this.State.selected.date.split(\"_\")[0] * 1);\n\t\t\tif (fvals.$recurring.UNTIL && fvals.$recurring.UNTIL < end) {\n\t\t\t\tend = fvals.$recurring.UNTIL;\n\t\t\t}\n\t\t\twhile (date < end) {\n\t\t\t\tstart = webix.Date.copy(date);\n\t\t\t\tif (webix.Date.equal(start, sdate)) break;\n\t\t\t\tdate = next(date, fvals.$recurring, consts);\n\t\t\t}\n\n\t\t\tthis.State.selected.date = start.valueOf() + \"_\" + this.State.selected.id;\n\n\t\t\tthis.UpdateStateDate(start);\n\t\t}\n\t}\n\n\t/**\n\t * Updates state.date according to state.mode\n\t * @param {Date} date - new state.date\n\t */\n\tUpdateStateDate(date) {\n\t\tconst state = this.State;\n\t\tif (state.mode === \"day\") {\n\t\t\tconst sdate = webix.Date.datePart(state.date, true);\n\t\t\tif (!webix.Date.equal(date, sdate)) {\n\t\t\t\tstate.date = webix.Date.dayStart(date);\n\t\t\t}\n\t\t} else if (state.mode === \"week\" || state.mode === \"month\") {\n\t\t\tconst { start, end } = this.GetModeBounds();\n\t\t\tif (date < start || date >= end) {\n\t\t\t\tstate.date = webix.Date.dayStart(date);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns start and end dates of a currently displayed period\n\t */\n\tGetModeBounds() {\n\t\tconst state = this.State;\n\t\tconst start = webix.Date[state.mode + \"Start\"](state.date);\n\t\tconst end = webix.Date.add(start, 1, state.mode, true);\n\t\treturn { start, end };\n\t}\n\n\t/**\n\t * Assigns recurring pattern according to a preset\n\t * @param {string} r the ID of a recurring pattern option\n\t * @param {Object} change - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t */\n\tGetRecurring(r, change, fvals) {\n\t\tconst weekday = WEEKDAYS[fvals.start_date.getDay()];\n\t\tconst day = fvals.start_date.getDate();\n\n\t\tlet rObj = null;\n\t\tswitch (r) {\n\t\t\tcase \"daily\":\n\t\t\t\trObj = { FREQ: \"DAILY\", INTERVAL: 1 };\n\t\t\t\tbreak;\n\t\t\tcase \"weekly\":\n\t\t\t\trObj = {\n\t\t\t\t\tFREQ: \"WEEKLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYDAY: weekday,\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase \"work\":\n\t\t\t\trObj = {\n\t\t\t\t\tFREQ: \"WEEKLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYDAY: \"MO,TU,WE,TH,FR\",\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase \"monthly\":\n\t\t\t\trObj = {\n\t\t\t\t\tFREQ: \"MONTHLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYSETPOS: Math.floor(day / 7) + (day % 7 ? 1 : 0),\n\t\t\t\t\tBYDAY: weekday,\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase \"yearly\":\n\t\t\t\trObj = {\n\t\t\t\t\tFREQ: \"YEARLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYMONTH: fvals.start_date.getMonth() + 1,\n\t\t\t\t\tBYMONTHDAY: day,\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (r === \"work\" && change.start_date) {\n\t\t\tconst BYDAY = recToDate(change.start_date, rObj);\n\t\t\tif (rObj.BYDAY !== BYDAY) {\n\t\t\t\trObj.BYDAY = BYDAY;\n\t\t\t\tr = \"custom\";\n\t\t\t}\n\t\t}\n\n\t\tconst recurring = rObj ? serialize(rObj) : \"\";\n\t\tconst old = this.Local.getItem(fvals.id);\n\t\tif (!old || recurring !== old.recurring) {\n\t\t\tchange.$recurring = rObj;\n\t\t\tchange.recurring = recurring;\n\t\t\tthis.SetFormSilently({\n\t\t\t\t$recurring: change.$recurring,\n\t\t\t\trecurring,\n\t\t\t\trec_option: r,\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Unites changed and unchanged fields into 1 object for saving newly added events\n\t * @param {Object} change - an object with changed values\n\t */\n\tPrepareOut(change) {\n\t\tlet obj = this.Form.getValues();\n\n\t\tif (!obj.all_day) {\n\t\t\tobj.start_date = this.Join(obj.start_date, obj.start_time);\n\t\t\tobj.end_date = this.Join(obj.end_date, obj.end_time);\n\t\t}\n\n\t\tobj = webix.extend(obj, change || {}, true);\n\n\t\tif (!(change && change.recurring) && obj.$recurring) {\n\t\t\tobj.$recurring.EXDATE = [];\n\t\t\tobj.recurring = serialize(obj.$recurring);\n\t\t}\n\n\t\tconst res = {\n\t\t\torigin_id: obj.origin_id || 0,\n\t\t\ttext: webix.template.escape(obj.text),\n\t\t\tstart_date: obj.start_date,\n\t\t\tend_date: obj.end_date,\n\t\t\tall_day: obj.all_day,\n\t\t\tcalendar: obj.calendar,\n\t\t\tcolor: obj.color,\n\t\t\tdetails: webix.template.escape(obj.details),\n\t\t\trecurring: obj.recurring,\n\t\t};\n\n\t\treturn res;\n\t}\n\n\t/**\n\t * Applies change in one of the date-time fields to all of them\n\t * @param {Object} change - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t */\n\tSumupDateTime(change, fvals) {\n\t\tconst type = change.start_date || change.start_time ? \"start\" : \"end\";\n\t\tconst dateField = type + \"_date\";\n\t\tconst timeField = type + \"_time\";\n\n\t\tchange[dateField] = this.Join(\n\t\t\tchange[dateField] || fvals[dateField],\n\t\t\tchange[timeField] || fvals[timeField]\n\t\t);\n\t}\n\n\t/**\n\t * Corrects the unchanged field if start > end or end < start\n\t * @param {Object} change - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t */\n\tCorrectDateTime(change, fvals) {\n\t\tconst old = this.Local.getItem(this.State.selected.id);\n\t\tconst ev_length = (old.end_date - old.start_date) / 1000 / 60; // minutes\n\n\t\tconst type = change.start_date ? \"start\" : \"end\";\n\t\tconst opposite = type === \"start\" ? \"end\" : \"start\";\n\n\t\tif (\n\t\t\t(change.start_date >= old.end_date && !fvals.all_day) ||\n\t\t\tchange.start_date > old.end_date ||\n\t\t\t(old.start_date >= change.end_date && !fvals.all_day) ||\n\t\t\told.start_date > change.end_date\n\t\t) {\n\t\t\tchange[opposite + \"_date\"] = webix.Date.add(\n\t\t\t\tchange[type + \"_date\"],\n\t\t\t\t(type === \"start\" ? 1 : -1) * (ev_length || 60),\n\t\t\t\t\"minute\",\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\t// apply also to form\n\t\t\tthis.SetFormSilently({\n\t\t\t\tstart_date: webix.Date.datePart(change.start_date, true),\n\t\t\t\tend_date: webix.Date.datePart(change.end_date, true),\n\t\t\t\tstart_time: change.start_time || webix.Date.copy(change.start_date),\n\t\t\t\tend_time: change.end_time || webix.Date.copy(change.end_date),\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Applies changes in values made by code to form\n\t * @param {Object} change - an object with changed values\n\t */\n\tSetFormSilently(change) {\n\t\tthis.Form.blockEvent();\n\t\tthis.Form.setValues(change, true);\n\t\tthis.Form.unblockEvent();\n\t}\n\n\t/**\n\t * Removes a temporary local event\n\t */\n\tClearTempEvent() {\n\t\tconst sid = this.Id;\n\t\tif (sid === \"0\" && this.Local.exists(sid)) {\n\t\t\tthis.Local.remove(sid);\n\t\t}\n\t}\n\n\t/**\n\t * Closes the form and either the whole right panel with it or returns to Info\n\t * @param {boolean} close - if true, the right panel is closed\n\t */\n\tBack(close) {\n\t\tthis.Form.clear();\n\n\t\tif (close || this.State.selected.id === \"0\") {\n\t\t\tthis.State.selected = null;\n\t\t} else {\n\t\t\tconst path = this.Compact ? \"event.formpopup/\" : \"../\";\n\t\t\tthis.show(path + \"event.info\", { target: \"edit\" });\n\t\t}\n\t}\n\n\t/**\n\t * Closes the right panel\n\t */\n\tClose() {\n\t\tif (this._inProgress) {\n\t\t\tthis._inProgress.then(() => {\n\t\t\t\tthis.Back(true);\n\t\t\t});\n\t\t} else {\n\t\t\tconst dirty =\n\t\t\t\tthis.Form.isDirty() || (this.Subform && this.SubForm.IsDirty());\n\t\t\tif (this.Compact && dirty) {\n\t\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\t\twebix\n\t\t\t\t\t.confirm({\n\t\t\t\t\t\ttext: _(\"Save changes?\"),\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => this.Done(true))\n\t\t\t\t\t.catch(() => this.Back(true));\n\t\t\t} else this.Back(true);\n\t\t}\n\t}\n\n\t/**\n\t * Closes the form\n\t * @param {boolean} close\n\t */\n\tDone(close) {\n\t\tif (this._inProgress) {\n\t\t\tthis._inProgress.then(() => {\n\t\t\t\tthis.Back();\n\t\t\t});\n\t\t} else if (this.State.selected.id === \"0\" || this.Compact) {\n\t\t\tlet change = {};\n\t\t\tif (this.Compact) {\n\t\t\t\tchange = this.Form.getDirtyValues();\n\t\t\t\tif (this.SubForm.IsDirty()) {\n\t\t\t\t\tchange.$recurring = this.SubForm.GetValues();\n\t\t\t\t\tdelete change.rec_option;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.UpdateEvent(change).then(() => this.Back(close));\n\t\t} else {\n\t\t\tthis.Back();\n\t\t}\n\t}\n\n\t/**\n\t * Waits until some asynchronous operation finishes (if there's any) and then executes 'handler'\n\t * @param {function} handler - the code that will be executed\n\t */\n\tWait(handler) {\n\t\tif (this._inProgress) {\n\t\t\tthis._inProgress.then(handler);\n\t\t} else {\n\t\t\thandler.call();\n\t\t}\n\t}\n\n\t// compact\n\n\t/**\n\t * Shows a subform with controls for editing recurring pattern in a window\n\t */\n\tShowSubForm() {\n\t\tthis.SubForm.Show();\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst subform = this.SubForm.getRoot();\n\n\t\tconst aSkin = webix.skin.$active;\n\t\twebix.fullscreen.set(subform, {\n\t\t\thead: {\n\t\t\t\tview: \"toolbar\",\n\t\t\t\tpadding: {\n\t\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\t\tright: 14,\n\t\t\t\t},\n\t\t\t\telements: [\n\t\t\t\t\t{ view: \"icon\", icon: \"shi-back\", click: () => this.HideSubPop() },\n\t\t\t\t\t{ view: \"label\", label: _(\"Change recurring pattern\") },\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\tvalue: _(\"Done\"),\n\t\t\t\t\t\twidth: 130,\n\t\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\t\tclick: () => this.HideSubPop(),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t});\n\n\t\tconst win = subform.getTopParentView();\n\t\twin.define({ css: \"webix_scheduler_subform_popup\" });\n\t}\n\n\t/**\n\t * Hides the window with the subform\n\t */\n\tHideSubPop() {\n\t\tthis.SubForm.Hide();\n\t\twebix.fullscreen.exit();\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class FormPopup extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"window\",\n\t\t\tfullscreen: true,\n\t\t\thead: false,\n\t\t\tbody: { $subview: true },\n\t\t};\n\t}\n}\n","/* eslint-disable indent */\nimport { JetView } from \"webix-jet\";\nimport { FREQUENCE, WEEKDAYS, separateSequence } from \"../../helpers/recurring\";\n\nimport EventActionMenu from \"./actionmenu\";\n\nexport default class EventView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst bar = {\n\t\t\tview: \"toolbar\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: 14,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => this.Back(),\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\twidth: 130,\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tlocalId: \"edit\",\n\t\t\t\t\tlabel: _(\"Edit\"),\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tclick: function() {\n\t\t\t\t\t\tthis.$scope.StartAction(\"Edit\", this.$view);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst info = {\n\t\t\tlocalId: \"text\",\n\t\t\tview: \"template\",\n\t\t\tcss: \"webix_scheduler_info\",\n\t\t\ttemplate: obj => (obj.start_date ? this.InfoTemplate(obj) : \"\"),\n\t\t\tborderless: true,\n\t\t};\n\n\t\tconst deleteButton = {\n\t\t\tview: \"button\",\n\t\t\tlocalId: \"remove\",\n\t\t\tlabel: _(\"Delete event\"),\n\t\t\tcss: \"webix_danger webix_scheduler_danger\",\n\t\t\talign: \"center\",\n\t\t\tinputWidth: 330,\n\t\t\tclick: function() {\n\t\t\t\tthis.$scope.StartAction(\"Delete\", this.$view);\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tview: \"proxy\", // for borders\n\t\t\tbody: {\n\t\t\t\tmargin: 0,\n\t\t\t\trows: [\n\t\t\t\t\tbar,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: \"form\",\n\t\t\t\t\t\tpadding: { right: 14 + 2 },\n\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\trows: [info, deleteButton],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\n\t\tthis.on(this.State.$changes, \"readonly\", v => {\n\t\t\tconst action = v ? \"hide\" : \"show\";\n\t\t\tthis.$$(\"edit\")[action]();\n\t\t\tthis.$$(\"remove\")[action]();\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"selected\", v => {\n\t\t\tif (v) {\n\t\t\t\tthis.EventObj = this.app\n\t\t\t\t\t.getService(\"local\")\n\t\t\t\t\t.events(true)\n\t\t\t\t\t.getItem(v.id);\n\t\t\t\tthis.$$(\"text\").setValues(this.EventObj);\n\t\t\t}\n\t\t});\n\n\t\tthis.Menu = this.ui(EventActionMenu);\n\t}\n\n\tStartAction(mode, node) {\n\t\tif (\n\t\t\tthis.app.config.recurring &&\n\t\t\t(typeof this.State.selected.date === \"string\" || this.EventObj.origin_id)\n\t\t) {\n\t\t\tthis._waitMenu = webix.promise.defer();\n\t\t\tthis._waitMenu\n\t\t\t\t.then(o =>\n\t\t\t\t\tmode === \"Delete\" ? this.DeleteEvent(o) : this.EditEvent(o)\n\t\t\t\t)\n\t\t\t\t.finally(() => (this._waitMenu = null));\n\t\t\tthis.Menu.Show(node, this._waitMenu);\n\t\t} else {\n\t\t\tif (mode === \"Delete\") this.DeleteEvent();\n\t\t\telse this.EditEvent();\n\t\t}\n\t}\n\n\tEditEvent(o) {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst path = compact ? \"event.formpopup/\" : \"../\";\n\t\tthis.show(path + \"event.form\", { target: \"edit\", params: { mode: o } });\n\t}\n\n\tDeleteEvent(mode) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\ttitle: _(\"Delete event\"),\n\t\t\t\ttext: _(\"The event will be deleted permanently, are you sure?\"),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tconst obj = this.EventObj;\n\t\t\t\tlet sdate = \"\";\n\t\t\t\tif (mode && mode !== \"all\") {\n\t\t\t\t\tif (this.State.selected) sdate = this.State.selected.date;\n\t\t\t\t\telse if (obj.$id) sdate = obj.id;\n\t\t\t\t}\n\t\t\t\tthis.app\n\t\t\t\t\t.getService(\"operations\")\n\t\t\t\t\t.removeEvent(mode, this.EventObj, sdate);\n\t\t\t\tthis.Back();\n\t\t\t});\n\t}\n\n\tBack() {\n\t\tthis.State.selected = null;\n\t}\n\n\tInfoTemplate(obj) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (this.app.config.recurring && this.State.selected.date) {\n\t\t\tobj = { ...obj, ...separateSequence(obj, this.State.selected.date) };\n\t\t}\n\t\tconst [start, end] = [obj.start_date, obj.end_date];\n\n\t\tconst oneday = webix.Date.equal(\n\t\t\twebix.Date.datePart(start, true),\n\t\t\twebix.Date.datePart(end, true)\n\t\t);\n\n\t\tconst allday =\n\t\t\twebix.Date.equal(webix.Date.datePart(start, true), start) &&\n\t\t\twebix.Date.equal(webix.Date.datePart(end, true), end) &&\n\t\t\tobj.all_day;\n\n\t\tconst time = webix.i18n.timeFormatStr;\n\t\tconst date = webix.i18n.longDateFormatStr;\n\n\t\tconst title = `<div class=\"webix_scheduler_event_title\">${obj.text ||\n\t\t\t_(\"(No title)\")}</div>`;\n\n\t\tconst startDate = date(start);\n\t\tconst endDate = date(end);\n\t\tconst startTime = `${time(start)}`;\n\t\tconst endTime = `${time(end)}`;\n\n\t\tlet fromTo = \"\";\n\t\tif (oneday) {\n\t\t\tfromTo = `<div class=\"webix_scheduler_event_text\">${startDate}</div><div class=\"webix_scheduler_event_text\">${_(\n\t\t\t\t\"from\"\n\t\t\t)} ${startTime} ${_(\"to\")} ${endTime}</div>`;\n\t\t} else {\n\t\t\tfromTo = `<div class=\"webix_scheduler_event_text\">${_(\"from\")} ${\n\t\t\t\t!allday ? startTime : \"\"\n\t\t\t} ${startDate}</div><div class=\"webix_scheduler_event_text\">${_(\"to\")} ${\n\t\t\t\t!allday ? endTime : \"\"\n\t\t\t} ${endDate}</div>`;\n\t\t}\n\n\t\tlet recurring = \"\";\n\t\tif (obj.recurring) {\n\t\t\tconst interval =\n\t\t\t\tobj.$recurring.INTERVAL && obj.$recurring.INTERVAL > 1\n\t\t\t\t\t? obj.$recurring.INTERVAL\n\t\t\t\t\t: \"\";\n\t\t\tconst pattern =\n\t\t\t\t(obj.$recurring.BYDAY\n\t\t\t\t\t? ` ${_(\"on\")} ${obj.$recurring.BYDAY.split(\",\")\n\t\t\t\t\t\t\t.map(d => webix.i18n.calendar.dayFull[WEEKDAYS.indexOf(d)])\n\t\t\t\t\t\t\t.join(\", \")}`\n\t\t\t\t\t: \"\") +\n\t\t\t\t(obj.$recurring.BYMONTHDAY ? ` ${_(\"on\")} ` : \"\") +\n\t\t\t\t(obj.$recurring.BYMONTH\n\t\t\t\t\t? ` ${webix.i18n.calendar.monthFull[obj.$recurring.BYMONTH - 1]}`\n\t\t\t\t\t: \"\") +\n\t\t\t\t(obj.$recurring.BYMONTHDAY ? ` ${obj.$recurring.BYMONTHDAY}` : \"\");\n\n\t\t\trecurring = `${_(\"Repeats each\")} ${interval} ${_(\n\t\t\t\tFREQUENCE[obj.$recurring.FREQ] + (interval ? \"s\" : \"\")\n\t\t\t)} ${pattern}${\n\t\t\t\tobj.$recurring.COUNT\n\t\t\t\t\t? `, ${obj.$recurring.COUNT} ${_(\"times\")}`\n\t\t\t\t\t: obj.$recurring.UNTIL\n\t\t\t\t\t? ` ${_(\"till\")} ${date(obj.$recurring.UNTIL)}`\n\t\t\t\t\t: \"\"\n\t\t\t}`;\n\t\t}\n\n\t\tlet details = \"\";\n\t\tif (obj.details)\n\t\t\tdetails = `<div class=\"webix_scheduler_event_details_title\">${_(\n\t\t\t\t\"Notes\"\n\t\t\t)}</div>\n\t\t\t\t<div class=\"webix_scheduler_event_text\">${obj.details.replace(\n\t\t\t\t\t/(?:\\r\\n|\\r|\\n)/g,\n\t\t\t\t\t\"<br>\"\n\t\t\t\t)}</div>`;\n\n\t\treturn `${title}\n\t\t\t<div class='webix_scheduler_event_from_to'>${fromTo}</div>\n\t\t\t<div class='webix_scheduler_event_recurring_pattern'>${recurring}</div>${details}`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class EventActionPopup extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst buttons = {\n\t\t\tmargin: webix.skin.$active.layoutMargin.form,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tvalue: _(\"Cancel\"),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => this.Cancel(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tvalue: _(\"Apply\"),\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\thotkey: \"enter\",\n\t\t\t\t\tclick: () => this.Done(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn {\n\t\t\tview: \"window\",\n\t\t\tmodal: true,\n\t\t\thead: _(\"Edit recurring event\"),\n\t\t\tposition: \"center\",\n\t\t\tautoheight: true,\n\t\t\tcss: \"webix_scheduler_action_popup\",\n\t\t\tbody: {\n\t\t\t\ttype: \"form\",\n\t\t\t\tpadding: { top: 0 },\n\t\t\t\twidth: 340,\n\t\t\t\trows: [\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"radio\",\n\t\t\t\t\t\tlocalId: \"option\",\n\t\t\t\t\t\tvertical: true,\n\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t{ id: \"this\", value: _(\"This event\") },\n\t\t\t\t\t\t\t{ id: \"next\", value: _(\"This event and the following\") },\n\t\t\t\t\t\t\t{ id: \"all\", value: _(\"All events\") },\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tbuttons,\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => (this.Result = null),\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.Root = view;\n\t}\n\n\tShow(promise) {\n\t\tthis.Result = promise;\n\t\tthis.$$(\"option\").setValue(\"this\");\n\t\tthis.Root.show();\n\t}\n\n\tDone() {\n\t\tconst id = this.$$(\"option\").getValue();\n\t\tif (this.Result) this.Result.resolve(id);\n\t\tthis.Root.hide();\n\t}\n\n\tCancel() {\n\t\tif (this.Result) this.Result.reject();\n\t\tthis.Root.hide();\n\t}\n}\n","webix.protoUI(\n\t{\n\t\tname: \"r-layout\",\n\t\tsizeTrigger(width, handler, value) {\n\t\t\tthis._compactValue = value;\n\t\t\tthis._compactWidth = width;\n\t\t\tthis._compactHandler = handler;\n\n\t\t\tthis._checkTrigger(this.$view.width, value);\n\t\t},\n\t\t_checkTrigger(x, value) {\n\t\t\tif (this._compactWidth) {\n\t\t\t\tif (\n\t\t\t\t\t(x <= this._compactWidth && !value) ||\n\t\t\t\t\t(x > this._compactWidth && value)\n\t\t\t\t) {\n\t\t\t\t\tthis._compactWidth = null;\n\t\t\t\t\tthis._compactHandler(!value);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t$setSize(x, y) {\n\t\t\tif (this._checkTrigger(x, this._compactValue))\n\t\t\t\treturn webix.ui.layout.prototype.$setSize.call(this, x, y);\n\t\t},\n\t},\n\twebix.ui.layout\n);\n","import { JetView } from \"webix-jet\";\nimport topbar from \"views/bars\";\nimport add from \"views/bars/add\";\nimport side from \"./side\";\n\nimport EventActionPopup from \"./modes/common/actionpopup\";\n\nimport \"../helpers/responsive\";\n\nexport default class MainView extends JetView {\n\tconfig() {\n\t\tthis.fCompact = this.getParam(\"forceCompact\");\n\t\tif (!webix.isUndefined(this.fCompact))\n\t\t\tthis.setParam(\"compact\", this.fCompact);\n\t\tthis.Compact = this.getParam(\"compact\");\n\t\tthis.Calendars = !this.Compact && this.app.config.calendars;\n\n\t\tconst rows = [\n\t\t\ttopbar,\n\t\t\t{\n\t\t\t\tview: webix.isUndefined(this.fCompact) ? \"r-layout\" : \"layout\",\n\t\t\t\tlocalId: \"main\",\n\t\t\t\tcols: [{ $subview: true }],\n\t\t\t},\n\t\t];\n\n\t\tif (this.Compact) {\n\t\t\trows.push({\n\t\t\t\t$subview: true,\n\t\t\t\tname: \"edit\",\n\t\t\t\tpopup: true,\n\t\t\t});\n\t\t} else {\n\t\t\trows[1].cols.push({\n\t\t\t\tview: \"proxy\",\n\t\t\t\twidth: 400,\n\t\t\t\tlocalId: \"edit\",\n\t\t\t\tcss: \"webix_shadow_medium\",\n\t\t\t\tborderless: true,\n\t\t\t\thidden: true,\n\t\t\t\tbody: { $subview: true, name: \"edit\" },\n\t\t\t});\n\t\t}\n\n\t\tif (this.Calendars)\n\t\t\trows[1].cols.unshift({\n\t\t\t\tview: \"proxy\",\n\t\t\t\tlocalId: \"side\",\n\t\t\t\tborderless: true,\n\t\t\t\tbody: side,\n\t\t\t\thidden: true,\n\t\t\t});\n\n\t\tconst config = {\n\t\t\tcss: \"webix_scheduler\",\n\t\t\tview: \"abslayout\",\n\t\t\tcells: [\n\t\t\t\t{\n\t\t\t\t\trelative: true,\n\t\t\t\t\tmargin: 0,\n\t\t\t\t\trows: rows,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tcss: \"webix_scheduler_absbutton\",\n\t\t\t\t\tbody: add,\n\t\t\t\t\tlocalId: \"add\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tright: 20,\n\t\t\t\t\tbottom: 20,\n\t\t\t\t\thidden: !this.Compact,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn config;\n\t}\n\n\tinit(view) {\n\t\tif (!this.fCompact)\n\t\t\tthis.$$(\"main\").sizeTrigger(\n\t\t\t\tthis.app.config.compactWidth,\n\t\t\t\tmode => this.SetCompactMode(mode),\n\t\t\t\t!!this.Compact\n\t\t\t);\n\n\t\twebix.extend(view, webix.ProgressBar);\n\t\tthis.on(this.app, \"backend:operation\", res => {\n\t\t\tview.showProgress({ type: \"top\", delay: 2000 });\n\t\t\tres.finally(() => {\n\t\t\t\tview.hideProgress();\n\t\t\t});\n\t\t});\n\n\t\tif (this.Calendars) this.$$(\"side\").show();\n\n\t\tconst state = this.app.getState();\n\t\tthis.on(state.$changes, \"mode\", value => {\n\t\t\tthis.show(`./modes.${value}`);\n\t\t});\n\t\tthis.on(state.$changes, \"readonly\", value => {\n\t\t\tthis.ToggleAdd(value);\n\t\t});\n\n\t\tthis.on(state.$changes, \"selected\", (v, o) => this.ToggleEvent(v, o));\n\t\tthis.on(this.app, \"show:panel\", () => this.ToggleSidePanel());\n\n\t\tthis.app._dndActionPopup = this.ui(EventActionPopup);\n\t}\n\n\tToggleEvent(ev, old) {\n\t\tif (ev) {\n\t\t\tthis.ShowEvent(ev, old);\n\t\t} else if (old) {\n\t\t\tthis.HideEvent();\n\t\t}\n\t}\n\n\tShowEvent(ev, old) {\n\t\tconst sameEvent = old && old.id == ev.id;\n\t\tconst edit = this.getSubView(\"edit\");\n\t\tconst path =\n\t\t\tedit && sameEvent\n\t\t\t\t? edit.getUrl()[0].page\n\t\t\t\t: `event.${ev.id === \"0\" ? \"form\" : \"info\"}`;\n\n\t\tif (this.Compact) {\n\t\t\tthis.show(`event.formpopup/${path}`, {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t} else {\n\t\t\tthis.ToggleSidePanel(\"hide\");\n\t\t\tthis.$$(\"edit\").show();\n\t\t\tthis.show(path, {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t}\n\t}\n\n\tHideEvent() {\n\t\t// we need to destroy the view inside first\n\t\tthis.show(\"_blank\", { target: \"edit\" });\n\n\t\tif (!this.Compact) {\n\t\t\tthis.$$(\"edit\").hide();\n\t\t\tthis.ToggleSidePanel(\"show\");\n\t\t}\n\t}\n\n\tSetCompactMode(mode) {\n\t\t//let it render, then recreate\n\t\twebix.delay(() => {\n\t\t\tthis.setParam(\"compact\", mode);\n\t\t\tif (!mode) webix.fullscreen.exit();\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\tToggleSidePanel(state) {\n\t\tconst side = this.$$(\"side\");\n\t\tif (side) {\n\t\t\tif (state !== \"show\" && side.isVisible()) {\n\t\t\t\tthis._sidePanel = state === \"hide\";\n\t\t\t\tside.hide();\n\t\t\t} else if (!state || (this._sidePanel && state !== \"hide\")) {\n\t\t\t\tside.show();\n\t\t\t\tthis._sidePanel = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tToggleAdd(value) {\n\t\tconst add = this.$$(\"add\");\n\t\tif (value) add.hide();\n\t\telse if (this.Compact) add.show();\n\t}\n}\n","export function marker(obj) {\n\treturn `<div class=\"webix_event_marker\"><div class=\"webix_event_marker_inner\" style=\"background-color:${obj.color ||\n\t\tobj.$color};\"></div></div>`;\n}\n\nexport function events(_) {\n\treturn function(obj, common) {\n\t\treturn `<div class=\"webix_event_overall\"><div class=\"webix_event_time\">${common.timeStart(\n\t\t\tobj\n\t\t)}</div>${marker(obj, common)}<div class=\"webix_event_text\">${obj.text ||\n\t\t\t_(\"(No title)\")}</div></div>`;\n\t};\n}\n\nexport function dayEventColor(obj) {\n\treturn `border-color:${obj.$color}; background-color:${obj.color ||\n\t\tobj.$color}; color:${obj.$textColor};`;\n}\n\nexport function timeStart(start, end) {\n\treturn `<div class=\"start\">${webix.i18n.timeFormatStr(\n\t\tstart\n\t)}</div><div class=\"end\">${webix.i18n.timeFormatStr(end)}</div>`;\n}\n\nfunction fill(obj, common, size) {\n\tconst v = common.master;\n\treturn (\n\t\tv[\"$\" + size] -\n\t\t(v.config[size == \"width\" ? \"xCount\" : \"yCount\"] - 1) * common[size]\n\t);\n}\n\nexport function templateStart(obj, common, marks) {\n\tlet { width, height } = common;\n\tif (obj.right) width = fill(obj, common, \"width\");\n\tif (obj.bottom) height = fill(obj, common, \"height\");\n\treturn (\n\t\t\"<div \" +\n\t\t/*@attr*/ \"webix_l_id\" +\n\t\t`=\"${obj.id}\" class=\"${common.classname(obj, common, marks)}\" ${common.aria(\n\t\t\tobj,\n\t\t\tcommon,\n\t\t\tmarks\n\t\t)} style=\"width:${width}px; height:${height}px; float:left; overflow:hidden;\">`\n\t);\n}\n","export function shrinkTo(start, end) {\n\treturn ev => {\n\t\tconst before = ev.start_date <= start;\n\t\tconst after = ev.end_date >= end;\n\n\t\tif (before || after) {\n\t\t\tconst t = webix.copy(ev);\n\t\t\tif (before) t.start_date = start;\n\t\t\tif (after) t.end_date = end;\n\t\t\treturn t;\n\t\t}\n\n\t\treturn ev;\n\t};\n}\n\nexport function isToday(date) {\n\treturn webix.Date.equal(\n\t\twebix.Date.datePart(date),\n\t\twebix.Date.datePart(new Date())\n\t);\n}\n\nexport function isMultiDay(ev) {\n\treturn (\n\t\tev.all_day ||\n\t\t(ev.start_date.getDate() != ev.end_date.getDate() &&\n\t\t\tev.end_date - ev.start_date >= 1000 * 60 * 60 * 24 * 1)\n\t);\n}\n\nexport function daysBetweenInclusive(start, end) {\n\tconst millisecondsPerDay = 24 * 60 * 60 * 1000;\n\treturn Math.round(\n\t\t(webix.Date.dayStart(end) - webix.Date.dayStart(start)) / millisecondsPerDay\n\t);\n}\n","import { JetView } from \"webix-jet\";\nimport { events, timeStart } from \"helpers/templates\";\nimport { isMultiDay } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class UnitListView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"unitlist\",\n\t\t\tlocalId: \"list\",\n\t\t\tuniteBy: () => \"custom\",\n\t\t\ttype: {\n\t\t\t\ttemplate: events(_),\n\t\t\t\ttemplateHeader: obj => this.TemplateHeader(obj),\n\t\t\t\ttimeStart: obj => this.TimeStart(obj),\n\t\t\t\theight: 50,\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonUnits: () => this.SetUnits(),\n\t\t\t\tonItemClick: (id, node) => this.ShowEvent(id, node),\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.List = this.$$(\"list\");\n\t\twebix.extend(this.List, webix.OverlayBox);\n\t}\n\n\tShowEvent(id, node) {\n\t\tconst obj = this.List.getItem(id);\n\t\tconst sel = getParams(obj);\n\t\tsel.node = node;\n\t\tthis.State.selected = sel;\n\t}\n\n\tToggleOverlay() {\n\t\tif (!this.List.count()) {\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.List.showOverlay(_(\"No Events\"));\n\t\t} else {\n\t\t\tthis.List.hideOverlay();\n\t\t}\n\t}\n\n\tSetUnits() {\n\t\tlet units = this.List.units;\n\t\tconst data = this.data.all;\n\n\t\t// ignore clearAll\n\t\tif (Object.keys(units).length) {\n\t\t\tthis.List.units = {};\n\t\t\tlet start = this.data.start;\n\t\t\tconst end = this.data.end;\n\n\t\t\twhile (start < end) {\n\t\t\t\tconst next = webix.Date.add(start, 1, \"day\", true);\n\n\t\t\t\tlet result = data\n\t\t\t\t\t.filter(\n\t\t\t\t\t\td =>\n\t\t\t\t\t\t\td.start_date < next &&\n\t\t\t\t\t\t\t(d.end_date > start || (d.end_date >= start && d.all_day))\n\t\t\t\t\t)\n\t\t\t\t\t.map(ev => ev.id);\n\t\t\t\tif (result.length) {\n\t\t\t\t\tthis.List.units[start.valueOf()] = result;\n\t\t\t\t}\n\n\t\t\t\tstart = webix.Date.add(start, 1, \"day\", true);\n\t\t\t}\n\t\t}\n\t}\n\n\tTimeStart(ev) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (isMultiDay(ev)) return _(\"All Day\");\n\t\telse return timeStart(ev.start_date, ev.end_date);\n\t}\n}\n","import UnitListView from \"../common/unitlist\";\nimport { shrinkTo, isToday } from \"helpers/dates\";\n\nexport default class AgendaView extends UnitListView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst ui = super.config();\n\t\tui.css = \"webix_scheduler_agenda\";\n\n\t\twebix.extend(\n\t\t\tui.type,\n\t\t\t{\n\t\t\t\theight: \"auto\",\n\t\t\t\theaderHeight: 50,\n\t\t\t\tclassname: obj => this.TemplateCss(obj),\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\twebix.extend(\n\t\t\tui.on,\n\t\t\t{\n\t\t\t\tonItemRender: obj => {\n\t\t\t\t\tif (obj.$unit) this.CurrentUnit = obj.$unit;\n\t\t\t\t},\n\t\t\t\tonItemClick: (id, e, node) => {\n\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t\tthis.ShowEvent(id, node);\n\t\t\t\t\tif (!compact) this.SelectEvent(node);\n\t\t\t\t},\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tsuper.init();\n\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tconst events = this.Data.events(true);\n\n\t\tthis.on(this.State.$changes, \"date\", () => this.RefreshData());\n\t\tthis.on(this.State.$changes, \"active\", () => this.RefreshData());\n\t\tthis.on(this.State.$changes, \"selected\", v => {\n\t\t\tif (!v) this.SelectEvent(); //remove selection\n\t\t});\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData());\n\n\t\t// updates made in full mode by form\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData()\n\t\t);\n\t}\n\n\tRefreshData() {\n\t\tlet start = webix.Date.monthStart(this.State.date);\n\t\tlet end = webix.Date.add(start, 1, \"month\", true);\n\n\t\tthis.Data.getEvents(start, end).then(data => {\n\t\t\tthis.data = { all: data, start: start, end: end };\n\t\t\tif (this.app) {\n\t\t\t\tthis.List.clearAll();\n\t\t\t\tthis.List.parse(data.map(shrinkTo(start, end)));\n\t\t\t\tthis.ToggleOverlay();\n\t\t\t}\n\t\t});\n\t}\n\n\tSelectEvent(node) {\n\t\tif (node == this._selected) return;\n\n\t\tconst name = \"webix_agenda_selected\";\n\t\tif (this._selected) webix.html.removeCss(this._selected, name);\n\t\tif (node) webix.html.addCss(node, name);\n\n\t\tthis._selected = node;\n\t}\n\n\tTemplateHeader(datestring) {\n\t\tconst date = new Date(datestring * 1);\n\t\tconst today = isToday(date);\n\n\t\tconst fstring = `%F <span class='webix_scheduler_monthday${\n\t\t\ttoday ? \" webix_scheduler_today\" : \"\"\n\t\t}'>%j</span><br><span class='webix_scheduler_dayofweek'>%l</span>`;\n\n\t\treturn webix.Date.dateToStr(fstring)(date);\n\t}\n\n\tTemplateCss(obj) {\n\t\tconst ids = this.List.getUnitList(this.CurrentUnit);\n\n\t\tlet css = \"webix_list_item\";\n\t\tif (obj.id == ids[ids.length - 1]) css += \" webix_event_last\";\n\t\tif (obj.id == ids[0]) css += \" webix_event_first\";\n\n\t\treturn css;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class HourscaleView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tborderless: true,\n\t\t\tlocalId: \"scale\",\n\t\t\tcss: \"webix_scheduler_scale\",\n\t\t\ttype: {\n\t\t\t\theight: 42,\n\t\t\t\theightSize: (obj, common) => {\n\t\t\t\t\tconst ind = this.List.getIndexById(obj.id);\n\t\t\t\t\treturn common.height - (ind === 0 ? 17 : 0) + \"px\";\n\t\t\t\t},\n\t\t\t},\n\t\t\tscroll: false,\n\t\t\tautoheight: true,\n\t\t\twidth: 51,\n\t\t\ttemplate: obj => this.HourScaleItem(obj),\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.List = this.$$(\"scale\");\n\t\tthis.ParseHours();\n\t}\n\n\tParseHours() {\n\t\tconst data = [];\n\t\tfor (let h = 0; h < 24; h++) {\n\t\t\tdata.push({ id: h + \"\" });\n\t\t}\n\t\tthis.List.parse(data);\n\t}\n\n\tHourScaleItem(obj) {\n\t\tif (this.List.getIndexById(obj.id) === 0) return \"\";\n\t\telse return `${(obj.id < 10 ? \"0\" : \"\") + obj.id}:00`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class MultiMoreView extends JetView {\n\tconfig() {\n\t\tconst more = {\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"more\",\n\t\t\twidth: 50,\n\t\t\tcss: \"webix_scheduler_multi_space\",\n\t\t\ttooltip: () => \"\",\n\t\t\tonClick: {\n\t\t\t\t\"wxi-angle-down\": () => this.ExpandData(),\n\t\t\t\t\"wxi-angle-up\": () => this.WrapData(),\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tcols: [more, {}],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.List = this.$$(\"multiDayList\");\n\t\tthis.MoreIcon = this.$$(\"more\");\n\n\t\tthis._expandState = \"down\";\n\t\tthis.maxVisibleLines = 3;\n\t}\n\n\tSetMoreIcon(mode) {\n\t\tif (!mode) {\n\t\t\tthis.MoreIcon.setHTML(\"\");\n\t\t} else {\n\t\t\tconst tooltip = mode === \"up\" ? \"Collapse\" : \"Expand\";\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.MoreIcon.setHTML(\n\t\t\t\t`<div class=\"webix_scheduler_more_icon webix_icon wxi-angle-${mode}\" webix_tooltip=\"${_(\n\t\t\t\t\t`${tooltip} all-day events`\n\t\t\t\t)}\"><div>`\n\t\t\t);\n\t\t}\n\t}\n\n\t// height change and delay for animation\n\tAnimate(mode, height, handler) {\n\t\tthis.List.$view.style.transition = \"height 150ms\";\n\t\tif (height) this.List.$view.style.height = `${height}px`;\n\n\t\tsetTimeout(() => {\n\t\t\tif (handler) handler();\n\n\t\t\tthis.List.$view.style.transition = \"\";\n\t\t\tthis._inAnimation = false;\n\t\t\tthis.SetMoreIcon(mode);\n\t\t}, 150);\n\t}\n}\n","function _select(id, functor) {\n\tconst trgs = this.LocateSelected(id);\n\tif (trgs) {\n\t\tfor (let i = 0; i < trgs.length; i++)\n\t\t\tfunctor(trgs[i], \"webix_scheduler_event_selected\");\n\t}\n}\n\nfunction Select(id) {\n\treturn _select.call(this, id, webix.html.addCss);\n}\n\nfunction Unselect(id) {\n\treturn _select.call(this, id, webix.html.removeCss);\n}\n\nfunction HandleSelection() {\n\tconst mode = this._SelectionMode;\n\tthis.State = this.app.getState();\n\n\tthis.on(this.State.$changes, \"selected\", (v, o) => {\n\t\tif (o) this.Unselect(o.date && typeof o.date === \"string\" ? o.date : o.id);\n\n\t\tif (v) {\n\t\t\tconst id = v.id === \"0\" || !v.date ? v.id : v.date;\n\t\t\tsetTimeout(\n\t\t\t\t() => this.Select(id),\n\t\t\t\tmode !== \"multi\" && id === \"0\" ? 150 : 0\n\t\t\t);\n\t\t}\n\t});\n\n\t// reapply selection to a saved new event\n\tif (mode !== \"multi\") {\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(events.data, \"onStoreUpdated\", (id, o, operation) => {\n\t\t\tif (\n\t\t\t\toperation === \"add\" &&\n\t\t\t\tid != \"0\" &&\n\t\t\t\tthis.State.selected &&\n\t\t\t\tthis.State.selected.id === \"0\"\n\t\t\t) {\n\t\t\t\tthis.State.selected.id = id;\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction locate(inner) {\n\treturn function LocateSelected(id) {\n\t\tif (this._DataObj) {\n\t\t\treturn Array.prototype.map.call(\n\t\t\t\tthis._DataObj.querySelectorAll(\n\t\t\t\t\t`[webix_${inner ? \"l\" : \"e\"}_id=\"${id}\"]`\n\t\t\t\t),\n\t\t\t\tel => (inner ? el.firstElementChild : el)\n\t\t\t);\n\t\t}\n\t\treturn null;\n\t};\n}\n\nexport default function SelectionMixin(child, mode, inner) {\n\tchild._SelectionMode = mode;\n\n\tchild.Select = Select;\n\tchild.Unselect = Unselect;\n\tchild.HandleSelection = HandleSelection;\n\tchild.LocateSelected = locate(inner);\n\n\tchild.HandleSelection();\n}\n","export const Resizer = {\n\t$dragIn: function() {\n\t\tconst ctx = this.getContext();\n\n\t\tif (ctx.from.mode !== this.mode) return false;\n\t\treturn true;\n\t},\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\n\t\tconst box = webix.html.offset(ctx.target);\n\t\tlet y = pos.y - box.y;\n\n\t\tif (y < ctx.y_diff) y = ctx.y_diff;\n\t\telse if (y > box.height) y = box.height;\n\n\t\tconst height = y - ctx.y_diff;\n\t\tResizer.updateNodeHeight.call(this, height);\n\n\t\tif (ctx.duration !== height) {\n\t\t\tctx.duration = height;\n\t\t\tthis.updateText(ctx);\n\t\t}\n\n\t\tpos.x = ctx.x_diff;\n\t\tpos.y = ctx.y_diff;\n\t},\n\tupdateNodeHeight: function(height) {\n\t\tconst node = webix.DragControl.getNode();\n\t\tnode.style.height = Math.max(this.master.minEventHeight, height) + \"px\";\n\t},\n\tgetActualDate: function(master, any) {\n\t\tconst ctx = this.getContext();\n\n\t\tconst date = webix.Date.copy(ctx.event.start_date);\n\t\tconst minutes =\n\t\t\t(Math.round((ctx.duration * 60) / master.List.type.height / 5) || 1) * 5;\n\n\t\twebix.Date.add(date, minutes, \"minute\");\n\n\t\tif (!any && webix.Date.equal(date, ctx.event.end_date)) return null;\n\n\t\treturn {\n\t\t\tstart_date: webix.Date.copy(ctx.event.start_date),\n\t\t\tend_date: date,\n\t\t};\n\t},\n};\n","import { Resizer } from \"./resizer\";\nimport {\n\tgetParams,\n\tcutOccurrence,\n\tclipSequence,\n\tmovePattern,\n} from \"./recurring\";\nimport { serialize } from \"./ical\";\n\nexport function initDnD(view, mode, dragOnly) {\n\tconst ctrl = webix.copy(modes[mode]);\n\n\tctrl.view = view;\n\tctrl.master = this;\n\tctrl.State = this.app.getState();\n\tctrl.Local = this.app.getService(\"local\").events(true);\n\tctrl.Ops = this.app.getService(\"operations\");\n\n\twebix.DragControl.addDrag(view.$view, ctrl);\n\tif (!dragOnly) webix.DragControl.addDrop(view.$view, ctrl, true);\n}\n\nexport function locateEvent(e, view) {\n\tlet target = e.target;\n\tlet id, node;\n\n\tdo {\n\t\tid = target.getAttribute(\"webix_e_id\");\n\t\tnode = id ? target : null;\n\t\ttarget = target.parentNode;\n\t} while (!id && target !== view);\n\n\treturn { id, node };\n}\n\nfunction updateSelection(prev, date) {\n\tif (this.State.selected) {\n\t\tconst selection = getParams(prev);\n\t\tif (prev.$recurring)\n\t\t\tselection.date = date.start_date.valueOf() + \"_\" + prev.$id;\n\n\t\tthis.State.selected = selection;\n\t}\n}\n\nfunction editRecurring(mode, obj, change) {\n\tlet id = obj.$id || obj.id;\n\n\t/* special cases */\n\t// if 'this' edited as 'this'\n\tif (mode === \"this\" && this.master.HasOneOccurrence(obj)) {\n\t\treturn this.Ops.updateEvent(id, change);\n\t}\n\t// if 1st occurrence in whole sequence or in 'next'\n\tmode = this.master.ChangeMode(\n\t\tmode,\n\t\tobj,\n\t\tthis.Local.getItem(obj.recurring ? id : obj.origin_id).start_date,\n\t\tobj.recurring ? obj.id : obj.start_date\n\t);\n\tif (!mode) {\n\t\t// if date was changed\n\t\tobj.$recurring = movePattern(obj.$recurring, change, obj);\n\t\tchange.recurring = serialize(obj.$recurring);\n\t\treturn this.Ops.updateEvent(id, change);\n\t}\n\n\tif (mode === \"this\" || mode === \"next\") {\n\t\t// cut out occurrence or split event sequence and save as separate events\n\t\tlet recurring = \"\";\n\t\tlet parent;\n\t\tif (mode === \"this\") {\n\t\t\trecurring = cutOccurrence(obj.id, obj);\n\t\t} else {\n\t\t\tif (obj.recurring) {\n\t\t\t\trecurring = clipSequence(obj.id, webix.copy(obj));\n\t\t\t} else {\n\t\t\t\t// if 'this' edited as 'next'\n\t\t\t\tid = obj.origin_id;\n\t\t\t\tparent = webix.copy(this.Local.getItem(id));\n\t\t\t\trecurring = clipSequence(change.start_date, webix.copy(parent), true);\n\t\t\t}\n\t\t}\n\n\t\tconst newEvent = newSubEvent.call(this, id, mode, obj, change, parent);\n\n\t\treturn this.Ops.updateEvent(\n\t\t\tid,\n\t\t\t{ recurring },\n\t\t\tmode,\n\t\t\twebix.Date.dayStart(change.start_date)\n\t\t).then(() => {\n\t\t\treturn this.Ops.addEvent(newEvent);\n\t\t});\n\t}\n\n\tif (mode === \"all\") {\n\t\t// [FIXME] maybe need to store total UNTIL/COUNT on backend (mostly for dynamic loading)\n\t\tconst oid = obj.origin_id || obj.$id;\n\t\tconst all = webix.copy(this.Local.getItem(oid));\n\t\tlet rec = all.$recurring;\n\t\tif (rec.COUNT || rec.UNTIL) {\n\t\t\trec = this.master.CorrectCountUntil(\n\t\t\t\tall,\n\t\t\t\tmode,\n\t\t\t\tchange.start_date,\n\t\t\t\tthis.Local\n\t\t\t);\n\t\t}\n\t\trec = movePattern(rec, change, all); // if date was changed\n\t\tif (rec.EXDATE) delete rec.EXDATE;\n\n\t\tchange.recurring = serialize(rec);\n\n\t\treturn this.Ops.updateEvent(obj.origin_id || id, change, mode);\n\t}\n}\n\nfunction newSubEvent(id, mode, obj, change, parent) {\n\tconst newEvent = {\n\t\ttext: obj.text,\n\t\tdetails: obj.details,\n\t\tcolor: obj.color,\n\t\tall_day: obj.all_day,\n\t\tstart_date: change.start_date,\n\t\tend_date: change.end_date,\n\t\torigin_id: obj.origin_id || id,\n\t};\n\n\tif (mode === \"next\") {\n\t\t// [FIXME] maybe need to store total UNTIL/COUNT on backend (mostly for dynamic loading)\n\t\tlet rec = webix.copy(obj.recurring ? obj.$recurring : parent.$recurring);\n\t\tif (rec.COUNT || rec.UNTIL) {\n\t\t\trec = this.master.CorrectCountUntil(\n\t\t\t\t{ ...this.Local.getItem(id), $recurring: rec },\n\t\t\t\tmode,\n\t\t\t\tnewEvent.start_date,\n\t\t\t\tthis.Local\n\t\t\t);\n\t\t}\n\t\trec = movePattern(rec, newEvent, obj); // if date was changed\n\t\trec.EXDATE = [];\n\n\t\tnewEvent.recurring = serialize(rec);\n\t}\n\n\tif (this.master.app.config.calendars) {\n\t\tnewEvent.calendar = obj.calendar;\n\t}\n\n\treturn newEvent;\n}\n\nconst common = {\n\tmode: \"common\",\n\t$dragDestroy: function(target, node) {\n\t\tconst ctx = this.getContext();\n\n\t\tif (!ctx.$waitUpdate) ctx.node.style.visibility = \"visible\";\n\t\tif (ctx.$resize) webix.html.removeCss(document.body, \"webix_active_resize\");\n\n\t\twebix.html.remove(node);\n\n\t\treturn false;\n\t},\n\tgetContext: function() {\n\t\treturn webix.DragControl.getContext();\n\t},\n\tsetDragOffset: function(node, target, e) {\n\t\tconst ctx = this.getContext();\n\t\tconst pos = webix.html.pos(e);\n\t\tconst offset = webix.html.offset(node);\n\n\t\tctx.width = offset.width;\n\t\tctx.height = offset.height;\n\t\tctx.x_offset = offset.x - pos.x;\n\t\tctx.y_offset = offset.y - pos.y;\n\t},\n\tupdateEvent: function(event, data, ctx) {\n\t\tif (ctx.event.$id || ctx.event.origin_id) {\n\t\t\tthis.master._waitPopup = webix.promise.defer();\n\t\t\tthis.master._waitPopup\n\t\t\t\t.then(o => {\n\t\t\t\t\tconst res = editRecurring.call(this, o, ctx.event, data);\n\n\t\t\t\t\tres.then(() => updateSelection.call(this, event, data));\n\t\t\t\t\tthis.master.app.callEvent(\"backend:operation\", [res]);\n\t\t\t\t})\n\t\t\t\t.finally(() => (this.master._waitPopup = null));\n\t\t\tthis.master.app._dndActionPopup.Show(this.master._waitPopup);\n\t\t} else {\n\t\t\tconst res = this.Ops.updateEvent(event.$id || event.id, data);\n\t\t\tthis.finishOperation(res, event, data, ctx);\n\t\t}\n\t},\n\taddEvent: function(event, data, ctx) {\n\t\tconst newEvent = {\n\t\t\ttext: event.text,\n\t\t\tstart_date: data.start_date,\n\t\t\tend_date: data.end_date,\n\t\t\tdetails: \"\",\n\t\t};\n\t\tif (this.master.app.config.calendars) {\n\t\t\tnewEvent.calendar = event.calendar;\n\t\t}\n\n\t\tconst res = this.Ops.addEvent(newEvent);\n\t\tthis.finishOperation(res, newEvent, data, ctx);\n\t},\n\n\tfinishOperation(res, event, data, ctx) {\n\t\tres.then(id =>\n\t\t\tupdateSelection.call(this, id ? { ...event, id } : event, data)\n\t\t);\n\t\tthis.master.app.callEvent(\"backend:operation\", [res]);\n\t\tctx[\"$waitUpdate\"] = true;\n\t},\n};\n\nconst day = webix.extend(\n\t{\n\t\tmode: \"day\",\n\t\t$dragIn: function(source, target) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$resize) return Resizer.$dragIn.apply(this, arguments);\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tif (ctx.target != target) {\n\t\t\t\tconst node = webix.DragControl.getNode();\n\n\t\t\t\ttarget.firstChild.appendChild(node);\n\t\t\t\tctx.target = target;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t$drop: function() {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tconst date = this.getActualDate(this.master);\n\t\t\tif (date) {\n\t\t\t\tif (ctx.event.id == \"0\") {\n\t\t\t\t\tthis.addEvent(ctx.event, date, ctx);\n\t\t\t\t} else this.updateEvent(ctx.event, date, ctx);\n\t\t\t}\n\t\t},\n\t\t$dragPos: function(pos) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$resize) return Resizer.$dragPos.apply(this, arguments);\n\n\t\t\tconst box = webix.html.offset(ctx.target);\n\t\t\tconst max = box.height - ctx.height;\n\n\t\t\tpos.x = ctx.x_diff;\n\t\t\tpos.y += ctx.y_offset - box.y;\n\n\t\t\tif (pos.y < 0) pos.y = 0;\n\t\t\telse if (pos.y > max) pos.y = max;\n\n\t\t\twebix.extend(ctx, pos, true);\n\n\t\t\tif (ctx.$last_y !== pos.y) {\n\t\t\t\tthis.updateText(ctx);\n\t\t\t\tctx.$last_y = pos.y;\n\t\t\t}\n\t\t},\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst event = locateEvent(e, target);\n\t\t\tif (event.id) {\n\t\t\t\tconst ctx = this.getContext();\n\t\t\t\twebix.extend(ctx, event, true);\n\t\t\t\twebix.extend(ctx, { from: this, target }, true);\n\n\t\t\t\tctx.event = this.master.GetEvent(event.id);\n\t\t\t\tthis.setDragOffset(event.node, target, e);\n\n\t\t\t\tif (e.target.getAttribute(\"webix_resizer\")) {\n\t\t\t\t\twebix.html.addCss(document.body, \"webix_active_resize\", true);\n\t\t\t\t\tctx[\"$resize\"] = true;\n\t\t\t\t}\n\n\t\t\t\tconst html = event.node.cloneNode(true);\n\n\t\t\t\thtml.className += ` webix_drag_zone webix_${\n\t\t\t\t\tctx.$resize ? \"resize\" : \"drag\"\n\t\t\t\t}_event`;\n\t\t\t\ttarget.firstChild.appendChild(html);\n\n\t\t\t\tevent.node.style.visibility = \"hidden\";\n\t\t\t\treturn html;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tgetActualDate: function(master, any) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$resize) return Resizer.getActualDate.apply(this, arguments);\n\n\t\t\tconst date = webix.Date.copy(master.Day);\n\t\t\t//scale start correction\n\t\t\tconst delta = master.List.getFirstId() * master.List.type.height;\n\t\t\tconst minutes =\n\t\t\t\tMath.round(((ctx.y + delta) * 60) / master.List.type.height / 5) * 5;\n\n\t\t\twebix.Date.add(date, minutes, \"minute\");\n\n\t\t\tif (!any && webix.Date.equal(date, ctx.event.start_date)) return null;\n\n\t\t\tconst duration = ctx.event.end_date - ctx.event.start_date;\n\t\t\treturn {\n\t\t\t\tstart_date: date,\n\t\t\t\tend_date: new Date(date.valueOf() + duration),\n\t\t\t};\n\t\t},\n\t\tupdateText: function(ctx) {\n\t\t\tconst node = webix.DragControl.getNode();\n\t\t\tconst ctrl = webix.DragControl.getMaster(ctx.target);\n\n\t\t\tconst event = this.getActualDate(ctrl.master, true);\n\t\t\tevent.text = ctx.event.text;\n\n\t\t\tnode.innerHTML = \"\";\n\t\t\tnode.innerHTML = ctrl.master.EventTemplate(event);\n\t\t},\n\t\tsetDragOffset: function(node, target, e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst pos = webix.html.pos(e);\n\t\t\tconst noff = webix.html.offset(node);\n\n\t\t\tctx.height = noff.height;\n\t\t\tctx.x_offset = noff.x - pos.x;\n\t\t\tctx.y_offset = noff.y - pos.y;\n\n\t\t\tconst toff = webix.html.offset(target);\n\t\t\tctx.x_diff = noff.x - toff.x - 1; // 1px border\n\t\t\tctx.y_diff = noff.y - toff.y;\n\t\t},\n\t},\n\tcommon\n);\n\nconst month = webix.extend(\n\t{\n\t\tmode: \"month\",\n\t\t$dragIn: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tctx.offset = ctx.offset || webix.html.offset(target);\n\n\t\t\tconst index = this.locate(e);\n\t\t\tconst id = this.view.getIdByIndex(index);\n\t\t\tconst node = this.view.getItemNode(id);\n\n\t\t\tif (ctx.$marked !== id) this.markDropArea(id);\n\n\t\t\treturn node;\n\t\t},\n\t\t$dragOut: function(source, target, drop) {\n\t\t\tif (target !== drop) this.markDropArea();\n\t\t\treturn null;\n\t\t},\n\t\t$drop: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tthis.markDropArea();\n\n\t\t\tconst date = this.getActualDate(e);\n\t\t\tif (date) {\n\t\t\t\tif (ctx.event.id == \"0\") {\n\t\t\t\t\tthis.addEvent(ctx.event, date, ctx);\n\t\t\t\t} else this.updateEvent(ctx.event, date, ctx);\n\t\t\t}\n\t\t},\n\t\t$dragPos: function(pos) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tpos.x += ctx.x_offset;\n\t\t\tpos.y += ctx.y_offset;\n\t\t},\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst event = locateEvent(e, target);\n\t\t\tif (event.id && event.id != \"$wsh_multi_more\") {\n\t\t\t\tconst ctx = this.getContext();\n\t\t\t\twebix.extend(ctx, event, true);\n\t\t\t\twebix.extend(\n\t\t\t\t\tctx,\n\t\t\t\t\t{ from: this, offset: webix.html.offset(target) },\n\t\t\t\t\ttrue\n\t\t\t\t);\n\n\t\t\t\tctx.event = this.master.Events.getItem(event.id);\n\t\t\t\tctx.start = this.view.getIdByIndex(this.locate(e));\n\n\t\t\t\tthis.setDragOffset(event.node, target, e);\n\n\t\t\t\tconst drag_container = document.createElement(\"DIV\");\n\t\t\t\tconst html = event.node.cloneNode(true);\n\n\t\t\t\thtml.style.position = \"static\";\n\t\t\t\tdrag_container.appendChild(html);\n\t\t\t\tdrag_container.className =\n\t\t\t\t\ttarget.className + \" webix_drag_zone webix_drag_event\";\n\t\t\t\tdocument.body.appendChild(drag_container);\n\n\t\t\t\tevent.node.style.visibility = \"hidden\";\n\n\t\t\t\twebix.callEvent(\"onClick\", [e]);\n\t\t\t\treturn drag_container;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tgetActualDate: function(e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst diff = this.locate(e) - this.view.getIndexById(ctx.start);\n\n\t\t\tif (!diff) return null;\n\n\t\t\treturn {\n\t\t\t\tstart_date: webix.Date.add(ctx.event.start_date, diff, \"day\", true),\n\t\t\t\tend_date: webix.Date.add(ctx.event.end_date, diff, \"day\", true),\n\t\t\t};\n\t\t},\n\t\tmarkDropArea: function(id) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$marked && ctx.$marked != id) {\n\t\t\t\tthis.view.removeCss(ctx.$marked, \"webix_drag_over\");\n\t\t\t\tctx.$marked = null;\n\n\t\t\t\tif (ctx.$extra) {\n\t\t\t\t\twebix.html.removeCss(this.view.$view, ctx.$extra);\n\t\t\t\t\tctx.$extra = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!ctx.$marked && id) {\n\t\t\t\tthis.view.addCss(id, \"webix_drag_over\");\n\t\t\t\tctx.$marked = id;\n\n\t\t\t\tlet extra;\n\t\t\t\tif (this.view.getFirstId() == id) extra = \"webix_scheduler_dnd_1\";\n\t\t\t\telse if (this.view.getLastId() == id) extra = \"webix_scheduler_dnd_n\";\n\n\t\t\t\tif (extra) {\n\t\t\t\t\twebix.html.addCss(this.view.$view, extra, true);\n\t\t\t\t\tctx.$extra = extra;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tlocate: function(e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst pos = webix.html.pos(e);\n\n\t\t\tpos.x -= ctx.offset.x;\n\t\t\tpos.y -= ctx.offset.y;\n\n\t\t\treturn (\n\t\t\t\tMath.min(\n\t\t\t\t\tMath.floor(pos.y / this.view.type.height),\n\t\t\t\t\tthis.view.config.yCount - 1\n\t\t\t\t) *\n\t\t\t\t\tthis.view.config.xCount +\n\t\t\t\tMath.min(\n\t\t\t\t\tMath.floor(pos.x / this.view.type.width),\n\t\t\t\t\tthis.view.config.xCount - 1\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t},\n\tcommon\n);\n\nconst multiday = webix.extend(\n\t{\n\t\tmode: \"multiday\",\n\t},\n\tmonth\n);\n\nconst more = webix.extend(\n\t{\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst id = this.view.locate(e);\n\t\t\tif (id) {\n\t\t\t\tconst ctx = this.getContext();\n\t\t\t\tconst node = this.view.getItemNode(id).children[0];\n\t\t\t\twebix.extend(ctx, { from: this, id }, true);\n\n\t\t\t\tctx.event = this.master.Events.getItem(id);\n\t\t\t\tctx.start = this.master.ID;\n\n\t\t\t\tthis.setDragOffset(node, target, e);\n\n\t\t\t\tconst drag_container = document.createElement(\"DIV\");\n\n\t\t\t\tdrag_container.style.width = ctx.width + \"px\";\n\t\t\t\tdrag_container.style.height = ctx.height + \"px\";\n\n\t\t\t\tdrag_container.appendChild(node.cloneNode(true));\n\t\t\t\tdrag_container.className =\n\t\t\t\t\ttarget.className + \" webix_drag_zone webix_drag_event\";\n\n\t\t\t\tdocument.body.appendChild(drag_container);\n\n\t\t\t\tthis.master.HideWindow();\n\t\t\t\treturn drag_container;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t$dragDestroy: function(target, node) {\n\t\t\twebix.html.remove(node);\n\t\t\treturn false;\n\t\t},\n\t},\n\tmonth\n);\n\nconst modes = {\n\tday,\n\tmonth,\n\tmore,\n\tmultiday,\n};\n","import HourscaleView from \"../common/hourscale\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { initDnD, locateEvent } from \"helpers/dnd\";\nimport { shrinkTo, isToday } from \"helpers/dates\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class DayEventsView extends HourscaleView {\n\tconstructor(app, name, config) {\n\t\tsuper(app, name);\n\n\t\t// when dayevents is a part of week\n\t\tif (config) {\n\t\t\tthis.WeekDayNum = config.day;\n\t\t}\n\t}\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"dayList\",\n\t\t\tcss: \"webix_scheduler_day_events\",\n\t\t\tscroll: false,\n\t\t\tautoheight: true,\n\t\t\ttemplate: \"\",\n\t\t\ttype: {\n\t\t\t\theight: 42,\n\t\t\t\tcss: \"webix_scheduler_day_scale_item\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_day_event: e => this.ShowEvent(e),\n\t\t\t},\n\t\t\tonDblClick: {\n\t\t\t\twebix_scheduler_day_scale_item: (_e, h) => this.ShowNew(h),\n\t\t\t},\n\t\t};\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.List = this.$$(\"dayList\");\n\n\t\tSelectionMixin(this, \"scale\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.List.$setSize = function(x, y) {\n\t\t\tif (webix.ui.view.prototype.$setSize.call(this, x, y)) {\n\t\t\t\tthis.render();\n\t\t\t}\n\t\t};\n\n\t\tthis.minEventHeight = 62;\n\t\tthis.ParseHours();\n\n\t\tthis.on(this.State.$changes, \"readonly\", () => this.List.render());\n\n\t\tthis.List.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.List, \"day\");\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.Day = webix.Date.datePart(this.State.date, true);\n\n\t\t\tif (this.WeekDayNum > -1) {\n\t\t\t\tconst weekStart = this.data.start;\n\t\t\t\tthis.Day = webix.Date.add(weekStart, this.WeekDayNum, \"day\", true);\n\t\t\t}\n\n\t\t\tconst to = webix.Date.add(this.Day, 1, \"day\", true);\n\t\t\tthis.Events = this.FilterToday(this.Day, to);\n\n\t\t\tif (this._marker_update_interval)\n\t\t\t\tthis._marker_update_interval = clearInterval(\n\t\t\t\t\tthis._marker_update_interval\n\t\t\t\t);\n\n\t\t\tif (isToday(this.Day))\n\t\t\t\tthis._marker_update_interval = setInterval(() => {\n\t\t\t\t\tif (isToday(this.Day)) this.UpdateMarkerPosition();\n\t\t\t\t\telse {\n\t\t\t\t\t\twebix.html.remove(this._Marker);\n\t\t\t\t\t\tthis._Marker = this._marker_update_interval = clearInterval(\n\t\t\t\t\t\t\tthis._marker_update_interval\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}, 5 * 60 * 1000); // 5 minutes\n\n\t\t\tthis.List.render();\n\t\t}\n\t}\n\n\tGetEvent(id) {\n\t\tfor (let i = 0; i < this.Events.length; i++)\n\t\t\tif (this.Events[i].id == id) return this.Events[i];\n\t\treturn null;\n\t}\n\n\tFilterToday(value, to) {\n\t\tif (this.WeekDayNum > -1) {\n\t\t\treturn this.data.single.filter(ev => {\n\t\t\t\tif (ev.start_date < to && ev.end_date > value) return true;\n\t\t\t});\n\t\t}\n\t\treturn this.data.single;\n\t}\n\n\tMarkToday() {\n\t\tif (this.Day && isToday(this.Day)) {\n\t\t\tconst marker = webix.html.create(\"div\", {\n\t\t\t\tclass: \"webix_scheduler_today_marker\",\n\t\t\t});\n\t\t\tthis._Marker = this.List.$view.firstChild.appendChild(marker);\n\t\t\tthis.UpdateMarkerPosition();\n\t\t} else {\n\t\t\tthis._Marker = null;\n\t\t}\n\t}\n\n\tUpdateMarkerPosition() {\n\t\tif (this._Marker) {\n\t\t\tconst current = new Date();\n\t\t\tconst time = current.getHours() * 60 + current.getMinutes();\n\t\t\tthis._Marker.style.top =\n\t\t\t\tMath.round((time * this.List.type.height) / 60) + \"px\";\n\t\t}\n\t}\n\n\tRenderEvents() {\n\t\tconst evs = this.Events;\n\t\tif (evs && evs.length) {\n\t\t\tthis.PrepareEvents();\n\t\t\tconst container = webix.html.create(\"div\", {\n\t\t\t\trole: \"presentation\",\n\t\t\t});\n\t\t\tcontainer.innerHTML = evs.map(i => this.ToHTML(i)).join(\"\");\n\t\t\tthis._DataObj = this.List.$view.firstChild.appendChild(container);\n\t\t}\n\t\tthis.MarkToday();\n\t}\n\n\tPrepareEvents() {\n\t\tconst evs = this.Events;\n\t\tlet stack = [];\n\n\t\tfor (let i = 0; i < evs.length; i++) {\n\t\t\tconst ev = evs[i];\n\t\t\tev.$inner = false;\n\n\t\t\tlet orderSet = this.PruneStack(ev, stack);\n\n\t\t\tif (stack.length) {\n\t\t\t\tstack[stack.length - 1].$inner = true;\n\t\t\t}\n\n\t\t\tif (!orderSet) {\n\t\t\t\tif (stack.length) {\n\t\t\t\t\tev.$sorder = stack[stack.length - 1].$sorder + 1;\n\t\t\t\t\tev.$inner = false;\n\t\t\t\t} else {\n\t\t\t\t\tev.$sorder = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// insert new event into stack\n\t\t\tstack.splice(ev.$sorder, 0, ev);\n\t\t\tif (stack.length > (stack.max_count || 0)) {\n\t\t\t\tstack.max_count = stack.length;\n\t\t\t}\n\t\t}\n\n\t\tthis.SetPosition(stack, evs);\n\t}\n\n\t// returns true if new event was marked for inserting;\n\t// false if stack is empty or there is no suitable place for new event inside\n\tPruneStack(newEvent, stack) {\n\t\t// clean events from top of stack if new event starts after they end\n\t\twhile (\n\t\t\tstack.length &&\n\t\t\tthis.GetEventEndDate(stack[stack.length - 1]) <= newEvent.start_date\n\t\t) {\n\t\t\tstack.splice(stack.length - 1, 1);\n\t\t}\n\n\t\t// clean 1 event from within remaining stack if this event ends before new event starts\n\t\tfor (let j = 0; j < stack.length; j++) {\n\t\t\tif (this.GetEventEndDate(stack[j]) <= newEvent.start_date) {\n\t\t\t\tnewEvent.$sorder = stack[j].$sorder; // mark new event for this place in stack\n\t\t\t\tstack.splice(j, 1);\n\t\t\t\tnewEvent.$inner = true;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tSetPosition(stack, evs) {\n\t\t//scale start correction\n\t\tconst delta = this.List.getFirstId() * this.List.type.height;\n\n\t\tfor (let i = 0; i < evs.length; i++) {\n\t\t\tconst ev = evs[i];\n\n\t\t\tev.$count = stack.max_count;\n\t\t\tlet temp_width = Math.floor(this.List.$width / ev.$count);\n\t\t\tev.$left = ev.$sorder * temp_width;\n\t\t\tif (!ev.$inner) temp_width = temp_width * (ev.$count - ev.$sorder);\n\t\t\tev.$width = temp_width - 8;\n\n\t\t\tconst evCorrectedCopy = shrinkTo(\n\t\t\t\tthis.Day,\n\t\t\t\twebix.Date.add(this.Day, 1, \"day\", true)\n\t\t\t)(ev);\n\t\t\tconst sm =\n\t\t\t\tevCorrectedCopy.start_date.getHours() * 60 +\n\t\t\t\tevCorrectedCopy.start_date.getMinutes();\n\t\t\tconst em =\n\t\t\t\tevCorrectedCopy.end_date.getHours() * 60 +\n\t\t\t\t\tevCorrectedCopy.end_date.getMinutes() || 24 * 60;\n\n\t\t\tev.$top = Math.round((sm * this.List.type.height) / 60) - delta;\n\t\t\tev.$height = Math.max(\n\t\t\t\tthis.minEventHeight,\n\t\t\t\t((em - sm) * this.List.type.height) / 60\n\t\t\t);\n\t\t}\n\t}\n\n\tToHTML(obj) {\n\t\tconst content = this.EventTemplate(obj);\n\t\treturn this.EventTemplateStart(obj) + content + \"</div>\";\n\t}\n\n\tGetEventEndDate(ev) {\n\t\tlet end_date = ev.end_date;\n\t\tconst duration =\n\t\t\t(((ev.end_date - ev.start_date) / 60000) * this.List.type.height) / 60;\n\n\t\tif (duration < this.minEventHeight) {\n\t\t\tend_date = webix.Date.add(\n\t\t\t\tev.start_date,\n\t\t\t\tMath.ceil((this.minEventHeight / this.List.type.height) * 60),\n\t\t\t\t\"minute\",\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t\treturn end_date;\n\t}\n\n\tEventTemplateStart(obj) {\n\t\tconst css = `class=\"webix_scheduler_day_event ${\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \"webix_scheduler_event_selected\"\n\t\t\t\t: \"\"\n\t\t}\"`;\n\n\t\treturn `<div webix_e_id='${obj.id}' ${css} style='left:${\n\t\t\tobj.$left\n\t\t}px; top:${obj.$top}px; width:${obj.$width}px; height:${\n\t\t\tobj.$height\n\t\t}px; ${dayEventColor(obj)}'>`;\n\t}\n\n\tEventTemplate(obj) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst resizer = this.State.readonly\n\t\t\t? \"\"\n\t\t\t: \"<div class='webix_icon webix_scheduler_resizer' webix_resizer='true'></div>\";\n\n\t\treturn `<div class=\"webix_scheduler_inner_day\"><span class=\"webix_scheduler_event_name\">${obj.text ||\n\t\t\t_(\n\t\t\t\t\"(No title)\"\n\t\t\t)}</span><div class=\"webix_scheduler_event_time\">${webix.i18n.timeFormatStr(\n\t\t\tobj.start_date\n\t\t)} - ${webix.i18n.timeFormatStr(obj.end_date)}</div></div>${resizer}`;\n\t}\n\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.List.$view);\n\t\tif (event.id && event.id != \"0\") {\n\t\t\tconst obj = this.GetEvent(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tShowNew(h) {\n\t\tconst date = webix.Date.copy(this.Day || this.State.date);\n\t\tdate.setHours(h);\n\t\tthis.State.selected = { id: \"0\", date };\n\t}\n}\n","import MultiMoreView from \"../common/multimore\";\nimport SelectionMixin from \"helpers/selection\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MultidayEventList extends MultiMoreView {\n\tconfig() {\n\t\tconst ui = super.config();\n\n\t\tui.cols[1] = {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"multiDayList\",\n\t\t\tautoheight: true,\n\t\t\tscroll: false,\n\t\t\tcss: \"webix_scheduler_multilist\",\n\t\t\ttype: {\n\t\t\t\theight: 32,\n\t\t\t\ttemplate: (obj, common) => this.EventTemplate(obj, common),\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_multiday_event: (e, id, node) =>\n\t\t\t\t\tthis.ShowEvent(id, node),\n\t\t\t},\n\t\t};\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tsuper.init();\n\n\t\tthis._DataObj = this.List.$view.firstChild;\n\t\tSelectionMixin(this, \"multi\", true);\n\n\t\tthis.MoreIcon = this.$$(\"more\");\n\t\tthis._moreBtn = {\n\t\t\tid: \"$wsh_multi_more\",\n\t\t\t$css: \"webix_scheduler_multi_more\",\n\t\t};\n\t}\n\n\turlChange() {\n\t\tconst data = this.getParam(\"data\");\n\t\tif (data) {\n\t\t\tthis.LimitData(data.multi);\n\t\t\tthis.List.clearAll();\n\t\t\tthis.List.parse(data.multi);\n\t\t}\n\t}\n\n\tEventTemplate(obj, common) {\n\t\tconst height = common.height - 4;\n\t\tconst size = `height:${height}px; line-height:${height}px; width:calc(100% - 5px);`;\n\t\tconst color = obj.id !== \"$wsh_multi_more\" ? dayEventColor(obj) : \"\";\n\t\tconst css = this.GetStyle(obj);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"${size} ${color}\">\n\t\t\t\t\t${obj.text || _(\"(No title)\")}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj) {\n\t\tconst date = this.State.date;\n\t\tconst end =\n\t\t\t!obj.all_day && !webix.Date.timePart(obj.end_date)\n\t\t\t\t? webix.Date.add(obj.end_date, -1, \"day\", true)\n\t\t\t\t: obj.end_date;\n\n\t\tlet css = \"webix_scheduler_multiday_event\";\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (obj.start_date < date) css += \" webix_scheduler_event_break_left\";\n\t\tif (end >= webix.Date.add(date, 1, \"day\", true))\n\t\t\tcss += \" webix_scheduler_event_break_right\";\n\n\t\treturn css;\n\t}\n\n\tLimitData(data) {\n\t\tif (data.length > this.maxVisibleLines) {\n\t\t\tconst excess = data.length - 2;\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis._moreBtn.text = `${excess} ${_(\"more\")}`;\n\n\t\t\tif (this._expandState === \"down\") {\n\t\t\t\tthis._reserve = data.splice(2, excess, this._moreBtn);\n\t\t\t} else {\n\t\t\t\tthis._reserve = data.slice(2);\n\t\t\t}\n\n\t\t\tthis.SetMoreIcon(this._expandState);\n\t\t\tthis._reserveIds = this._reserve.map(d => d.id);\n\t\t} else {\n\t\t\tthis.SetMoreIcon();\n\t\t}\n\t}\n\n\tWrapData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\t\t\tthis._expandState = \"down\";\n\n\t\t\tconst height =\n\t\t\t\tthis.List.$height -\n\t\t\t\t(this._reserveIds.length - 1) * this.List.type.height;\n\t\t\tthis.Animate(\"down\", height, () => {\n\t\t\t\tthis.List.add(this._moreBtn);\n\t\t\t\tthis.List.remove(this._reserveIds);\n\t\t\t});\n\t\t}\n\t}\n\n\tExpandData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\t\t\tthis._expandState = \"up\";\n\n\t\t\tthis.Animate(\"up\");\n\n\t\t\tthis.List.remove(\"$wsh_multi_more\");\n\t\t\tthis.List.parse(this._reserve);\n\t\t}\n\t}\n\n\t// height change and delay for animation\n\tAnimate(mode, height, handler) {\n\t\tthis.List.$view.style.transition = \"height 150ms\";\n\t\tif (height) this.List.$view.style.height = `${height}px`;\n\n\t\tsetTimeout(() => {\n\t\t\tif (handler) handler();\n\n\t\t\tthis.List.$view.style.transition = \"\";\n\t\t\tthis._inAnimation = false;\n\t\t\tthis.SetMoreIcon(mode);\n\t\t}, 150);\n\t}\n\n\tSetMoreIcon(mode) {\n\t\tif (!mode) {\n\t\t\tthis.MoreIcon.setHTML(\"\");\n\t\t} else {\n\t\t\tthis._expandState = mode;\n\n\t\t\tconst tooltip = mode === \"up\" ? \"Collapse\" : \"Expand\";\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.MoreIcon.setHTML(\n\t\t\t\t`<div class=\"webix_scheduler_more_icon webix_icon wxi-angle-${mode}\" webix_tooltip=\"${_(\n\t\t\t\t\t`${tooltip} all-day events`\n\t\t\t\t)}\"><div>`\n\t\t\t);\n\t\t}\n\t}\n\n\tShowEvent(id, node) {\n\t\tif (id === \"$wsh_multi_more\") {\n\t\t\tthis.ExpandData();\n\t\t} else {\n\t\t\tconst obj = this.List.getItem(id);\n\t\t\tconst sel = getParams(obj);\n\t\t\tsel.node = node;\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport MultidayEventList from \"./multiday\";\nimport DayEventsView from \"./events\";\nimport HourscaleView from \"../common/hourscale\";\nimport { isMultiDay } from \"helpers/dates\";\n\nexport default class DayView extends JetView {\n\tconfig() {\n\t\tconst header = {\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"header\",\n\t\t\tcss: \"webix_scheduler_day_header\",\n\t\t\theight: 32,\n\t\t\ttemplate: obj => {\n\t\t\t\treturn obj.date ? webix.Date.dateToStr(\"%l\")(obj.date) : \"\";\n\t\t\t},\n\t\t};\n\n\t\tconst config = {\n\t\t\tcss: \"webix_scheduler_day\",\n\t\t\trows: [\n\t\t\t\theader,\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"multi\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\tcols: [MultidayEventList],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"scroll\",\n\t\t\t\t\tview: \"scrollview\",\n\t\t\t\t\tcss: \"webix_scheduler_day_scroll\",\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tcols: [HourscaleView, DayEventsView],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn config;\n\t}\n\n\tinit() {\n\t\tconst state = this.app.getState();\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\n\t\tthis.on(state.$changes, \"selected\", v => v && this.ScrollScale(v));\n\t}\n\n\tRefreshData(value) {\n\t\tthis.$$(\"header\").setValues({ date: value });\n\n\t\tthis.GetDay(value).then(data => {\n\t\t\t// this.app will be null if compact trigger was called in main.js\n\t\t\tif (this.app) this.setParam(\"data\", data, true);\n\n\t\t\tif (data.multi.length) {\n\t\t\t\tthis.$$(\"multi\").show();\n\t\t\t} else this.$$(\"multi\").hide();\n\t\t});\n\t}\n\n\tGetDay(date) {\n\t\tconst end = webix.Date.add(date, 1, \"day\", true);\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(date, end)\n\t\t\t.then(evs => {\n\t\t\t\tconst multi = [],\n\t\t\t\t\tsingle = [];\n\t\t\t\tevs.forEach(ev => {\n\t\t\t\t\tif (isMultiDay(ev)) {\n\t\t\t\t\t\tmulti.push(ev);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsingle.push(ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn { multi, single };\n\t\t\t});\n\t}\n\n\tScrollScale(v) {\n\t\tif (v.id === \"0\" && !v.date) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst y = (new Date().getHours() + 2) * 40;\n\t\t\t\tthis.$$(\"scroll\").scrollTo(0, y);\n\t\t\t}, 100);\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class CalendarView extends JetView {\n\tconfig() {\n\t\tthis.Events = {};\n\n\t\treturn {\n\t\t\tview: \"calendar\",\n\t\t\tlocalId: \"calendar\",\n\t\t\tevents: (day, isOutside) => this.MarkEvent(day, isOutside),\n\t\t\ticons: false,\n\t\t\tnavigation: false,\n\t\t\tmonthHeader: false,\n\t\t\tskipEmptyWeeks: true,\n\t\t\twidth: 0,\n\t\t\theight: 410,\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.Calendar = this.getRoot();\n\t\tthis.Calendar.attachEvent(\"onDateSelect\", date => {\n\t\t\tthis.app.getState().date = webix.Date.dayStart(date);\n\t\t});\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) this.RefreshData();\n\t}\n\n\tRefreshData() {\n\t\tlet { start, weeks, data } = this.data;\n\t\tconst end = webix.Date.add(start, weeks, \"week\", true);\n\n\t\tthis.Events = {};\n\n\t\twhile (start < end) {\n\t\t\tconst next = webix.Date.add(start, 1, \"day\", true);\n\t\t\tfor (let i = 0; i < data.length; i++)\n\t\t\t\tif (\n\t\t\t\t\t(data[i].all_day\n\t\t\t\t\t\t? data[i].end_date >= start\n\t\t\t\t\t\t: data[i].end_date > start) &&\n\t\t\t\t\tdata[i].start_date < next\n\t\t\t\t)\n\t\t\t\t\tthis.Events[start.valueOf()] = true;\n\t\t\tstart = next;\n\t\t}\n\n\t\tthis.Calendar.setValue(this.app.getState().date);\n\t}\n\n\t// adds dots to days with events\n\tMarkEvent(day, isOutside) {\n\t\tlet css = \"\";\n\n\t\tif (!isOutside) css += webix.Date.isHoliday(day) || \"\";\n\t\tif (this.Events[day.valueOf()]) css += \" webix_cal_day_with_event\";\n\n\t\treturn css;\n\t}\n}\n","/* eslint-disable indent */\n\nimport { JetView } from \"webix-jet\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { daysBetweenInclusive } from \"helpers/dates\";\nimport { marker, dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\nimport { initDnD } from \"helpers/dnd\";\n\nexport default class MoreWindowView extends JetView {\n\tconstructor(app, name, c) {\n\t\tsuper(app, name);\n\t\tthis.Events = c.events;\n\t}\n\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn {\n\t\t\tview: \"popup\",\n\t\t\twidth: 266,\n\t\t\tpadding: 8,\n\t\t\tminHeight: 70,\n\t\t\trelative: \"right\",\n\t\t\tbody: {\n\t\t\t\tview: \"list\",\n\t\t\t\tcss: \"webix_scheduler_more_list\",\n\t\t\t\tborderless: true,\n\t\t\t\tautoheight: true,\n\t\t\t\tyCount: 3,\n\t\t\t\ttooltip: {\n\t\t\t\t\ttemplate: \"\",\n\t\t\t\t},\n\t\t\t\tonClick: {\n\t\t\t\t\twebix_scheduler_month_event: (e, id) => this.ShowEvent(id),\n\t\t\t\t\twebix_scheduler_month_event_single: (e, id) => this.ShowEvent(id),\n\t\t\t\t},\n\t\t\t\ttype: {\n\t\t\t\t\theight: 56,\n\t\t\t\t\ttemplate: (o, c) => this.MoreTemplate(o, c, _),\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.Win = view;\n\n\t\tEditRecurringMixin(this);\n\n\t\tinitDnD.call(this, view.getBody(), \"more\", true);\n\t}\n\n\tMoreTemplate(obj, _c, _) {\n\t\tconst i18n = webix.i18n;\n\t\tconst single = !daysBetweenInclusive(obj.start_date, obj.end_date);\n\t\tconst style = single ? \"\" : dayEventColor(obj);\n\n\t\treturn `\n\t\t\t<div\n\t\t\t\tclass=\"webix_scheduler_month_event${single ? \"_single\" : \"\"}\"\n\t\t\t\tstyle=\"${style}\"\n\t\t\t>\n\t\t\t\t${single ? marker(obj) : \"\"}\n\t\t\t\t<div webix_tooltip=\"${obj.text}\" class=\"webix_event_text\">${obj.text ||\n\t\t\t_(\"(No title)\")}</div>\n\t\t\t\t<div class=\"webix_event_time\">\n\t\t\t\t\t${this.DayFormatStr(obj.start_date)}\n\t\t\t\t\t${i18n.timeFormatStr(obj.start_date)} -\n\t\t\t\t\t${single ? \"\" : \" \" + this.DayFormatStr(obj.end_date)}\n\t\t\t\t\t${i18n.timeFormatStr(obj.end_date)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tDayFormatStr(date) {\n\t\treturn webix.Date.dateToStr(\"%F %j\")(date);\n\t}\n\n\tShowEvent(id) {\n\t\tconst obj = this.Events.getItem(id);\n\t\tthis.app.getState().selected = getParams(obj);\n\t}\n\n\tShowWindow(id, node, data) {\n\t\tif (this.ID === id && this.Win.isVisible()) return this.Win.hide();\n\n\t\tthis.ID = id;\n\t\tdata = data.map(v => this.Events.getItem(v));\n\n\t\tconst list = this.Win.getBody();\n\t\tlist.clearAll();\n\t\tlist.parse(data);\n\n\t\tthis.Win.show(node);\n\t}\n\n\tHideWindow() {\n\t\tthis.Win.hide();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport MoreWindowView from \"./more\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { marker, dayEventColor, templateStart } from \"helpers/templates\";\nimport { initDnD, locateEvent } from \"helpers/dnd\";\nimport { daysBetweenInclusive, isToday } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MonthEventsView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"dataview\",\n\t\t\tcss: \"webix_scheduler_calendar\",\n\t\t\tprerender: true,\n\t\t\txCount: 7,\n\t\t\tyCount: 5,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tscroll: false,\n\t\t\ttooltip: {\n\t\t\t\ttemplate: \"\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_cal_date: (_ev, id) => this.ShowDay(id),\n\t\t\t\twebix_scheduler_month_event: ev => this.ShowEvent(ev),\n\t\t\t\twebix_scheduler_month_event_single: ev => this.ShowEvent(ev),\n\t\t\t\twebix_scheduler_more: (_ev, id) => this.ShowMore(id),\n\t\t\t},\n\t\t\tonDblClick: {\n\t\t\t\twebix_cal_day: (_e, id) => this.ShowNew(id),\n\t\t\t},\n\t\t\ttype: {\n\t\t\t\theight: \"auto\",\n\t\t\t\twidth: \"auto\",\n\t\t\t\ttemplate: (o, c) => this.CalendarTemplate(o, c),\n\t\t\t\ttemplateStart,\n\t\t\t\theaderHeight: 32,\n\t\t\t\teventHeight: 28,\n\t\t\t\tpadding: 8,\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.State = this.app.getState();\n\t\tthis.Calendar = view;\n\t\tview.type.master = this.Calendar;\n\n\t\tSelectionMixin(this, \"month\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.Events = new webix.DataCollection({});\n\t\tthis.MoreWindow = this.ui(\n\t\t\tnew (this.app.dynamic(MoreWindowView))(this.app, \"\", {\n\t\t\t\tevents: this.Events,\n\t\t\t})\n\t\t);\n\n\t\tview.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.Calendar, \"month\");\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) this.RefreshData();\n\t}\n\n\tCalendarTemplate(obj) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tlet html = `<span class=\"webix_cal_date\">${obj.date.getDate()}</span>`;\n\t\tif (obj.$more && obj.$more.length) {\n\t\t\thtml += `<div class=\"webix_scheduler_more\">${obj.$more.length} ${_(\n\t\t\t\t\"more\"\n\t\t\t)}</div>`;\n\t\t}\n\t\treturn html;\n\t}\n\n\tGetDayCss(day, month) {\n\t\tlet css = \"webix_cal_day\";\n\t\tif (isToday(day)) css += \" webix_cal_today\";\n\t\tif (day.getMonth() != month) css += \" webix_cal_outside\";\n\t\telse css += \" \" + (webix.Date.isHoliday(day) || \"\");\n\t\treturn css;\n\t}\n\n\tGetMonthData() {\n\t\tconst data = [];\n\t\tconst { start, weeks } = this.data;\n\t\tconst month = webix.Date.add(start, 1, \"week\", true).getMonth();\n\n\t\tlet day = webix.Date.copy(start);\n\t\tfor (let i = 0; i < weeks * 7; i++) {\n\t\t\tconst obj = {\n\t\t\t\tdate: webix.Date.copy(day),\n\t\t\t\t$css: this.GetDayCss(day, month),\n\t\t\t};\n\n\t\t\tif ((i + 1) % 7 === 0) obj.right = true;\n\t\t\tif (i >= (weeks - 1) * 7) obj.bottom = true;\n\n\t\t\tdata.push(obj);\n\t\t\twebix.Date.add(day, 1, \"day\");\n\t\t}\n\t\treturn data;\n\t}\n\n\tRenderEvents() {\n\t\t// No Events, No Render\n\t\tif (!this.Events.count() || !this.Calendar.count()) return;\n\n\t\tconst container = webix.html.create(\"div\", {\n\t\t\trole: \"presentation\",\n\t\t\tclass: \"webix_scheduler_month_events\",\n\t\t});\n\n\t\tconst { start } = this.data;\n\t\tconst type = this.Calendar.type;\n\t\tconst maxLines = Math.floor(\n\t\t\t(type.height - type.headerHeight + type.padding - 2) /\n\t\t\t\t(type.eventHeight + type.padding)\n\t\t);\n\n\t\tlet wStart = webix.Date.copy(start);\n\t\tlet wEnd = webix.Date.add(wStart, 1, \"week\", true);\n\n\t\tlet html = \"\";\n\t\tlet cache = {};\n\t\tconst me = this.Calendar.getItem(this.Calendar.getLastId()).date;\n\t\tconst ms = this.Calendar.getItem(this.Calendar.getFirstId()).date;\n\t\tthis.Calendar.data.each(function(day, dayIndex) {\n\t\t\t// next week\n\t\t\tif (day.date >= wEnd) {\n\t\t\t\tcache = {};\n\t\t\t\twStart = wEnd;\n\t\t\t\twEnd = webix.Date.add(wStart, 1, \"week\", true);\n\t\t\t}\n\n\t\t\tconst more = [];\n\t\t\tconst dayHTML = [];\n\t\t\tthis.Events.data.each(function(ev) {\n\t\t\t\tconst id = ev.id;\n\n\t\t\t\t// will not be this week\n\t\t\t\tif (\n\t\t\t\t\tev.start_date >= wEnd ||\n\t\t\t\t\tev.end_date < wStart ||\n\t\t\t\t\t(!ev.all_day && webix.Date.equal(ev.end_date, wStart))\n\t\t\t\t)\n\t\t\t\t\treturn;\n\n\t\t\t\t// if already processed - check and skip\n\t\t\t\tif (!webix.isUndefined(cache[id])) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(day.date <= ev.end_date && ev.all_day) ||\n\t\t\t\t\t\tday.date < ev.end_date\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (cache[id] >= maxLines) {\n\t\t\t\t\t\t\tmore.push(id);\n\t\t\t\t\t\t} else dayHTML[cache[id]] = \"\";\n\t\t\t\t\t} else delete cache[id];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// today\n\t\t\t\tif (\n\t\t\t\t\tev.start_date < webix.Date.add(day.date, 1, \"day\", true) &&\n\t\t\t\t\tev.end_date >= day.date\n\t\t\t\t) {\n\t\t\t\t\tlet index = 0;\n\t\t\t\t\t// search for the first available index\n\t\t\t\t\twhile (!webix.isUndefined(dayHTML[index])) index++;\n\n\t\t\t\t\tcache[id] = index;\n\t\t\t\t\tif (index >= maxLines) return more.push(id);\n\n\t\t\t\t\tconst config = { ms, me };\n\t\t\t\t\tconfig.single = !daysBetweenInclusive(\n\t\t\t\t\t\tev.start_date,\n\t\t\t\t\t\tev.all_day\n\t\t\t\t\t\t\t? webix.Date.add(ev.end_date, 1, \"day\", true)\n\t\t\t\t\t\t\t: ev.end_date\n\t\t\t\t\t);\n\n\t\t\t\t\tconfig.length = 1;\n\t\t\t\t\tif (!config.single) {\n\t\t\t\t\t\tconfig.es = ev.start_date;\n\t\t\t\t\t\tconfig.ee =\n\t\t\t\t\t\t\t!ev.all_day && !webix.Date.timePart(ev.end_date)\n\t\t\t\t\t\t\t\t? webix.Date.add(ev.end_date, -1, \"day\", true)\n\t\t\t\t\t\t\t\t: ev.end_date;\n\n\t\t\t\t\t\tconfig.length += daysBetweenInclusive(\n\t\t\t\t\t\t\t(config.ls = new Date(Math.max(wStart, config.es))),\n\t\t\t\t\t\t\t(config.le = new Date(Math.min(wEnd - 1, config.ee)))\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tconfig.index = dayIndex;\n\t\t\t\t\tdayHTML[index] = this.ToHTML(ev, index, config);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tconst prevLength = day.$more && day.$more.length;\n\t\t\tday.$more = more;\n\t\t\tif (prevLength != more.length) this.Calendar.render(day.id, day, \"paint\");\n\n\t\t\thtml += dayHTML.join(\"\");\n\t\t}, this);\n\n\t\tcontainer.innerHTML = html;\n\t\tthis._DataObj = this.Calendar.$view.firstChild.appendChild(container);\n\t}\n\n\tToHTML(obj, index, c) {\n\t\tconst type = this.Calendar.type;\n\t\tconst style = c.single ? \"\" : dayEventColor(obj);\n\t\tconst width = c.length * type.width - type.padding;\n\t\tconst height = type.eventHeight;\n\t\tconst pos = this.GetPosition(type, index, c.index);\n\n\t\tlet extra = \"\";\n\t\tif (c.single) {\n\t\t\textra =\n\t\t\t\tmarker(obj) +\n\t\t\t\t`<span class=\"webix_event_time\">${webix.i18n.timeFormatStr(\n\t\t\t\t\tobj.start_date\n\t\t\t\t)}</span>`;\n\t\t}\n\t\tconst css = this.GetStyle(obj, c);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\twebix_tooltip=\"${obj.text}\"\n\t\t\t\twebix_e_id=\"${obj.id}\"\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"height:${height}px;line-height:${height}px; width:${width}px; ${pos +\n\t\t\tstyle}\">\n\t\t\t\t\t${extra + (obj.text || _(\"(No title)\"))}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj, c) {\n\t\tlet css = `webix_scheduler_month_event${c.single ? \"_single\" : \"\"}`;\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (!c.single) {\n\t\t\tif (c.es < c.ms && webix.Date.equal(c.ms, webix.Date.dayStart(c.ls)))\n\t\t\t\tcss += \" webix_scheduler_event_break_left\";\n\t\t\telse if (\n\t\t\t\tc.ee >= webix.Date.add(c.me, 1, \"day\", true) &&\n\t\t\t\twebix.Date.equal(c.me, webix.Date.dayStart(c.le))\n\t\t\t)\n\t\t\t\tcss += \" webix_scheduler_event_break_right\";\n\t\t}\n\t\treturn css;\n\t}\n\n\tGetPosition(type, index, dayIndex) {\n\t\tconst row = Math.floor(dayIndex / this.Calendar.config.xCount);\n\t\tconst col = dayIndex % this.Calendar.config.xCount;\n\n\t\treturn `\n\t\t\ttop:${row * type.height +\n\t\t\t\ttype.headerHeight +\n\t\t\t\tindex * (type.eventHeight + type.padding)}px;\n\t\t\tleft:${col * type.width}px;\n\t\t`;\n\t}\n\n\tRefreshData() {\n\t\tconst { data, weeks } = this.data;\n\n\t\tthis.Events.clearAll();\n\t\tthis.Events.parse(data);\n\t\tthis.Events.sort(function(a, b) {\n\t\t\tconst start_a = webix.Date.dayStart(a.start_date);\n\t\t\tconst start_b = webix.Date.dayStart(b.start_date);\n\n\t\t\tif (webix.Date.equal(start_a, start_b)) {\n\t\t\t\tconst days_a = daysBetweenInclusive(a.start_date, a.end_date);\n\t\t\t\tconst days_b = daysBetweenInclusive(b.start_date, b.end_date);\n\t\t\t\treturn days_b - days_a || a.start_date - b.start_date;\n\t\t\t}\n\t\t\treturn start_a - start_b;\n\t\t});\n\n\t\tconst monthData = this.GetMonthData();\n\n\t\tthis.Calendar.clearAll();\n\t\tif (this.Calendar.config.yCount != weeks) {\n\t\t\tthis.Calendar.define(\"yCount\", weeks);\n\t\t\tthis.Calendar.resize();\n\t\t}\n\t\tthis.Calendar.parse(monthData);\n\t}\n\n\tShowMore(id) {\n\t\tthis.MoreWindow.ShowWindow(\n\t\t\tid,\n\t\t\tthis.Calendar.getItemNode(id),\n\t\t\tthis.Calendar.getItem(id).$more || []\n\t\t);\n\t\treturn false;\n\t}\n\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.Calendar.$view);\n\t\tif (event.id && event.id != \"0\") {\n\t\t\tconst obj = this.Events.getItem(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tShowNew(id) {\n\t\tconst date = this.Calendar.getItem(id).date;\n\t\tthis.State.selected = { id: \"0\", date };\n\t}\n\n\tShowDay(id) {\n\t\tconst state = this.app.getState();\n\n\t\tstate.$batch({\n\t\t\tdate: this.Calendar.getItem(id).date,\n\t\t\tmode: \"day\",\n\t\t});\n\n\t\treturn false;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { templateStart } from \"helpers/templates\";\n\nexport default class MonthHeaderView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"dataview\",\n\t\t\tcss: \"webix_scheduler_calendar_header\",\n\t\t\txCount: 7,\n\t\t\tyCount: 1,\n\t\t\twidth: 0,\n\t\t\theight: 32,\n\t\t\tscroll: false,\n\t\t\ttype: {\n\t\t\t\theight: \"auto\",\n\t\t\t\twidth: \"auto\",\n\t\t\t\ttemplateStart,\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tview.type.master = view;\n\t\tview.parse(this.GetHeaderData());\n\t}\n\n\tGetHeaderData() {\n\t\tconst data = [];\n\t\tconst k = webix.Date.startOnMonday ? 1 : 0;\n\n\t\tfor (let i = 0; i < 7; i++)\n\t\t\tdata.push({ value: webix.i18n.calendar.dayShort[(k + i) % 7] });\n\n\t\tdata[data.length - 1][\"right\"] = true;\n\t\treturn data;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { events, timeStart } from \"helpers/templates\";\nimport { shrinkTo, isMultiDay } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MonthListView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst config = {\n\t\t\tview: \"list\",\n\t\t\ttype: {\n\t\t\t\theight: 50,\n\t\t\t\ttemplate: events(_),\n\t\t\t\ttimeStart: ev => this.TimeStart(ev),\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.ShowEvent(id),\n\t\t\t},\n\t\t};\n\n\t\treturn config;\n\t}\n\tinit() {\n\t\tthis.List = this.getRoot();\n\t\tthis.State = this.app.getState();\n\n\t\twebix.extend(this.List, webix.OverlayBox);\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) this.RefreshData();\n\t}\n\n\tRefreshData() {\n\t\tconst start = webix.Date.datePart(this.State.date, true);\n\t\tconst end = webix.Date.add(start, 1, \"day\", true);\n\t\tthis.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(start, end)\n\t\t\t.then(evs => {\n\t\t\t\tthis.List.clearAll();\n\t\t\t\tthis.List.parse(evs.map(shrinkTo(start, end)));\n\t\t\t\tthis.ToggleOverlay();\n\t\t\t});\n\t}\n\n\tToggleOverlay() {\n\t\tif (!this.List.count()) {\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.List.showOverlay(_(\"No Events\"));\n\t\t} else {\n\t\t\tthis.List.hideOverlay();\n\t\t}\n\t}\n\n\tShowEvent(id) {\n\t\tconst obj = this.List.getItem(id);\n\t\tthis.State.selected = getParams(obj);\n\t}\n\n\tTimeStart(ev) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (isMultiDay(ev)) return _(\"All Day\");\n\t\telse return timeStart(ev.start_date, ev.end_date);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport MonthListView from \"./list\";\nimport CalendarView from \"./compact\";\nimport MonthEventsView from \"./events\";\nimport MonthHeaderView from \"./header\";\n\nexport default class MonthView extends JetView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst views = compact\n\t\t\t? [CalendarView, MonthListView]\n\t\t\t: [MonthHeaderView, MonthEventsView];\n\n\t\treturn {\n\t\t\trows: views,\n\t\t};\n\t}\n\tinit() {\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tconst state = this.app.getState();\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\t}\n\tRefreshData(value) {\n\t\tlet start = webix.Date.monthStart(value);\n\t\tlet end = webix.Date.add(start, 1, \"month\", true);\n\n\t\tstart = webix.Date.weekStart(\n\t\t\tnew Date(start.getFullYear(), start.getMonth(), 1)\n\t\t);\n\t\tconst weeks = Math.ceil((end - start) / (24 * 60 * 60 * 1000) / 7);\n\t\tend = webix.Date.add(end, weeks, \"week\", true);\n\n\t\tthis.Data.getEvents(start, end).then(data => {\n\t\t\tif (this.app) this.setParam(\"data\", { start, weeks, data }, true);\n\t\t});\n\t}\n}\n","import UnitListView from \"../common/unitlist\";\nimport { isToday } from \"helpers/dates\";\n\nexport default class WeekEventsView extends UnitListView {\n\tconfig() {\n\t\tconst ui = super.config();\n\t\tui.css = \"webix_scheduler_week\";\n\t\tui.type.headerHeight = 28;\n\n\t\treturn ui;\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.List.clearAll();\n\t\t\tthis.List.parse(this.data.all);\n\t\t\tthis.ToggleOverlay();\n\t\t}\n\t}\n\n\tTemplateHeader(datestring) {\n\t\tconst date = new Date(datestring * 1);\n\t\tconst today = isToday(date);\n\n\t\tconst fstring = `%l, %F <span class='webix_scheduler_monthday${\n\t\t\ttoday ? \" webix_scheduler_today\" : \"\"\n\t\t}'>%j</span>`;\n\n\t\treturn `<span class=\"webix_unit_header_inner\">${webix.Date.dateToStr(\n\t\t\tfstring\n\t\t)(date)}</span>`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { isToday } from \"helpers/dates\";\n\nexport default class WeekHeaderView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\tcols: [\n\t\t\t\t{ borderless: false, width: 51 },\n\t\t\t\t{\n\t\t\t\t\tview: \"dataview\",\n\t\t\t\t\tlocalId: \"header\",\n\t\t\t\t\tcss: \"webix_scheduler_day_header\",\n\t\t\t\t\txCount: 7,\n\t\t\t\t\tyCount: 1,\n\t\t\t\t\twidth: 0,\n\t\t\t\t\theight: 32,\n\t\t\t\t\tscroll: false,\n\t\t\t\t\ttype: {\n\t\t\t\t\t\theight: \"auto\",\n\t\t\t\t\t\twidth: \"auto\",\n\t\t\t\t\t},\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\treturn `<span class=\"webix_scheduler_weekday\">${obj.day}</span> <span class=\"webix_scheduler_monthday\">${obj.date}</span>`;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.RefreshData();\n\t\t}\n\t}\n\n\tRefreshData() {\n\t\tlet start = this.data.start;\n\t\tconst data = [];\n\t\twhile (start < this.data.end) {\n\t\t\tconst obj = {\n\t\t\t\tday: webix.i18n.calendar.dayShort[start.getDay()],\n\t\t\t\tdate: start.getDate(),\n\t\t\t};\n\t\t\tif (isToday(start)) {\n\t\t\t\tobj.$css = \"webix_scheduler_list_today\";\n\t\t\t}\n\t\t\tdata.push(obj);\n\t\t\tstart = webix.Date.add(start, 1, \"day\", true);\n\t\t}\n\n\t\tconst header = this.$$(\"header\");\n\t\theader.clearAll();\n\t\theader.parse(data);\n\t}\n}\n","import MultiMoreView from \"../common/multimore\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { initDnD, locateEvent } from \"helpers/dnd\";\nimport { daysBetweenInclusive } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MultiDayEventsView extends MultiMoreView {\n\tconfig() {\n\t\tconst ui = super.config();\n\n\t\tui.cols[1] = {\n\t\t\tview: \"dataview\",\n\t\t\tlocalId: \"multiDayList\",\n\t\t\tcss: \"webix_scheduler_multidays\",\n\t\t\tscroll: false,\n\t\t\theight: 32,\n\t\t\txCount: 7,\n\t\t\tyCount: 1,\n\t\t\twidth: 0,\n\t\t\ttype: {\n\t\t\t\twidth: \"auto\",\n\t\t\t\theight: \"auto\",\n\t\t\t\titemHeight: 32,\n\t\t\t},\n\t\t\ttemplate: \"\",\n\t\t\ttooltip: {\n\t\t\t\ttemplate: \"\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_multiday_event: e => this.ShowEvent(e),\n\t\t\t},\n\t\t};\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tsuper.init();\n\n\t\tSelectionMixin(this, \"multi\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.Events = new webix.DataCollection({});\n\n\t\tthis.List.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.List, \"multiday\");\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.ParseDays(this.data.multi);\n\t\t}\n\t}\n\n\tParseDays(events) {\n\t\tif (!events.length) return;\n\n\t\tthis.Events.clearAll();\n\t\tthis.Events.parse(events);\n\n\t\tconst days = [];\n\t\tfor (let d = 0; d < 7; d++) {\n\t\t\tdays.push({\n\t\t\t\tid: d + 1,\n\t\t\t\tdate: webix.Date.add(this.data.start, d, \"day\", true),\n\t\t\t});\n\t\t}\n\t\tthis.BreakEventsByDay(days);\n\n\t\tthis.SetMoreIcon(\n\t\t\tthis._maxEvents > this.maxVisibleLines ? this._expandState : null\n\t\t);\n\n\t\tthis.List.blockEvent();\n\t\tthis.List.parse(days);\n\t\tthis.ResetListHeight();\n\t\tthis.List.unblockEvent();\n\n\t\tthis.RenderEvents();\n\t}\n\n\tBreakEventsByDay(data) {\n\t\tthis.Days = [];\n\t\tconst processed = {};\n\t\tthis._maxEvents = 0;\n\n\t\tdata.forEach((day, dayIndex) => {\n\t\t\tconst today = day.date;\n\t\t\tthis.Days.push([]);\n\n\t\t\tthis.Events.data.each(ev => {\n\t\t\t\tif (!webix.isUndefined(processed[ev.id])) {\n\t\t\t\t\tif ((today <= ev.end_date && ev.all_day) || today < ev.end_date) {\n\t\t\t\t\t\tthis.Days[dayIndex][processed[ev.id]] = \"\";\n\t\t\t\t\t} else delete processed[ev.id];\n\t\t\t\t} else if (\n\t\t\t\t\tev.start_date < webix.Date.add(today, 1, \"day\", true) &&\n\t\t\t\t\tev.end_date >= today\n\t\t\t\t) {\n\t\t\t\t\tlet index = 0;\n\t\t\t\t\t// search for the first available index\n\t\t\t\t\twhile (!webix.isUndefined(this.Days[dayIndex][index])) index++;\n\n\t\t\t\t\tprocessed[ev.id] = index;\n\n\t\t\t\t\tconst config = {};\n\t\t\t\t\tconfig.es = ev.start_date;\n\t\t\t\t\tconfig.ee =\n\t\t\t\t\t\t!ev.all_day && !webix.Date.timePart(ev.end_date)\n\t\t\t\t\t\t\t? webix.Date.add(ev.end_date, -1, \"day\", true)\n\t\t\t\t\t\t\t: ev.end_date;\n\n\t\t\t\t\tconfig.length =\n\t\t\t\t\t\t1 +\n\t\t\t\t\t\tdaysBetweenInclusive(\n\t\t\t\t\t\t\t(config.ls = new Date(Math.max(this.data.start, config.es))),\n\t\t\t\t\t\t\t(config.le = new Date(Math.min(this.data.end - 1, config.ee)))\n\t\t\t\t\t\t);\n\n\t\t\t\t\tev.$config = config;\n\t\t\t\t\tthis.Days[dayIndex][index] = ev;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.Days[dayIndex].length > this._maxEvents)\n\t\t\t\tthis._maxEvents = this.Days[dayIndex].length;\n\t\t});\n\t}\n\n\tRenderEvents() {\n\t\tconst allEvents = this.Events.count();\n\n\t\tif (!allEvents) return;\n\n\t\tconst container = webix.html.create(\"div\", {\n\t\t\trole: \"presentation\",\n\t\t});\n\n\t\tlet html = \"\";\n\t\tlet renderedEvents = 0;\n\t\tconst toHide =\n\t\t\tthis._expandState === \"down\" && this._maxEvents > this.maxVisibleLines;\n\n\t\tthis.List.data.each((_day, dayIndex) => {\n\t\t\tconst dayHTML = [];\n\t\t\tconst visible = toHide\n\t\t\t\t? this.maxVisibleLines - 1\n\t\t\t\t: this.Days[dayIndex].length;\n\n\t\t\tfor (let i = 0; i < visible; ++i) {\n\t\t\t\tdayHTML[i] = this.Days[dayIndex][i];\n\n\t\t\t\tif (dayHTML[i]) {\n\t\t\t\t\tdayHTML[i] = this.ToHTML(dayHTML[i], dayIndex, i);\n\t\t\t\t\trenderedEvents++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thtml += dayHTML.join(\"\");\n\t\t});\n\n\t\tif (toHide) {\n\t\t\thtml += this.MoreOption(allEvents - renderedEvents);\n\t\t}\n\n\t\tcontainer.innerHTML = html;\n\t\tthis._DataObj = this.List.$view.firstChild.appendChild(container);\n\t}\n\n\tToHTML(obj, cIndex, rIndex) {\n\t\tconst style = dayEventColor(obj);\n\t\tconst size = this.GetSizePosition(obj.$config.length, cIndex, rIndex);\n\t\tconst css = this.GetStyle(obj, obj.$config);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\twebix_tooltip=\"${obj.text || _(\"(No title)\")}\"\n\t\t\t\twebix_e_id=\"${obj.id}\"\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"${size} ${style}\">\n\t\t\t\t\t${obj.text || _(\"(No title)\")}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj, c) {\n\t\tconst { start, end } = this.data;\n\t\tlet css = \"webix_scheduler_multiday_event\";\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (c.es < start && webix.Date.equal(start, webix.Date.dayStart(c.ls)))\n\t\t\tcss += \" webix_scheduler_event_break_left\";\n\t\tif (\n\t\t\tc.ee >= end &&\n\t\t\twebix.Date.equal(\n\t\t\t\twebix.Date.add(end, -1, \"day\", true),\n\t\t\t\twebix.Date.dayStart(c.le)\n\t\t\t)\n\t\t)\n\t\t\tcss += \" webix_scheduler_event_break_right\";\n\n\t\treturn css;\n\t}\n\n\tMoreOption(excess) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst size = this.GetSizePosition(\n\t\t\tthis.List.config.xCount,\n\t\t\t0,\n\t\t\tthis.maxVisibleLines - 1\n\t\t);\n\n\t\treturn `<div webix_e_id=\"$wsh_multi_more\" class=\"webix_scheduler_multiday_event webix_scheduler_multi_more\" style=\"${size}\">${excess} ${_(\n\t\t\t\"more\"\n\t\t)}</div>`;\n\t}\n\n\tGetSizePosition(length, cIndex, rIndex) {\n\t\t// numbers are for space between events and borders of component\n\t\tconst width = length * this.List.type.width - 4;\n\t\tconst height = this.List.type.itemHeight - 4;\n\t\tconst left = this.List.type.width * cIndex + 1;\n\t\tconst top = rIndex * this.List.type.itemHeight + 1;\n\n\t\treturn `width:${width}px; height:${height}px; line-height:${height}px; left:${left}px; top:${top}px;`;\n\t}\n\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.List.$view);\n\t\tif (event.id) {\n\t\t\tif (event.id === \"$wsh_multi_more\") return this.ExpandData();\n\n\t\t\tconst obj = this.Events.getItem(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tExpandData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\n\t\t\tthis._expandState = \"up\";\n\t\t\tthis.Animate(\"up\");\n\n\t\t\tthis.ResetListHeight(this._maxEvents);\n\t\t}\n\t}\n\n\tWrapData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\t\t\tthis._expandState = \"down\";\n\n\t\t\tconst height =\n\t\t\t\tthis.List.$height -\n\t\t\t\t(this._maxEvents - this.maxVisibleLines) * this.List.type.height;\n\t\t\tthis.Animate(\"down\", height, () => {\n\t\t\t\tthis.ResetListHeight(this.maxVisibleLines);\n\t\t\t});\n\t\t}\n\t}\n\n\tResetListHeight(count) {\n\t\tif (!count)\n\t\t\tcount =\n\t\t\t\tthis._expandState === \"down\"\n\t\t\t\t\t? Math.min(this._maxEvents, this.maxVisibleLines)\n\t\t\t\t\t: this._maxEvents;\n\n\t\tconst height = count * this.List.type.itemHeight;\n\t\tif (this.List.type.height !== height) {\n\t\t\tthis.List.type.height = height;\n\t\t\tthis.List.define(\"height\", height);\n\t\t\tthis.List.resize();\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport DayEventsView from \"../day/events\";\nimport WeekHeaderView from \"./header\";\nimport WeekEventsView from \"./compact\";\nimport HourscaleView from \"../common/hourscale\";\nimport MultiDayEventsView from \"./multiday\";\n\nimport { isMultiDay } from \"helpers/dates\";\n\nexport default class WeekView extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tif (this.Compact) {\n\t\t\treturn {\n\t\t\t\trows: [WeekEventsView],\n\t\t\t};\n\t\t} else {\n\t\t\tconst days = {\n\t\t\t\tlocalId: \"scroll\",\n\t\t\t\tview: \"scrollview\",\n\t\t\t\tscroll: \"y\",\n\t\t\t\tcss: \"webix_scheduler_week_days\",\n\t\t\t\tbody: {\n\t\t\t\t\tcols: [HourscaleView],\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst weekLength = 7;\n\t\t\tfor (let i = 0; i < weekLength; ++i) {\n\t\t\t\tdays.body.cols.push(\n\t\t\t\t\tnew (this.app.dynamic(DayEventsView))(this.app, \"\", {\n\t\t\t\t\t\tday: i,\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\trows: [\n\t\t\t\t\tWeekHeaderView,\n\t\t\t\t\t{ localId: \"multi\", hidden: true, cols: [MultiDayEventsView] },\n\t\t\t\t\tdays,\n\t\t\t\t],\n\t\t\t};\n\t\t}\n\t}\n\tinit() {\n\t\tconst state = this.app.getState();\n\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\n\t\tif (!this.Compact) {\n\t\t\tthis.on(state.$changes, \"selected\", v => v && this.ScrollScale(v));\n\t\t}\n\t}\n\n\tRefreshData(date) {\n\t\tconst start = webix.Date.weekStart(date);\n\t\tconst end = webix.Date.add(start, 1, \"week\", true);\n\t\tthis.GetWeek(start, end).then(data => {\n\t\t\t// this.app will be null if compact trigger was called in main.js\n\t\t\tif (this.app) this.setParam(\"data\", data, true);\n\n\t\t\tif (data.multi.length) {\n\t\t\t\tthis.$$(\"multi\").show();\n\t\t\t} else this.$$(\"multi\").hide();\n\t\t});\n\t}\n\n\tGetWeek(start, end) {\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(start, end)\n\t\t\t.then(evs => {\n\t\t\t\tif (this.Compact) {\n\t\t\t\t\treturn { start, end, all: evs };\n\t\t\t\t}\n\n\t\t\t\tconst multi = [],\n\t\t\t\t\tsingle = [];\n\n\t\t\t\tevs.forEach(ev => {\n\t\t\t\t\tif (isMultiDay(ev)) {\n\t\t\t\t\t\tmulti.push(ev);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsingle.push(ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn { start, end, multi, single };\n\t\t\t});\n\t}\n\n\tScrollScale(v) {\n\t\tif (v.id === \"0\" && !v.date) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst y = (new Date().getHours() + 2) * 40;\n\t\t\t\tthis.$$(\"scroll\").scrollTo(0, y);\n\t\t\t}, 100);\n\t\t}\n\t}\n}\n","import m0 from \"views/bars/add\";\nimport m1 from \"views/bars/date\";\nimport m2 from \"views/bars/index.js\";\nimport m3 from \"views/bars/nav\";\nimport m4 from \"views/bars/navpopup\";\nimport m5 from \"views/event/actionmenu\";\nimport m6 from \"views/event/form\";\nimport m7 from \"views/event/formpopup\";\nimport m8 from \"views/event/info\";\nimport m9 from \"views/event/recurringform\";\nimport m10 from \"views/main\";\nimport m11 from \"views/modes/agenda/index.js\";\nimport m12 from \"views/modes/common/actionpopup\";\nimport m13 from \"views/modes/common/hourscale\";\nimport m14 from \"views/modes/common/multimore\";\nimport m15 from \"views/modes/common/unitlist\";\nimport m16 from \"views/modes/day/events\";\nimport m17 from \"views/modes/day/index.js\";\nimport m18 from \"views/modes/day/multiday\";\nimport m19 from \"views/modes/month/compact\";\nimport m20 from \"views/modes/month/events\";\nimport m21 from \"views/modes/month/header\";\nimport m22 from \"views/modes/month/index.js\";\nimport m23 from \"views/modes/month/list\";\nimport m24 from \"views/modes/month/more\";\nimport m25 from \"views/modes/week/compact\";\nimport m26 from \"views/modes/week/header\";\nimport m27 from \"views/modes/week/index.js\";\nimport m28 from \"views/modes/week/multiday\";\nimport m29 from \"views/side/editor\";\nimport m30 from \"views/side/index.js\";\nimport m31 from \"views/side/popup\";\nimport { JetView } from \"webix-jet\";\n\nconst views = { JetView };\nviews[\"bars/add\"] = m0;\nviews[\"bars/date\"] = m1;\nviews[\"bars\"] = m2;\nviews[\"bars/nav\"] = m3;\nviews[\"bars/navpopup\"] = m4;\nviews[\"event/actionmenu\"] = m5;\nviews[\"event/form\"] = m6;\nviews[\"event/formpopup\"] = m7;\nviews[\"event/info\"] = m8;\nviews[\"event/recurringform\"] = m9;\nviews[\"main\"] = m10;\nviews[\"modes/agenda\"] = m11;\nviews[\"modes/common/actionpopup\"] = m12;\nviews[\"modes/common/hourscale\"] = m13;\nviews[\"modes/common/multimore\"] = m14;\nviews[\"modes/common/unitlist\"] = m15;\nviews[\"modes/day/events\"] = m16;\nviews[\"modes/day\"] = m17;\nviews[\"modes/day/multiday\"] = m18;\nviews[\"modes/month/compact\"] = m19;\nviews[\"modes/month/events\"] = m20;\nviews[\"modes/month/header\"] = m21;\nviews[\"modes/month\"] = m22;\nviews[\"modes/month/list\"] = m23;\nviews[\"modes/month/more\"] = m24;\nviews[\"modes/week/compact\"] = m25;\nviews[\"modes/week/header\"] = m26;\nviews[\"modes/week\"] = m27;\nviews[\"modes/week/multiday\"] = m28;\nviews[\"side/editor\"] = m29;\nviews[\"side\"] = m30;\nviews[\"side/popup\"] = m31;\n\nexport default views;\n","import { parse } from \"helpers/ical\";\nimport { explodeEvent } from \"helpers/recurring\";\n\nexport default class LocalData {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t */\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.store = this.createEvents();\n\t\tthis.events_ready = null;\n\n\t\tif (app.config.calendars !== false) {\n\t\t\tthis.cals = this.createCalendars();\n\t\t\tthis.cals_ready = null;\n\t\t}\n\n\t\tconst utc = app.config.serverUTC; //load and save dates as UTC\n\t\tthis.strToDate = webix.Date.strToDate(webix.i18n.parseFormat, utc);\n\t\tthis.dateToStr = webix.Date.dateToStr(webix.i18n.parseFormat, utc);\n\t\tthis.dateToLocalStr = webix.Date.dateToStr(webix.i18n.parseFormat);\n\n\t\tthis.loaded_ranges = {}; //cached date bounds in dyn. mode\n\t}\n\t/**\n\t * Creates events collection\n\t * @returns {Object} events Data Collection\n\t */\n\tcreateEvents() {\n\t\treturn new webix.DataCollection({\n\t\t\tscheme: {\n\t\t\t\t$change: data => {\n\t\t\t\t\tif (typeof data.start_date === \"string\")\n\t\t\t\t\t\tdata.start_date = this.strToDate(data.start_date);\n\t\t\t\t\tif (typeof data.end_date === \"string\")\n\t\t\t\t\t\tdata.end_date = this.strToDate(data.end_date);\n\n\t\t\t\t\tif (this.app.config.recurring) {\n\t\t\t\t\t\tdata.$recurring = data.recurring ? parse(data.recurring) : null;\n\n\t\t\t\t\t\tif (typeof data.origin_id === \"string\" && !isNaN(data.origin_id)) {\n\t\t\t\t\t\t\tdata.origin_id *= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof data.all_day === \"string\") data.all_day *= 1;\n\n\t\t\t\t\tthis.getColor(data, this.cals && this.cals.getItem(data.calendar));\n\t\t\t\t},\n\t\t\t\t$serialize: data => this.eventOut(data),\n\t\t\t\t$export: data => this.eventOut(data),\n\t\t\t},\n\t\t});\n\t}\n\t/**\n\t * Loads events and populates events Data Collection\n\t * @param {boolean} sync - if true, Data Collection will be returned outside a promise\n\t * @param {boolean} force - if true, events will be reloaded\n\t * @returns {Promise} promise that resolves with events collection\n\t */\n\tevents(sync, force) {\n\t\tconst store = this.store;\n\t\tif (sync) return store;\n\n\t\treturn this.calendars().then(() => {\n\t\t\t//data will be filled by getEvents\n\t\t\tif (this.app.config.dynamic) {\n\t\t\t\tif (!this.events_ready)\n\t\t\t\t\tthis.events_ready = webix.promise.resolve(this.store);\n\t\t\t} else if (!this.events_ready || force) {\n\t\t\t\tthis.events_ready = this.app\n\t\t\t\t\t.getService(\"backend\")\n\t\t\t\t\t.events()\n\t\t\t\t\t.then(data => {\n\t\t\t\t\t\tstore.clearAll();\n\t\t\t\t\t\tstore.parse(data);\n\n\t\t\t\t\t\treturn store;\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.events_ready;\n\t\t});\n\t}\n\t/**\n\t * Gets or loads events for the stated date range\n\t * @param {Date} start - start date\n\t * @param {Date} end - end date\n\t * @returns {Promise} promise that resolves with events array\n\t */\n\tgetEvents(start, end) {\n\t\tconst mode = this.app.config.dynamic;\n\t\tlet evs;\n\n\t\tif (mode) {\n\t\t\tconst params = this.getParams(mode);\n\n\t\t\tif (params.then) {\n\t\t\t\t// loading now\n\t\t\t\tevs = params.then(() => {\n\t\t\t\t\treturn this.getLocal(start, end);\n\t\t\t\t});\n\t\t\t} else if (params === true) {\n\t\t\t\t//already loaded\n\t\t\t\tevs = this.getLocal(start, end);\n\t\t\t} else {\n\t\t\t\tevs = this.loaded_ranges[params.from] = this.getDynamic(params).then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\treturn this.getLocal(start, end);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tevs = this.getLocal(start, end);\n\t\t}\n\t\treturn evs;\n\t}\n\t/**\n\t * Finds already loaded events for the stated date range\n\t * @param {Date} start - start date\n\t * @param {Date} end - end date\n\t * @returns {Promise} promise that resolves with events array\n\t */\n\tgetLocal(start, end) {\n\t\treturn this.events().then(store => {\n\t\t\tconst config = this.app.config;\n\t\t\tconst active = this.app.getState().active;\n\t\t\tlet evs = [];\n\n\t\t\tstore.data.each(ev => {\n\t\t\t\tif (\n\t\t\t\t\t(!config.calendars || findCalendar(active, ev.calendar)) &&\n\t\t\t\t\tev.start_date < end &&\n\t\t\t\t\t(ev.end_date > start ||\n\t\t\t\t\t\t(ev.end_date >= start && ev.all_day) ||\n\t\t\t\t\t\t(ev.$recurring &&\n\t\t\t\t\t\t\t(!ev.$recurring.UNTIL || ev.$recurring.UNTIL > start)))\n\t\t\t\t) {\n\t\t\t\t\tif (this.app.config.recurring && ev.recurring) {\n\t\t\t\t\t\tevs = evs.concat(explodeEvent(start, end, ev));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete ev.recurring;\n\t\t\t\t\t\tevs.push(ev);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tev.start_date = this.roundTime(ev.start_date);\n\t\t\t\tev.end_date = this.roundTime(ev.end_date);\n\t\t\t});\n\n\t\t\tevs.sort(function(a, b) {\n\t\t\t\ta = a.start_date;\n\t\t\t\tb = b.start_date;\n\t\t\t\treturn a > b ? 1 : a < b ? -1 : 0;\n\t\t\t});\n\n\t\t\treturn evs;\n\t\t});\n\t}\n\t/**\n\t * Loads events portion\n\t * @param {Object} params - dynamic loading settings\n\t * @returns {Promise} promise that resolves with events array\n\t */\n\tgetDynamic(params) {\n\t\treturn this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.events(params)\n\t\t\t.then(data => {\n\t\t\t\tthis.store.parse(data);\n\t\t\t\tthis.loaded_ranges[params.from] = true;\n\n\t\t\t\treturn data;\n\t\t\t});\n\t}\n\t/**\n\t * Gets dynamic loading parameters\n\t * @param {string} mode - dynamic loading mode, \"day\", \"week\", \"month\" or \"year\"\n\t * @returns {Object} object with parameters\n\t */\n\tgetParams(mode) {\n\t\tconst state = this.app.getState();\n\t\tconst format = webix.i18n.parseFormatStr;\n\n\t\tconst from = webix.Date[mode + \"Start\"](state.date);\n\t\tconst fromStr = format(from);\n\n\t\tlet res;\n\n\t\tif (!this.loaded_ranges[fromStr]) {\n\t\t\tres = {\n\t\t\t\tfrom: fromStr,\n\t\t\t\tto: format(webix.Date.add(from, 1, mode, true)),\n\t\t\t};\n\t\t} else res = this.loaded_ranges[fromStr];\n\n\t\treturn res;\n\t}\n\t/**\n\t * Creates calendars collection\n\t * @returns {Object} calendars Data Collection\n\t */\n\tcreateCalendars() {\n\t\treturn new webix.DataCollection({\n\t\t\tscheme: {\n\t\t\t\t$sort: {\n\t\t\t\t\tdir: \"desc\",\n\t\t\t\t\tby: \"active\",\n\t\t\t\t\tas: sortCalendars,\n\t\t\t\t},\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonAfterDelete: () => this.setActive(),\n\t\t\t\tonAfterAdd: () => this.setActive(),\n\t\t\t\t\"data->onDataUpdate\": (id, data, old) => {\n\t\t\t\t\tif (old) {\n\t\t\t\t\t\tif (data.color !== old.color) {\n\t\t\t\t\t\t\tthis.store.data.each(obj => {\n\t\t\t\t\t\t\t\tif (obj.calendar == id) this.getColor(obj, data);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.app.callEvent(\"events:refresh\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.active !== old.active) {\n\t\t\t\t\t\t\tthis.setActive();\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tthis.cals.sort(\"#active#\", \"desc\", sortCalendars);\n\t\t\t\t\t\t\t}, 400);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\t/**\n\t * Loads calendars and populates calendars Data Collection\n\t * @param {boolean} sync - if true, Data Collection will be returned outside a promise\n\t * @param {boolean} force - if true, calendars will be reloaded\n\t * @returns {Promise} promise that resolves with calendars collection\n\t */\n\tcalendars(sync, force) {\n\t\tif (this.app.config.calendars == false) {\n\t\t\tif (sync) return false;\n\t\t\treturn webix.promise.resolve();\n\t\t}\n\n\t\tconst cals = this.cals;\n\t\tif (sync) return cals;\n\t\tif (this.cals_ready && !force) return this.cals_ready;\n\n\t\tthis.cals_ready = this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.calendars()\n\t\t\t.then(data => {\n\t\t\t\tcals.clearAll();\n\t\t\t\tcals.parse(data);\n\n\t\t\t\tthis.setActive();\n\n\t\t\t\treturn cals;\n\t\t\t});\n\n\t\treturn this.cals_ready;\n\t}\n\t/**\n\t * Processes event item before saving, serializing or exporting it\n\t * @param {Object} data - event item\n\t * @param {boolean} save - true, if called for saving operation\n\t * @returns {Object} events object\n\t */\n\teventOut(data, save) {\n\t\tdata = webix.copy(data);\n\n\t\t// export and serialize: there's no need to convert date to UTC\n\t\tconst format = save ? this.dateToStr : this.dateToLocalStr;\n\t\tif (data.start_date) data.start_date = format(data.start_date);\n\t\tif (data.end_date) data.end_date = format(data.end_date);\n\n\t\tif (!save) {\n\t\t\tdelete data.$recurring;\n\t\t\tdelete data.$textColor;\n\t\t\tdelete data.$color;\n\t\t}\n\n\t\treturn data;\n\t}\n\t/** Sets an array of active calendars IDs to app state */\n\tsetActive() {\n\t\tlet active = [];\n\t\tthis.cals.data.each(d => {\n\t\t\tif (d.active * 1) active.push(d.id);\n\t\t});\n\t\tthis.app.getState().active = active;\n\t}\n\t/**\n\t * Assigns colors to event item\n\t * @param {Object} data - event object\n\t * @param {Object} force - calendar object\n\t */\n\tgetColor(data, calendar) {\n\t\tdata.$color = calendar ? calendar.color : data.color || \"#01C2A5\"; //same for new event in form\n\t\tdata.$textColor = getContrastingColor(data.color || data.$color);\n\t}\n\t/**\n\t * Rounds time for start and end dates of event item to 5 minutes to match Webix Timepicker\n\t * @param {Date} date - Date object\n\t * @returns {Date} Date object with rounded minutes\n\t */\n\troundTime(date) {\n\t\tconst res = webix.Date.copy(date);\n\t\tres.setMinutes(Math.round(res.getMinutes() / 5) * 5);\n\t\treturn res;\n\t}\n\t/**\n\t * Checks if there are sub-events after the start date of the stated occurrence of a recurring event\n\t * @param {Object} event - event object\n\t * @returns {boolean} result of the check\n\t */\n\tisLastPart(event) {\n\t\tconst hasParts = this.store.find(\n\t\t\te =>\n\t\t\t\tevent.origin_id == e.origin_id &&\n\t\t\t\t(event.$id || event.id) != e.id && // in dnd events have $id, in info they do not\n\t\t\t\tevent.start_date < e.start_date,\n\t\t\ttrue\n\t\t);\n\t\treturn !hasParts;\n\t}\n}\n\n/**\n * Gets contrasting text color for the event backgrounf color\n * @param {string} color - background color\n * @returns {string} text color\n */\nfunction getContrastingColor(color) {\n\tconst rgb = webix.color.toRgb(color);\n\tconst brightness = Math.round(\n\t\t(rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000\n\t);\n\treturn brightness > 180 ? \"#475466\" : \"#ffffff\";\n}\n/**\n * Checks whether the stated calendar is active\n * @param {Array} arr - array of IDs of active calendars\n * @param {string|number} arr - ID of the searched calendar\n * @returns {boolean} result of the check\n */\nfunction findCalendar(arr, c) {\n\tfor (let i = 0; i < arr.length; ++i) {\n\t\tif (arr[i] == c) return true;\n\t}\n\treturn false;\n}\n/**\n * Compares active state of calendars\n * @param {string} a - value of the 'active' field\n * @param {string} b - value of the 'active' field\n * @returns {boolean} result of the comparison\n */\nfunction sortCalendars(a, b) {\n\treturn a * 1 > b * 1 ? 1 : -1;\n}\n","import {\n\tisFirstOccurrence,\n\tcutOccurrence,\n\tclipSequence,\n\tcorrectMode,\n} from \"../helpers/recurring\";\n\nexport default class Operations {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t */\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.Back = app.getService(\"backend\");\n\n\t\tconst local = (this.Local = app.getService(\"local\"));\n\t\tthis.Events = local.events(true);\n\t\tthis.Cals = local.calendars(true);\n\t\tthis.State = app.getState();\n\t}\n\t/**\n\t * Adds event\n\t * @param {Object} obj - object with event fields\n\t * @param {string} temp - ID of the temporary task\n\t * @returns {promise} promise that resolves with event id\n\t */\n\taddEvent(obj, temp) {\n\t\tconst tosave = this.Local.eventOut(obj, true);\n\t\treturn this.Back.addEvent(tosave).then(res => {\n\t\t\tif (temp) this.Events.remove(temp);\n\t\t\tobj.id = res.id;\n\t\t\treturn this.Events.add(obj);\n\t\t});\n\t}\n\t/**\n\t * Updates event\n\t * @param {string|number} id - event ID\n\t * @param {Object} obj - object with event fields\n\t * @param {string} mode - update mode: \"unite\" or \"next\"\n\t * @returns {promise} promise\n\t */\n\tupdateEvent(id, obj, mode, date) {\n\t\tconst tosave = this.Local.eventOut(obj, true);\n\t\treturn this.Back.updateEvent(id, tosave, mode, date).then(() => {\n\t\t\tthis.Events.updateItem(id, obj);\n\n\t\t\tif (mode === \"all\") {\n\t\t\t\tconst parts = this.Events.find(e => e.origin_id == id).map(e => e.id);\n\t\t\t\tthis.Events.remove(parts);\n\t\t\t} else if (mode === \"next\" && date) {\n\t\t\t\t// in case update came for a sub-event, find master\n\t\t\t\tconst cev = this.Events.getItem(id);\n\t\t\t\tif (cev.origin_id) id = cev.origin_id;\n\n\t\t\t\tconst parts = this.Events.find(\n\t\t\t\t\te => e.origin_id == id && e.start_date >= date\n\t\t\t\t).map(e => e.id);\n\t\t\t\tthis.Events.remove(parts);\n\t\t\t}\n\t\t});\n\t}\n\t/**\n\t * Removes event\n\t * @param {string} mode - edit mode: \"this\", \"next\" or \"all\"\n\t * @param {Object} obj - object with event fields\n\t * @param {number} date_id - ID of event occurrence, for custom calls\n\t * @returns {promise} promise\n\t */\n\tremoveEvent(mode, obj, date_id) {\n\t\tlet id = this.State.selected ? this.State.selected.id : obj.$id || obj.id;\n\n\t\t// non-recurring and special cases of recurring\n\t\tconst isFirst = mode ? isFirstOccurrence(date_id, obj.start_date) : false;\n\t\tif (mode === \"next\" && isFirst) {\n\t\t\tmode = correctMode.call(this, obj, mode);\n\t\t}\n\n\t\tif (\n\t\t\t!mode ||\n\t\t\tmode === \"all\" ||\n\t\t\t(mode === \"this\" && !date_id) ||\n\t\t\t(mode === \"next\" && obj.origin_id && isFirst)\n\t\t) {\n\t\t\tif (mode === \"all\" && obj.origin_id) id = obj.origin_id;\n\n\t\t\tthis.Back.removeEvent(id).then(() => {\n\t\t\t\tthis.Events.remove(id);\n\n\t\t\t\tconst parts = this.Events.find(e => e.origin_id == id).map(e => e.id);\n\t\t\t\tthis.Events.remove(parts);\n\t\t\t});\n\t\t} else {\n\t\t\t// recurring events...\n\t\t\tif (mode === \"this\" || mode === \"next\") {\n\t\t\t\tif (!date_id) {\n\t\t\t\t\tid = obj.origin_id;\n\t\t\t\t\tobj = this.Events.getItem(id);\n\t\t\t\t}\n\n\t\t\t\tconst date = webix.Date.dayStart(\n\t\t\t\t\tdate_id ? new Date(date_id.split(\"_\")[0] * 1) : obj.start_date\n\t\t\t\t);\n\t\t\t\tconst recurring =\n\t\t\t\t\tmode === \"this\" ? cutOccurrence(date, obj) : clipSequence(date, obj);\n\n\t\t\t\t// [fixme] if all occ-s were removed, remove the whole event instead of update\n\t\t\t\t// or do this in PUT on backend - otherwise an 'empty' 'all' event will hang in db, unavailable for calendar\n\n\t\t\t\tthis.updateEvent(id, { recurring }, mode, date);\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Adds calendar\n\t * @param {Object} obj - object with calendar fields\n\t * @returns {promise} promise that resolves with calendar id\n\t */\n\taddCalendar(obj) {\n\t\tif (!obj) obj = { text: \"\", color: \"#997CEB\", active: 1 };\n\n\t\treturn this.Back.addCalendar(obj).then(res => {\n\t\t\tobj.id = res.id;\n\t\t\tthis.Cals.add(obj, 0);\n\t\t\treturn obj.id;\n\t\t});\n\t}\n\t/**\n\t * Updates calendar\n\t * @param {string|number} id - calendar ID\n\t * @param {Object} obj - object with calendar fields\n\t * @returns {promise} promise\n\t */\n\tupdateCalendar(id, obj) {\n\t\tif (!this.app.getState().readonly)\n\t\t\treturn this.Back.updateCalendar(id, obj).then(() => {\n\t\t\t\treturn this.Cals.updateItem(id, obj);\n\t\t\t});\n\t\telse return webix.promise.resolve(this.Cals.updateItem(id, obj));\n\t}\n\n\tremoveCalendar(id) {\n\t\tthis.Back.removeCalendar(id).then(() => {\n\t\t\tthis.Cals.remove(id);\n\t\t});\n\t}\n}\n","export default class Backend {\n\tconstructor(app, url) {\n\t\tthis.app = app;\n\t\tthis._url = url;\n\t}\n\n\turl(path) {\n\t\treturn this._url + path;\n\t}\n\n\tevents(params) {\n\t\treturn webix.ajax(this.url(\"events\"), params).then(res => res.json());\n\t}\n\n\taddEvent(obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"events\"), obj)\n\t\t\t.then(res => res.json());\n\t}\n\n\tupdateEvent(id, obj, mode, date) {\n\t\tconst params = obj;\n\t\tif (mode) params.recurring_update_mode = mode;\n\t\tif (date) params.recurring_update_date = date;\n\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"events/\" + id), params)\n\t\t\t.then(res => res.json());\n\t}\n\n\tremoveEvent(id) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"events/\" + id))\n\t\t\t.then(res => res.json());\n\t}\n\n\tcalendars() {\n\t\treturn webix.ajax(this.url(\"calendars\")).then(res => res.json());\n\t}\n\n\taddCalendar(obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"calendars\"), obj)\n\t\t\t.then(res => res.json());\n\t}\n\n\tupdateCalendar(id, obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"calendars/\" + id), obj)\n\t\t\t.then(res => res.json());\n\t}\n\n\tremoveCalendar(id) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"calendars/\" + id))\n\t\t\t.then(res => res.json());\n\t}\n}\n","import { JetApp, plugins, EmptyRouter } from \"webix-jet\";\nimport { createState, link, ignoreInitial } from \"jet-restate\";\n\nimport views from \"./export_views\";\nimport en from \"locales/en\";\n\nimport LocalData from \"models/LocalData\";\nimport Operations from \"./models/Operations\";\nimport Backend from \"./models/Backend\";\n\nexport class App extends JetApp {\n\tconstructor(config) {\n\t\tconst state = createState({\n\t\t\tmode: config.mode || \"month\",\n\t\t\tdate: webix.Date.dayStart(config.date || new Date()),\n\t\t\treadonly: config.readonly || false,\n\t\t\tactive: [],\n\t\t\tselected: null,\n\t\t});\n\n\t\tconfig = config || {};\n\n\t\tconst defaults = webix.extend(\n\t\t\t{\n\t\t\t\trouter: EmptyRouter,\n\t\t\t\tversion: VERSION,\n\t\t\t\tdebug: DEBUG,\n\t\t\t\tstart: \"/main\",\n\t\t\t\tparams: { state, forceCompact: config.compact },\n\t\t\t\tcompactWidth: 780,\n\t\t\t\trecurring:\n\t\t\t\t\ttypeof config.recurring != \"undefined\" ? config.recurring : true,\n\t\t\t\tcalendars:\n\t\t\t\t\ttypeof config.calendars != \"undefined\" ? config.calendars : true,\n\t\t\t},\n\t\t\tconfig\n\t\t);\n\n\t\tsuper({ ...defaults });\n\n\t\t// order matters!\n\t\tthis.setService(\n\t\t\t\"backend\",\n\t\t\tnew (this.dynamic(Backend))(this, this.config.url)\n\t\t);\n\t\tthis.setService(\"local\", new (this.dynamic(LocalData))(this, config));\n\t\tthis.setService(\"operations\", new (this.dynamic(Operations))(this));\n\n\t\tthis.use(\n\t\t\tplugins.Locale,\n\t\t\tthis.config.locale || {\n\t\t\t\tlang: \"en\",\n\t\t\t\twebix: {\n\t\t\t\t\ten: \"en-US\",\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tdynamic(obj) {\n\t\treturn this.config.override ? this.config.override.get(obj) || obj : obj;\n\t}\n\n\trequire(type, name) {\n\t\tif (type === \"jet-views\") return views[name];\n\t\telse if (type === \"jet-locales\") return locales[name];\n\n\t\treturn null;\n\t}\n\n\tgetState() {\n\t\treturn this.config.params.state;\n\t}\n}\n\nwebix.protoUI(\n\t{\n\t\tname: \"scheduler\",\n\t\tapp: App,\n\t\tdefaults: {\n\t\t\tborderless: true,\n\t\t},\n\t\t$init: function() {\n\t\t\tthis.name = \"scheduler\";\n\n\t\t\tconst state = this.$app.getState();\n\n\t\t\tfor (let key in state) {\n\t\t\t\tlink(state, this.config, key);\n\t\t\t}\n\n\t\t\tstate.$changes.attachEvent(\"date\", () => {\n\t\t\t\tignoreInitial((v, o) => this.callEvent(\"onChange\", v, o));\n\t\t\t});\n\t\t},\n\t\t$exportView: function() {\n\t\t\treturn this.$app.getService(\"local\").events(true);\n\t\t},\n\t\tgetState() {\n\t\t\treturn this.$app.getState();\n\t\t},\n\t\tgetService(name) {\n\t\t\treturn this.$app.getService(name);\n\t\t},\n\t},\n\twebix.ui.jetapp\n);\n\n// re-export for customization\nconst services = { Backend, LocalData, Operations };\nconst locales = { en };\nexport { views, services, locales };\n","export default {\n\t//navigation\n\tWeek: \"Week\",\n\tDay: \"Day\",\n\tMonth: \"Month\",\n\tAgenda: \"Agenda\",\n\tToday: \"Today\",\n\tCreate: \"Create\",\n\tNext: \"Next\",\n\tPrevious: \"Previous\",\n\t\"Next day\": \"Next day\",\n\t\"Previous day\": \"Previous day\",\n\t\"Next week\": \"Next week\",\n\t\"Previous week\": \"Previous week\",\n\t\"Next month\": \"Next month\",\n\t\"Previous month\": \"Previous month\",\n\n\t// managing calendars\n\t\"Add calendar\": \"Add calendar\",\n\t\"Do you really want to remove this calendar?\":\n\t\t\"Do you really want to remove this calendar?\",\n\t\"Edit calendar\": \"Edit calendar\",\n\tDelete: \"Delete\",\n\tSave: \"Save\",\n\tTitle: \"Title\",\n\tColor: \"Color\",\n\tActive: \"Active\",\n\tSettings: \"Settings\",\n\t\"(no title)\": \"(no title)\",\n\t\"Inactive calendar\": \"Inactive calendar\",\n\n\t// modes\n\t\"No Events\": \"No Events\",\n\t\"All Day\": \"All Day\",\n\tmore: \"more\",\n\t\"Expand all-day events\": \"Expand all-day events\",\n\t\"Collapse all-day events\": \"Collapse all-day events\",\n\n\t// info and form\n\t\"The event will be deleted permanently, are you sure?\":\n\t\t\"The event will be deleted permanently, are you sure?\",\n\tDone: \"Done\",\n\t\"Delete event\": \"Delete event\",\n\tClose: \"Close\",\n\tEdit: \"Edit\",\n\t\"(No title)\": \"(No title)\",\n\tEvent: \"Event\",\n\tStart: \"Start\",\n\tEnd: \"End\",\n\tCalendar: \"Calendar\",\n\tNotes: \"Notes\",\n\tfrom: \"from\",\n\tto: \"to\",\n\tlabelAllday: \"All day\",\n\tlabelTime: \"Time\",\n\t\"Edit event\": \"Edit event\",\n\n\t//recurring\n\tnever: \"never\",\n\tnone: \"none\",\n\tdaily: \"daily\",\n\tday: \"day\",\n\tdays: \"days\",\n\tevery: \"Every\",\n\tweekly: \"weekly\",\n\tweek: \"week\",\n\tweeks: \"weeks\",\n\teach: \"Every\",\n\tmonthly: \"monthly\",\n\tmonth: \"month\",\n\tmonths: \"months\",\n\tyearly: \"yearly\",\n\tyear: \"year\",\n\tyears: \"years\",\n\tRepeat: \"Repeat\",\n\t\"End repeat\": \"End repeat\",\n\t\"Repeats each\": \"Repeats each\",\n\ttill: \"till\",\n\ttimes: \"times\",\n\t\"weekly, every\": \"weekly, every\",\n\t\"monthly, every\": \"monthly, every\",\n\t\"yearly, every\": \"yearly, every\",\n\t\"every working day\": \"every working day\",\n\tcustom: \"custom\",\n\tEvery: \"Every\",\n\ton: \"on\",\n\t\"after several occurrences\": \"after several occurrences\",\n\tdate: \"date\",\n\t\"week on\": \"week on\",\n\t\"Change recurring pattern\": \"Change recurring pattern\",\n\t\"Save changes?\": \"Save changes?\",\n\n\t// menus for edit and delete\n\t\"All events\": \"All events\",\n\t\"This event\": \"This event\",\n\t\"This event and the following\": \"This event and the following\",\n\tCancel: \"Cancel\",\n\tApply: \"Apply\",\n\t\"Edit recurring event\": \"Edit recurring event\",\n};\n"],"names":["webix","config","this","webixJet","_events","_subs","_data","params","extend","JetBase","_root","_detachEvents","_destroySubs","_container","app","_parent","id","value","url","_segment","update","show","parent","view","getParentView","getParam","suburl","toString","root_1","getRoot","queryView","obj","localId","$scope","name","code","attachEvent","push","key","kid","contains","sub","getSubViewInfo","subview","popup","events","i","length","detachEvent","subView","destructor","current","default","branch","child","_getDefaultSub","_routed_view","parse","substr","parts","split","chunks","test","result","pos","indexOf","params_1","_i","dchunk","decodeURIComponent","page","isNew","url2str","stack","stack_1","chunk","obj2str","join","str","encodeURIComponent","route","index","_next","path","Route","slice","setParams","old","kids","reset","concat","_join","Promise","res","rej","redirect","confirm","resolve","callEvent","NavigationBlocked","catch","err","then","_this","n","_super","_children","__extends","JetView","ui","container","jetview","createView","render","setParam","parent_1","target","_renderFrameLock","_show","segment","_init_url_data","_urlChange","linkRouter","getRouter","set","silent","_$view","_$","_$url","message","destroy","_destroyKids","plugin","getUrl","tagName","refresh","_render","root","document","body","toNode","cfg","_render_final","response","slot","$$","reject","copyConfig","oldui","parent_2","asWin","setPosition","isVisible","_init","_initUrl","ready","e","_initError","init","waits","frame","wait","all","urlChange","lock","_renderFrame","next","_createSubView","shift","_override","error","createFromURL","uis","_ui","JetViewRaw","cb","SubRouter","a","append","_once","window","version","start","_services","EventSystem","JetAppBase","_subSegment","handler","getSubView","prototype","$subview","addSubView","isArray","Array","method","point","DataCollection","RegExp","Map","Date","copy","$router","srcElement","getAttribute","trigger_1","_forView","trigger","cancelBubble","preventDefault","route_1","parentNode","clickHandler","views","_loadError","Error","hidden","replace","require","module","__esModule","loadView","over","override","dv","get","router","rest","apply","data","bind","er","debug","console","text","innerHTML","type","expire","event","_first_start","top","base","setTimeout","animation","node_1","html","addCss","removeCss","now","urlString","template","uid","_detectPrefix","onpopstate","HashRouter","routes","compare","history","pushState","prefix","sufix","_getRaw","routerPrefix","location","href","isPatched","patch","w","win","promise","freeze","some","$freeze","resize","baseAdd","baselayout","addView","baseRemove","removeView","jview_1","subs_1","arguments","subs","layout","protoUI","$init","$app","$ready","proxy","JetApp","UrlRouter","pathname","search","_$config","EmptyRouter","has","store","Object","hasOwnProperty","call","forEach","context","warn","x","String","russianPluralGroups","end","pluralTypes","arabic","lastTwo","bosnian_serbian","chinese","croatian","french","german","russian","lithuanian","czech","polish","icelandic","slovenian","pluralTypeToLanguages","pluralTypeName","locale","ret","langToPluralType","langs","lang","en","escape","token","dollarRegex","defaultTokenRegex","transformPhrase","phrase","substitutions","tokenRegex","TypeError","interpolationRegex","options","smart_count","texts","count","pluralTypeIndex","expression","argument","Polyglot","opts","phrases","currentLocale","allowMissing","onMissingKey","suffix","RangeError","constructTokenRegex","interpolation","newLocale","morePhrases","prefixedKey","unset","clear","newPhrases","t","_","webixPolyglot","plugins","_view","storage","setLangData","pconfig","polyglot","poly","service","put","locName","i18n","setLocale","setLang","getLang","setService","link","source","defineProperty","createState","handlers","out","observe","mask","undefined","queue","waitInQueue","notify","meta","list","keys","enumerable","configurable","values_1","sconfig","nested","reactive","$extend","val","valueOf","AddView","getService","compact","cals","calendars","icon","css","label","width","height","skin","$active","inputHeight","on","onItemClick","AddEvent","align","getState","selected","DateView","cols","tooltip","NavLabel","ChangeDate","State","$changes","DateLabel","dir","state","step","mode","add","date","diff","Math","abs","getMonth","setDate","$batch","longDateFormatStr","dateToStr","setHTML","NavBarView","toolbar","bottomOffset","borderless","optionWidth","onChange","SetMode","setValue","getPalette","aSkin","optionHeight","palette","SidePopupView","save","inputWidth","click","Save","compactBar","padding","left","layoutPadding","form","right","elements","hide","controls","Delete","modal","close","position","fullscreen","head","suggest","onHide","Form","splice","Cals","Ops","getItem","setValues","color","active","focus","getValues","updateCalendar","addCalendar","removeCalendar","relative","rows","UpdateColor","onClick","webix_template","ShowEditor","Editor","EditorView","node","Cid","Show","SideView","Compact","calendar","monthSelect","onDateSelect","dayStart","ListType","autoheight","yCount","editable","editValue","editaction","editor","webix_scheduler_cal_edit","ShowPopup","webix_scheduler_cal_title","ToggleCalendar","webix_scheduler_active","onBeforeEditStop","v","SetTitle","side","maxHeight","readonly","AddCalendar","onAfterScroll","Popup","Hide","Data","PopupView","EditAbility","unselectAll","ToggleState","checkbox","common","edit","env","touch","getEditor","getInputNode","setAttribute","select","getItemNode","EditStopSilent","fail","blockEvent","editCancel","editStop","unblockEvent","NavPopupView","tHeight","tabbarHeight","TopBarView","todayIcon","batch","SetToday","todayBtn","responsive","paddingY","paddingX","visibleBatch","ShowNav","responsiveCell","NavPopup","ToggleAdd","EventActionMenu","onMenuItemClick","Result","Root","icalFormat","strToDate","serialize","map","d","WEEKDAYS","FREQUENCE","DAILY","WEEKLY","MONTHLY","YEARLY","findDate","arr","equal","fillWdays","consts","BYDAY","wdays","line","sort","s","j","interval","INTERVAL","FREQ","getDate","getDay","setMonth","BYMONTHDAY","BYSETPOS","checkDay","sdate","days","oldDay","includes","recToDate","_a","getParams","$id","$recurring","extractDate","clipSequence","ev","block","UNTIL","COUNT","EXDATE","filter","cutOccurrence","separateSequence","start_date","len","end_date","isFirstOccurrence","evStart","correctMode","origin_id","recurring","isLastPart","movePattern","rec","newEvent","nmd","nwn","day","floor","getWeekNum","BYMONTH","nm","RecurringFormView","elementsConfig","labelPosition","bottom","CreateIntervalControls","CreateCheckboxes","CreateSelect","CreateRadio","UpdateEvent","Events","CheckBoxContainer","Checkboxes","getChildViews","pop","PatternSelect","UntilDateContainer","UntilDateCalendar","untilDate","getPopup","getBody","UntilNumContainer","UntilNum","CustomRecControls","margin","labelWidth","min","ChangeControls","_freq","dayShort","labelAlign","o","isUndefined","GetBYDAY","SetSilently","gravity","values","check","find","getValue","byDay","dayFull","monthFull","calculated","weekday","getList","month","weekNum","rec_pattern","vertical","ChangeSelectors","icons","until","untilCount","CountNum","define","minDate","_StartDate","SetUNTIL","SetBYDAY","SetPatternOptions","setDirty","GetRecPattern","IsDirty","change","GetValues","isDirty","control","changeMode","date_id","correctCountUntil","collection","oid","b","last","countToUntil","nexto","cutCount","hasOneOccurrence","lr","EditRecurringMixin","ChangeMode","CorrectCountUntil","HasOneOccurrence","EventFormView","hotkey","Close","Done","scroll","GetDateTime","labelRight","ToggleTimeControls","CreateCalendarColor","CreateRepeat","Wait","getDirtyValues","Local","RecurringOptions","StartTime","EndTime","_v","Calendars","SubForm","ClearTempEvent","FillForm","labelTopHeight","ToggleSubform","ShowSubForm","unshift","format","Id","NewEvent","FillFormContinue","AdaptObjToMode","start_time","end_time","datePart","SetRecurring","today","GetFromStartDate","roptions","ResetRecurringOptions","SetValues","rec_option","toLowerCase","time","timePart","GetStartDate","first","getFirstId","$color","minutes","ceil","getMinutes","setHours","getHours","prev","PrepareChange","sid","_inProgress","addEvent","PrepareOut","newEvent_1","updateEvent","recVals","SetFormSilently","UpdateSilently","finally","fvals","GetRecurring","_b","edate","datesToRec","ns","es","SumupDateTime","all_day","Join","CorrectDateTime","ApplyDatechangeToRecurring","ProcessText","field","trim","oldStart","length_1","dirty","UpdateStateDate","wday","GetModeBounds","r","rObj","details","dateField","timeField","ev_length","opposite","exists","remove","Back","Subform","subform","HideSubPop","getTopParentView","exit","FormPopup","EventView","StartAction","$view","InfoTemplate","action","EventObj","Menu","_waitMenu","defer","DeleteEvent","EditEvent","title","removeEvent","oneday","allday","timeFormatStr","startDate","endDate","startTime","endTime","fromTo","pattern","EventActionPopup","buttons","layoutMargin","Cancel","sizeTrigger","_compactValue","_compactWidth","_compactHandler","_checkTrigger","$setSize","y","MainView","fCompact","topbar","cells","compactWidth","SetCompactMode","ProgressBar","showProgress","delay","hideProgress","ToggleEvent","ToggleSidePanel","_dndActionPopup","ShowEvent","HideEvent","sameEvent","_sidePanel","marker","timeStart","dayEventColor","$textColor","fill","size","master","templateStart","marks","classname","aria","shrinkTo","before","after","isToday","isMultiDay","daysBetweenInclusive","round","UnitListView","uniteBy","templateHeader","TemplateHeader","TimeStart","onUnits","SetUnits","List","OverlayBox","sel","hideOverlay","showOverlay","units","start_1","this_1","AgendaView","headerHeight","TemplateCss","onItemRender","$unit","CurrentUnit","firstChild","SelectEvent","RefreshData","_o","monthStart","getEvents","clearAll","ToggleOverlay","_selected","datestring","fstring","ids","getUnitList","HourscaleView","heightSize","ind","getIndexById","HourScaleItem","ParseHours","h","MultiMoreView","wxi-angle-down","ExpandData","wxi-angle-up","WrapData","MoreIcon","_expandState","maxVisibleLines","style","transition","_inAnimation","SetMoreIcon","_select","functor","trgs","LocateSelected","Select","Unselect","HandleSelection","_SelectionMode","id_1","operation","SelectionMixin","inner","_DataObj","querySelectorAll","el","firstElementChild","locate","Resizer","$dragIn","getContext","from","$dragPos","ctx","box","offset","y_diff","updateNodeHeight","duration","updateText","x_diff","DragControl","getNode","max","minEventHeight","getActualDate","any","initDnD","dragOnly","ctrl","modes","addDrag","addDrop","locateEvent","updateSelection","selection","editRecurring","newSubEvent","$dragDestroy","$waitUpdate","visibility","$resize","setDragOffset","x_offset","y_offset","_waitPopup","finishOperation","appendChild","$drop","$last_y","$dragCreate","GetEvent","cloneNode","className","Day","delta","getMaster","EventTemplate","noff","toff","getIdByIndex","$marked","markDropArea","$dragOut","drop","drag_container","createElement","$extra","extra","getLastId","xCount","multiday","more","children","ID","HideWindow","WeekDayNum","DayEventsView","webix_scheduler_day_event","onDblClick","webix_scheduler_day_scale_item","_e","ShowNew","RenderEvents","weekStart","to","FilterToday","_marker_update_interval","clearInterval","setInterval","UpdateMarkerPosition","_Marker","single","create","class","evs","PrepareEvents","role","ToHTML","MarkToday","$inner","orderSet","PruneStack","$sorder","max_count","SetPosition","GetEventEndDate","$count","temp_width","$width","$left","evCorrectedCopy","sm","em","$top","$height","content","EventTemplateStart","resizer","MultidayEventList","webix_scheduler_multiday_event","_moreBtn","$css","LimitData","multi","GetStyle","excess","_reserve","_reserveIds","Animate","DayView","ScrollScale","GetDay","scrollTo","CalendarView","isOutside","MarkEvent","navigation","monthHeader","skipEmptyWeeks","Calendar","weeks","isHoliday","c","MoreWindowView","minHeight","webix_scheduler_month_event","webix_scheduler_month_event_single","MoreTemplate","Win","_c","DayFormatStr","MonthEventsView","prerender","webix_cal_date","_ev","ShowDay","webix_scheduler_more","ShowMore","webix_cal_day","CalendarTemplate","eventHeight","MoreWindow","dynamic","$more","GetDayCss","maxLines","wStart","wEnd","cache","me","ms","each","dayIndex","dayHTML","ee","ls","le","prevLength","GetPosition","row","col","start_a","start_b","days_a","monthData","GetMonthData","ShowWindow","MonthHeaderView","GetHeaderData","k","startOnMonday","MonthListView","MonthView","getFullYear","WeekEventsView","WeekHeaderView","header","MultiDayEventsView","itemHeight","ParseDays","BreakEventsByDay","_maxEvents","ResetListHeight","Days","processed","$config","allEvents","renderedEvents","toHide","_day","visible","MoreOption","cIndex","rIndex","GetSizePosition","WeekView","GetWeek","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","m13","m14","m15","m16","m17","m18","m19","m20","m21","m22","m23","m24","m25","m26","m27","m28","m29","m30","m31","createEvents","events_ready","createCalendars","cals_ready","utc","serverUTC","parseFormat","dateToLocalStr","loaded_ranges","LocalData","scheme","$change","string","name_1","isNaN","getColor","$serialize","eventOut","$export","sync","force","getLocal","getDynamic","findCalendar","xdate","explodeEvent","roundTime","parseFormatStr","fromStr","$sort","by","as","sortCalendars","onAfterDelete","setActive","onAfterAdd","data->onDataUpdate","rgb","toRgb","setMinutes","local","Operations","temp","tosave","updateItem","cev","isFirst","_url","Backend","ajax","json","post","recurring_update_mode","recurring_update_date","del","defaults","forceCompact","use","App","locales","$exportView","jetapp","services","Week","Month","Agenda","Today","Create","Next","Previous","Next day","Previous day","Next week","Previous week","Next month","Previous month","Add calendar","Do you really want to remove this calendar?","Edit calendar","Title","Color","Active","Settings","(no title)","Inactive calendar","No Events","All Day","Expand all-day events","Collapse all-day events","The event will be deleted permanently, are you sure?","Delete event","Edit","(No title)","Event","Start","End","Notes","labelAllday","labelTime","Edit event","never","none","daily","every","weekly","week","monthly","months","yearly","year","years","Repeat","End repeat","Repeats each","till","times","weekly, every","monthly, every","yearly, every","every working day","custom","Every","after several occurrences","week on","Change recurring pattern","Save changes?","All events","This event","This event and the following","Apply","Edit recurring event"],"mappings":"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"}
=======
{"version":3,"file":"scheduler.min.js","sources":["../node_modules/webix-jet/dist/es6/jet.js","../node_modules/jet-restate/index.js","../node_modules/@xbs/jet-helpers/rLayout.js","../node_modules/@xbs/jet-helpers/jetWin.js","../node_modules/@xbs/jet-helpers/waitVisible.js","../sources/views/bars/add.js","../sources/views/bars/date.js","../sources/views/bars/nav.js","../sources/helpers/palette.js","../sources/views/side/editor.js","../sources/views/side/popup.js","../sources/views/side/index.js","../sources/views/bars/navpopup.js","../sources/views/bars/index.js","../sources/views/event/actionmenu.js","../sources/helpers/dates.js","../sources/helpers/ical.js","../sources/helpers/recurring.js","../sources/views/event/recurringform.js","../sources/helpers/editrecurring.js","../sources/views/event/form.js","../sources/views/event/formpopup.js","../node_modules/jet-hotkey/index.js","../sources/helpers/copypaste.js","../sources/views/event/info.js","../sources/helpers/colors.js","../sources/views/modes/common/actionpopup.js","../sources/views/main.js","../sources/helpers/templates.js","../sources/views/modes/common/unitlist.js","../sources/views/modes/agenda/index.js","../sources/views/modes/common/hourscale.js","../sources/views/modes/common/multimore.js","../sources/helpers/selection.js","../sources/helpers/resizer.js","../node_modules/@xbs/webix-gantt-lib/dist/wgantt.js","../sources/helpers/dragscroll.js","../sources/helpers/dnd.js","../sources/views/modes/day/events.js","../sources/views/modes/day/multiday.js","../sources/views/modes/day/index.js","../sources/views/modes/month/compact.js","../sources/views/modes/month/more.js","../sources/views/modes/month/events.js","../sources/views/modes/month/header.js","../sources/views/modes/month/list.js","../sources/views/modes/month/index.js","../sources/views/modes/timeline/bar.js","../sources/views/modes/timeline/more.js","../sources/views/modes/timeline/chart.js","../sources/views/modes/timeline/scale.js","../sources/views/modes/timeline/index.js","../sources/views/modes/units/events.js","../sources/views/modes/units/header.js","../sources/views/modes/units/multidaylist.js","../sources/views/modes/units/multiday.js","../sources/views/modes/units/index.js","../sources/views/modes/week/compact.js","../sources/views/modes/week/header.js","../sources/views/modes/week/multiday.js","../sources/views/modes/week/index.js","../sources/views/modes/year/calendar.js","../sources/views/modes/year/index.js","../sources/export_views.js","../sources/models/LocalData.js","../sources/models/Operations.js","../sources/models/Backend.js","../sources/app.js","../sources/locales/en.js"],"sourcesContent":["class NavigationBlocked {\r\n}\n\nclass JetBase {\r\n    constructor(webix, config) {\r\n        this.webixJet = true;\r\n        this.webix = webix;\r\n        this._events = [];\r\n        this._subs = {};\r\n        this._data = {};\r\n        if (config && config.params)\r\n            webix.extend(this._data, config.params);\r\n    }\r\n    getRoot() {\r\n        return this._root;\r\n    }\r\n    destructor() {\r\n        this._detachEvents();\r\n        this._destroySubs();\r\n        this._events = this._container = this.app = this._parent = this._root = null;\r\n    }\r\n    setParam(id, value, url) {\r\n        if (this._data[id] !== value) {\r\n            this._data[id] = value;\r\n            this._segment.update(id, value, 0);\r\n            if (url) {\r\n                return this.show(null);\r\n            }\r\n        }\r\n    }\r\n    getParam(id, parent) {\r\n        const value = this._data[id];\r\n        if (typeof value !== \"undefined\" || !parent) {\r\n            return value;\r\n        }\r\n        const view = this.getParentView();\r\n        if (view) {\r\n            return view.getParam(id, parent);\r\n        }\r\n    }\r\n    getUrl() {\r\n        return this._segment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._segment.toString();\r\n    }\r\n    getParentView() {\r\n        return this._parent;\r\n    }\r\n    $$(id) {\r\n        if (typeof id === \"string\") {\r\n            const root = this.getRoot();\r\n            return root.queryView((obj => (obj.config.id === id || obj.config.localId === id) &&\r\n                (obj.$scope === root.$scope)), \"self\");\r\n        }\r\n        else {\r\n            return id;\r\n        }\r\n    }\r\n    on(obj, name, code) {\r\n        const id = obj.attachEvent(name, code);\r\n        this._events.push({ obj, id });\r\n        return id;\r\n    }\r\n    contains(view) {\r\n        for (const key in this._subs) {\r\n            const kid = this._subs[key].view;\r\n            if (kid === view || kid.contains(view)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    getSubView(name) {\r\n        const sub = this.getSubViewInfo(name);\r\n        if (sub) {\r\n            return sub.subview.view;\r\n        }\r\n    }\r\n    getSubViewInfo(name) {\r\n        const sub = this._subs[name || \"default\"];\r\n        if (sub) {\r\n            return { subview: sub, parent: this };\r\n        }\r\n        if (name === \"_top\") {\r\n            this._subs[name] = { url: \"\", id: null, popup: true };\r\n            return this.getSubViewInfo(name);\r\n        }\r\n        // when called from a child view, searches for nearest parent with subview\r\n        if (this._parent) {\r\n            return this._parent.getSubViewInfo(name);\r\n        }\r\n        return null;\r\n    }\r\n    _detachEvents() {\r\n        const events = this._events;\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            events[i].obj.detachEvent(events[i].id);\r\n        }\r\n    }\r\n    _destroySubs() {\r\n        // destroy sub views\r\n        for (const key in this._subs) {\r\n            const subView = this._subs[key].view;\r\n            // it possible that subview was not loaded with any content yet\r\n            // so check on null\r\n            if (subView) {\r\n                subView.destructor();\r\n            }\r\n        }\r\n        // reset to prevent memory leaks\r\n        this._subs = {};\r\n    }\r\n    _init_url_data() {\r\n        const url = this._segment.current();\r\n        this._data = {};\r\n        this.webix.extend(this._data, url.params, true);\r\n    }\r\n    _getDefaultSub() {\r\n        if (this._subs.default) {\r\n            return this._subs.default;\r\n        }\r\n        for (const key in this._subs) {\r\n            const sub = this._subs[key];\r\n            if (!sub.branch && sub.view && key !== \"_top\") {\r\n                const child = sub.view._getDefaultSub();\r\n                if (child) {\r\n                    return child;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _routed_view() {\r\n        const parent = this.getParentView();\r\n        if (!parent) {\r\n            return true;\r\n        }\r\n        const sub = parent._getDefaultSub();\r\n        if (!sub && sub !== this) {\r\n            return false;\r\n        }\r\n        return parent._routed_view();\r\n    }\r\n}\n\nfunction parse(url) {\r\n    // remove starting /\r\n    if (url[0] === \"/\") {\r\n        url = url.substr(1);\r\n    }\r\n    // split url by \"/\"\r\n    const parts = url.split(\"/\");\r\n    const chunks = [];\r\n    // for each page in url\r\n    for (let i = 0; i < parts.length; i++) {\r\n        const test = parts[i];\r\n        const result = {};\r\n        // detect params\r\n        // support old \t\t\tsome:a=b:c=d\r\n        // and new notation\t\tsome?a=b&c=d\r\n        let pos = test.indexOf(\":\");\r\n        if (pos === -1) {\r\n            pos = test.indexOf(\"?\");\r\n        }\r\n        if (pos !== -1) {\r\n            const params = test.substr(pos + 1).split(/[\\:\\?\\&]/g);\r\n            // create hash of named params\r\n            for (const param of params) {\r\n                const dchunk = param.split(\"=\");\r\n                result[dchunk[0]] = decodeURIComponent(dchunk[1]);\r\n            }\r\n        }\r\n        // store parsed values\r\n        chunks[i] = {\r\n            page: (pos > -1 ? test.substr(0, pos) : test),\r\n            params: result,\r\n            isNew: true\r\n        };\r\n    }\r\n    // return array of page objects\r\n    return chunks;\r\n}\r\nfunction url2str(stack) {\r\n    const url = [];\r\n    for (const chunk of stack) {\r\n        url.push(\"/\" + chunk.page);\r\n        const params = obj2str(chunk.params);\r\n        if (params) {\r\n            url.push(\"?\" + params);\r\n        }\r\n    }\r\n    return url.join(\"\");\r\n}\r\nfunction obj2str(obj) {\r\n    const str = [];\r\n    for (const key in obj) {\r\n        if (typeof obj[key] === \"object\")\r\n            continue;\r\n        if (str.length) {\r\n            str.push(\"&\");\r\n        }\r\n        str.push(key + \"=\" + encodeURIComponent(obj[key]));\r\n    }\r\n    return str.join(\"\");\r\n}\n\nclass Route {\r\n    constructor(route, index) {\r\n        this._next = 1;\r\n        if (typeof route === \"string\") {\r\n            this.route = {\r\n                url: parse(route),\r\n                path: route\r\n            };\r\n        }\r\n        else {\r\n            this.route = route;\r\n        }\r\n        this.index = index;\r\n    }\r\n    current() {\r\n        return this.route.url[this.index];\r\n    }\r\n    next() {\r\n        return this.route.url[this.index + this._next];\r\n    }\r\n    suburl() {\r\n        return this.route.url.slice(this.index);\r\n    }\r\n    shift(params) {\r\n        const route = new Route(this.route, this.index + this._next);\r\n        route.setParams(route.route.url, params, route.index);\r\n        return route;\r\n    }\r\n    setParams(url, params, index) {\r\n        if (params) {\r\n            const old = url[index].params;\r\n            for (var key in params)\r\n                old[key] = params[key];\r\n        }\r\n    }\r\n    refresh() {\r\n        const url = this.route.url;\r\n        for (let i = this.index + 1; i < url.length; i++) {\r\n            url[i].isNew = true;\r\n        }\r\n    }\r\n    toString() {\r\n        const str = url2str(this.suburl());\r\n        return str ? str.substr(1) : \"\";\r\n    }\r\n    _join(path, kids) {\r\n        let url = this.route.url;\r\n        if (path === null) { // change of parameters, route elements are not affected\r\n            return url;\r\n        }\r\n        const old = this.route.url;\r\n        let reset = true;\r\n        url = old.slice(0, this.index + (kids ? this._next : 0));\r\n        if (path) {\r\n            url = url.concat(parse(path));\r\n            for (let i = 0; i < url.length; i++) {\r\n                if (old[i]) {\r\n                    url[i].view = old[i].view;\r\n                }\r\n                if (reset && old[i] && url[i].page === old[i].page) {\r\n                    url[i].isNew = false;\r\n                }\r\n                else if (url[i].isNew) {\r\n                    // if some segment was marked as new, all subsegments must be updated as well\r\n                    reset = false;\r\n                }\r\n            }\r\n        }\r\n        return url;\r\n    }\r\n    append(path) {\r\n        const url = this._join(path, true);\r\n        this.route.path = url2str(url);\r\n        this.route.url = url;\r\n        return this.route.path;\r\n    }\r\n    show(path, view, kids) {\r\n        const url = this._join(path.url, kids);\r\n        this.setParams(url, path.params, this.index + (kids ? this._next : 0));\r\n        return new Promise((res, rej) => {\r\n            const redirect = url2str(url);\r\n            const obj = {\r\n                url,\r\n                redirect,\r\n                confirm: Promise.resolve()\r\n            };\r\n            const app = view ? view.app : null;\r\n            // when creating a new route, it possible that it will not have any content\r\n            // guard is not necessary in such case\r\n            if (app) {\r\n                const result = app.callEvent(\"app:guard\", [obj.redirect, view, obj]);\r\n                if (!result) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n            }\r\n            obj.confirm.catch(err => rej(err)).then(() => {\r\n                if (obj.redirect === null) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                if (obj.redirect !== redirect) {\r\n                    app.show(obj.redirect);\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                this.route.path = redirect;\r\n                this.route.url = url;\r\n                res();\r\n            });\r\n        });\r\n    }\r\n    size(n) {\r\n        this._next = n;\r\n    }\r\n    split() {\r\n        const route = {\r\n            url: this.route.url.slice(this.index + 1),\r\n            path: \"\"\r\n        };\r\n        if (route.url.length) {\r\n            route.path = url2str(route.url);\r\n        }\r\n        return new Route(route, 0);\r\n    }\r\n    update(name, value, index) {\r\n        const chunk = this.route.url[this.index + (index || 0)];\r\n        if (!chunk) {\r\n            this.route.url.push({ page: \"\", params: {} });\r\n            return this.update(name, value, index);\r\n        }\r\n        if (name === \"\") {\r\n            chunk.page = value;\r\n        }\r\n        else {\r\n            chunk.params[name] = value;\r\n        }\r\n        this.route.path = url2str(this.route.url);\r\n    }\r\n}\n\nclass JetView extends JetBase {\r\n    constructor(app, config) {\r\n        super(app.webix);\r\n        this.app = app;\r\n        //this.$config = config;\r\n        this._children = [];\r\n    }\r\n    ui(ui, config) {\r\n        config = config || {};\r\n        const container = config.container || ui.container;\r\n        const jetview = this.app.createView(ui);\r\n        this._children.push(jetview);\r\n        jetview.render(container, this._segment, this);\r\n        if (typeof ui !== \"object\" || (ui instanceof JetBase)) {\r\n            // raw webix UI\r\n            return jetview;\r\n        }\r\n        else {\r\n            return jetview.getRoot();\r\n        }\r\n    }\r\n    show(path, config) {\r\n        config = config || {};\r\n        // convert parameters object to url\r\n        if (typeof path === \"object\") {\r\n            for (const key in path) {\r\n                this.setParam(key, path[key]);\r\n            }\r\n            path = null;\r\n        }\r\n        else {\r\n            // deligate to app in case of root prefix\r\n            if (path.substr(0, 1) === \"/\") {\r\n                return this.app.show(path, config);\r\n            }\r\n            // local path, do nothing\r\n            if (path.indexOf(\"./\") === 0) {\r\n                path = path.substr(2);\r\n            }\r\n            // parent path, call parent view\r\n            if (path.indexOf(\"../\") === 0) {\r\n                const parent = this.getParentView();\r\n                if (parent) {\r\n                    return parent.show(path.substr(3), config);\r\n                }\r\n                else {\r\n                    return this.app.show(\"/\" + path.substr(3));\r\n                }\r\n            }\r\n            const sub = this.getSubViewInfo(config.target);\r\n            if (sub) {\r\n                if (sub.parent !== this) {\r\n                    return sub.parent.show(path, config);\r\n                }\r\n                else if (config.target && config.target !== \"default\") {\r\n                    return this._renderFrameLock(config.target, sub.subview, {\r\n                        url: path,\r\n                        params: config.params,\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                if (path) {\r\n                    return this.app.show(\"/\" + path, config);\r\n                }\r\n            }\r\n        }\r\n        return this._show(this._segment, { url: path, params: config.params }, this);\r\n    }\r\n    _show(segment, path, view) {\r\n        return segment.show(path, view, true).then(() => {\r\n            this._init_url_data();\r\n            return this._urlChange();\r\n        }).then(() => {\r\n            if (segment.route.linkRouter) {\r\n                this.app.getRouter().set(segment.route.path, { silent: true });\r\n                this.app.callEvent(\"app:route\", [segment.route.path]);\r\n            }\r\n        });\r\n    }\r\n    init(_$view, _$) {\r\n        // stub\r\n    }\r\n    ready(_$view, _$url) {\r\n        // stub\r\n    }\r\n    config() {\r\n        this.app.webix.message(\"View:Config is not implemented\");\r\n    }\r\n    urlChange(_$view, _$url) {\r\n        // stub\r\n    }\r\n    destroy() {\r\n        // stub\r\n    }\r\n    destructor() {\r\n        this.destroy();\r\n        this._destroyKids();\r\n        // destroy actual UI\r\n        if (this._root) {\r\n            this._root.destructor();\r\n            super.destructor();\r\n        }\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this.app, this, config);\r\n    }\r\n    refresh() {\r\n        const url = this.getUrl();\r\n        this.destroy();\r\n        this._destroyKids();\r\n        this._destroySubs();\r\n        this._detachEvents();\r\n        if (this._container.tagName) {\r\n            this._root.destructor();\r\n        }\r\n        this._segment.refresh();\r\n        return this._render(this._segment);\r\n    }\r\n    render(root, url, parent) {\r\n        if (typeof url === \"string\") {\r\n            url = new Route(url, 0);\r\n        }\r\n        this._segment = url;\r\n        this._parent = parent;\r\n        this._init_url_data();\r\n        root = root || document.body;\r\n        const _container = (typeof root === \"string\") ? this.webix.toNode(root) : root;\r\n        if (this._container !== _container) {\r\n            this._container = _container;\r\n            return this._render(url);\r\n        }\r\n        else {\r\n            return this._urlChange().then(() => this.getRoot());\r\n        }\r\n    }\r\n    _render(url) {\r\n        const config = this.config();\r\n        if (config.then) {\r\n            return config.then(cfg => this._render_final(cfg, url));\r\n        }\r\n        else {\r\n            return this._render_final(config, url);\r\n        }\r\n    }\r\n    _render_final(config, url) {\r\n        // get previous view in the same slot\r\n        let slot = null;\r\n        let container = null;\r\n        let show = false;\r\n        if (!this._container.tagName) {\r\n            slot = this._container;\r\n            if (slot.popup) {\r\n                container = document.body;\r\n                show = true;\r\n            }\r\n            else {\r\n                container = this.webix.$$(slot.id);\r\n            }\r\n        }\r\n        else {\r\n            container = this._container;\r\n        }\r\n        // view already destroyed\r\n        if (!this.app || !container) {\r\n            return Promise.reject(null);\r\n        }\r\n        let response;\r\n        const current = this._segment.current();\r\n        // using wrapper object, so ui can be changed from app:render event\r\n        const result = { ui: {} };\r\n        this.app.copyConfig(config, result.ui, this._subs);\r\n        this.app.callEvent(\"app:render\", [this, url, result]);\r\n        result.ui.$scope = this;\r\n        /* destroy old HTML attached views before creating new one */\r\n        if (!slot && current.isNew && current.view) {\r\n            current.view.destructor();\r\n        }\r\n        try {\r\n            // special handling for adding inside of multiview - preserve old id\r\n            if (slot && !show) {\r\n                const oldui = container;\r\n                const parent = oldui.getParentView();\r\n                if (parent && parent.name === \"multiview\" && !result.ui.id) {\r\n                    result.ui.id = oldui.config.id;\r\n                }\r\n            }\r\n            this._root = this.app.webix.ui(result.ui, container);\r\n            const asWin = this._root;\r\n            // check for url added to ignore this.ui calls\r\n            if (show && asWin.setPosition && !asWin.isVisible()) {\r\n                asWin.show();\r\n            }\r\n            // check, if we are replacing some older view\r\n            if (slot) {\r\n                if (slot.view && slot.view !== this && slot.view !== this.app) {\r\n                    slot.view.destructor();\r\n                }\r\n                slot.id = this._root.config.id;\r\n                if (this.getParentView() || !this.app.app)\r\n                    slot.view = this;\r\n                else {\r\n                    // when we have subapp, set whole app as a view\r\n                    // so on destruction, the whole app will be destroyed\r\n                    slot.view = this.app;\r\n                }\r\n            }\r\n            if (current.isNew) {\r\n                current.view = this;\r\n                current.isNew = false;\r\n            }\r\n            response = Promise.resolve(this._init(this._root, url)).then(() => {\r\n                return this._urlChange().then(() => {\r\n                    this._initUrl = null;\r\n                    return this.ready(this._root, url.suburl());\r\n                });\r\n            });\r\n        }\r\n        catch (e) {\r\n            response = Promise.reject(e);\r\n        }\r\n        return response.catch(err => this._initError(this, err));\r\n    }\r\n    _init(view, url) {\r\n        return this.init(view, url.suburl());\r\n    }\r\n    _urlChange() {\r\n        this.app.callEvent(\"app:urlchange\", [this, this._segment]);\r\n        const waits = [];\r\n        for (const key in this._subs) {\r\n            const frame = this._subs[key];\r\n            const wait = this._renderFrameLock(key, frame, null);\r\n            if (wait) {\r\n                waits.push(wait);\r\n            }\r\n        }\r\n        return Promise.all(waits).then(() => {\r\n            return this.urlChange(this._root, this._segment.suburl());\r\n        });\r\n    }\r\n    _renderFrameLock(key, frame, path) {\r\n        // if subview is not occupied by some rendering yet\r\n        if (!frame.lock) {\r\n            // retreive and store rendering end promise\r\n            const lock = this._renderFrame(key, frame, path);\r\n            if (lock) {\r\n                // clear lock after frame rendering\r\n                // as promise.finally is not supported by  Webix lesser than 6.2\r\n                // using a more verbose notation\r\n                frame.lock = lock.then(() => frame.lock = null, () => frame.lock = null);\r\n            }\r\n        }\r\n        // return rendering end promise\r\n        return frame.lock;\r\n    }\r\n    _renderFrame(key, frame, path) {\r\n        //default route\r\n        if (key === \"default\") {\r\n            if (this._segment.next()) {\r\n                // we have a next segment in url, render it\r\n                let params = path ? path.params : null;\r\n                if (frame.params) {\r\n                    params = this.webix.extend(params || {}, frame.params);\r\n                }\r\n                return this._createSubView(frame, this._segment.shift(params));\r\n            }\r\n            else if (frame.view && frame.popup) {\r\n                // there is no next segment, delete the existing sub-view\r\n                frame.view.destructor();\r\n                frame.view = null;\r\n            }\r\n        }\r\n        //if new path provided, set it to the frame\r\n        if (path !== null) {\r\n            frame.url = path.url;\r\n            if (frame.params) {\r\n                path.params = this.webix.extend(path.params || {}, frame.params);\r\n            }\r\n        }\r\n        // in case of routed sub-view\r\n        if (frame.route) {\r\n            // we have a new path for sub-view\r\n            if (path !== null) {\r\n                return frame.route.show(path, frame.view).then(() => {\r\n                    return this._createSubView(frame, frame.route);\r\n                });\r\n            }\r\n            // do not trigger onChange for isolated sub-views\r\n            if (frame.branch) {\r\n                return;\r\n            }\r\n        }\r\n        let view = frame.view;\r\n        // if view doesn't exists yet, init it\r\n        if (!view && frame.url) {\r\n            if (typeof frame.url === \"string\") {\r\n                // string, so we have isolated subview url\r\n                frame.route = new Route(frame.url, 0);\r\n                if (path)\r\n                    frame.route.setParams(frame.route.route.url, path.params, 0);\r\n                if (frame.params)\r\n                    frame.route.setParams(frame.route.route.url, frame.params, 0);\r\n                return this._createSubView(frame, frame.route);\r\n            }\r\n            else {\r\n                // object, so we have an embeded subview\r\n                if (typeof frame.url === \"function\" && !(view instanceof frame.url)) {\r\n                    view = new (this.app._override(frame.url))(this.app, \"\");\r\n                }\r\n                if (!view) {\r\n                    view = frame.url;\r\n                }\r\n            }\r\n        }\r\n        // trigger onChange for already existed view\r\n        if (view) {\r\n            return view.render(frame, (frame.route || this._segment), this);\r\n        }\r\n    }\r\n    _initError(view, err) {\r\n        /*\r\n            if view is destroyed, ignore any view related errors\r\n        */\r\n        if (this.app) {\r\n            this.app.error(\"app:error:initview\", [err, view]);\r\n        }\r\n        return true;\r\n    }\r\n    _createSubView(sub, suburl) {\r\n        return this.app.createFromURL(suburl.current()).then(view => {\r\n            return view.render(sub, suburl, this);\r\n        });\r\n    }\r\n    _destroyKids() {\r\n        // destroy child views\r\n        const uis = this._children;\r\n        for (let i = uis.length - 1; i >= 0; i--) {\r\n            if (uis[i] && uis[i].destructor) {\r\n                uis[i].destructor();\r\n            }\r\n        }\r\n        // reset vars for better GC processing\r\n        this._children = [];\r\n    }\r\n}\n\n// wrapper for raw objects and Jet 1.x structs\r\nclass JetViewRaw extends JetView {\r\n    constructor(app, config) {\r\n        super(app, config);\r\n        this._ui = config.ui;\r\n    }\r\n    config() {\r\n        return this._ui;\r\n    }\r\n}\n\nclass SubRouter {\r\n    constructor(cb, config, app) {\r\n        this.path = \"\";\r\n        this.app = app;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        const a = this.app;\r\n        a.app.getRouter().set(a._segment.append(this.path), { silent: true });\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nlet _once = true;\r\nclass JetAppBase extends JetBase {\r\n    constructor(config) {\r\n        const webix = (config || {}).webix || window.webix;\r\n        config = webix.extend({\r\n            name: \"App\",\r\n            version: \"1.0\",\r\n            start: \"/home\"\r\n        }, config, true);\r\n        super(webix, config);\r\n        this.config = config;\r\n        this.app = this.config.app;\r\n        this.ready = Promise.resolve();\r\n        this._services = {};\r\n        this.webix.extend(this, this.webix.EventSystem);\r\n    }\r\n    getUrl() {\r\n        return this._subSegment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._subSegment.toString();\r\n    }\r\n    getService(name) {\r\n        let obj = this._services[name];\r\n        if (typeof obj === \"function\") {\r\n            obj = this._services[name] = obj(this);\r\n        }\r\n        return obj;\r\n    }\r\n    setService(name, handler) {\r\n        this._services[name] = handler;\r\n    }\r\n    destructor() {\r\n        this.getSubView().destructor();\r\n        super.destructor();\r\n    }\r\n    // copy object and collect extra handlers\r\n    copyConfig(obj, target, config) {\r\n        // raw ui config\r\n        if (obj instanceof JetBase ||\r\n            (typeof obj === \"function\" && obj.prototype instanceof JetBase)) {\r\n            obj = { $subview: obj };\r\n        }\r\n        // subview placeholder\r\n        if (typeof obj.$subview != \"undefined\") {\r\n            return this.addSubView(obj, target, config);\r\n        }\r\n        // process sub-properties\r\n        const isArray = obj instanceof Array;\r\n        target = target || (isArray ? [] : {});\r\n        for (const method in obj) {\r\n            let point = obj[method];\r\n            // view class\r\n            if (typeof point === \"function\" && point.prototype instanceof JetBase) {\r\n                point = { $subview: point };\r\n            }\r\n            if (point && typeof point === \"object\" &&\r\n                !(point instanceof this.webix.DataCollection) && !(point instanceof RegExp) && !(point instanceof Map)) {\r\n                if (point instanceof Date) {\r\n                    target[method] = new Date(point);\r\n                }\r\n                else {\r\n                    const copy = this.copyConfig(point, (point instanceof Array ? [] : {}), config);\r\n                    if (copy !== null) {\r\n                        if (isArray)\r\n                            target.push(copy);\r\n                        else\r\n                            target[method] = copy;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                target[method] = point;\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n    getRouter() {\r\n        return this.$router;\r\n    }\r\n    clickHandler(e, target) {\r\n        if (e) {\r\n            target = target || (e.target || e.srcElement);\r\n            if (target && target.getAttribute) {\r\n                const trigger = target.getAttribute(\"trigger\");\r\n                if (trigger) {\r\n                    this._forView(target, view => view.app.trigger(trigger));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n                const route = target.getAttribute(\"route\");\r\n                if (route) {\r\n                    this._forView(target, view => view.show(route));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n            }\r\n        }\r\n        const parent = target.parentNode;\r\n        if (parent) {\r\n            this.clickHandler(e, parent);\r\n        }\r\n    }\r\n    getRoot() {\r\n        return this.getSubView().getRoot();\r\n    }\r\n    refresh() {\r\n        if (!this._subSegment) {\r\n            return Promise.resolve(null);\r\n        }\r\n        return this.getSubView().refresh().then(view => {\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return view;\r\n        });\r\n    }\r\n    loadView(url) {\r\n        const views = this.config.views;\r\n        let result = null;\r\n        if (url === \"\") {\r\n            return Promise.resolve(this._loadError(\"\", new Error(\"Webix Jet: Empty url segment\")));\r\n        }\r\n        try {\r\n            if (views) {\r\n                if (typeof views === \"function\") {\r\n                    // custom loading strategy\r\n                    result = views(url);\r\n                }\r\n                else {\r\n                    // predefined hash\r\n                    result = views[url];\r\n                }\r\n                if (typeof result === \"string\") {\r\n                    url = result;\r\n                    result = null;\r\n                }\r\n            }\r\n            if (!result) {\r\n                if (url === \"_hidden\") {\r\n                    result = { hidden: true };\r\n                }\r\n                else if (url === \"_blank\") {\r\n                    result = {};\r\n                }\r\n                else {\r\n                    url = url.replace(/\\./g, \"/\");\r\n                    result = this.require(\"jet-views\", url);\r\n                }\r\n            }\r\n        }\r\n        catch (e) {\r\n            result = this._loadError(url, e);\r\n        }\r\n        // custom handler can return view or its promise\r\n        if (!result.then) {\r\n            result = Promise.resolve(result);\r\n        }\r\n        // set error handler\r\n        result = result\r\n            .then(module => module.__esModule ? module.default : module)\r\n            .catch(err => this._loadError(url, err));\r\n        return result;\r\n    }\r\n    _forView(target, handler) {\r\n        const view = this.webix.$$(target);\r\n        if (view) {\r\n            handler(view.$scope);\r\n        }\r\n    }\r\n    _loadViewDynamic(url) {\r\n        return null;\r\n    }\r\n    createFromURL(chunk) {\r\n        let view;\r\n        if (chunk.isNew || !chunk.view) {\r\n            view = this.loadView(chunk.page)\r\n                .then(ui => this.createView(ui, name, chunk.params));\r\n        }\r\n        else {\r\n            view = Promise.resolve(chunk.view);\r\n        }\r\n        return view;\r\n    }\r\n    _override(ui) {\r\n        const over = this.config.override;\r\n        if (over) {\r\n            let dv;\r\n            while (ui) {\r\n                dv = ui;\r\n                ui = over.get(ui);\r\n            }\r\n            return dv;\r\n        }\r\n        return ui;\r\n    }\r\n    createView(ui, name, params) {\r\n        ui = this._override(ui);\r\n        let obj;\r\n        if (typeof ui === \"function\") {\r\n            if (ui.prototype instanceof JetAppBase) {\r\n                // UI class\r\n                return new ui({ app: this, name, params, router: SubRouter });\r\n            }\r\n            else if (ui.prototype instanceof JetBase) {\r\n                // UI class\r\n                return new ui(this, { name, params });\r\n            }\r\n            else {\r\n                // UI factory functions\r\n                ui = ui(this);\r\n            }\r\n        }\r\n        if (ui instanceof JetBase) {\r\n            obj = ui;\r\n        }\r\n        else {\r\n            // UI object\r\n            obj = new JetViewRaw(this, { name, ui });\r\n        }\r\n        return obj;\r\n    }\r\n    // show view path\r\n    show(url, config) {\r\n        if (url && this.app && url.indexOf(\"//\") == 0)\r\n            return this.app.show(url.substr(1), config);\r\n        return this.render(this._container, url || this.config.start, config);\r\n    }\r\n    // event helpers\r\n    trigger(name, ...rest) {\r\n        this.apply(name, rest);\r\n    }\r\n    apply(name, data) {\r\n        this.callEvent(name, data);\r\n    }\r\n    action(name) {\r\n        return this.webix.bind(function (...rest) {\r\n            this.apply(name, rest);\r\n        }, this);\r\n    }\r\n    on(name, handler) {\r\n        this.attachEvent(name, handler);\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this, null, config);\r\n    }\r\n    error(name, er) {\r\n        this.callEvent(name, er);\r\n        this.callEvent(\"app:error\", er);\r\n        /* tslint:disable */\r\n        if (this.config.debug) {\r\n            for (var i = 0; i < er.length; i++) {\r\n                console.error(er[i]);\r\n                if (er[i] instanceof Error) {\r\n                    let text = er[i].message;\r\n                    if (text.indexOf(\"Module build failed\") === 0) {\r\n                        text = text.replace(/\\x1b\\[[0-9;]*m/g, \"\");\r\n                        document.body.innerHTML = `<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>${text}</pre>`;\r\n                    }\r\n                    else {\r\n                        text += \"<br><br>Check console for more details\";\r\n                        this.webix.message({ type: \"error\", text: text, expire: -1 });\r\n                    }\r\n                }\r\n            }\r\n            debugger;\r\n        }\r\n        /* tslint:enable */\r\n    }\r\n    // renders top view\r\n    render(root, url, config) {\r\n        this._container = (typeof root === \"string\") ?\r\n            this.webix.toNode(root) :\r\n            (root || document.body);\r\n        const firstInit = !this.$router;\r\n        let path = null;\r\n        if (firstInit) {\r\n            if (_once && \"tagName\" in this._container) {\r\n                this.webix.event(document.body, \"click\", e => this.clickHandler(e));\r\n                _once = false;\r\n            }\r\n            if (typeof url === \"string\") {\r\n                url = new Route(url, 0);\r\n            }\r\n            this._subSegment = this._first_start(url);\r\n            this._subSegment.route.linkRouter = true;\r\n        }\r\n        else {\r\n            if (typeof url === \"string\") {\r\n                path = url;\r\n            }\r\n            else {\r\n                if (this.app) {\r\n                    path = url.split().route.path || this.config.start;\r\n                }\r\n                else {\r\n                    path = url.toString();\r\n                }\r\n            }\r\n        }\r\n        const params = config ? config.params : this.config.params || null;\r\n        const top = this.getSubView();\r\n        const segment = this._subSegment;\r\n        const ready = segment\r\n            .show({ url: path, params }, top)\r\n            .then(() => this.createFromURL(segment.current()))\r\n            .then(view => view.render(root, segment))\r\n            .then(base => {\r\n            this.$router.set(segment.route.path, { silent: true });\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return base;\r\n        });\r\n        this.ready = this.ready.then(() => ready);\r\n        return ready;\r\n    }\r\n    getSubView() {\r\n        if (this._subSegment) {\r\n            const view = this._subSegment.current().view;\r\n            if (view)\r\n                return view;\r\n        }\r\n        return new JetView(this, {});\r\n    }\r\n    require(type, url) { return null; }\r\n    _first_start(route) {\r\n        this._segment = route;\r\n        const cb = (a) => setTimeout(() => {\r\n            this.show(a).catch(e => {\r\n                if (!(e instanceof NavigationBlocked))\r\n                    throw e;\r\n            });\r\n        }, 1);\r\n        this.$router = new (this.config.router)(cb, this.config, this);\r\n        // start animation for top-level app\r\n        if (this._container === document.body && this.config.animation !== false) {\r\n            const node = this._container;\r\n            this.webix.html.addCss(node, \"webixappstart\");\r\n            setTimeout(() => {\r\n                this.webix.html.removeCss(node, \"webixappstart\");\r\n                this.webix.html.addCss(node, \"webixapp\");\r\n            }, 10);\r\n        }\r\n        if (!route) {\r\n            // if no url defined, check router first\r\n            let urlString = this.$router.get();\r\n            if (!urlString) {\r\n                urlString = this.config.start;\r\n                this.$router.set(urlString, { silent: true });\r\n            }\r\n            route = new Route(urlString, 0);\r\n        }\r\n        else if (this.app) {\r\n            const now = route.current().view;\r\n            route.current().view = this;\r\n            if (route.next()) {\r\n                route.refresh();\r\n                route = route.split();\r\n            }\r\n            else {\r\n                route = new Route(this.config.start, 0);\r\n            }\r\n            route.current().view = now;\r\n        }\r\n        return route;\r\n    }\r\n    // error during view resolving\r\n    _loadError(url, err) {\r\n        this.error(\"app:error:resolve\", [err, url]);\r\n        return { template: \" \" };\r\n    }\r\n    addSubView(obj, target, config) {\r\n        const url = obj.$subview !== true ? obj.$subview : null;\r\n        const name = obj.name || (url ? this.webix.uid() : \"default\");\r\n        target.id = obj.id || \"s\" + this.webix.uid();\r\n        const view = config[name] = {\r\n            id: target.id,\r\n            url,\r\n            branch: obj.branch,\r\n            popup: obj.popup,\r\n            params: obj.params\r\n        };\r\n        return view.popup ? null : target;\r\n    }\r\n}\n\nclass HashRouter {\r\n    constructor(cb, config) {\r\n        this.config = config || {};\r\n        this._detectPrefix();\r\n        this.cb = cb;\r\n        window.onpopstate = () => this.cb(this.get());\r\n    }\r\n    set(path, config) {\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            for (const key in this.config.routes) {\r\n                if (this.config.routes[key] === compare[0]) {\r\n                    path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (this.get() !== path) {\r\n            window.history.pushState(null, null, this.prefix + this.sufix + path);\r\n        }\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        let path = this._getRaw().replace(this.prefix, \"\").replace(this.sufix, \"\");\r\n        path = (path !== \"/\" && path !== \"#\") ? path : \"\";\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            const key = this.config.routes[compare[0]];\r\n            if (key) {\r\n                path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n            }\r\n        }\r\n        return path;\r\n    }\r\n    _detectPrefix() {\r\n        // use \"#!\" for backward compatibility\r\n        const sufix = this.config.routerPrefix;\r\n        this.sufix = \"#\" + ((typeof sufix === \"undefined\") ? \"!\" : sufix);\r\n        this.prefix = document.location.href.split(\"#\", 2)[0];\r\n    }\r\n    _getRaw() {\r\n        return document.location.href;\r\n    }\r\n}\n\nlet isPatched = false;\r\nfunction patch(w) {\r\n    if (isPatched || !w) {\r\n        return;\r\n    }\r\n    isPatched = true;\r\n    // custom promise for IE8\r\n    const win = window;\r\n    if (!win.Promise) {\r\n        win.Promise = w.promise;\r\n    }\r\n    const version = w.version.split(\".\");\r\n    // will be fixed in webix 5.3\r\n    if (version[0] * 10 + version[1] * 1 < 53) {\r\n        w.ui.freeze = function (handler) {\r\n            // disabled because webix jet 5.0 can't handle resize of scrollview correctly\r\n            // w.ui.$freeze = true;\r\n            const res = handler();\r\n            if (res && res.then) {\r\n                res.then(function (some) {\r\n                    w.ui.$freeze = false;\r\n                    w.ui.resize();\r\n                    return some;\r\n                });\r\n            }\r\n            else {\r\n                w.ui.$freeze = false;\r\n                w.ui.resize();\r\n            }\r\n            return res;\r\n        };\r\n    }\r\n    // adding views as classes\r\n    const baseAdd = w.ui.baselayout.prototype.addView;\r\n    const baseRemove = w.ui.baselayout.prototype.removeView;\r\n    const config = {\r\n        addView(view, index) {\r\n            // trigger logic only for widgets inside of jet-view\r\n            // ignore case when addView used with already initialized widget\r\n            if (this.$scope && this.$scope.webixJet && !view.queryView) {\r\n                const jview = this.$scope;\r\n                const subs = {};\r\n                view = jview.app.copyConfig(view, {}, subs);\r\n                baseAdd.apply(this, [view, index]);\r\n                for (const key in subs) {\r\n                    jview._renderFrame(key, subs[key], null).then(() => {\r\n                        jview._subs[key] = subs[key];\r\n                    });\r\n                }\r\n                return view.id;\r\n            }\r\n            else {\r\n                return baseAdd.apply(this, arguments);\r\n            }\r\n        },\r\n        removeView() {\r\n            baseRemove.apply(this, arguments);\r\n            if (this.$scope && this.$scope.webixJet) {\r\n                const subs = this.$scope._subs;\r\n                // check all sub-views, destroy and clean the removed one\r\n                for (const key in subs) {\r\n                    const test = subs[key];\r\n                    if (!w.$$(test.id)) {\r\n                        test.view.destructor();\r\n                        delete subs[key];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    w.extend(w.ui.layout.prototype, config, true);\r\n    w.extend(w.ui.baselayout.prototype, config, true);\r\n    // wrapper for using Jet Apps as views\r\n    w.protoUI({\r\n        name: \"jetapp\",\r\n        $init(cfg) {\r\n            this.$app = new this.app(cfg);\r\n            const id = w.uid().toString();\r\n            cfg.body = { id };\r\n            this.$ready.push(function () {\r\n                this.callEvent(\"onInit\", [this.$app]);\r\n                this.$app.render({ id });\r\n            });\r\n        }\r\n    }, w.ui.proxy, w.EventSystem);\r\n}\n\nclass JetApp extends JetAppBase {\r\n    constructor(config) {\r\n        config.router = config.router || HashRouter;\r\n        super(config);\r\n        patch(this.webix);\r\n    }\r\n    require(type, url) {\r\n        return require(type + \"/\" + url);\r\n    }\r\n}\n\nclass StoreRouter {\r\n    constructor(cb, config, app) {\r\n        this.storage = config.storage || app.webix.storage.session;\r\n        this.name = (config.storeName || config.id + \":route\");\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.storage.put(this.name, path);\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.storage.get(this.name);\r\n    }\r\n}\n\nclass UrlRouter extends HashRouter {\r\n    _detectPrefix() {\r\n        this.prefix = \"\";\r\n        this.sufix = this.config.routerPrefix || \"\";\r\n    }\r\n    _getRaw() {\r\n        return document.location.pathname + (document.location.search || \"\");\r\n    }\r\n}\n\nclass EmptyRouter {\r\n    constructor(cb, _$config) {\r\n        this.path = \"\";\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nfunction UnloadGuard(app, view, config) {\r\n    view.on(app, `app:guard`, function (_$url, point, promise) {\r\n        if (point === view || point.contains(view)) {\r\n            const res = config();\r\n            if (res === false) {\r\n                promise.confirm = Promise.reject(new NavigationBlocked());\r\n            }\r\n            else {\r\n                promise.confirm = promise.confirm.then(() => res);\r\n            }\r\n        }\r\n    });\r\n}\n\n//     (c) 2012-2018 Airbnb, Inc.\n\n// var has = require('has');\nfunction has(store, key) {\n  return Object.prototype.hasOwnProperty.call(store, key);\n}\n// var forEach = require('for-each');\nfunction forEach(obj, handler, context) {\n  for (var key in obj) {\n    if (has(obj, key)) {\n      handler.call((context || obj), obj[key], key, obj);\n    }\n  }\n}\n// var trim = require('string.prototype.trim');\nfunction trim(str) {\n  return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n}\n// var warning = require('warning');\nfunction warn(message) {\n  message = 'Warning: ' + message;\n  if (typeof console !== 'undefined') {\n    console.error(message);\n  }\n\n  try { throw new Error(message); } catch (x) {}\n}\n\nvar replace = String.prototype.replace;\nvar split = String.prototype.split;\n\n// #### Pluralization methods\n// The string that separates the different phrase possibilities.\nvar delimiter = '||||';\n\nvar russianPluralGroups = function (n) {\n  var end = n % 10;\n  if (n !== 11 && end === 1) {\n    return 0;\n  }\n  if (2 <= end && end <= 4 && !(n >= 12 && n <= 14)) {\n    return 1;\n  }\n  return 2;\n};\n\n// Mapping from pluralization group plural logic.\nvar pluralTypes = {\n  arabic: function (n) {\n    // http://www.arabeyes.org/Plural_Forms\n    if (n < 3) { return n; }\n    var lastTwo = n % 100;\n    if (lastTwo >= 3 && lastTwo <= 10) return 3;\n    return lastTwo >= 11 ? 4 : 5;\n  },\n  bosnian_serbian: russianPluralGroups,\n  chinese: function () { return 0; },\n  croatian: russianPluralGroups,\n  french: function (n) { return n > 1 ? 1 : 0; },\n  german: function (n) { return n !== 1 ? 1 : 0; },\n  russian: russianPluralGroups,\n  lithuanian: function (n) {\n    if (n % 10 === 1 && n % 100 !== 11) { return 0; }\n    return n % 10 >= 2 && n % 10 <= 9 && (n % 100 < 11 || n % 100 > 19) ? 1 : 2;\n  },\n  czech: function (n) {\n    if (n === 1) { return 0; }\n    return (n >= 2 && n <= 4) ? 1 : 2;\n  },\n  polish: function (n) {\n    if (n === 1) { return 0; }\n    var end = n % 10;\n    return 2 <= end && end <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n  },\n  icelandic: function (n) { return (n % 10 !== 1 || n % 100 === 11) ? 1 : 0; },\n  slovenian: function (n) {\n    var lastTwo = n % 100;\n    if (lastTwo === 1) {\n      return 0;\n    }\n    if (lastTwo === 2) {\n      return 1;\n    }\n    if (lastTwo === 3 || lastTwo === 4) {\n      return 2;\n    }\n    return 3;\n  }\n};\n\n\n// Mapping from pluralization group to individual language codes/locales.\n// Will look up based on exact match, if not found and it's a locale will parse the locale\n// for language code, and if that does not exist will default to 'en'\nvar pluralTypeToLanguages = {\n  arabic: ['ar'],\n  bosnian_serbian: ['bs-Latn-BA', 'bs-Cyrl-BA', 'srl-RS', 'sr-RS'],\n  chinese: ['id', 'id-ID', 'ja', 'ko', 'ko-KR', 'lo', 'ms', 'th', 'th-TH', 'zh'],\n  croatian: ['hr', 'hr-HR'],\n  german: ['fa', 'da', 'de', 'en', 'es', 'fi', 'el', 'he', 'hi-IN', 'hu', 'hu-HU', 'it', 'nl', 'no', 'pt', 'sv', 'tr'],\n  french: ['fr', 'tl', 'pt-br'],\n  russian: ['ru', 'ru-RU'],\n  lithuanian: ['lt'],\n  czech: ['cs', 'cs-CZ', 'sk'],\n  polish: ['pl'],\n  icelandic: ['is'],\n  slovenian: ['sl-SL']\n};\n\nfunction langToTypeMap(mapping) {\n  var ret = {};\n  forEach(mapping, function (langs, type) {\n    forEach(langs, function (lang) {\n      ret[lang] = type;\n    });\n  });\n  return ret;\n}\n\nfunction pluralTypeName(locale) {\n  var langToPluralType = langToTypeMap(pluralTypeToLanguages);\n  return langToPluralType[locale]\n    || langToPluralType[split.call(locale, /-/, 1)[0]]\n    || langToPluralType.en;\n}\n\nfunction pluralTypeIndex(locale, count) {\n  return pluralTypes[pluralTypeName(locale)](count);\n}\n\nfunction escape(token) {\n  return token.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction constructTokenRegex(opts) {\n  var prefix = (opts && opts.prefix) || '%{';\n  var suffix = (opts && opts.suffix) || '}';\n\n  if (prefix === delimiter || suffix === delimiter) {\n    throw new RangeError('\"' + delimiter + '\" token is reserved for pluralization');\n  }\n\n  return new RegExp(escape(prefix) + '(.*?)' + escape(suffix), 'g');\n}\n\nvar dollarRegex = /\\$/g;\nvar dollarBillsYall = '$$';\nvar defaultTokenRegex = /%\\{(.*?)\\}/g;\n\n// ### transformPhrase(phrase, substitutions, locale)\n//\n// Takes a phrase string and transforms it by choosing the correct\n// plural form and interpolating it.\n//\n//     transformPhrase('Hello, %{name}!', {name: 'Spike'});\n//     // \"Hello, Spike!\"\n//\n// The correct plural form is selected if substitutions.smart_count\n// is set. You can pass in a number instead of an Object as `substitutions`\n// as a shortcut for `smart_count`.\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 1}, 'en');\n//     // \"1 new message\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 2}, 'en');\n//     // \"2 new messages\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', 5, 'en');\n//     // \"5 new messages\"\n//\n// You should pass in a third argument, the locale, to specify the correct plural type.\n// It defaults to `'en'` with 2 plural forms.\nfunction transformPhrase(phrase, substitutions, locale, tokenRegex) {\n  if (typeof phrase !== 'string') {\n    throw new TypeError('Polyglot.transformPhrase expects argument #1 to be string');\n  }\n\n  if (substitutions == null) {\n    return phrase;\n  }\n\n  var result = phrase;\n  var interpolationRegex = tokenRegex || defaultTokenRegex;\n\n  // allow number as a pluralization shortcut\n  var options = typeof substitutions === 'number' ? { smart_count: substitutions } : substitutions;\n\n  // Select plural form: based on a phrase text that contains `n`\n  // plural forms separated by `delimiter`, a `locale`, and a `substitutions.smart_count`,\n  // choose the correct plural form. This is only done if `count` is set.\n  if (options.smart_count != null && result) {\n    var texts = split.call(result, delimiter);\n    result = trim(texts[pluralTypeIndex(locale || 'en', options.smart_count)] || texts[0]);\n  }\n\n  // Interpolate: Creates a `RegExp` object for each interpolation placeholder.\n  result = replace.call(result, interpolationRegex, function (expression, argument) {\n    if (!has(options, argument) || options[argument] == null) { return expression; }\n    // Ensure replacement value is escaped to prevent special $-prefixed regex replace tokens.\n    return replace.call(options[argument], dollarRegex, dollarBillsYall);\n  });\n\n  return result;\n}\n\n// ### Polyglot class constructor\nfunction Polyglot(options) {\n  var opts = options || {};\n  this.phrases = {};\n  this.extend(opts.phrases || {});\n  this.currentLocale = opts.locale || 'en';\n  var allowMissing = opts.allowMissing ? transformPhrase : null;\n  this.onMissingKey = typeof opts.onMissingKey === 'function' ? opts.onMissingKey : allowMissing;\n  this.warn = opts.warn || warn;\n  this.tokenRegex = constructTokenRegex(opts.interpolation);\n}\n\n// ### polyglot.locale([locale])\n//\n// Get or set locale. Internally, Polyglot only uses locale for pluralization.\nPolyglot.prototype.locale = function (newLocale) {\n  if (newLocale) this.currentLocale = newLocale;\n  return this.currentLocale;\n};\n\n// ### polyglot.extend(phrases)\n//\n// Use `extend` to tell Polyglot how to translate a given key.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The key can be any string.  Feel free to call `extend` multiple times;\n// it will override any phrases with the same key, but leave existing phrases\n// untouched.\n//\n// It is also possible to pass nested phrase objects, which get flattened\n// into an object with the nested keys concatenated using dot notation.\n//\n//     polyglot.extend({\n//       \"nav\": {\n//         \"hello\": \"Hello\",\n//         \"hello_name\": \"Hello, %{name}\",\n//         \"sidebar\": {\n//           \"welcome\": \"Welcome\"\n//         }\n//       }\n//     });\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}',\n//     //   'nav.sidebar.welcome': 'Welcome'\n//     // }\n//\n// `extend` accepts an optional second argument, `prefix`, which can be used\n// to prefix every key in the phrases object with some string, using dot\n// notation.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     }, \"nav\");\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}'\n//     // }\n//\n// This feature is used internally to support nested phrase objects.\nPolyglot.prototype.extend = function (morePhrases, prefix) {\n  forEach(morePhrases, function (phrase, key) {\n    var prefixedKey = prefix ? prefix + '.' + key : key;\n    if (typeof phrase === 'object') {\n      this.extend(phrase, prefixedKey);\n    } else {\n      this.phrases[prefixedKey] = phrase;\n    }\n  }, this);\n};\n\n// ### polyglot.unset(phrases)\n// Use `unset` to selectively remove keys from a polyglot instance.\n//\n//     polyglot.unset(\"some_key\");\n//     polyglot.unset({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The unset method can take either a string (for the key), or an object hash with\n// the keys that you would like to unset.\nPolyglot.prototype.unset = function (morePhrases, prefix) {\n  if (typeof morePhrases === 'string') {\n    delete this.phrases[morePhrases];\n  } else {\n    forEach(morePhrases, function (phrase, key) {\n      var prefixedKey = prefix ? prefix + '.' + key : key;\n      if (typeof phrase === 'object') {\n        this.unset(phrase, prefixedKey);\n      } else {\n        delete this.phrases[prefixedKey];\n      }\n    }, this);\n  }\n};\n\n// ### polyglot.clear()\n//\n// Clears all phrases. Useful for special cases, such as freeing\n// up memory if you have lots of phrases but no longer need to\n// perform any translation. Also used internally by `replace`.\nPolyglot.prototype.clear = function () {\n  this.phrases = {};\n};\n\n// ### polyglot.replace(phrases)\n//\n// Completely replace the existing phrases with a new set of phrases.\n// Normally, just use `extend` to add more phrases, but under certain\n// circumstances, you may want to make sure no old phrases are lying around.\nPolyglot.prototype.replace = function (newPhrases) {\n  this.clear();\n  this.extend(newPhrases);\n};\n\n\n// ### polyglot.t(key, options)\n//\n// The most-used method. Provide a key, and `t` will return the\n// phrase.\n//\n//     polyglot.t(\"hello\");\n//     => \"Hello\"\n//\n// The phrase value is provided first by a call to `polyglot.extend()` or\n// `polyglot.replace()`.\n//\n// Pass in an object as the second argument to perform interpolation.\n//\n//     polyglot.t(\"hello_name\", {name: \"Spike\"});\n//     => \"Hello, Spike\"\n//\n// If you like, you can provide a default value in case the phrase is missing.\n// Use the special option key \"_\" to specify a default.\n//\n//     polyglot.t(\"i_like_to_write_in_language\", {\n//       _: \"I like to write in %{language}.\",\n//       language: \"JavaScript\"\n//     });\n//     => \"I like to write in JavaScript.\"\n//\nPolyglot.prototype.t = function (key, options) {\n  var phrase, result;\n  var opts = options == null ? {} : options;\n  if (typeof this.phrases[key] === 'string') {\n    phrase = this.phrases[key];\n  } else if (typeof opts._ === 'string') {\n    phrase = opts._;\n  } else if (this.onMissingKey) {\n    var onMissingKey = this.onMissingKey;\n    result = onMissingKey(key, opts, this.currentLocale, this.tokenRegex);\n  } else {\n    this.warn('Missing translation for key: \"' + key + '\"');\n    result = key;\n  }\n  if (typeof phrase === 'string') {\n    result = transformPhrase(phrase, opts, this.currentLocale, this.tokenRegex);\n  }\n  return result;\n};\n\n\n// ### polyglot.has(key)\n//\n// Check if polyglot has a translation for given key\nPolyglot.prototype.has = function (key) {\n  return has(this.phrases, key);\n};\n\n// export transformPhrase\nPolyglot.transformPhrase = function transform(phrase, substitutions, locale) {\n  return transformPhrase(phrase, substitutions, locale);\n};\n\nvar webixPolyglot = Polyglot;\n\nfunction Locale(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let lang = storage ? (storage.get(\"lang\") || \"en\") : (config.lang || \"en\");\r\n    function setLangData(name, data, silent) {\r\n        if (data.__esModule) {\r\n            data = data.default;\r\n        }\r\n        const pconfig = { phrases: data };\r\n        if (config.polyglot) {\r\n            app.webix.extend(pconfig, config.polyglot);\r\n        }\r\n        const poly = service.polyglot = new webixPolyglot(pconfig);\r\n        poly.locale(name);\r\n        service._ = app.webix.bind(poly.t, poly);\r\n        lang = name;\r\n        if (storage) {\r\n            storage.put(\"lang\", lang);\r\n        }\r\n        if (config.webix) {\r\n            const locName = config.webix[name];\r\n            if (locName) {\r\n                app.webix.i18n.setLocale(locName);\r\n            }\r\n        }\r\n        if (!silent) {\r\n            return app.refresh();\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    function getLang() { return lang; }\r\n    function setLang(name, silent) {\r\n        // ignore setLang if loading by path is disabled\r\n        if (config.path === false) {\r\n            return;\r\n        }\r\n        const path = (config.path ? config.path + \"/\" : \"\") + name;\r\n        const data = app.require(\"jet-locales\", path);\r\n        setLangData(name, data, silent);\r\n    }\r\n    const service = {\r\n        getLang, setLang, setLangData, _: null, polyglot: null\r\n    };\r\n    app.setService(\"locale\", service);\r\n    setLang(lang, true);\r\n}\n\nfunction show(view, config, value) {\r\n    if (config.urls) {\r\n        value = config.urls[value] || value;\r\n    }\r\n    else if (config.param) {\r\n        value = { [config.param]: value };\r\n    }\r\n    view.show(value);\r\n}\r\nfunction Menu(app, view, config) {\r\n    const frame = view.getSubViewInfo().parent;\r\n    const ui = view.$$(config.id || config);\r\n    let silent = false;\r\n    ui.attachEvent(\"onchange\", function () {\r\n        if (!silent) {\r\n            show(frame, config, this.getValue());\r\n        }\r\n    });\r\n    ui.attachEvent(\"onafterselect\", function () {\r\n        if (!silent) {\r\n            let id = null;\r\n            if (ui.setValue) {\r\n                id = this.getValue();\r\n            }\r\n            else if (ui.getSelectedId) {\r\n                id = ui.getSelectedId();\r\n            }\r\n            show(frame, config, id);\r\n        }\r\n    });\r\n    view.on(app, `app:route`, function () {\r\n        let name = \"\";\r\n        if (config.param) {\r\n            name = view.getParam(config.param, true);\r\n        }\r\n        else {\r\n            const segment = frame.getUrl()[1];\r\n            if (segment) {\r\n                name = segment.page;\r\n            }\r\n        }\r\n        if (name) {\r\n            silent = true;\r\n            if (ui.setValue && ui.getValue() !== name) {\r\n                ui.setValue(name);\r\n            }\r\n            else if (ui.select && ui.exists(name) && ui.getSelectedId() !== name) {\r\n                ui.select(name);\r\n            }\r\n            silent = false;\r\n        }\r\n    });\r\n}\n\nconst baseicons = {\r\n    good: \"check\",\r\n    error: \"warning\",\r\n    saving: \"refresh fa-spin\"\r\n};\r\nconst basetext = {\r\n    good: \"Ok\",\r\n    error: \"Error\",\r\n    saving: \"Connecting...\"\r\n};\r\nfunction Status(app, view, config) {\r\n    let status = \"good\";\r\n    let count = 0;\r\n    let iserror = false;\r\n    let expireDelay = config.expire;\r\n    if (!expireDelay && expireDelay !== false) {\r\n        expireDelay = 2000;\r\n    }\r\n    const texts = config.texts || basetext;\r\n    const icons = config.icons || baseicons;\r\n    if (typeof config === \"string\") {\r\n        config = { target: config };\r\n    }\r\n    function refresh(content) {\r\n        const area = view.$$(config.target);\r\n        if (area) {\r\n            if (!content) {\r\n                content = \"<div class='status_\" +\r\n                    status +\r\n                    \"'><span class='webix_icon fa-\" +\r\n                    icons[status] + \"'></span> \" + texts[status] + \"</div>\";\r\n            }\r\n            area.setHTML(content);\r\n        }\r\n    }\r\n    function success() {\r\n        count--;\r\n        setStatus(\"good\");\r\n    }\r\n    function fail(err) {\r\n        count--;\r\n        setStatus(\"error\", err);\r\n    }\r\n    function start(promise) {\r\n        count++;\r\n        setStatus(\"saving\");\r\n        if (promise && promise.then) {\r\n            promise.then(success, fail);\r\n        }\r\n    }\r\n    function getStatus() {\r\n        return status;\r\n    }\r\n    function hideStatus() {\r\n        if (count === 0) {\r\n            refresh(\" \");\r\n        }\r\n    }\r\n    function setStatus(mode, err) {\r\n        if (count < 0) {\r\n            count = 0;\r\n        }\r\n        if (mode === \"saving\") {\r\n            status = \"saving\";\r\n            refresh();\r\n        }\r\n        else {\r\n            iserror = (mode === \"error\");\r\n            if (count === 0) {\r\n                status = iserror ? \"error\" : \"good\";\r\n                if (iserror) {\r\n                    app.error(\"app:error:server\", [err.responseText || err]);\r\n                }\r\n                else {\r\n                    if (expireDelay) {\r\n                        setTimeout(hideStatus, expireDelay);\r\n                    }\r\n                }\r\n                refresh();\r\n            }\r\n        }\r\n    }\r\n    function track(data) {\r\n        const dp = app.webix.dp(data);\r\n        if (dp) {\r\n            view.on(dp, \"onAfterDataSend\", start);\r\n            view.on(dp, \"onAfterSaveError\", (_id, _obj, response) => fail(response));\r\n            view.on(dp, \"onAfterSave\", success);\r\n        }\r\n    }\r\n    app.setService(\"status\", {\r\n        getStatus,\r\n        setStatus,\r\n        track\r\n    });\r\n    if (config.remote) {\r\n        view.on(app.webix, \"onRemoteCall\", start);\r\n    }\r\n    if (config.ajax) {\r\n        view.on(app.webix, \"onBeforeAjax\", (_mode, _url, _data, _request, _headers, _files, promise) => {\r\n            start(promise);\r\n        });\r\n    }\r\n    if (config.data) {\r\n        track(config.data);\r\n    }\r\n}\n\nfunction Theme(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let theme = storage ?\r\n        (storage.get(\"theme\") || \"flat-default\")\r\n        :\r\n            (config.theme || \"flat-default\");\r\n    const service = {\r\n        getTheme() { return theme; },\r\n        setTheme(name, silent) {\r\n            const parts = name.split(\"-\");\r\n            const links = document.getElementsByTagName(\"link\");\r\n            for (let i = 0; i < links.length; i++) {\r\n                const lname = links[i].getAttribute(\"title\");\r\n                if (lname) {\r\n                    if (lname === name || lname === parts[0]) {\r\n                        links[i].disabled = false;\r\n                    }\r\n                    else {\r\n                        links[i].disabled = true;\r\n                    }\r\n                }\r\n            }\r\n            app.webix.skin.set(parts[0]);\r\n            // remove old css\r\n            app.webix.html.removeCss(document.body, \"theme-\" + theme);\r\n            // add new css\r\n            app.webix.html.addCss(document.body, \"theme-\" + name);\r\n            theme = name;\r\n            if (storage) {\r\n                storage.put(\"theme\", name);\r\n            }\r\n            if (!silent) {\r\n                app.refresh();\r\n            }\r\n        }\r\n    };\r\n    app.setService(\"theme\", service);\r\n    service.setTheme(theme, true);\r\n}\n\nfunction copyParams(data, url, route) {\r\n    for (let i = 0; i < route.length; i++) {\r\n        data[route[i]] = url[i + 1] ? url[i + 1].page : \"\";\r\n    }\r\n}\r\nfunction UrlParam(app, view, config) {\r\n    const route = config.route || config;\r\n    const data = {};\r\n    view.on(app, \"app:urlchange\", function (subview, segment) {\r\n        if (view === subview) {\r\n            copyParams(data, segment.suburl(), route);\r\n            segment.size(route.length + 1);\r\n        }\r\n    });\r\n    const os = view.setParam;\r\n    const og = view.getParam;\r\n    view.setParam = function (name, value, show) {\r\n        const index = route.indexOf(name);\r\n        if (index >= 0) {\r\n            data[name] = value;\r\n            this._segment.update(\"\", value, index + 1);\r\n            if (show) {\r\n                return view.show(null);\r\n            }\r\n        }\r\n        else {\r\n            return os.call(this, name, value, show);\r\n        }\r\n    };\r\n    view.getParam = function (key, mode) {\r\n        const val = data[key];\r\n        if (typeof val !== \"undefined\") {\r\n            return val;\r\n        }\r\n        return og.call(this, key, mode);\r\n    };\r\n    copyParams(data, view.getUrl(), route);\r\n}\n\nfunction User(app, _view, config) {\r\n    config = config || {};\r\n    const login = config.login || \"/login\";\r\n    const logout = config.logout || \"/logout\";\r\n    const afterLogin = config.afterLogin || app.config.start;\r\n    const afterLogout = config.afterLogout || \"/login\";\r\n    const ping = config.ping || 5 * 60 * 1000;\r\n    const model = config.model;\r\n    let user = config.user;\r\n    const service = {\r\n        getUser() {\r\n            return user;\r\n        },\r\n        getStatus(server) {\r\n            if (!server) {\r\n                return user !== null;\r\n            }\r\n            return model.status().catch(() => null).then(data => {\r\n                user = data;\r\n            });\r\n        },\r\n        login(name, pass) {\r\n            return model.login(name, pass).then(data => {\r\n                user = data;\r\n                if (!data) {\r\n                    throw new Error(\"Access denied\");\r\n                }\r\n                app.callEvent(\"app:user:login\", [user]);\r\n                app.show(afterLogin);\r\n            });\r\n        },\r\n        logout() {\r\n            user = null;\r\n            return model.logout().then(res => {\r\n                app.callEvent(\"app:user:logout\", []);\r\n                return res;\r\n            });\r\n        }\r\n    };\r\n    function canNavigate(url, obj) {\r\n        if (url === logout) {\r\n            service.logout();\r\n            obj.redirect = afterLogout;\r\n        }\r\n        else if (url !== login && !service.getStatus()) {\r\n            obj.redirect = login;\r\n        }\r\n    }\r\n    app.setService(\"user\", service);\r\n    app.attachEvent(`app:guard`, function (url, _$root, obj) {\r\n        if (config.public && config.public(url)) {\r\n            return true;\r\n        }\r\n        if (typeof user === \"undefined\") {\r\n            obj.confirm = service.getStatus(true).then(() => canNavigate(url, obj));\r\n        }\r\n        return canNavigate(url, obj);\r\n    });\r\n    if (ping) {\r\n        setInterval(() => service.getStatus(true), ping);\r\n    }\r\n}\n\n/*\r\nMIT License\r\nCopyright (c) 2019 XB Software\r\n*/\r\nlet webix = window.webix;\r\nif (webix) {\r\n    patch(webix);\r\n}\r\nconst plugins = {\r\n    UnloadGuard, Locale, Menu, Theme, User, Status, UrlParam\r\n};\r\nconst errors = { NavigationBlocked };\r\nconst w = window;\r\nif (!w.Promise) {\r\n    w.Promise = w.webix.promise;\r\n}\n\nexport { plugins, errors, JetApp, JetView, HashRouter, StoreRouter, UrlRouter, EmptyRouter, SubRouter };\n//# sourceMappingURL=jet.js.map\n","var index = 1;\nfunction uid() {\n\treturn index++;\n}\n\nvar empty = undefined;\n\nexport function ignoreInitial(code) {\n\tlet init = false;\n\treturn function() {\n\t\tif (init) return code.apply(this, arguments);\n\t\telse init = true;\n\t};\n}\n\nvar context = null;\nexport function withContext(value, code) {\n\tcontext = value;\n\tcode();\n\tcontext = null;\n}\n\nexport function filter(rule, handler) {\n\treturn function(v, o, obj, meta) {\n\t\tif (rule(v, meta)) handler.apply(this, arguments);\n\t};\n}\n\nexport function link(source, target, key) {\n\tObject.defineProperty(target, key, {\n\t\tget: () => source[key],\n\t\tset: value => (source[key] = value),\n\t});\n}\n\nexport function debounce(handler, delay) {\n\tdelay = delay || 200;\n\tlet timer = null;\n\tlet data = null;\n\treturn function() {\n\t\tdata = arguments;\n\t\tif (!timer) {\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttimer = null;\n\n\t\t\t\thandler.apply(this, data);\n\t\t\t}, delay);\n\t\t}\n\t};\n}\n\nexport function createState(data, config) {\n\tconfig = config || {};\n\tconst handlers = {};\n\tconst out = {};\n\n\tconst observe = function(mask, handler) {\n\t\tconst key = uid();\n\t\thandlers[key] = { mask, handler };\n\t\tif (mask === \"*\") handler(out, empty, mask);\n\t\telse handler(out[mask], empty, mask);\n\n\t\treturn key;\n\t};\n\n\tconst extend = function(data, sconfig){\n\t\tsconfig = sconfig || config;\n\t\t// normal js object\n\t\tfor (const key in data) {\n\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\tconst test = data[key];\n\t\t\t\tif (sconfig.nested && typeof test === \"object\" && test) {\n\t\t\t\t\tout[key] = createState(test, sconfig);\n\t\t\t\t} else {\n\t\t\t\t\treactive(out, test, key, notify);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tconst observeEnd = function(id) {\n\t\tdelete handlers[id];\n\t};\n\n\tconst queue = [];\n\tlet waitInQueue = false;\n\n\tvar batch = function(code) {\n\t\tif (typeof code !== \"function\") {\n\t\t\tconst values = code;\n\t\t\tcode = () => {\n\t\t\t\tfor (const key in values) out[key] = values[key];\n\t\t\t};\n\t\t}\n\n\t\twaitInQueue = true;\n\t\tcode(out);\n\t\twaitInQueue = false;\n\t\twhile (queue.length) {\n\t\t\tconst obj = queue.shift();\n\t\t\tnotify.apply(this, obj);\n\t\t}\n\t};\n\n\tconst notify = function(key, old, value, meta) {\n\t\tif (waitInQueue) {\n\t\t\tqueue.push([key, old, value, meta]);\n\t\t\treturn;\n\t\t}\n\n\t\tconst list = Object.keys(handlers);\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tconst obj = handlers[list[i]];\n\t\t\tif (!obj) continue;\n\t\t\tif (obj.mask === \"*\" || obj.mask === key) {\n\t\t\t\tobj.handler(value, old, key, meta);\n\t\t\t}\n\t\t}\n\t};\n\n\tObject.defineProperty(out, \"$changes\", {\n\t\tvalue: {\n\t\t\tattachEvent: observe,\n\t\t\tdetachEvent: observeEnd,\n\t\t},\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$observe\", {\n\t\tvalue: observe,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$batch\", {\n\t\tvalue: batch,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$extend\", {\n\t\tvalue: extend,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\n\tout.$extend(data, config);\n\treturn out;\n}\n\nfunction reactive(obj, val, key, notify) {\n\tObject.defineProperty(obj, key, {\n\t\tget: function() {\n\t\t\treturn val;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar changed = false;\n\t\t\tif (val === null || value === null) {\n\t\t\t\tchanged = val !== value;\n\t\t\t} else {\n\t\t\t\tchanged = val.valueOf() != value.valueOf();\n\t\t\t}\n\n\t\t\tif (changed) {\n\t\t\t\tvar old = val;\n\t\t\t\tval = value;\n\t\t\t\tnotify(key, old, value, context);\n\t\t\t}\n\t\t},\n\t\tenumerable: true,\n\t\tconfigurable: false,\n\t});\n}","let once = false;\n\nexport function initRLayout(){\n    if (once) return;\n    once = true;\n\n    webix.protoUI(\n        {\n            name: \"r-layout\",\n            sizeTrigger(app, handler, value) {\n                this._compactValue = value;\n                this._compactHandler = handler;\n                this._app = app;\n\n                const config = app.config;\n                this._forceCompact = typeof config.params.forceCompact !== \"undefined\";\n                this._compactWidth = config.compactWidth;\n\n                if (!this._forceCompact) this._checkTrigger(this.$view.width, value);\n            },\n            _checkTrigger(x, value) {\n                if (this._compactWidth) {\n                    if (\n                        (x <= this._compactWidth && !value) ||\n                        (x > this._compactWidth && value)\n                    ) {\n                        this._compactWidth = null;\n                        this._compactHandler(!value);\n                        return false;\n                    }\n                }\n                return true;\n            },\n            $setSize(x, y) {\n                if (this._forceCompact || this._checkTrigger(x, this._compactValue))\n                    webix.ui.layout.prototype.$setSize.call(this, x, y);\n                if (this._app) this._app.callEvent(\"view:resize\", []); //edit popup resize\n            },\n        },\n        webix.ui.layout\n    );\n}\n","export function initJetWin(app) {\n\tlet appId;\n\n\tconst service = {\n\t\tupdateConfig(config){\n\t\t\tconst appView = app.getRoot();\n\t\t\tconst appNode = appView.$view;\n\n\t\t\tif(!appId){\n\t\t\t\tif(appNode.id)\n\t\t\t\t\tappId = appNode.id;\n\t\t\t\telse \n\t\t\t\t\tappNode.id = appId = \"webix_\" + webix.uid();\n\n\t\t\t\twebix.html.addStyle(`.webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }`);\n\t\t\t\twebix.html.addStyle(`#${appId}{ position: relative; }`);\n\t\t\t\twebix.html.addStyle(`#${appId} .webix_window{ z-index:2 !important; }`);\n\t\t\t\twebix.html.addStyle(`#${appId} .webix_disabled{ z-index:1 !important; }`);\n\t\t\t}\n\t\t\telse if(appId && !appNode.id) //app refresh\n\t\t\t\tappNode.id = appId;\n\n\t\t\tconfig.container = appId;\n\n\t\t\tif(config.fullscreen){\n\t\t\t\tconfig._fillApp = true;\n\t\t\t\tdelete config.fullscreen;\n\t\t\t}\n\n\t\t\tif(!config.on)\n\t\t\t\tconfig.on = {};\n\n\t\t\tlet firstShow = true;\n\t\t\tconst defaultHandler = config.on.onShow;\n\n\t\t\tconfig.on.onShow = function(){\n\t\t\t\tif(defaultHandler)\n\t\t\t\t\tdefaultHandler.apply(this, arguments);\n\n\t\t\t\tif(firstShow){\n\t\t\t\t\tthis.$setSize = (x, y) => {\n\t\t\t\t\t\tsetSize(this, appView, true);\n\t\t\t\t\t\twebix.ui.window.prototype.$setSize.apply(this, [x, y]);\n\t\t\t\t\t};\n\t\t\t\t\tsetHandlers(this, app);\n\t\t\t\t\tfirstShow = null;\n\t\t\t\t}\n\n\t\t\t\twebix.callEvent(\"onClick\", []);\n\t\t\t\twebix.html.addCss(appNode, \"webix_win_inside\");\n\t\t\t\tappView.disable();\n\n\t\t\t\tsetSize(this, appView);\n\t\t\t}\n\n\t\t\treturn config;\n\t\t}\n\t};\n\n\tapp.setService(\"jet-win\", service);\n}\n\nfunction setSize(win, appView, silent){\n\tconst appWidth = appView.$width;\n\tconst appHeight = appView.$height;\n\n\tif(win.config._fillApp)\n\t\twin.define({\n\t\t\twidth: appWidth,\n\t\t\theight: appHeight,\n\t\t});\n\telse {\n\t\twin.define({\n\t\t\tleft: (appWidth - win.$width) / 2,\n\t\t\ttop: (appHeight - win.$height) / 2,\n\t\t});\n\t}\n\n\tif(!silent)\n\t\twin.resize();\n}\n\nfunction setHandlers(win, app){\n\tconst appView = app.getRoot();\n\n\twin.attachEvent(\"onHide\", ()=> {\n\t\tif(!appView.$destructed){\n\t\t\twebix.html.removeCss(appView.$view, \"webix_win_inside\");\n\t\t\tappView.enable();\n\t\t}\n\t});\n\n\tconst resizeEv = app.attachEvent(\"view:resize\", ()=> {\n\t\tsetSize(win, appView);\n\t});\n\n\twin.attachEvent(\"onDestruct\", ()=> {\n\t\tapp.detachEvent(resizeEv);\n\t});\n}\n","export function waitVisible(view){\n\tconst promise = webix.promise.defer();\n\n\tconst interval = setInterval(()=> {\n\t\tconst destructed = view.$destructed;\n\t\tif(destructed || view.isVisible()){\n\t\t\tif(destructed)\n\t\t\t\tpromise.reject();\n\t\t\telse\n\t\t\t\tpromise.resolve();\n\t\t\tclearInterval(interval);\n\t\t}\n\t}, 300);\n\n\treturn promise;\n}","import { JetView } from \"webix-jet\";\n\nexport default class AddView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst cals = this.app.config.calendars;\n\n\t\tconst ui = {\n\t\t\tview: compact ? \"icon\" : \"button\",\n\t\t\ttype: \"icon\",\n\t\t\ticon: \"wxi-plus\",\n\t\t\tcss: \"webix_primary\",\n\t\t\tlabel: _(\"Create\"),\n\t\t\twidth: compact ? 50 : cals ? 185 : 100,\n\t\t\theight: compact ? 50 : webix.skin.$active.inputHeight,\n\t\t\ton: {\n\t\t\t\tonItemClick: () => this.AddEvent(),\n\t\t\t},\n\t\t};\n\n\t\treturn { view: \"align\", body: ui, align: \"middle\" };\n\t}\n\n\tAddEvent() {\n\t\tthis.app.getState().selected = { id: \"0\" };\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class DateView extends JetView {\n\tconfig() {\n\t\tconst toolbar = [\n\t\t\t{\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-angle-left\",\n\t\t\t\ttooltip: () => this.NavLabel(-1),\n\t\t\t\talign: \"left\",\n\t\t\t\ton: { onItemClick: () => this.ChangeDate(-1) },\n\t\t\t},\n\t\t\t{ view: \"label\", localId: \"title\", align: \"center\", width: 160 },\n\t\t\t{\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-angle-right\",\n\t\t\t\ttooltip: () => this.NavLabel(1),\n\t\t\t\talign: \"right\",\n\t\t\t\ton: { onItemClick: () => this.ChangeDate(1) },\n\t\t\t},\n\t\t];\n\n\t\treturn {\n\t\t\tcols: toolbar,\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.on(this.State.$changes, \"date\", () => this.DateLabel());\n\t\tthis.on(this.State.$changes, \"mode\", () => this.DateLabel());\n\t\tif (this.app.config.timeline)\n\t\t\tthis.on(this.State.$changes, \"timelineMode\", () => this.DateLabel());\n\t}\n\n\tChangeDate(dir) {\n\t\tconst state = this.State;\n\t\tconst step = this.GetStep(state.mode);\n\t\tconst next = webix.Date.add(state.date, dir, step, true);\n\n\t\t// fix navigation in month mode when last day of month is selected\n\t\tif (state.mode === \"month\") {\n\t\t\tconst diff = Math.abs(state.date.getMonth() - next.getMonth());\n\t\t\tif (diff != 1 && diff < 6) next.setDate(0);\n\t\t}\n\n\t\tstate.$batch({\n\t\t\tdate: next,\n\t\t\tselected: null,\n\t\t});\n\t}\n\n\tGetStep(mode) {\n\t\tswitch (mode) {\n\t\t\tcase \"agenda\":\n\t\t\t\treturn \"month\";\n\t\t\tcase \"units\":\n\t\t\t\treturn \"day\";\n\t\t\tcase \"timeline\":\n\t\t\t\treturn this.State.timelineMode;\n\t\t\tdefault:\n\t\t\t\treturn mode;\n\t\t}\n\t}\n\n\tDateLabel() {\n\t\tconst date = this.State.date;\n\t\tconst mode = this.State.mode;\n\t\tlet format = webix.Date.dateToStr(\"%F %Y\");\n\t\tif (mode === \"year\") format = webix.Date.dateToStr(\"%Y\");\n\t\telse if (\n\t\t\tmode == \"day\" ||\n\t\t\tmode == \"units\" ||\n\t\t\t(mode == \"timeline\" && this.State.timelineMode == \"day\")\n\t\t)\n\t\t\tformat = webix.i18n.longDateFormatStr;\n\n\t\tthis.$$(\"title\").setHTML(format(date));\n\t}\n\n\tNavLabel(dir) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst modes = [\"month\", \"week\", \"day\"];\n\t\tlet mode = this.State.mode;\n\t\tmode = modes.indexOf(mode) !== -1 ? ` ${mode}` : \"\";\n\n\t\tdir = dir > 0 ? \"Next\" : \"Previous\";\n\n\t\treturn _(dir + mode);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class NavBarView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst units = !!this.app.config.units;\n\n\t\tconst toolbar = {\n\t\t\thidden: compact,\n\t\t\tview: \"tabbar\",\n\t\t\tbottomOffset: 0,\n\t\t\tlocalId: \"buttons\",\n\t\t\tborderless: true,\n\t\t\twidth: 320,\n\t\t\toptionWidth: 80,\n\t\t\toptions: [\n\t\t\t\t{ id: \"day\", value: _(\"Day\") },\n\t\t\t\t{ id: \"week\", value: _(\"Week\") },\n\t\t\t\t{ id: \"month\", value: _(\"Month\") },\n\t\t\t\t{ id: \"agenda\", value: _(\"Agenda\") },\n\t\t\t\t{ id: \"year\", value: _(\"Year\") },\n\t\t\t],\n\t\t};\n\n\t\tif (this.app.config.timeline) {\n\t\t\ttoolbar.width += 80;\n\t\t\ttoolbar.options.push({ id: \"timeline\", value: _(\"Timeline\") });\n\t\t}\n\n\t\tif (!compact) {\n\t\t\ttoolbar.on = { onChange: val => this.SetMode(val) };\n\t\t}\n\n\t\tif (units) {\n\t\t\ttoolbar.width += 80;\n\t\t\ttoolbar.options.push({ id: \"units\", value: _(\"Units\") });\n\t\t}\n\n\t\treturn toolbar;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.on(this.State.$changes, \"mode\", val => {\n\t\t\tthis.$$(\"buttons\").setValue(val);\n\t\t});\n\t}\n\tSetMode(val) {\n\t\tthis.State.$batch({\n\t\t\tmode: val,\n\t\t\tselected: null,\n\t\t});\n\t}\n}\n","const defaultPalette = [\n\t[\"#61AEE6\", \"#01C2A5\", \"#E88DD9\", \"#D2FB9E\", \"#6BA8CB\", \"#61BBA5\", \"#CF89D5\"],\n\t[\"#EF9C80\", \"#8289EE\", \"#74B1A7\", \"#DD89AF\", \"#E48882\", \"#997CEB\", \"#ADD579\"],\n\t[\"#F68896\", \"#FFE999\", \"#6D4BCE\", \"#99CA58\", \"#D352BE\", \"#F7CC34\", \"#DA5C53\"],\n];\nconst modernPalette = [\n\t[\"#5890DC\", \"#3AA3E3\", \"#045AA3\", \"#014593\", \"#01C2A5\", \"#61A649\", \"#157B7A\"],\n\t[\"#04864F\", \"#AD44AB\", \"#CB61C8\", \"#AC3C6E\", \"#BA282E\", \"#BD4E1B\", \"#B87728\"],\n\t[\"#B65F06\", \"#7A67EB\", \"#4536AD\", \"#282A8A\", \"#36337E\", \"#585B85\", \"#2A2F50\"],\n];\nconst palettes = {\n\tmaterial: defaultPalette,\n\tmini: defaultPalette,\n\tflat: defaultPalette,\n\tcompact: defaultPalette,\n\tcontrast: defaultPalette,\n\twillow: modernPalette,\n\tdark: modernPalette,\n};\n\nexport default function getPalette() {\n\tconst aSkin = webix.skin.$active;\n\treturn {\n\t\tview: \"colorboard\",\n\t\tcss: \"webix_scheduler_palette\",\n\t\theight: aSkin.optionHeight * 3 + 4,\n\t\twidth: aSkin.optionHeight * 7 + 4,\n\t\tpalette: palettes[webix.skin.$name],\n\t};\n}\n","import { JetView } from \"webix-jet\";\nimport getPalette from \"helpers/palette\";\n\nexport default class SidePopupView extends JetView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst save = {\n\t\t\tview: \"button\",\n\t\t\tvalue: _(\"Save\"),\n\t\t\talign: \"right\",\n\t\t\tinputWidth: 100,\n\t\t\tcss: \"webix_primary\",\n\t\t\tclick: () => this.Save(),\n\t\t};\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst compactBar = {\n\t\t\tview: \"toolbar\",\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: aSkin.layoutPadding.form,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{ view: \"icon\", icon: \"wxi-close\", click: () => this.getRoot().hide() },\n\t\t\t\t{},\n\t\t\t\tsave,\n\t\t\t],\n\t\t};\n\n\t\tconst controls = [\n\t\t\t{\n\t\t\t\tview: \"button\",\n\t\t\t\tlocalId: \"removeBtn\",\n\t\t\t\tvalue: _(\"Delete\"),\n\t\t\t\tcss: \"webix_danger webix_scheduler_danger\",\n\t\t\t\thidden: true,\n\t\t\t\talign: compact ? \"center\" : \"left\",\n\t\t\t\tinputWidth: compact ? 330 : 100,\n\t\t\t\tclick: () => this.Delete(),\n\t\t\t},\n\t\t];\n\n\t\tif (!compact) controls.push(save);\n\n\t\tconst ui = this.app.getService(\"jet-win\").updateConfig({\n\t\t\tview: \"window\",\n\t\t\twidth: 400,\n\t\t\tclose: true,\n\t\t\tborderless: compact,\n\t\t\tfullscreen: compact,\n\t\t\tcss: \"webix_scheduler_cal_popup\",\n\t\t\thead: compact ? compactBar : _(\"Edit calendar\"),\n\t\t\tbody: {\n\t\t\t\tview: \"form\",\n\t\t\t\tlocalId: \"calendars:form\",\n\t\t\t\telements: [\n\t\t\t\t\t{ view: \"text\", label: _(\"Title\"), name: \"text\" },\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"colorpicker\",\n\t\t\t\t\t\tlabel: _(\"Color\"),\n\t\t\t\t\t\tname: \"color\",\n\t\t\t\t\t\tsuggest: {\n\t\t\t\t\t\t\ttype: \"colorboard\",\n\t\t\t\t\t\t\tpadding: 3,\n\t\t\t\t\t\t\tbody: getPalette(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{ view: \"checkbox\", label: _(\"Active\"), name: \"active\" },\n\t\t\t\t\t{ cols: controls },\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => {\n\t\t\t\t\tthis.Form.clear();\n\t\t\t\t\tthis.$$(\"removeBtn\").hide();\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tif (compact) ui.body.elements.splice(3, 0, {});\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.Cals = this.app.getService(\"local\").calendars(true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tthis.Form = this.$$(\"calendars:form\");\n\t}\n\n\tShow(id) {\n\t\tif (id) {\n\t\t\tconst obj = this.Cals.getItem(id);\n\t\t\tthis.Form.setValues(obj);\n\t\t\tthis.$$(\"removeBtn\").show();\n\t\t} else {\n\t\t\tthis.Form.setValues({\n\t\t\t\tcolor: \"#997CEB\",\n\t\t\t\tactive: 1,\n\t\t\t});\n\t\t}\n\t\tthis.getRoot().show();\n\t\tthis.Form.focus();\n\t}\n\n\tSave() {\n\t\tconst obj = this.Form.getValues();\n\t\tif (obj.id) this.Ops.updateCalendar(obj.id, obj);\n\t\telse this.Ops.addCalendar(obj);\n\t\tthis.getRoot().hide();\n\t}\n\n\tDelete() {\n\t\tconst obj = this.Form.getValues();\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\ttext: _(\"Do you really want to remove this calendar?\"),\n\t\t\t\tcontainer: this.app.getRoot().$view,\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tthis.Ops.removeCalendar(obj.id);\n\t\t\t\tthis.getRoot().hide();\n\t\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport EditorView from \"./editor\";\nimport getPalette from \"helpers/palette\";\nimport { waitVisible } from \"@xbs/jet-helpers\";\n\nexport default class SidePopupView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst ui = {\n\t\t\tview: \"popup\",\n\t\t\trelative: \"right\",\n\t\t\tbody: {\n\t\t\t\trows: [\n\t\t\t\t\twebix.extend(getPalette(), {\n\t\t\t\t\t\tlocalId: \"colors\",\n\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\tonItemClick: val => this.UpdateColor(val),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\t{\n\t\t\t\t\t\tcss: \"webix_scheduler_settings\",\n\t\t\t\t\t\ttemplate: _(\"Settings\"),\n\t\t\t\t\t\theight: webix.skin.$active.inputHeight,\n\t\t\t\t\t\tonClick: {\n\t\t\t\t\t\t\twebix_template: () => this.ShowEditor(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => this.app.callEvent(\"side:popup:hide\", []),\n\t\t\t},\n\t\t};\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\twaitVisible(this.getRoot()).then(() => {\n\t\t\tthis.Editor = this.ui(EditorView);\n\t\t});\n\t}\n\n\tShow(id, node, color) {\n\t\tthis.Cid = id;\n\t\tthis.getRoot().show(node);\n\t\tthis.$$(\"colors\").setValue(color);\n\t}\n\n\tShowEditor() {\n\t\tthis.Editor.Show(this.Cid);\n\t\tthis.getRoot().hide();\n\t}\n\n\tUpdateColor(val) {\n\t\tthis.app.getService(\"operations\").updateCalendar(this.Cid, {\n\t\t\tcolor: val,\n\t\t});\n\t\tthis.getRoot().hide();\n\t}\n\n\tHide() {\n\t\tthis.getRoot().hide();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport PopupView from \"./popup\";\nimport EditorView from \"./editor\";\n\nexport default class SideView extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.app.getState();\n\n\t\tconst calendar = {\n\t\t\tview: \"calendar\",\n\t\t\tlocalId: \"calendar\",\n\t\t\theight: 276,\n\t\t\tmonthSelect: false,\n\t\t\ton: {\n\t\t\t\tonAfterDateSelect: date => {\n\t\t\t\t\tstate.date = webix.Date.dayStart(date);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tconst list = {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"calendars\",\n\t\t\ttype: this.ListType(_, state),\n\t\t\tborderless: true,\n\t\t\tautoheight: true,\n\t\t\tyCount: 5,\n\t\t\teditable: true,\n\t\t\teditValue: \"text\",\n\t\t\teditaction: \"custom\",\n\t\t\teditor: \"text\",\n\t\t\tcss: \"webix_scheduler_cal_list\",\n\t\t\ttooltip: () => \"\",\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_cal_edit: (e, id) => this.ShowPopup(e, id),\n\t\t\t\twebix_scheduler_cal_title: (e, id) => this.ToggleCalendar(id),\n\t\t\t\twebix_scheduler_active: (e, id) => this.ToggleCalendar(id),\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonBeforeEditStop: (v, editor) => this.SetTitle(editor.id, v.value),\n\t\t\t},\n\t\t};\n\n\t\tconst rows = [\n\t\t\t{ maxHeight: 100 },\n\t\t\tlist,\n\t\t\t{\n\t\t\t\tview: \"button\",\n\t\t\t\tlocalId: \"add\",\n\t\t\t\tvalue: _(\"Add calendar\"),\n\t\t\t\thidden: !state.readonly,\n\t\t\t\tinputWidth: 190,\n\t\t\t\talign: \"center\",\n\t\t\t\tclick: () => this.AddCalendar(),\n\t\t\t},\n\t\t\t{},\n\t\t];\n\n\t\tlet side = {\n\t\t\ttype: \"form\",\n\t\t\tpadding: { top: 8 },\n\t\t\trows: rows,\n\t\t};\n\n\t\tif (!this.Compact) {\n\t\t\tlist.on.onAfterScroll = () => this.Popup.Hide();\n\t\t\tside = {\n\t\t\t\tview: \"scrollview\",\n\t\t\t\tbody: {\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\trows: [calendar, side],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\treturn side;\n\t}\n\n\tinit() {\n\t\tthis.Cals = this.$$(\"calendars\");\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tthis.Ops = this.app.getService(\"operations\");\n\n\t\tthis.Popup = this.Compact ? this.ui(EditorView) : this.ui(PopupView);\n\t\twebix.extend(this.Cals, webix.EditAbility);\n\n\t\tthis.Data.calendars().then(data => this.Cals.parse(data));\n\n\t\tconst state = this.app.getState();\n\n\t\tif (!this.Compact) {\n\t\t\tthis.on(state.$changes, \"date\", value => {\n\t\t\t\tthis.$$(\"calendar\").setValue(value);\n\t\t\t});\n\t\t\tthis.on(this.app, \"side:popup:hide\", () => {\n\t\t\t\tthis.Cals.unselectAll();\n\t\t\t});\n\t\t}\n\n\t\tthis.on(state.$changes, \"readonly\", value => this.ToggleState(value));\n\t}\n\n\tListType(_, state) {\n\t\treturn {\n\t\t\tcheckbox: function(obj) {\n\t\t\t\tconst icon =\n\t\t\t\t\tobj.active * 1 ? \"wxi-checkbox-marked\" : \"wxi-checkbox-blank\";\n\t\t\t\treturn `<span style=\"color:${obj.color};\" \n\t\t\t\t\trole=\"checkbox\" tabindex=\"-1\" \n\t\t\t\t\taria-checked=\"${obj.active ? \"true\" : \"false\"}\" \n\t\t\t\t\tclass=\"webix_icon webix_scheduler_active ${icon}\">\n\t\t\t\t</span>`;\n\t\t\t},\n\t\t\ttemplate: (obj, common) => {\n\t\t\t\tconst edit = `\n\t\t\t\t\t<span\n\t\t\t\t\t\twebix_tooltip=\"${_(\"Edit calendar\")}\" \n\t\t\t\t\t\tclass=\"webix_icon wxi-dots webix_scheduler_cal_edit \n\t\t\t\t\t\t\t${webix.env.touch ? \" webix_scheduler_cal_visible\" : \"\"}\n\t\t\t\t\t\t\">\n\t\t\t\t\t</span>\n\t\t\t\t`;\n\n\t\t\t\treturn `\n\t\t\t\t\t${common.checkbox(obj)}\n\t\t\t\t\t<span class=\"webix_scheduler_cal_title\">${obj.text || _(\"(no title)\")}</span>\n\t\t\t\t\t${state.readonly ? \"\" : edit}\n\t\t\t\t`;\n\t\t\t},\n\t\t};\n\t}\n\n\tAddCalendar() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Ops.addCalendar().then(id => {\n\t\t\tthis.Cals.edit(id);\n\t\t\tthis.Cals.getEditor()\n\t\t\t\t.getInputNode()\n\t\t\t\t.setAttribute(\"placeholder\", _(\"(no title)\"));\n\t\t});\n\t}\n\n\tShowPopup(e, id) {\n\t\tif (!this.Compact) {\n\t\t\tthis.Cals.select(id);\n\n\t\t\tconst color = this.Cals.getItem(id).color;\n\t\t\tthis.Popup.Show(id, this.Cals.getItemNode(id), color);\n\t\t} else this.Popup.Show(id);\n\t}\n\n\tToggleCalendar(id) {\n\t\tconst obj = this.Cals.getItem(id);\n\t\tthis.Ops.updateCalendar(id, { active: obj.active ^ 1 });\n\t}\n\n\tToggleState(value) {\n\t\tconst add = this.$$(\"add\");\n\t\tif (value) add.hide();\n\t\telse add.show();\n\n\t\tthis.Cals.refresh();\n\t}\n\n\tSetTitle(id, text) {\n\t\tthis.Ops.updateCalendar(id, { text }).then(\n\t\t\t() => this.EditStopSilent(),\n\t\t\t() => this.EditStopSilent(true)\n\t\t);\n\t\treturn false;\n\t}\n\n\tEditStopSilent(fail) {\n\t\tthis.Cals.blockEvent();\n\t\tif (fail) this.Cals.editCancel();\n\t\telse this.Cals.editStop();\n\t\tthis.Cals.unblockEvent();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport side from \"views/side\";\n\nexport default class NavPopupView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst units = !!this.app.config.units;\n\n\t\tconst list = {\n\t\t\tview: \"list\",\n\t\t\tcss: \"webix_scheduler_navlist\",\n\t\t\tlocalId: \"modes\",\n\t\t\tautoheight: true,\n\t\t\tdata: [\n\t\t\t\t{ id: \"day\", value: _(\"Day\"), icon: \"shi-day\" },\n\t\t\t\t{ id: \"week\", value: _(\"Week\"), icon: \"shi-week\" },\n\t\t\t\t{ id: \"month\", value: _(\"Month\"), icon: \"shi-month\" },\n\t\t\t\t{ id: \"agenda\", value: _(\"Agenda\"), icon: \"shi-agenda\" },\n\t\t\t\t{ id: \"year\", value: _(\"Year\"), icon: \"shi-year\" },\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.SetMode(id),\n\t\t\t},\n\t\t};\n\n\t\tif (units) {\n\t\t\tlist.data.push({ id: \"units\", value: _(\"Units\"), icon: \"shi-units\" });\n\t\t}\n\n\t\tif (this.app.config.timeline) {\n\t\t\tlist.data.push({\n\t\t\t\tid: \"timeline\",\n\t\t\t\tvalue: _(\"Timeline\"),\n\t\t\t\ticon: \"shi-timeline\",\n\t\t\t});\n\t\t}\n\n\t\tconst ui = {\n\t\t\tview: \"sidemenu\",\n\t\t\tanimate: false,\n\t\t\tborderless: true,\n\t\t\tcss: \"webix_scheduler_sidemenu\",\n\t\t\twidth: 300,\n\t\t\tstate: state => {\n\t\t\t\tconst tHeight = webix.skin.$active.tabbarHeight + 10;\n\t\t\t\tstate.left = this.Parent.left;\n\t\t\t\tstate.top = this.Parent.top + tHeight + 2;\n\t\t\t\tstate.height = this.Parent.height - tHeight - 2;\n\t\t\t},\n\t\t\tbody: list,\n\t\t};\n\n\t\tif (this.app.config.calendars)\n\t\t\tui.body = {\n\t\t\t\tview: \"scrollview\",\n\t\t\t\tbody: {\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\trows: [list, side],\n\t\t\t\t},\n\t\t\t};\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\n\t\tthis.on(this.app, \"view:resize\", () => {\n\t\t\tif (this.getRoot().isVisible()) this.Show(true);\n\t\t});\n\t}\n\tShow(updatePos) {\n\t\tif (!updatePos && this.getRoot().isVisible()) return;\n\n\t\tthis.Parent = this.app.getRoot().$view.getBoundingClientRect();\n\t\tthis.$$(\"modes\").select(this.State.mode);\n\t\tthis.getRoot().show();\n\t}\n\tSetMode(value) {\n\t\tthis.getRoot().hide();\n\n\t\t//wait until hide animation is complete\n\t\tsetTimeout(() => this.State.$batch({ mode: value, selected: null }), 500);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport NavBarView from \"views/bars/nav\";\nimport DateView from \"views/bars/date\";\nimport AddView from \"views/bars/add\";\nimport NavPopupView from \"views/bars/navpopup\";\n\nexport default class TopBarView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tconst todayIcon = {\n\t\t\tview: \"icon\",\n\t\t\ticon: \"wxi-calendar\",\n\t\t\tbatch: \"compact\",\n\t\t\ttooltip: _(\"Today\"),\n\t\t\tclick: () => this.SetToday(),\n\t\t};\n\t\tconst todayBtn = {\n\t\t\tview: \"align\",\n\t\t\talign: \"middle\",\n\t\t\tbatch: \"full\",\n\t\t\tbody: {\n\t\t\t\twidth: 80,\n\t\t\t\tview: \"button\",\n\t\t\t\tcss: \"webix_transparent\",\n\t\t\t\tvalue: _(\"Today\"),\n\t\t\t\tclick: () => this.SetToday(),\n\t\t\t},\n\t\t};\n\n\t\tconst ui = {\n\t\t\tview: \"toolbar\",\n\t\t\tcss: \"webix_scheduler_toolbar webix_dark\",\n\t\t\tresponsive: true,\n\t\t\tpaddingY: 0,\n\t\t\tpaddingX: 4,\n\t\t\theight: webix.skin.$active.tabbarHeight + 10,\n\t\t\tvisibleBatch: this.Compact ? \"compact\" : \"full\",\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"shi-menu\",\n\t\t\t\t\tclick: () => this.ShowNav(),\n\t\t\t\t\thidden: !this.Compact && !this.app.config.calendars,\n\t\t\t\t\tresponsiveCell: false,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tlocalId: \"add\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tbody: AddView,\n\t\t\t\t\tbatch: \"full\",\n\t\t\t\t\t//[ToDO] makes sence to hide it on medium screens to allows smaller compactWidth\n\t\t\t\t\t//in this case click-to-add behaviour for modes must be implemenetd\n\t\t\t\t\tresponsiveCell: false,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tbody: DateView,\n\t\t\t\t\tresponsiveCell: false,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\ttodayBtn,\n\t\t\t\t{ width: 12 },\n\t\t\t\tNavBarView,\n\t\t\t\ttodayIcon,\n\t\t\t],\n\t\t};\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\n\t\tif (this.Compact) this.NavPopup = this.ui(NavPopupView);\n\n\t\tthis.on(this.State.$changes, \"readonly\", value => {\n\t\t\tthis.ToggleAdd(value);\n\t\t});\n\t}\n\tSetToday() {\n\t\tthis.State.date = webix.Date.dayStart(new Date());\n\t}\n\tShowNav() {\n\t\tif (this.Compact) this.NavPopup.Show();\n\t\telse this.app.callEvent(\"show:panel\");\n\t}\n\tToggleAdd(value) {\n\t\tconst add = this.$$(\"add\");\n\t\tif (value) add.hide();\n\t\telse if (!this.Compact) add.show();\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class EventActionMenu extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"popup\",\n\t\t\tbody: {\n\t\t\t\tview: \"menu\",\n\t\t\t\tlayout: \"y\",\n\t\t\t\twidth: 220,\n\t\t\t\tautoheight: true,\n\t\t\t\tdata: [\n\t\t\t\t\t{ id: \"this\", value: _(\"This event\") },\n\t\t\t\t\t{ id: \"next\", value: _(\"This event and the following\") },\n\t\t\t\t\t{ id: \"all\", value: _(\"All events\") },\n\t\t\t\t],\n\t\t\t\ton: {\n\t\t\t\t\tonMenuItemClick: id => {\n\t\t\t\t\t\tif (this.Result) this.Result.resolve(id);\n\t\t\t\t\t\tthis.Result = null;\n\t\t\t\t\t\tthis.Root.hide();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => {\n\t\t\t\t\tif (this.Result) this.Result.reject();\n\t\t\t\t\tthis.Result = null;\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.Root = view;\n\t}\n\n\tShow(node) {\n\t\tthis.Result = webix.promise.defer();\n\t\tthis.Root.show(node);\n\t\treturn this.Result;\n\t}\n}\n","export function shrinkTo(start, end) {\n\treturn ev => {\n\t\tconst before = ev.start_date <= start;\n\t\tconst after = ev.end_date >= end;\n\n\t\tif (before || after) {\n\t\t\tconst t = webix.copy(ev);\n\t\t\tif (before) t.start_date = start;\n\t\t\tif (after) t.end_date = end;\n\t\t\treturn t;\n\t\t}\n\n\t\treturn ev;\n\t};\n}\n\nexport function isToday(date) {\n\treturn webix.Date.equal(\n\t\twebix.Date.datePart(date),\n\t\twebix.Date.datePart(new Date())\n\t);\n}\n\nexport function isMultiDay(ev) {\n\treturn (\n\t\tev.all_day ||\n\t\t(ev.start_date.getDate() != ev.end_date.getDate() &&\n\t\t\tev.end_date - ev.start_date >= 1000 * 60 * 60 * 24 * 1)\n\t);\n}\n\n/**\n * Returns the difference between dates\n * @param {Date} start - date 1\n * @param {Date} end - date 2\n * @returns {number} difference between dates in days\n */\nexport function daysBetweenInclusive(start, end) {\n\tconst millisecondsPerDay = 24 * 60 * 60 * 1000;\n\treturn Math.round(\n\t\t(webix.Date.dayStart(end) - webix.Date.dayStart(start)) / millisecondsPerDay\n\t);\n}\n\n/**\n * Checks if the dates are the same\n * @param {Date} adate\n * @param {Date} bdate\n * @returns {Boolean}\n */\nexport function isSameDate(adate, bdate) {\n\treturn webix.Date.equal(\n\t\twebix.Date.dayStart(adate),\n\t\twebix.Date.dayStart(bdate)\n\t);\n}\n\nexport function getYearDay(date) {\n\tconst start = webix.Date.yearStart(date);\n\treturn (date - start) / 1000 / 60 / 60 / 24 + 1;\n}\n","const icalFormat = webix.Date.dateToStr(\"%Y%m%dT000000Z\");\n\nexport function parse(string) {\n\t//FREQ=DAILY;INTERVAL=2\n\tconst parts = string.split(\";\");\n\tconst config = {};\n\tfor (let i = 0; i < parts.length; i++) {\n\t\tconst [code, name] = parts[i].split(\"=\");\n\t\tconfig[code] = name;\n\t}\n\n\tif (config.UNTIL) config.UNTIL = strToDate(config.UNTIL);\n\tif (config.EXDATE) {\n\t\tconfig.EXDATE = config.EXDATE.split(\",\").map(d => strToDate(d));\n\t}\n\n\treturn config;\n}\n\nfunction strToDate(str) {\n\treturn new Date(\n\t\tstr.substr(0, 4) * 1,\n\t\tstr.substr(4, 2) * 1 - 1,\n\t\tstr.substr(6, 2) * 1\n\t);\n}\n\nexport function serialize(config) {\n\tconst str = [];\n\tfor (let key in config) {\n\t\tlet value = config[key];\n\t\tif (key === \"UNTIL\") value = icalFormat(value);\n\n\t\tif (key === \"EXDATE\") {\n\t\t\tvalue = value.map(d => icalFormat(d));\n\t\t\tvalue = value.join(\",\");\n\t\t}\n\t\tif (value) str.push(`${key}=${value}`);\n\t}\n\n\treturn str.join(\";\");\n}\n","import { serialize, parse } from \"helpers/ical\";\nexport const WEEKDAYS = [\"SU\", \"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\"];\n\nexport const FREQUENCE = {\n\tDAILY: \"day\",\n\tWEEKLY: \"week\",\n\tMONTHLY: \"month\",\n\tYEARLY: \"year\",\n};\n\n/**\n * Splits each recurring event into a series of events and returns the resulting array\n * @param {Date} sdate - the start date\n * @param {Date} edate - the end date\n * @param {Object} ev - the event data object\n * @returns {Array} with recurring events split into occurrences\n */\nexport function explodeEvent(sdate, edate, ev) {\n\tconst mode = ev.$recurring;\n\n\tconst consts = {};\n\tconst res = [];\n\n\t// when we use week-days in recurring mode, convert structure\n\t// list of days => list of steps to the next allowed day\n\tfillWdays(mode, consts);\n\n\tconst xdate = new Date(ev.start_date);\n\tconst length = ev.end_date - ev.start_date;\n\n\t// occurrences before active window\n\tlet count = 1;\n\twhile (\n\t\t(sdate - xdate >= (length || 1) &&\n\t\t\t(!mode.UNTIL || xdate < mode.UNTIL) &&\n\t\t\t(!mode.COUNT || count <= mode.COUNT)) ||\n\t\tfindDate(mode.EXDATE, xdate)\n\t) {\n\t\t++count;\n\t\tnext(xdate, mode, consts);\n\t}\n\n\t// occurrences inside of window\n\twhile (\n\t\tedate > xdate &&\n\t\t(!mode.UNTIL || xdate < mode.UNTIL) &&\n\t\t(!mode.COUNT || count <= mode.COUNT)\n\t) {\n\t\t// make copy of recurring event\n\t\tif (!findDate(mode.EXDATE, xdate)) {\n\t\t\tconst copy = webix.copy(ev);\n\n\t\t\txdate.setHours(ev.start_date.getHours());\n\t\t\tcopy.start_date = new Date(xdate);\n\t\t\tcopy.end_date = new Date(xdate * 1 + length);\n\n\t\t\tcopy.$id = ev.id;\n\t\t\tcopy.id = copy.start_date.valueOf() + \"_\" + ev.id;\n\t\t\tres.push(copy);\n\t\t}\n\t\tcount++;\n\n\t\tnext(xdate, mode, consts);\n\t}\n\treturn res;\n}\n\n// IE support\n/**\n * Finds a date in an array of dates\n * @param {Array} arr - all dates\n * @param {Date} date - the date to be checked\n * @returns {Boolean}\n */\nfunction findDate(arr, date) {\n\tif (!arr) return false;\n\n\tfor (let i = 0; i < arr.length; ++i) {\n\t\tif (webix.Date.equal(webix.Date.dayStart(date), arr[i])) return true;\n\t}\n\treturn false;\n}\n\n/**\n * Defines the object that stores the recurring pattern, for more details please refer to the iCalendar docs https://icalendar.org/iCalendar-RFC-5545/3-8-5-3-recurrence-rule.html\n * @typedef {Object} Recurring\n * @property {string} FREQ - the step of repetition: DAILY, WEEKLY, MONTHLY, YEARLY\n * @property {(number|string)} INTERVAL - how many steps are between occurrences\n * @property {string} BYDAY - week days, e.g. SU,MO,TU,WE,TH,FR,SA\n * @property {(number|string)} BYMONTH - the number or a month (1-12)\n * @property {(number|string)} BYMONTHDAY - the date (day of a month)\n * @property {(number|string)} BYSETPOS - the number of the week day within a month\n * @property {string} UNTIL - a date like 19970902T090000\n * @property {(number|string)} COUNT - how many times the event repeats\n * @property {string} EXDATE - string with 1 or more dates, on which the event does not repeat, e.g. 19960402T010000Z,19960403T010000Z,19960404T010000Z\n */\n\n/**\n * Fills the list of steps to the next allowed day for recurring events that repeat by certain week days\n * @param {Recurring} mode - the object with the recurring pattern\n * @param {Object} consts - (for events that have BYDAY in their pattern) stores wdays (Array) - the list of steps to the next allowed day\n */\nexport function fillWdays(mode, consts) {\n\tif (mode.BYDAY) {\n\t\tconst diff = (consts.wdays = [0, 0, 0, 0, 0, 0, 0]);\n\t\tconst line = mode.BYDAY.split(\",\")\n\t\t\t.map(a => WEEKDAYS.indexOf(a))\n\t\t\t.sort();\n\n\t\t// for each allowed day, fill range with steps\n\t\tfor (let i = 0; i < line.length; i++) {\n\t\t\tconst s = line[i];\n\t\t\tconst e = line[i + 1] || line[0] + 7;\n\n\t\t\tfor (let j = s; j < e; j++) {\n\t\t\t\tdiff[j % 7] = e - j;\n\t\t\t}\n\t\t}\n\t}\n}\n\n/**\n * Calculates the date of the next occurrence of a repeating event\n * @param {Date} date - the current date\n * @param {Recurring} mode - the object with the recurring pattern\n * @param {Object} consts - (for events that have BYDAY in their pattern) stores wdays (Array) - the list of steps to the next allowed day\n */\nexport function next(date, mode, consts) {\n\tlet interval = (mode.INTERVAL || 1) * 1;\n\n\tlet now, step;\n\tswitch (mode.FREQ) {\n\t\tcase \"DAILY\":\n\t\t\tdate.setDate(date.getDate() + interval);\n\t\t\tbreak;\n\t\tcase \"WEEKLY\":\n\t\t\tnow = date.getDay();\n\t\t\tstep = consts.wdays ? consts.wdays[now] : 7;\n\t\t\tif (step + now > 6 && interval > 1) {\n\t\t\t\t// when new day is on the different week\n\t\t\t\t// add week interval as well\n\t\t\t\tstep += 7 * (interval - 1);\n\t\t\t}\n\t\t\tdate.setDate(date.getDate() + step);\n\t\t\tbreak;\n\t\tcase \"YEARLY\": {\n\t\t\tif (mode.BYYEARDAY) {\n\t\t\t\tdate.setFullYear(date.getFullYear() + interval);\n\t\t\t\tdate.setMonth(0);\n\t\t\t\tdate.setDate(1);\n\t\t\t\tdate.setDate(mode.BYYEARDAY);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tinterval *= 12;\n\t\t\t// falls through\n\t\t}\n\t\t/*eslint no-fallthrough: \"error\"*/\n\t\tcase \"MONTHLY\":\n\t\t\tnow = date.getMonth();\n\t\t\tdate.setDate(1);\n\t\t\tdate.setMonth(now + interval);\n\t\t\tif (mode.BYMONTHDAY) {\n\t\t\t\tdate.setDate(mode.BYMONTHDAY);\n\t\t\t\t// when date is outside of month bounds, switch to last day of month\n\t\t\t\tif ((now + interval) % 12 != date.getMonth()) date.setDate(0);\n\t\t\t} else if (mode.BYSETPOS) {\n\t\t\t\t// go to last day of month before one in question\n\t\t\t\tdate.setDate(0);\n\t\t\t\t// find the matching day\n\t\t\t\tfor (let i = 0; i < mode.BYSETPOS; i++) {\n\t\t\t\t\tstep = consts.wdays[date.getDay()];\n\t\t\t\t\tdate.setDate(date.getDate() + step);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t}\n\n\treturn date;\n}\n\n/**\n * Defines the result of the check if a date fits a BYDAY pattern\n * @typedef {Object} weekdayCheckResult\n * @property {Boolean} result true if the date fits the BYDAY pattern, false otherwise\n * @property {Date} start - the copy of the start date\n * @property {Array} days - BYDAY pattern as an array of strings\n * @property {string} oldDay - the week day of the start date\n */\n/**\n * Checks if the start day fits the recurring BYDAY pattern\n * @param {Date} sdate - the start date of an event\n * @param {Recurring} mode - the object with the recurring pattern\n * @returns {weekdayCheckResult} the result of the check\n */\nfunction checkDay(sdate, mode) {\n\tconst start = new Date(sdate);\n\tconst days = mode.BYDAY.split(\",\");\n\tconst oldDay = WEEKDAYS[start.getDay()];\n\tconst result = days.indexOf(oldDay) !== -1;\n\n\treturn { result, start, days, oldDay };\n}\n\n/**\n * Synchronizes the start and end dates to the BYDAY recurring pattern\n * @param {Date} sdate\n * @param {Date} edate\n * @param {Recurring} mode - the object with the recurring pattern\n * @return {Array} - the start and end dates of an event\n */\nexport function datesToWeekdays(sdate, edate, mode) {\n\tconst { result, start, days } = checkDay(sdate, mode);\n\tif (result) {\n\t\treturn [sdate, edate];\n\t}\n\n\tconst diff = WEEKDAYS.indexOf(days[0]) - start.getDay();\n\tstart.setDate(start.getDate() + diff);\n\n\tconst end = new Date(edate);\n\tend.setDate(end.getDate() + diff);\n\n\treturn [start, end];\n}\n\n/**\n * Synchronizes BYDAY recurring pattern with the date of an event\n * @param {Date} sdate - the start date of an event\n * @param {Recurring} mode - the object with the recurring pattern\n * @returns {string} with the new BYDAY pattern\n */\nexport function WeekdaysToDates(sdate, mode) {\n\tlet { result, days, oldDay } = checkDay(sdate, mode);\n\tif (result) {\n\t\treturn mode.BYDAY;\n\t}\n\n\tif (mode.FREQ === \"WEEKLY\") {\n\t\tdays.splice(WEEKDAYS.indexOf(days[0]), 0, oldDay);\n\t} else {\n\t\tdays = [oldDay];\n\t}\n\treturn days.join(\",\");\n}\n\n/**\n * Returns selection parameters for the global state\n * @param {Object} obj - the event data object\n * @returns {Object} with selection parameters\n */\nexport function getParams(obj) {\n\treturn { id: obj.$id || obj.id, date: obj.$recurring ? obj.id : null };\n}\n\n/**\n * Defines the selection.date parameter of the global state\n * @typedef {(Date|string)} SDate - a Date object or the ID of an event occurrence that consists of a timestamp and the event ID from DB, separated with _\n */\n\n/**\n * Gets a date from the selection.date parameter of the global state\n * @param {(SDate)} sdate\n * @returns {Date}\n */\nexport function extractDate(sdate) {\n\treturn webix.Date.dayStart(\n\t\tsdate.getDate ? sdate : new Date(sdate.split(\"_\")[0] * 1)\n\t);\n}\n\n/**\n * Updates the end of a recurring event sequence\n * @param {SDate} sdate\n * @param {Object} ev - the event data object\n * @param {Boolean} block\n * @returns {string} - serialized recurrence pattern\n */\nexport function clipSequence(sdate, ev, block) {\n\tconst date = extractDate(sdate);\n\n\tif (!block || (!ev.$recurring.UNTIL || ev.$recurring.UNTIL > date))\n\t\tev.$recurring.UNTIL = date;\n\n\tif (ev.$recurring.COUNT) delete ev.$recurring.COUNT;\n\n\tif (ev.$recurring.EXDATE) {\n\t\tev.$recurring.EXDATE = ev.$recurring.EXDATE.filter(d => d < date);\n\t}\n\n\treturn serialize(ev.$recurring);\n}\n\n/**\n * Removes the specified date from the recurrence pattern\n * @param {SDate} sdate\n * @param {Object} ev - the event data object\n * @returns {string} - serialized recurrence pattern\n */\nexport function cutOccurrence(sdate, ev) {\n\tconst date = extractDate(sdate);\n\n\tif (!ev.$recurring.EXDATE) ev.$recurring.EXDATE = [];\n\tev.$recurring.EXDATE.push(date);\n\n\treturn serialize(ev.$recurring);\n}\n\n/**\n * Gets the start and end dates for a particular occurrence from a series\n * @param {Object} obj - the event data object\n * @param {SDate} sdate\n * @returns {Object} with start_date and end_date\n */\nexport function separateSequence(obj, sdate) {\n\tconst start_date =\n\t\ttypeof sdate === \"string\"\n\t\t\t? new Date(sdate.split(\"_\")[0] * 1)\n\t\t\t: new Date(sdate);\n\tconst len = (obj.end_date - obj.start_date) / 1000 / 60; // mins\n\tconst end_date = webix.Date.add(start_date, len, \"minute\", true);\n\treturn { start_date, end_date };\n}\n\n/**\n * Checks if this is the first occurrence of a series\n * @param {SDate} sdate\n * @param {Date} evStart\n * @returns {Boolean}\n */\nexport function isFirstOccurrence(sdate, evStart) {\n\t// editing 'this' event as next\n\tif (!sdate) return false;\n\n\tconst od = sdate.getDate ? sdate : new Date(sdate.split(\"_\")[0] * 1);\n\treturn od <= evStart;\n}\n\n/**\n * Corrects the edit mode for specific cases (depending on which occurrence was selected)\n * @param {Object} obj - the event data object\n * @param {string} mode - \"all\", \"next\", \"this\"\n * @returns {string}\n */\nexport function correctMode(obj, mode) {\n\tif (!obj.origin_id || !obj.recurring) {\n\t\tmode = \"all\";\n\t} else {\n\t\t// if this is 1st occ in 'next' which is the last part of 'all'\n\t\tif (this.app.getService(\"local\").isLastPart(obj)) {\n\t\t\tmode = \"\";\n\t\t}\n\t}\n\treturn mode;\n}\n\nconst dayLength = 86400000;\n/**\n * Moves a recurrence pattern if a recurring event was moved to another date\n * @param {Recurring} rec\n * @param {Object} newEvent - the new event data object\n * @param {Object} oldEvent - the old event data object\n * @returns {Recurring}\n */\nexport function movePattern(rec, newEvent, oldEvent) {\n\tlet days =\n\t\t(webix.Date.dayStart(newEvent.start_date) -\n\t\t\twebix.Date.dayStart(oldEvent.start_date)) /\n\t\tdayLength;\n\n\tif (days) {\n\t\tif (rec.UNTIL) {\n\t\t\tconst until = webix.Date.add(rec.UNTIL, days, \"day\", true);\n\n\t\t\tif (until > newEvent.end_date) rec.UNTIL = until;\n\t\t\telse\n\t\t\t\trec.UNTIL = webix.Date.dayStart(\n\t\t\t\t\twebix.Date.add(newEvent.end_date, 1, \"day\", true)\n\t\t\t\t);\n\t\t}\n\n\t\t// day of start_date changed and pattern doesn't have in anymore\n\t\tif (rec.BYDAY) {\n\t\t\tdays %= 7;\n\t\t\tif (days < 0) days += 7;\n\t\t\trec.BYDAY = rec.BYDAY.split(\",\")\n\t\t\t\t.map(d => WEEKDAYS[(WEEKDAYS.indexOf(d) + days) % 7])\n\t\t\t\t.join(\",\");\n\t\t}\n\n\t\t// in case day of start_date changed in monthly or yearly\n\t\tif (rec.BYMONTHDAY) {\n\t\t\tconst nmd = newEvent.start_date.getDate();\n\t\t\tif (nmd != rec.BYMONTHDAY) {\n\t\t\t\trec.BYMONTHDAY = nmd;\n\t\t\t}\n\t\t}\n\t}\n\n\t// week number of start_date changed in yearly or monthly\n\tif (rec.BYSETPOS) {\n\t\tconst nwn = getWeekNum(newEvent.start_date);\n\t\tif (rec.BYSETPOS != nwn) rec.BYSETPOS = nwn;\n\t}\n\n\t// month of start_date changed in a yearly event\n\tif (rec.BYMONTH) {\n\t\tconst nm = newEvent.start_date.getMonth() + 1;\n\t\tif (nm != rec.BYMONTH) rec.BYMONTH = nm;\n\t}\n\n\treturn rec;\n}\n\n/**\n * Returns the number of a week day within a month (e.g. 3rd Wednesday)\n * @param {Date} date\n * @returns {number}\n */\nexport function getWeekNum(date) {\n\tconst day = date.getDate();\n\treturn Math.floor(day / 7) + (day % 7 ? 1 : 0);\n}\n\n/**\n * Fills incomplete recurring patterns and ensures that they are consistent with the dates of events\n * @param {Object} ev - data object of an event\n */\nexport function checkPattern(ev) {\n\tconst mode = ev.$recurring || parse(ev.recurring);\n\n\t// when exact date not configured, fill recurring config\n\tif (mode.FREQ === \"WEEKLY\" && !mode.BYDAY) {\n\t\tmode.BYDAY = WEEKDAYS[ev.start_date.getDay()];\n\t\treturn;\n\t}\n\n\tif (\n\t\t(mode.FREQ === \"MONTHLY\" || mode.FREQ === \"YEARLY\") &&\n\t\t!mode.BYSETPOS &&\n\t\t!mode.BYMONTHDAY &&\n\t\t!mode.BYYEARDAY\n\t) {\n\t\tmode.BYMONTHDAY = ev.start_date.getDate();\n\t\treturn;\n\t}\n\n\tif (mode.FREQ === \"YEARLY\" && !mode.BYMONTH && !mode.BYYEARDAY) {\n\t\tmode.BYMONTH = ev.start_date.getMonth();\n\t\treturn;\n\t}\n\n\t// in case config is wrong, fix it\n\tif (mode.BYDAY) mode.BYDAY = WeekdaysToDates(ev.start_date, mode);\n\tif (mode.BYMONTHDAY) mode.BYMONTHDAY = ev.start_date.getDate();\n\tif (mode.BYMONTH) mode.BYMONTH = ev.start_date.getMonth() + 1;\n\tif (mode.BYSETPOS) mode.BYSETPOS = getWeekNum(ev.start_date);\n\n\tev.recurring = serialize(mode);\n}\n","import { JetView } from \"webix-jet\";\nimport { WEEKDAYS, fillWdays, next } from \"helpers/recurring\";\n\nexport default class RecurringFormView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"recurringForm\",\n\t\t\thidden: true,\n\t\t\telementsConfig: { labelPosition: \"left\" },\n\t\t\tpadding: {\n\t\t\t\ttop: aSkin.layoutPadding.form,\n\t\t\t\tbottom: 0,\n\t\t\t\tleft: compact ? aSkin.layoutPadding.form : 0,\n\t\t\t\tright: compact ? 14 : 0,\n\t\t\t},\n\t\t\tborderless: true,\n\t\t\trows: [\n\t\t\t\tthis.CreateIntervalControls(_),\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"customRecControls\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\trows: [this.CreateCheckboxes(_), this.CreateSelect(_)],\n\t\t\t\t},\n\t\t\t\tthis.CreateRadio(_),\n\t\t\t],\n\t\t};\n\n\t\tif (!compact) {\n\t\t\tform.on = {\n\t\t\t\tonChange: (o, v, m) => this.UpdateEvent(m),\n\t\t\t};\n\t\t}\n\n\t\treturn form;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.Form = this.$$(\"recurringForm\");\n\t\tthis.Events = this.app.getService(\"local\").events(true);\n\n\t\t// commonly called controls\n\t\tthis.CheckBoxContainer = this.$$(\"weekly\");\n\t\tthis.Checkboxes = this.CheckBoxContainer.getChildViews().slice(1);\n\t\tthis.Checkboxes.pop();\n\t\tthis.PatternSelect = this.$$(\"patternSelect\");\n\t\tthis.UntilDateContainer = this.$$(\"untilDate\");\n\t\tthis.UntilDateCalendar = this.Form.elements.untilDate.getPopup().getBody();\n\t\tthis.UntilNumContainer = this.$$(\"untilCount\");\n\t\tthis.UntilNum = this.UntilNumContainer.getBody();\n\t\tthis.CustomRecControls = this.$$(\"customRecControls\");\n\t}\n\n\t// methods of main controls: counter of INTERVAL and richselect of FREQ\n\n\t/**\n\t * Returns the config object for interval counter and recurrence frequency selection\n\t * @param {function} _ - the translator method of the Locale plugin\n\t * @returns {Object}\n\t */\n\tCreateIntervalControls(_) {\n\t\treturn {\n\t\t\tmargin: 8,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"counter\",\n\t\t\t\t\tlabel: _(\"Every\"),\n\t\t\t\t\tlabelWidth: 50,\n\t\t\t\t\tmin: 1,\n\t\t\t\t\tname: \"INTERVAL\",\n\t\t\t\t\tcss: \"webix_scheduler_counter\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\tname: \"FREQ\",\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ id: \"DAILY\", value: _(\"day\") },\n\t\t\t\t\t\t{ id: \"WEEKLY\", value: _(\"week\") },\n\t\t\t\t\t\t{ id: \"MONTHLY\", value: _(\"month\") },\n\t\t\t\t\t\t{ id: \"YEARLY\", value: _(\"year\") },\n\t\t\t\t\t],\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: v => this.ChangeControls(v),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\t/**\n\t * Switches controls for detailed recurrence pattern selection depending on the frequency\n\t * @param {string} v - recurrence frequency\n\t */\n\tChangeControls(v) {\n\t\tthis._freq = v;\n\t\tif (v === \"DAILY\") {\n\t\t\tthis.CustomRecControls.hide();\n\t\t} else {\n\t\t\tthis.CustomRecControls.show();\n\t\t\tif (v === \"WEEKLY\") {\n\t\t\t\tthis.CheckBoxContainer.show();\n\t\t\t\tthis.PatternSelect.hide();\n\t\t\t} else {\n\t\t\t\tthis.CheckBoxContainer.hide();\n\t\t\t\tif (v === \"MONTHLY\" && this.PatternSelect.getValue() == 3)\n\t\t\t\t\tthis.PatternSelect.setValue(1);\n\t\t\t\tthis.PatternSelect.show();\n\t\t\t\tthis.PatternSelect.getList().refresh();\n\t\t\t\tthis.PatternSelect.refresh();\n\t\t\t}\n\t\t}\n\t}\n\n\t// methods of checkboxes for WEEKLY\n\n\t/**\n\t * Returns the config object for week day checkboxes\n\t * @param {function} _ - the translator method of the Locale plugin\n\t * @returns {Object}\n\t */\n\tCreateCheckboxes(_) {\n\t\tconst days = [];\n\t\tfor (let i = 0; i < 7; ++i) {\n\t\t\tdays.push({\n\t\t\t\tview: \"checkbox\",\n\t\t\t\tlabel: webix.i18n.calendar.dayShort[i],\n\t\t\t\tlabelPosition: \"top\",\n\t\t\t\tlabelAlign: \"center\",\n\t\t\t\tcss: \"webix_scheduler_day_checkbox\",\n\t\t\t\tinputWidth: 26,\n\t\t\t\twidth: 45,\n\t\t\t\talign: \"center\",\n\t\t\t\tname: WEEKDAYS[i],\n\t\t\t\ton: {\n\t\t\t\t\tonChange(v, o) {\n\t\t\t\t\t\tthis.$scope.CheckboxGuard(this.config.name, v, o);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\treturn {\n\t\t\tlocalId: \"weekly\",\n\t\t\tcols: [\n\t\t\t\t{ view: \"label\", label: _(\"on\"), width: 45 },\n\t\t\t\t...days,\n\t\t\t\t{ gravity: 0.00001 },\n\t\t\t],\n\t\t};\n\t}\n\n\t/**\n\t * Prevents the user from unchecking the only checked weekday checkbox\n\t * @param {string} day - the name of the related checkbox (SU, MO, TU, WE, TH, FR, or SA)\n\t * @param {(Boolean|number)} v - the new value of a checkbox (false/0 or true/1)\n\t * @param {(Boolean|number)} o - the old value of a checkbox (false/0 or true/1)\n\t */\n\tCheckboxGuard(day, v, o) {\n\t\tif (!webix.isUndefined(o) && !v && !this.GetBYDAY()) {\n\t\t\tthis.Form.setValues({ [day]: 1 }, true);\n\t\t}\n\t}\n\n\t/**\n\t * Sets values to weekday checkboxes according to BYDAY recurrence pattern (week days)\n\t * @param {Object} values - values from the form\n\t */\n\tSetBYDAY(values) {\n\t\tconst days = values.BYDAY.split(\",\");\n\t\tthis.Checkboxes.forEach(check => {\n\t\t\tvalues[check.config.name] = !!days.find(d => d == check.config.name);\n\t\t});\n\t}\n\n\t/**\n\t * Gets the BYDAY pattern from checkbox values\n\t * @returns {string}\n\t */\n\tGetBYDAY() {\n\t\tconst BYDAY = [];\n\t\tthis.Checkboxes.forEach(check => {\n\t\t\tif (check.getValue()) {\n\t\t\t\tBYDAY.push(check.config.name);\n\t\t\t}\n\t\t});\n\t\treturn BYDAY.join(\",\");\n\t}\n\n\t// methods of richselect with MONTHLY and YEARLY patterns\n\n\t/**\n\t * Returns the config object for a dropdown list with monthly/yearly recurrence patterns\n\t * @param {function} _ - the translator method of the Locale plugin\n\t * @returns {Object}\n\t */\n\tCreateSelect(_) {\n\t\treturn {\n\t\t\tview: \"richselect\",\n\t\t\tlocalId: \"patternSelect\",\n\t\t\tname: \"rec_pattern\",\n\t\t\tsuggest: {\n\t\t\t\tdata: [],\n\t\t\t\tbody: {\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\tif (this._freq === \"YEARLY\" && obj.BYYEARDAY) {\n\t\t\t\t\t\t\treturn `${_(\"Every\")} ${obj.BYYEARDAY} ${_(\"day of year\")}`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst byDay = [];\n\t\t\t\t\t\tif (obj.BYDAY) {\n\t\t\t\t\t\t\tobj.BYDAY.forEach(d =>\n\t\t\t\t\t\t\t\tbyDay.push(webix.i18n.calendar.dayFull[d])\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet text = `${_(\"Every\")} ${obj.BYMONTHDAY || obj.BYSETPOS} ${\n\t\t\t\t\t\t\tobj.BYDAY ? byDay.join(\", \") : \"\"\n\t\t\t\t\t\t}`;\n\t\t\t\t\t\tif (this._freq === \"YEARLY\")\n\t\t\t\t\t\t\ttext += ` ${_(\"of\")} ${\n\t\t\t\t\t\t\t\twebix.i18n.calendar.monthFull[obj.BYMONTH - 1]\n\t\t\t\t\t\t\t}`;\n\t\t\t\t\t\treturn text;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\ton: {\n\t\t\t\t\tonShow() {\n\t\t\t\t\t\tthis.getList().filter(\n\t\t\t\t\t\t\tobj => this.$scope._freq === \"YEARLY\" || obj.id != 3\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Describes calculated constants of a date\n\t * @typedef {Object} DateInfo\n\t * @property {number} day - the date (day of month)\n\t * @property {number} weekday - the number of a weekday (0-6)\n\t * @property {number} month - the number of month (0-11)\n\t * @property {number} weekNum - the number of a weekday within a month (e.g. 4th Friday)\n\t */\n\n\t/**\n\t * Sets pattern options for the dropdown list (monthly and yearly events)\n\t * @param {Object} ev - values from the form\n\t * @param {DateInfo} calculated - calculated constants of a date\n\t */\n\tSetPatternOptions(ev, calculated) {\n\t\tthis.PatternSelect.getList().parse([\n\t\t\t{\n\t\t\t\tid: 1,\n\t\t\t\tBYMONTH: ev.BYMONTH || calculated.month + 1,\n\t\t\t\tBYMONTHDAY: ev.BYMONTHDAY || calculated.day,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 2,\n\t\t\t\tBYSETPOS: ev.BYSETPOS || calculated.weekNum,\n\t\t\t\tBYDAY: [calculated.weekday],\n\t\t\t\tBYMONTH: ev.BYMONTH || calculated.month + 1,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 3,\n\t\t\t\tBYYEARDAY: ev.BYYEARDAY || calculated.yearday,\n\t\t\t},\n\t\t]);\n\t\tthis.PatternSelect.refresh();\n\t\tthis._freq = ev.FREQ;\n\n\t\tev.rec_pattern = ev.BYSETPOS ? 2 : ev.BYYEARDAY ? 3 : 1;\n\t}\n\n\t/**\n\t *\n\t * @param {Object} values - values from the form\n\t */\n\tGetRecPattern(values) {\n\t\tconst data = webix.copy(\n\t\t\tthis.PatternSelect.getList().getItem(values.rec_pattern)\n\t\t);\n\n\t\tif (this._freq === \"MONTHLY\") delete data.BYMONTH;\n\t\tif (data.BYDAY) data.BYDAY = data.BYDAY.map(d => WEEKDAYS[d]).join(\",\");\n\t\tdelete data.id;\n\n\t\treturn data;\n\t}\n\n\t// methods of radio for UNTIL\n\n\t/**\n\t * Returns the config object for the radio with options for setting the end of repetition\n\t * @param {function} _ - the translator method of the Locale plugin\n\t * @returns {Object}\n\t */\n\tCreateRadio(_) {\n\t\tconst selectors = {\n\t\t\twidth: 130,\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"untilDate\",\n\t\t\t\t\talign: \"middle\",\n\t\t\t\t\tview: \"align\",\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\tname: \"untilDate\",\n\t\t\t\t\t\ticons: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"untilCount\",\n\t\t\t\t\tview: \"align\",\n\t\t\t\t\talign: \"bottom\",\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tname: \"untilCount\",\n\t\t\t\t\t\tview: \"counter\",\n\t\t\t\t\t\tcss: \"webix_scheduler_counter\",\n\t\t\t\t\t\tmin: 1,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn {\n\t\t\trows: [\n\t\t\t\t{ view: \"label\", label: _(\"End repeat\") },\n\t\t\t\t{\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"radio\",\n\t\t\t\t\t\t\tname: \"until\",\n\t\t\t\t\t\t\tlocalId: \"until\",\n\t\t\t\t\t\t\tvertical: true,\n\t\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t\t{ id: 1, value: _(\"never\") },\n\t\t\t\t\t\t\t\t{ id: 2, value: _(\"date\") },\n\t\t\t\t\t\t\t\t{ id: 3, value: _(\"after several occurrences\") },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\tonChange: v => this.ChangeSelectors(v),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tselectors,\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\t/**\n\t * Switches controls for dates or numbers for setting the end of repetition\n\t * @param {(number|string)} v - the value of the radio that sets the type of repetition end (1,2,3)\n\t */\n\tChangeSelectors(v) {\n\t\tthis.UntilDateContainer[v === \"2\" ? \"show\" : \"hide\"]();\n\t\tthis.UntilNumContainer[v === \"3\" ? \"show\" : \"hide\"]();\n\t}\n\n\t/**\n\t * Sets the values of controls that are used to choose the end of repetition\n\t * @param {Object} values - values from the form\n\t */\n\tSetUNTIL(values) {\n\t\tconst start = this._StartDate;\n\t\tvalues.until = values.COUNT ? 3 : values.UNTIL ? 2 : 1;\n\t\tvalues.untilDate = values.UNTIL || webix.Date.add(start, 1, \"year\", true);\n\t\tvalues.untilCount = values.COUNT || this.CountNum(values);\n\t\tthis.UntilDateCalendar.define({ minDate: start });\n\t}\n\n\t/**\n\t * Calculates the number of occurrences based on the end date of repetition (UNTIL)\n\t * @param {Object} values - values from the form\n\t */\n\tCountNum(values) {\n\t\tlet res = 0;\n\n\t\tif (values.UNTIL) {\n\t\t\tconst consts = {};\n\t\t\tfillWdays(values, consts);\n\t\t\tlet date = webix.Date.copy(this._StartDate);\n\n\t\t\twhile (date <= values.UNTIL) {\n\t\t\t\tdate = next(date, values, consts);\n\t\t\t\tres++;\n\t\t\t}\n\t\t} else {\n\t\t\tres = 3;\n\t\t}\n\n\t\treturn res;\n\t}\n\n\t// subform methods\n\n\t/**\n\t * Sets values into this form\n\t * @param {Object} event - the event data object\n\t * @param {DateInfo} calculated - calculated constants of a date\n\t * @param {Boolean} silent - if true, the form is marked as 'saved' (containing no unsaved values)\n\t */\n\tSetValues(event, calculated, silent) {\n\t\tif (!calculated) return this.Form.setValues(event, true);\n\n\t\tthis._StartDate = event.start_date;\n\t\tlet values = event.$recurring;\n\n\t\tif (!values) {\n\t\t\tvalues = { FREQ: \"DAILY\" };\n\t\t}\n\n\t\tif (!values.INTERVAL) values.INTERVAL = 1;\n\t\tif (!values.BYDAY) {\n\t\t\tvalues.BYDAY = WEEKDAYS[calculated.weekday];\n\t\t}\n\n\t\t// for a reset\n\t\tif (!values.EXDATE) values.EXDATE = [];\n\n\t\tthis.SetUNTIL(values);\n\t\tthis.SetBYDAY(values);\n\t\tthis.SetPatternOptions(values, calculated);\n\t\tthis.Form.setValues(values, true);\n\t\tif (silent) this.Form.setDirty();\n\t}\n\n\t/**\n\t * Defines the object that stores the recurring pattern, for more details please refer to the iCalendar docs https://icalendar.org/iCalendar-RFC-5545/3-8-5-3-recurrence-rule.html\n\t * @typedef {Object} Recurring\n\t * @property {string} FREQ - the step of repetition: DAILY, WEEKLY, MONTHLY, YEARLY\n\t * @property {(number|string)} INTERVAL - how many steps are between occurrences\n\t * @property {string} BYDAY - week days, e.g. SU,MO,TU,WE,TH,FR,SA\n\t * @property {(number|string)} BYMONTH - the number or a month (1-12)\n\t * @property {(number|string)} BYMONTHDAY - the date (day of a month)\n\t * @property {(number|string)} BYSETPOS - the number of the week day within a month\n\t * @property {string} UNTIL - a date like 19970902T090000\n\t * @property {(number|string)} COUNT - how many times the event repeats\n\t * @property {string} EXDATE - string with 1 or more dates, on which the event does not repeat, e.g. 19960402T010000Z,19960403T010000Z,19960404T010000Z\n\t */\n\n\t/**\n\t * Collects recurrence pattern object from form values and returns it\n\t * @returns {Recurring} the object that stores the recurring pattern\n\t */\n\tGetValues() {\n\t\tlet values = this.Form.getValues();\n\n\t\tlet res = {\n\t\t\tFREQ: values.FREQ,\n\t\t\tINTERVAL: values.INTERVAL,\n\t\t\tUNTIL: values.until == 2 ? values.untilDate : this.GetUntil(values),\n\t\t\tCOUNT: values.until == 3 ? values.untilCount : null,\n\t\t\tEXDATE: values.EXDATE || [],\n\t\t};\n\n\t\tif (values.FREQ === \"WEEKLY\") {\n\t\t\tres.BYDAY = this.GetBYDAY(values);\n\t\t} else if (values.FREQ === \"MONTHLY\" || values.FREQ === \"YEARLY\") {\n\t\t\tres = webix.extend(res, this.GetRecPattern(values));\n\t\t}\n\n\t\tthis.Form.setDirty();\n\n\t\treturn res;\n\t}\n\n\t/**\n\t * Calculates the end of repetition as date based on COUNT\n\t * @param {Object} values - values from the form\n\t * @returns {Date}\n\t */\n\tGetUntil(values) {\n\t\tif (values.until == 3) {\n\t\t\tconst consts = {};\n\t\t\tfillWdays(values, consts);\n\t\t\tlet date = webix.Date.copy(this._StartDate);\n\t\t\tfor (let i = 1; i < values.untilCount; ++i) {\n\t\t\t\tdate = next(date, values, consts);\n\t\t\t}\n\t\t\tdate = webix.Date.add(date, 1, \"day\", true);\n\t\t\tthis.Form.setValues({ untilDate: date }, true);\n\t\t\treturn date;\n\t\t} else return null;\n\t}\n\n\t/**\n\t * Collects all values and sends them to the master form for event update (via global app event)\n\t * @param {string} mode - \"user\" means that the change was made via UI\n\t */\n\tUpdateEvent(mode) {\n\t\tif (mode === \"user\") {\n\t\t\tconst change = this.GetValues();\n\t\t\tthis.app.callEvent(\"form:update:recurring\", [{ $recurring: change }]);\n\t\t\tthis.Form.setDirty();\n\t\t}\n\t}\n\n\t/**\n\t * Checks if this form has changed values\n\t * @returns {Boolean}\n\t */\n\tIsDirty() {\n\t\treturn this.Form.isDirty();\n\t}\n\n\t/**\n\t * Shows this form\n\t */\n\tShow() {\n\t\tthis.getRoot().show();\n\t}\n\n\t/**\n\t * Hides this form\n\t */\n\tHide() {\n\t\tthis.getRoot().hide();\n\t}\n}\n","import {\n\tisFirstOccurrence,\n\tcorrectMode,\n\textractDate,\n\tFREQUENCE,\n\tfillWdays,\n\tnext,\n} from \"./recurring\";\n\n/* public functions */\n\n/**\n * Changes the mode if the user selected the 1st occurrence in whole sequence or in 'next'\n * @param {string} mode - the mode of editing a recurring event (\"all\", \"next\", \"this\")\n * @param {object} obj - the event object\n * @param {Date} start - the start date of the event\n * @param {Date, string} date_id - the ID of an occurrence of a repeated event or the date of this occurrence\n */\nfunction changeMode(mode, obj, start, date_id) {\n\tif (mode && mode === \"next\" && isFirstOccurrence(date_id, start)) {\n\t\tmode = correctMode.call(this, obj, mode);\n\t}\n\n\treturn mode;\n}\n\n/**\n * Corrects recurring.COUNT or recurring.UNTIL based on all sub-events that are included in the edited range\n * @param {Object} obj - the event data\n * @param {string} mode - the mode of recurring editing (\"all\", \"next\")\n * @param {Date} sdate - the date of the currently selected event occurrence\n * @param {Object} collection - DataCollection of events\n */\nfunction correctCountUntil(obj, mode, sdate, collection) {\n\tconst oid = obj.origin_id || obj.$id || obj.id;\n\tconst parts = collection\n\t\t.find(e => {\n\t\t\treturn oid == e.origin_id && sdate < e.start_date;\n\t\t})\n\t\t.sort((a, b) => {\n\t\t\tif (a.start_date > b.start_date) return -1;\n\t\t\tif (a.start_date < b.start_date) return 1;\n\t\t\treturn 0;\n\t\t});\n\n\tconst rec = webix.copy(obj.$recurring);\n\n\tfor (let i = 0, last; i < parts.length; ++i) {\n\t\tlast = parts[i];\n\n\t\tif (last.$recurring) {\n\t\t\tif (last.$recurring.COUNT) {\n\t\t\t\tif (rec.COUNT && obj.$id != last.id) {\n\t\t\t\t\trec.COUNT = rec.COUNT * 1 + last.$recurring.COUNT * 1;\n\t\t\t\t} else {\n\t\t\t\t\trec.UNTIL = countToUntil(last);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trec.UNTIL = last.$recurring.UNTIL;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (mode === \"next\" && !parts.length) {\n\t\tif (rec.COUNT) {\n\t\t\trec.COUNT = cutCount(obj, sdate);\n\t\t} else if (rec.UNTIL && obj.start_date >= rec.UNTIL) {\n\t\t\trec.UNTIL = webix.Date.add(\n\t\t\t\twebix.Date.dayStart(obj.start_date),\n\t\t\t\t1,\n\t\t\t\tFREQUENCE[rec.FREQ],\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t}\n\n\treturn rec;\n}\n\n/**\n * Checks if the selected repeating event has only 1 occurrence\n * @param {Object} obj - the event data\n */\nfunction hasOneOccurrence(obj) {\n\t// as this a 'this' event\n\tif (!obj.recurring) return true;\n\n\t// as 'this' any occurrence in unedited sequence\n\tif (!obj.$recurring.UNTIL) return false;\n\n\tconst end = webix.Date.dayStart(webix.Date.add(obj.end_date, 1, \"day\", true));\n\treturn webix.Date.equal(end, obj.$recurring.UNTIL);\n}\n\n/* EO public functions */\n\n/* private functions */\nfunction countToUntil(last) {\n\tconst lr = last.$recurring;\n\tlet step = lr.COUNT * 1; // !\n\tif (lr.FREQ === \"WEEKLY\") {\n\t\tstep = Math.floor((lr.BYDAY.split(\",\").length / 7) * lr.COUNT);\n\t}\n\treturn webix.Date.add(last.start_date, step, FREQUENCE[lr.FREQ], true);\n}\n\nfunction cutCount(obj, sdate) {\n\tconst date = extractDate(sdate);\n\n\tconst consts = {};\n\tfillWdays(obj.$recurring, consts);\n\tlet nexto = webix.Date.dayStart(obj.start_date);\n\tlet count = 0;\n\twhile (nexto < date) {\n\t\tcount++;\n\t\tnexto = next(nexto, obj.$recurring, consts);\n\t}\n\treturn obj.$recurring.COUNT - count;\n}\n/* EO private functions */\n\nexport default function EditRecurringMixin(child) {\n\tchild.ChangeMode = changeMode;\n\tchild.CorrectCountUntil = correctCountUntil;\n\tchild.HasOneOccurrence = hasOneOccurrence;\n}\n","import { JetView } from \"webix-jet\";\nimport getPalette from \"helpers/palette\";\nimport { getYearDay } from \"helpers/dates\";\n\nimport {\n\tWEEKDAYS,\n\tfillWdays,\n\tnext,\n\tdatesToWeekdays,\n\tWeekdaysToDates,\n\tclipSequence,\n\tcutOccurrence,\n\tseparateSequence,\n} from \"helpers/recurring\";\nimport { serialize } from \"helpers/ical\";\nimport RecurringFormView from \"./recurringform\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\n\nexport default class EventFormView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst toolbar = {\n\t\t\tview: \"toolbar\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: 14,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\ttooltip: _(\"Close\"),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => this.Close(),\n\t\t\t\t},\n\t\t\t\t{ view: \"label\", label: _(\"Edit event\") },\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\twidth: 130,\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tvalue: _(\"Done\"),\n\t\t\t\t\thotkey: \"Ctrl+Enter\",\n\t\t\t\t\tclick: () => this.Done(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"form\",\n\t\t\tscroll: true,\n\t\t\tborderless: true,\n\t\t\tpadding: { right: 14 },\n\t\t\telementsConfig: { labelPosition: \"top\" },\n\t\t\telements: [\n\t\t\t\t{ view: \"text\", label: _(\"Event\"), name: \"text\" },\n\t\t\t\t{\n\t\t\t\t\tmargin: 8,\n\t\t\t\t\trows: [\n\t\t\t\t\t\tthis.GetDateTime(\"start\", _, aSkin),\n\t\t\t\t\t\tthis.GetDateTime(\"end\", _, aSkin),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\tname: \"all_day\",\n\t\t\t\t\tlabelPosition: \"left\",\n\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\tlabelRight: _(\"All Day\"),\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: v => this.ToggleTimeControls(v),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.CreateCalendarColor(_),\n\t\t\t\t{\n\t\t\t\t\tview: \"textarea\",\n\t\t\t\t\tlabel: _(\"Notes\"),\n\t\t\t\t\tname: \"details\",\n\t\t\t\t\theight: 150,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonChange: (v, o, m) => {\n\t\t\t\t\t// some fields need preprocessing\n\t\t\t\t\tconst change = this.Form.getDirtyValues();\n\t\t\t\t\tif (Object.keys(change).length) this.PrepareChange(change);\n\t\t\t\t\tif (!this.Compact && m === \"user\")\n\t\t\t\t\t\tthis.Wait(() => this.UpdateEvent(change));\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tif (this.app.config.recurring)\n\t\t\tform.elements.splice(3, 0, this.CreateRepeat(_, aSkin));\n\n\t\tif (this.app.config.units) {\n\t\t\tconst index = this.app.config.recurring ? 5 : 4;\n\t\t\tform.elements.splice(index, 0, this.CreateUnitSelector(_));\n\t\t}\n\n\t\tif (this.app.config.timeline) {\n\t\t\tlet index = this.app.config.recurring ? 5 : 4;\n\t\t\tif (this.app.config.units) index++;\n\t\t\tform.elements.splice(index, 0, this.CreateSectionSelector(_));\n\t\t}\n\n\t\tconst config = {\n\t\t\tview: \"proxy\", // for borders\n\t\t\tbody: {\n\t\t\t\tmargin: 0,\n\t\t\t\trows: [toolbar, form],\n\t\t\t},\n\t\t};\n\n\t\treturn config;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.Form = this.$$(\"form\");\n\t\tthis.Local = this.app.getService(\"local\").events(true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\n\t\t// extending this class with common methods for editing of recurring events\n\t\tEditRecurringMixin(this);\n\n\t\t// most commonly called controls\n\t\tthis.RecurringOptions = this.$$(\"recOption\");\n\t\tthis.StartTime = this.$$(\"startTime\");\n\t\tthis.EndTime = this.$$(\"endTime\");\n\n\t\tthis.on(this.State.$changes, \"readonly\", (_v, o) => {\n\t\t\tif (!webix.isUndefined(o)) this.Close();\n\t\t});\n\n\t\tthis.on(this.app, \"form:update:recurring\", update => {\n\t\t\t// 'update' as imitated dirty value\n\t\t\tif (Object.keys(update).length) this.PrepareChange(update);\n\t\t\tthis.UpdateEvent(update);\n\t\t});\n\n\t\t// parse lists that are not data dependable\n\t\tconst local = this.app.getService(\"local\");\n\t\tif (this.app.config.calendars) {\n\t\t\tthis.Calendars = local.calendars(true);\n\t\t\tthis.$$(\"calendar\")\n\t\t\t\t.getList()\n\t\t\t\t.parse(this.Calendars);\n\t\t}\n\n\t\tif (this.app.config.units) {\n\t\t\tconst waitUnits = local.units();\n\t\t\tconst combo = this.Form.elements[\"units\"];\n\t\t\twaitUnits.then(units => {\n\t\t\t\tcombo.getList().parse(units);\n\t\t\t\tcombo.refresh();\n\t\t\t});\n\t\t}\n\n\t\tif (this.app.config.timeline) {\n\t\t\tthis.Sections = local.sections(true);\n\t\t\tthis.$$(\"sections\")\n\t\t\t\t.getList()\n\t\t\t\t.parse(this.Sections);\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.SubForm = this.getSubView(\"recurringForm\");\n\t\tthis.on(this.State.$changes, \"selected\", v => {\n\t\t\tif (v) {\n\t\t\t\tthis.ClearTempEvent(); // support double clicks and 'Create' at any moment\n\t\t\t\tthis.Wait(() => this.FillForm(v));\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy() {\n\t\tthis.ClearTempEvent();\n\t}\n\n\t/**\n\t * Returns the config controls for editing recurring patterns of events\n\t * @param {function} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t * @param {Object} aSkin - stores sizes and colors of a currently active Webix skin\n\t */\n\tCreateRepeat(_, aSkin) {\n\t\tconst rows = [\n\t\t\t{ view: \"label\", label: _(\"Repeat\"), height: aSkin.labelTopHeight },\n\t\t\t{\n\t\t\t\tmargin: 4,\n\t\t\t\tcols: [\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\t\tlocalId: \"recOption\",\n\t\t\t\t\t\tname: \"rec_option\",\n\t\t\t\t\t\tsuggest: {\n\t\t\t\t\t\t\tdata: [\n\t\t\t\t\t\t\t\t{ id: \"none\", value: _(\"never\") },\n\t\t\t\t\t\t\t\t{ id: \"daily\", value: _(\"daily\") },\n\t\t\t\t\t\t\t\t{ id: \"weekly\" },\n\t\t\t\t\t\t\t\t{ id: \"monthly\" },\n\t\t\t\t\t\t\t\t{ id: \"yearly\" },\n\t\t\t\t\t\t\t\t{ id: \"work\", value: _(\"every working day\") },\n\t\t\t\t\t\t\t\t{ id: \"custom\", value: _(\"custom\") },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\tonChange: (v, o) => this.ToggleSubform(v, o),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t];\n\n\t\tif (this.Compact) {\n\t\t\trows[1].cols.push({\n\t\t\t\tlocalId: \"editCustomRec\",\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-pencil\",\n\t\t\t\ttooltip: _(\"Change recurring pattern\"),\n\t\t\t\thidden: true,\n\t\t\t\tclick: () => this.ShowSubForm(),\n\t\t\t});\n\t\t}\n\n\t\trows.push({ $subview: RecurringFormView, name: \"recurringForm\" });\n\n\t\treturn { localId: \"repeatControls\", rows: rows };\n\t}\n\n\t/**\n\t * Hides or shows time selectors\n\t * @param {number} v - the value of 'all day' checkbox (1 or 0)\n\t */\n\tToggleTimeControls(v) {\n\t\tif (v == 1) {\n\t\t\tthis.StartTime.hide();\n\t\t\tthis.EndTime.hide();\n\t\t} else {\n\t\t\tthis.StartTime.show();\n\t\t\tthis.EndTime.show();\n\t\t}\n\t}\n\n\t/**\n\t * Shows or hides the subform for editing recurring pattern; the subform is shown when v is 'custom'\n\t * @param {string} v - the new recurring pattern option\n\t * @param {string} o  - the new recurring pattern option\n\t */\n\tToggleSubform(v, o) {\n\t\tif (v === \"custom\") {\n\t\t\tif (this.Compact) {\n\t\t\t\tthis.$$(\"editCustomRec\").show();\n\t\t\t\tif (o) this.ShowSubForm();\n\t\t\t} else {\n\t\t\t\tthis.SubForm.Show();\n\t\t\t}\n\t\t} else {\n\t\t\tthis.SubForm.Hide();\n\t\t\tif (this.Compact) this.$$(\"editCustomRec\").hide();\n\t\t}\n\t}\n\n\t/**\n\t * Returns the config of two controls: a selector of calendar and event color\n\t * @param {function} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t */\n\tCreateCalendarColor(_) {\n\t\tconst ui = {\n\t\t\tmargin: 8,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"colorpicker\",\n\t\t\t\t\tlabel: _(\"Color\"),\n\t\t\t\t\tname: \"color\",\n\t\t\t\t\tvalue: \"#1abc9c\",\n\t\t\t\t\tsuggest: {\n\t\t\t\t\t\ttype: \"colorboard\",\n\t\t\t\t\t\tpadding: 3,\n\t\t\t\t\t\tbody: getPalette(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t\tif (this.app.config.calendars) {\n\t\t\tui.cols.unshift({\n\t\t\t\tview: \"richselect\",\n\t\t\t\tlocalId: \"calendar\",\n\t\t\t\tlabel: _(\"Calendar\"),\n\t\t\t\tname: \"calendar\",\n\t\t\t\tcss: \"webix_scheduler_cal_color\",\n\t\t\t\toptions: {\n\t\t\t\t\tcss: \"webix_scheduler_cal_color_suggest\",\n\t\t\t\t\tdata: [],\n\t\t\t\t\tbody: {\n\t\t\t\t\t\ttooltip: () => \"\",\n\t\t\t\t\t\ttemplate: function(obj) {\n\t\t\t\t\t\t\tconst active = obj.active * 1;\n\t\t\t\t\t\t\tconst css = active ? \"\" : \"class='webix_scheduler_cal_disabled'\";\n\t\t\t\t\t\t\tconst tooltip = active\n\t\t\t\t\t\t\t\t? \"\"\n\t\t\t\t\t\t\t\t: `webix_tooltip=\"${_(\"Inactive calendar\")}\"`;\n\n\t\t\t\t\t\t\treturn `<div style=\"overflow: hidden;\" ${tooltip} ${css}>${obj.text ||\n\t\t\t\t\t\t\t\t_(\"(no title)\")}\n\t\t\t\t\t\t\t\t<span class=\"webix_scheduler_cal_marker\" style=\"background-color:${obj.color};\">\n\t\t\t\t\t\t\t</span></div>`;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\treturn ui;\n\t}\n\n\t/**\n\t * Returns the config of two controls: a selector of calendar and event color\n\t * @param {function} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t */\n\tCreateUnitSelector(_) {\n\t\tconst ui = {\n\t\t\tview: \"multicombo\",\n\t\t\tname: \"units\",\n\t\t\tlabel: _(\"Units\"),\n\t\t\toptions: [],\n\t\t};\n\t\treturn ui;\n\t}\n\n\t/**\n\t * Returns the config of controls for selecting date and time\n\t * @param {string} type - \"start\" or \"end\"\n\t * @param {function*} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t * @param {Object} aSkin - stores sizes and colors of a currently active Webix skin\n\t */\n\tGetDateTime(type, _, aSkin) {\n\t\treturn {\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tview: \"label\",\n\t\t\t\t\theight: aSkin.labelTopHeight,\n\t\t\t\t\tlabel: type === \"start\" ? _(\"Start\") : _(\"End\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmargin: 8,\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\t\tname: `${type}_date`,\n\t\t\t\t\t\t\tsuggest: {\n\t\t\t\t\t\t\t\ttype: \"calendar\",\n\t\t\t\t\t\t\t\ticons: false,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\t\tlocalId: `${type}Time`,\n\t\t\t\t\t\t\tname: `${type}_time`,\n\t\t\t\t\t\t\ttype: \"time\",\n\t\t\t\t\t\t\tformat: \"%H:%i\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tCreateSectionSelector(_) {\n\t\treturn {\n\t\t\tlocalId: \"sections\",\n\t\t\tview: \"richselect\",\n\t\t\tlabel: _(\"Section\"),\n\t\t\tname: \"section\",\n\t\t\toptions: {\n\t\t\t\tdata: [],\n\t\t\t\tbody: {\n\t\t\t\t\ttemplate: \"#text#\",\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\t// general form tasks\n\n\t/**\n\t * Fills the form with relevant values for editing of a selected event or adding a new event\n\t * @param {Object} ev - the current state.selected\n\t */\n\tFillForm(ev) {\n\t\tthis.Id = ev.id;\n\n\t\tthis.Form.focus();\n\t\tthis.Date = ev.date;\n\t\tif (typeof this.Date === \"string\") {\n\t\t\tthis.Date = new Date(this.Date.slice(0, this.Date.indexOf(\"_\")) * 1);\n\t\t}\n\n\t\tlet obj;\n\n\t\t// new record or a new copy of a record\n\t\tif (ev.id == \"0\") {\n\t\t\tif (this.State.clipboard && this.State.clipboard.selected) {\n\t\t\t\tobj = this.State.clipboard.selected;\n\t\t\t\tthis.$$(\"repeatControls\").hide();\n\t\t\t} else {\n\t\t\t\tobj = this.NewEvent(ev);\n\t\t\t}\n\n\t\t\tif (obj.then) {\n\t\t\t\treturn obj.then(res => {\n\t\t\t\t\tthis.Local.add({ id: ev.id, ...webix.copy(res) });\n\t\t\t\t\tthis.FillFormContinue(res);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.Local.add({ id: ev.id, ...webix.copy(obj) });\n\t\t\t}\n\t\t} else {\n\t\t\tobj = webix.copy(this.Local.getItem(ev.id));\n\n\t\t\tconst mode = this.getParam(\"mode\", true);\n\t\t\tif (mode) obj = this.AdaptObjToMode(mode, obj);\n\t\t}\n\n\t\tthis.FillFormContinue(obj);\n\t}\n\n\t/**\n\t * Fills the event object with relevant values according to the mode of editing\n\t * @param {string} mode - mode in which a recurring event will be edited (\"all\", \"next\", \"this\")\n\t * @param {Object} obj - event data\n\t */\n\tAdaptObjToMode(mode, obj) {\n\t\tmode = this.ChangeMode(\n\t\t\tmode,\n\t\t\tobj,\n\t\t\tobj.recurring\n\t\t\t\t? obj.start_date\n\t\t\t\t: this.Local.getItem(obj.origin_id).start_date,\n\t\t\tobj.recurring ? this.State.selected.date : obj.start_date\n\t\t);\n\t\tthis.setParam(\"mode\", mode, true);\n\n\t\tif (mode === \"all\" || mode === \"next\") {\n\t\t\tif (mode === \"all\" && obj.origin_id) {\n\t\t\t\tobj = webix.copy(this.Local.getItem(obj.origin_id));\n\t\t\t}\n\n\t\t\t// if this is a \"this\" sub-event\n\t\t\tif (!obj.$recurring)\n\t\t\t\tobj.$recurring = webix.copy(\n\t\t\t\t\tthis.Local.getItem(obj.origin_id).$recurring\n\t\t\t\t);\n\n\t\t\tif (obj.$recurring.COUNT || obj.$recurring.UNTIL) {\n\t\t\t\t// [FIXME] maybe need to store total UNTIL/COUNT on backend (mostly for dynamic loading)\n\t\t\t\tobj.$recurring = this.CorrectCountUntil(\n\t\t\t\t\tobj,\n\t\t\t\t\tmode,\n\t\t\t\t\tobj.start_date,\n\t\t\t\t\tthis.Local\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (mode === \"this\" || mode === \"next\") {\n\t\t\t// split event sequence or cut out an occurrence\n\t\t\tif (this.State.selected.date)\n\t\t\t\tobj = { ...obj, ...separateSequence(obj, this.State.selected.date) };\n\n\t\t\tif (mode === \"this\") {\n\t\t\t\tobj.$recurring = null;\n\t\t\t\tobj.recurring = \"\";\n\t\t\t\tthis.$$(\"repeatControls\").hide();\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Splits start and end dates into date and time parts and fills the form with values\n\t * @param {Object} obj - the event data\n\t */\n\tFillFormContinue(obj) {\n\t\tobj.start_time = webix.Date.copy(obj.start_date);\n\t\tobj.end_time = webix.Date.copy(obj.end_date);\n\n\t\tobj.start_date = webix.Date.datePart(obj.start_date);\n\t\tobj.end_date = webix.Date.datePart(obj.end_date);\n\n\t\tif (this.app.config.recurring) this.SetRecurring(obj);\n\n\t\tthis.Form.setValues(obj);\n\t}\n\n\t/**\n\t * Describes calculated constants of a date\n\t * @typedef {Object} DateInfo\n\t * @property {number} day - the date (day of month)\n\t * @property {number} weekday - the number of a weekday (0-6)\n\t * @property {number} month - the number of month (0-11)\n\t * @property {number} weekNum - the number of a weekday within a month (e.g. 4th Friday)\n\t */\n\n\t/**\n\t * Calculates constants related to the start date of an event\n\t * @param {Date} start - the start date of an event\n\t * @returns {DateInfo}\n\t */\n\tGetFromStartDate(start) {\n\t\tconst res = {\n\t\t\tweekday: start.getDay(),\n\t\t\tday: start.getDate(),\n\t\t\tmonth: start.getMonth(),\n\t\t\tyearday: getYearDay(start),\n\t\t};\n\t\tres.weekNum = Math.floor(res.day / 7) + (res.day % 7 ? 1 : 0);\n\t\treturn res;\n\t}\n\n\t/**\n\t * Sets controls and their values for recurring patterns\n\t * @param {Object} obj - the event data\n\t */\n\tSetRecurring(obj) {\n\t\tconst today = this.GetFromStartDate(obj.start_date);\n\t\tconst roptions = this.ResetRecurringOptions(today);\n\t\tthis.RecurringOptions.getList().parse(roptions);\n\n\t\tthis.SubForm.SetValues(webix.copy(obj), today, true);\n\n\t\tif (!obj.$recurring) {\n\t\t\tobj.rec_option = \"none\";\n\t\t} else if (obj.$recurring.BYDAY === \"MO,TU,WE,TH,FR\") {\n\t\t\tobj.rec_option = \"work\";\n\t\t} else if (\n\t\t\t!obj.$recurring.UNTIL &&\n\t\t\t!obj.$recurring.COUNT &&\n\t\t\t(!obj.$recurring.INTERVAL || obj.$recurring.INTERVAL == 1) &&\n\t\t\t(obj.$recurring.FREQ === \"DAILY\" ||\n\t\t\t\t(obj.$recurring.FREQ === \"WEEKLY\" &&\n\t\t\t\t\tobj.$recurring.BYDAY == WEEKDAYS[today.weekday]) ||\n\t\t\t\t(obj.$recurring.FREQ === \"MONTHLY\" &&\n\t\t\t\t\tobj.$recurring.BYSETPOS &&\n\t\t\t\t\tobj.$recurring.BYSETPOS == today.weekNum &&\n\t\t\t\t\tobj.$recurring.BYDAY == WEEKDAYS[today.weekday]) ||\n\t\t\t\t(obj.$recurring.FREQ === \"YEARLY\" &&\n\t\t\t\t\tobj.$recurring.BYMONTH == today.month + 1 &&\n\t\t\t\t\tobj.$recurring.BYMONTHDAY == today.day))\n\t\t) {\n\t\t\tobj.rec_option = obj.$recurring.FREQ.toLowerCase();\n\t\t} else {\n\t\t\tobj.rec_option = \"custom\";\n\t\t}\n\t}\n\n\t/**\n\t * Returns date-dependent options for recurring pattern select list\n\t * @param {Date} start - the start date of an event\n\t */\n\tResetRecurringOptions(start) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: \"weekly\",\n\t\t\t\tvalue: `${_(\"weekly, every\")} ${\n\t\t\t\t\twebix.i18n.calendar.dayFull[start.weekday]\n\t\t\t\t}`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"monthly\",\n\t\t\t\tvalue: `${_(\"monthly, every\")} ${start.weekNum} ${_(\"week on\")} ${\n\t\t\t\t\twebix.i18n.calendar.dayFull[start.weekday]\n\t\t\t\t}`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"yearly\",\n\t\t\t\tvalue: `${_(\"yearly, every\")} ${\n\t\t\t\t\twebix.i18n.calendar.monthFull[start.month]\n\t\t\t\t} ${start.day}`,\n\t\t\t},\n\t\t];\n\t}\n\n\t/**\n\t * Joins date and time into one Date object\n\t * @param {Date} date - a date without a time part\n\t * @param {Date} time - a date with a time part\n\t */\n\tJoin(date, time) {\n\t\treturn webix.Date.add(date, webix.Date.timePart(time) / 60, \"minute\", true);\n\t}\n\n\t/**\n\t * Returns an object with values for adding a new event\n\t * @param {Object} params - current state.selected property\n\t */\n\tNewEvent(params) {\n\t\tconst start = this.GetStartDate();\n\t\tconst end =\n\t\t\tthis.State.selected.end_date || webix.Date.add(start, 1, \"hour\", true);\n\n\t\tconst obj = {\n\t\t\tstart_date: start,\n\t\t\tend_date: end,\n\t\t\ttext: \"\",\n\t\t\tdetails: \"\",\n\t\t};\n\t\tif (this.app.config.recurring) obj.recurring = \"\";\n\t\tif (this.app.config.timeline) {\n\t\t\tobj.section = params.section || this.Sections.getFirstId();\n\t\t}\n\n\t\tif (this.app.config.calendars) {\n\t\t\tlet active = this.State.active[0];\n\t\t\tif (!active) {\n\t\t\t\tconst first = this.Calendars.getFirstId();\n\t\t\t\tconst wait = first\n\t\t\t\t\t? this.Ops.updateCalendar(first, { active: 1 })\n\t\t\t\t\t: this.Ops.addCalendar();\n\n\t\t\t\treturn wait.then(() => {\n\t\t\t\t\tobj.calendar = this.State.active[0];\n\t\t\t\t\tobj.$color = this.Calendars.getItem(obj.calendar).color;\n\t\t\t\t\treturn obj;\n\t\t\t\t});\n\t\t\t}\n\t\t\tobj.calendar = active;\n\t\t\tobj.$color = this.Calendars.getItem(obj.calendar).color;\n\t\t} else obj.$color = \"#01C2A5\"; //same for default color in datacollection\n\n\t\tif (this.app.config.calendars && params.unit) {\n\t\t\tobj.units = params.unit;\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Returns a start date of a new object based on:\n\t * 1) the origin of the double click of the user\n\t * 2) the current date and time\n\t */\n\tGetStartDate() {\n\t\tif (this.Date) {\n\t\t\treturn webix.Date.copy(this.Date);\n\t\t} else {\n\t\t\tconst date = new Date();\n\t\t\tconst minutes = Math.ceil(date.getMinutes() / 30) * 30;\n\t\t\tconst res = webix.Date.copy(this.State.date);\n\t\t\tres.setHours(date.getHours(), minutes);\n\t\t\treturn res;\n\t\t}\n\t}\n\n\t/**\n\t * Launches saving of changes made in the form\n\t * @param {Object} change - an object with changed values\n\t */\n\tUpdateEvent(change) {\n\t\t// clear 'dirty' flag so that next change will definitely be 'dirty'\n\t\tthis.Form.setDirty();\n\n\t\tif (this.Id === \"0\") {\n\t\t\tconst data = this.PrepareOut(change);\n\t\t\tthis._inProgress = this.Ops.addEvent(data, true, this.Id);\n\t\t} else if (Object.keys(change).length) {\n\t\t\tthis._inProgress = this.UpdateExisting(this.Id, change);\n\t\t}\n\n\t\tif (this._inProgress) {\n\t\t\tthis.app.callEvent(\"backend:operation\", [this._inProgress]);\n\t\t\tthis._inProgress\n\t\t\t\t.then(id => {\n\t\t\t\t\tif (id) this.UpdateSelection(id);\n\n\t\t\t\t\t// make event visible if new dates are outside currently selected dates\n\t\t\t\t\tthis.ChangeDate(change, this.Form.getValues());\n\n\t\t\t\t\t// continue editing in simple mode\n\t\t\t\t\tthis.setParam(\"mode\", \"\", true);\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis._inProgress = null;\n\t\t\t\t});\n\t\t}\n\n\t\treturn this._inProgress || webix.promise.resolve();\n\t}\n\n\t/**\n\t * Updates an existing event\n\t * @param {(string|number)} sid - the ID of the event\n\t * @param {Object} change - the new data\n\t * @returns {Promise}\n\t */\n\tUpdateExisting(sid, change) {\n\t\tlet mode = this.getParam(\"mode\", true);\n\t\tconst obj = this.Local.getItem(sid);\n\n\t\tif ((mode === \"this\" && !this.HasOneOccurrence(obj)) || mode === \"next\") {\n\t\t\t// cut out occurrence or split event sequence and save as separate events\n\t\t\tchange.origin_id = obj.origin_id || obj.id;\n\t\t\tconst newEvent = this.PrepareOut(change);\n\n\t\t\tlet recurring = \"\";\n\t\t\tif (mode === \"this\") {\n\t\t\t\trecurring = cutOccurrence(this.State.selected.date, obj);\n\t\t\t} else {\n\t\t\t\tlet params;\n\t\t\t\tif (obj.recurring) {\n\t\t\t\t\tparams = [this.State.selected.date, obj];\n\t\t\t\t} else {\n\t\t\t\t\tsid = obj.origin_id;\n\t\t\t\t\tparams = [newEvent.start_date, this.Local.getItem(sid)];\n\t\t\t\t}\n\t\t\t\trecurring = clipSequence(...params);\n\t\t\t}\n\n\t\t\treturn this.Ops.updateEvent(\n\t\t\t\tsid,\n\t\t\t\t{ recurring },\n\t\t\t\tmode,\n\t\t\t\twebix.Date.dayStart(newEvent.start_date),\n\t\t\t\ttrue\n\t\t\t).then(() => {\n\t\t\t\tif (change.rec_option === \"none\") this.State.selected.date = null;\n\t\t\t\treturn this.Ops.addEvent(newEvent, true);\n\t\t\t});\n\t\t} else {\n\t\t\t// non-recurring and recurring in mode \"all\"\n\n\t\t\tif (mode === \"all\") {\n\t\t\t\tconst recVals = this.Form.getValues().$recurring;\n\t\t\t\tif (recVals && webix.isUndefined(change.recurring)) {\n\t\t\t\t\tdelete recVals.EXDATE;\n\t\t\t\t\tchange.recurring = serialize(recVals); // plus all that's been updated in form silently in FillForm\n\n\t\t\t\t\tthis.Form.setValues(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$recurring: recVals,\n\t\t\t\t\t\t\trecurring: change.recurring,\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\t\tthis.SubForm.SetValues({ EXDATE: null });\n\t\t\t\t}\n\n\t\t\t\tif (obj.origin_id) this.Id = this.State.selected.id = obj.origin_id;\n\t\t\t}\n\n\t\t\treturn this.Ops.updateEvent(this.Id, change, mode, undefined, true).then(\n\t\t\t\t() => {\n\t\t\t\t\tif (change.rec_option === \"none\") this.State.selected.date = null;\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * if event was saved as new, update selected silently to avoid triggering listeners\n\t * @param {(string|number)} id - the ID of the event\n\t */\n\tUpdateSelection(id) {\n\t\tthis.State.selected.id = this.Id = id;\n\t\tconst sdate = this.State.selected.date;\n\t\tif (sdate instanceof Date) {\n\t\t\tthis.State.selected.date = null;\n\t\t} else if (sdate) {\n\t\t\tconst fvals = this.Form.getValues();\n\t\t\tthis.State.selected.date =\n\t\t\t\tthis.Join(fvals.start_date, fvals.start_time).valueOf() + \"_\" + id;\n\t\t}\n\t}\n\n\t/**\n\t * Processes changes made in the form and prepares values for saving to the server\n\t * @param {Object} change - an object with changed values\n\t */\n\tPrepareChange(change) {\n\t\tif (change.rec_option) this.ProcessRecurringOption(change);\n\t\telse if (!webix.isUndefined(change.$recurring)) {\n\t\t\tthis.ProcessRecurringPattern(change);\n\t\t}\n\n\t\tthis.ProcessDates(change);\n\n\t\tif (this.app.config.recurring && change.start_date)\n\t\t\tthis.ApplyDatechangeToRecurring(change);\n\n\t\tthis.ProcessText(change, \"text\");\n\t\tthis.ProcessText(change, \"details\");\n\n\t\tthis._changedValues = change;\n\t}\n\n\t/**\n\t * Gets recurring pattern according to the new recurring option\n\t * @param {Object} change - an object with changed values\n\t */\n\tProcessRecurringOption(change) {\n\t\tconst fvals = this.Form.getValues();\n\n\t\tif (change.rec_option === \"none\") {\n\t\t\tchange.recurring = \"\";\n\t\t\tchange.series_end_date = \"\";\n\t\t} else if (change.rec_option === \"custom\") {\n\t\t\tif (fvals.$recurring) {\n\t\t\t\tthis.SubForm.SetValues(\n\t\t\t\t\t{ ...fvals, ...change },\n\t\t\t\t\tthis.GetFromStartDate(fvals.start_date)\n\t\t\t\t);\n\t\t\t}\n\t\t\tchange.$recurring = this.SubForm.GetValues();\n\t\t\tthis.ProcessRecurringPattern(change);\n\n\t\t\tif (!fvals.$recurring) {\n\t\t\t\tthis.Form.setValues({ $recurring: change.$recurring }, true);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.GetRecurring(change.rec_option, change, fvals.start_date);\n\t\t\tchange.series_end_date = \"\";\n\t\t}\n\n\t\tdelete change.rec_option;\n\t\tdelete change.$recurring;\n\t}\n\n\t/**\n\t * Serializes recurring pattern object and synchronizes dates with the new pattern\n\t * @param {Object} change - an object with changed values\n\t */\n\tProcessRecurringPattern(change) {\n\t\tconst fvals = this.Form.getValues();\n\t\tconst recurring = serialize(change.$recurring);\n\t\tconst old = this.Local.getItem(this.State.selected.id);\n\n\t\t// check if switch from a preset to custom and back and the pattern is the same\n\t\tif (!old || recurring !== old.recurring) {\n\t\t\tchange.recurring = recurring;\n\t\t\tchange.series_end_date = change.$recurring.UNTIL;\n\n\t\t\tif (change.$recurring.BYDAY) {\n\t\t\t\t[change.start_date, change.end_date] = datesToWeekdays(\n\t\t\t\t\tfvals.start_date,\n\t\t\t\t\tfvals.end_date,\n\t\t\t\t\tchange.$recurring\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.Form.setValues(change, true);\n\t\t}\n\t\tdelete change.$recurring;\n\t}\n\n\t/**\n\t * Sums up dates and time depending on the changes in dates, time and all_day flag\n\t * @param {Object} change - an object with changed values\n\t */\n\tProcessDates(change) {\n\t\tconst fvals = this.Form.getValues();\n\t\tif (webix.isUndefined(change.all_day)) {\n\t\t\tif ((change.start_date || change.start_time) && fvals.all_day == 0) {\n\t\t\t\tchange.start_date = this.Join(fvals.start_date, fvals.start_time);\n\t\t\t}\n\t\t\tif ((change.end_date || change.end_time) && fvals.all_day == 0) {\n\t\t\t\tchange.end_date = this.Join(fvals.end_date, fvals.end_time);\n\t\t\t}\n\t\t} else if (change.all_day == 1) {\n\t\t\tchange.start_date = fvals.start_date;\n\t\t\tchange.end_date = fvals.end_date;\n\t\t} else if (change.all_day == 0) {\n\t\t\tchange.start_date = this.Join(fvals.start_date, fvals.start_time);\n\t\t\tchange.end_date = this.Join(fvals.end_date, fvals.end_time);\n\t\t}\n\n\t\tif (change.start_date || change.end_date) this.CorrectDateTime(change);\n\t}\n\n\t/**\n\t * Corrects the unchanged field if start > end or end < start\n\t * @param {Object} change - an object with changed values\n\t */\n\tCorrectDateTime(change) {\n\t\tconst fvals = this.Form.getValues();\n\t\tconst old = this.Local.getItem(this.State.selected.id);\n\t\tconst ev_length = (old.end_date - old.start_date) / 1000 / 60; // minutes\n\n\t\tconst type = change.start_date ? \"start\" : \"end\";\n\t\tconst opposite = type === \"start\" ? \"end\" : \"start\";\n\n\t\tconst start = change.start_date || old.start_date;\n\t\tconst end = change.end_date || old.end_date;\n\n\t\tif ((start >= end && !fvals.all_day) || start > end) {\n\t\t\tchange[opposite + \"_date\"] = webix.Date.add(\n\t\t\t\tchange[type + \"_date\"],\n\t\t\t\t(type === \"start\" ? 1 : -1) * (ev_length || 60),\n\t\t\t\t\"minute\",\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\t// apply also to form\n\t\t\tthis.Form.setValues(\n\t\t\t\t{\n\t\t\t\t\tstart_date: webix.Date.datePart(change.start_date, true),\n\t\t\t\t\tend_date: webix.Date.datePart(change.end_date, true),\n\t\t\t\t\tstart_time: change.start_time || webix.Date.copy(change.start_date),\n\t\t\t\t\tend_time: change.end_time || webix.Date.copy(change.end_date),\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\n\t\tdelete change.start_time;\n\t\tdelete change.end_time;\n\t}\n\n\t/**\n\t * Removes trailing spaces from input text\n\t * @param {Object} change - an object with changed values\n\t * @param {string} field - the name of a text field ('text', 'details')\n\t */\n\tProcessText(change, field) {\n\t\tif (!this.webix.isUndefined(change[field])) {\n\t\t\tchange[field] = change[field].replace(/(<[^>]+>|^\\s+|\\s+$)/gi, \"\");\n\t\t\tconst prev = this.Local.getItem(this.State.selected.id)[field] || \"\";\n\t\t\tif (change[field] === prev.trim()) delete change[field];\n\t\t}\n\t}\n\n\t/**\n\t * Synchronizes recurring pattern with new start date\n\t * @param {Object} change - an object with changed values\n\t */\n\tApplyDatechangeToRecurring(change) {\n\t\tconst today = this.GetFromStartDate(change.start_date);\n\t\t// if date was changed after subform change, ignore\n\t\tconst fvals = this.Form.getValues();\n\t\tif (!change.recurring && fvals.$recurring) {\n\t\t\tif (fvals.rec_option === \"custom\") {\n\t\t\t\tconst recurring = fvals.$recurring;\n\n\t\t\t\tif (recurring.BYYEARDAY) {\n\t\t\t\t\trecurring.BYYEARDAY = today.yearday;\n\t\t\t\t}\n\t\t\t\tif (recurring.BYMONTH) {\n\t\t\t\t\trecurring.BYMONTH = today.month + 1;\n\t\t\t\t}\n\t\t\t\tif (recurring.BYMONTHDAY) {\n\t\t\t\t\trecurring.BYMONTHDAY = today.day;\n\t\t\t\t}\n\t\t\t\tif (recurring.BYSETPOS) {\n\t\t\t\t\trecurring.BYSETPOS = today.weekNum;\n\t\t\t\t}\n\t\t\t\tif (recurring.BYDAY) {\n\t\t\t\t\trecurring.BYDAY = WeekdaysToDates(\n\t\t\t\t\t\tchange.start_date,\n\t\t\t\t\t\tfvals.$recurring\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (recurring.UNTIL && recurring.UNTIL < change.start_date) {\n\t\t\t\t\tconst oldStart = this.Local.getItem(this.State.selected.id)\n\t\t\t\t\t\t.start_date;\n\t\t\t\t\tconst length = (fvals.$recurring.UNTIL - oldStart) / 1000 / 60; // minutes\n\t\t\t\t\trecurring.UNTIL = webix.Date.add(\n\t\t\t\t\t\tchange.start_date,\n\t\t\t\t\t\tlength,\n\t\t\t\t\t\t\"minute\",\n\t\t\t\t\t\ttrue\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tchange.recurring = serialize(recurring);\n\n\t\t\t\tthis.SubForm.SetValues({ ...fvals, ...change }, today);\n\t\t\t} else {\n\t\t\t\tthis.GetRecurring(fvals.rec_option, change, fvals.start_date);\n\t\t\t\tdelete change.$recurring;\n\t\t\t}\n\t\t}\n\t\tthis.RecurringOptions.getList().parse(this.ResetRecurringOptions(today));\n\t\tthis.RecurringOptions.refresh();\n\t}\n\n\t/**\n\t * Assigns recurring pattern according to a preset\n\t * @param {string} r the ID of a recurring pattern option\n\t * @param {Object} change - an object with changed values\n\t * @param {Date} start - the start date of the event\n\t */\n\tGetRecurring(r, change, start) {\n\t\tlet $recurring = this.GetRecurringPreset(r, start);\n\n\t\tif (r === \"work\" && change.start_date) {\n\t\t\tconst BYDAY = WeekdaysToDates(change.start_date, $recurring);\n\t\t\tif ($recurring.BYDAY !== BYDAY) {\n\t\t\t\t$recurring.BYDAY = BYDAY;\n\t\t\t\tr = \"custom\";\n\t\t\t}\n\t\t}\n\n\t\tconst recurring = serialize($recurring);\n\t\tconst old = this.Local.getItem(this.State.selected.id);\n\n\t\t// check if switch from a preset to custom and back and the pattern is the same\n\t\tif (!old || recurring !== old.recurring) {\n\t\t\tchange.$recurring = $recurring;\n\t\t\tchange.recurring = recurring;\n\t\t\tthis.Form.setValues(\n\t\t\t\t{\n\t\t\t\t\t$recurring: change.$recurring,\n\t\t\t\t\trecurring,\n\t\t\t\t\trec_option: r,\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Gets a recurring pattern object for a pattern preset based on the start date of the event\n\t * @param {string} r - a recurring option (accepted values: \"daily\", \"weekly\", \"work\", \"monthly\", \"yearly\")\n\t * @param {Date} start - the start date of an event\n\t * @returns {Object} - $recurring\n\t */\n\tGetRecurringPreset(r, start) {\n\t\tconst today = this.GetFromStartDate(start);\n\t\tswitch (r) {\n\t\t\tcase \"daily\":\n\t\t\t\treturn { FREQ: \"DAILY\", INTERVAL: 1 };\n\t\t\tcase \"weekly\":\n\t\t\t\treturn {\n\t\t\t\t\tFREQ: \"WEEKLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYDAY: WEEKDAYS[today.weekday],\n\t\t\t\t};\n\t\t\tcase \"work\":\n\t\t\t\treturn {\n\t\t\t\t\tFREQ: \"WEEKLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYDAY: \"MO,TU,WE,TH,FR\",\n\t\t\t\t};\n\t\t\tcase \"monthly\":\n\t\t\t\treturn {\n\t\t\t\t\tFREQ: \"MONTHLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYSETPOS: today.weekNum,\n\t\t\t\t\tBYDAY: WEEKDAYS[today.weekday],\n\t\t\t\t};\n\t\t\tcase \"yearly\":\n\t\t\t\treturn {\n\t\t\t\t\tFREQ: \"YEARLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYMONTH: today.month + 1,\n\t\t\t\t\tBYMONTHDAY: today.day,\n\t\t\t\t};\n\t\t\tdefault:\n\t\t\t\treturn { FREQ: \"DAILY\", INTERVAL: 1 };\n\t\t}\n\t}\n\n\t/**\n\t * Switches Scheduler to another date if the event after change is no longer visible\n\t * @param {Object} dirty - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t */\n\tChangeDate(dirty, fvals) {\n\t\tif (dirty) {\n\t\t\t// start date of non-repeating event changed or repeating event became non-repeating\n\t\t\tif ((dirty.start_date && !fvals.recurring) || dirty.recurring === \"\") {\n\t\t\t\tthis.State.selected.date = null;\n\t\t\t\tthis.UpdateStateDate(dirty.start_date || fvals.start_date);\n\t\t\t} else if (dirty.start_date || dirty.recurring) {\n\t\t\t\tconst date = this.GetClosestOccurrenceDate(dirty, fvals);\n\t\t\t\tthis.State.selected.date =\n\t\t\t\t\tdate.valueOf() + \"_\" + this.State.selected.id;\n\t\t\t\tthis.UpdateStateDate(date);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns the next closest occurrence date when dates or recurring pattern of an event was changed\n\t * @param {Object} dirty - an object with changed data\n\t * @param {Object} fvals - an object of all event form values\n\t * @returns {Date} the date of the next closest occurrence\n\t */\n\tGetClosestOccurrenceDate(dirty, fvals) {\n\t\tlet date = dirty.start_date\n\t\t\t? webix.Date.copy(dirty.start_date)\n\t\t\t: this.Join(fvals.start_date, fvals.start_time);\n\t\tlet end = webix.Date.dayStart(\n\t\t\tthis.State.selected.date\n\t\t\t\t? new Date(this.State.selected.date.split(\"_\")[0] * 1)\n\t\t\t\t: date\n\t\t);\n\t\tif (fvals.series_end_date) {\n\t\t\tend = new Date(\n\t\t\t\tMath.min(webix.Date.add(fvals.series_end_date, -1, \"day\", true), end)\n\t\t\t);\n\t\t}\n\n\t\tconst consts = {};\n\t\tfillWdays(fvals.$recurring, consts);\n\t\tlet temp = webix.Date.copy(date);\n\t\twhile (webix.Date.dayStart(temp) < end) {\n\t\t\ttemp = next(temp, fvals.$recurring, consts);\n\t\t\tif (Math.abs(end - temp) < Math.abs(end - date)) {\n\t\t\t\tdate = webix.Date.copy(temp);\n\t\t\t}\n\t\t}\n\t\treturn date;\n\t}\n\n\t/**\n\t * Updates state.date according to state.mode\n\t * @param {Date} date - new state.date\n\t */\n\tUpdateStateDate(date) {\n\t\tdate = webix.Date.dayStart(date);\n\t\tconst state = this.State;\n\t\tif (\n\t\t\tstate.mode === \"day\" ||\n\t\t\tstate.mode === \"units\" ||\n\t\t\t(state.mode === \"timeline\" && state.timelineMode === \"day\")\n\t\t) {\n\t\t\tconst sdate = webix.Date.dayStart(state.date);\n\t\t\tif (!webix.Date.equal(date, sdate)) {\n\t\t\t\tstate.date = webix.Date.dayStart(date);\n\t\t\t}\n\t\t} else {\n\t\t\tconst { start, end } = this.GetModeBounds();\n\t\t\tif (date < start || date >= end) {\n\t\t\t\tstate.date = webix.Date.dayStart(date);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns start and end dates of a currently displayed period\n\t */\n\tGetModeBounds() {\n\t\tconst state = this.State;\n\t\tlet mode = state.mode;\n\t\tif (mode === \"timeline\") mode = state.timelineMode;\n\t\telse if (mode === \"agenda\") mode = \"month\";\n\t\tlet start = webix.Date[mode + \"Start\"](state.date);\n\t\tlet end = webix.Date.add(start, 1, mode, true);\n\n\t\tif (state.mode === \"month\") {\n\t\t\tstart = webix.Date.weekStart(start);\n\t\t\tconst weeks = Math.ceil((end - start) / (24 * 60 * 60 * 1000) / 7);\n\t\t\tend = webix.Date.add(start, weeks, \"week\", true);\n\t\t}\n\n\t\treturn { start, end };\n\t}\n\n\t/**\n\t * Unites changed and unchanged fields into 1 object for saving newly added events\n\t * @param {Object} change - an object with changed values\n\t */\n\tPrepareOut(change) {\n\t\tlet obj = this.Form.getValues();\n\n\t\tif (!obj.all_day) {\n\t\t\tobj.start_date = this.Join(obj.start_date, obj.start_time);\n\t\t\tobj.end_date = this.Join(obj.end_date, obj.end_time);\n\t\t}\n\n\t\tobj = webix.extend(obj, change || {}, true);\n\n\t\tif (!(change && change.recurring) && obj.$recurring) {\n\t\t\tobj.$recurring.EXDATE = [];\n\t\t\tobj.recurring = serialize(obj.$recurring);\n\t\t}\n\n\t\tif (!obj.origin_id) obj.origin_id = 0;\n\n\t\t// go backend wants a number\n\t\tif (this.app.config.timeline && !obj.section) obj.section = 0;\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Removes a temporary local event\n\t */\n\tClearTempEvent() {\n\t\tconst sid = this.Id;\n\t\tif (sid === \"0\" && this.Local.exists(sid)) {\n\t\t\tthis.Local.remove(sid);\n\t\t}\n\t}\n\n\t/**\n\t * Closes the form and either the whole right panel with it or returns to Info\n\t * @param {boolean} close - if true, the right panel is closed\n\t */\n\tBack(close) {\n\t\tthis.Form.clear();\n\n\t\tif (close || this.State.selected.id === \"0\") {\n\t\t\tthis.State.selected = null;\n\t\t} else {\n\t\t\tconst path = this.Compact ? \"event.formpopup/\" : \"../\";\n\t\t\tthis.show(path + \"event.info\", { target: \"edit\" });\n\t\t}\n\t}\n\n\t/**\n\t * Closes the right panel\n\t */\n\tClose() {\n\t\tif (this._inProgress) {\n\t\t\tthis._inProgress.then(() => {\n\t\t\t\tthis.Back(true);\n\t\t\t});\n\t\t} else {\n\t\t\tconst dirty =\n\t\t\t\tthis.Form.isDirty() || (this.Subform && this.SubForm.IsDirty());\n\t\t\tif (this.Compact && dirty) {\n\t\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\t\twebix\n\t\t\t\t\t.confirm({\n\t\t\t\t\t\ttext: _(\"Save changes?\"),\n\t\t\t\t\t\tcontainer: this.app.getRoot().$view,\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => this.Done(true))\n\t\t\t\t\t.catch(() => this.Back(true));\n\t\t\t} else this.Back(true);\n\t\t}\n\t}\n\n\t/**\n\t * Closes the form\n\t * @param {boolean} close\n\t */\n\tDone(close) {\n\t\tif (this._inProgress) {\n\t\t\tthis._inProgress.then(() => {\n\t\t\t\tthis.Back();\n\t\t\t});\n\t\t} else if (this.State.selected.id === \"0\" || this.Compact) {\n\t\t\tlet change = {};\n\t\t\tif (this.Compact) {\n\t\t\t\tif (this._changedValues) change = this._changedValues;\n\n\t\t\t\tif (this.SubForm.IsDirty()) {\n\t\t\t\t\tchange.$recurring = this.SubForm.GetValues();\n\t\t\t\t\tchange.series_end_date = change.$recurring.UNTIL;\n\t\t\t\t\tdelete change.rec_option;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.UpdateEvent(change).then(() => this.Back(close));\n\t\t} else {\n\t\t\tthis.Back();\n\t\t}\n\t}\n\n\t/**\n\t * Waits until some asynchronous operation finishes (if there's any) and then executes 'handler'\n\t * @param {function} handler - the code that will be executed\n\t */\n\tWait(handler) {\n\t\tif (this._inProgress) {\n\t\t\tthis._inProgress.then(handler);\n\t\t} else {\n\t\t\thandler.call();\n\t\t}\n\t}\n\n\t// compact\n\n\t/**\n\t * Shows a subform with controls for editing recurring pattern in a window\n\t */\n\tShowSubForm() {\n\t\tthis.SubForm.Show();\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst subform = this.SubForm.getRoot();\n\n\t\tconst aSkin = webix.skin.$active;\n\t\twebix.fullscreen.set(subform, {\n\t\t\thead: {\n\t\t\t\tview: \"toolbar\",\n\t\t\t\tpadding: {\n\t\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\t\tright: 14,\n\t\t\t\t},\n\t\t\t\telements: [\n\t\t\t\t\t{ view: \"icon\", icon: \"shi-back\", click: () => this.HideSubPop() },\n\t\t\t\t\t{ view: \"label\", label: _(\"Change recurring pattern\") },\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\tvalue: _(\"Done\"),\n\t\t\t\t\t\twidth: 130,\n\t\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\t\tclick: () => this.HideSubPop(),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t});\n\n\t\tconst win = subform.getTopParentView();\n\t\twin.define({ css: \"webix_scheduler_subform_popup\" });\n\t}\n\n\t/**\n\t * Hides the window with the subform\n\t */\n\tHideSubPop() {\n\t\tthis.SubForm.Hide();\n\t\twebix.fullscreen.exit();\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class FormPopup extends JetView {\n\tconfig() {\n\t\treturn this.app.getService(\"jet-win\").updateConfig({\n\t\t\tview: \"window\",\n\t\t\tfullscreen: true,\n\t\t\thead: false,\n\t\t\tbody: { $subview: true },\n\t\t});\n\t}\n}\n","export default function handler(view) {\n\treturn {\n\t\tattachEvent: (key, handler) => {\n\t\t\twebix.UIManager.addHotKey(key, handler, view);\n\t\t\treturn { key, handler };\n\t\t},\n\t\tdetachEvent: ({ key, handler }) =>\n\t\t\twebix.UIManager.removeHotKey(key, handler, view),\n\t};\n}\n","import { cutOccurrence } from \"helpers/recurring\";\nimport hotkey from \"jet-hotkey\";\n\n/**\n * Common function used to prepare data of a copied event\n * @param {Object} newEvent\n */\nexport function cleanEventData(newEvent) {\n\t// in recurring event, copy only this event and make sure it stays a part of the series\n\tconst isRecurring = newEvent.recurring || newEvent.$id || newEvent.origin_id;\n\tif (isRecurring) {\n\t\tnewEvent.recurring = \"\";\n\t\tdelete newEvent.$recurring;\n\t\tif (!newEvent.origin_id) newEvent.origin_id = newEvent.$id || newEvent.id;\n\n\t\tdelete newEvent.$id;\n\t}\n\n\tdelete newEvent.id;\n\n\tconst _ = this.app.getService(\"locale\")._;\n\tif (newEvent.text)\n\t\tnewEvent.text = `${_(\"Copy of\")} ${newEvent.text.replace(\n\t\t\t`${_(\"Copy of\")} `,\n\t\t\t\"\"\n\t\t)}`;\n}\n\n/** CopyPaste Mixin adds logic for copying and cutting events with hotkeys */\n\n/**\n * Handles events related to copying, cutting and pasting events (desktop devices)\n * @param {Object} view - a Webix data widget that is used to display events\n */\nfunction HandleCopyPaste(view) {\n\tthis.clipboardModes = [\"copy\", \"cut\"];\n\tthis.Ops = this.app.getService(\"operations\");\n\tconst ctrlKey = webix.env.isMac ? \"COMMAND\" : \"CTRL\";\n\t// when form is opened, hotkeys do not work because focus is on form, not on view\n\tthis.on(hotkey(view), `${ctrlKey}+C`, v => this.AddToClipboard(v, \"copy\"));\n\tthis.on(hotkey(view), `${ctrlKey}+X`, v => this.AddToClipboard(v, \"cut\"));\n\tthis.on(hotkey(view), `${ctrlKey}+V`, (v, e) => this.PasteFromClipboard(e));\n\tthis.on(hotkey(view), \"Esc\", (v, e) => this.PurgeClipboard(v, e));\n\n\tthis.on(this.State.$changes, \"mode\", () => {\n\t\twebix.UIManager.setFocus(view);\n\t});\n\n\tthis.on(this.State.$changes, \"clipboard\", (v, o) => {\n\t\tif (v) {\n\t\t\twebix.html.addCss(view.$view, \"webix_scheduler_clipboard_target\");\n\t\t} else if (o) {\n\t\t\twebix.html.removeCss(view.$view, \"webix_scheduler_clipboard_target\");\n\t\t}\n\t});\n\n\tthis.on(this.app, \"events:rendered\", () => {\n\t\tthis.RestoreClipboardSource(view);\n\t});\n\n\tif (this.$multi) {\n\t\tthis._globalClickHandler = webix.event(this.List.$view, \"click\", () => {\n\t\t\tif (this.State.clipboard && this.State.clipboard.source) {\n\t\t\t\tthis.ChangePasteTarget(this.List.$view);\n\t\t\t}\n\t\t});\n\t} else {\n\t\tthis.on(view, \"onItemClick\", (id, e, node) => {\n\t\t\tif (this.State.clipboard && this.State.clipboard.source) {\n\t\t\t\tif (this.State.mode === \"timeline\") {\n\t\t\t\t\tnode = this.CreatePasteTarget(view, e);\n\t\t\t\t}\n\t\t\t\tthis.ChangePasteTarget(node);\n\t\t\t}\n\t\t});\n\t}\n}\n\n/**\n * Cleans up click handler when the view is destroyed\n */\nfunction OnDestroy() {\n\tif (this._globalClickHandler) {\n\t\twebix.eventRemove(this._globalClickHandler);\n\t\tthis._globalClickHandler = null;\n\t}\n}\n\n/**\n * Creates an HTML element that represents a paste target for widgets that do not have suitable elements (timeline mode)\n * @param {Object} view - a Webix data widget that is used to display events\n * @param {MouseEvent} e\n * @returns {HTMLElement}\n */\nfunction CreatePasteTarget(view, e) {\n\tconst scroll = view.getScrollState();\n\tconst x = e.clientX - view.$view.offsetLeft + scroll.x;\n\tconst y = e.clientY - view.$view.offsetTop + scroll.y;\n\tthis.mousePosUnit = Math.floor(x / this.Scales.cellWidth);\n\n\tconst target = webix.html.create(\"div\");\n\tconst sheight = this.GetSectionHeight();\n\ttarget.style.top = `${y - (y % sheight)}px`;\n\ttarget.style.left = `${x - (x % this.Scales.cellWidth)}px`;\n\ttarget.style.width = `${this.Scales.cellWidth}px`;\n\ttarget.style.height = `${sheight}px`;\n\ttarget.style.position = \"absolute\";\n\n\t// view.$view.firstChild.prepend(target); // when IE dies, replace with this line\n\tconst parent = view.$view.firstChild;\n\tparent.insertBefore(target, parent.childNodes[0]);\n\n\treturn target;\n}\n\n/**\n * Sets styling for a paste target and sets it to state.clipboard\n * @param {HTMLElement} node\n */\nfunction SetPasteTargetStyle(node) {\n\twebix.html.addCss(node, \"webix_scheduler_paste_target\");\n\tthis.State.clipboard.target = node;\n}\n\n/**\n * Removes styling from a paste target, cleans up its reference from state and removes it from the DOM if it was created specifically (timeline mode)\n */\nfunction ClearPasteTargetStyle() {\n\tconst clipboard = this.State.clipboard;\n\tif (clipboard && clipboard.target) {\n\t\twebix.html.removeCss(\n\t\t\tthis.State.clipboard.target,\n\t\t\t\"webix_scheduler_paste_target\"\n\t\t);\n\t\tif (this.State.mode === \"timeline\" && clipboard.target.parentNode) {\n\t\t\t// this.State.clipboard.target.remove(); // when IE dies, replace with this line\n\t\t\tconst target = clipboard.target;\n\t\t\ttarget.parentNode.removeChild(target);\n\t\t}\n\t\tthis.State.clipboard.target = null;\n\t}\n}\n\n/**\n * Makes another element the target for pasting\n * @param {HTMLElement} node\n */\nfunction ChangePasteTarget(node) {\n\tif (this.State.clipboard.target !== node) {\n\t\tthis.ClearPasteTargetStyle();\n\t\tthis.SetPasteTargetStyle(node);\n\t}\n}\n\n/**\n * Locates event node by event ID (checks the given one and locates it anew if the parent was re-rendered)\n * @param {HTMLElement} view - parent html element (top html element of a widget)\n * @param {HTMLElement} node - given html element of the event\n * @param {string} id - the ID of the event\n * @returns {HTMLElement}\n */\nfunction locateEvent(view, node, id) {\n\tif (node && view.contains(node)) return node;\n\treturn (\n\t\tview.querySelectorAll(`[webix_e_id=\"${id}\"]`)[0] ||\n\t\tview.querySelectorAll(`[webix_l_id=\"${id}\"]`)[0]\n\t);\n}\n\n/**\n * Adds the selected event to clipboard, sets mode, styles the node of the copied/cut event\n * @param {string} mode - \"copy\" or \"cut\"\n */\nfunction AddToClipboard(view, mode) {\n\tconst sel = this.State.selected;\n\tif (sel && sel.id !== \"0\") {\n\t\tthis.ClearPasteTargetStyle();\n\n\t\tconst source = locateEvent(view.$view, sel.node, sel.date || sel.id);\n\t\tif (source) this.SetClipboardSourceStyle(mode, source);\n\n\t\tconst event = this.GetEvent(sel.date || sel.id);\n\t\tthis.State.clipboard = {\n\t\t\tmode,\n\t\t\tselected: webix.copy(event),\n\t\t\tsource,\n\t\t};\n\t}\n}\n\n/**\n * Adds relevant styling to the node of the copied or cut event\n * @param {string} mode - \"copy\" or \"cut\"\n * @param {HTMLElement} node\n */\nfunction SetClipboardSourceStyle(mode, node) {\n\tconst css = `webix_scheduler_${mode}`;\n\tif (node.className.indexOf(css) === -1) webix.html.addCss(node, css);\n\tconst opMode = this.clipboardModes[this.clipboardModes.indexOf(mode) ^ 1];\n\tconst prevCss = `webix_scheduler_${opMode}`;\n\twebix.html.removeCss(node, prevCss);\n\n\tconst clipboard = this.State.clipboard;\n\tif (clipboard && clipboard.source && node != clipboard.source) {\n\t\twebix.html.removeCss(this.State.clipboard.source, css);\n\t\twebix.html.removeCss(this.State.clipboard.source, prevCss);\n\t}\n}\n\n/**\n * Locates the copied or cut event and highlights it\n * @param {Object} view - the widget that displays events\n */\nfunction RestoreClipboardSource(view) {\n\tconst clip = this.State.clipboard;\n\tif (clip) {\n\t\tconst source = locateEvent(view.$view, clip.source, clip.selected.id);\n\t\tif (source) {\n\t\t\tif (source !== clip.source) {\n\t\t\t\tthis.State.clipboard.source = source;\n\t\t\t}\n\t\t\tthis.SetClipboardSourceStyle(clip.mode, source);\n\t\t}\n\t}\n}\n\n/**\n * Pastes the event from clipboard to the target\n * @param {KeyboardEvent} e\n */\nfunction PasteFromClipboard(e) {\n\tconst clipboard = this.State.clipboard;\n\tif (clipboard && clipboard.source) {\n\t\tconst newEvent = this.GetEventData(clipboard, e);\n\n\t\tif (clipboard.mode === \"copy\") {\n\t\t\tthis.CopyEvent(newEvent);\n\t\t} else if (clipboard.mode === \"cut\") {\n\t\t\tthis.MoveEvent(newEvent);\n\t\t}\n\n\t\tthis.PurgeClipboard();\n\t}\n}\n\n/**\n * Collects new event data for the pasted event based on the chosen target\n * @param {Object} clipboard - clipboard property from the global app state\n * @param {KeyboardEvent} e\n * @returns {Object}\n */\nfunction GetEventData(clipboard, e) {\n\tconst newEvent = clipboard.selected;\n\n\tconst evLength =\n\t\tMath.floor(newEvent.end_date - newEvent.start_date) / (60 * 1000); // minutes\n\tnewEvent.start_date = this.GetTargetDate(e.target.getAttribute(\"webix_l_id\"));\n\tnewEvent.end_date = webix.Date.add(\n\t\tnewEvent.start_date,\n\t\tevLength,\n\t\t\"minute\",\n\t\ttrue\n\t);\n\n\tif (this.State.mode === \"units\") {\n\t\tnewEvent.units = this.Unit.id;\n\t} else if (this.State.mode === \"timeline\") {\n\t\tconst sec = e.target.getAttribute(\"webix_l_id\");\n\t\tif (sec) newEvent.section = sec;\n\t}\n\n\treturn newEvent;\n}\n\n/**\n * Saves the copy of the event\n * @param {Object} newEvent\n */\nfunction CopyEvent(newEvent) {\n\tcleanEventData.call(this, newEvent);\n\tthis.Ops.addEvent(newEvent, true).then(id =>\n\t\tthis.UpdateSelection(id, newEvent)\n\t);\n}\n\n/**\n * Saves the event to a new target\n * @param {Object} newEvent\n */\nfunction MoveEvent(newEvent) {\n\t// cut operation is either update - for normal events\n\t// or edit as 'this' - for recurring events\n\tif (newEvent.recurring) {\n\t\tconst recurring = cutOccurrence(newEvent.id, newEvent);\n\t\tconst updateId = newEvent.$id;\n\t\tcleanEventData.call(this, newEvent);\n\n\t\t// [todo] create 1 Op for updating as this because calling 2 methods (update, add) for this wasn't the best idea\n\t\tthis.Ops.updateEvent(\n\t\t\tupdateId,\n\t\t\t{ recurring },\n\t\t\t\"this\",\n\t\t\tnewEvent.start_date,\n\t\t\ttrue\n\t\t).then(() =>\n\t\t\tthis.Ops.addEvent(newEvent, true).then(id =>\n\t\t\t\tthis.UpdateSelection(id, newEvent)\n\t\t\t)\n\t\t);\n\t} else {\n\t\tconst update = {\n\t\t\tstart_date: newEvent.start_date,\n\t\t\tend_date: newEvent.end_date,\n\t\t};\n\t\tif (newEvent.units) update.units = newEvent.units;\n\t\tif (newEvent.section) update.section = newEvent.section;\n\t\tthis.Ops.updateEvent(newEvent.id, update, null, null, true).then(() => {\n\t\t\tthis.UpdateSelection(newEvent.id, newEvent);\n\t\t});\n\t}\n}\n\nfunction PurgeClipboard() {\n\tconst clip = this.State.clipboard;\n\tif (clip) {\n\t\tconst { mode, source } = clip;\n\t\twebix.html.removeCss(source, `webix_scheduler_${mode}`);\n\n\t\tthis.ClearPasteTargetStyle();\n\t\tthis.State.clipboard = null;\n\n\t\treturn false;\n\t}\n}\n\n/**\n *\n * @param {Object} child - the object of a JetView instance\n * @param {Object} mainWidget - the main widget within a jet view\n * @param {Object} config - some config that is passed for this view (e.g. multi: true)\n */\nexport default function CopyPasteMixin(child, mainWidget, config) {\n\tchild.AddToClipboard = AddToClipboard;\n\tchild.SetClipboardSourceStyle = SetClipboardSourceStyle;\n\tchild.RestoreClipboardSource = RestoreClipboardSource;\n\tchild.PasteFromClipboard = PasteFromClipboard;\n\tchild.GetEventData = GetEventData;\n\tchild.CopyEvent = CopyEvent;\n\tchild.MoveEvent = MoveEvent;\n\tchild.ClearPasteTargetStyle = ClearPasteTargetStyle;\n\tchild.SetPasteTargetStyle = SetPasteTargetStyle;\n\tchild.ChangePasteTarget = ChangePasteTarget;\n\tchild.CreatePasteTarget = CreatePasteTarget;\n\tchild.PurgeClipboard = PurgeClipboard;\n\n\tif (config && config.multi) {\n\t\tchild.$multi = true;\n\t\tchild.destroy = OnDestroy;\n\t}\n\n\tHandleCopyPaste.call(child, mainWidget);\n}\n","/* eslint-disable indent */\n/* eslint-disable no-mixed-spaces-and-tabs */\nimport { JetView } from \"webix-jet\";\nimport { FREQUENCE, WEEKDAYS, separateSequence } from \"../../helpers/recurring\";\nimport { cleanEventData } from \"helpers/copypaste\";\n\nimport EventActionMenu from \"./actionmenu\";\n\nexport default class EventView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst bar = {\n\t\t\tview: \"toolbar\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: 14,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => this.Back(),\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\twidth: 130,\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tlocalId: \"edit\",\n\t\t\t\t\tlabel: _(\"Edit\"),\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tclick: function() {\n\t\t\t\t\t\tthis.$scope.StartAction(\"Edit\", this.$view);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tif (this.app.config.copypaste) {\n\t\t\tbar.elements.splice(-1, 0, {\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"shi-content-copy\",\n\t\t\t\ttooltip: _(\"Copy event\"),\n\t\t\t\tclick: () => this.CopyEvent(),\n\t\t\t});\n\t\t}\n\n\t\tconst info = {\n\t\t\tlocalId: \"text\",\n\t\t\tview: \"template\",\n\t\t\tcss: \"webix_scheduler_info\",\n\t\t\ttemplate: obj => (obj.start_date ? this.InfoTemplate(obj) : \"\"),\n\t\t\tborderless: true,\n\t\t};\n\n\t\tconst deleteButton = {\n\t\t\tview: \"button\",\n\t\t\tlocalId: \"remove\",\n\t\t\tlabel: _(\"Delete event\"),\n\t\t\tcss: \"webix_danger webix_scheduler_danger\",\n\t\t\talign: \"center\",\n\t\t\tinputWidth: 330,\n\t\t\tclick: function() {\n\t\t\t\tthis.$scope.StartAction(\"Delete\", this.$view);\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tview: \"proxy\", // for borders\n\t\t\tbody: {\n\t\t\t\tmargin: 0,\n\t\t\t\trows: [\n\t\t\t\t\tbar,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: \"form\",\n\t\t\t\t\t\tpadding: { right: 14 + 2 },\n\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\trows: [info, deleteButton],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.UnitsLocal = this.app.getService(\"local\").units(true);\n\n\t\tthis.on(this.State.$changes, \"readonly\", v => {\n\t\t\tconst action = v ? \"hide\" : \"show\";\n\t\t\tthis.$$(\"edit\")[action]();\n\t\t\tthis.$$(\"remove\")[action]();\n\t\t});\n\n\t\tconst template = this.$$(\"text\");\n\n\t\tthis.on(this.State.$changes, \"selected\", v => {\n\t\t\tif (v) {\n\t\t\t\tthis.EventObj = this.app\n\t\t\t\t\t.getService(\"local\")\n\t\t\t\t\t.events(true)\n\t\t\t\t\t.getItem(v.id);\n\t\t\t\ttemplate.setValues(this.EventObj);\n\t\t\t}\n\t\t});\n\n\t\tthis.Menu = this.ui(EventActionMenu);\n\n\t\tif (this.app.config.units) {\n\t\t\tconst waitUnits = this.app.getService(\"local\").units();\n\t\t\twaitUnits.then(() => {\n\t\t\t\ttemplate.refresh();\n\t\t\t});\n\t\t}\n\n\t\tif (this.app.config.timeline) {\n\t\t\tconst local = this.app.getService(\"local\");\n\t\t\tlocal.sections().then(data => {\n\t\t\t\tthis.Sections = data;\n\t\t\t\ttemplate.refresh();\n\t\t\t});\n\t\t}\n\t}\n\n\tStartAction(mode, node) {\n\t\tif (\n\t\t\tthis.app.config.recurring &&\n\t\t\t(typeof this.State.selected.date === \"string\" || this.EventObj.origin_id)\n\t\t) {\n\t\t\tthis.Menu.Show(node).then(o => {\n\t\t\t\tif (mode === \"Delete\") this.DeleteEvent(o);\n\t\t\t\telse this.EditEvent(o);\n\t\t\t});\n\t\t} else {\n\t\t\tif (mode === \"Delete\") this.DeleteEvent();\n\t\t\telse this.EditEvent();\n\t\t}\n\t}\n\n\tEditEvent(o) {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst path = compact ? \"event.formpopup/\" : \"../\";\n\t\tthis.show(path + \"event.form\", { target: \"edit\", params: { mode: o } });\n\t}\n\n\tDeleteEvent(mode) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\ttitle: _(\"Delete event\"),\n\t\t\t\ttext: _(\"The event will be deleted permanently, are you sure?\"),\n\t\t\t\tcontainer: this.app.getRoot().$view,\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tconst obj = this.EventObj;\n\t\t\t\tlet sdate = \"\";\n\t\t\t\tif (mode && mode !== \"all\") {\n\t\t\t\t\tif (this.State.selected) sdate = this.State.selected.date;\n\t\t\t\t\telse if (obj.$id) sdate = obj.id;\n\t\t\t\t}\n\t\t\t\tthis.app\n\t\t\t\t\t.getService(\"operations\")\n\t\t\t\t\t.removeEvent(this.EventObj, mode, sdate);\n\t\t\t\tthis.Back(true);\n\t\t\t});\n\t}\n\n\t/** Sets selected of the global reactive state to open form for copy creation */\n\tCopyEvent() {\n\t\tconst data = webix.copy(this.EventObj);\n\t\tcleanEventData.call(this, data);\n\t\tthis.State.$batch({\n\t\t\tselected: { id: \"0\" },\n\t\t\tclipboard: { mode: \"copy\", selected: data },\n\t\t});\n\t}\n\n\t/**\n\t * Closes the info panel\n\t * @param {Boolean} removal - indicates that the panel was closed after an event was removed\n\t */\n\tBack(removal) {\n\t\tif (removal) {\n\t\t\tconst clip = this.State.clipboard;\n\t\t\tif (\n\t\t\t\tclip &&\n\t\t\t\t(clip.selected.id === this.EventObj.id ||\n\t\t\t\t\tclip.selected.id.indexOf(\"_\" + this.EventObj.id) > -1)\n\t\t\t) {\n\t\t\t\tthis.State.clipboard = null;\n\t\t\t}\n\t\t}\n\n\t\tthis.State.selected = null;\n\t}\n\n\tInfoTemplate(obj) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (this.app.config.recurring && this.State.selected.date) {\n\t\t\tobj = { ...obj, ...separateSequence(obj, this.State.selected.date) };\n\t\t}\n\t\tconst [start, end] = [obj.start_date, obj.end_date];\n\n\t\tconst oneday = webix.Date.equal(\n\t\t\twebix.Date.datePart(start, true),\n\t\t\twebix.Date.datePart(end, true)\n\t\t);\n\n\t\tconst allday =\n\t\t\twebix.Date.equal(webix.Date.datePart(start, true), start) &&\n\t\t\twebix.Date.equal(webix.Date.datePart(end, true), end) &&\n\t\t\tobj.all_day;\n\n\t\tconst time = webix.i18n.timeFormatStr;\n\t\tconst date = webix.i18n.longDateFormatStr;\n\n\t\tconst title = `<div class=\"webix_scheduler_event_title\">${obj.text ||\n\t\t\t_(\"(No title)\")}</div>`;\n\n\t\tconst startDate = date(start);\n\t\tconst endDate = date(end);\n\t\tconst startTime = time(start);\n\t\tconst endTime = time(end);\n\n\t\tlet fromTo = \"\";\n\t\tif (oneday) {\n\t\t\tfromTo = `<div class=\"webix_scheduler_event_text\">${startDate}</div>`;\n\t\t\tif (!allday)\n\t\t\t\tfromTo += `<div class=\"webix_scheduler_event_text\">${_(\n\t\t\t\t\t\"from\"\n\t\t\t\t)} ${startTime} ${_(\"to\")} ${endTime}</div>`;\n\t\t} else {\n\t\t\tfromTo = `<div class=\"webix_scheduler_event_text\">${_(\"from\")} ${\n\t\t\t\t!allday ? startTime : \"\"\n\t\t\t} ${startDate}</div><div class=\"webix_scheduler_event_text\">${_(\"to\")} ${\n\t\t\t\t!allday ? endTime : \"\"\n\t\t\t} ${endDate}</div>`;\n\t\t}\n\n\t\tconst recurring =\n\t\t\tthis.app.config.recurring && obj.recurring\n\t\t\t\t? this.GetRecurringText(obj, _)\n\t\t\t\t: \"\";\n\n\t\tlet units = \"\";\n\t\tif (this.app.config.units) {\n\t\t\tunits += `<div class=\"webix_scheduler_event_units_title\">${_(\n\t\t\t\t\"Assigned to units\"\n\t\t\t)}:</div><div class=\"webix_scheduler_event_units\">`;\n\t\t\tif (obj.units) {\n\t\t\t\tconst unitIDs = obj.units.split(\",\");\n\t\t\t\tunitIDs.forEach((id, index) => {\n\t\t\t\t\tconst isLast = index === unitIDs.length - 1;\n\t\t\t\t\tconst unitObj = this.UnitsLocal.getItem(id);\n\t\t\t\t\tconst unitValue =\n\t\t\t\t\t\tunitObj && unitObj.value ? unitObj.value : _(\"Unknown unit\");\n\t\t\t\t\tunits += `<div class=\"webix_scheduler_event_unit_item\">${unitValue}${\n\t\t\t\t\t\tisLast ? \"\" : \",\"\n\t\t\t\t\t}</div>`;\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tunits += _(\"No units\");\n\t\t\t}\n\t\t\tunits += \"</div>\";\n\t\t}\n\n\t\tconst section =\n\t\t\tthis.app.config.timeline && this.Sections ? this.GetSection(obj, _) : \"\";\n\n\t\tlet details = \"\";\n\t\tif (obj.details)\n\t\t\tdetails = `<div class=\"webix_scheduler_event_details_title\">${_(\n\t\t\t\t\"Notes\"\n\t\t\t)}</div>\n\t\t\t\t<div class=\"webix_scheduler_event_text\">${obj.details.replace(\n\t\t\t\t\t/(?:\\r\\n|\\r|\\n)/g,\n\t\t\t\t\t\"<br>\"\n\t\t\t\t)}</div>`;\n\n\t\treturn `${title}\n\t\t\t<div class='webix_scheduler_event_from_to'>${fromTo}</div>\n\t\t\t<div class='webix_scheduler_event_recurring_pattern'>${recurring}</div>${units}${section}${details}`;\n\t}\n\n\tGetRecurringText(obj, _) {\n\t\tconst mode = obj.$recurring;\n\t\tconst interval = mode.INTERVAL && mode.INTERVAL > 1 ? mode.INTERVAL : \"\";\n\n\t\tlet pattern = \"\";\n\t\tif (mode.BYDAY) {\n\t\t\tpattern = ` ${_(\"on\")} ${mode.BYSETPOS || \"\"} ${mode.BYDAY.split(\",\")\n\t\t\t\t.map(d => webix.i18n.calendar.dayFull[WEEKDAYS.indexOf(d)])\n\t\t\t\t.join(\", \")} ${\n\t\t\t\tmode.BYMONTH\n\t\t\t\t\t? `${_(\"of\")} ${webix.i18n.calendar.monthFull[mode.BYMONTH - 1]}`\n\t\t\t\t\t: \"\"\n\t\t\t}`;\n\t\t} else if (mode.BYMONTHDAY) {\n\t\t\tpattern =\n\t\t\t\t(mode.BYMONTHDAY ? ` ${_(\"on\")} ` : \"\") +\n\t\t\t\t(mode.BYMONTH\n\t\t\t\t\t? `${mode.BYSETPOS ? _(\"of\") : \"\"} ${\n\t\t\t\t\t\t\twebix.i18n.calendar.monthFull[mode.BYMONTH - 1]\n\t\t\t\t\t  }`\n\t\t\t\t\t: \"\") +\n\t\t\t\t(mode.BYMONTHDAY ? ` ${mode.BYMONTHDAY}` : \"\");\n\t\t} else if (mode.BYYEARDAY) {\n\t\t\tpattern = `${_(\"day\")} ${mode.BYYEARDAY}`;\n\t\t}\n\n\t\treturn `${_(\"Repeats each\")} ${interval} ${_(\n\t\t\tFREQUENCE[mode.FREQ] + (interval ? \"s\" : \"\")\n\t\t)} ${pattern}${\n\t\t\tmode.COUNT\n\t\t\t\t? `, ${mode.COUNT} ${_(\"times\")}`\n\t\t\t\t: mode.UNTIL\n\t\t\t\t? ` ${_(\"till\")} ${webix.i18n.longDateFormatStr(mode.UNTIL)}`\n\t\t\t\t: \"\"\n\t\t}`;\n\t}\n\n\t/**\n\t * Returns a string with HTML for the info with the section\n\t * @param {Object} obj - data of an event\n\t * @param {function} _ - the translator function of the Locale plugin\n\t * @returns {string} a string with HTML for the info with the section\n\t */\n\tGetSection(obj, _) {\n\t\tconst section = this.Sections.getItem(obj.section);\n\t\tif (section)\n\t\t\treturn `<div class=\"webix_scheduler_section_tpl\"><span class=\"webix_scheduler_section_title\">${_(\n\t\t\t\t\"Section\"\n\t\t\t)}:</span> ${section.text}</div>`;\n\t\treturn \"\";\n\t}\n}\n","let BRIGHTNESS;\nlet FONT;\nwebix.ready(() => {\n\tconst dark = webix.skin.$name === \"contrast\" || webix.skin.$name === \"dark\";\n\tBRIGHTNESS = dark ? 0.35 : 0.75;\n\tFONT = dark ? \"#9f9d9d\" : \"#ffffff\";\n});\n\n/**\n * Gets contrasting text color for the event background color\n * @param {string} color - background color\n * @returns {string} text color\n */\nexport function getContrastingColor(color) {\n\tconst rgb = webix.color.toRgb(color);\n\tconst brightness = Math.round(\n\t\t(rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000\n\t);\n\treturn brightness > 180 ? \"#475466\" : \"#ffffff\";\n}\n\nexport function getDimmedColor(color) {\n\tlet [hue, saturation] = hexToHsv(color);\n\thue *= 0.95;\n\tsaturation *= 0.4;\n\treturn `rgb(${webix.color.hsvToRgb(hue, saturation, BRIGHTNESS)})`;\n}\n\nexport function getDimmedFont() {\n\treturn FONT;\n}\n\nfunction hexToHsv(hex) {\n\tconst [red, green, blue] = webix.color.toRgb(hex);\n\treturn webix.color.rgbToHsv(red, green, blue);\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class EventActionPopup extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst buttons = {\n\t\t\tmargin: webix.skin.$active.layoutMargin.form,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tvalue: _(\"Cancel\"),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => this.Cancel(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tvalue: _(\"Apply\"),\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\thotkey: \"enter\",\n\t\t\t\t\tclick: () => this.Done(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn this.app.getService(\"jet-win\").updateConfig({\n\t\t\tview: \"window\",\n\t\t\thead: _(\"Edit recurring event\"),\n\t\t\tautoheight: true,\n\t\t\tcss: \"webix_scheduler_action_popup\",\n\t\t\tbody: {\n\t\t\t\ttype: \"form\",\n\t\t\t\tpadding: { top: 0 },\n\t\t\t\twidth: 340,\n\t\t\t\trows: [\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"radio\",\n\t\t\t\t\t\tlocalId: \"option\",\n\t\t\t\t\t\tvertical: true,\n\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t{ id: \"this\", value: _(\"This event\") },\n\t\t\t\t\t\t\t{ id: \"next\", value: _(\"This event and the following\") },\n\t\t\t\t\t\t\t{ id: \"all\", value: _(\"All events\") },\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tbuttons,\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => (this.Result = null),\n\t\t\t},\n\t\t});\n\t}\n\n\tinit(view) {\n\t\tthis.Root = view;\n\t}\n\n\tShow(promise) {\n\t\tthis.Result = promise;\n\t\tthis.$$(\"option\").setValue(\"this\");\n\t\tthis.Root.show();\n\t}\n\n\tDone() {\n\t\tconst id = this.$$(\"option\").getValue();\n\t\tif (this.Result) this.Result.resolve(id);\n\t\tthis.Root.hide();\n\t}\n\n\tCancel() {\n\t\tif (this.Result) this.Result.reject();\n\t\tthis.Root.hide();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport topbar from \"views/bars\";\nimport add from \"views/bars/add\";\nimport side from \"./side\";\n\nimport EventActionPopup from \"./modes/common/actionpopup\";\n\nimport { initRLayout, waitVisible } from \"@xbs/jet-helpers\";\n\nexport default class MainView extends JetView {\n\tconfig() {\n\t\tinitRLayout();\n\t\tconst fCompact = this.getParam(\"forceCompact\");\n\t\tif (!webix.isUndefined(fCompact)) this.setParam(\"compact\", fCompact);\n\t\tthis.Compact = this.getParam(\"compact\");\n\t\tthis.Calendars = !this.Compact && this.app.config.calendars;\n\n\t\tconst rows = [\n\t\t\ttopbar,\n\t\t\t{\n\t\t\t\tview: \"r-layout\",\n\t\t\t\tlocalId: \"main\",\n\t\t\t\tcols: [{ $subview: true }],\n\t\t\t},\n\t\t];\n\n\t\tif (this.Compact) {\n\t\t\trows.push({\n\t\t\t\t$subview: true,\n\t\t\t\tname: \"edit\",\n\t\t\t\tpopup: true,\n\t\t\t});\n\t\t} else {\n\t\t\trows[1].cols.push({\n\t\t\t\tview: \"proxy\",\n\t\t\t\twidth: 400,\n\t\t\t\tlocalId: \"edit\",\n\t\t\t\tcss: \"webix_shadow_medium\",\n\t\t\t\tborderless: true,\n\t\t\t\thidden: true,\n\t\t\t\tbody: { $subview: true, name: \"edit\" },\n\t\t\t});\n\t\t}\n\n\t\tif (this.Calendars)\n\t\t\trows[1].cols.unshift({\n\t\t\t\tview: \"proxy\",\n\t\t\t\tlocalId: \"side\",\n\t\t\t\tborderless: true,\n\t\t\t\tbody: side,\n\t\t\t\thidden: true,\n\t\t\t});\n\n\t\tconst config = {\n\t\t\tcss: \"webix_scheduler\",\n\t\t\tview: \"abslayout\",\n\t\t\tcells: [\n\t\t\t\t{\n\t\t\t\t\trelative: true,\n\t\t\t\t\tmargin: 0,\n\t\t\t\t\trows: rows,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tcss: \"webix_scheduler_absbutton\",\n\t\t\t\t\tbody: add,\n\t\t\t\t\tlocalId: \"add\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tright: 20,\n\t\t\t\t\tbottom: 20,\n\t\t\t\t\thidden: !this.Compact,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn config;\n\t}\n\n\tinit(view) {\n\t\tthis.$$(\"main\").sizeTrigger(\n\t\t\tthis.app,\n\t\t\tmode => this.SetCompactMode(mode),\n\t\t\t!!this.Compact\n\t\t);\n\n\t\twebix.extend(view, webix.ProgressBar);\n\t\tthis.on(this.app, \"backend:operation\", res => {\n\t\t\tview.showProgress({ type: \"top\", delay: 2000 });\n\t\t\tres.finally(() => {\n\t\t\t\tview.hideProgress();\n\t\t\t});\n\t\t});\n\n\t\tif (this.Calendars) this.$$(\"side\").show();\n\n\t\tconst state = this.app.getState();\n\t\tthis.on(state.$changes, \"mode\", value => {\n\t\t\tthis.show(`./modes.${value}`);\n\t\t});\n\t\tthis.on(state.$changes, \"readonly\", value => {\n\t\t\tthis.ToggleAdd(value);\n\t\t});\n\n\t\tthis.on(state.$changes, \"selected\", (v, o) => this.ToggleEvent(v, o));\n\t\tthis.on(this.app, \"show:panel\", () => this.ToggleSidePanel());\n\n\t\twaitVisible(this.getRoot()).then(\n\t\t\t() => (this.app._dndActionPopup = this.ui(EventActionPopup))\n\t\t);\n\t}\n\n\tToggleEvent(ev, old) {\n\t\tif (ev) {\n\t\t\tthis.ShowEvent(ev, old);\n\t\t} else if (old) {\n\t\t\tthis.HideEvent();\n\t\t}\n\t}\n\n\tShowEvent(ev, old) {\n\t\tconst sameEvent = old && old.id == ev.id;\n\t\tconst edit = this.getSubView(\"edit\");\n\t\tconst path =\n\t\t\tedit && sameEvent\n\t\t\t\t? edit.getUrl()[0].page\n\t\t\t\t: `event.${ev.id === \"0\" ? \"form\" : \"info\"}`;\n\n\t\tif (this.Compact) {\n\t\t\tthis.show(`event.formpopup/${path}`, {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t} else {\n\t\t\tthis.ToggleSidePanel(\"hide\");\n\t\t\tthis.$$(\"edit\").show();\n\t\t\tthis.show(path, {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t}\n\t}\n\n\tHideEvent() {\n\t\t// we need to destroy the view inside first\n\t\tthis.show(\"_blank\", { target: \"edit\" });\n\n\t\tif (!this.Compact) {\n\t\t\tthis.$$(\"edit\").hide();\n\t\t\tthis.ToggleSidePanel(\"show\");\n\t\t}\n\t}\n\n\tSetCompactMode(mode) {\n\t\t//let it render, then recreate\n\t\twebix.delay(() => {\n\t\t\tthis.setParam(\"compact\", mode);\n\t\t\tif (!mode) webix.fullscreen.exit();\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\tToggleSidePanel(state) {\n\t\tconst side = this.$$(\"side\");\n\t\tif (side) {\n\t\t\tif (state !== \"show\" && side.isVisible()) {\n\t\t\t\tthis._sidePanel = state === \"hide\";\n\t\t\t\tside.hide();\n\t\t\t} else if (!state || (this._sidePanel && state !== \"hide\")) {\n\t\t\t\tside.show();\n\t\t\t\tthis._sidePanel = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tToggleAdd(value) {\n\t\tconst add = this.$$(\"add\");\n\t\tif (value) add.hide();\n\t\telse if (this.Compact) add.show();\n\t}\n}\n","import { getDimmedColor, getDimmedFont } from \"./colors\";\n\nexport function marker(obj) {\n\tconst color = obj.color || obj.$color;\n\treturn `<div class=\"webix_event_marker\"><div class=\"webix_event_marker_inner\" style=\"background-color:${\n\t\tobj.$past ? getDimmedColor(color) : color\n\t};\"></div></div>`;\n}\n\nexport function events(_) {\n\treturn function(obj, common) {\n\t\treturn `<div class=\"webix_event_overall ${\n\t\t\tobj.$past ? \"webix_scheduler_past_event\" : \"\"\n\t\t}\"><div class=\"webix_event_time\">${common.timeStart(obj)}</div>${marker(\n\t\t\tobj,\n\t\t\tcommon\n\t\t)}<div class=\"webix_event_text\">${obj.text || _(\"(No title)\")}</div></div>`;\n\t};\n}\n\nexport function dayEventColor(obj) {\n\tconst color = obj.color || obj.$color;\n\treturn `border-color:${\n\t\tobj.$past ? getDimmedColor(obj.$color) : obj.$color\n\t}; background-color:${obj.$past ? getDimmedColor(color) : color}; color:${\n\t\tobj.$past ? getDimmedFont() : obj.$textColor\n\t};`;\n}\n\nexport function timeStart(start, end) {\n\treturn `<div class=\"start\">${webix.i18n.timeFormatStr(\n\t\tstart\n\t)}</div><div class=\"end\">${webix.i18n.timeFormatStr(end)}</div>`;\n}\n\nfunction fill(obj, common, size) {\n\tconst v = common.master;\n\treturn (\n\t\tv[\"$\" + size] -\n\t\t(v.config[size == \"width\" ? \"xCount\" : \"yCount\"] - 1) * common[size]\n\t);\n}\n\nexport function templateStart(obj, common, marks) {\n\tlet { width, height } = common;\n\tif (obj.right) width = fill(obj, common, \"width\");\n\tif (obj.bottom) height = fill(obj, common, \"height\");\n\treturn (\n\t\t\"<div \" +\n\t\t/*@attr*/ \"webix_l_id\" +\n\t\t`=\"${obj.id}\" class=\"${common.classname(obj, common, marks)}\" ${common.aria(\n\t\t\tobj,\n\t\t\tcommon,\n\t\t\tmarks\n\t\t)} style=\"width:${width}px; height:${height}px; float:left; overflow:hidden;\">`\n\t);\n}\n","import { JetView } from \"webix-jet\";\nimport { events, timeStart } from \"helpers/templates\";\nimport { isMultiDay } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class UnitListView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"unitlist\",\n\t\t\tlocalId: \"list\",\n\t\t\tuniteBy: () => \"custom\",\n\t\t\ttype: {\n\t\t\t\ttemplate: events(_),\n\t\t\t\ttemplateHeader: obj => this.TemplateHeader(obj),\n\t\t\t\ttimeStart: obj => this.TimeStart(obj),\n\t\t\t\theight: 50,\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonUnits: () => this.SetUnits(),\n\t\t\t\tonItemClick: (id, node) => this.ShowEvent(id, node),\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.List = this.$$(\"list\");\n\t\twebix.extend(this.List, webix.OverlayBox);\n\t}\n\n\tShowEvent(id, node) {\n\t\tconst obj = this.List.getItem(id);\n\t\tconst sel = getParams(obj);\n\t\tsel.node = node;\n\t\tthis.State.selected = sel;\n\t}\n\n\tToggleOverlay() {\n\t\tif (!this.List.count()) {\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.List.showOverlay(_(\"No Events\"));\n\t\t} else {\n\t\t\tthis.List.hideOverlay();\n\t\t}\n\t}\n\n\tSetUnits() {\n\t\tlet units = this.List.units;\n\t\tconst data = this.data.all;\n\n\t\t// ignore clearAll\n\t\tif (Object.keys(units).length) {\n\t\t\tthis.List.units = {};\n\t\t\tlet start = this.data.start;\n\t\t\tconst end = this.data.end;\n\n\t\t\twhile (start < end) {\n\t\t\t\tconst next = webix.Date.add(start, 1, \"day\", true);\n\n\t\t\t\tlet result = data\n\t\t\t\t\t.filter(\n\t\t\t\t\t\td =>\n\t\t\t\t\t\t\td.start_date < next &&\n\t\t\t\t\t\t\t(d.end_date > start || (d.end_date >= start && d.all_day))\n\t\t\t\t\t)\n\t\t\t\t\t.map(ev => ev.id);\n\t\t\t\tif (result.length) {\n\t\t\t\t\tthis.List.units[start.valueOf()] = result;\n\t\t\t\t}\n\n\t\t\t\tstart = webix.Date.add(start, 1, \"day\", true);\n\t\t\t}\n\t\t}\n\t}\n\n\tTimeStart(ev) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (isMultiDay(ev)) return _(\"All Day\");\n\t\telse return timeStart(ev.start_date, ev.end_date);\n\t}\n}\n","import UnitListView from \"../common/unitlist\";\nimport { shrinkTo, isToday } from \"helpers/dates\";\n\nexport default class AgendaView extends UnitListView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst ui = super.config();\n\t\tui.css = \"webix_scheduler_agenda\";\n\n\t\twebix.extend(\n\t\t\tui.type,\n\t\t\t{\n\t\t\t\theight: \"auto\",\n\t\t\t\theaderHeight: 50,\n\t\t\t\tclassname: obj => this.TemplateCss(obj),\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\twebix.extend(\n\t\t\tui.on,\n\t\t\t{\n\t\t\t\tonItemRender: obj => {\n\t\t\t\t\tif (obj.$unit) this.CurrentUnit = obj.$unit;\n\t\t\t\t},\n\t\t\t\tonItemClick: (id, e, node) => {\n\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t\tthis.ShowEvent(id, node);\n\t\t\t\t\tif (!compact) this.SelectEvent(node);\n\t\t\t\t},\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tsuper.init();\n\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tconst events = this.Data.events(true);\n\n\t\tthis.on(this.State.$changes, \"date\", () => this.RefreshData());\n\t\tthis.on(this.State.$changes, \"active\", () => this.RefreshData());\n\t\tthis.on(this.State.$changes, \"selected\", v => {\n\t\t\tif (!v) this.SelectEvent(); //remove selection\n\t\t});\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData());\n\n\t\t// updates made in full mode by form\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData()\n\t\t);\n\t}\n\n\tRefreshData() {\n\t\tlet start = webix.Date.monthStart(this.State.date);\n\t\tlet end = webix.Date.add(start, 1, \"month\", true);\n\n\t\tthis.Data.getEvents(start, end).then(data => {\n\t\t\tthis.data = { all: data, start: start, end: end };\n\t\t\tif (this.app) {\n\t\t\t\tthis.List.clearAll();\n\t\t\t\tthis.List.parse(data.map(shrinkTo(start, end)));\n\t\t\t\tthis.ToggleOverlay();\n\t\t\t}\n\t\t});\n\t}\n\n\tSelectEvent(node) {\n\t\tif (node == this._selected) return;\n\n\t\tconst name = \"webix_agenda_selected\";\n\t\tif (this._selected) webix.html.removeCss(this._selected, name);\n\t\tif (node) webix.html.addCss(node, name);\n\n\t\tthis._selected = node;\n\t}\n\n\tTemplateHeader(datestring) {\n\t\tconst date = new Date(datestring * 1);\n\t\tconst today = isToday(date);\n\n\t\tconst fstring = `%F <span class='webix_scheduler_monthday${\n\t\t\ttoday ? \" webix_scheduler_today\" : \"\"\n\t\t}'>%j</span><br><span class='webix_scheduler_dayofweek'>%l</span>`;\n\n\t\treturn webix.Date.dateToStr(fstring)(date);\n\t}\n\n\tTemplateCss(obj) {\n\t\tconst ids = this.List.getUnitList(this.CurrentUnit);\n\n\t\tlet css = \"webix_list_item\";\n\t\tif (obj.id == ids[ids.length - 1]) css += \" webix_event_last\";\n\t\tif (obj.id == ids[0]) css += \" webix_event_first\";\n\n\t\treturn css;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class HourscaleView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tborderless: true,\n\t\t\tlocalId: \"scale\",\n\t\t\tcss: \"webix_scheduler_scale\",\n\t\t\ttype: {\n\t\t\t\theight: 42,\n\t\t\t\theightSize: (obj, common) => {\n\t\t\t\t\tconst ind = this.List.getIndexById(obj.id);\n\t\t\t\t\treturn common.height - (ind === 0 ? 17 : 0) + \"px\";\n\t\t\t\t},\n\t\t\t},\n\t\t\tscroll: false,\n\t\t\tautoheight: true,\n\t\t\twidth: 51,\n\t\t\ttemplate: obj => this.HourScaleItem(obj),\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.List = this.$$(\"scale\");\n\t\tthis.ParseHours();\n\t}\n\n\tParseHours() {\n\t\tconst data = [];\n\t\tfor (let h = 0; h < 24; h++) {\n\t\t\tdata.push({ id: h + \"\" });\n\t\t}\n\t\tthis.List.parse(data);\n\t}\n\n\tHourScaleItem(obj) {\n\t\tif (this.List.getIndexById(obj.id) === 0) return \"\";\n\t\telse return `${(obj.id < 10 ? \"0\" : \"\") + obj.id}:00`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class MultiMoreView extends JetView {\n\tconfig() {\n\t\tconst more = {\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"more\",\n\t\t\twidth: 50,\n\t\t\tcss: \"webix_scheduler_multi_space\",\n\t\t\ttooltip: () => \"\",\n\t\t\tonClick: {\n\t\t\t\t\"wxi-angle-down\": () => this.ExpandData(),\n\t\t\t\t\"wxi-angle-up\": () => this.WrapData(),\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tcols: [more, {}],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.List = this.$$(\"multiDayList\");\n\t\tthis.MoreIcon = this.$$(\"more\");\n\n\t\tthis._expandState = \"down\";\n\t\tthis.maxVisibleLines = 3;\n\t}\n\n\t/**\n\t *\n\t * @param {*} mode\n\t */\n\tSetMoreIcon(mode) {\n\t\tif (!mode) {\n\t\t\tthis.MoreIcon.setHTML(\"\");\n\t\t} else {\n\t\t\tconst tooltip = mode === \"up\" ? \"Collapse\" : \"Expand\";\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.MoreIcon.setHTML(\n\t\t\t\t`<div class=\"webix_scheduler_more_icon webix_icon wxi-angle-${mode}\" webix_tooltip=\"${_(\n\t\t\t\t\t`${tooltip} all-day events`\n\t\t\t\t)}\"><div>`\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Sets new height and delay for animation\n\t * @param {string} mode - \"up\" or \"down\"\n\t * @param {number} height\n\t * @param {function} handler\n\t */\n\tAnimate(mode, height, handler) {\n\t\tconst delay = 150;\n\t\tthis.List.$view.style.transition = `height ${delay}ms`;\n\t\tif (height) this.List.$view.style.height = `${height}px`;\n\n\t\tsetTimeout(() => {\n\t\t\tif (handler) handler();\n\n\t\t\tthis.List.$view.style.transition = \"\";\n\t\t\tthis._inAnimation = false;\n\t\t\tthis.SetMoreIcon(mode);\n\t\t}, delay);\n\t}\n}\n","function _select(id, functor) {\n\tconst trgs = this.LocateSelected(id);\n\tif (trgs) {\n\t\tfor (let i = 0; i < trgs.length; i++)\n\t\t\tfunctor(trgs[i], \"webix_scheduler_event_selected\");\n\t}\n}\n\nfunction Select(id) {\n\treturn _select.call(this, id, webix.html.addCss);\n}\n\nfunction Unselect(id) {\n\treturn _select.call(this, id, webix.html.removeCss);\n}\n\nfunction HandleSelection() {\n\tconst mode = this._SelectionMode;\n\tthis.State = this.app.getState();\n\n\tthis.on(this.State.$changes, \"selected\", (v, o) => {\n\t\tif (o) this.Unselect(o.date && typeof o.date === \"string\" ? o.date : o.id);\n\n\t\tif (v) {\n\t\t\tconst id = v.id === \"0\" || !v.date ? v.id : v.date;\n\t\t\tsetTimeout(\n\t\t\t\t() => this.Select(id),\n\t\t\t\tmode !== \"multi\" && id === \"0\" ? 150 : 0\n\t\t\t);\n\t\t}\n\t});\n\n\t// reapply selection to a saved new event\n\tif (mode !== \"multi\") {\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(events.data, \"onStoreUpdated\", (id, o, operation) => {\n\t\t\tif (\n\t\t\t\toperation === \"add\" &&\n\t\t\t\tid != \"0\" &&\n\t\t\t\tthis.State.selected &&\n\t\t\t\tthis.State.selected.id === \"0\"\n\t\t\t) {\n\t\t\t\tthis.State.selected.id = id;\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction locate(inner) {\n\treturn function LocateSelected(id) {\n\t\tif (this._DataObj) {\n\t\t\treturn Array.prototype.map.call(\n\t\t\t\tthis._DataObj.querySelectorAll(\n\t\t\t\t\t`[webix_${inner ? \"l\" : \"e\"}_id=\"${id}\"]`\n\t\t\t\t),\n\t\t\t\tel => (inner ? el.firstElementChild : el)\n\t\t\t);\n\t\t}\n\t\treturn null;\n\t};\n}\n\nexport default function SelectionMixin(child, mode, inner) {\n\tchild._SelectionMode = mode;\n\n\tchild.Select = Select;\n\tchild.Unselect = Unselect;\n\tchild.HandleSelection = HandleSelection;\n\tchild.LocateSelected = locate(inner);\n\n\tchild.HandleSelection();\n}\n","export const Resizer = {\n\t$dragIn: function() {\n\t\tconst ctx = this.getContext();\n\n\t\tif (ctx.from.mode !== this.mode) return false;\n\t\treturn true;\n\t},\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\n\t\tconst box = webix.html.offset(ctx.target);\n\t\tlet y = pos.y - box.y;\n\n\t\tif (y < ctx.y_diff) y = ctx.y_diff;\n\t\telse if (y > box.height) y = box.height;\n\n\t\tconst height = y - ctx.y_diff;\n\t\tResizer.updateNodeHeight.call(this, height);\n\n\t\tif (ctx.duration !== height) {\n\t\t\tctx.duration = height;\n\t\t\tthis.updateText(ctx);\n\t\t}\n\n\t\tpos.x = ctx.x_diff;\n\t\tpos.y = ctx.y_diff;\n\t},\n\tupdateNodeHeight: function(height) {\n\t\tconst node = webix.DragControl.getNode();\n\t\tnode.style.height = Math.max(this.master.minEventHeight, height) + \"px\";\n\t},\n\tgetActualDate: function(master, any) {\n\t\tconst ctx = this.getContext();\n\n\t\tconst date = webix.Date.copy(ctx.event.start_date);\n\t\tconst minutes =\n\t\t\t(Math.round((ctx.duration * 60) / master.List.type.height / 5) || 1) * 5;\n\n\t\twebix.Date.add(date, minutes, \"minute\");\n\n\t\tif (!any && webix.Date.equal(date, ctx.event.end_date)) return null;\n\n\t\treturn {\n\t\t\tstart_date: webix.Date.copy(ctx.event.start_date),\n\t\t\tend_date: date,\n\t\t};\n\t},\n};\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nconst d = webix.Date;\r\nfunction addMinutes(date, inc) {\r\n\treturn d.add(date, inc * 1, \"minute\", true);\r\n}\r\n\r\nfunction addHours(date, inc) {\r\n\treturn d.add(date, inc * 1, \"hour\", true);\r\n}\r\n\r\nfunction addDays(date, inc) {\r\n\treturn d.add(date, inc * 1, \"day\", true);\r\n}\r\n\r\nfunction addWeeks(date, inc) {\r\n\treturn d.add(date, inc * 1, \"week\", true);\r\n}\r\n\r\nfunction addMonths(date, inc) {\r\n\treturn d.add(date, inc * 1, \"month\", true);\r\n}\r\n\r\nfunction addQuarters(date, inc) {\r\n\treturn d.add(date, inc * 3, \"month\", true);\r\n}\r\n\r\nfunction addYears(date, inc) {\r\n\treturn d.add(date, inc * 1, \"year\", true);\r\n}\r\n\r\nfunction differenceInYears(a, b) {\r\n\treturn a.getFullYear() - b.getFullYear();\r\n}\r\n\r\nfunction differenceInMonths(a, b) {\r\n\treturn (\r\n\t\t(a.getFullYear() - b.getFullYear()) * 12 + (a.getMonth() - b.getMonth())\r\n\t);\r\n}\r\n\r\nconst day_length = 86400000;\r\nfunction differenceInCalendarDays(a, b) {\r\n\ta = new Date(a);\r\n\ta.setHours(0, 0, 0, 0);\r\n\tb = new Date(b);\r\n\tb.setHours(0, 0, 0, 0);\r\n\r\n\treturn Math.round((a.getTime() - b.getTime()) / day_length);\r\n}\r\n\r\nfunction differenceInQuarters(a, b) {\r\n\treturn (\r\n\t\t(a.getFullYear() - b.getFullYear()) * 4 +\r\n\t\t(Math.floor(a.getMonth() / 3) + 1) -\r\n\t\t(Math.floor(b.getMonth() / 3) + 1)\r\n\t);\r\n}\r\n\r\nfunction differenceInWeeks(a, b) {\r\n\tconst diff = differenceInCalendarDays(a, b) / 7;\r\n\tconst end = getDay(a);\r\n\tconst start = getDay(b);\r\n\r\n\treturn Math.ceil(Math.abs(diff) - (end <= start ? 0 : 1)) * Math.sign(diff);\r\n}\r\n\r\nfunction differenceInHours(a, b) {\r\n\treturn differenceInCalendarDays(a, b) * 24 + (a.getHours() - b.getHours());\r\n}\r\n\r\nfunction differenceInMinutes(a, b) {\r\n\treturn differenceInHours(a, b) * 60 + (a.getMinutes() - b.getMinutes());\r\n}\r\n\r\nconst f_cache = {};\r\nfunction format(date, format) {\r\n\treturn formatFunction(format)(date);\r\n}\r\nfunction formatFunction(format) {\r\n\tlet cb = f_cache[format];\r\n\tif (!cb) {\r\n\t\tcb = f_cache[format] = d.dateToStr(format);\r\n\t}\r\n\r\n\treturn cb;\r\n}\r\n\r\nfunction getDay(date) {\r\n\tlet shift = date.getDay();\r\n\tif (d.startOnMonday) {\r\n\t\tif (shift === 0) shift = 6;\r\n\t\telse shift--;\r\n\t}\r\n\treturn shift;\r\n}\r\n\r\nfunction getDatePart(date) {\r\n\treturn d.datePart(date, true);\r\n}\r\n\r\nfunction getTimePart(date) {\r\n\treturn d.timePart(date);\r\n}\n\nconst diff = {\r\n\tyear: differenceInYears,\r\n\tquarter: differenceInQuarters,\r\n\tmonth: differenceInMonths,\r\n\tweek: differenceInWeeks,\r\n\tday: differenceInCalendarDays,\r\n\thour: differenceInHours,\r\n\tminute: differenceInMinutes,\r\n};\r\n\r\nfunction countDaysInMonth(sdate) {\r\n\tif (!sdate) return 30;\r\n\r\n\tconst m = sdate.getMonth();\r\n\r\n\tif (m === 1) {\r\n\t\tconst y = sdate.getFullYear();\r\n\t\tif (y % 4) return 28;\r\n\t\tif (y % 100) return 29;\r\n\t\tif (y % 400) return 28;\r\n\t\treturn 29;\r\n\t}\r\n\r\n\tif ((m % 2 && m < 7) || (!(m % 2) && m > 7)) {\r\n\t\treturn 30;\r\n\t}\r\n\r\n\treturn 31;\r\n}\r\n/**\r\n * Smaller units for task position and width for scales with precision setting:\r\n * the name of the unit and the number within a larger unit\r\n */\r\nconst smallerCount = {\r\n\tyear: [\"quarter\", 4],\r\n\tquarter: [\"month\", 3],\r\n\tmonth: [\"day\", countDaysInMonth],\r\n\tweek: [\"day\", 7],\r\n\tday: [\"hour\", 24],\r\n\thour: [\"minute\", 60],\r\n};\r\n\r\nconst add = {\r\n\tyear: addYears,\r\n\tquarter: addQuarters,\r\n\tmonth: addMonths,\r\n\tweek: addWeeks,\r\n\tday: addDays,\r\n\thour: addHours,\r\n\tminute: addMinutes,\r\n};\r\n\r\n/**\r\n * Calculates the difference between two dates in units\r\n * @param {string} unit - the minimal unit of the current scale (\"hour\"-\"year\")\r\n * @param {Date} next - a later date\r\n * @param {Date} prev - an earlier date\r\n * @param {boolean} precise - current precision setting of the scales (if true, diff will be counted for smallerCount)\r\n * @param {boolean} wt - shows that diff will be counted for the width of a task\r\n * @returns {number} - an int (if precise is false) or a float number\r\n */\r\nfunction innerDiff(unit, next, prev, precise, wt) {\r\n\tconst minUnit = precise ? smallerCount[unit][0] : unit;\r\n\r\n\tlet start = prev;\r\n\tlet end = next;\r\n\tif (wt) {\r\n\t\tstart = getUnitStart(minUnit, prev);\r\n\t\tend = getUnitStart(minUnit, next);\r\n\t\tif (end < next) end = addUnit(minUnit)(end, 1);\r\n\t}\r\n\r\n\tif (precise) {\r\n\t\tlet filled = diff[minUnit](end, start);\r\n\t\tconst all = smallerCount[unit][1];\r\n\t\treturn filled / (typeof all === \"number\" ? all : all(prev));\r\n\t} else {\r\n\t\treturn diff[minUnit](end, start);\r\n\t}\r\n}\r\n\r\n/**\r\n * Returns a function for calculating the difference between two dates in units\r\n * @param {string} unit - the minimal unit of the current scale (\"hour\"-\"year\")\r\n * @returns {function} - details below\r\n */\r\nfunction getDiff(unit) {\r\n\t/**\r\n\t * the returned function calculates the difference between two dates based on passed parameters\r\n\t * @param {Date} next - first date\r\n\t * @param {Date} prev - second date\r\n\t * @param {boolean} precise false by default, true when used to count x-position\r\n\t * and width of tasks with 'step-1' precision\r\n\t * @param {boolean} wt - marker that diff is used to count width of a task;\r\n\t * if diff returns 0, you have to add 1; otherwise tasks that are within 1 unit will have 0 width\r\n\t * and will be displayed incorrectly\r\n\t * @returns {number} - the difference between two dates in 'units'; if 'precise' is true, the number is float, otherwise int\r\n\t */\r\n\treturn (next, prev, precise, wt) => {\r\n\t\tif (unit === \"month\" && precise) {\r\n\t\t\treturn getMonthDayDiff(next, prev, wt);\r\n\t\t} else {\r\n\t\t\treturn innerDiff(unit, next, prev, precise, wt);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n/**\r\n * Calculates the difference in months between two days for a scale with precision setting\r\n * This is a specific case of diff counting, because a month can have 28-31 days\r\n * @param {Date} end - a later date\r\n * @param {Date} start - an earlier date\r\n * @param {Boolean} wt - shows that diff will be counted for the width of a task\r\n * @returns {number} - a float number\r\n */\r\nfunction getMonthDayDiff(end, start, wt) {\r\n\tif (sameMonth(start, end)) {\r\n\t\treturn innerDiff(\"month\", end, start, true, wt);\r\n\t}\r\n\r\n\t// if starts not on 1st day\r\n\tlet daysOfFirstMonth = 0;\r\n\tif (start.getDate() > 1) {\r\n\t\tconst me = new Date(start.getFullYear(), start.getMonth() + 1, 1);\r\n\t\tdaysOfFirstMonth = innerDiff(\"month\", me, start, true);\r\n\t\tstart = me;\r\n\t}\r\n\r\n\t// if lasts 1+ whole months\r\n\tlet months = 0;\r\n\tif (!sameMonth(start, end)) {\r\n\t\tmonths = innerDiff(\"month\", webix.Date.monthStart(end), start); // int part\r\n\t\tstart = webix.Date.add(start, months, \"month\", true);\r\n\t}\r\n\r\n\t// all above plus days of last month if any\r\n\treturn daysOfFirstMonth + months + innerDiff(\"month\", end, start, true);\r\n}\r\n\r\nfunction sameMonth(a, b) {\r\n\treturn webix.Date.equal(webix.Date.monthStart(a), webix.Date.monthStart(b));\r\n}\r\n\r\nfunction addUnit(unit) {\r\n\treturn add[unit];\r\n}\r\n\r\nfunction getUnitStart(unit, start) {\r\n\tlet t;\r\n\tswitch (unit) {\r\n\t\tcase \"year\":\r\n\t\t\treturn new Date(start.getFullYear(), 0, 1);\r\n\t\tcase \"quarter\":\r\n\t\t\treturn new Date(\r\n\t\t\t\tstart.getFullYear(),\r\n\t\t\t\tMath.floor(start.getMonth() / 3) * 3,\r\n\t\t\t\t1\r\n\t\t\t);\r\n\t\tcase \"month\":\r\n\t\t\treturn new Date(start.getFullYear(), start.getMonth(), 1);\r\n\t\tcase \"week\":\r\n\t\t\tt = new Date(start.getFullYear(), start.getMonth(), start.getDate());\r\n\t\t\tt.setDate(start.getDate() - getDay(start));\r\n\t\t\treturn t;\r\n\t\tcase \"day\":\r\n\t\t\tt = new Date(start.getFullYear(), start.getMonth(), start.getDate());\r\n\t\t\tt.setHours(0, 0, 0, 0);\r\n\t\t\treturn t;\r\n\t\tcase \"hour\":\r\n\t\t\tt = new Date(start.getFullYear(), start.getMonth(), start.getDate());\r\n\t\t\tt.setHours(start.getHours(), 0, 0, 0);\r\n\t\t\treturn t;\r\n\t\tdefault:\r\n\t\t\treturn new Date(start);\r\n\t}\r\n}\n\nfunction getMinUnit(scales) {\r\n\tconst start = new Date();\r\n\treturn scales\r\n\t\t.map(item => ({ item, len: addUnit(item.unit)(start, 1) }))\r\n\t\t.sort((a, b) => (a.len < b.len ? -1 : 1))[0].item.unit;\r\n}\r\n\r\n/**\r\n * Resets scales to new parameters and returns the object that stores related constants and functions\r\n * @param {Date} start - start date\r\n * @param {Date} end - end date\r\n * @param {boolean} precise - flag that defines whether to round task position and width to a smaller unit\r\n * @param {number} width - width of smallest cell unit\r\n * @param {number} height - height of scale cell\r\n * @param {Array} scales - a set of scales (objects)\r\n * @param {function} isHoliday - the function that checks if a day is a holiday\r\n * @returns {Object} scales\r\n */\r\nfunction resetScales(\r\n\tstart,\r\n\tend,\r\n\tprecise,\r\n\twidth,\r\n\theight,\r\n\tscales,\r\n\tisHoliday\r\n) {\r\n\t// console.log(\"[x] reset scales\");\r\n\r\n\tconst minUnit = getMinUnit(scales);\r\n\tconst diff = getDiff(minUnit);\r\n\r\n\tconst tempEnd = getUnitStart(minUnit, end);\r\n\tstart = getUnitStart(minUnit, start);\r\n\tend = tempEnd < end ? addUnit(minUnit)(tempEnd, 1) : tempEnd;\r\n\r\n\tconst fullWidth = diff(end, start) * width;\r\n\tconst fullHeight = height * scales.length;\r\n\r\n\tconst rows = scales.map(line => {\r\n\t\tconst cells = [];\r\n\t\tconst add = addUnit(line.unit);\r\n\t\tconst step = line.step || 1;\r\n\t\tconst countInWeeks = minUnit === \"week\" && line.unit !== \"week\";\r\n\r\n\t\tlet date = getUnitStart(line.unit, start);\r\n\t\twhile (date < end) {\r\n\t\t\tlet next = add(date, step);\r\n\r\n\t\t\tif (date < start) date = start;\r\n\t\t\tif (next > end) next = end;\r\n\r\n\t\t\t/**\r\n\t\t\t * Special handling for counting width of greater units in weeks\r\n\t\t\t * this code decides whether a week belongs to the current greater unit based on weekdays of this unit boundaries\r\n\t\t\t * if start day is Thursday+, then this greater unit should not count this week as its own\r\n\t\t\t * if end day is Thursday+, then this greater unit should count this week as its own\r\n\t\t\t */\r\n\t\t\tlet cdate = date;\r\n\t\t\tlet cnext = next;\r\n\t\t\tif (countInWeeks) {\r\n\t\t\t\tif (getDay(date) > 3) {\r\n\t\t\t\t\tcdate = webix.Date.add(date, 1, \"week\", true);\r\n\t\t\t\t}\r\n\t\t\t\tif (getDay(next) > 3) {\r\n\t\t\t\t\tcnext = webix.Date.add(next, 1, \"week\", true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst cellWidth = (diff(cnext, cdate) || 1) * width;\r\n\r\n\t\t\t/*[ToDo] suggestion\r\n\t\t\t value must not be formatted within engine as it depends on app locale\r\n\t\t\t use scales.format function to format dates in UI\r\n\t\t\t*/\r\n\r\n\t\t\tconst value =\r\n\t\t\t\ttypeof line.format === \"function\"\r\n\t\t\t\t\t? line.format(date, next)\r\n\t\t\t\t\t: format(date, line.format);\r\n\r\n\t\t\tlet css = \"\";\r\n\t\t\tif (line.css)\r\n\t\t\t\tcss += typeof line.css === \"function\" ? line.css(date) : line.css;\r\n\r\n\t\t\tcells.push({\r\n\t\t\t\twidth: cellWidth,\r\n\t\t\t\tvalue,\r\n\t\t\t\tcss,\r\n\t\t\t\tdate,\r\n\t\t\t\tformat: formatFunction(line.format),\r\n\t\t\t});\r\n\r\n\t\t\tdate = next;\r\n\t\t}\r\n\r\n\t\treturn { cells, add, height, type: line.unit, step: line.step || 1 };\r\n\t});\r\n\r\n\tprecise = !!(minUnit === \"day\" ? precise : precise != false);\r\n\r\n\treturn {\r\n\t\trows,\r\n\t\twidth: fullWidth,\r\n\t\theight: fullHeight,\r\n\t\tcellWidth: width,\r\n\t\tcellHeight: height,\r\n\t\tdiff,\r\n\t\tstart,\r\n\t\tend,\r\n\t\tminUnit,\r\n\t\tprecise,\r\n\t\tisHoliday,\r\n\t};\r\n}\r\n\r\nfunction grid(width, height, color) {\r\n\tconst canvas = document.createElement(\"canvas\");\r\n\tcanvas.setAttribute(\"width\", width);\r\n\tcanvas.setAttribute(\"height\", height);\r\n\r\n\tconst ctx = canvas.getContext(\"2d\");\r\n\tctx.strokeStyle = color;\r\n\tctx.moveTo(0, height);\r\n\tctx.lineTo(width, height);\r\n\tctx.lineTo(width, 0);\r\n\tctx.stroke();\r\n\r\n\treturn canvas.toDataURL();\r\n}\n\n/**\r\n * Prepares dimensional coordinates for a task\r\n * @param {Object} task - task data object\r\n * @param {number} i - the index of the task\r\n * @param {Object} scales - the data for current scales; the return value of resetScales()\r\n * @param {number} taskHeight - the height of a task bar\r\n * @param {number} y - the top position of a task after which the current task will be placed (timeline mode)\r\n * @returns {Object} task data object\r\n */\r\nfunction updateTask(task, i, scales, taskHeight, y) {\r\n\tif (task.type === \"split\" && task.$data && task.$data.length) {\r\n\t\ttask.$data.forEach(k => getSizes(k, i, scales, taskHeight));\r\n\t} else {\r\n\t\tgetSizes(task, i, scales, taskHeight, y);\r\n\t}\r\n\treturn task;\r\n}\r\n\r\nfunction getSizes(task, i, scales, taskHeight, y) {\r\n\tconst { start, end, cellWidth, cellHeight, diff, minUnit, precise } = scales;\r\n\tconst startDate = task.start_date < start ? start : task.start_date;\r\n\tconst endDate = task.end_date > end ? end : task.end_date;\r\n\tconst astart = getUnitStart(minUnit, start);\r\n\r\n\tconst ms = task.type == \"milestone\";\r\n\ttask.$h = taskHeight;\r\n\ttask.$x =\r\n\t\tMath.round(diff(startDate, astart, precise) * cellWidth) -\r\n\t\t(ms ? task.$h / 2 : 0);\r\n\ttask.$w = ms\r\n\t\t? task.$h\r\n\t\t: Math.round(diff(endDate, startDate, precise, true) * cellWidth);\r\n\ttask.$y = webix.isUndefined(y)\r\n\t\t? cellHeight * i + (cellHeight - taskHeight) / 2\r\n\t\t: y;\r\n}\r\n\r\n/**\r\n * Updates start, end and duration fields of tasks during initial loading and updating\r\n * @param {Object} task - task data object\r\n * @param {Object} scales - (optional) the data for current scales; the return value of resetScales()\r\n * @param {string} mode - (optional) update mode, \"start\" or \"end\"\r\n * @param {number} dir - (optional) direction of change (-1 is the past, 1 is the future)\r\n */\r\nfunction updateTaskDuration(task, scales, mode, dir) {\r\n\tif (\r\n\t\ttask.start_date &&\r\n\t\ttask.end_date &&\r\n\t\ttask.start_date.valueOf() >= task.end_date.valueOf()\r\n\t) {\r\n\t\ttask.end_date = null;\r\n\t\ttask.duration = 1;\r\n\r\n\t\tif (mode) mode = \"move\";\r\n\t}\r\n\r\n\tif (scales) {\r\n\t\texcludeHolidays(task, scales, mode, dir);\r\n\t} else {\r\n\t\tif (task.type == \"milestone\") {\r\n\t\t\tgetMilestone(task);\r\n\t\t} else {\r\n\t\t\tif (!task.duration) {\r\n\t\t\t\ttask.duration = getDuration(task);\r\n\t\t\t}\r\n\t\t\tif (!task.end_date) {\r\n\t\t\t\ttask.end_date = getEnd(task);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n * Excludes holidays from start, end and duration of tasks (can't start or end on a holiday)\r\n * @param {Object} task - task data object\r\n * @param {Object} scales - the data for current scales; the return value of resetScales()\r\n * @param {string} mode - (optional) update mode, \"start\" or \"end\"\r\n * @param {number} dir - (optional) direction of change (-1 is the past, 1 is the future)\r\n */\r\nfunction excludeHolidays(task, scales, mode, dir) {\r\n\tif (task.type == \"milestone\") {\r\n\t\ttask.start_date = mode\r\n\t\t\t? toWorkday(task.start_date, false, scales, dir)\r\n\t\t\t: toClosestWorkday(task.start_date, scales); //on load\r\n\t\treturn getMilestone(task);\r\n\t}\r\n\r\n\tif (!mode) {\r\n\t\t//on load\r\n\t\ttask.start_date = toClosestWorkday(task.start_date, scales);\r\n\t\ttask.end_date = getEndWorkday(task, scales);\r\n\t\ttask.duration = getDuration(task, scales);\r\n\t} else {\r\n\t\tif (mode == \"start\" || mode == \"move\") {\r\n\t\t\ttask.start_date = toWorkday(task.start_date, false, scales, dir);\r\n\t\t\tif (!task.duration) task.duration = getDuration(task, scales);\r\n\t\t\tif (!task.end_date) task.end_date = getEndWorkday(task, scales);\r\n\t\t} else {\r\n\t\t\t//end, duration\r\n\t\t\tif (!task.end_date) task.end_date = getEndWorkday(task, scales);\r\n\t\t\tif (!task.duration) {\r\n\t\t\t\ttask.end_date = toWorkday(task.end_date, true, scales, dir);\r\n\t\t\t\ttask.duration = getDuration(task, scales);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction getMilestone(task) {\r\n\ttask.duration = 0;\r\n\ttask.end_date = task.start_date;\r\n}\r\n\r\n/**\r\n * Returns the end date of a task\r\n * @param {Object} task - task data object\r\n */\r\nfunction getEnd(task) {\r\n\tif (task.duration < 1)\r\n\t\treturn addUnit(\"hour\")(task.start_date, Math.floor(24 * task.duration));\r\n\telse return addUnit(\"day\")(task.start_date, task.duration);\r\n}\r\n\r\n/**\r\n * Returns end date excluding holidays from duration\r\n * @param {Object} task - task data object\r\n * @param {Object} scales - the data for current scales; the return value of resetScales()\r\n * @returns {Date} end date\r\n */\r\nfunction getEndWorkday(task, scales) {\r\n\tif (task.duration < 1) return getEnd(task);\r\n\r\n\tlet date = getDatePart(task.start_date);\r\n\tfor (let w = 0, d = 0; w < task.duration; ) {\r\n\t\tif (!scales.isHoliday(date)) {\r\n\t\t\t++w;\r\n\t\t\td = 0;\r\n\t\t} else {\r\n\t\t\tif (++d === 30) holidayGuard();\r\n\t\t}\r\n\r\n\t\tdate = addDays(date, 1);\r\n\t}\r\n\treturn date;\r\n}\r\n\r\n/**\r\n * Calculates the duration of a task\r\n * @param {Object} task - task data object\r\n * @param {Object} scales - the data for current scales; the return value of resetScales()\r\n * @returns {number} task duration\r\n */\r\nfunction getDuration(task, scales) {\r\n\tconst d = getDiff(\"day\")(task.end_date, task.start_date, true);\r\n\t// allow float duration for tasks smaller than day\r\n\tif (d < 1) return parseFloat(d.toFixed(2));\r\n\r\n\tif (!scales) return Math.floor(d);\r\n\r\n\tlet date = task.start_date;\r\n\tlet duration = 0;\r\n\twhile (date < task.end_date) {\r\n\t\tif (!scales.isHoliday(date)) ++duration;\r\n\t\tdate = addDays(date, 1);\r\n\t}\r\n\treturn duration;\r\n}\r\n\r\n/**\r\n * Moves a date from a holiday to the closest working day (priority to the future)\r\n * @param {Date} date - original date\r\n * @param {Object} scales - the data for current scales; the return value of resetScales()\r\n * @returns {Date} the date of a closest work day\r\n */\r\nfunction toClosestWorkday(date, scales) {\r\n\tlet left = date;\r\n\tlet right = date;\r\n\tlet notRight;\r\n\tlet d = 0;\r\n\r\n\twhile (\r\n\t\td < 30 &&\r\n\t\t(notRight = scales.isHoliday(right)) &&\r\n\t\tscales.isHoliday(left)\r\n\t) {\r\n\t\tleft = addDays(left, -1);\r\n\t\tright = addDays(right, 1);\r\n\t\td++;\r\n\t}\r\n\tif (d === 30) holidayGuard();\r\n\r\n\treturn !notRight ? right : left;\r\n}\r\n\r\nfunction holidayGuard() {\r\n\talert(\r\n\t\t\"No work days found within 30 days, check your isHoliday function!\",\r\n\t\t\"error\"\r\n\t);\r\n\tthrow \"Wrong isHoliday function\";\r\n}\r\n\r\n/**\r\n * Moves a date from a holiday to a working day in the given direction\r\n * @param {Date} date - the current date\r\n * @param {Boolean} end - indicates if this is the end of a task\r\n * @param {Object} scales - the data for current scales; the return value of resetScales()\r\n * @param {number} dir - the direction in which nearest workday will be located; -1 is the past, 1 is the future\r\n * @returns {Date} the date of a working day\r\n */\r\nfunction toWorkday(date, end, scales, dir) {\r\n\tlet d = 0;\r\n\r\n\twhile (d < 30 && scales.isHoliday(getCheckDate(date, end))) {\r\n\t\tdate = addDays(date, dir);\r\n\t\td++;\r\n\t}\r\n\r\n\tif (d === 30) holidayGuard();\r\n\r\n\treturn date;\r\n}\r\n\r\n/**\r\n * Returns the date for a holiday check\r\n * @param {Date} date - the date\r\n * @param {Boolean} end - if true, means it's the end date (end dates are exclusive)\r\n * @returns {Date} the date that will be used for a check\r\n */\r\nfunction getCheckDate(date, end) {\r\n\treturn end && !getTimePart(date) ? addDays(date, -1) : date;\r\n}\n\nconst delta = 20;\r\n\r\nconst updateLink = function(link, startTask, endTask, height) {\r\n\tconst dy = Math.round(height / 2);\r\n\tif (!startTask || !endTask) {\r\n\t\tlink.$p = \"\";\r\n\t\treturn link;\r\n\t}\r\n\r\n\tlet sx, sy, ex, ey;\r\n\tlet s_start = false;\r\n\tlet e_start = false;\r\n\r\n\tswitch (link.type) {\r\n\t\tcase 0:\r\n\t\t\te_start = true;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 1:\r\n\t\t\ts_start = true;\r\n\t\t\te_start = true;\r\n\t\t\tbreak;\r\n\r\n\t\tcase 3:\r\n\t\t\ts_start = true;\r\n\t\t\tbreak;\r\n\t}\r\n\r\n\tsx = s_start ? startTask.$x : startTask.$x + startTask.$w;\r\n\tsy = startTask.$y;\r\n\tex = e_start ? endTask.$x : endTask.$x + endTask.$w;\r\n\tey = endTask.$y;\r\n\r\n\tif (differentX(startTask, endTask, sx, ex, height) || sy !== ey) {\r\n\t\tconst lineCoords = getLineCoords(\r\n\t\t\tsx,\r\n\t\t\tsy + dy,\r\n\t\t\tex,\r\n\t\t\tey + dy,\r\n\t\t\ts_start,\r\n\t\t\te_start,\r\n\t\t\t38 / 2\r\n\t\t);\r\n\r\n\t\tconst arrowCoords = getArrowCoords(ex, ey + dy, e_start);\r\n\t\tlink.$p = `${lineCoords},${arrowCoords}`;\r\n\t} else {\r\n\t\tlink.$p = \"\";\r\n\t}\r\n\r\n\treturn link;\r\n};\r\n\r\nfunction differentX(startTask, endTask, sx, ex, height) {\r\n\treturn startTask.type === \"milestone\" || endTask.type === \"milestone\"\r\n\t\t? Math.abs(sx - ex) > height / 2\r\n\t\t: sx !== ex;\r\n}\r\n\r\nfunction getLineCoords(sx, sy, ex, ey, s_start, e_start, gapp) {\r\n\tconst shift = delta * (s_start ? -1 : 1);\r\n\tconst backshift = delta * (e_start ? -1 : 1);\r\n\r\n\tconst sx1 = sx + shift;\r\n\tconst ex1 = ex + backshift;\r\n\tconst line = [sx, sy, sx1, sy, 0, 0, 0, 0, ex1, ey, ex, ey];\r\n\r\n\tconst dx = ex1 - sx1;\r\n\tlet dy = ey - sy;\r\n\r\n\tconst same = e_start === s_start;\r\n\tif (!same && ((ex1 <= sx && e_start) || (ex1 > sx && !e_start))) {\r\n\t\tdy -= gapp;\r\n\t}\r\n\r\n\tif ((same && e_start && sx1 > ex1) || (same && !e_start && sx1 < ex1)) {\r\n\t\tline[4] = line[2] + dx;\r\n\t\tline[5] = line[3];\r\n\t\tline[6] = line[4];\r\n\t\tline[7] = line[5] + dy;\r\n\t} else {\r\n\t\tline[4] = line[2];\r\n\t\tline[5] = line[3] + dy;\r\n\t\tline[6] = line[4] + dx;\r\n\t\tline[7] = line[5];\r\n\t}\r\n\r\n\treturn line.join(\",\");\r\n}\r\n\r\nfunction getArrowCoords(x, y, start) {\r\n\tif (start) {\r\n\t\treturn `${x - 5},${y - 3},${x - 5},${y + 3},${x},${y}`;\r\n\t} else {\r\n\t\treturn `${x + 5},${y + 3},${x + 5},${y - 3},${x},${y}`;\r\n\t}\r\n}\r\n\r\nfunction newLink(box, start, end) {\r\n\tif (start && end) {\r\n\t\tconst width = end.x - start.x;\r\n\t\tconst height = end.y - start.y;\r\n\t\tconst left = (width > 0 ? start.x : end.x) - box.left;\r\n\t\tconst top = (height > 0 ? start.y : end.y) - box.top;\r\n\t\tconst p = `${width > 0 ? 0 : -width},${height > 0 ? 0 : -height},${\r\n\t\t\twidth > 0 ? width : 0\r\n\t\t},${height > 0 ? height : 0}`;\r\n\t\treturn { width: Math.abs(width), height: Math.abs(height), left, top, p };\r\n\t} else {\r\n\t\treturn null;\r\n\t}\r\n}\n\nexports.addUnit = addUnit;\nexports.getDiff = getDiff;\nexports.getUnitStart = getUnitStart;\nexports.grid = grid;\nexports.newLink = newLink;\nexports.resetScales = resetScales;\nexports.smallerCount = smallerCount;\nexports.updateLink = updateLink;\nexports.updateTask = updateTask;\nexports.updateTaskDuration = updateTaskDuration;\n//# sourceMappingURL=wgantt.js.map\n","function updateDragPos(e, pos) {\n\tif (webix.DragControl.active) {\n\t\tconst node = webix.DragControl.getNode();\n\n\t\tpos = webix.copy(pos);\n\t\twebix.DragControl.$dragPos(pos, e);\n\n\t\tnode.style.top = pos.y + webix.DragControl.top + \"px\";\n\t\tnode.style.left = pos.x + webix.DragControl.left + \"px\";\n\t}\n}\n\nconst DragScroll = {\n\tstart(ctx, e) {\n\t\tctx._auto_scroll_delay = webix.delay(\n\t\t\tDragScroll.autoScroll,\n\t\t\tctx,\n\t\t\t[e, webix.html.pos(e)],\n\t\t\t250\n\t\t);\n\t},\n\n\treset(ctx) {\n\t\tif (ctx._auto_scroll_delay)\n\t\t\tctx._auto_scroll_delay = window.clearTimeout(ctx._auto_scroll_delay);\n\t},\n\n\tautoScroll(e, pos) {\n\t\tconst yScroll = this.direction.indexOf(\"y\") !== -1;\n\t\tconst xScroll = this.direction.indexOf(\"x\") !== -1;\n\t\tconst box = webix.html.offset(this.from.view.$view);\n\n\t\tlet reset = false;\n\t\tif (yScroll && DragScroll.autoYScroll.call(this, pos, box, this.senseY))\n\t\t\treset = true;\n\t\tif (xScroll && DragScroll.autoXScroll.call(this, pos, box, this.senseX))\n\t\t\treset = true;\n\n\t\tif (reset) {\n\t\t\tupdateDragPos(e, pos);\n\t\t\tthis._auto_scroll_delay = webix.delay(\n\t\t\t\tDragScroll.autoScroll,\n\t\t\t\tthis,\n\t\t\t\t[e, pos],\n\t\t\t\t100\n\t\t\t);\n\t\t}\n\t},\n\n\tautoYScroll(pos, box, sense) {\n\t\tconst scroll = this.from.view.getScrollState();\n\n\t\tif (pos.y < box.y + sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x,\n\t\t\t\tscroll.y - sense,\n\t\t\t\t\"y\"\n\t\t\t);\n\t\t} else if (pos.y > box.y + box.height - sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x,\n\t\t\t\tscroll.y + sense,\n\t\t\t\t\"y\"\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t},\n\n\tautoXScroll(pos, box, sense) {\n\t\tconst scroll = this.from.view.getScrollState();\n\n\t\tif (pos.x < box.x + sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x - sense,\n\t\t\t\tscroll.y,\n\t\t\t\t\"x\"\n\t\t\t);\n\t\t} else if (pos.x > box.x + box.width - sense) {\n\t\t\tconst x = this.snode\n\t\t\t\t? Math.min(scroll.x + sense, this.snode.scrollWidth - box.width)\n\t\t\t\t: scroll.x + sense;\n\t\t\treturn x == scroll.x\n\t\t\t\t? false\n\t\t\t\t: DragScroll.autoScrollTo.call(this, x, scroll.y, \"x\");\n\t\t}\n\t\treturn false;\n\t},\n\n\tautoScrollTo(x, y, mode) {\n\t\tthis.from.view.scrollTo(x, y);\n\t\tthis.from.view.callEvent(\"onAfterAutoScroll\", []);\n\n\t\tconst scroll = this.from.view.getScrollState();\n\t\treturn Math.abs((mode === \"x\" ? x : y) - scroll[mode]) < 1;\n\t},\n};\n\nexport default DragScroll;\n","import { Resizer } from \"./resizer\";\nimport {\n\tgetParams,\n\tcutOccurrence,\n\tclipSequence,\n\tmovePattern,\n} from \"./recurring\";\nimport { isSameDate } from \"./dates\";\nimport { serialize } from \"./ical\";\nimport { smallerCount, getUnitStart, addUnit } from \"@xbs/webix-gantt-lib\";\nimport DragScroll from \"./dragscroll\";\nimport { cleanEventData } from \"./copypaste\";\n\nexport function initDnD(view, mode, dragOnly) {\n\tconst ctrl = webix.copy(modes[mode]);\n\n\tctrl.view = view;\n\tctrl.master = this;\n\tctrl.State = this.app.getState();\n\tconst local = this.app.getService(\"local\");\n\tctrl.Local = local.events(true);\n\tctrl.Calendars = local.calendars(true);\n\tctrl.Ops = this.app.getService(\"operations\");\n\n\twebix.DragControl.addDrag(view.$view, ctrl);\n\tif (!dragOnly) webix.DragControl.addDrop(view.$view, ctrl, true);\n}\n\nexport function locateEvent(e, view, attr) {\n\tlet target = e.target;\n\tlet id, node;\n\n\tdo {\n\t\tid = target.getAttribute ? target.getAttribute(attr || \"webix_e_id\") : null;\n\t\tnode = id ? target : null;\n\t\ttarget = target.parentNode;\n\t} while (!id && target && target !== view);\n\n\treturn { id, node };\n}\n\nfunction updateSelection(prev, date) {\n\tif (this.State.selected) {\n\t\tconst selection = getParams(prev);\n\t\tif (prev.$recurring)\n\t\t\tselection.date = date.start_date.valueOf() + \"_\" + prev.$id;\n\n\t\tthis.State.selected = selection;\n\t}\n}\n\n/**\n * Updates dates/time of a recurring event\n * @param {string} mode - the mode for editing (\"all\", \"next\", \"this\", \"\")\n * @param {Object} obj - the event data object\n * @param {Object} change - the new dates\n * @returns {Promise}\n */\nfunction editRecurring(mode, obj, change) {\n\tlet id = obj.$id || obj.id;\n\n\t// get it out of data collection, not out of datastore of current view\n\tconst data = this.Local.getItem(id);\n\n\t/* special cases */\n\t// if 'this' edited as 'this'\n\tif (\n\t\tmode === \"this\" &&\n\t\tthis.master.HasOneOccurrence({\n\t\t\t...obj,\n\t\t\tstart_date: data.start_date,\n\t\t\tend_date: data.end_date,\n\t\t})\n\t) {\n\t\treturn this.Ops.updateEvent(id, change, undefined, undefined, true);\n\t}\n\t// if 1st occurrence in whole sequence or in 'next'\n\tmode = this.master.ChangeMode(\n\t\tmode,\n\t\tobj,\n\t\tthis.Local.getItem(obj.recurring ? id : obj.origin_id).start_date,\n\t\tobj.recurring ? obj.id : obj.start_date\n\t);\n\tif (!mode) {\n\t\t// if date was changed\n\t\tobj.$recurring = movePattern(obj.$recurring, change, obj);\n\t\tchange.recurring = serialize(obj.$recurring);\n\t\treturn this.Ops.updateEvent(id, change, undefined, undefined, true);\n\t}\n\n\tif (mode === \"this\" || mode === \"next\") {\n\t\t// cut out occurrence or split event sequence and save as separate events\n\t\tlet recurring = \"\";\n\t\tlet parent;\n\t\tif (mode === \"this\") {\n\t\t\trecurring = cutOccurrence(obj.id, obj);\n\t\t} else {\n\t\t\tif (obj.recurring) {\n\t\t\t\trecurring = clipSequence(obj.id, webix.copy(obj));\n\t\t\t} else {\n\t\t\t\t// if 'this' edited as 'next'\n\t\t\t\tid = obj.origin_id;\n\t\t\t\tparent = webix.copy(this.Local.getItem(id));\n\t\t\t\trecurring = clipSequence(change.start_date, webix.copy(parent), true);\n\t\t\t}\n\t\t}\n\n\t\tconst newEvent = newSubEvent.call(this, id, mode, obj, change, parent);\n\n\t\treturn this.Ops.updateEvent(\n\t\t\tid,\n\t\t\t{ recurring },\n\t\t\tmode,\n\t\t\twebix.Date.dayStart(newEvent.start_date),\n\t\t\ttrue\n\t\t).then(() => {\n\t\t\treturn this.Ops.addEvent(newEvent, true);\n\t\t});\n\t}\n\n\tif (mode === \"all\") {\n\t\tconst oid = obj.origin_id || obj.$id;\n\t\tconst all = webix.copy(this.Local.getItem(oid));\n\t\tlet rec = all.$recurring;\n\t\tif (rec.COUNT || rec.UNTIL) {\n\t\t\trec = this.master.CorrectCountUntil(\n\t\t\t\tall,\n\t\t\t\tmode,\n\t\t\t\tchange.start_date,\n\t\t\t\tthis.Local\n\t\t\t);\n\t\t}\n\n\t\tif (!change.start_date || isSameDate(obj.start_date, change.start_date)) {\n\t\t\tif (change.start_date) {\n\t\t\t\tchange.start_date = joinDateTime(all.start_date, change.start_date);\n\t\t\t}\n\n\t\t\tif (change.end_date) {\n\t\t\t\tif (isSameDate(obj.end_date, change.end_date)) {\n\t\t\t\t\tchange.end_date = joinDateTime(all.end_date, change.end_date);\n\t\t\t\t} else {\n\t\t\t\t\tchange.end_date = shiftDate(\n\t\t\t\t\t\tall.end_date,\n\t\t\t\t\t\tobj.end_date,\n\t\t\t\t\t\tchange.end_date\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// in timeline mode, the user can change start date without end date (resize start)\n\t\t\tif (!change.end_date) {\n\t\t\t\tchange.start_date = shiftDate(\n\t\t\t\t\tall.start_date,\n\t\t\t\t\tobj.start_date,\n\t\t\t\t\tchange.start_date\n\t\t\t\t);\n\t\t\t}\n\t\t\trec = movePattern(rec, change, all);\n\t\t}\n\n\t\tif (change.start_date) {\n\t\t\tif (rec.EXDATE) delete rec.EXDATE;\n\t\t\tchange.recurring = serialize(rec);\n\t\t}\n\n\t\treturn this.Ops.updateEvent(\n\t\t\tobj.origin_id || id,\n\t\t\tchange,\n\t\t\tmode,\n\t\t\tundefined,\n\t\t\ttrue\n\t\t);\n\t}\n}\n\nfunction shiftDate(mainDate, occDate, changeDate) {\n\treturn new Date(mainDate * 1 + (changeDate - occDate));\n}\n\n/**\n * Adds the time of the second date to the date part of the first date and returns the resulting date\n * @param {Date} ddate\n * @param {Date} dtime\n * @returns {Date}\n */\nfunction joinDateTime(ddate, dtime) {\n\tconst time = webix.Date.timePart(dtime) * 1000;\n\treturn new Date(webix.Date.dayStart(ddate) * 1 + time);\n}\n\nfunction newSubEvent(id, mode, obj, change, parent) {\n\tconst newEvent = { ...obj, ...change, recurring: \"\" };\n\tif (!newEvent.origin_id) newEvent.origin_id = id;\n\n\tif (mode === \"next\") {\n\t\t// [FIXME] maybe need to store total UNTIL/COUNT on backend (mostly for dynamic loading)\n\t\tlet rec = webix.copy(obj.recurring ? obj.$recurring : parent.$recurring);\n\t\tif (rec.COUNT || rec.UNTIL) {\n\t\t\trec = this.master.CorrectCountUntil(\n\t\t\t\t{ ...this.Local.getItem(id), $recurring: rec },\n\t\t\t\tmode,\n\t\t\t\tnewEvent.start_date,\n\t\t\t\tthis.Local\n\t\t\t);\n\t\t}\n\t\trec = movePattern(rec, newEvent, obj); // if date was changed\n\t\trec.EXDATE = [];\n\n\t\tnewEvent.recurring = serialize(rec);\n\t}\n\n\t// reserved key of recurring inner logic, must not stay in new data\n\tdelete newEvent.$id;\n\n\treturn newEvent;\n}\n\nconst common = {\n\tmode: \"common\",\n\t$longTouchLimit: true,\n\t$dragDestroy: function(target, node) {\n\t\tconst ctx = this.getContext();\n\n\t\tif (!ctx.$waitUpdate && ctx.node) ctx.node.style.visibility = \"visible\";\n\t\tif (ctx.$resize) webix.html.removeCss(document.body, \"webix_active_resize\");\n\n\t\twebix.html.remove(node);\n\n\t\tif (ctx.moveMode === \"move\" && !ctx.more) DragScroll.reset(ctx);\n\n\t\treturn false;\n\t},\n\tgetContext: function() {\n\t\treturn webix.DragControl.getContext();\n\t},\n\tsetDragOffset: function(node, target, e) {\n\t\tconst ctx = this.getContext();\n\t\tconst pos = webix.html.pos(e);\n\t\tconst offset = webix.html.offset(node);\n\n\t\tctx.width = offset.width;\n\t\tctx.height = offset.height;\n\t\tctx.x_offset = offset.x - pos.x;\n\t\tctx.y_offset = offset.y - pos.y;\n\t},\n\tupdateEvent: function(event, data) {\n\t\tif (event.$id || event.origin_id) {\n\t\t\tthis.master._waitPopup = webix.promise.defer();\n\t\t\tthis.master._waitPopup\n\t\t\t\t.then(o => {\n\t\t\t\t\tconst res = editRecurring.call(this, o, event, data);\n\n\t\t\t\t\tres.then(() => updateSelection.call(this, event, data));\n\t\t\t\t\tthis.master.app.callEvent(\"backend:operation\", [res]);\n\t\t\t\t})\n\t\t\t\t.finally(() => (this.master._waitPopup = null));\n\t\t\tthis.master.app._dndActionPopup.Show(this.master._waitPopup);\n\t\t} else {\n\t\t\tconst res = this.Ops.updateEvent(\n\t\t\t\tevent.$id || event.id,\n\t\t\t\tdata,\n\t\t\t\tundefined,\n\t\t\t\tundefined,\n\t\t\t\ttrue\n\t\t\t);\n\t\t\tthis.finishOperation(res, event, data);\n\t\t}\n\t},\n\taddEvent: function(event, data) {\n\t\tconst newEvent = {\n\t\t\ttext: event.text,\n\t\t\tstart_date: data.start_date,\n\t\t\tend_date: data.end_date,\n\t\t\tdetails: \"\",\n\t\t};\n\t\tif (this.master.app.config.calendars) {\n\t\t\tnewEvent.calendar = event.calendar;\n\t\t}\n\t\tif (this.master.app.config.timeline) {\n\t\t\tnewEvent.section = data.section || event.section;\n\t\t}\n\n\t\tif (this.master.app.config.units && event.units) {\n\t\t\tnewEvent.units = data.units || event.units;\n\t\t}\n\n\t\tconst res = this.Ops.addEvent(newEvent, true);\n\t\tthis.finishOperation(res, newEvent, data);\n\t},\n\n\tcopyEvent: function(event, data) {\n\t\tconst newEvent = { ...event, ...data };\n\t\tcleanEventData.call(this.master, newEvent);\n\t\tconst res = this.Ops.addEvent(newEvent, true);\n\t\tthis.finishOperation(res, newEvent, data);\n\t},\n\n\tfinishOperation(res, event, data) {\n\t\tconst ctx = this.getContext();\n\t\tres.then(id =>\n\t\t\tupdateSelection.call(this, id ? { ...event, id } : event, data)\n\t\t);\n\t\tthis.master.app.callEvent(\"backend:operation\", [res]);\n\t\tctx[\"$waitUpdate\"] = true;\n\t},\n};\n\nconst day = webix.extend(\n\t{\n\t\tmode: \"day\",\n\t\t$dragIn: function(source, target) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$resize) return Resizer.$dragIn.apply(this, arguments);\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tif (ctx.target != target) {\n\t\t\t\tconst node = webix.DragControl.getNode();\n\n\t\t\t\ttarget.firstChild.appendChild(node);\n\t\t\t\tctx.target = target;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t$drop: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\twebix.extend(ctx, { to: this });\n\t\t\tconst app = this.master.app;\n\n\t\t\tconst cancelDrop =\n\t\t\t\tctx.from.mode !== this.mode ||\n\t\t\t\t!app.callEvent(\"app:beforedrop\", [ctx, e]);\n\n\t\t\tif (cancelDrop) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst date = this.getActualDate(this.master);\n\t\t\tif (date) {\n\t\t\t\tif (ctx.event.id == \"0\") {\n\t\t\t\t\tif (ctx.$creation) {\n\t\t\t\t\t\tthis.State.selected = {\n\t\t\t\t\t\t\tid: \"0\",\n\t\t\t\t\t\t\tdate: ctx.event.start_date,\n\t\t\t\t\t\t\tend_date: date.end_date,\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.addEvent(ctx.event, date);\n\t\t\t\t\t}\n\t\t\t\t} else if (ctx.$copy && !ctx.$resize) {\n\t\t\t\t\tthis.copyEvent(ctx.event, date);\n\t\t\t\t} else {\n\t\t\t\t\tthis.updateEvent(ctx.event, date);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t$dragPos: function(pos) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$resize) return Resizer.$dragPos.apply(this, arguments);\n\n\t\t\tconst box = webix.html.offset(ctx.target);\n\t\t\tconst max = box.height - ctx.height;\n\n\t\t\tpos.x = ctx.x_diff;\n\t\t\tpos.y += ctx.y_offset - box.y;\n\n\t\t\tif (pos.y < 0) pos.y = 0;\n\t\t\telse if (pos.y > max) pos.y = max;\n\n\t\t\twebix.extend(ctx, pos, true);\n\n\t\t\tif (ctx.$last_y !== pos.y) {\n\t\t\t\tthis.updateText(ctx);\n\t\t\t\tctx.$last_y = pos.y;\n\t\t\t}\n\t\t},\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst event = locateEvent(e, target);\n\t\t\tif (event.id) {\n\t\t\t\twebix.extend(ctx, event, true);\n\t\t\t\twebix.extend(ctx, { from: this, target }, true);\n\n\t\t\t\tctx.event = this.master.GetEvent(event.id);\n\t\t\t\tthis.setDragOffset(event.node, target, e);\n\n\t\t\t\tif (e.target.getAttribute(\"webix_resizer\")) {\n\t\t\t\t\tctx[\"$resize\"] = true;\n\t\t\t\t}\n\n\t\t\t\tconst app = this.master.app;\n\t\t\t\tif (!app.callEvent(\"app:beforedrag\", [ctx, e])) {\n\t\t\t\t\treturn false;\n\t\t\t\t} else if (ctx.$resize) {\n\t\t\t\t\twebix.html.addCss(document.body, \"webix_active_resize\", true);\n\t\t\t\t}\n\n\t\t\t\tconst html = event.node.cloneNode(true);\n\n\t\t\t\thtml.className += ` webix_drag_zone webix_${\n\t\t\t\t\tctx.$resize ? \"resize\" : \"drag\"\n\t\t\t\t}_event`;\n\t\t\t\ttarget.firstChild.appendChild(html);\n\n\t\t\t\tctx.$copy = (e.ctrlKey || e.metaKey) && app.config.copypaste;\n\n\t\t\t\tif (!ctx.$copy || event.id === \"0\" || ctx.$resize)\n\t\t\t\t\tevent.node.style.visibility = \"hidden\";\n\n\t\t\t\treturn html;\n\t\t\t} else if (this.master.app.config.dragCreate && !this.State.clipboard) {\n\t\t\t\tconst { y: scrollY } = this.view.getScrollState();\n\t\t\t\tconst { y: parentTopOffset } = webix.html.offset(target);\n\t\t\t\tctx.y = webix.html.pos(e).y - parentTopOffset + scrollY;\n\n\t\t\t\tconst { start_date, end_date } = this.getActualDate(this.master, true);\n\n\t\t\t\tctx.event = {\n\t\t\t\t\tid: \"0\",\n\t\t\t\t\ttext: \"\",\n\t\t\t\t\tstart_date,\n\t\t\t\t\tend_date,\n\t\t\t\t\t$color: \"#997CEB\",\n\t\t\t\t\t$textColor: \"#fff\",\n\t\t\t\t\t$top: ctx.y,\n\t\t\t\t\t$left: 0,\n\t\t\t\t\t$height: this.master.minEventHeight,\n\t\t\t\t\t$width: this.master.List.$width - 8,\n\t\t\t\t};\n\t\t\t\tconst calId = this.Calendars.getFirstId();\n\t\t\t\tif (calId) ctx.event.$color = this.Calendars.getItem(calId).color;\n\n\t\t\t\twebix.extend(ctx, { from: this, target }, true);\n\n\t\t\t\tconst html = webix.html.create(\"div\");\n\t\t\t\thtml.innerHTML = this.master.ToHTML(ctx.event);\n\t\t\t\thtml.firstChild.className += \" webix_drag_zone webix_resize_event\";\n\t\t\t\twebix.html.addCss(document.body, \"webix_active_resize\", true);\n\n\t\t\t\tconst node = target.firstChild.appendChild(html.firstChild);\n\n\t\t\t\tthis.setDragOffset(node, target, e);\n\n\t\t\t\tctx.$resize = true;\n\t\t\t\tctx.$creation = true;\n\n\t\t\t\treturn node;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tgetActualDate: function(master, any) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$resize) return Resizer.getActualDate.apply(this, arguments);\n\n\t\t\tconst date = webix.Date.copy(master.Day);\n\t\t\t//scale start correction\n\t\t\tconst delta = master.List.getFirstId() * master.List.type.height;\n\t\t\tconst minutes =\n\t\t\t\tMath.round(((ctx.y + delta) * 60) / master.List.type.height / 5) * 5;\n\n\t\t\twebix.Date.add(date, minutes, \"minute\");\n\n\t\t\tif (!any && webix.Date.equal(date, ctx.event.start_date)) return null;\n\n\t\t\tconst duration = ctx.event\n\t\t\t\t? ctx.event.end_date - ctx.event.start_date\n\t\t\t\t: 3600000;\n\t\t\treturn {\n\t\t\t\tstart_date: date,\n\t\t\t\tend_date: new Date(date.valueOf() + duration),\n\t\t\t};\n\t\t},\n\t\tupdateText: function(ctx) {\n\t\t\tconst node = webix.DragControl.getNode();\n\t\t\tconst ctrl = webix.DragControl.getMaster(ctx.target);\n\n\t\t\tconst event = this.getActualDate(ctrl.master, true);\n\t\t\tevent.text = ctx.event.text;\n\n\t\t\tnode.innerHTML = \"\";\n\t\t\tnode.innerHTML = ctrl.master.EventTemplate(event);\n\t\t},\n\t\tsetDragOffset: function(node, target, e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst pos = webix.html.pos(e);\n\t\t\tconst noff = webix.html.offset(node);\n\n\t\t\tctx.height = noff.height;\n\t\t\tctx.x_offset = noff.x - pos.x;\n\t\t\tctx.y_offset = noff.y - pos.y;\n\n\t\t\tconst toff = webix.html.offset(target);\n\t\t\tctx.x_diff = noff.x - toff.x - 1; // 1px border\n\t\t\tctx.y_diff = noff.y - toff.y;\n\t\t},\n\t},\n\tcommon\n);\n\nconst month = webix.extend(\n\t{\n\t\tmode: \"month\",\n\t\t$dragIn: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tctx.offset = ctx.offset || webix.html.offset(target);\n\n\t\t\tconst index = this.locate(e);\n\t\t\tconst id = this.view.getIdByIndex(index);\n\t\t\tconst node = this.view.getItemNode(id);\n\n\t\t\tif (ctx.$marked !== id) this.markDropArea(id);\n\n\t\t\treturn node;\n\t\t},\n\t\t$dragOut: function(source, target, drop) {\n\t\t\tif (target !== drop) this.markDropArea();\n\t\t\treturn null;\n\t\t},\n\t\t$drop: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\twebix.extend(ctx, { to: this });\n\t\t\tconst app = this.master.app;\n\n\t\t\tconst cancelDrop =\n\t\t\t\tctx.from.mode !== this.mode ||\n\t\t\t\t!app.callEvent(\"app:beforedrop\", [ctx, e]);\n\n\t\t\tif (cancelDrop) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.markDropArea();\n\n\t\t\tconst copy = ctx.$copy;\n\t\t\tconst date = this.getActualDate(e, copy);\n\t\t\tif (date) {\n\t\t\t\tif (ctx.event.id == \"0\") {\n\t\t\t\t\tthis.addEvent(ctx.event, date);\n\t\t\t\t} else if (copy) {\n\t\t\t\t\tthis.copyEvent(ctx.event, date);\n\t\t\t\t} else this.updateEvent(ctx.event, date);\n\t\t\t}\n\t\t},\n\t\t$dragPos: function(pos) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tpos.x += ctx.x_offset;\n\t\t\tpos.y += ctx.y_offset;\n\t\t},\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst event = locateEvent(e, target);\n\t\t\tif (event.id && event.id != \"$wsh_multi_more\") {\n\t\t\t\tconst ctx = this.getContext();\n\t\t\t\twebix.extend(ctx, event, true);\n\t\t\t\twebix.extend(\n\t\t\t\t\tctx,\n\t\t\t\t\t{ from: this, offset: webix.html.offset(target) },\n\t\t\t\t\ttrue\n\t\t\t\t);\n\n\t\t\t\tctx.event = this.master.Events.getItem(event.id);\n\t\t\t\tctx.start = this.view.getIdByIndex(this.locate(e));\n\n\t\t\t\tthis.setDragOffset(event.node, target, e);\n\n\t\t\t\tconst app = this.master.app;\n\t\t\t\tif (!app.callEvent(\"app:beforedrag\", [ctx, e])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst drag_container = document.createElement(\"DIV\");\n\t\t\t\tconst html = event.node.cloneNode(true);\n\n\t\t\t\thtml.style.position = \"static\";\n\t\t\t\tdrag_container.appendChild(html);\n\t\t\t\tdrag_container.className =\n\t\t\t\t\ttarget.className + \" webix_drag_zone webix_drag_event\";\n\t\t\t\tdocument.body.appendChild(drag_container);\n\n\t\t\t\tctx.$copy = (e.ctrlKey || e.metaKey) && app.config.copypaste;\n\t\t\t\tif (!ctx.$copy || ctx.event.id === \"0\")\n\t\t\t\t\tevent.node.style.visibility = \"hidden\";\n\n\t\t\t\twebix.callEvent(\"onClick\", [e]);\n\t\t\t\treturn drag_container;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tgetActualDate: function(e, any) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst diff = this.locate(e) - this.view.getIndexById(ctx.start);\n\n\t\t\tif (!diff && !any) return null;\n\n\t\t\treturn {\n\t\t\t\tstart_date: webix.Date.add(ctx.event.start_date, diff, \"day\", true),\n\t\t\t\tend_date: webix.Date.add(ctx.event.end_date, diff, \"day\", true),\n\t\t\t};\n\t\t},\n\t\tmarkDropArea: function(id) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$marked && ctx.$marked != id) {\n\t\t\t\tthis.view.removeCss(ctx.$marked, \"webix_drag_over\");\n\t\t\t\tctx.$marked = null;\n\n\t\t\t\tif (ctx.$extra) {\n\t\t\t\t\twebix.html.removeCss(this.view.$view, ctx.$extra);\n\t\t\t\t\tctx.$extra = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!ctx.$marked && id) {\n\t\t\t\tthis.view.addCss(id, \"webix_drag_over\");\n\t\t\t\tctx.$marked = id;\n\n\t\t\t\tlet extra;\n\t\t\t\tif (this.view.getFirstId() == id) extra = \"webix_scheduler_dnd_1\";\n\t\t\t\telse if (this.view.getLastId() == id) extra = \"webix_scheduler_dnd_n\";\n\n\t\t\t\tif (extra) {\n\t\t\t\t\twebix.html.addCss(this.view.$view, extra, true);\n\t\t\t\t\tctx.$extra = extra;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tlocate: function(e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst pos = webix.html.pos(e);\n\n\t\t\tpos.x -= ctx.offset.x;\n\t\t\tpos.y -= ctx.offset.y;\n\n\t\t\treturn (\n\t\t\t\tMath.min(\n\t\t\t\t\tMath.floor(pos.y / this.view.type.height),\n\t\t\t\t\tthis.view.config.yCount - 1\n\t\t\t\t) *\n\t\t\t\t\tthis.view.config.xCount +\n\t\t\t\tMath.min(\n\t\t\t\t\tMath.floor(pos.x / this.view.type.width),\n\t\t\t\t\tthis.view.config.xCount - 1\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t},\n\tcommon\n);\n\nconst multiday = webix.extend(\n\t{\n\t\tmode: \"multiday\",\n\t},\n\tmonth\n);\n\nconst more = webix.extend(\n\t{\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst id = this.view.locate(e);\n\t\t\tif (id) {\n\t\t\t\tconst ctx = this.getContext();\n\t\t\t\tconst node = this.view.getItemNode(id).children[0];\n\t\t\t\twebix.extend(ctx, { from: this, id }, true);\n\n\t\t\t\tctx.event = this.master.Events.getItem(id);\n\t\t\t\tctx.start = this.master.ID;\n\n\t\t\t\tthis.setDragOffset(node, target, e);\n\n\t\t\t\tif (!this.master.app.callEvent(\"app:beforedrag\", [ctx, e])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst drag_container = document.createElement(\"DIV\");\n\n\t\t\t\tdrag_container.style.width = ctx.width + \"px\";\n\t\t\t\tdrag_container.style.height = ctx.height + \"px\";\n\n\t\t\t\tdrag_container.appendChild(node.cloneNode(true));\n\t\t\t\tdrag_container.className =\n\t\t\t\t\ttarget.className + \" webix_drag_zone webix_drag_event\";\n\n\t\t\t\tdocument.body.appendChild(drag_container);\n\n\t\t\t\tthis.master.HideWindow();\n\t\t\t\treturn drag_container;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t$dragDestroy: function(target, node) {\n\t\t\twebix.html.remove(node);\n\t\t\treturn false;\n\t\t},\n\t},\n\tmonth\n);\n\nconst units = webix.extend(\n\t{\n\t\tmode: \"units\",\n\t\t$drop: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\twebix.extend(ctx, { to: this });\n\t\t\tconst app = this.master.app;\n\n\t\t\tconst cancelDrop =\n\t\t\t\tctx.from.mode !== this.mode ||\n\t\t\t\t!app.callEvent(\"app:beforedrop\", [ctx, e]);\n\n\t\t\tif (cancelDrop) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst copy = ctx.$copy;\n\t\t\tconst date = this.getActualDate(this.master, copy);\n\t\t\tconst units = this.getEventUnits(ctx);\n\n\t\t\tif (date || units) {\n\t\t\t\tconst update = webix.extend(date || {}, units || {});\n\n\t\t\t\tif (ctx.event.id == \"0\") {\n\t\t\t\t\tif (ctx.$creation) {\n\t\t\t\t\t\tthis.State.selected = {\n\t\t\t\t\t\t\tid: \"0\",\n\t\t\t\t\t\t\tdate: ctx.event.start_date,\n\t\t\t\t\t\t\tend_date: update.end_date,\n\t\t\t\t\t\t\tunit: update.units,\n\t\t\t\t\t\t};\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.addEvent(ctx.event, update);\n\t\t\t\t\t}\n\t\t\t\t} else if (copy && !ctx.$resize) {\n\t\t\t\t\tthis.copyEvent(ctx.event, update);\n\t\t\t\t} else {\n\t\t\t\t\tthis.updateEvent(ctx.event, update);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tgetEventUnits: function(ctx) {\n\t\t\tconst sourceUnit = ctx.from.master.Unit.id + \"\";\n\t\t\tif (ctx.event.units) {\n\t\t\t\tconst currentUnits = ctx.event.units.split(\",\");\n\t\t\t\tconst targetUnit = this.master.Unit.id + \"\";\n\n\t\t\t\tif (targetUnit == sourceUnit || ctx.$resize) return;\n\n\t\t\t\tconst newUnits = currentUnits.filter(unit => unit != sourceUnit);\n\t\t\t\tif (currentUnits.indexOf(targetUnit) === -1) {\n\t\t\t\t\tnewUnits.push(targetUnit);\n\t\t\t\t}\n\n\t\t\t\treturn { units: newUnits.join(\",\") };\n\t\t\t} else {\n\t\t\t\treturn { units: sourceUnit };\n\t\t\t}\n\t\t},\n\t},\n\tday\n);\n\nconst multidayUnits = webix.extend(\n\t{\n\t\tmode: \"multidayUnits\",\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst event = locateEvent(e, target, \"webix_l_id\");\n\t\t\tif (event.id && event.id != \"$wsh_multi_more\") {\n\t\t\t\tconst ctx = this.getContext();\n\t\t\t\twebix.extend(ctx, event, true);\n\t\t\t\twebix.extend(ctx, { from: this, target }, true);\n\n\t\t\t\tctx.event = this.master.GetEvent(event.id);\n\t\t\t\tthis.setDragOffset(event.node, target, e);\n\n\t\t\t\tconst app = this.master.app;\n\t\t\t\tif (!app.callEvent(\"app:beforedrag\", [ctx, e])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst html = event.node.cloneNode(true);\n\t\t\t\thtml.className += \" webix_drag_zone webix_drag_event\";\n\t\t\t\thtml.style.width = \"100%\";\n\t\t\t\ttarget.firstChild.appendChild(html);\n\n\t\t\t\tctx.$copy = (e.ctrlKey || e.metaKey) && app.config.copypaste;\n\t\t\t\tif (!ctx.$copy) event.node.style.visibility = \"hidden\";\n\n\t\t\t\treturn html;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t$dragPos: function(pos) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst box = webix.html.offset(ctx.target);\n\t\t\tconst max = box.height - ctx.height;\n\n\t\t\tpos.x = ctx.x_diff;\n\t\t\tpos.y += ctx.y_offset - box.y;\n\n\t\t\tif (pos.y < 0) pos.y = 0;\n\t\t\telse if (pos.y > max) pos.y = max;\n\n\t\t\twebix.extend(ctx, pos, true);\n\t\t},\n\t\tgetActualDate: function(master, any) {\n\t\t\tconst date = master.State.date;\n\t\t\tconst ctx = this.getContext();\n\t\t\tif (!any && webix.Date.equal(date, ctx.event.start_date)) return null;\n\n\t\t\tconst duration = ctx.event.end_date - ctx.event.start_date;\n\t\t\treturn {\n\t\t\t\tstart_date: date,\n\t\t\t\tend_date: new Date(date.valueOf() + duration),\n\t\t\t};\n\t\t},\n\t},\n\tunits\n);\n\nconst timeline = webix.extend(\n\t{\n\t\tmode: \"timeline\",\n\t\tdragScroll: {\n\t\t\tdirection: \"xy\",\n\t\t},\n\t\t// here we locate the section, not the day\n\t\tlocate: function(e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst nscroll = this.view.getScrollState();\n\t\t\tconst height = this.view.$scope.Sections.count();\n\n\t\t\tconst y = this.getEventContext(e, ctx).y - ctx.offset.y + nscroll.y;\n\t\t\treturn Math.min(Math.floor(y / this.view.type.height), height - 1);\n\t\t},\n\t\t$dragCreate: function(target, e, pointer) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tctx.$touch = pointer === \"touch\";\n\t\t\tconst app = this.master.app;\n\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst event = locateEvent(e, target);\n\t\t\tif (event.id && event.id != \"$wsh_multi_more\") {\n\t\t\t\tconst node = event.node;\n\t\t\t\tconst evContext = this.getEventContext(e, ctx);\n\t\t\t\tconst moveMode = getMoveMode(node, evContext.x);\n\t\t\t\tconst scroll = this.view.getScrollState();\n\n\t\t\t\twebix.extend(\n\t\t\t\t\tctx,\n\t\t\t\t\t{\n\t\t\t\t\t\t...event,\n\t\t\t\t\t\tfrom: this,\n\t\t\t\t\t\toffset: webix.html.offset(target),\n\t\t\t\t\t\tmoveMode,\n\t\t\t\t\t\tstep: this.getStep(),\n\t\t\t\t\t\tdx: 0,\n\t\t\t\t\t\tscroll,\n\t\t\t\t\t\tx: evContext.x,\n\t\t\t\t\t\tt: parseInt(node.style.top),\n\t\t\t\t\t\tl: parseInt(node.style.left),\n\t\t\t\t\t\tw: parseInt(node.style.width),\n\t\t\t\t\t},\n\t\t\t\t\ttrue\n\t\t\t\t);\n\n\t\t\t\tctx.event = this.master.Events.getItem(event.id);\n\t\t\t\tctx.start = this.view.getIdByIndex(this.locate(e));\n\n\t\t\t\tthis.setDragOffset(node, target, e);\n\n\t\t\t\tif (!app.callEvent(\"app:beforedrag\", [ctx, e])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tif (ctx.moveMode === \"move\")\n\t\t\t\t\twebix.extend(\n\t\t\t\t\t\tctx,\n\t\t\t\t\t\tupdateDragScrollConfig.call(\n\t\t\t\t\t\t\tthis,\n\t\t\t\t\t\t\tthis.dragScroll,\n\t\t\t\t\t\t\tthis.view.$scope.Scales\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\n\t\t\t\tconst drag_container = document.createElement(\"DIV\");\n\t\t\t\tconst html = node.cloneNode(true);\n\n\t\t\t\thtml.style.position = \"static\";\n\t\t\t\tdrag_container.appendChild(html);\n\t\t\t\tdrag_container.className =\n\t\t\t\t\ttarget.className + \" webix_drag_zone webix_drag_event\";\n\t\t\t\tnode.parentNode.appendChild(drag_container);\n\n\t\t\t\tctx.$copy = (e.ctrlKey || e.metaKey) && app.config.copypaste;\n\t\t\t\tif (!ctx.$copy || ctx.event.id === \"0\" || ctx.moveMode !== \"move\")\n\t\t\t\t\tnode.style.visibility = \"hidden\";\n\n\t\t\t\twebix.callEvent(\"onClick\", [e]);\n\t\t\t\treturn drag_container;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tgetEventContext: function(e, ctx) {\n\t\t\tif (ctx.$touch) {\n\t\t\t\tif (e.changedTouches && !(e.touches && e.touches[0])) {\n\t\t\t\t\tconst t = e.changedTouches[0];\n\t\t\t\t\treturn { x: t.pageX, y: t.pageY };\n\t\t\t\t}\n\t\t\t\treturn e.time ? e : webix.env.touch.context(e);\n\t\t\t}\n\t\t\treturn { x: e.clientX, y: e.clientY };\n\t\t},\n\t\t$dragIn: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tctx.offset = ctx.offset || webix.html.offset(target);\n\n\t\t\tif (ctx.moveMode === \"move\" && !ctx.more) {\n\t\t\t\tDragScroll.reset(ctx);\n\t\t\t\tDragScroll.start(ctx, e);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\t\t$dragPos: function(pos) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst { x, t, l, w, scroll, step, moveMode } = ctx;\n\t\t\tconst nscroll = this.view.getScrollState();\n\n\t\t\tctx.dx = pos.x - x - (scroll ? scroll.x : 0) + nscroll.x;\n\n\t\t\tconst node = webix.DragControl.getNode();\n\t\t\tif (moveMode === \"move\") {\n\t\t\t\tconst offset = ctx.more ? { x: 0, y: 0 } : ctx.offset;\n\t\t\t\tpos.x += ctx.x_offset - offset.x + nscroll.x;\n\t\t\t\tpos.y += ctx.y_offset - offset.y + nscroll.y;\n\t\t\t} else if (moveMode === \"start\") {\n\t\t\t\tpos.x = Math.min(l + ctx.dx, l + w - step);\n\t\t\t\tpos.y = t;\n\t\t\t\tnode.childNodes[0].style.width = node.style.width = `${Math.max(\n\t\t\t\t\tstep,\n\t\t\t\t\tw - ctx.dx\n\t\t\t\t)}px`;\n\t\t\t} else if (moveMode === \"end\") {\n\t\t\t\tpos.x = l;\n\t\t\t\tpos.y = t;\n\t\t\t\tnode.childNodes[0].style.width = node.style.width = `${Math.max(\n\t\t\t\t\tw + ctx.dx,\n\t\t\t\t\tstep\n\t\t\t\t)}px`;\n\t\t\t}\n\t\t},\n\t\t$drop: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\twebix.extend(ctx, { to: this });\n\t\t\tconst app = this.master.app;\n\n\t\t\tconst cancelDrop =\n\t\t\t\tctx.from.mode !== this.mode ||\n\t\t\t\t!app.callEvent(\"app:beforedrop\", [ctx, e]);\n\n\t\t\tif (cancelDrop) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tconst data = this.getData(e);\n\t\t\tif (data) {\n\t\t\t\tif (ctx.event.id == \"0\") {\n\t\t\t\t\tthis.addEvent(ctx.event, data);\n\t\t\t\t} else if (ctx.$copy && ctx.moveMode === \"move\") {\n\t\t\t\t\tthis.copyEvent(ctx.event, data);\n\t\t\t\t} else this.updateEvent(ctx.event, data);\n\t\t\t}\n\t\t},\n\t\tgetData: function(e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst res = {};\n\t\t\tconst section = this.view.getIdByIndex(this.locate(e));\n\t\t\tconst { moveMode, dx, step } = ctx;\n\n\t\t\tconst time = Math.round(dx / (step || this.getStep()));\n\n\t\t\tif (section != ctx.start || (ctx.$copy && ctx.event.id !== \"0\") || time) {\n\t\t\t\tif (moveMode === \"move\") res.section = section;\n\t\t\t\tconst scales = this.view.$scope.Scales;\n\t\t\t\twebix.extend(res, updateEventDates(ctx.event, scales, moveMode, time));\n\t\t\t\treturn res;\n\t\t\t}\n\n\t\t\treturn null;\n\t\t},\n\t\tgetStep() {\n\t\t\tconst scales = this.view.$scope.Scales;\n\t\t\tlet step = scales.cellWidth;\n\t\t\tif (scales.precise) {\n\t\t\t\tconst nsc = smallerCount[scales.minUnit][1];\n\t\t\t\tstep = Math.round(step / (typeof nsc === \"number\" ? nsc : nsc()));\n\t\t\t}\n\t\t\treturn step;\n\t\t},\n\t},\n\tcommon\n);\n\nconst timelineMore = webix.extend(\n\t{\n\t\tmode: \"timeline\",\n\t\tdragScroll: null,\n\t\t$dragCreate: function(target, e, pointer) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tctx.$touch = pointer === \"touch\";\n\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst id = this.view.locate(e);\n\t\t\tif (id) {\n\t\t\t\tconst node = this.view.getItemNode(id).children[0];\n\n\t\t\t\twebix.extend(\n\t\t\t\t\tctx,\n\t\t\t\t\t{ from: this, id, moveMode: \"move\", more: true },\n\t\t\t\t\ttrue\n\t\t\t\t);\n\n\t\t\t\tctx.event = this.master.Events.getItem(id);\n\t\t\t\tctx.x = ctx.event.$x + parseInt(target.offsetParent.style.left);\n\t\t\t\tctx.start = this.master.ID;\n\n\t\t\t\tthis.setDragOffset(node, target, e);\n\n\t\t\t\tif (!this.master.app.callEvent(\"app:beforedrag\", [ctx, e])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tconst drag_container = document.createElement(\"DIV\");\n\n\t\t\t\tdrag_container.style.width = ctx.width + \"px\";\n\t\t\t\tdrag_container.style.height = ctx.height + \"px\";\n\n\t\t\t\tdrag_container.appendChild(node.cloneNode(true));\n\t\t\t\tdrag_container.className =\n\t\t\t\t\ttarget.className + \" webix_drag_zone webix_drag_event\";\n\n\t\t\t\tdocument.body.appendChild(drag_container);\n\n\t\t\t\tthis.master.HideWindow();\n\t\t\t\treturn drag_container;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t$dragDestroy: function(target, node) {\n\t\t\twebix.html.remove(node);\n\t\t\treturn false;\n\t\t},\n\t},\n\ttimeline\n);\n\nfunction updateEventDates(event, scales, mode, time) {\n\tconst obj = {};\n\n\tconst unit = scales.precise\n\t\t? smallerCount[scales.minUnit][0]\n\t\t: scales.minUnit;\n\tif (mode === \"start\" || mode === \"move\") {\n\t\tconst offsetDate = scales.precise\n\t\t\t? event.start_date\n\t\t\t: getUnitStart(unit, event.start_date);\n\t\tobj.start_date = addUnit(unit)(offsetDate, time);\n\t\tif (\n\t\t\tmode === \"start\" &&\n\t\t\twrongDates(obj.start_date, event.end_date, obj.all_day)\n\t\t)\n\t\t\tobj.start_date = addUnit(unit)(event.end_date, -1);\n\n\t\tif (webix.Date.equal(obj.start_date, event.start_date)) {\n\t\t\tdelete obj.start_date;\n\t\t}\n\t}\n\tif (mode === \"end\" || mode === \"move\") {\n\t\tconst us = getUnitStart(unit, event.end_date);\n\t\tconst offsetDate =\n\t\t\tscales.precise || webix.Date.equal(us, event.end_date)\n\t\t\t\t? event.end_date\n\t\t\t\t: addUnit(unit)(us, 1);\n\t\tobj.end_date = addUnit(unit)(offsetDate, time);\n\n\t\tif (\n\t\t\twrongDates(obj.start_date || event.start_date, obj.end_date, obj.all_day)\n\t\t)\n\t\t\tobj.end_date = addUnit(unit)(event.start_date, 1);\n\n\t\tif (webix.Date.equal(obj.end_date, event.end_date)) {\n\t\t\tdelete obj.end_date;\n\t\t}\n\t}\n\n\treturn obj;\n}\n\nfunction wrongDates(start, end, allDay) {\n\treturn allDay ? end < start : end <= start;\n}\n\nfunction getMoveMode(node, x) {\n\tconst rect = node.getBoundingClientRect();\n\tconst p = (x - rect.left) / rect.width;\n\tconst minWidth = webix.env.touch ? 400 : 200;\n\tconst delta = 0.2 / (rect.width > minWidth ? rect.width / minWidth : 1);\n\n\tif (\n\t\tp < delta &&\n\t\tnode.className.indexOf(\"webix_scheduler_event_break_left\") == -1\n\t)\n\t\treturn \"start\";\n\tif (\n\t\tp > 1 - delta &&\n\t\tnode.className.indexOf(\"webix_scheduler_event_break_right\") == -1\n\t)\n\t\treturn \"end\";\n\n\treturn \"move\";\n}\n\nfunction updateDragScrollConfig(ds, scales) {\n\tds.senseX = Math.round(scales.cellWidth * (webix.env.touch ? 1 : 0.5));\n\tds.senseY = Math.round(scales.cellHeight * (webix.env.touch ? 3 : 1));\n\treturn ds;\n}\n\nexport function switchCursor(e, view) {\n\tif (webix.DragControl.active) return;\n\tconst { id, node } = locateEvent(e, view);\n\tif (id) {\n\t\tconst mode = getMoveMode(node, e.clientX);\n\t\tnode.style.cursor = mode == \"move\" ? \"pointer\" : \"ew-resize\";\n\t}\n}\n\nconst modes = {\n\tday,\n\tmonth,\n\tmore,\n\tmultiday,\n\tunits,\n\tmultidayUnits,\n\ttimeline,\n\ttimelineMore,\n};\n","import HourscaleView from \"../common/hourscale\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { initDnD, locateEvent } from \"helpers/dnd\";\nimport { shrinkTo, isToday } from \"helpers/dates\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\nimport CopyPasteMixin from \"helpers/copypaste\";\n\nexport default class DayEventsView extends HourscaleView {\n\tconstructor(app, config) {\n\t\tsuper(app);\n\n\t\t// when dayevents is a part of week\n\t\tif (config) {\n\t\t\tthis.WeekDayNum = config.day;\n\t\t}\n\t}\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"dayList\",\n\t\t\tcss: \"webix_scheduler_day_events\",\n\t\t\tscroll: false,\n\t\t\tautoheight: true,\n\t\t\ttemplate: \"\",\n\t\t\ttype: {\n\t\t\t\theight: 42,\n\t\t\t\tcss: \"webix_scheduler_day_scale_item\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_day_event: e => this.ShowEvent(e),\n\t\t\t},\n\t\t\tonDblClick: {\n\t\t\t\twebix_scheduler_day_scale_item: (_e, h) => this.ShowNew(h),\n\t\t\t},\n\t\t};\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.List = this.$$(\"dayList\");\n\n\t\tSelectionMixin(this, \"scale\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.List.$setSize = function(x, y) {\n\t\t\tif (webix.ui.view.prototype.$setSize.call(this, x, y)) {\n\t\t\t\tthis.render();\n\t\t\t}\n\t\t};\n\n\t\tthis.minEventHeight = 62;\n\t\tthis.ParseHours();\n\n\t\tthis.on(this.State.$changes, \"readonly\", () => this.List.render());\n\n\t\tthis.List.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.List, \"day\");\n\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tif (this.app.config.copypaste && !webix.env.mobile && !compact)\n\t\t\tCopyPasteMixin(this, this.List);\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.Day = webix.Date.datePart(this.State.date, true);\n\n\t\t\tif (this.WeekDayNum > -1) {\n\t\t\t\tconst weekStart = this.data.start;\n\t\t\t\tthis.Day = webix.Date.add(weekStart, this.WeekDayNum, \"day\", true);\n\t\t\t}\n\n\t\t\tconst to = webix.Date.add(this.Day, 1, \"day\", true);\n\t\t\tthis.Events = this.FilterToday(this.Day, to);\n\n\t\t\tif (this._marker_update_interval)\n\t\t\t\tthis._marker_update_interval = clearInterval(\n\t\t\t\t\tthis._marker_update_interval\n\t\t\t\t);\n\n\t\t\tif (isToday(this.Day))\n\t\t\t\tthis._marker_update_interval = setInterval(() => {\n\t\t\t\t\tif (isToday(this.Day)) this.UpdateMarkerPosition();\n\t\t\t\t\telse {\n\t\t\t\t\t\twebix.html.remove(this._Marker);\n\t\t\t\t\t\tthis._Marker = this._marker_update_interval = clearInterval(\n\t\t\t\t\t\t\tthis._marker_update_interval\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}, 5 * 60 * 1000); // 5 minutes\n\n\t\t\tthis.List.render();\n\t\t}\n\t}\n\n\tGetEvent(id) {\n\t\tfor (let i = 0; i < this.Events.length; i++)\n\t\t\tif (this.Events[i].id == id) return this.Events[i];\n\t\treturn null;\n\t}\n\n\tFilterToday(value, to) {\n\t\tif (this.WeekDayNum > -1) {\n\t\t\treturn this.data.single.filter(ev => {\n\t\t\t\treturn ev.start_date < to && ev.end_date > value;\n\t\t\t});\n\t\t}\n\t\treturn this.data.single;\n\t}\n\n\tMarkToday() {\n\t\tif (this.Day && isToday(this.Day)) {\n\t\t\tconst marker = webix.html.create(\"div\", {\n\t\t\t\tclass: \"webix_scheduler_today_marker\",\n\t\t\t});\n\t\t\tthis._Marker = this.List.$view.firstChild.appendChild(marker);\n\t\t\tthis.UpdateMarkerPosition();\n\t\t} else {\n\t\t\tthis._Marker = null;\n\t\t}\n\t}\n\n\tUpdateMarkerPosition() {\n\t\tif (this._Marker) {\n\t\t\tconst current = new Date();\n\t\t\tconst time = current.getHours() * 60 + current.getMinutes();\n\t\t\tthis._Marker.style.top =\n\t\t\t\tMath.round((time * this.List.type.height) / 60) + \"px\";\n\t\t}\n\t}\n\n\tRenderEvents() {\n\t\tconst evs = this.Events;\n\t\tif (evs && evs.length) {\n\t\t\tthis.PrepareEvents();\n\t\t\tconst container = webix.html.create(\"div\", {\n\t\t\t\trole: \"presentation\",\n\t\t\t});\n\t\t\tcontainer.innerHTML = evs.map(i => this.ToHTML(i)).join(\"\");\n\t\t\tthis._DataObj = this.List.$view.firstChild.appendChild(container);\n\t\t\tthis.app.callEvent(\"events:rendered\", []);\n\t\t}\n\t\tthis.MarkToday();\n\t}\n\n\tPrepareEvents() {\n\t\tconst evs = this.Events;\n\t\tlet stack = [];\n\n\t\tfor (let i = 0; i < evs.length; i++) {\n\t\t\tconst ev = evs[i];\n\t\t\tev.$inner = false;\n\n\t\t\tlet orderSet = this.PruneStack(ev, stack);\n\n\t\t\tif (stack.length) {\n\t\t\t\tstack[stack.length - 1].$inner = true;\n\t\t\t}\n\n\t\t\tif (!orderSet) {\n\t\t\t\tif (stack.length) {\n\t\t\t\t\tev.$sorder = stack[stack.length - 1].$sorder + 1;\n\t\t\t\t\tev.$inner = false;\n\t\t\t\t} else {\n\t\t\t\t\tev.$sorder = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// insert new event into stack\n\t\t\tstack.splice(ev.$sorder, 0, ev);\n\t\t\tif (stack.length > (stack.max_count || 0)) {\n\t\t\t\tstack.max_count = stack.length;\n\t\t\t}\n\t\t}\n\n\t\tthis.SetPosition(stack, evs);\n\t}\n\n\t// returns true if new event was marked for inserting;\n\t// false if stack is empty or there is no suitable place for new event inside\n\tPruneStack(newEvent, stack) {\n\t\t// clean events from top of stack if new event starts after they end\n\t\twhile (\n\t\t\tstack.length &&\n\t\t\tthis.GetEventEndDate(stack[stack.length - 1]) <= newEvent.start_date\n\t\t) {\n\t\t\tstack.splice(stack.length - 1, 1);\n\t\t}\n\n\t\t// clean 1 event from within remaining stack if this event ends before new event starts\n\t\tfor (let j = 0; j < stack.length; j++) {\n\t\t\tif (this.GetEventEndDate(stack[j]) <= newEvent.start_date) {\n\t\t\t\tnewEvent.$sorder = stack[j].$sorder; // mark new event for this place in stack\n\t\t\t\tstack.splice(j, 1);\n\t\t\t\tnewEvent.$inner = true;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tSetPosition(stack, evs) {\n\t\t//scale start correction\n\t\tconst delta = this.List.getFirstId() * this.List.type.height;\n\n\t\tfor (let i = 0; i < evs.length; i++) {\n\t\t\tconst ev = evs[i];\n\n\t\t\tev.$count = stack.max_count;\n\t\t\tlet temp_width = Math.floor(this.List.$width / ev.$count);\n\t\t\tev.$left = ev.$sorder * temp_width;\n\t\t\tif (!ev.$inner) temp_width = temp_width * (ev.$count - ev.$sorder);\n\t\t\tev.$width = temp_width - 8;\n\n\t\t\tconst evCorrectedCopy = shrinkTo(\n\t\t\t\tthis.Day,\n\t\t\t\twebix.Date.add(this.Day, 1, \"day\", true)\n\t\t\t)(ev);\n\t\t\tconst sm =\n\t\t\t\tevCorrectedCopy.start_date.getHours() * 60 +\n\t\t\t\tevCorrectedCopy.start_date.getMinutes();\n\t\t\tconst em =\n\t\t\t\tevCorrectedCopy.end_date.getHours() * 60 +\n\t\t\t\t\tevCorrectedCopy.end_date.getMinutes() || 24 * 60;\n\n\t\t\tev.$top = Math.round((sm * this.List.type.height) / 60) - delta;\n\t\t\tev.$height = Math.max(\n\t\t\t\tthis.minEventHeight,\n\t\t\t\t((em - sm) * this.List.type.height) / 60\n\t\t\t);\n\t\t}\n\t}\n\n\tToHTML(obj) {\n\t\tconst content = this.EventTemplate(obj);\n\t\treturn this.EventTemplateStart(obj) + content + \"</div>\";\n\t}\n\n\tGetEventEndDate(ev) {\n\t\tlet end_date = ev.end_date;\n\t\tconst duration =\n\t\t\t(((ev.end_date - ev.start_date) / 60000) * this.List.type.height) / 60;\n\n\t\tif (duration < this.minEventHeight) {\n\t\t\tend_date = webix.Date.add(\n\t\t\t\tev.start_date,\n\t\t\t\tMath.ceil((this.minEventHeight / this.List.type.height) * 60),\n\t\t\t\t\"minute\",\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t\treturn end_date;\n\t}\n\n\tEventTemplateStart(obj) {\n\t\tconst css = `class=\"webix_scheduler_day_event ${\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \"webix_scheduler_event_selected\"\n\t\t\t\t: \"\"\n\t\t} ${obj.$past ? \"webix_scheduler_past_event\" : \"\"}\"`;\n\n\t\treturn `<div webix_e_id='${obj.id}' ${css} style='left:${\n\t\t\tobj.$left\n\t\t}px; top:${obj.$top}px; width:${obj.$width}px; height:${\n\t\t\tobj.$height\n\t\t}px; ${dayEventColor(obj)}'>`;\n\t}\n\n\tEventTemplate(obj) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst resizer = this.State.readonly\n\t\t\t? \"\"\n\t\t\t: \"<div class='webix_icon webix_scheduler_resizer' webix_resizer='true'></div>\";\n\n\t\treturn `<div class=\"webix_scheduler_inner_day\"><span class=\"webix_scheduler_event_name\">${obj.text ||\n\t\t\t_(\n\t\t\t\t\"(No title)\"\n\t\t\t)}</span><div class=\"webix_scheduler_event_time\">${webix.i18n.timeFormatStr(\n\t\t\tobj.start_date\n\t\t)} - ${webix.i18n.timeFormatStr(obj.end_date)}</div></div>${resizer}`;\n\t}\n\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.List.$view);\n\t\tif (event.id && event.id != \"0\") {\n\t\t\tconst obj = this.GetEvent(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns the target date for an event\n\t * @param {(string|number)} h - the ID of the hour segment of the main view\n\t * @returns {Date}\n\t */\n\tGetTargetDate(h) {\n\t\tconst date = webix.Date.copy(this.Day || this.State.date);\n\t\tif (h) date.setHours(h);\n\t\treturn date;\n\t}\n\n\t/**\n\t * Sets selected in the global reactive state to display a newly created event\n\t * @param {(string|number)} h - the ID of the hour segment of the main view\n\t */\n\tShowNew(h) {\n\t\tconst state = this.State;\n\t\tif (!state.readonly && !state.clipboard) {\n\t\t\tstate.selected = { id: \"0\", date: this.GetTargetDate(h) };\n\t\t}\n\t}\n\n\t/**\n\t * Updates selected in global reactive state\n\t * @param {(string|number)} id - the ID of the event\n\t * @param {Object} newEvent - the data of the new event that should be selected\n\t */\n\tUpdateSelection(id, newEvent) {\n\t\tif (this.State.selected) {\n\t\t\tnewEvent.id = id;\n\t\t\tthis.State.selected = getParams(newEvent);\n\t\t}\n\t}\n}\n","import MultiMoreView from \"../common/multimore\";\nimport SelectionMixin from \"helpers/selection\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\nimport CopyPasteMixin from \"helpers/copypaste\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\n\nexport default class MultidayEventList extends MultiMoreView {\n\tconfig() {\n\t\tconst ui = super.config();\n\n\t\tui.cols[1] = {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"multiDayList\",\n\t\t\tautoheight: true,\n\t\t\tscroll: false,\n\t\t\tcss: \"webix_scheduler_multilist\",\n\t\t\ttype: {\n\t\t\t\theight: 36,\n\t\t\t\ttemplate: (obj, common) => this.EventTemplate(obj, common),\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_multiday_event: (e, id, node) =>\n\t\t\t\t\tthis.ShowEvent(id, node),\n\t\t\t},\n\t\t};\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tsuper.init();\n\n\t\tthis._DataObj = this.List.$view.firstChild;\n\t\tSelectionMixin(this, \"multi\", true);\n\n\t\tthis.MoreIcon = this.$$(\"more\");\n\t\tthis._moreBtn = {\n\t\t\tid: \"$wsh_multi_more\",\n\t\t\t$css: \"webix_scheduler_multi_more\",\n\t\t};\n\n\t\tthis.on(this.$$(\"multiDayList\"), \"onAfterRender\", () => {\n\t\t\tthis.app.callEvent(\"events:rendered\", []);\n\t\t});\n\n\t\tif (this.app.config.copypaste && !webix.env.mobile) {\n\t\t\tEditRecurringMixin(this);\n\t\t\tCopyPasteMixin(this, this.List, { multi: true });\n\t\t}\n\t}\n\n\turlChange() {\n\t\tconst data = this.getParam(\"data\");\n\t\tif (data) {\n\t\t\tthis.LimitData(data.multi);\n\t\t\tthis.List.clearAll();\n\t\t\tthis.List.parse(data.multi);\n\t\t}\n\t}\n\n\tEventTemplate(obj, common) {\n\t\tconst height = common.height - 8;\n\t\tconst size = `height:${height}px; line-height:${height}px; width:calc(100% - 5px);`;\n\t\tconst color = obj.id !== \"$wsh_multi_more\" ? dayEventColor(obj) : \"\";\n\t\tconst css = this.GetStyle(obj);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"${size} ${color}\">\n\t\t\t\t\t${obj.text || _(\"(No title)\")}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj) {\n\t\tlet css = \"webix_scheduler_multiday_event\";\n\t\tif (obj.id == \"$wsh_multi_more\") return css;\n\n\t\tconst date = this.State.date;\n\t\tconst end =\n\t\t\t!obj.all_day && !webix.Date.timePart(obj.end_date)\n\t\t\t\t? webix.Date.add(obj.end_date, -1, \"day\", true)\n\t\t\t\t: obj.end_date;\n\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tcss += obj.$past ? \" webix_scheduler_past_event\" : \"\";\n\n\t\tif (obj.start_date < date) css += \" webix_scheduler_event_break_left\";\n\t\tif (end >= webix.Date.add(date, 1, \"day\", true))\n\t\t\tcss += \" webix_scheduler_event_break_right\";\n\n\t\treturn css;\n\t}\n\n\tLimitData(data) {\n\t\tif (data.length > this.maxVisibleLines) {\n\t\t\tconst excess = data.length - 2;\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis._moreBtn.text = `${excess} ${_(\"more\")}`;\n\n\t\t\tif (this._expandState === \"down\") {\n\t\t\t\tthis._reserve = data.splice(2, excess, this._moreBtn);\n\t\t\t} else {\n\t\t\t\tthis._reserve = data.slice(2);\n\t\t\t}\n\n\t\t\tthis.SetMoreIcon(this._expandState);\n\t\t\tthis._reserveIds = this._reserve.map(d => d.id);\n\t\t} else {\n\t\t\tthis.SetMoreIcon();\n\t\t}\n\t}\n\n\tWrapData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\t\t\tthis._expandState = \"down\";\n\n\t\t\tconst height =\n\t\t\t\tthis.List.$height -\n\t\t\t\t(this._reserveIds.length - 1) * this.List.type.height;\n\t\t\tthis.Animate(\"down\", height, () => {\n\t\t\t\tthis.List.add(this._moreBtn);\n\t\t\t\tthis.List.remove(this._reserveIds);\n\t\t\t});\n\t\t}\n\t}\n\n\tExpandData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\t\t\tthis._expandState = \"up\";\n\n\t\t\tthis.Animate(\"up\");\n\n\t\t\tthis.List.remove(\"$wsh_multi_more\");\n\t\t\tthis.List.parse(this._reserve);\n\t\t}\n\t}\n\n\t// height change and delay for animation\n\tAnimate(mode, height, handler) {\n\t\tthis.List.$view.style.transition = \"height 150ms\";\n\t\tif (height) this.List.$view.style.height = `${height}px`;\n\n\t\tsetTimeout(() => {\n\t\t\tif (handler) handler();\n\n\t\t\tthis.List.$view.style.transition = \"\";\n\t\t\tthis._inAnimation = false;\n\t\t\tthis.SetMoreIcon(mode);\n\t\t}, 150);\n\t}\n\n\tSetMoreIcon(mode) {\n\t\tif (!mode) {\n\t\t\tthis.MoreIcon.setHTML(\"\");\n\t\t} else {\n\t\t\tthis._expandState = mode;\n\n\t\t\tconst tooltip = mode === \"up\" ? \"Collapse\" : \"Expand\";\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.MoreIcon.setHTML(\n\t\t\t\t`<div class=\"webix_scheduler_more_icon webix_icon wxi-angle-${mode}\" webix_tooltip=\"${_(\n\t\t\t\t\t`${tooltip} all-day events`\n\t\t\t\t)}\"><div>`\n\t\t\t);\n\t\t}\n\t}\n\n\tShowEvent(id, node) {\n\t\tif (id === \"$wsh_multi_more\") {\n\t\t\tthis.ExpandData();\n\t\t} else {\n\t\t\tconst obj = this.List.getItem(id);\n\t\t\tconst sel = getParams(obj);\n\t\t\tsel.node = node;\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns the data object of an event\n\t * @param {(string|number)} id\n\t * @returns {Object}\n\t */\n\tGetEvent(id) {\n\t\treturn this.List.getItem(id);\n\t}\n\n\t/**\n\t * Returns the target date for an event\n\t * @returns {Date}\n\t */\n\tGetTargetDate() {\n\t\treturn this.State.date;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport MultidayEventList from \"./multiday\";\nimport DayEventsView from \"./events\";\nimport HourscaleView from \"../common/hourscale\";\nimport { isMultiDay } from \"helpers/dates\";\n\nexport default class DayView extends JetView {\n\tconfig() {\n\t\tconst header = {\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"header\",\n\t\t\tcss: \"webix_scheduler_day_header\",\n\t\t\theight: 32,\n\t\t\ttemplate: obj => {\n\t\t\t\treturn obj.date ? webix.Date.dateToStr(\"%l\")(obj.date) : \"\";\n\t\t\t},\n\t\t};\n\n\t\tconst config = {\n\t\t\tcss: \"webix_scheduler_day\",\n\t\t\trows: [\n\t\t\t\theader,\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"multi\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\tcols: [MultidayEventList],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"scroll\",\n\t\t\t\t\tview: \"scrollview\",\n\t\t\t\t\tcss: \"webix_scheduler_day_scroll\",\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tcols: [HourscaleView, DayEventsView],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn config;\n\t}\n\n\tinit() {\n\t\tconst state = this.app.getState();\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\n\t\tthis.on(state.$changes, \"selected\", v => {\n\t\t\tif (v && !state.clipboard) this.ScrollScale(v);\n\t\t});\n\t}\n\n\tRefreshData(value) {\n\t\tthis.$$(\"header\").setValues({ date: value });\n\n\t\tthis.GetDay(value).then(data => {\n\t\t\t// this.app will be null if compact trigger was called in main.js\n\t\t\tif (this.app) this.setParam(\"data\", data, true);\n\n\t\t\tif (data.multi.length) {\n\t\t\t\tthis.$$(\"multi\").show();\n\t\t\t} else this.$$(\"multi\").hide();\n\t\t});\n\t}\n\n\tGetDay(date) {\n\t\tconst end = webix.Date.add(date, 1, \"day\", true);\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(date, end)\n\t\t\t.then(evs => {\n\t\t\t\tconst multi = [],\n\t\t\t\t\tsingle = [];\n\t\t\t\tevs.forEach(ev => {\n\t\t\t\t\tif (isMultiDay(ev)) {\n\t\t\t\t\t\tmulti.push(ev);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsingle.push(ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn { multi, single };\n\t\t\t});\n\t}\n\n\tScrollScale(v) {\n\t\tif (v.id === \"0\" && !v.date) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst y = (new Date().getHours() + 2) * 40;\n\t\t\t\tthis.$$(\"scroll\").scrollTo(0, y);\n\t\t\t}, 100);\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class CalendarView extends JetView {\n\tconfig() {\n\t\tthis.Events = {};\n\n\t\treturn {\n\t\t\tview: \"calendar\",\n\t\t\tlocalId: \"calendar\",\n\t\t\tevents: (day, isOutside) => this.MarkEvent(day, isOutside),\n\t\t\ticons: false,\n\t\t\tnavigation: false,\n\t\t\tmonthHeader: false,\n\t\t\tskipEmptyWeeks: true,\n\t\t\twidth: 0,\n\t\t\theight: 410,\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.Calendar = this.getRoot();\n\t\tthis.Calendar.attachEvent(\"onAfterDateSelect\", date => {\n\t\t\tthis.app.getState().date = webix.Date.dayStart(date);\n\t\t});\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) this.RefreshData();\n\t}\n\n\tRefreshData() {\n\t\tlet { start, weeks, data } = this.data;\n\t\tconst end = webix.Date.add(start, weeks, \"week\", true);\n\n\t\tthis.Events = {};\n\n\t\twhile (start < end) {\n\t\t\tconst next = webix.Date.add(start, 1, \"day\", true);\n\t\t\tfor (let i = 0; i < data.length; i++)\n\t\t\t\tif (\n\t\t\t\t\t(data[i].all_day\n\t\t\t\t\t\t? data[i].end_date >= start\n\t\t\t\t\t\t: data[i].end_date > start) &&\n\t\t\t\t\tdata[i].start_date < next\n\t\t\t\t)\n\t\t\t\t\tthis.Events[start.valueOf()] = true;\n\t\t\tstart = next;\n\t\t}\n\n\t\tthis.Calendar.setValue(this.app.getState().date);\n\t}\n\n\t// adds dots to days with events\n\tMarkEvent(day, isOutside) {\n\t\tlet css = \"\";\n\n\t\tif (!isOutside) css += webix.Date.isHoliday(day) || \"\";\n\t\tif (this.Events[day.valueOf()]) css += \" webix_cal_day_with_event\";\n\n\t\treturn css;\n\t}\n}\n","/* eslint-disable indent */\n\nimport { JetView } from \"webix-jet\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { daysBetweenInclusive } from \"helpers/dates\";\nimport { marker, dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\nimport { initDnD } from \"helpers/dnd\";\n\nexport default class MoreWindowView extends JetView {\n\tconstructor(app, c) {\n\t\tsuper(app);\n\t\tthis.Events = c.events;\n\t\tthis.drag = webix.isUndefined(c.drag) ? true : c.drag;\n\t}\n\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn {\n\t\t\tview: \"popup\",\n\t\t\twidth: 266,\n\t\t\tpadding: 8,\n\t\t\tminHeight: 70,\n\t\t\trelative: \"right\",\n\t\t\tbody: {\n\t\t\t\tview: \"list\",\n\t\t\t\tcss: \"webix_scheduler_more_list\",\n\t\t\t\tborderless: true,\n\t\t\t\tautoheight: true,\n\t\t\t\tyCount: 3,\n\t\t\t\ttooltip: {\n\t\t\t\t\ttemplate: \"\",\n\t\t\t\t},\n\t\t\t\tonClick: {\n\t\t\t\t\twebix_scheduler_month_event: (e, id) => this.ShowEvent(id),\n\t\t\t\t\twebix_scheduler_month_event_single: (e, id) => this.ShowEvent(id),\n\t\t\t\t},\n\t\t\t\ttype: {\n\t\t\t\t\theight: 56,\n\t\t\t\t\ttemplate: (o, c) => this.MoreTemplate(o, c, _),\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.Win = view;\n\n\t\tEditRecurringMixin(this);\n\n\t\tif (this.drag) initDnD.call(this, view.getBody(), \"more\", true);\n\t}\n\n\tMoreTemplate(obj, _c, _) {\n\t\tconst i18n = webix.i18n;\n\t\tconst single = !daysBetweenInclusive(\n\t\t\tobj.start_date,\n\t\t\tobj.all_day ? webix.Date.add(obj.end_date, 1, \"day\", true) : obj.end_date\n\t\t);\n\t\tconst style = single ? \"\" : dayEventColor(obj);\n\n\t\tconst oneDay =\n\t\t\t!single && this.webix.Date.equal(obj.start_date, obj.end_date);\n\n\t\tlet css = `webix_scheduler_month_event${single ? \"_single\" : \"\"}`;\n\t\tif (obj.$past) css += \" webix_scheduler_past_event\";\n\n\t\treturn `\n\t\t\t<div\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"${style}\"\n\t\t\t>\n\t\t\t\t${single ? marker(obj) : \"\"}\n\t\t\t\t<div webix_tooltip=\"${obj.text}\" class=\"webix_event_text\">${obj.text ||\n\t\t\t_(\"(No title)\")}</div>\n\t\t\t\t<div class=\"webix_event_time\">\n\t\t\t\t\t${this.DayFormatStr(obj.start_date)}\n\t\t\t\t\t${\n\t\t\t\t\t\toneDay\n\t\t\t\t\t\t\t? \"\"\n\t\t\t\t\t\t\t: `${i18n.timeFormatStr(obj.start_date)} -\n\t\t\t\t\t\t${single ? \"\" : \" \" + this.DayFormatStr(obj.end_date)}\n\t\t\t\t\t\t${i18n.timeFormatStr(obj.end_date)}`\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tDayFormatStr(date) {\n\t\treturn webix.Date.dateToStr(\"%F %j\")(date);\n\t}\n\n\tShowEvent(id) {\n\t\tconst obj = this.Events.getItem(id);\n\t\tthis.app.getState().selected = getParams(obj);\n\t\tthis.HideWindow();\n\t}\n\n\tShowWindow(id, node, data) {\n\t\tif (this.ID === id && this.Win.isVisible()) return this.Win.hide();\n\n\t\tthis.ID = id;\n\t\tdata = data.map(v => this.Events.getItem(v));\n\n\t\tconst list = this.Win.getBody();\n\t\tlist.clearAll();\n\t\tlist.parse(data);\n\n\t\tthis.Win.show(node);\n\t}\n\n\tHideWindow() {\n\t\tthis.Win.hide();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport MoreWindowView from \"./more\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { marker, dayEventColor, templateStart } from \"helpers/templates\";\nimport { initDnD, locateEvent } from \"helpers/dnd\";\nimport { daysBetweenInclusive, isToday } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\nimport CopyPasteMixin from \"helpers/copypaste\";\n\nexport default class MonthEventsView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"dataview\",\n\t\t\tcss: \"webix_scheduler_calendar\",\n\t\t\tprerender: true,\n\t\t\txCount: 7,\n\t\t\tyCount: 5,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tscroll: false,\n\t\t\ttooltip: {\n\t\t\t\ttemplate: \"\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_cal_date: (_ev, id) => this.ShowDay(id),\n\t\t\t\twebix_scheduler_month_event: ev => this.ShowEvent(ev),\n\t\t\t\twebix_scheduler_month_event_single: ev => this.ShowEvent(ev),\n\t\t\t\twebix_scheduler_more: (_ev, id) => this.ShowMore(id),\n\t\t\t},\n\t\t\tonDblClick: {\n\t\t\t\twebix_cal_day: (_e, id) => this.ShowNew(id),\n\t\t\t},\n\t\t\ttype: {\n\t\t\t\theight: \"auto\",\n\t\t\t\twidth: \"auto\",\n\t\t\t\ttemplate: (o, c) => this.CalendarTemplate(o, c),\n\t\t\t\ttemplateStart,\n\t\t\t\theaderHeight: 32,\n\t\t\t\teventHeight: 28,\n\t\t\t\tpadding: 8,\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.State = this.app.getState();\n\t\tthis.Calendar = view;\n\t\tview.type.master = this.Calendar;\n\n\t\tSelectionMixin(this, \"month\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.Events = new webix.DataCollection({});\n\t\tthis.MoreWindow = this.ui(\n\t\t\tnew (this.app.dynamic(MoreWindowView))(this.app, {\n\t\t\t\tevents: this.Events,\n\t\t\t})\n\t\t);\n\n\t\tview.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.Calendar, \"month\");\n\n\t\tif (this.app.config.copypaste && !webix.env.mobile)\n\t\t\tCopyPasteMixin(this, view);\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\", true); // IE hack\n\t\tif (this.data) this.RefreshData();\n\t}\n\n\tCalendarTemplate(obj) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tlet html = `<span class=\"webix_cal_date\">${obj.date.getDate()}</span>`;\n\t\tif (obj.$more && obj.$more.length) {\n\t\t\thtml += `<div class=\"webix_scheduler_more\">${obj.$more.length} ${_(\n\t\t\t\t\"more\"\n\t\t\t)}</div>`;\n\t\t}\n\t\treturn html;\n\t}\n\n\tGetDayCss(day, month) {\n\t\tlet css = \"webix_cal_day\";\n\t\tif (isToday(day)) css += \" webix_cal_today\";\n\t\tif (day.getMonth() != month) css += \" webix_cal_outside\";\n\t\telse css += \" \" + (webix.Date.isHoliday(day) || \"\");\n\t\treturn css;\n\t}\n\n\tGetMonthData() {\n\t\tconst data = [];\n\t\tconst { start, weeks } = this.data;\n\t\tconst month = webix.Date.add(start, 1, \"week\", true).getMonth();\n\n\t\tlet day = webix.Date.copy(start);\n\t\tfor (let i = 0; i < weeks * 7; i++) {\n\t\t\tconst obj = {\n\t\t\t\tdate: webix.Date.copy(day),\n\t\t\t\t$css: this.GetDayCss(day, month),\n\t\t\t};\n\n\t\t\tif ((i + 1) % 7 === 0) obj.right = true;\n\t\t\tif (i >= (weeks - 1) * 7) obj.bottom = true;\n\n\t\t\tdata.push(obj);\n\t\t\twebix.Date.add(day, 1, \"day\");\n\t\t}\n\t\treturn data;\n\t}\n\n\tRenderEvents() {\n\t\t// No Events, No Render\n\t\tif (!this.Events.count() || !this.Calendar.count()) return;\n\n\t\tconst container = webix.html.create(\"div\", {\n\t\t\trole: \"presentation\",\n\t\t\tclass: \"webix_scheduler_month_events\",\n\t\t});\n\n\t\tconst { start } = this.data;\n\t\tconst type = this.Calendar.type;\n\t\tconst maxLines = Math.floor(\n\t\t\t(type.height - type.headerHeight + type.padding - 2) /\n\t\t\t\t(type.eventHeight + type.padding)\n\t\t);\n\n\t\tlet wStart = webix.Date.copy(start);\n\t\tlet wEnd = webix.Date.add(wStart, 1, \"week\", true);\n\n\t\tlet html = \"\";\n\t\tlet cache = {};\n\t\tconst me = this.GetTargetDate(this.Calendar.getLastId());\n\t\tconst ms = this.GetTargetDate(this.Calendar.getFirstId());\n\t\tthis.Calendar.data.each(function(day, dayIndex) {\n\t\t\t// next week\n\t\t\tif (day.date >= wEnd) {\n\t\t\t\tcache = {};\n\t\t\t\twStart = wEnd;\n\t\t\t\twEnd = webix.Date.add(wStart, 1, \"week\", true);\n\t\t\t}\n\n\t\t\tconst more = [];\n\t\t\tconst dayHTML = [];\n\t\t\tthis.Events.data.each(function(ev) {\n\t\t\t\tconst id = ev.id;\n\n\t\t\t\t// will not be this week\n\t\t\t\tif (\n\t\t\t\t\tev.start_date >= wEnd ||\n\t\t\t\t\tev.end_date < wStart ||\n\t\t\t\t\t(!ev.all_day && webix.Date.equal(ev.end_date, wStart))\n\t\t\t\t)\n\t\t\t\t\treturn;\n\n\t\t\t\t// if already processed - check and skip\n\t\t\t\tif (!webix.isUndefined(cache[id])) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(day.date <= ev.end_date && ev.all_day) ||\n\t\t\t\t\t\tday.date < ev.end_date\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (cache[id] >= maxLines) {\n\t\t\t\t\t\t\tmore.push(id);\n\t\t\t\t\t\t} else dayHTML[cache[id]] = \"\";\n\t\t\t\t\t} else delete cache[id];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// today\n\t\t\t\tif (\n\t\t\t\t\tev.start_date < webix.Date.add(day.date, 1, \"day\", true) &&\n\t\t\t\t\tev.end_date >= day.date\n\t\t\t\t) {\n\t\t\t\t\tlet index = 0;\n\t\t\t\t\t// search for the first available index\n\t\t\t\t\twhile (!webix.isUndefined(dayHTML[index])) index++;\n\n\t\t\t\t\tcache[id] = index;\n\t\t\t\t\tif (index >= maxLines) return more.push(id);\n\n\t\t\t\t\tconst config = { ms, me };\n\t\t\t\t\tconfig.single = this.IsSingleDay(ev);\n\n\t\t\t\t\tconfig.length = 1;\n\t\t\t\t\tif (!config.single) {\n\t\t\t\t\t\tconfig.es = ev.start_date;\n\t\t\t\t\t\tconfig.ee =\n\t\t\t\t\t\t\t!ev.all_day && !webix.Date.timePart(ev.end_date)\n\t\t\t\t\t\t\t\t? webix.Date.add(ev.end_date, -1, \"day\", true)\n\t\t\t\t\t\t\t\t: ev.end_date;\n\n\t\t\t\t\t\tconfig.length += daysBetweenInclusive(\n\t\t\t\t\t\t\t(config.ls = new Date(Math.max(wStart, config.es))),\n\t\t\t\t\t\t\t(config.le = new Date(Math.min(wEnd - 1, config.ee)))\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tconfig.index = dayIndex;\n\t\t\t\t\tdayHTML[index] = this.ToHTML(ev, index, config);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tconst prevLength = day.$more && day.$more.length;\n\t\t\tday.$more = more;\n\t\t\tif (prevLength != more.length) this.Calendar.render(day.id, day, \"paint\");\n\n\t\t\thtml += dayHTML.join(\"\");\n\t\t}, this);\n\n\t\tcontainer.innerHTML = html;\n\t\tthis._DataObj = this.Calendar.$view.firstChild.appendChild(container);\n\t\tthis.app.callEvent(\"events:rendered\", []);\n\t}\n\n\tIsSingleDay(ev) {\n\t\tif (ev.all_day)\n\t\t\treturn !daysBetweenInclusive(\n\t\t\t\tev.start_date,\n\t\t\t\twebix.Date.add(ev.end_date, 1, \"day\", true)\n\t\t\t);\n\n\t\tlet len = daysBetweenInclusive(ev.start_date, ev.end_date);\n\n\t\tif (\n\t\t\tlen === 1 &&\n\t\t\twebix.Date.timePart(ev.start_date) &&\n\t\t\t!webix.Date.timePart(ev.end_date)\n\t\t)\n\t\t\tlen = 0;\n\n\t\treturn !len;\n\t}\n\n\tToHTML(obj, index, c) {\n\t\tconst type = this.Calendar.type;\n\t\tconst style = c.single ? \"\" : dayEventColor(obj);\n\t\tconst width = c.length * type.width - type.padding;\n\t\tconst height = type.eventHeight;\n\t\tconst pos = this.GetPosition(type, index, c.index);\n\n\t\tlet extra = \"\";\n\t\tif (c.single) {\n\t\t\textra =\n\t\t\t\tmarker(obj) +\n\t\t\t\t`<span class=\"webix_event_time\">${webix.i18n.timeFormatStr(\n\t\t\t\t\tobj.start_date\n\t\t\t\t)}</span>`;\n\t\t}\n\t\tconst css = this.GetStyle(obj, c);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\twebix_tooltip=\"${obj.text}\"\n\t\t\t\twebix_e_id=\"${obj.id}\"\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"height:${height}px;line-height:${height}px; width:${width}px; ${pos +\n\t\t\tstyle}\">\n\t\t\t\t\t${extra + (obj.text || _(\"(No title)\"))}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj, c) {\n\t\tlet css = `webix_scheduler_month_event${c.single ? \"_single\" : \"\"}`;\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tcss += obj.$past ? \" webix_scheduler_past_event\" : \"\";\n\n\t\tif (!c.single) {\n\t\t\tif (c.es < c.ms && webix.Date.equal(c.ms, webix.Date.dayStart(c.ls)))\n\t\t\t\tcss += \" webix_scheduler_event_break_left\";\n\t\t\telse if (\n\t\t\t\tc.ee >= webix.Date.add(c.me, 1, \"day\", true) &&\n\t\t\t\twebix.Date.equal(c.me, webix.Date.dayStart(c.le))\n\t\t\t)\n\t\t\t\tcss += \" webix_scheduler_event_break_right\";\n\t\t}\n\t\treturn css;\n\t}\n\n\tGetPosition(type, index, dayIndex) {\n\t\tconst row = Math.floor(dayIndex / this.Calendar.config.xCount);\n\t\tconst col = dayIndex % this.Calendar.config.xCount;\n\n\t\treturn `\n\t\t\ttop:${row * type.height +\n\t\t\t\ttype.headerHeight +\n\t\t\t\tindex * (type.eventHeight + type.padding)}px;\n\t\t\tleft:${col * type.width}px;\n\t\t`;\n\t}\n\n\tRefreshData() {\n\t\tconst { data, weeks } = this.data;\n\n\t\tthis.Events.clearAll();\n\t\tthis.Events.parse(data);\n\t\tthis.Events.sort(function(a, b) {\n\t\t\tconst start_a = webix.Date.dayStart(a.start_date);\n\t\t\tconst start_b = webix.Date.dayStart(b.start_date);\n\n\t\t\tif (webix.Date.equal(start_a, start_b)) {\n\t\t\t\tconst days_a = daysBetweenInclusive(a.start_date, a.end_date);\n\t\t\t\tconst days_b = daysBetweenInclusive(b.start_date, b.end_date);\n\t\t\t\treturn days_b - days_a || a.start_date - b.start_date;\n\t\t\t}\n\t\t\treturn start_a - start_b;\n\t\t});\n\n\t\tconst monthData = this.GetMonthData();\n\n\t\tthis.Calendar.clearAll();\n\t\tif (this.Calendar.config.yCount != weeks) {\n\t\t\tthis.Calendar.define(\"yCount\", weeks);\n\t\t\tthis.Calendar.resize();\n\t\t}\n\t\tthis.Calendar.parse(monthData);\n\t}\n\n\tShowMore(id) {\n\t\tthis.MoreWindow.ShowWindow(\n\t\t\tid,\n\t\t\tthis.Calendar.getItemNode(id),\n\t\t\tthis.Calendar.getItem(id).$more || []\n\t\t);\n\t\treturn false;\n\t}\n\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.Calendar.$view);\n\t\tif (event.id && event.id != \"0\") {\n\t\t\tconst obj = this.Events.getItem(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tShowNew(id) {\n\t\tconst state = this.State;\n\t\tif (!state.readonly && !state.clipboard) {\n\t\t\tconst date = this.GetTargetDate(id);\n\t\t\tstate.selected = { id: \"0\", date };\n\t\t}\n\t}\n\n\tShowDay(id) {\n\t\tconst state = this.app.getState();\n\n\t\tstate.$batch({\n\t\t\tdate: this.GetTargetDate(id),\n\t\t\tmode: \"day\",\n\t\t});\n\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns the target date for an event\n\t * @param {(string|number)} id - the ID of the day in the calendar\n\t * @returns\n\t */\n\tGetTargetDate(id) {\n\t\treturn id ? this.Calendar.getItem(id).date : this.State.date;\n\t}\n\n\t/**\n\t * Returns the data object of an event\n\t * @param {(string|number)} id - the ID of the event\n\t * @returns {Object}\n\t */\n\tGetEvent(id) {\n\t\treturn this.Events.getItem(id);\n\t}\n\n\t/**\n\t * Updates selected in global reactive state\n\t * @param {(string|number)} id - the ID of the event\n\t * @param {Object} newEvent - the data of the new event that should be selected\n\t */\n\tUpdateSelection(id, newEvent) {\n\t\tif (this.State.selected) {\n\t\t\tnewEvent.id = id;\n\t\t\tthis.State.selected = getParams(newEvent);\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { templateStart } from \"helpers/templates\";\n\nexport default class MonthHeaderView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"dataview\",\n\t\t\tcss: \"webix_scheduler_calendar_header\",\n\t\t\txCount: 7,\n\t\t\tyCount: 1,\n\t\t\twidth: 0,\n\t\t\theight: 32,\n\t\t\tscroll: false,\n\t\t\ttype: {\n\t\t\t\theight: \"auto\",\n\t\t\t\twidth: \"auto\",\n\t\t\t\ttemplateStart,\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tview.type.master = view;\n\t\tview.parse(this.GetHeaderData());\n\t}\n\n\tGetHeaderData() {\n\t\tconst data = [];\n\t\tconst k = webix.Date.startOnMonday ? 1 : 0;\n\n\t\tfor (let i = 0; i < 7; i++)\n\t\t\tdata.push({ value: webix.i18n.calendar.dayShort[(k + i) % 7] });\n\n\t\tdata[data.length - 1][\"right\"] = true;\n\t\treturn data;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { events, timeStart } from \"helpers/templates\";\nimport { shrinkTo, isMultiDay } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MonthListView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst config = {\n\t\t\tview: \"list\",\n\t\t\ttype: {\n\t\t\t\theight: 50,\n\t\t\t\ttemplate: events(_),\n\t\t\t\ttimeStart: ev => this.TimeStart(ev),\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.ShowEvent(id),\n\t\t\t},\n\t\t};\n\n\t\treturn config;\n\t}\n\tinit() {\n\t\tthis.List = this.getRoot();\n\t\tthis.State = this.app.getState();\n\n\t\twebix.extend(this.List, webix.OverlayBox);\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) this.RefreshData();\n\t}\n\n\tRefreshData() {\n\t\tconst start = webix.Date.datePart(this.State.date, true);\n\t\tconst end = webix.Date.add(start, 1, \"day\", true);\n\t\tthis.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(start, end)\n\t\t\t.then(evs => {\n\t\t\t\tthis.List.clearAll();\n\t\t\t\tthis.List.parse(evs.map(shrinkTo(start, end)));\n\t\t\t\tthis.ToggleOverlay();\n\t\t\t});\n\t}\n\n\tToggleOverlay() {\n\t\tif (!this.List.count()) {\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.List.showOverlay(_(\"No Events\"));\n\t\t} else {\n\t\t\tthis.List.hideOverlay();\n\t\t}\n\t}\n\n\tShowEvent(id) {\n\t\tconst obj = this.List.getItem(id);\n\t\tthis.State.selected = getParams(obj);\n\t}\n\n\tTimeStart(ev) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (isMultiDay(ev)) return _(\"All Day\");\n\t\telse return timeStart(ev.start_date, ev.end_date);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport MonthListView from \"./list\";\nimport CalendarView from \"./compact\";\nimport MonthEventsView from \"./events\";\nimport MonthHeaderView from \"./header\";\n\nexport default class MonthView extends JetView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst views = compact\n\t\t\t? [CalendarView, MonthListView]\n\t\t\t: [MonthHeaderView, MonthEventsView];\n\n\t\treturn {\n\t\t\trows: views,\n\t\t};\n\t}\n\tinit() {\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tconst state = this.app.getState();\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\t}\n\tRefreshData(value) {\n\t\tlet start = webix.Date.monthStart(value);\n\t\tlet end = webix.Date.add(start, 1, \"month\", true);\n\n\t\tstart = webix.Date.weekStart(\n\t\t\tnew Date(start.getFullYear(), start.getMonth(), 1)\n\t\t);\n\t\tconst weeks = Math.ceil((end - start) / (24 * 60 * 60 * 1000) / 7);\n\t\tend = webix.Date.add(start, weeks, \"week\", true);\n\n\t\tthis.Data.getEvents(start, end).then(data => {\n\t\t\tif (this.app) this.setParam(\"data\", { start, weeks, data }, true);\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class BarView extends JetView {\n\tconfig() {\n\t\tconst active = webix.skin.$active;\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.getParam(\"state\", true);\n\n\t\treturn {\n\t\t\tview: \"toolbar\",\n\t\t\theight: active.barHeight,\n\t\t\telements: [\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\tlabel: _(\"Timeline scale\"),\n\t\t\t\t\tlabelWidth: 120,\n\t\t\t\t\twidth: 260,\n\t\t\t\t\tvalue: state.timelineMode,\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ id: \"day\", value: _(\"Day\") },\n\t\t\t\t\t\t{ id: \"week\", value: _(\"Week\") },\n\t\t\t\t\t\t{ id: \"month\", value: _(\"Month\") },\n\t\t\t\t\t],\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: v => {\n\t\t\t\t\t\t\tstate.timelineMode = v;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n}\n","import MoreWindowView from \"../month/more\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { initDnD } from \"helpers/dnd\";\n\nexport default class MoreView extends MoreWindowView {\n\tconfig() {\n\t\tconst ui = super.config();\n\n\t\tui.width = 360;\n\t\tui.relative = \"bottom\";\n\n\t\treturn ui;\n\t}\n\n\tinit(view) {\n\t\tthis.Win = view;\n\n\t\tEditRecurringMixin(this);\n\n\t\t// set dnd mode to timeline to allow dnd between more popup and timeline chart\n\t\tinitDnD.call(this, view.getBody(), \"timelineMore\", true);\n\t}\n\n\t/**\n\t * Show the popup with extra events\n\t * @param {(string|number)} id - the ID of a section\n\t * @param {HTMLElement} node - the HTML element of the section from left part of the timeline chart\n\t * @param {Array<Object>} data - an array of events\n\t * @returns\n\t */\n\tShowWindow(id, node, data) {\n\t\tif (this.ID === id && this.Win.isVisible()) return this.Win.hide();\n\n\t\tthis.ID = id;\n\t\tdata = data.map(v => this.Events.getItem(v));\n\n\t\tconst list = this.Win.getBody();\n\t\tlist.clearAll();\n\t\tlist.parse(data);\n\n\t\tthis.Win.show(node, { x: node.clientWidth }); // here we position the popup to the left of the node as well as bottom\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport {\n\tsmallerCount,\n\tgetUnitStart,\n\tgrid,\n\tupdateTask,\n\taddUnit,\n} from \"@xbs/webix-gantt-lib\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { initDnD, switchCursor, locateEvent } from \"helpers/dnd\";\nimport { getParams } from \"helpers/recurring\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport MoreWindowView from \"./more\";\nimport CopyPasteMixin from \"helpers/copypaste\";\n\nexport default class ChartView extends JetView {\n\tconfig() {\n\t\tconst height = this.GetSectionHeight();\n\t\tconst compact = this.getParam(\"compact\", true);\n\n\t\treturn {\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"treetable\",\n\t\t\t\t\tlocalId: \"sections\",\n\t\t\t\t\tcss: \"webix_scheduler_timeline_sections\",\n\t\t\t\t\twidth: compact ? 80 : 200,\n\t\t\t\t\theader: false,\n\t\t\t\t\tscroll: \"y\",\n\t\t\t\t\trowHeight: height,\n\t\t\t\t\tscrollAlignY: false,\n\t\t\t\t\tcolumns: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: \"text\",\n\t\t\t\t\t\t\theader: \"\",\n\t\t\t\t\t\t\tfillspace: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"list\",\n\t\t\t\t\tlocalId: \"list\",\n\t\t\t\t\ttype: { height, template: \"\" },\n\t\t\t\t\tcss: `webix_scheduler_timeline${\n\t\t\t\t\t\twebix.env.touch ? \"_touch\" : \"\"\n\t\t\t\t\t}_bars`,\n\t\t\t\t\tonClick: {\n\t\t\t\t\t\twebix_scheduler_timeline_event: e => this.ShowEvent(e),\n\t\t\t\t\t},\n\t\t\t\t\tonDblClick: {\n\t\t\t\t\t\twebix_list_item: (e, id) => this.ShowNew(e, id),\n\t\t\t\t\t},\n\t\t\t\t\ttooltip: {\n\t\t\t\t\t\ttemplate: \"\",\n\t\t\t\t\t},\n\t\t\t\t\tscroll: \"xy\",\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.Tree = this.$$(\"sections\");\n\t\tthis.Bars = this.$$(\"list\");\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.InnerState = this.getParam(\"innerState\", true);\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tthis.Events = new webix.DataCollection({\n\t\t\tscheme: {\n\t\t\t\t$change: obj => this.RefreshTask(obj.id),\n\t\t\t},\n\t\t});\n\n\t\tthis.MoreWindow = this.ui(\n\t\t\tnew (this.app.dynamic(MoreWindowView))(this.app, {\n\t\t\t\tevents: this.Events,\n\t\t\t})\n\t\t);\n\n\t\tSelectionMixin(this, \"month\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis._sectionsReady = this.Data.sections().then(data => {\n\t\t\tthis.Sections = data;\n\t\t\tthis.Tree.parse(data);\n\t\t\tthis.Bars.parse(data);\n\t\t});\n\n\t\tthis.HandleScroll();\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData()\n\t\t);\n\t\t// calendars\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData());\n\t\tthis.on(this.State.$changes, \"active\", (_v, o) => o && this.RefreshData());\n\n\t\tinitDnD.call(this, this.Bars, \"timeline\");\n\t\tthis._mousemove_handler = webix.event(this.Bars.$view, \"pointermove\", e => {\n\t\t\tif (e.pointerType == \"mouse\") switchCursor(e, this.Bars.$view);\n\t\t});\n\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tif (this.app.config.copypaste && !webix.env.mobile && !compact)\n\t\t\tCopyPasteMixin(this, this.Bars);\n\t}\n\n\turlChange() {\n\t\tconst scales = (this.Scales = this.getParam(\"scales\", true));\n\t\tthis.DrawGrid(scales);\n\t\tthis.RefreshData(scales);\n\t}\n\n\tGetSectionHeight() {\n\t\tconst active = webix.skin.$active;\n\t\tthis._sectionSize = 5;\n\t\treturn (active.barHeight - active.borderWidth * 2) * this._sectionSize;\n\t}\n\n\t/**\n\t * Reloads data into timeline\n\t * @param {Object} scales - current chart scales\n\t */\n\tRefreshData(scales) {\n\t\tif (!scales) scales = this.Scales;\n\t\twebix.promise\n\t\t\t.all([this._sectionsReady, this.Data.getEvents(scales.start, scales.end)])\n\t\t\t.then(res => {\n\t\t\t\tthis.ClearCollections();\n\n\t\t\t\tthis.Events.parse(res[1]);\n\t\t\t\tthis.RenderEvents();\n\t\t\t});\n\t}\n\n\tClearCollections() {\n\t\tthis.Events.clearAll();\n\t\tthis._processed = [];\n\t\tthis._lastRow = {};\n\t\tthis._moreEvents = {};\n\t}\n\n\t/**\n\t * Updates task object with new coordinates and allocates it to the correct position inside a section\n\t * @param {(string|number)} updID - the ID of an event\n\t */\n\tRefreshTask(updID) {\n\t\tconst t = this.GetEvent(updID);\n\n\t\tconst sectionIndex = indexOf(this.Sections.data.order, t.section);\n\t\tif (sectionIndex == -1) {\n\t\t\tt.$hide = true;\n\t\t\treturn;\n\t\t}\n\n\t\tconst type = this.State.timelineMode;\n\t\tlet unit = this.GetUnitCount(type);\n\t\tif (type !== \"day\" || type !== \"week\") unit = this.GetUnitCount(unit);\n\n\t\tconst prev = this._processed.find(obj => {\n\t\t\tif (obj.section == t.section) {\n\t\t\t\tif (type === \"day\")\n\t\t\t\t\treturn this.CheckDates(obj.end_date, t.start_date, obj.all_day);\n\n\t\t\t\tconst prev = webix.Date.timePart(obj.end_date)\n\t\t\t\t\t? this.GetUnitStart(unit, webix.Date.add(obj.end_date, 1, unit, true))\n\t\t\t\t\t: obj.end_date;\n\t\t\t\tconst next = this.GetUnitStart(unit, t.start_date);\n\t\t\t\treturn this.CheckDates(prev, next, obj.all_day);\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\n\t\tlet y;\n\t\tif (prev) {\n\t\t\ty = prev.$y;\n\t\t\tthis._processed.splice(\n\t\t\t\tthis._processed.findIndex(p => prev.id == p.id),\n\t\t\t\t1\n\t\t\t);\n\t\t} else {\n\t\t\tif (webix.isUndefined(this._lastRow[t.section]))\n\t\t\t\tthis._lastRow[t.section] = 0;\n\t\t\telse this._lastRow[t.section]++;\n\n\t\t\tif (this._lastRow[t.section] >= this._sectionSize - 1) t.$more = true;\n\t\t\telse t.$more = false;\n\t\t}\n\n\t\tthis.UpdateTask(t, sectionIndex, y);\n\n\t\tthis._processed.push(t);\n\t\tthis._processed.sort((a, b) => a.$y - b.$y);\n\t}\n\n\t/**\n\t * Checks if the start of one event follows the end of the previous one\n\t * @param {Date} prev - the end date of the previous event\n\t * @param {Date} next - the start date of the next event\n\t * @param {Boolean} all_day - the flag that indicates that the previous event is all-day (which means that the end date is really 1 day later)\n\t * @returns {Boolean} true if the start follows the end, false otherwise\n\t */\n\tCheckDates(prev, next, all_day) {\n\t\treturn (all_day ? webix.Date.add(prev, 1, \"day\", true) : prev) <= next;\n\t}\n\n\t/**\n\t * Creates a layer with events\n\t */\n\tRenderEvents() {\n\t\tif (this._DataObj) {\n\t\t\tthis.Bars.$view.firstChild.removeChild(this._DataObj);\n\t\t\tdelete this._DataObj;\n\t\t}\n\n\t\t// No Events, No Render\n\t\tif (!this.Events.count() || !this.Bars.count()) return;\n\n\t\tconst container = webix.html.create(\"div\", {\n\t\t\trole: \"presentation\",\n\t\t});\n\t\tlet html = \"\";\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Events.data.each(obj => {\n\t\t\tif (!obj.$hide) {\n\t\t\t\tif (!obj.$more || this._lastRow[obj.section] == 4) {\n\t\t\t\t\thtml += this.BarsTemplate(obj, _);\n\t\t\t\t} else {\n\t\t\t\t\tif (!this._moreEvents[obj.section]) {\n\t\t\t\t\t\tthis._moreEvents[obj.section] = [];\n\n\t\t\t\t\t\thtml += this.MoreBarTemplate(obj, _);\n\t\t\t\t\t}\n\t\t\t\t\tthis._moreEvents[obj.section].push(obj.id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tcontainer.innerHTML = html;\n\t\tthis._DataObj = this.Bars.$view.firstChild.appendChild(container);\n\t\tthis.app.callEvent(\"events:rendered\", []);\n\t}\n\n\t/**\n\t * Paints a grid\n\t * @param {Object} scales - scales object as returned by this.Local.getScales()\n\t */\n\tDrawGrid(scales) {\n\t\tconst view = this.Bars;\n\t\tconst colors = { contrast: \"#808080\", dark: \"#384047\" };\n\t\tview.$view.style.backgroundImage = `url(${this.GetGrid(\n\t\t\tscales,\n\t\t\tcolors[webix.skin.$name] || \"#ddd\"\n\t\t)})`;\n\t\tview.$view.style.marginTop = \"0px\";\n\n\t\t// sync grid to scroll position\n\t\tview.$view.style.backgroundPosition = `-${this.InnerState.left}px -${this.InnerState.top}px`;\n\n\t\tthis.Resize(scales.width);\n\t}\n\n\t/**\n\t * Changes the width of the root component (list with bars)\n\t * @param {number} width\n\t */\n\tResize(width) {\n\t\tconst area = this.Bars.$view.querySelector(\".webix_scroll_cont\");\n\t\tarea.style.width = width + \"px\";\n\t\tarea.style.minHeight = \"1px\";\n\t}\n\n\t/**\n\t * Handles scrolling\n\t */\n\tHandleScroll() {\n\t\tthis.InnerState = this.getParam(\"innerState\", true);\n\n\t\tthis._scroll_handler = webix.event(this.Bars.$view, \"scroll\", ev => {\n\t\t\tconst bars = ev.target;\n\t\t\tconst top = Math.round(bars.scrollTop);\n\t\t\tconst left = Math.round(bars.scrollLeft);\n\t\t\tthis.Bars.$view.style.backgroundPosition = `-${left}px -${top}px`;\n\t\t\tthis.InnerState.$batch({ top, left });\n\t\t\tthis.Tree.scrollTo(0, top);\n\n\t\t\tthis.MoreWindow.HideWindow();\n\t\t});\n\n\t\tthis.on(this.Tree, \"onScrollY\", function() {\n\t\t\tconst y = this.getScrollState().y;\n\t\t\tthis.$scope.Bars.scrollTo(this.$scope.InnerState.left, y);\n\t\t});\n\t}\n\n\t/**\n\t * Returns a string with HTML of a task node content\n\t * @param {Object} obj - task data\n\t * @param {function} _ - the translator function of jet locale plugin, see https://webix.gitbook.io/webix-jet/part-ii-webix-jet-in-details/plugins#applying-the-locale\n\t * @returns {string} a string with HTML of an event bar\n\t */\n\tBarsTemplate(obj, _) {\n\t\tconst style = dayEventColor(obj);\n\t\tconst scales = this.Scales;\n\n\t\tlet w = obj.$w - 2;\n\t\t// all day events last 1 day longer than their end_date\n\t\tif (obj.all_day && obj.end_date < scales.end) {\n\t\t\tw += this.GetUnitWidth(scales, obj.start_date);\n\t\t}\n\n\t\tconst content = `<div class=\"webix_scheduler_timeline_content\">${obj.text ||\n\t\t\t_(\"(no title)\")}</div>`;\n\n\t\tlet css = \"webix_scheduler_timeline_event\";\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (obj.start_date < this.Scales.start)\n\t\t\tcss += \" webix_scheduler_event_break_left\";\n\t\telse if (obj.end_date > this.Scales.end)\n\t\t\tcss += \" webix_scheduler_event_break_right\";\n\n\t\tconst tooltip = this.GetTooltip(obj);\n\t\treturn `<div webix_e_id=\"${obj.id}\" \n\t\t\twebix_tooltip=\"${tooltip}\" class=\"${css}\" \n\t\t\tstyle=\"left:${obj.$x}px;top:${obj.$y}px;width:${w}px;height:${obj.$h}px;${style}\">\n\t\t\t${content}\n\t\t</div>`;\n\t}\n\n\t/**\n\t * Returns a string with a tooltip for an event\n\t * @param {Object} obj - event data\n\t * @returns {string} a string with HTML of a tooltip\n\t */\n\tGetTooltip(obj) {\n\t\treturn obj.text;\n\t}\n\n\t/**\n\t * Defines the looks and contents of the bar that allows to see events that did not fit into a 5-line section\n\t * @param {Object} obj - the event data\n\t * @param {function} _ - the translator function of the Locale plugin\n\t * @returns {string} with the HTML of the bar\n\t */\n\tMoreBarTemplate(obj, _) {\n\t\tconst text = _(\"Show more\");\n\t\tconst content = `<div class=\"webix_scheduler_timeline_content\" webix_tooltip=\"${text}\">${text}</div>`;\n\t\tconst css = \"webix_scheduler_timeline_event webix_scheduler_multi_more\";\n\n\t\treturn `<div webix_e_id=\"$wsh_multi_more\" webix_r_id=\"${obj.section}\" class=\"${css}\" style=\"left:0px;top:${obj.$y}px;width:100%;height:${obj.$h}px;\">\n\t\t\t${content}\n\t\t</div>`;\n\t}\n\n\t/**\n\t * Either shows the selected event in Info or opens the list of extra events in a popup\n\t * @param {MouseEvent} e - a native browser event\n\t * @returns {Boolean} always false to prevent bubbling\n\t */\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.Bars.$view);\n\t\tif (event.id === \"$wsh_multi_more\") {\n\t\t\tconst id = event.node.getAttribute(\"webix_r_id\");\n\t\t\tthis.MoreWindow.ShowWindow(\n\t\t\t\tid,\n\t\t\t\tthis.Tree.getItemNode(id),\n\t\t\t\tthis._moreEvents[id] || []\n\t\t\t);\n\t\t} else if (event.id && event.id != \"0\") {\n\t\t\tconst obj = this.GetEvent(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Initiates creating a new event\n\t * @param {MouseEvent} e - a native browser event\n\t * @param {(string|number)} id - the ID of a section\n\t */\n\tShowNew(e, id) {\n\t\tconst state = this.State;\n\t\tif (!state.readonly && !state.clipboard) {\n\t\t\tconst scales = this.Scales;\n\t\t\tconst start = scales.start;\n\n\t\t\tconst unit = scales.precise\n\t\t\t\t? this.GetUnitCount(scales.minUnit)\n\t\t\t\t: scales.minUnit;\n\t\t\tconst n = Math.floor(e.offsetX / this.GetUnitWidth(scales));\n\t\t\tconst date = this.AddUnit(unit, start, n);\n\n\t\t\tstate.selected = { id: \"0\", date, section: id };\n\t\t}\n\t}\n\n\t/**\n\t * Returns the event data by its ID\n\t * @param {(string|id)} id - the ID of an event\n\t * @returns {Object} the event data\n\t */\n\tGetEvent(id) {\n\t\treturn this.Events.getItem(id);\n\t}\n\n\t/**\n\t * Updates selected in global reactive state\n\t * @param {(string|number)} id - the ID of an event\n\t * @param {Object} newEvent - the new event that should be selected\n\t */\n\tUpdateSelection(id, newEvent) {\n\t\tif (this.State.selected) {\n\t\t\tnewEvent.id = id;\n\t\t\tthis.State.selected = getParams(newEvent);\n\t\t}\n\t}\n\n\t/**\n\t * Returns the target date for an event\n\t * @returns {Date}\n\t */\n\tGetTargetDate() {\n\t\tconst clickedUnit = this.mousePosUnit || 0;\n\t\tconst scales = this.Scales;\n\t\treturn this.AddUnit(scales.minUnit, scales.start, clickedUnit);\n\t}\n\n\t/* Method wrappers for gantt-lib functions */\n\n\tGetUnitCount(type) {\n\t\treturn smallerCount[type][0];\n\t}\n\n\tGetUnitStart(unit, date) {\n\t\treturn getUnitStart(unit, date);\n\t}\n\n\tAddUnit(unit, date, count) {\n\t\treturn addUnit(unit)(date, count);\n\t}\n\n\tGetGrid(scales, color) {\n\t\treturn grid(scales.cellWidth, scales.cellHeight, color);\n\t}\n\n\tUpdateTask(task, sectionIndex, y) {\n\t\treturn updateTask(\n\t\t\ttask,\n\t\t\tthis._lastRow[task.section] + sectionIndex * this._sectionSize,\n\t\t\tthis.Scales,\n\t\t\tthis.Scales.cellHeight - 12,\n\t\t\ty\n\t\t);\n\t}\n\n\tGetUnitWidth(scales, date) {\n\t\tif (\n\t\t\tscales.precise &&\n\t\t\t(scales.minUnit !== \"day\" || scales.minUnit !== \"month\")\n\t\t) {\n\t\t\tconst count = smallerCount[scales.minUnit][1];\n\t\t\tconst number = typeof count === \"number\" ? count : count(date);\n\t\t\treturn Math.floor(scales.cellWidth / number);\n\t\t}\n\t\treturn scales.cellWidth;\n\t}\n}\n\n/**\n * Case-insensitive indexOf\n * @param {Array<any>} arr - the array to be checked\n * @param {any} el - something that you need to find in the array\n * @returns {number} the index of the first found element or -1\n */\nfunction indexOf(arr, el) {\n\tfor (let i = 0; i < arr.length; ++i) {\n\t\tif (arr[i] == el) return i;\n\t}\n\treturn -1;\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class ScalesView extends JetView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\treturn {\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\twidth: compact ? 80 : 200,\n\t\t\t\t\tcss: \"webix_scheduler_timeline_space\",\n\t\t\t\t\tborderless: false,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"template\",\n\t\t\t\t\tlocalId: \"scale\",\n\t\t\t\t\theight: 20,\n\t\t\t\t\tcss: \"webix_scheduler_timeline_scale\",\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst scale = this.$$(\"scale\");\n\t\tconst innerState = (this.InnerState = this.getParam(\"innerState\", true));\n\t\tthis.on(innerState.$changes, \"left\", x => scale.scrollTo(x, null));\n\t}\n\n\turlChange() {\n\t\tthis.RenderScales();\n\t}\n\n\t/**\n\t * Renders gantt scales\n\t */\n\tRenderScales() {\n\t\tconst scales = this.getParam(\"scales\", true);\n\t\tconst view = this.$$(\"scale\");\n\t\tconst html = scales.rows\n\t\t\t.map(line => {\n\t\t\t\treturn (\n\t\t\t\t\t`<div class=\"webix_scheduler_timeline_scale_row\" style='height:${line.height}px;width:${scales.width}px'>` +\n\t\t\t\t\tline.cells.map(cell => this.CellTemplate(cell, line.type)).join(\"\") +\n\t\t\t\t\t\"</div>\"\n\t\t\t\t);\n\t\t\t})\n\t\t\t.join(\"\");\n\n\t\tview.config.height = scales.height;\n\t\tview.setHTML(html);\n\t\tview.resize();\n\t}\n\n\t/**\n\t * Returns the template string for a scale unit\n\t * @param {Object} cell - a scale unit\n\t * @returns {string} - the template string of the scale cell\n\t */\n\tCellTemplate(cell) {\n\t\tconst css = `webix_scheduler_timeline_scale_cell ${cell.css}`;\n\t\treturn `<div class=\"${css}\" style=\"width:${cell.width}px;\">${cell.format(\n\t\t\tcell.date\n\t\t)}</div>`;\n\t}\n\n\tDateIsToday(date) {\n\t\tconst today = webix.Date.dayStart(new Date());\n\t\treturn webix.Date.equal(today, webix.Date.dayStart(date));\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport BarView from \"./bar\";\nimport ScaleView from \"./scale\";\nimport ChartView from \"./chart\";\n\nimport {\n\taddUnit,\n\tresetScales,\n\tgetUnitStart,\n\tsmallerCount,\n} from \"@xbs/webix-gantt-lib\";\n\nimport { createState } from \"jet-restate\";\n\nexport default class TimelineView extends JetView {\n\tconfig() {\n\t\tconst ui = {\n\t\t\trows: [BarView, ScaleView, ChartView],\n\t\t};\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tconst state = (this.State = this.getParam(\"state\", true));\n\n\t\tconst innerState = (this.InnerState = createState({\n\t\t\ttop: 0,\n\t\t\tleft: 0,\n\t\t}));\n\t\tthis.setParam(\"innerState\", innerState, true);\n\n\t\tthis.on(state.$changes, \"date\", v => this.SetScales(v, state.timelineMode));\n\n\t\tthis.on(state.$changes, \"timelineMode\", (t, o) => {\n\t\t\tif (o) this.SetScales(state.date, t);\n\t\t});\n\t}\n\n\tSetScales(date, type) {\n\t\tconst scales = this.ResetScales(type, date);\n\t\tthis.setParam(\"scales\", scales, true);\n\t}\n\n\tGetScalesArray(type) {\n\t\tswitch (type) {\n\t\t\tcase \"day\":\n\t\t\t\treturn [{ unit: \"hour\", format: \"%H:00\" }];\n\t\t\tcase \"week\":\n\t\t\t\treturn [{ unit: \"day\", step: 1, format: \"%d\" }];\n\t\t\tcase \"month\":\n\t\t\t\treturn [\n\t\t\t\t\t{\n\t\t\t\t\t\tunit: \"week\",\n\t\t\t\t\t\tformat: function(start) {\n\t\t\t\t\t\t\tconst parser = webix.Date.dateToStr(\"%d %M\");\n\t\t\t\t\t\t\tconst wstart = webix.Date.weekStart(start);\n\t\t\t\t\t\t\tconst wend = webix.Date.add(\n\t\t\t\t\t\t\t\twebix.Date.add(wstart, 1, \"week\", true),\n\t\t\t\t\t\t\t\t-1,\n\t\t\t\t\t\t\t\t\"day\",\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treturn parser(wstart) + \" - \" + parser(wend);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t];\n\t\t\tdefault: {\n\t\t\t\tconst unit = this.GetDefaultScaleUnit(type);\n\t\t\t\treturn [\n\t\t\t\t\t{\n\t\t\t\t\t\tunit,\n\t\t\t\t\t\tformat: (start, end) => {\n\t\t\t\t\t\t\tconst parser = webix.Date.dateToStr(\"%d %M %YYYY\");\n\t\t\t\t\t\t\treturn parser(start) + \" - \" + parser(end);\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\t}\n\n\tGetScalesCellWidth(type) {\n\t\tswitch (type) {\n\t\t\tcase \"day\":\n\t\t\t\treturn 80;\n\t\t\tcase \"week\":\n\t\t\t\treturn 300;\n\t\t\tcase \"month\":\n\t\t\t\treturn 400;\n\t\t\tdefault:\n\t\t\t\treturn 100;\n\t\t}\n\t}\n\n\tGetScalePrecision(type) {\n\t\tswitch (type) {\n\t\t\tcase \"day\":\n\t\t\t\treturn false;\n\t\t\tcase \"week\":\n\t\t\t\treturn false;\n\t\t\tcase \"month\":\n\t\t\t\treturn true;\n\t\t\tdefault:\n\t\t\t\treturn true;\n\t\t}\n\t}\n\n\t/* Method wrappers for gantt-lib functions */\n\n\tAddUnit(unit, date, step) {\n\t\treturn addUnit(unit)(date, step);\n\t}\n\n\tGetUnitStart(unit, date) {\n\t\treturn getUnitStart(unit, date);\n\t}\n\n\tResetScales(unit, date) {\n\t\tconst start = this.GetUnitStart(unit, date);\n\t\tconst end = this.AddUnit(unit, start, 1);\n\t\tconst active = webix.skin.$active;\n\t\treturn resetScales(\n\t\t\tstart,\n\t\t\tend,\n\t\t\tthis.GetScalePrecision(unit),\n\t\t\tthis.GetScalesCellWidth(unit),\n\t\t\tactive.barHeight - active.borderWidth * 2,\n\t\t\tthis.GetScalesArray(unit)\n\t\t);\n\t}\n\n\tGetDefaultScaleUnit(type) {\n\t\treturn smallerCount[type][0] || type;\n\t}\n}\n","import DayEventsView from \"../day/events\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { initDnD } from \"helpers/dnd\";\nimport CopyPasteMixin from \"helpers/copypaste\";\n\nexport default class UnitEventsView extends DayEventsView {\n\tconstructor(app, config) {\n\t\tsuper(app);\n\n\t\tif (config) {\n\t\t\tthis.Unit = config.unit;\n\t\t}\n\t}\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"unitList\",\n\t\t\tcss: \"webix_scheduler_day_events\",\n\t\t\tscroll: false,\n\t\t\tautoheight: true,\n\t\t\ttemplate: \"\",\n\t\t\ttype: {\n\t\t\t\theight: 42,\n\t\t\t\tcss: \"webix_scheduler_day_scale_item\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_day_event: e => this.ShowEvent(e),\n\t\t\t},\n\t\t\tonDblClick: {\n\t\t\t\twebix_scheduler_day_scale_item: (_e, h) => this.ShowNew(h),\n\t\t\t},\n\t\t};\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.List = this.$$(\"unitList\");\n\n\t\tSelectionMixin(this, \"scale\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.List.$setSize = function(x, y) {\n\t\t\tif (webix.ui.view.prototype.$setSize.call(this, x, y)) {\n\t\t\t\tthis.render();\n\t\t\t}\n\t\t};\n\n\t\tthis.minEventHeight = 62;\n\t\tthis.ParseHours();\n\n\t\tthis.on(this.State.$changes, \"readonly\", () => this.List.render());\n\n\t\tthis.List.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.List, \"units\");\n\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tif (this.app.config.copypaste && !webix.env.mobile && !compact)\n\t\t\tCopyPasteMixin(this, this.List);\n\t}\n\n\tFilterToday(value, to) {\n\t\tconst dayEvents = super.FilterToday(value, to);\n\n\t\treturn dayEvents.filter(obj => {\n\t\t\tif (obj.units) {\n\t\t\t\tconst units = obj.units.split(\",\");\n\t\t\t\tconst unitID = this.Unit.id + \"\";\n\t\t\t\treturn units.indexOf(unitID) !== -1;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}\n\n\tShowNew(h) {\n\t\tconst state = this.State;\n\t\tif (!state.readonly && !state.clipboard) {\n\t\t\tconst date = webix.Date.copy(this.Day || state.date);\n\t\t\tconst unit = this.Unit.id;\n\t\t\tdate.setHours(h);\n\t\t\tstate.selected = { id: \"0\", date, unit };\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class UnitsHeaderView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\tcols: [\n\t\t\t\t{ borderless: false, width: 51 },\n\t\t\t\t{\n\t\t\t\t\tview: \"dataview\",\n\t\t\t\t\tlocalId: \"header\",\n\t\t\t\t\tcss: \"webix_scheduler_day_header\",\n\t\t\t\t\txCount: 1,\n\t\t\t\t\tyCount: 1,\n\t\t\t\t\twidth: 0,\n\t\t\t\t\theight: 32,\n\t\t\t\t\tscroll: false,\n\t\t\t\t\ttype: {\n\t\t\t\t\t\theight: \"auto\",\n\t\t\t\t\t\twidth: \"auto\",\n\t\t\t\t\t},\n\t\t\t\t\ttemplate: obj => obj.value,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.Header = this.$$(\"header\");\n\n\t\tthis.Units = this.app.getService(\"local\").units();\n\n\t\tthis.Units.then(unitsCache => {\n\t\t\tthis.Header.sync(unitsCache, () => {\n\t\t\t\tthis.Header.define({ xCount: unitsCache.count() });\n\t\t\t\tthis.Header.resize();\n\t\t\t});\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport SelectionMixin from \"helpers/selection\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\nimport CopyPasteMixin from \"helpers/copypaste\";\nimport { initDnD } from \"helpers/dnd\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\n\nexport default class UnitMultidayList extends JetView {\n\tconstructor(app, config) {\n\t\tsuper(app);\n\n\t\tif (config) {\n\t\t\tthis.Unit = config.unit;\n\t\t}\n\t}\n\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"multiDayList\",\n\t\t\tautoheight: true,\n\t\t\tscroll: false,\n\t\t\tcss: \"webix_scheduler_multilist\",\n\t\t\ttype: {\n\t\t\t\theight: 36,\n\t\t\t\ttemplate: (obj, common) => this.EventTemplate(obj, common),\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_multiday_event: (e, id, node) =>\n\t\t\t\t\tthis.ShowEvent(id, node),\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.List = this.$$(\"multiDayList\");\n\n\t\tthis._expandState = \"down\";\n\t\tthis.maxVisibleLines = 3;\n\n\t\tthis._DataObj = this.List.$view.firstChild;\n\t\tSelectionMixin(this, \"multi\", true);\n\n\t\tthis._moreBtn = {\n\t\t\tid: \"$wsh_multi_more\",\n\t\t\t$css: \"webix_scheduler_multi_more\",\n\t\t};\n\n\t\tthis.on(this.app, \"units:multi:state\", state => {\n\t\t\tif (state !== this._expandState) {\n\t\t\t\tstate === \"down\" ? this.WrapData() : this.ExpandData();\n\t\t\t}\n\t\t});\n\n\t\tinitDnD.call(this, this.List, \"multidayUnits\");\n\t\tEditRecurringMixin(this);\n\n\t\tif (this.app.config.copypaste && !webix.env.mobile)\n\t\t\tCopyPasteMixin(this, this.List, { multi: true });\n\t}\n\n\turlChange() {\n\t\tconst data = this.getParam(\"data\");\n\t\tif (data) {\n\t\t\tconst copy = webix.copy(data.multi);\n\t\t\tconst multi = this.FilterByUnits(copy);\n\t\t\tthis.LimitData(multi);\n\t\t\tthis.List.clearAll();\n\t\t\tthis.List.parse(multi);\n\t\t}\n\t}\n\n\tEventTemplate(obj, common) {\n\t\tconst height = common.height - 8;\n\t\tconst size = `height:${height}px; line-height:${height}px; width:calc(100% - 5px);`;\n\t\tconst color = obj.id !== \"$wsh_multi_more\" ? dayEventColor(obj) : \"\";\n\t\tconst css = this.GetStyle(obj);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"${size} ${color}\">\n\t\t\t\t\t${obj.text || _(\"(No title)\")}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj) {\n\t\tlet css = \"webix_scheduler_multiday_event\";\n\t\tif (obj.id == \"$wsh_multi_more\") return css;\n\n\t\tconst date = this.State.date;\n\t\tconst end =\n\t\t\t!obj.all_day && !webix.Date.timePart(obj.end_date)\n\t\t\t\t? webix.Date.add(obj.end_date, -1, \"day\", true)\n\t\t\t\t: obj.end_date;\n\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tcss += obj.$past ? \" webix_scheduler_past_event\" : \"\";\n\n\t\tif (obj.start_date < date) css += \" webix_scheduler_event_break_left\";\n\t\tif (end >= webix.Date.add(date, 1, \"day\", true))\n\t\t\tcss += \" webix_scheduler_event_break_right\";\n\n\t\treturn css;\n\t}\n\n\tLimitData(data) {\n\t\tdelete this._reserve;\n\t\tdelete this._reserveIds;\n\t\tif (data.length > this.maxVisibleLines) {\n\t\t\tconst excess = data.length - 2;\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis._moreBtn.text = `${excess} ${_(\"more\")}`;\n\n\t\t\tif (this._expandState === \"down\") {\n\t\t\t\tthis._reserve = data.splice(2, excess, this._moreBtn);\n\t\t\t} else {\n\t\t\t\tthis._reserve = data.slice(2);\n\t\t\t}\n\n\t\t\tthis._reserveIds = this._reserve.map(d => d.id);\n\n\t\t\tthis.app.callEvent(\"units:multi:state\", [this._expandState, false]);\n\t\t}\n\t}\n\n\tWrapData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._expandState = \"down\";\n\n\t\t\tif (this._reserveIds) {\n\t\t\t\tthis._inAnimation = true;\n\t\t\t\tconst height =\n\t\t\t\t\tthis.List.$height -\n\t\t\t\t\t(this._reserveIds.length - 1) * this.List.type.height;\n\t\t\t\tthis.Animate(\"down\", height, () => {\n\t\t\t\t\tthis.List.add(this._moreBtn);\n\t\t\t\t\tthis.List.remove(this._reserveIds);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tExpandData() {\n\t\tconst expandable = this.List.exists(\"$wsh_multi_more\");\n\t\tif (!this._inAnimation) {\n\t\t\tthis._expandState = \"up\";\n\t\t\tif (expandable) {\n\t\t\t\tthis._inAnimation = true;\n\t\t\t\tthis.Animate(\"up\");\n\n\t\t\t\tthis.List.remove(\"$wsh_multi_more\");\n\t\t\t\tthis.List.parse(this._reserve);\n\t\t\t}\n\t\t}\n\t}\n\n\tAnimate(mode, height, handler) {\n\t\tthis.List.$view.style.transition = \"height 150ms\";\n\t\tif (height) this.List.$view.style.height = `${height}px`;\n\n\t\tsetTimeout(() => {\n\t\t\tif (handler) handler();\n\n\t\t\tthis.List.$view.style.transition = \"\";\n\t\t\tthis._inAnimation = false;\n\t\t}, 150);\n\t}\n\n\tShowEvent(id, node) {\n\t\tif (id === \"$wsh_multi_more\") {\n\t\t\tthis.app.callEvent(\"units:multi:state\", [\"up\", true]);\n\t\t} else {\n\t\t\tconst obj = this.List.getItem(id);\n\t\t\tconst sel = getParams(obj);\n\t\t\tsel.node = node;\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tFilterByUnits(multiEvents) {\n\t\treturn multiEvents.filter(obj => {\n\t\t\tif (obj.units) {\n\t\t\t\tconst units = obj.units.split(\",\");\n\t\t\t\tconst unitID = this.Unit.id + \"\";\n\t\t\t\treturn units.indexOf(unitID) !== -1;\n\t\t\t}\n\t\t\treturn false;\n\t\t});\n\t}\n\n\t/**\n\t * Returns the event object by its ID\n\t * @param {(string|number)} id - the ID of the event\n\t * @returns {Object}\n\t */\n\tGetEvent(id) {\n\t\treturn this.List.getItem(id);\n\t}\n\n\t/**\n\t * Returns the target date for the event\n\t * @returns {Date}\n\t */\n\tGetTargetDate() {\n\t\treturn this.State.date;\n\t}\n}\n","import MultiMoreView from \"../common/multimore\";\nimport UnitMultidayList from \"./multidaylist\";\nexport default class UnitMultidayView extends MultiMoreView {\n\tconfig() {\n\t\tconst ui = super.config();\n\t\tconst units = this.app.getService(\"local\").units();\n\n\t\tconst more = ui.cols[0];\n\t\tmore.onClick = {\n\t\t\t\"wxi-angle-down\": () =>\n\t\t\t\tthis.app.callEvent(\"units:multi:state\", [\"up\", true]),\n\t\t\t\"wxi-angle-up\": () =>\n\t\t\t\tthis.app.callEvent(\"units:multi:state\", [\"down\", true]),\n\t\t};\n\n\t\tui.cols[1] = { cols: [] };\n\n\t\treturn units.then(unitsCache => {\n\t\t\tconst data = unitsCache.serialize();\n\t\t\tfor (let i = 0; i < data.length; ++i) {\n\t\t\t\tui.cols[1].cols.push(\n\t\t\t\t\tnew (this.app.dynamic(UnitMultidayList))(this.app, {\n\t\t\t\t\t\tunit: data[i],\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn ui;\n\t\t});\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.MoreIcon = this.$$(\"more\");\n\n\t\tthis.on(this.State.$changes, \"date\", () => {\n\t\t\tthis.SetMoreIcon();\n\t\t});\n\n\t\tthis.on(this.app, \"units:multi:state\", (state, animate) => {\n\t\t\tthis.Animate(state, animate ? 150 : 1);\n\t\t});\n\t}\n\n\t/**\n\t * Sets a delay for animation of inner views (collapse/expand)\n\t * @param {string} mode - \"up\" or \"down\" - the direction of the icon\n\t * @param {number} delay - delay in milliseconds\n\t */\n\tAnimate(mode, delay) {\n\t\tsetTimeout(() => {\n\t\t\tthis.SetMoreIcon(mode);\n\t\t}, delay);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport HourscaleView from \"../common/hourscale\";\nimport UnitEventsView from \"./events\";\nimport UnitsHeaderView from \"./header\";\nimport UnitMultidayView from \"./multiday\";\n\nimport { isMultiDay } from \"helpers/dates\";\n\nexport default class UnitsView extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tconst units = this.app.getService(\"local\").units();\n\n\t\tconst multi = {\n\t\t\tlocalId: \"multi\",\n\t\t\thidden: true,\n\t\t\tcols: [UnitMultidayView],\n\t\t};\n\n\t\tconst days = {\n\t\t\tlocalId: \"scroll\",\n\t\t\tview: \"scrollview\",\n\t\t\tscroll: \"y\",\n\t\t\tcss: \"webix_scheduler_week_days\",\n\t\t\tbody: {\n\t\t\t\tcols: [HourscaleView],\n\t\t\t},\n\t\t};\n\n\t\treturn units.then(unitsCache => {\n\t\t\tconst data = unitsCache.serialize();\n\t\t\tfor (let i = 0; i < data.length; ++i) {\n\t\t\t\tdays.body.cols.push(\n\t\t\t\t\tnew (this.app.dynamic(UnitEventsView))(this.app, {\n\t\t\t\t\t\tunit: data[i],\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\trows: [UnitsHeaderView, multi, days],\n\t\t\t};\n\t\t});\n\t}\n\tinit() {\n\t\tconst state = this.app.getState();\n\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\t}\n\n\tRefreshData(value) {\n\t\tthis.GetDay(value).then(data => {\n\t\t\t// this.app will be null if compact trigger was called in main.js\n\t\t\tif (this.app) this.setParam(\"data\", data, true);\n\n\t\t\tif (data.multi.length) {\n\t\t\t\tthis.$$(\"multi\").show();\n\t\t\t} else this.$$(\"multi\").hide();\n\t\t});\n\t}\n\n\tGetDay(date) {\n\t\tconst end = webix.Date.add(date, 1, \"day\", true);\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(date, end)\n\t\t\t.then(evs => {\n\t\t\t\tconst multi = [],\n\t\t\t\t\tsingle = [];\n\t\t\t\tevs.forEach(ev => {\n\t\t\t\t\tif (isMultiDay(ev)) {\n\t\t\t\t\t\tmulti.push(ev);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsingle.push(ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn { multi, single };\n\t\t\t});\n\t}\n}\n","import UnitListView from \"../common/unitlist\";\nimport { isToday } from \"helpers/dates\";\n\nexport default class WeekEventsView extends UnitListView {\n\tconfig() {\n\t\tconst ui = super.config();\n\t\tui.css = \"webix_scheduler_week\";\n\t\tui.type.headerHeight = 28;\n\n\t\treturn ui;\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.List.clearAll();\n\t\t\tthis.List.parse(this.data.all);\n\t\t\tthis.ToggleOverlay();\n\t\t}\n\t}\n\n\tTemplateHeader(datestring) {\n\t\tconst date = new Date(datestring * 1);\n\t\tconst today = isToday(date);\n\n\t\tconst fstring = `%l, %F <span class='webix_scheduler_monthday${\n\t\t\ttoday ? \" webix_scheduler_today\" : \"\"\n\t\t}'>%j</span>`;\n\n\t\treturn `<span class=\"webix_unit_header_inner\">${webix.Date.dateToStr(\n\t\t\tfstring\n\t\t)(date)}</span>`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { isToday } from \"helpers/dates\";\n\nexport default class WeekHeaderView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\tcols: [\n\t\t\t\t{ borderless: false, width: 51 },\n\t\t\t\t{\n\t\t\t\t\tview: \"dataview\",\n\t\t\t\t\tlocalId: \"header\",\n\t\t\t\t\tcss: \"webix_scheduler_day_header\",\n\t\t\t\t\txCount: 7,\n\t\t\t\t\tyCount: 1,\n\t\t\t\t\twidth: 0,\n\t\t\t\t\theight: 32,\n\t\t\t\t\tscroll: false,\n\t\t\t\t\ttype: {\n\t\t\t\t\t\theight: \"auto\",\n\t\t\t\t\t\twidth: \"auto\",\n\t\t\t\t\t},\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\treturn `<span class=\"webix_scheduler_weekday\">${obj.day}</span> <span class=\"webix_scheduler_monthday\">${obj.date}</span>`;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.RefreshData();\n\t\t}\n\t}\n\n\tRefreshData() {\n\t\tlet start = this.data.start;\n\t\tconst data = [];\n\t\twhile (start < this.data.end) {\n\t\t\tconst obj = {\n\t\t\t\tday: webix.i18n.calendar.dayShort[start.getDay()],\n\t\t\t\tdate: start.getDate(),\n\t\t\t};\n\t\t\tif (isToday(start)) {\n\t\t\t\tobj.$css = \"webix_scheduler_list_today\";\n\t\t\t}\n\t\t\tdata.push(obj);\n\t\t\tstart = webix.Date.add(start, 1, \"day\", true);\n\t\t}\n\n\t\tconst header = this.$$(\"header\");\n\t\theader.clearAll();\n\t\theader.parse(data);\n\t}\n}\n","import MultiMoreView from \"../common/multimore\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { initDnD, locateEvent } from \"helpers/dnd\";\nimport { daysBetweenInclusive } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\nimport CopyPasteMixin from \"helpers/copypaste\";\n\nexport default class MultiDayEventsView extends MultiMoreView {\n\tconfig() {\n\t\tconst ui = super.config();\n\n\t\tui.cols[1] = {\n\t\t\tview: \"dataview\",\n\t\t\tlocalId: \"multiDayList\",\n\t\t\tcss: \"webix_scheduler_multidays\",\n\t\t\tscroll: false,\n\t\t\theight: 32,\n\t\t\txCount: 7,\n\t\t\tyCount: 1,\n\t\t\twidth: 0,\n\t\t\ttype: {\n\t\t\t\twidth: \"auto\",\n\t\t\t\theight: \"auto\",\n\t\t\t\titemHeight: 36,\n\t\t\t},\n\t\t\ttemplate: \"\",\n\t\t\ttooltip: {\n\t\t\t\ttemplate: \"\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_multiday_event: e => this.ShowEvent(e),\n\t\t\t},\n\t\t};\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tsuper.init();\n\n\t\tSelectionMixin(this, \"multi\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.Events = new webix.DataCollection({});\n\n\t\tthis.List.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.List, \"multiday\");\n\n\t\tif (this.app.config.copypaste && !webix.env.mobile)\n\t\t\tCopyPasteMixin(this, this.List);\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.ParseDays(this.data.multi);\n\t\t}\n\t}\n\n\tParseDays(events) {\n\t\tif (!events.length) return;\n\n\t\tthis.Events.clearAll();\n\t\tthis.Events.parse(events);\n\n\t\tconst days = [];\n\t\tfor (let d = 0; d < 7; d++) {\n\t\t\tdays.push({\n\t\t\t\tid: d + 1,\n\t\t\t\tdate: webix.Date.add(this.data.start, d, \"day\", true),\n\t\t\t});\n\t\t}\n\t\tthis.BreakEventsByDay(days);\n\n\t\tthis.SetMoreIcon(\n\t\t\tthis._maxEvents > this.maxVisibleLines ? this._expandState : null\n\t\t);\n\n\t\tthis.List.blockEvent();\n\t\tthis.List.parse(days);\n\t\tthis.ResetListHeight();\n\t\tthis.List.unblockEvent();\n\n\t\tthis.RenderEvents();\n\t}\n\n\tBreakEventsByDay(data) {\n\t\tthis.Days = [];\n\t\tconst processed = {};\n\t\tthis._maxEvents = 0;\n\n\t\tdata.forEach((day, dayIndex) => {\n\t\t\tconst today = day.date;\n\t\t\tthis.Days.push([]);\n\n\t\t\tthis.Events.data.each(ev => {\n\t\t\t\tif (!webix.isUndefined(processed[ev.id])) {\n\t\t\t\t\tif ((today <= ev.end_date && ev.all_day) || today < ev.end_date) {\n\t\t\t\t\t\tthis.Days[dayIndex][processed[ev.id]] = \"\";\n\t\t\t\t\t} else delete processed[ev.id];\n\t\t\t\t} else if (\n\t\t\t\t\tev.start_date < webix.Date.add(today, 1, \"day\", true) &&\n\t\t\t\t\tev.end_date >= today\n\t\t\t\t) {\n\t\t\t\t\tlet index = 0;\n\t\t\t\t\t// search for the first available index\n\t\t\t\t\twhile (!webix.isUndefined(this.Days[dayIndex][index])) index++;\n\n\t\t\t\t\tprocessed[ev.id] = index;\n\n\t\t\t\t\tconst config = {};\n\t\t\t\t\tconfig.es = ev.start_date;\n\t\t\t\t\tconfig.ee =\n\t\t\t\t\t\t!ev.all_day && !webix.Date.timePart(ev.end_date)\n\t\t\t\t\t\t\t? webix.Date.add(ev.end_date, -1, \"day\", true)\n\t\t\t\t\t\t\t: ev.end_date;\n\n\t\t\t\t\tconfig.length =\n\t\t\t\t\t\t1 +\n\t\t\t\t\t\tdaysBetweenInclusive(\n\t\t\t\t\t\t\t(config.ls = new Date(Math.max(this.data.start, config.es))),\n\t\t\t\t\t\t\t(config.le = new Date(Math.min(this.data.end - 1, config.ee)))\n\t\t\t\t\t\t);\n\n\t\t\t\t\tev.$config = config;\n\t\t\t\t\tthis.Days[dayIndex][index] = ev;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.Days[dayIndex].length > this._maxEvents)\n\t\t\t\tthis._maxEvents = this.Days[dayIndex].length;\n\t\t});\n\t}\n\n\tRenderEvents() {\n\t\tconst allEvents = this.Events.count();\n\n\t\tif (!allEvents) return;\n\n\t\tconst container = webix.html.create(\"div\", {\n\t\t\trole: \"presentation\",\n\t\t});\n\n\t\tlet html = \"\";\n\t\tlet renderedEvents = 0;\n\t\tconst toHide =\n\t\t\tthis._expandState === \"down\" && this._maxEvents > this.maxVisibleLines;\n\n\t\tthis.List.data.each((_day, dayIndex) => {\n\t\t\tconst dayHTML = [];\n\t\t\tconst visible = toHide\n\t\t\t\t? this.maxVisibleLines - 1\n\t\t\t\t: this.Days[dayIndex].length;\n\n\t\t\tfor (let i = 0; i < visible; ++i) {\n\t\t\t\tdayHTML[i] = this.Days[dayIndex][i];\n\n\t\t\t\tif (dayHTML[i]) {\n\t\t\t\t\tdayHTML[i] = this.ToHTML(dayHTML[i], dayIndex, i);\n\t\t\t\t\trenderedEvents++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thtml += dayHTML.join(\"\");\n\t\t});\n\n\t\tif (toHide) {\n\t\t\thtml += this.MoreOption(allEvents - renderedEvents);\n\t\t}\n\n\t\tcontainer.innerHTML = html;\n\t\tthis._DataObj = this.List.$view.firstChild.appendChild(container);\n\t\tthis.app.callEvent(\"events:rendered\", []);\n\t}\n\n\tToHTML(obj, cIndex, rIndex) {\n\t\tconst style = dayEventColor(obj);\n\t\tconst size = this.GetSizePosition(obj.$config.length, cIndex, rIndex);\n\t\tconst css = this.GetStyle(obj, obj.$config);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\twebix_tooltip=\"${obj.text || _(\"(No title)\")}\"\n\t\t\t\twebix_e_id=\"${obj.id}\"\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"${size} ${style}\">\n\t\t\t\t\t${obj.text || _(\"(No title)\")}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj, c) {\n\t\tconst { start, end } = this.data;\n\t\tlet css = \"webix_scheduler_multiday_event\";\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (c.es < start && webix.Date.equal(start, webix.Date.dayStart(c.ls)))\n\t\t\tcss += \" webix_scheduler_event_break_left\";\n\t\tif (\n\t\t\tc.ee >= end &&\n\t\t\twebix.Date.equal(\n\t\t\t\twebix.Date.add(end, -1, \"day\", true),\n\t\t\t\twebix.Date.dayStart(c.le)\n\t\t\t)\n\t\t)\n\t\t\tcss += \" webix_scheduler_event_break_right\";\n\n\t\tcss += obj.$past ? \" webix_scheduler_past_event\" : \"\";\n\n\t\treturn css;\n\t}\n\n\tMoreOption(excess) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst size = this.GetSizePosition(\n\t\t\tthis.List.config.xCount,\n\t\t\t0,\n\t\t\tthis.maxVisibleLines - 1\n\t\t);\n\n\t\treturn `<div webix_e_id=\"$wsh_multi_more\" class=\"webix_scheduler_multiday_event webix_scheduler_multi_more\" style=\"${size}\">${excess} ${_(\n\t\t\t\"more\"\n\t\t)}</div>`;\n\t}\n\n\tGetSizePosition(length, cIndex, rIndex) {\n\t\t// numbers are for space between events and borders of component\n\t\tconst width = length * this.List.type.width - 4;\n\t\tconst height = this.List.type.itemHeight - 8;\n\t\tconst left = this.List.type.width * cIndex + 1;\n\t\tconst top = rIndex * this.List.type.itemHeight + 4;\n\n\t\treturn `width:${width}px; height:${height}px; line-height:${height}px; left:${left}px; top:${top}px;`;\n\t}\n\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.List.$view);\n\t\tif (event.id) {\n\t\t\tif (event.id === \"$wsh_multi_more\") return this.ExpandData();\n\n\t\t\tconst obj = this.Events.getItem(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tExpandData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\n\t\t\tthis._expandState = \"up\";\n\t\t\tthis.Animate(\"up\");\n\n\t\t\tthis.ResetListHeight(this._maxEvents);\n\t\t}\n\t}\n\n\tWrapData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\t\t\tthis._expandState = \"down\";\n\n\t\t\tconst height =\n\t\t\t\tthis.List.$height -\n\t\t\t\t(this._maxEvents - this.maxVisibleLines) * this.List.type.height;\n\t\t\tthis.Animate(\"down\", height, () => {\n\t\t\t\tthis.ResetListHeight(this.maxVisibleLines);\n\t\t\t});\n\t\t}\n\t}\n\n\tResetListHeight(count) {\n\t\tif (!count)\n\t\t\tcount =\n\t\t\t\tthis._expandState === \"down\"\n\t\t\t\t\t? Math.min(this._maxEvents, this.maxVisibleLines)\n\t\t\t\t\t: this._maxEvents;\n\n\t\tconst height = count * this.List.type.itemHeight;\n\t\tif (this.List.type.height !== height) {\n\t\t\tthis.List.type.height = height;\n\t\t\tthis.List.define(\"height\", height);\n\t\t\tthis.List.resize();\n\t\t}\n\t}\n\n\t/**\n\t * Returns the data object for an event\n\t * @param {(string|number)} id - the ID of an event\n\t * @returns {Object} - the event object\n\t */\n\tGetEvent(id) {\n\t\treturn this.Events.getItem(id);\n\t}\n\n\t/**\n\t * Returns the target date for an event\n\t * @param {(string|number)} id - the ID of a data item of the main view (corresponds to a day)\n\t * @returns {Date}\n\t */\n\tGetTargetDate(id) {\n\t\treturn id ? this.List.getItem(id).date : this.State.date;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport DayEventsView from \"../day/events\";\nimport WeekHeaderView from \"./header\";\nimport WeekEventsView from \"./compact\";\nimport HourscaleView from \"../common/hourscale\";\nimport MultiDayEventsView from \"./multiday\";\n\nimport { isMultiDay } from \"helpers/dates\";\n\nexport default class WeekView extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tif (this.Compact) {\n\t\t\treturn {\n\t\t\t\trows: [WeekEventsView],\n\t\t\t};\n\t\t} else {\n\t\t\tconst days = {\n\t\t\t\tlocalId: \"scroll\",\n\t\t\t\tview: \"scrollview\",\n\t\t\t\tscroll: \"y\",\n\t\t\t\tcss: \"webix_scheduler_week_days\",\n\t\t\t\tbody: {\n\t\t\t\t\tcols: [HourscaleView],\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst weekLength = 7;\n\t\t\tfor (let i = 0; i < weekLength; ++i) {\n\t\t\t\tdays.body.cols.push(\n\t\t\t\t\tnew (this.app.dynamic(DayEventsView))(this.app, {\n\t\t\t\t\t\tday: i,\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\trows: [\n\t\t\t\t\tWeekHeaderView,\n\t\t\t\t\t{ localId: \"multi\", hidden: true, cols: [MultiDayEventsView] },\n\t\t\t\t\tdays,\n\t\t\t\t],\n\t\t\t};\n\t\t}\n\t}\n\tinit() {\n\t\tconst state = this.app.getState();\n\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\n\t\tif (!this.Compact) {\n\t\t\tthis.on(state.$changes, \"selected\", v => v && this.ScrollScale(v));\n\t\t}\n\t}\n\n\tRefreshData(date) {\n\t\tconst start = webix.Date.weekStart(date);\n\t\tconst end = webix.Date.add(start, 1, \"week\", true);\n\t\tthis.GetWeek(start, end).then(data => {\n\t\t\t// this.app will be null if compact trigger was called in main.js\n\t\t\tif (this.app) this.setParam(\"data\", data, true);\n\n\t\t\tif (data.multi.length) {\n\t\t\t\tthis.$$(\"multi\").show();\n\t\t\t} else this.$$(\"multi\").hide();\n\t\t});\n\t}\n\n\tGetWeek(start, end) {\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(start, end)\n\t\t\t.then(evs => {\n\t\t\t\tif (this.Compact) {\n\t\t\t\t\treturn { start, end, all: evs };\n\t\t\t\t}\n\n\t\t\t\tconst multi = [],\n\t\t\t\t\tsingle = [];\n\n\t\t\t\tevs.forEach(ev => {\n\t\t\t\t\tif (isMultiDay(ev)) {\n\t\t\t\t\t\tmulti.push(ev);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsingle.push(ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn { start, end, multi, single };\n\t\t\t});\n\t}\n\n\tScrollScale(v) {\n\t\tif (v.id === \"0\" && !v.date) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst y = (new Date().getHours() + 2) * 40;\n\t\t\t\tthis.$$(\"scroll\").scrollTo(0, y);\n\t\t\t}, 100);\n\t\t}\n\t}\n}\n","import { ignoreInitial } from \"jet-restate\";\nimport { JetView } from \"webix-jet\";\nimport MoreWindowView from \"../month/more\";\n\nexport default class YearCalendarView extends JetView {\n\tconstructor(app, config) {\n\t\tsuper(app, config);\n\n\t\tthis._month = config.month;\n\t}\n\n\tconfig() {\n\t\tthis.DayEvents = {};\n\n\t\treturn {\n\t\t\tview: \"calendar\",\n\t\t\tlocalId: \"calendar\",\n\t\t\tevents: day => this.MarkEvent(day),\n\t\t\ticons: false,\n\t\t\tnavigation: false,\n\t\t\tcalendarHeader: \"%F\",\n\t\t\tskipEmptyWeeks: true,\n\t\t\tborderless: true,\n\t\t\tonClick: {\n\t\t\t\twebix_cal_day_with_event: e => this.ShowEvents(e),\n\t\t\t\twebix_cal_month: () => this.ShowMonth(),\n\t\t\t},\n\t\t\tonDblClick: {\n\t\t\t\twebix_cal_day: e => this.ShowNew(e),\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonChange: (date, mode) => mode === \"user\" && this.SetStateDate(date),\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tthis.Calendar = this.getRoot();\n\t\tthis.Events = new webix.DataCollection({});\n\t\tconst state = (this.State = this.app.getState());\n\n\t\tthis.on(state.$changes, \"date\", date => this.ManageDateChange(date));\n\n\t\tthis.on(\n\t\t\tstate.$changes,\n\t\t\t\"active\",\n\t\t\tignoreInitial(() => this.RefreshData(this.GetMonthStart(state.date)))\n\t\t);\n\t\tthis.on(this.app, \"events:refresh\", () =>\n\t\t\tthis.RefreshData(this.GetMonthStart(state.date))\n\t\t);\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(this.GetMonthStart(state.date))\n\t\t);\n\n\t\tthis.Popup = this.ui(\n\t\t\tnew (this.app.dynamic(MoreWindowView))(this.app, {\n\t\t\t\tevents: this.Events,\n\t\t\t\tdrag: false,\n\t\t\t})\n\t\t);\n\t}\n\n\t/**\n\t * Sets the date in the global reactive state\n\t * @param {Date} date\n\t */\n\tSetStateDate(date) {\n\t\tthis.State.date = webix.Date.dayStart(date);\n\t}\n\n\t/**\n\t * Switches the calendar to a new month and gets events for it\n\t * @param {Date} date\n\t */\n\tManageDateChange(date) {\n\t\tif (!this._date || this._date.getFullYear() != date.getFullYear()) {\n\t\t\tlet monthStart = (this.MonthStart = this.GetMonthStart(date));\n\t\t\tthis.Calendar.showCalendar(monthStart);\n\t\t\tthis.RefreshData(monthStart);\n\t\t}\n\t\tif (this._month === date.getMonth()) this.Calendar.setValue(date);\n\t\telse if (this.Calendar.getValue()) this.Calendar.setValue();\n\t\tthis._date = date;\n\t}\n\n\t/**\n\t * Gets the date at the start of the current month\n\t * @param {Date} date\n\t * @returns {Date}\n\t */\n\tGetMonthStart(date) {\n\t\treturn new Date(date.getFullYear(), this._month, 1);\n\t}\n\n\t/**\n\t * Gets events for the given month\n\t * @param {Date} monthStart - the start of the month\n\t */\n\tRefreshData(monthStart) {\n\t\tthis.DayEvents = {};\n\t\tconst monthEnd = webix.Date.add(monthStart, 1, \"month\", true);\n\n\t\tthis.Data.getEvents(monthStart, monthEnd).then(data => {\n\t\t\tthis.Events.clearAll();\n\t\t\tthis.Events.parse(data);\n\t\t\twhile (monthStart < monthEnd) {\n\t\t\t\tlet next = webix.Date.add(monthStart, 1, \"day\", true);\n\t\t\t\tdata.forEach(obj => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(obj.all_day\n\t\t\t\t\t\t\t? obj.end_date >= monthStart\n\t\t\t\t\t\t\t: obj.end_date > monthStart) &&\n\t\t\t\t\t\tobj.start_date < next\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst dateKey = monthStart.valueOf();\n\t\t\t\t\t\tif (!this.DayEvents[dateKey]) this.DayEvents[dateKey] = [];\n\t\t\t\t\t\tthis.DayEvents[dateKey].push(obj.id);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tmonthStart = next;\n\t\t\t}\n\t\t\tthis.Calendar.refresh();\n\t\t});\n\t}\n\n\t/**\n\t * Adds dots to days with events\n\t * @param {Date} day - the date\n\t * @returns {string} the name of the CSS class\n\t */\n\tMarkEvent(day) {\n\t\tlet css = webix.Date.isHoliday(day) || \"\";\n\t\tif (this.DayEvents[day.valueOf()]) css += \" webix_cal_day_with_event\";\n\t\treturn css;\n\t}\n\n\t/**\n\t * Returns a timestamp of the day that was clicked\n\t * @param {MouseEvent} e - the mouse event\n\t * @returns {number|null} the timestamp or null\n\t */\n\tGetDay(e) {\n\t\tconst day = e.target.innerHTML;\n\t\tif (day) return new Date(this.MonthStart).setDate(day * 1);\n\t\treturn null;\n\t}\n\n\t/**\n\t * Shows a popup with a list of events for the day\n\t * @param {MouseEvent} e - the mouse event\n\t */\n\tShowEvents(e) {\n\t\tconst date = this.GetDay(e);\n\t\tif (date) {\n\t\t\tconst data = this.DayEvents[date];\n\t\t\tthis.Popup.ShowWindow(date, e.target.parentNode, data || []);\n\t\t}\n\t}\n\n\t/**\n\t * Opens this day and opens the form with data for a new event\n\t * @param {MouseEvent} e - the mouse event\n\t */\n\tShowNew(e) {\n\t\tconst state = this.State;\n\t\tif (!state.readonly && !state.clipboard) {\n\t\t\tconst date = this.GetDay(e);\n\t\t\tif (date) {\n\t\t\t\t// no $batch because view needs to be ready\n\t\t\t\tstate.mode = \"day\";\n\t\t\t\tstate.selected = { id: \"0\", date };\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Opens the month view for the selected month\n\t */\n\tShowMonth() {\n\t\tthis.State.$batch({\n\t\t\tmode: \"month\",\n\t\t\tdate: this.MonthStart,\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport YearCalendarView from \"./calendar\";\n\nexport default class YearView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"scrollview\",\n\t\t\tbody: {\n\t\t\t\tpadding: 20,\n\t\t\t\tview: \"flexlayout\",\n\t\t\t\tcss: \"webix_scheduler_year\",\n\t\t\t\tcols: this.GetCalendars(),\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Creates 12 calendars for each month of the current year\n\t * @returns {Array} an array of calendar views\n\t */\n\tGetCalendars() {\n\t\tconst calendars = [];\n\t\tfor (let i = 0; i < 12; i++) {\n\t\t\tcalendars.push(\n\t\t\t\tnew (this.app.dynamic(YearCalendarView))(this.app, { month: i })\n\t\t\t);\n\t\t}\n\t\treturn calendars;\n\t}\n}\n","import m0 from \"./views/bars/add\";\nimport m1 from \"./views/bars/date\";\nimport m2 from \"./views/bars/index.js\";\nimport m3 from \"./views/bars/nav\";\nimport m4 from \"./views/bars/navpopup\";\nimport m5 from \"./views/event/actionmenu\";\nimport m6 from \"./views/event/form\";\nimport m7 from \"./views/event/formpopup\";\nimport m8 from \"./views/event/info\";\nimport m9 from \"./views/event/recurringform\";\nimport m10 from \"./views/main\";\nimport m11 from \"./views/modes/agenda/index.js\";\nimport m12 from \"./views/modes/common/actionpopup\";\nimport m13 from \"./views/modes/common/hourscale\";\nimport m14 from \"./views/modes/common/multimore\";\nimport m15 from \"./views/modes/common/unitlist\";\nimport m16 from \"./views/modes/day/events\";\nimport m17 from \"./views/modes/day/index.js\";\nimport m18 from \"./views/modes/day/multiday\";\nimport m19 from \"./views/modes/month/compact\";\nimport m20 from \"./views/modes/month/events\";\nimport m21 from \"./views/modes/month/header\";\nimport m22 from \"./views/modes/month/index.js\";\nimport m23 from \"./views/modes/month/list\";\nimport m24 from \"./views/modes/month/more\";\nimport m25 from \"./views/modes/timeline/bar\";\nimport m26 from \"./views/modes/timeline/chart\";\nimport m27 from \"./views/modes/timeline/index.js\";\nimport m28 from \"./views/modes/timeline/more\";\nimport m29 from \"./views/modes/timeline/scale\";\nimport m30 from \"./views/modes/units/events\";\nimport m31 from \"./views/modes/units/header\";\nimport m32 from \"./views/modes/units/index.js\";\nimport m33 from \"./views/modes/units/multiday\";\nimport m34 from \"./views/modes/units/multidaylist\";\nimport m35 from \"./views/modes/week/compact\";\nimport m36 from \"./views/modes/week/header\";\nimport m37 from \"./views/modes/week/index.js\";\nimport m38 from \"./views/modes/week/multiday\";\nimport m39 from \"./views/modes/year/calendar\";\nimport m40 from \"./views/modes/year/index.js\";\nimport m41 from \"./views/side/editor\";\nimport m42 from \"./views/side/index.js\";\nimport m43 from \"./views/side/popup\";\nimport { JetView } from \"webix-jet\";\n\nconst views = { JetView };\nviews[\"bars/add\"] = m0;\nviews[\"bars/date\"] = m1;\nviews[\"bars\"] = m2;\nviews[\"bars/nav\"] = m3;\nviews[\"bars/navpopup\"] = m4;\nviews[\"event/actionmenu\"] = m5;\nviews[\"event/form\"] = m6;\nviews[\"event/formpopup\"] = m7;\nviews[\"event/info\"] = m8;\nviews[\"event/recurringform\"] = m9;\nviews[\"main\"] = m10;\nviews[\"modes/agenda\"] = m11;\nviews[\"modes/common/actionpopup\"] = m12;\nviews[\"modes/common/hourscale\"] = m13;\nviews[\"modes/common/multimore\"] = m14;\nviews[\"modes/common/unitlist\"] = m15;\nviews[\"modes/day/events\"] = m16;\nviews[\"modes/day\"] = m17;\nviews[\"modes/day/multiday\"] = m18;\nviews[\"modes/month/compact\"] = m19;\nviews[\"modes/month/events\"] = m20;\nviews[\"modes/month/header\"] = m21;\nviews[\"modes/month\"] = m22;\nviews[\"modes/month/list\"] = m23;\nviews[\"modes/month/more\"] = m24;\nviews[\"modes/timeline/bar\"] = m25;\nviews[\"modes/timeline/chart\"] = m26;\nviews[\"modes/timeline\"] = m27;\nviews[\"modes/timeline/more\"] = m28;\nviews[\"modes/timeline/scale\"] = m29;\nviews[\"modes/units/events\"] = m30;\nviews[\"modes/units/header\"] = m31;\nviews[\"modes/units\"] = m32;\nviews[\"modes/units/multiday\"] = m33;\nviews[\"modes/units/multidaylist\"] = m34;\nviews[\"modes/week/compact\"] = m35;\nviews[\"modes/week/header\"] = m36;\nviews[\"modes/week\"] = m37;\nviews[\"modes/week/multiday\"] = m38;\nviews[\"modes/year/calendar\"] = m39;\nviews[\"modes/year\"] = m40;\nviews[\"side/editor\"] = m41;\nviews[\"side\"] = m42;\nviews[\"side/popup\"] = m43;\n\nexport default views;\n","import { parse } from \"helpers/ical\";\nimport { explodeEvent, checkPattern } from \"helpers/recurring\";\nimport { getContrastingColor } from \"helpers/colors\";\n\nexport default class LocalData {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t */\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.store = this.createEvents();\n\t\tthis.events_ready = null;\n\n\t\tif (app.config.calendars !== false) {\n\t\t\tthis.cals = this.createCalendars();\n\t\t\tthis.cals_ready = null;\n\t\t}\n\n\t\tif (app.config.units !== false) {\n\t\t\tthis.unitsCache = this.createUnits();\n\t\t\tthis.units_ready = null;\n\t\t}\n\n\t\tif (app.config.timeline) {\n\t\t\tthis._sections = this.createSections();\n\t\t\tthis.sections_ready = null;\n\t\t}\n\n\t\tconst utc = app.config.serverUTC; //load and save dates as UTC\n\t\tthis.strToDate = webix.Date.strToDate(webix.i18n.parseFormat, utc);\n\t\tthis.dateToStr = webix.Date.dateToStr(webix.i18n.parseFormat, utc);\n\t\tthis.dateToLocalStr = webix.Date.dateToStr(webix.i18n.parseFormat);\n\n\t\tthis.loaded_ranges = {}; //cached date bounds in dyn. mode\n\t}\n\t/**\n\t * Creates events collection\n\t * @returns {Object} events Data Collection\n\t */\n\tcreateEvents() {\n\t\tconst c = new webix.DataCollection({\n\t\t\tscheme: {\n\t\t\t\t$change: data => {\n\t\t\t\t\tif (typeof data.start_date === \"string\")\n\t\t\t\t\t\tdata.start_date = this.strToDate(data.start_date);\n\t\t\t\t\tif (typeof data.end_date === \"string\")\n\t\t\t\t\t\tdata.end_date = this.strToDate(data.end_date);\n\n\t\t\t\t\tif (this.app.config.recurring) {\n\t\t\t\t\t\tdata.$recurring = data.recurring ? parse(data.recurring) : null;\n\n\t\t\t\t\t\tif (data.$recurring) checkPattern(data);\n\n\t\t\t\t\t\tif (typeof data.origin_id === \"string\" && !isNaN(data.origin_id)) {\n\t\t\t\t\t\t\tdata.origin_id *= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof data.all_day === \"string\") data.all_day *= 1;\n\n\t\t\t\t\tthis.getColor(data, this.cals && this.cals.getItem(data.calendar));\n\t\t\t\t},\n\t\t\t\t$serialize: data => this.eventOut(data),\n\t\t\t\t$export: data => this.eventOut(data),\n\t\t\t},\n\t\t});\n\n\t\treturn c;\n\t}\n\n\t/**\n\t * Loads events and populates events Data Collection\n\t * @param {boolean} sync - if true, Data Collection will be returned outside a promise\n\t * @param {boolean} force - if true, events will be reloaded\n\t * @returns {Promise} promise that resolves with events collection\n\t */\n\tevents(sync, force) {\n\t\tconst store = this.store;\n\t\tif (sync) return store;\n\n\t\treturn this.calendars().then(() => {\n\t\t\t//data will be filled by getEvents\n\t\t\tif (this.app.config.dynamic) {\n\t\t\t\tif (!this.events_ready)\n\t\t\t\t\tthis.events_ready = webix.promise.resolve(this.store);\n\t\t\t} else if (!this.events_ready || force) {\n\t\t\t\tthis.events_ready = this.app\n\t\t\t\t\t.getService(\"backend\")\n\t\t\t\t\t.events()\n\t\t\t\t\t.then(data => {\n\t\t\t\t\t\tstore.clearAll();\n\t\t\t\t\t\tstore.parse(data);\n\n\t\t\t\t\t\treturn store;\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.events_ready;\n\t\t});\n\t}\n\t/**\n\t * Gets or loads events for the stated date range\n\t * @param {Date} start - start date\n\t * @param {Date} end - end date\n\t * @returns {Promise} promise that resolves with events array\n\t */\n\tgetEvents(start, end) {\n\t\tconst mode = this.app.config.dynamic;\n\t\tlet evs;\n\n\t\tif (mode) {\n\t\t\tconst params = this.getParams(mode);\n\n\t\t\tif (params.then) {\n\t\t\t\t// loading now\n\t\t\t\tevs = params.then(() => {\n\t\t\t\t\treturn this.getLocal(start, end);\n\t\t\t\t});\n\t\t\t} else if (params === true) {\n\t\t\t\t//already loaded\n\t\t\t\tevs = this.getLocal(start, end);\n\t\t\t} else {\n\t\t\t\tevs = this.loaded_ranges[params.from] = this.getDynamic(params).then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\treturn this.getLocal(start, end);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tevs = this.getLocal(start, end);\n\t\t}\n\t\treturn evs;\n\t}\n\t/**\n\t * Finds already loaded events for the stated date range\n\t * @param {Date} start - start date\n\t * @param {Date} end - end date\n\t * @returns {Promise} promise that resolves with events array\n\t */\n\tgetLocal(start, end) {\n\t\treturn this.events().then(store => {\n\t\t\tconst config = this.app.config;\n\t\t\tconst active = this.app.getState().active;\n\t\t\tlet evs = [];\n\t\t\tconst now = new Date();\n\t\t\tconst dimPastEvents = this.app.config.dimPastEvents;\n\n\t\t\tstore.data.each(ev => {\n\t\t\t\tif (\n\t\t\t\t\t(!config.calendars || findCalendar(active, ev.calendar)) &&\n\t\t\t\t\tev.start_date < end &&\n\t\t\t\t\t(ev.end_date > start ||\n\t\t\t\t\t\t(ev.end_date >= start && ev.all_day) ||\n\t\t\t\t\t\t(ev.$recurring &&\n\t\t\t\t\t\t\t(!ev.$recurring.UNTIL || ev.$recurring.UNTIL > start)))\n\t\t\t\t) {\n\t\t\t\t\tif (this.app.config.recurring && ev.recurring) {\n\t\t\t\t\t\tevs = evs.concat(\n\t\t\t\t\t\t\texplodeEvent(start, end, ev).map(e => {\n\t\t\t\t\t\t\t\tif (dimPastEvents) e.$past = this.isPast(e, now);\n\t\t\t\t\t\t\t\treturn e;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete ev.recurring;\n\t\t\t\t\t\tif (dimPastEvents) ev.$past = this.isPast(ev, now);\n\t\t\t\t\t\tevs.push(ev);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tev.start_date = this.roundTime(ev.start_date);\n\t\t\t\tev.end_date = this.roundTime(ev.end_date);\n\t\t\t});\n\n\t\t\tevs.sort(function(a, b) {\n\t\t\t\treturn a.start_date - b.start_date || a.end_date - b.end_date;\n\t\t\t});\n\n\t\t\treturn evs;\n\t\t});\n\t}\n\t/**\n\t * Checks if the event has already happened\n\t * @param {obj} ev - an event data object\n\t * @param {Date} now - the current date and time\n\t * @returns {boolean}\n\t */\n\tisPast(ev, now) {\n\t\tif (ev.all_day) return ev.end_date < webix.Date.dayStart(now);\n\t\treturn ev.end_date < now;\n\t}\n\t/**\n\t * Loads events portion\n\t * @param {Object} params - dynamic loading settings\n\t * @returns {Promise} promise that resolves with events array\n\t */\n\tgetDynamic(params) {\n\t\treturn this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.events(params)\n\t\t\t.then(data => {\n\t\t\t\tthis.store.parse(data);\n\t\t\t\tthis.loaded_ranges[params.from] = true;\n\n\t\t\t\treturn data;\n\t\t\t});\n\t}\n\t/**\n\t * Gets dynamic loading parameters\n\t * @param {string} mode - dynamic loading mode, \"day\", \"week\", \"month\" or \"year\"\n\t * @returns {Object} object with parameters\n\t */\n\tgetParams(mode) {\n\t\tconst state = this.app.getState();\n\t\tconst format = webix.i18n.parseFormatStr;\n\n\t\tlet from = webix.Date[mode + \"Start\"](state.date);\n\t\tlet to = webix.Date.add(from, 1, mode, true);\n\n\t\tif (\n\t\t\t(mode === \"month\" || mode === \"year\") &&\n\t\t\t(state.mode === \"week\" || state.mode === \"month\")\n\t\t) {\n\t\t\tif (from.getDay()) from = webix.Date.weekStart(from);\n\t\t\tif (to.getDay()) to = webix.Date.add(webix.Date.weekStart(to), 1, \"week\");\n\t\t}\n\n\t\tconst fromStr = format(from);\n\n\t\tlet res;\n\n\t\tif (!this.loaded_ranges[fromStr]) {\n\t\t\tres = {\n\t\t\t\tfrom: fromStr,\n\t\t\t\tto: format(to),\n\t\t\t};\n\t\t} else res = this.loaded_ranges[fromStr];\n\n\t\treturn res;\n\t}\n\t/**\n\t * Creates calendars collection\n\t * @returns {Object} calendars Data Collection\n\t */\n\tcreateCalendars() {\n\t\treturn new webix.DataCollection({\n\t\t\tscheme: {\n\t\t\t\t$sort: {\n\t\t\t\t\tdir: \"desc\",\n\t\t\t\t\tby: \"active\",\n\t\t\t\t\tas: sortCalendars,\n\t\t\t\t},\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonAfterDelete: () => this.setActive(),\n\t\t\t\tonAfterAdd: () => this.setActive(),\n\t\t\t\t\"data->onDataUpdate\": (id, data, old) => {\n\t\t\t\t\tif (old) {\n\t\t\t\t\t\tif (data.color !== old.color) {\n\t\t\t\t\t\t\tthis.store.data.each(obj => {\n\t\t\t\t\t\t\t\tif (obj.calendar == id) this.getColor(obj, data);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.app.callEvent(\"events:refresh\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.active !== old.active) {\n\t\t\t\t\t\t\tthis.setActive();\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tthis.cals.sort(\"#active#\", \"desc\", sortCalendars);\n\t\t\t\t\t\t\t}, 400);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\t/**\n\t * Loads calendars and populates calendars Data Collection\n\t * @param {boolean} sync - if true, Data Collection will be returned outside a promise\n\t * @param {boolean} force - if true, calendars will be reloaded\n\t * @returns {Promise} promise that resolves with calendars collection\n\t */\n\tcalendars(sync, force) {\n\t\tif (this.app.config.calendars == false) {\n\t\t\tif (sync) return false;\n\t\t\treturn webix.promise.resolve();\n\t\t}\n\n\t\tconst cals = this.cals;\n\t\tif (sync) return cals;\n\t\tif (this.cals_ready && !force) return this.cals_ready;\n\n\t\tthis.cals_ready = this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.calendars()\n\t\t\t.then(data => {\n\t\t\t\tcals.clearAll();\n\t\t\t\tcals.parse(data);\n\n\t\t\t\tthis.setActive();\n\n\t\t\t\treturn cals;\n\t\t\t});\n\n\t\treturn this.cals_ready;\n\t}\n\t/**\n\t * Processes event item before saving, serializing or exporting it\n\t * @param {Object} data - event item\n\t * @param {Boolean} save - true, if called for saving operation\n\t * @param {Boolean} inner - flag that indicates that this is an inner scheduler call\n\t * @returns {Object} events object\n\t */\n\teventOut(data, save, inner) {\n\t\tdata = webix.copy(data);\n\n\t\tif (!inner && data.recurring) checkPattern(data);\n\n\t\t// export and serialize: there's no need to convert date to UTC\n\t\tconst format = save ? this.dateToStr : this.dateToLocalStr;\n\t\tif (data.start_date) data.start_date = format(data.start_date);\n\t\tif (data.end_date) data.end_date = format(data.end_date);\n\n\t\tif (!save) {\n\t\t\tdelete data.$recurring;\n\t\t\tdelete data.$textColor;\n\t\t\tdelete data.$color;\n\t\t\tdelete data.$past;\n\t\t}\n\n\t\treturn data;\n\t}\n\n\t/** Sets an array of active calendars IDs to app state */\n\tsetActive() {\n\t\tlet active = [];\n\t\tthis.cals.data.each(d => {\n\t\t\tif (d.active * 1) active.push(d.id);\n\t\t});\n\t\tthis.app.getState().active = active;\n\t}\n\t/**\n\t * Assigns colors to event item\n\t * @param {Object} data - event object\n\t * @param {Object} force - calendar object\n\t */\n\tgetColor(data, calendar) {\n\t\tdata.$color = calendar ? calendar.color : data.color || \"#01C2A5\"; //same for new event in form\n\t\tdata.$textColor = getContrastingColor(data.color || data.$color);\n\t}\n\t/**\n\t * Rounds time for start and end dates of event item to 5 minutes to match Webix Timepicker\n\t * @param {Date} date - Date object\n\t * @returns {Date} Date object with rounded minutes\n\t */\n\troundTime(date) {\n\t\tconst res = webix.Date.copy(date);\n\t\tres.setMinutes(Math.round(res.getMinutes() / 5) * 5);\n\t\treturn res;\n\t}\n\t/**\n\t * Checks if there are sub-events after the start date of the stated occurrence of a recurring event\n\t * @param {Object} event - event object\n\t * @returns {boolean} result of the check\n\t */\n\tisLastPart(event) {\n\t\tconst hasParts = this.store.find(\n\t\t\te =>\n\t\t\t\tevent.origin_id == e.origin_id &&\n\t\t\t\t(event.$id || event.id) != e.id && // in dnd events have $id, in info they do not\n\t\t\t\tevent.start_date < e.start_date,\n\t\t\ttrue\n\t\t);\n\t\treturn !hasParts;\n\t}\n\n\tcreateUnits() {\n\t\treturn new webix.DataCollection({\n\t\t\tdata: [],\n\t\t});\n\t}\n\n\tunits(sync, force) {\n\t\tif (this.app.config.units == false) {\n\t\t\tif (sync) return false;\n\t\t\treturn webix.promise.resolve();\n\t\t}\n\n\t\tconst unitsCache = this.unitsCache;\n\t\tif (sync) return unitsCache;\n\t\tif (this.units_ready && !force) return this.units_ready;\n\n\t\tthis.units_ready = this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.units()\n\t\t\t.then(data => {\n\t\t\t\tunitsCache.clearAll();\n\t\t\t\tunitsCache.parse(data);\n\n\t\t\t\treturn unitsCache;\n\t\t\t});\n\n\t\treturn this.units_ready;\n\t}\n\n\tcreateSections() {\n\t\treturn new webix.DataCollection({});\n\t}\n\n\tsections(sync, force) {\n\t\tconst sections = this._sections;\n\t\tif (sync) return sections;\n\t\tif (this.sections_ready && !force) return this.sections_ready;\n\n\t\tthis.sections_ready = this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.sections()\n\t\t\t.then(data => {\n\t\t\t\tsections.clearAll();\n\t\t\t\tsections.parse(data);\n\t\t\t\treturn sections;\n\t\t\t});\n\n\t\treturn this.sections_ready;\n\t}\n\n\t/** Clears all local storages; data can be  */\n\tclearAll() {\n\t\tthis.loaded_ranges = {}; //cached date bounds in dyn. mode\n\n\t\tthis.store.clearAll();\n\t\tthis.events_ready = null;\n\n\t\tif (this.app.config.calendars !== false) {\n\t\t\tthis.cals.clearAll();\n\t\t\tthis.cals_ready = null;\n\t\t}\n\n\t\tif (this.app.config.units !== false) {\n\t\t\tthis.unitsCache.clearAll();\n\t\t\tthis.units_ready = null;\n\t\t}\n\n\t\tif (this.app.config.timeline !== false) {\n\t\t\tthis._sections.clearAll();\n\t\t\tthis.sections_ready = null;\n\t\t}\n\t}\n}\n\n/**\n * Checks whether the stated calendar is active\n * @param {Array} arr - array of IDs of active calendars\n * @param {string|number} arr - ID of the searched calendar\n * @returns {boolean} result of the check\n */\nfunction findCalendar(arr, c) {\n\tfor (let i = 0; i < arr.length; ++i) {\n\t\tif (arr[i] == c) return true;\n\t}\n\treturn false;\n}\n/**\n * Compares active state of calendars\n * @param {Object} a - calendar A\n * @param {Object} b - calendar B\n * @param {string} prop - the name of the object property used for sorting\n * @returns {boolean} result of the comparison\n */\nfunction sortCalendars(a, b, prop) {\n\treturn a[prop] * 1 > b[prop] * 1 ? 1 : -1;\n}\n","import {\n\tisFirstOccurrence,\n\tcutOccurrence,\n\tclipSequence,\n\tcorrectMode,\n} from \"../helpers/recurring\";\n\nexport default class Operations {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t */\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.Back = app.getService(\"backend\");\n\n\t\tconst local = (this.Local = app.getService(\"local\"));\n\t\tthis.Events = local.events(true);\n\t\tthis.Cals = local.calendars(true);\n\t\tthis.State = app.getState();\n\t}\n\t/**\n\t * Adds event\n\t * @param {Object} obj - object with event fields\n\t * @param {Boolean} inner - flag that indicates that this is an inner scheduler call\n\t * @param {string} temp - ID of the temporary task\n\t * @returns {promise} promise that resolves with event id\n\t */\n\taddEvent(obj, inner, temp) {\n\t\tconst tosave = this.Local.eventOut(obj, true, inner);\n\t\treturn this.Back.addEvent(tosave).then(res => {\n\t\t\tif (temp) this.Events.remove(temp);\n\t\t\tobj.id = res.id;\n\t\t\treturn this.Events.add(obj);\n\t\t});\n\t}\n\t/**\n\t * Updates event\n\t * @param {(string|number)} id - event ID\n\t * @param {Object} obj - object with event fields\n\t * @param {string} mode - update mode: \"unite\" or \"next\"\n\t * @param {Date} date - the start date of the new event subseries\n\t * @param {Boolean} inner - flag that indicates that this is an inner scheduler call\n\t * @returns {promise} promise\n\t */\n\tupdateEvent(id, obj, mode, date, inner) {\n\t\tconst tosave = this.Local.eventOut(obj, true, inner);\n\t\treturn this.Back.updateEvent(id, tosave, mode, date).then(() => {\n\t\t\tthis.Events.updateItem(id, obj);\n\n\t\t\tif (mode === \"all\") {\n\t\t\t\tconst parts = this.Events.find(e => e.origin_id == id).map(e => e.id);\n\t\t\t\tthis.Events.remove(parts);\n\t\t\t} else if (mode === \"next\" && date) {\n\t\t\t\t// in case update came for a sub-event, find master\n\t\t\t\tconst cev = this.Events.getItem(id);\n\t\t\t\tif (cev.origin_id) id = cev.origin_id;\n\n\t\t\t\tconst parts = this.Events.find(\n\t\t\t\t\te => e.origin_id == id && e.start_date >= date\n\t\t\t\t).map(e => e.id);\n\t\t\t\tthis.Events.remove(parts);\n\t\t\t}\n\t\t});\n\t}\n\t/**\n\t * Removes event\n\t * @param {Object} obj - object with event fields\n\t * @param {string} mode - edit mode: \"this\", \"next\" or \"all\"\n\t * @param {number} date_id - ID of event occurrence, for custom calls\n\t * @returns {promise} promise\n\t */\n\tremoveEvent(obj, mode, date_id) {\n\t\tlet id = this.State.selected ? this.State.selected.id : obj.$id || obj.id;\n\n\t\t// non-recurring and special cases of recurring\n\t\tconst isFirst = mode ? isFirstOccurrence(date_id, obj.start_date) : false;\n\t\tif (mode === \"next\" && isFirst) {\n\t\t\tmode = correctMode.call(this, obj, mode);\n\t\t}\n\n\t\tif (\n\t\t\t!mode ||\n\t\t\tmode === \"all\" ||\n\t\t\t(mode === \"this\" && !date_id) ||\n\t\t\t(mode === \"next\" && obj.origin_id && isFirst)\n\t\t) {\n\t\t\tif (mode === \"all\" && obj.origin_id) id = obj.origin_id;\n\n\t\t\tthis.Back.removeEvent(id).then(() => {\n\t\t\t\tthis.Events.remove(id);\n\n\t\t\t\tconst parts = this.Events.find(e => e.origin_id == id).map(e => e.id);\n\t\t\t\tthis.Events.remove(parts);\n\t\t\t});\n\t\t} else {\n\t\t\t// recurring events...\n\t\t\tif (mode === \"this\" || mode === \"next\") {\n\t\t\t\tif (!date_id) {\n\t\t\t\t\tid = obj.origin_id;\n\t\t\t\t\tobj = this.Events.getItem(id);\n\t\t\t\t}\n\n\t\t\t\tconst date = webix.Date.dayStart(\n\t\t\t\t\tdate_id ? new Date(date_id.split(\"_\")[0] * 1) : obj.start_date\n\t\t\t\t);\n\t\t\t\tconst recurring =\n\t\t\t\t\tmode === \"this\" ? cutOccurrence(date, obj) : clipSequence(date, obj);\n\n\t\t\t\t// [fixme] if all occ-s were removed, remove the whole event instead of update\n\t\t\t\t// or do this in PUT on backend - otherwise an 'empty' 'all' event will hang in db, unavailable for calendar\n\n\t\t\t\tthis.updateEvent(id, { recurring }, mode, date, true);\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Adds calendar\n\t * @param {Object} obj - object with calendar fields\n\t * @returns {promise} promise that resolves with calendar id\n\t */\n\taddCalendar(obj) {\n\t\tif (!obj) obj = { text: \"\", color: \"#997CEB\", active: 1 };\n\n\t\treturn this.Back.addCalendar(obj).then(res => {\n\t\t\tobj.id = res.id;\n\t\t\tthis.Cals.add(obj, 0);\n\t\t\treturn obj.id;\n\t\t});\n\t}\n\t/**\n\t * Updates calendar\n\t * @param {string|number} id - calendar ID\n\t * @param {Object} obj - object with calendar fields\n\t * @returns {promise} promise\n\t */\n\tupdateCalendar(id, obj) {\n\t\tif (!this.app.getState().readonly)\n\t\t\treturn this.Back.updateCalendar(id, obj).then(() => {\n\t\t\t\treturn this.Cals.updateItem(id, obj);\n\t\t\t});\n\t\telse return webix.promise.resolve(this.Cals.updateItem(id, obj));\n\t}\n\n\tremoveCalendar(id) {\n\t\tthis.Back.removeCalendar(id).then(() => {\n\t\t\tthis.Cals.remove(id);\n\t\t});\n\t}\n}\n","export default class Backend {\n\tconstructor(app, url) {\n\t\tthis.app = app;\n\t\tthis._url = url;\n\t}\n\n\turl(path) {\n\t\treturn this._url + path;\n\t}\n\n\tevents(params) {\n\t\treturn webix.ajax(this.url(\"events\"), params).then(res => res.json());\n\t}\n\n\taddEvent(obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"events\"), obj)\n\t\t\t.then(res => res.json());\n\t}\n\n\tupdateEvent(id, obj, mode, date) {\n\t\tconst params = obj;\n\t\tif (mode) params.recurring_update_mode = mode;\n\t\tif (date) params.recurring_update_date = date;\n\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"events/\" + id), params)\n\t\t\t.then(res => res.json());\n\t}\n\n\tremoveEvent(id) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"events/\" + id))\n\t\t\t.then(res => res.json());\n\t}\n\n\tcalendars() {\n\t\treturn webix.ajax(this.url(\"calendars\")).then(res => res.json());\n\t}\n\n\taddCalendar(obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"calendars\"), obj)\n\t\t\t.then(res => res.json());\n\t}\n\n\tupdateCalendar(id, obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"calendars/\" + id), obj)\n\t\t\t.then(res => res.json());\n\t}\n\n\tremoveCalendar(id) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"calendars/\" + id))\n\t\t\t.then(res => res.json());\n\t}\n\n\tunits(params) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.get(this.url(\"units\"), params)\n\t\t\t.then(res => res.json());\n\t}\n\n\tsections() {\n\t\treturn webix.ajax(this.url(\"sections\")).then(res => res.json());\n\t}\n}\n","import { JetApp, plugins, EmptyRouter } from \"webix-jet\";\nimport { createState, link, ignoreInitial } from \"jet-restate\";\nimport { initJetWin } from \"@xbs/jet-helpers\";\n\nimport views from \"./export_views\";\nimport en from \"locales/en\";\n\nimport LocalData from \"models/LocalData\";\nimport Operations from \"./models/Operations\";\nimport Backend from \"./models/Backend\";\n\nexport class App extends JetApp {\n\tconstructor(config) {\n\t\tconst state = createState({\n\t\t\tmode: config.mode || \"month\",\n\t\t\tdate: webix.Date.datePart(config.date || new Date()),\n\t\t\treadonly: config.readonly || false,\n\t\t\tactive: [],\n\t\t\tselected: null,\n\t\t\ttimelineMode: config.timelineMode || \"week\",\n\t\t});\n\n\t\tconfig = config || {};\n\n\t\tconst defaults = {\n\t\t\trouter: EmptyRouter,\n\t\t\tversion: VERSION,\n\t\t\tdebug: DEBUG,\n\t\t\tstart: \"/main\",\n\t\t\tparams: { state, forceCompact: config.compact },\n\t\t\tcompactWidth: 780,\n\t\t\trecurring: true,\n\t\t\tcalendars: true,\n\t\t\ttimeline: !!config.timeline,\n\t\t\tcopypaste: true,\n\t\t\tdragCreate: true,\n\t\t\tdimPastEvents: false,\n\t\t};\n\n\t\tsuper({ ...defaults, ...config });\n\n\t\t// order matters!\n\t\tthis.setService(\n\t\t\t\"backend\",\n\t\t\tnew (this.dynamic(Backend))(this, this.config.url)\n\t\t);\n\t\tthis.setService(\"local\", new (this.dynamic(LocalData))(this, config));\n\t\tthis.setService(\"operations\", new (this.dynamic(Operations))(this));\n\t\tinitJetWin(this);\n\n\t\tthis.use(\n\t\t\tplugins.Locale,\n\t\t\tthis.config.locale || {\n\t\t\t\tlang: \"en\",\n\t\t\t\twebix: {\n\t\t\t\t\ten: \"en-US\",\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tdynamic(obj) {\n\t\treturn this.config.override ? this.config.override.get(obj) || obj : obj;\n\t}\n\n\trequire(type, name) {\n\t\tif (type === \"jet-views\") return views[name];\n\t\telse if (type === \"jet-locales\") return locales[name];\n\n\t\treturn null;\n\t}\n\n\tgetState() {\n\t\treturn this.config.params.state;\n\t}\n}\n\nwebix.protoUI(\n\t{\n\t\tname: \"scheduler\",\n\t\tapp: App,\n\t\tdefaults: {\n\t\t\tborderless: true,\n\t\t},\n\t\t$init: function() {\n\t\t\tthis.name = \"scheduler\";\n\n\t\t\tconst state = this.$app.getState();\n\n\t\t\tfor (let key in state) {\n\t\t\t\tlink(state, this.config, key);\n\t\t\t}\n\n\t\t\tstate.$changes.attachEvent(\"date\", () => {\n\t\t\t\tignoreInitial((v, o) => this.callEvent(\"onChange\", v, o));\n\t\t\t});\n\n\t\t\tthis.$app.attachEvent(\"app:beforedrag\", (ctx, e) =>\n\t\t\t\tthis.callEvent(\"onBeforeEventDrag\", [ctx, e])\n\t\t\t);\n\t\t\tthis.$app.attachEvent(\"app:beforedrop\", (ctx, e) =>\n\t\t\t\tthis.callEvent(\"onBeforeEventDrop\", [ctx, e])\n\t\t\t);\n\t\t},\n\t\t$exportView: function(options) {\n\t\t\tif (\n\t\t\t\toptions.export_mode === \"png\" ||\n\t\t\t\t(options.export_mode === \"pdf\" && options.display === \"image\")\n\t\t\t)\n\t\t\t\treturn this.$app.getRoot();\n\t\t\treturn this.$app.getService(\"local\").events(true);\n\t\t},\n\t\tgetState() {\n\t\t\treturn this.$app.getState();\n\t\t},\n\t\tgetService(name) {\n\t\t\treturn this.$app.getService(name);\n\t\t},\n\t\tclearAll() {\n\t\t\tthis.$app.getService(\"local\").clearAll();\n\t\t},\n\t},\n\twebix.ui.jetapp\n);\n\n// re-export for customization\nconst services = { Backend, LocalData, Operations };\nconst locales = { en };\nexport { views, services, locales };\n","export default {\n\t//navigation\n\tWeek: \"Week\",\n\tDay: \"Day\",\n\tMonth: \"Month\",\n\tYear: \"Year\",\n\tAgenda: \"Agenda\",\n\tUnits: \"Units\",\n\tTimeline: \"Timeline\",\n\tToday: \"Today\",\n\tCreate: \"Create\",\n\tNext: \"Next\",\n\tPrevious: \"Previous\",\n\t\"Next day\": \"Next day\",\n\t\"Previous day\": \"Previous day\",\n\t\"Next week\": \"Next week\",\n\t\"Previous week\": \"Previous week\",\n\t\"Next month\": \"Next month\",\n\t\"Previous month\": \"Previous month\",\n\n\t// managing calendars\n\t\"Add calendar\": \"Add calendar\",\n\t\"Do you really want to remove this calendar?\":\n\t\t\"Do you really want to remove this calendar?\",\n\t\"Edit calendar\": \"Edit calendar\",\n\tDelete: \"Delete\",\n\tSave: \"Save\",\n\tTitle: \"Title\",\n\tColor: \"Color\",\n\tActive: \"Active\",\n\tSettings: \"Settings\",\n\t\"(no title)\": \"(no title)\",\n\t\"Inactive calendar\": \"Inactive calendar\",\n\n\t// modes\n\t\"No Events\": \"No Events\",\n\t\"All Day\": \"All Day\",\n\tmore: \"more\",\n\t\"Expand all-day events\": \"Expand all-day events\",\n\t\"Collapse all-day events\": \"Collapse all-day events\",\n\n\t// info and form\n\t\"The event will be deleted permanently, are you sure?\":\n\t\t\"The event will be deleted permanently, are you sure?\",\n\tDone: \"Done\",\n\t\"Delete event\": \"Delete event\",\n\tClose: \"Close\",\n\tEdit: \"Edit\",\n\t\"(No title)\": \"(No title)\",\n\tEvent: \"Event\",\n\tStart: \"Start\",\n\tEnd: \"End\",\n\tCalendar: \"Calendar\",\n\tNotes: \"Notes\",\n\tfrom: \"from\",\n\tto: \"to\",\n\t\"Edit event\": \"Edit event\",\n\t\"Assigned to units\": \"Assigned to units\",\n\t\"No units\": \"No units\",\n\t\"Unknown unit\": \"Unknown unit\",\n\n\t//recurring\n\tnever: \"never\",\n\tnone: \"none\",\n\tdaily: \"daily\",\n\tday: \"day\",\n\tdays: \"days\",\n\tevery: \"Every\",\n\tweekly: \"weekly\",\n\tweek: \"week\",\n\tweeks: \"weeks\",\n\teach: \"Every\",\n\tmonthly: \"monthly\",\n\tmonth: \"month\",\n\tmonths: \"months\",\n\tyearly: \"yearly\",\n\tyear: \"year\",\n\tyears: \"years\",\n\tRepeat: \"Repeat\",\n\t\"End repeat\": \"End repeat\",\n\t\"Repeats each\": \"Repeats each\",\n\ttill: \"till\",\n\ttimes: \"times\",\n\t\"weekly, every\": \"weekly, every\",\n\t\"monthly, every\": \"monthly, every\",\n\t\"yearly, every\": \"yearly, every\",\n\t\"every working day\": \"every working day\",\n\tcustom: \"custom\",\n\tEvery: \"Every\",\n\ton: \"on\",\n\tof: \"of\",\n\t\"day of year\": \"day of year\",\n\t\"after several occurrences\": \"after several occurrences\",\n\tdate: \"date\",\n\t\"week on\": \"week on\",\n\t\"Change recurring pattern\": \"Change recurring pattern\",\n\t\"Save changes?\": \"Save changes?\",\n\n\t// menus for edit and delete\n\t\"All events\": \"All events\",\n\t\"This event\": \"This event\",\n\t\"This event and the following\": \"This event and the following\",\n\tCancel: \"Cancel\",\n\tApply: \"Apply\",\n\t\"Edit recurring event\": \"Edit recurring event\",\n\n\t\"Timeline scale\": \"Timeline scale\",\n\tSection: \"Section\",\n\t\"Show more\": \"Show more\",\n\n\t\"Copy of\": \"Copy of\",\n\t\"Copy event\": \"Copy event\",\n};\n"],"names":["webix","config","this","webixJet","_events","_subs","_data","params","extend","JetBase","_root","_detachEvents","_destroySubs","_container","app","_parent","id","value","url","_segment","update","show","parent","view","getParentView","getParam","suburl","toString","root_1","getRoot","queryView","obj","localId","$scope","name","code","attachEvent","push","key","kid","contains","sub","getSubViewInfo","subview","popup","events","i","length","detachEvent","subView","destructor","current","default","branch","child","_getDefaultSub","_routed_view","parse","substr","parts","split","chunks","test","result","pos","indexOf","params_1","_i","dchunk","decodeURIComponent","page","isNew","url2str","stack","stack_1","chunk","obj2str","join","str","encodeURIComponent","route","index","_next","path","Route","slice","setParams","old","kids","reset","concat","_join","Promise","res","rej","redirect","confirm","resolve","callEvent","NavigationBlocked","catch","err","then","_this","n","_super","_children","__extends","JetView","ui","container","jetview","createView","render","setParam","parent_1","target","_renderFrameLock","_show","segment","_init_url_data","_urlChange","linkRouter","getRouter","set","silent","_$view","_$","_$url","message","destroy","_destroyKids","plugin","getUrl","tagName","refresh","_render","root","document","body","toNode","cfg","_render_final","response","slot","$$","reject","copyConfig","oldui","parent_2","asWin","setPosition","isVisible","_init","_initUrl","ready","e","_initError","init","waits","frame","wait","all","urlChange","lock","_renderFrame","next","_createSubView","shift","_override","error","createFromURL","uis","_ui","JetViewRaw","cb","SubRouter","a","append","_once","window","version","start","_services","EventSystem","JetAppBase","_subSegment","handler","getSubView","prototype","$subview","addSubView","isArray","Array","method","point","DataCollection","RegExp","Map","Date","copy","$router","srcElement","getAttribute","trigger_1","_forView","trigger","cancelBubble","preventDefault","route_1","parentNode","clickHandler","views","_loadError","Error","hidden","replace","require","module","__esModule","loadView","over","override","dv","get","router","rest","apply","data","bind","er","debug","console","text","innerHTML","type","expire","event","_first_start","top","base","setTimeout","animation","node_1","html","addCss","removeCss","now","urlString","template","uid","_detectPrefix","onpopstate","HashRouter","routes","compare","history","pushState","prefix","sufix","_getRaw","routerPrefix","location","href","isPatched","patch","w","win","promise","freeze","some","$freeze","resize","baseAdd","baselayout","addView","baseRemove","removeView","jview_1","subs_1","arguments","subs","layout","protoUI","$init","$app","$ready","proxy","JetApp","UrlRouter","pathname","search","_$config","EmptyRouter","has","store","Object","hasOwnProperty","call","forEach","context","warn","x","String","russianPluralGroups","end","pluralTypes","arabic","lastTwo","bosnian_serbian","chinese","croatian","french","german","russian","lithuanian","czech","polish","icelandic","slovenian","pluralTypeToLanguages","pluralTypeName","locale","ret","langToPluralType","langs","lang","en","escape","token","dollarRegex","defaultTokenRegex","transformPhrase","phrase","substitutions","tokenRegex","TypeError","interpolationRegex","options","smart_count","texts","count","pluralTypeIndex","expression","argument","Polyglot","opts","phrases","currentLocale","allowMissing","onMissingKey","suffix","RangeError","constructTokenRegex","interpolation","newLocale","morePhrases","prefixedKey","unset","clear","newPhrases","t","_","webixPolyglot","plugins","_view","storage","setLangData","pconfig","polyglot","poly","service","put","locName","i18n","setLocale","setLang","getLang","setService","link","source","defineProperty","createState","handlers","out","observe","mask","undefined","queue","waitInQueue","notify","meta","list","keys","enumerable","configurable","values_1","sconfig","nested","reactive","$extend","val","valueOf","once","setSize","appView","appWidth","$width","appHeight","$height","_fillApp","define","width","height","left","setHandlers","$destructed","$view","enable","resizeEv","waitVisible","defer","interval","setInterval","destructed","clearInterval","AddView","getService","compact","cals","calendars","icon","css","label","skin","$active","inputHeight","on","onItemClick","AddEvent","align","getState","selected","DateView","cols","tooltip","NavLabel","ChangeDate","State","$changes","DateLabel","timeline","dir","state","step","GetStep","mode","add","date","diff","Math","abs","getMonth","setDate","$batch","timelineMode","format","dateToStr","longDateFormatStr","setHTML","NavBarView","units","toolbar","bottomOffset","borderless","optionWidth","onChange","SetMode","setValue","defaultPalette","modernPalette","palettes","material","mini","flat","contrast","willow","dark","getPalette","aSkin","optionHeight","palette","$name","SidePopupView","save","inputWidth","click","Save","compactBar","padding","layoutPadding","form","right","elements","hide","controls","Delete","updateConfig","close","fullscreen","head","suggest","onHide","Form","splice","Cals","Ops","getItem","setValues","color","active","focus","getValues","updateCalendar","addCalendar","removeCalendar","relative","rows","UpdateColor","onClick","webix_template","ShowEditor","Editor","EditorView","node","Cid","Show","SideView","Compact","calendar","monthSelect","onAfterDateSelect","dayStart","ListType","autoheight","yCount","editable","editValue","editaction","editor","webix_scheduler_cal_edit","ShowPopup","webix_scheduler_cal_title","ToggleCalendar","webix_scheduler_active","onBeforeEditStop","v","SetTitle","side","maxHeight","readonly","AddCalendar","onAfterScroll","Popup","Hide","Data","PopupView","EditAbility","unselectAll","ToggleState","checkbox","common","edit","env","touch","getEditor","getInputNode","setAttribute","select","getItemNode","EditStopSilent","fail","blockEvent","editCancel","editStop","unblockEvent","NavPopupView","animate","tHeight","tabbarHeight","Parent","updatePos","getBoundingClientRect","TopBarView","todayIcon","batch","SetToday","todayBtn","responsive","paddingY","paddingX","visibleBatch","ShowNav","responsiveCell","NavPopup","ToggleAdd","EventActionMenu","onMenuItemClick","Result","Root","shrinkTo","ev","before","start_date","after","end_date","isToday","equal","datePart","isMultiDay","all_day","getDate","daysBetweenInclusive","round","isSameDate","adate","bdate","icalFormat","string","_a","name_1","UNTIL","strToDate","EXDATE","map","d","serialize","WEEKDAYS","FREQUENCE","DAILY","WEEKLY","MONTHLY","YEARLY","findDate","arr","fillWdays","consts","BYDAY","wdays","line","sort","s","j","INTERVAL","FREQ","getDay","BYYEARDAY","setFullYear","getFullYear","setMonth","BYMONTHDAY","BYSETPOS","checkDay","sdate","days","oldDay","WeekdaysToDates","getParams","$id","$recurring","extractDate","clipSequence","block","COUNT","filter","cutOccurrence","separateSequence","len","isFirstOccurrence","evStart","correctMode","origin_id","recurring","isLastPart","movePattern","rec","newEvent","oldEvent","until","nmd","nwn","getWeekNum","BYMONTH","nm","day","floor","checkPattern","RecurringFormView","elementsConfig","labelPosition","bottom","CreateIntervalControls","CreateCheckboxes","CreateSelect","CreateRadio","o","m","UpdateEvent","Events","CheckBoxContainer","Checkboxes","getChildViews","pop","PatternSelect","UntilDateContainer","UntilDateCalendar","untilDate","getPopup","getBody","UntilNumContainer","UntilNum","CustomRecControls","margin","labelWidth","min","ChangeControls","_freq","getValue","getList","dayShort","labelAlign","CheckboxGuard","gravity","isUndefined","GetBYDAY","values","check","find","byDay","dayFull","monthFull","onShow","calculated","month","weekNum","weekday","yearday","rec_pattern","vertical","ChangeSelectors","icons","_StartDate","untilCount","CountNum","minDate","SetUNTIL","SetBYDAY","SetPatternOptions","setDirty","GetUntil","GetRecPattern","change","GetValues","isDirty","changeMode","date_id","correctCountUntil","collection","oid","b","last","countToUntil","nexto","cutCount","hasOneOccurrence","lr","EditRecurringMixin","ChangeMode","CorrectCountUntil","HasOneOccurrence","EventFormView","hotkey","Close","Done","scroll","GetDateTime","labelRight","ToggleTimeControls","CreateCalendarColor","getDirtyValues","PrepareChange","Wait","CreateRepeat","CreateUnitSelector","CreateSectionSelector","Local","RecurringOptions","StartTime","EndTime","_v","local","Calendars","waitUnits","combo_1","Sections","sections","SubForm","ClearTempEvent","FillForm","labelTopHeight","ToggleSubform","ShowSubForm","unshift","Id","clipboard","NewEvent","FillFormContinue","AdaptObjToMode","start_time","end_time","SetRecurring","yearStart","today","GetFromStartDate","roptions","ResetRecurringOptions","SetValues","rec_option","toLowerCase","time","timePart","GetStartDate","details","section","getFirstId","first","$color","unit","minutes","ceil","getMinutes","setHours","getHours","PrepareOut","_inProgress","addEvent","UpdateExisting","UpdateSelection","finally","sid","newEvent_1","updateEvent","recVals","fvals","Join","ProcessRecurringOption","ProcessRecurringPattern","ProcessDates","ApplyDatechangeToRecurring","ProcessText","_changedValues","series_end_date","GetRecurring","edate","datesToWeekdays","CorrectDateTime","ev_length","opposite","field","prev","trim","oldStart","length_1","r","GetRecurringPreset","dirty","UpdateStateDate","GetClosestOccurrenceDate","temp","GetModeBounds","weekStart","weeks","exists","remove","Back","Subform","IsDirty","subform","HideSubPop","getTopParentView","exit","FormPopup","UIManager","addHotKey","removeHotKey","cleanEventData","HandleCopyPaste","clipboardModes","ctrlKey","isMac","AddToClipboard","PasteFromClipboard","PurgeClipboard","setFocus","RestoreClipboardSource","$multi","_globalClickHandler","List","ChangePasteTarget","CreatePasteTarget","OnDestroy","eventRemove","getScrollState","clientX","offsetLeft","y","clientY","offsetTop","mousePosUnit","Scales","cellWidth","create","sheight","GetSectionHeight","style","position","firstChild","insertBefore","childNodes","SetPasteTargetStyle","ClearPasteTargetStyle","removeChild","locateEvent","querySelectorAll","sel","SetClipboardSourceStyle","event_1","GetEvent","className","prevCss","clip","GetEventData","CopyEvent","MoveEvent","evLength","GetTargetDate","Unit","sec","updateId","CopyPasteMixin","mainWidget","multi","BRIGHTNESS","FONT","EventView","bar","StartAction","copypaste","InfoTemplate","UnitsLocal","action","EventObj","Menu","DeleteEvent","EditEvent","title","removeEvent","removal","oneday","allday","timeFormatStr","startDate","endDate","startTime","endTime","fromTo","GetRecurringText","unitIDs_1","isLast","unitObj","unitValue","GetSection","pattern","EventActionPopup","buttons","layoutMargin","Cancel","MainView","sizeTrigger","_compactValue","_compactHandler","_app","_forceCompact","forceCompact","_compactWidth","compactWidth","_checkTrigger","$setSize","fCompact","topbar","cells","SetCompactMode","ProgressBar","showProgress","delay","hideProgress","ToggleEvent","ToggleSidePanel","_dndActionPopup","ShowEvent","HideEvent","sameEvent","_sidePanel","getDimmedColor","hex","toRgb","red","green","blue","rgbToHsv","hexToHsv","hue","saturation","hsvToRgb","marker","$past","timeStart","dayEventColor","$textColor","fill","size","master","templateStart","marks","classname","aria","UnitListView","uniteBy","templateHeader","TemplateHeader","TimeStart","onUnits","SetUnits","OverlayBox","hideOverlay","showOverlay","start_1","this_1","AgendaView","headerHeight","TemplateCss","onItemRender","$unit","CurrentUnit","SelectEvent","RefreshData","_o","monthStart","getEvents","clearAll","ToggleOverlay","_selected","datestring","fstring","ids","getUnitList","HourscaleView","heightSize","ind","getIndexById","HourScaleItem","ParseHours","h","MultiMoreView","wxi-angle-down","ExpandData","wxi-angle-up","WrapData","MoreIcon","_expandState","maxVisibleLines","transition","_inAnimation","SetMoreIcon","_select","functor","trgs","LocateSelected","Select","Unselect","HandleSelection","_SelectionMode","id_1","operation","SelectionMixin","inner","_DataObj","el","firstElementChild","locate","Resizer","$dragIn","getContext","from","$dragPos","ctx","box","offset","y_diff","updateNodeHeight","duration","updateText","x_diff","DragControl","getNode","max","minEventHeight","getActualDate","any","exports","addDays","inc","differenceInCalendarDays","getTime","differenceInHours","f_cache","formatFunction","startOnMonday","year","quarter","week","sign","hour","minute","smallerCount","innerDiff","precise","wt","minUnit","getUnitStart","addUnit","filled","getDiff","sameMonth","daysOfFirstMonth","me","months","getMonthDayDiff","getSizes","task","scales","taskHeight","cellHeight","astart","ms","$h","$x","$w","$y","getMilestone","getEnd","getEndWorkday","getDatePart","d_1","isHoliday","holidayGuard","getDuration","parseFloat","toFixed","toClosestWorkday","notRight","alert","toWorkday","getCheckDate","getTimePart","canvas","createElement","strokeStyle","moveTo","lineTo","stroke","toDataURL","top_1","p","item","getMinUnit","tempEnd","fullWidth","fullHeight","countInWeeks","cdate","cnext","startTask","endTask","sx","sy","ex","ey","dy","$p","s_start","e_start","differentX","lineCoords","gapp","sx1","ex1","dx","same","getLineCoords","arrowCoords","$data","k","excludeHolidays","DragScroll","_auto_scroll_delay","autoScroll","clearTimeout","yScroll","direction","xScroll","autoYScroll","senseY","autoXScroll","senseX","updateDragPos","sense","autoScrollTo","snode","scrollWidth","scrollTo","initDnD","dragOnly","ctrl","modes","addDrag","addDrop","attr","updateSelection","selection","editRecurring","newSubEvent","joinDateTime","shiftDate","mainDate","occDate","changeDate","ddate","dtime","$longTouchLimit","$dragDestroy","$waitUpdate","visibility","$resize","moveMode","more","setDragOffset","x_offset","y_offset","_waitPopup","finishOperation","copyEvent","appendChild","$drop","to","$creation","$copy","$last_y","$dragCreate","cloneNode","metaKey","dragCreate","scrollY_1","parentTopOffset","$top","$left","calId","ToHTML","Day","delta","getMaster","EventTemplate","noff","toff","getIdByIndex","$marked","markDropArea","$dragOut","drop","drag_container","$extra","extra","getLastId","xCount","multiday","children","ID","HideWindow","getEventUnits","sourceUnit","currentUnits","targetUnit","newUnits","multidayUnits","dragScroll","nscroll","getEventContext","pointer","$touch","evContext","getMoveMode","scroll_1","getStep","parseInt","l","updateDragScrollConfig","changedTouches","touches","pageX","pageY","getData","offsetDate","wrongDates","us","updateEventDates","nsc","allDay","rect","minWidth","ds","timelineMore","offsetParent","WeekDayNum","DayEventsView","webix_scheduler_day_event","onDblClick","webix_scheduler_day_scale_item","_e","ShowNew","RenderEvents","mobile","FilterToday","_marker_update_interval","UpdateMarkerPosition","_Marker","single","class","evs","PrepareEvents","role","MarkToday","$inner","orderSet","PruneStack","$sorder","max_count","SetPosition","GetEventEndDate","$count","temp_width","evCorrectedCopy","sm","em","content","EventTemplateStart","resizer","MultidayEventList","webix_scheduler_multiday_event","_moreBtn","$css","LimitData","GetStyle","excess","_reserve","_reserveIds","Animate","DayView","ScrollScale","GetDay","CalendarView","isOutside","MarkEvent","navigation","monthHeader","skipEmptyWeeks","Calendar","c","drag","MoreWindowView","minHeight","webix_scheduler_month_event","webix_scheduler_month_event_single","MoreTemplate","Win","_c","oneDay","DayFormatStr","MonthEventsView","prerender","webix_cal_date","_ev","ShowDay","webix_scheduler_more","ShowMore","webix_cal_day","CalendarTemplate","eventHeight","MoreWindow","dynamic","$more","GetDayCss","maxLines","wStart","wEnd","cache","each","dayIndex","dayHTML","IsSingleDay","es","ee","ls","le","prevLength","GetPosition","row","col","start_a","start_b","days_a","monthData","GetMonthData","ShowWindow","MonthHeaderView","GetHeaderData","MonthListView","MonthView","BarView","barHeight","MoreView","clientWidth","ChartView","header","rowHeight","scrollAlignY","columns","fillspace","webix_scheduler_timeline_event","webix_list_item","Tree","Bars","InnerState","scheme","$change","RefreshTask","_sectionsReady","HandleScroll","_mousemove_handler","pointerType","cursor","switchCursor","DrawGrid","_sectionSize","borderWidth","ClearCollections","_processed","_lastRow","_moreEvents","updID","sectionIndex","order","GetUnitCount","CheckDates","prev_1","GetUnitStart","findIndex","UpdateTask","$hide","MoreBarTemplate","BarsTemplate","backgroundImage","GetGrid","marginTop","backgroundPosition","Resize","area","querySelector","_scroll_handler","bars","scrollTop","scrollLeft","GetUnitWidth","GetTooltip","offsetX","AddUnit","clickedUnit","grid","updateTask","number","ScalesView","scale","innerState","RenderScales","cell","CellTemplate","TimelineView","ScaleView","SetScales","ResetScales","parser","wstart","wend","GetDefaultScaleUnit","resetScales","GetScalePrecision","GetScalesCellWidth","GetScalesArray","UnitEventsView","unitID","UnitsHeaderView","Header","Units","unitsCache","sync","UnitMultidayList","FilterByUnits","expandable","multiEvents","UnitMultidayView","UnitsView","WeekEventsView","WeekHeaderView","MultiDayEventsView","itemHeight","ParseDays","BreakEventsByDay","_maxEvents","ResetListHeight","Days","processed","$config","allEvents","renderedEvents","toHide","_day","visible","MoreOption","cIndex","rIndex","GetSizePosition","WeekView","GetWeek","_month","YearCalendarView","DayEvents","calendarHeader","webix_cal_day_with_event","ShowEvents","webix_cal_month","ShowMonth","SetStateDate","ManageDateChange","GetMonthStart","_date","MonthStart","showCalendar","monthEnd","dateKey","YearView","GetCalendars","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","m13","m14","m15","m16","m17","m18","m19","m20","m21","m22","m23","m24","m25","m26","m27","m28","m29","m30","m31","m32","m33","m34","m35","m36","m37","m38","m39","m40","m41","m42","m43","createEvents","events_ready","createCalendars","cals_ready","createUnits","units_ready","_sections","createSections","sections_ready","utc","serverUTC","parseFormat","dateToLocalStr","loaded_ranges","LocalData","isNaN","getColor","$serialize","eventOut","$export","force","getLocal","getDynamic","dimPastEvents","findCalendar","xdate","explodeEvent","isPast","roundTime","parseFormatStr","fromStr","$sort","by","as","sortCalendars","onAfterDelete","setActive","onAfterAdd","data->onDataUpdate","rgb","setMinutes","prop","Operations","tosave","updateItem","cev","isFirst","_url","Backend","ajax","json","post","recurring_update_mode","recurring_update_date","del","appId","defaults","appNode","addStyle","firstShow","defaultHandler","disable","use","App","locales","$exportView","export_mode","display","jetapp","services","Week","Month","Year","Agenda","Timeline","Today","Create","Next","Previous","Next day","Previous day","Next week","Previous week","Next month","Previous month","Add calendar","Do you really want to remove this calendar?","Edit calendar","Title","Color","Active","Settings","(no title)","Inactive calendar","No Events","All Day","Expand all-day events","Collapse all-day events","The event will be deleted permanently, are you sure?","Delete event","Edit","(No title)","Event","Start","End","Notes","Edit event","Assigned to units","No units","Unknown unit","never","none","daily","every","weekly","monthly","yearly","years","Repeat","End repeat","Repeats each","till","times","weekly, every","monthly, every","yearly, every","every working day","custom","Every","of","day of year","after several occurrences","week on","Change recurring pattern","Save changes?","All events","This event","This event and the following","Apply","Edit recurring event","Timeline scale","Section","Show more","Copy of","Copy event"],"mappings":"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"}
>>>>>>> 6388b01 (New widget Scheduler)
