{"version":3,"file":"scheduler.min.js","sources":["../node_modules/webix-jet/dist/es6/jet.js","../node_modules/jet-restate/index.js","../sources/views/bars/add.js","../sources/views/bars/date.js","../sources/views/bars/nav.js","../sources/helpers/palette.js","../sources/views/side/editor.js","../sources/views/side/popup.js","../sources/views/side/index.js","../sources/views/bars/navpopup.js","../sources/views/bars/index.js","../sources/views/event/actionmenu.js","../sources/helpers/ical.js","../sources/helpers/recurring.js","../sources/views/event/recurringform.js","../sources/helpers/editrecurring.js","../sources/views/event/form.js","../sources/views/event/formpopup.js","../sources/views/event/info.js","../sources/views/modes/common/actionpopup.js","../sources/helpers/responsive.js","../sources/views/main.js","../sources/helpers/templates.js","../sources/helpers/dates.js","../sources/views/modes/common/unitlist.js","../sources/views/modes/agenda/index.js","../sources/views/modes/common/hourscale.js","../sources/views/modes/common/multimore.js","../sources/helpers/selection.js","../sources/helpers/resizer.js","../sources/helpers/dnd.js","../sources/views/modes/day/events.js","../sources/views/modes/day/multiday.js","../sources/views/modes/day/index.js","../sources/views/modes/month/compact.js","../sources/views/modes/month/more.js","../sources/views/modes/month/events.js","../sources/views/modes/month/header.js","../sources/views/modes/month/list.js","../sources/views/modes/month/index.js","../sources/views/modes/week/compact.js","../sources/views/modes/week/header.js","../sources/views/modes/week/multiday.js","../sources/views/modes/week/index.js","../sources/export_views.js","../sources/models/LocalData.js","../sources/models/Operations.js","../sources/models/Backend.js","../sources/app.js","../sources/locales/en.js"],"sourcesContent":["class NavigationBlocked {\r\n}\n\nclass JetBase {\r\n    constructor(webix, config) {\r\n        this.webixJet = true;\r\n        this.webix = webix;\r\n        this._events = [];\r\n        this._subs = {};\r\n        this._data = {};\r\n        if (config && config.params)\r\n            webix.extend(this._data, config.params);\r\n    }\r\n    getRoot() {\r\n        return this._root;\r\n    }\r\n    destructor() {\r\n        this._detachEvents();\r\n        this._destroySubs();\r\n        this._events = this._container = this.app = this._parent = this._root = null;\r\n    }\r\n    setParam(id, value, url) {\r\n        if (this._data[id] !== value) {\r\n            this._data[id] = value;\r\n            this._segment.update(id, value, 0);\r\n            if (url) {\r\n                return this.show(null);\r\n            }\r\n        }\r\n    }\r\n    getParam(id, parent) {\r\n        const value = this._data[id];\r\n        if (typeof value !== \"undefined\" || !parent) {\r\n            return value;\r\n        }\r\n        const view = this.getParentView();\r\n        if (view) {\r\n            return view.getParam(id, parent);\r\n        }\r\n    }\r\n    getUrl() {\r\n        return this._segment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._segment.toString();\r\n    }\r\n    getParentView() {\r\n        return this._parent;\r\n    }\r\n    $$(id) {\r\n        if (typeof id === \"string\") {\r\n            const root = this.getRoot();\r\n            return root.queryView((obj => (obj.config.id === id || obj.config.localId === id) &&\r\n                (obj.$scope === root.$scope)), \"self\");\r\n        }\r\n        else {\r\n            return id;\r\n        }\r\n    }\r\n    on(obj, name, code) {\r\n        const id = obj.attachEvent(name, code);\r\n        this._events.push({ obj, id });\r\n        return id;\r\n    }\r\n    contains(view) {\r\n        for (const key in this._subs) {\r\n            const kid = this._subs[key].view;\r\n            if (kid === view || kid.contains(view)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    getSubView(name) {\r\n        const sub = this.getSubViewInfo(name);\r\n        if (sub) {\r\n            return sub.subview.view;\r\n        }\r\n    }\r\n    getSubViewInfo(name) {\r\n        const sub = this._subs[name || \"default\"];\r\n        if (sub) {\r\n            return { subview: sub, parent: this };\r\n        }\r\n        if (name === \"_top\") {\r\n            this._subs[name] = { url: \"\", id: null, popup: true };\r\n            return this.getSubViewInfo(name);\r\n        }\r\n        // when called from a child view, searches for nearest parent with subview\r\n        if (this._parent) {\r\n            return this._parent.getSubViewInfo(name);\r\n        }\r\n        return null;\r\n    }\r\n    _detachEvents() {\r\n        const events = this._events;\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            events[i].obj.detachEvent(events[i].id);\r\n        }\r\n    }\r\n    _destroySubs() {\r\n        // destroy sub views\r\n        for (const key in this._subs) {\r\n            const subView = this._subs[key].view;\r\n            // it possible that subview was not loaded with any content yet\r\n            // so check on null\r\n            if (subView) {\r\n                subView.destructor();\r\n            }\r\n        }\r\n        // reset to prevent memory leaks\r\n        this._subs = {};\r\n    }\r\n    _init_url_data() {\r\n        const url = this._segment.current();\r\n        this._data = {};\r\n        this.webix.extend(this._data, url.params, true);\r\n    }\r\n    _getDefaultSub() {\r\n        if (this._subs.default) {\r\n            return this._subs.default;\r\n        }\r\n        for (const key in this._subs) {\r\n            const sub = this._subs[key];\r\n            if (!sub.branch && sub.view && key !== \"_top\") {\r\n                const child = sub.view._getDefaultSub();\r\n                if (child) {\r\n                    return child;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _routed_view() {\r\n        const parent = this.getParentView();\r\n        if (!parent) {\r\n            return true;\r\n        }\r\n        const sub = parent._getDefaultSub();\r\n        if (!sub && sub !== this) {\r\n            return false;\r\n        }\r\n        return parent._routed_view();\r\n    }\r\n}\n\nfunction parse(url) {\r\n    // remove starting /\r\n    if (url[0] === \"/\") {\r\n        url = url.substr(1);\r\n    }\r\n    // split url by \"/\"\r\n    const parts = url.split(\"/\");\r\n    const chunks = [];\r\n    // for each page in url\r\n    for (let i = 0; i < parts.length; i++) {\r\n        const test = parts[i];\r\n        const result = {};\r\n        // detect params\r\n        // support old \t\t\tsome:a=b:c=d\r\n        // and new notation\t\tsome?a=b&c=d\r\n        let pos = test.indexOf(\":\");\r\n        if (pos === -1) {\r\n            pos = test.indexOf(\"?\");\r\n        }\r\n        if (pos !== -1) {\r\n            const params = test.substr(pos + 1).split(/[\\:\\?\\&]/g);\r\n            // create hash of named params\r\n            for (const param of params) {\r\n                const dchunk = param.split(\"=\");\r\n                result[dchunk[0]] = decodeURIComponent(dchunk[1]);\r\n            }\r\n        }\r\n        // store parsed values\r\n        chunks[i] = {\r\n            page: (pos > -1 ? test.substr(0, pos) : test),\r\n            params: result,\r\n            isNew: true\r\n        };\r\n    }\r\n    // return array of page objects\r\n    return chunks;\r\n}\r\nfunction url2str(stack) {\r\n    const url = [];\r\n    for (const chunk of stack) {\r\n        url.push(\"/\" + chunk.page);\r\n        const params = obj2str(chunk.params);\r\n        if (params) {\r\n            url.push(\"?\" + params);\r\n        }\r\n    }\r\n    return url.join(\"\");\r\n}\r\nfunction obj2str(obj) {\r\n    const str = [];\r\n    for (const key in obj) {\r\n        if (typeof obj[key] === \"object\")\r\n            continue;\r\n        if (str.length) {\r\n            str.push(\"&\");\r\n        }\r\n        str.push(key + \"=\" + encodeURIComponent(obj[key]));\r\n    }\r\n    return str.join(\"\");\r\n}\n\nclass Route {\r\n    constructor(route, index) {\r\n        this._next = 1;\r\n        if (typeof route === \"string\") {\r\n            this.route = {\r\n                url: parse(route),\r\n                path: route\r\n            };\r\n        }\r\n        else {\r\n            this.route = route;\r\n        }\r\n        this.index = index;\r\n    }\r\n    current() {\r\n        return this.route.url[this.index];\r\n    }\r\n    next() {\r\n        return this.route.url[this.index + this._next];\r\n    }\r\n    suburl() {\r\n        return this.route.url.slice(this.index);\r\n    }\r\n    shift(params) {\r\n        const route = new Route(this.route, this.index + this._next);\r\n        route.setParams(route.route.url, params, route.index);\r\n        return route;\r\n    }\r\n    setParams(url, params, index) {\r\n        if (params) {\r\n            const old = url[index].params;\r\n            for (var key in params)\r\n                old[key] = params[key];\r\n        }\r\n    }\r\n    refresh() {\r\n        const url = this.route.url;\r\n        for (let i = this.index + 1; i < url.length; i++) {\r\n            url[i].isNew = true;\r\n        }\r\n    }\r\n    toString() {\r\n        const str = url2str(this.suburl());\r\n        return str ? str.substr(1) : \"\";\r\n    }\r\n    _join(path, kids) {\r\n        let url = this.route.url;\r\n        if (path === null) { // change of parameters, route elements are not affected\r\n            return url;\r\n        }\r\n        const old = this.route.url;\r\n        let reset = true;\r\n        url = old.slice(0, this.index + (kids ? this._next : 0));\r\n        if (path) {\r\n            url = url.concat(parse(path));\r\n            for (let i = 0; i < url.length; i++) {\r\n                if (old[i]) {\r\n                    url[i].view = old[i].view;\r\n                }\r\n                if (reset && old[i] && url[i].page === old[i].page) {\r\n                    url[i].isNew = false;\r\n                }\r\n                else if (url[i].isNew) {\r\n                    // if some segment was marked as new, all subsegments must be updated as well\r\n                    reset = false;\r\n                }\r\n            }\r\n        }\r\n        return url;\r\n    }\r\n    append(path) {\r\n        const url = this._join(path, true);\r\n        this.route.path = url2str(url);\r\n        this.route.url = url;\r\n        return this.route.path;\r\n    }\r\n    show(path, view, kids) {\r\n        const url = this._join(path.url, kids);\r\n        this.setParams(url, path.params, this.index + (kids ? this._next : 0));\r\n        return new Promise((res, rej) => {\r\n            const redirect = url2str(url);\r\n            const obj = {\r\n                url,\r\n                redirect,\r\n                confirm: Promise.resolve()\r\n            };\r\n            const app = view ? view.app : null;\r\n            // when creating a new route, it possible that it will not have any content\r\n            // guard is not necessary in such case\r\n            if (app) {\r\n                const result = app.callEvent(\"app:guard\", [obj.redirect, view, obj]);\r\n                if (!result) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n            }\r\n            obj.confirm.catch(err => rej(err)).then(() => {\r\n                if (obj.redirect === null) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                if (obj.redirect !== redirect) {\r\n                    app.show(obj.redirect);\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                this.route.path = redirect;\r\n                this.route.url = url;\r\n                res();\r\n            });\r\n        });\r\n    }\r\n    size(n) {\r\n        this._next = n;\r\n    }\r\n    split() {\r\n        const route = {\r\n            url: this.route.url.slice(this.index + 1),\r\n            path: \"\"\r\n        };\r\n        if (route.url.length) {\r\n            route.path = url2str(route.url);\r\n        }\r\n        return new Route(route, 0);\r\n    }\r\n    update(name, value, index) {\r\n        const chunk = this.route.url[this.index + (index || 0)];\r\n        if (!chunk) {\r\n            this.route.url.push({ page: \"\", params: {} });\r\n            return this.update(name, value, index);\r\n        }\r\n        if (name === \"\") {\r\n            chunk.page = value;\r\n        }\r\n        else {\r\n            chunk.params[name] = value;\r\n        }\r\n        this.route.path = url2str(this.route.url);\r\n    }\r\n}\n\nclass JetView extends JetBase {\r\n    constructor(app, config) {\r\n        super(app.webix);\r\n        this.app = app;\r\n        //this.$config = config;\r\n        this._children = [];\r\n    }\r\n    ui(ui, config) {\r\n        config = config || {};\r\n        const container = config.container || ui.container;\r\n        const jetview = this.app.createView(ui);\r\n        this._children.push(jetview);\r\n        jetview.render(container, this._segment, this);\r\n        if (typeof ui !== \"object\" || (ui instanceof JetBase)) {\r\n            // raw webix UI\r\n            return jetview;\r\n        }\r\n        else {\r\n            return jetview.getRoot();\r\n        }\r\n    }\r\n    show(path, config) {\r\n        config = config || {};\r\n        // convert parameters object to url\r\n        if (typeof path === \"object\") {\r\n            for (const key in path) {\r\n                this.setParam(key, path[key]);\r\n            }\r\n            path = null;\r\n        }\r\n        else {\r\n            // deligate to app in case of root prefix\r\n            if (path.substr(0, 1) === \"/\") {\r\n                return this.app.show(path, config);\r\n            }\r\n            // local path, do nothing\r\n            if (path.indexOf(\"./\") === 0) {\r\n                path = path.substr(2);\r\n            }\r\n            // parent path, call parent view\r\n            if (path.indexOf(\"../\") === 0) {\r\n                const parent = this.getParentView();\r\n                if (parent) {\r\n                    return parent.show(path.substr(3), config);\r\n                }\r\n                else {\r\n                    return this.app.show(\"/\" + path.substr(3));\r\n                }\r\n            }\r\n            const sub = this.getSubViewInfo(config.target);\r\n            if (sub) {\r\n                if (sub.parent !== this) {\r\n                    return sub.parent.show(path, config);\r\n                }\r\n                else if (config.target && config.target !== \"default\") {\r\n                    return this._renderFrameLock(config.target, sub.subview, {\r\n                        url: path,\r\n                        params: config.params,\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                if (path) {\r\n                    return this.app.show(\"/\" + path, config);\r\n                }\r\n            }\r\n        }\r\n        return this._show(this._segment, { url: path, params: config.params }, this);\r\n    }\r\n    _show(segment, path, view) {\r\n        return segment.show(path, view, true).then(() => {\r\n            this._init_url_data();\r\n            return this._urlChange();\r\n        }).then(() => {\r\n            if (segment.route.linkRouter) {\r\n                this.app.getRouter().set(segment.route.path, { silent: true });\r\n                this.app.callEvent(\"app:route\", [segment.route.path]);\r\n            }\r\n        });\r\n    }\r\n    init(_$view, _$) {\r\n        // stub\r\n    }\r\n    ready(_$view, _$url) {\r\n        // stub\r\n    }\r\n    config() {\r\n        this.app.webix.message(\"View:Config is not implemented\");\r\n    }\r\n    urlChange(_$view, _$url) {\r\n        // stub\r\n    }\r\n    destroy() {\r\n        // stub\r\n    }\r\n    destructor() {\r\n        this.destroy();\r\n        this._destroyKids();\r\n        // destroy actual UI\r\n        if (this._root) {\r\n            this._root.destructor();\r\n            super.destructor();\r\n        }\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this.app, this, config);\r\n    }\r\n    refresh() {\r\n        const url = this.getUrl();\r\n        this.destroy();\r\n        this._destroyKids();\r\n        this._destroySubs();\r\n        this._detachEvents();\r\n        if (this._container.tagName) {\r\n            this._root.destructor();\r\n        }\r\n        this._segment.refresh();\r\n        return this._render(this._segment);\r\n    }\r\n    render(root, url, parent) {\r\n        if (typeof url === \"string\") {\r\n            url = new Route(url, 0);\r\n        }\r\n        this._segment = url;\r\n        this._parent = parent;\r\n        this._init_url_data();\r\n        root = root || document.body;\r\n        const _container = (typeof root === \"string\") ? this.webix.toNode(root) : root;\r\n        if (this._container !== _container) {\r\n            this._container = _container;\r\n            return this._render(url);\r\n        }\r\n        else {\r\n            return this._urlChange().then(() => this.getRoot());\r\n        }\r\n    }\r\n    _render(url) {\r\n        const config = this.config();\r\n        if (config.then) {\r\n            return config.then(cfg => this._render_final(cfg, url));\r\n        }\r\n        else {\r\n            return this._render_final(config, url);\r\n        }\r\n    }\r\n    _render_final(config, url) {\r\n        // get previous view in the same slot\r\n        let slot = null;\r\n        let container = null;\r\n        let show = false;\r\n        if (!this._container.tagName) {\r\n            slot = this._container;\r\n            if (slot.popup) {\r\n                container = document.body;\r\n                show = true;\r\n            }\r\n            else {\r\n                container = this.webix.$$(slot.id);\r\n            }\r\n        }\r\n        else {\r\n            container = this._container;\r\n        }\r\n        // view already destroyed\r\n        if (!this.app || !container) {\r\n            return Promise.reject(null);\r\n        }\r\n        let response;\r\n        const current = this._segment.current();\r\n        // using wrapper object, so ui can be changed from app:render event\r\n        const result = { ui: {} };\r\n        this.app.copyConfig(config, result.ui, this._subs);\r\n        this.app.callEvent(\"app:render\", [this, url, result]);\r\n        result.ui.$scope = this;\r\n        /* destroy old HTML attached views before creating new one */\r\n        if (!slot && current.isNew && current.view) {\r\n            current.view.destructor();\r\n        }\r\n        try {\r\n            // special handling for adding inside of multiview - preserve old id\r\n            if (slot && !show) {\r\n                const oldui = container;\r\n                const parent = oldui.getParentView();\r\n                if (parent && parent.name === \"multiview\" && !result.ui.id) {\r\n                    result.ui.id = oldui.config.id;\r\n                }\r\n            }\r\n            this._root = this.app.webix.ui(result.ui, container);\r\n            const asWin = this._root;\r\n            // check for url added to ignore this.ui calls\r\n            if (show && asWin.setPosition && !asWin.isVisible()) {\r\n                asWin.show();\r\n            }\r\n            // check, if we are replacing some older view\r\n            if (slot) {\r\n                if (slot.view && slot.view !== this && slot.view !== this.app) {\r\n                    slot.view.destructor();\r\n                }\r\n                slot.id = this._root.config.id;\r\n                if (this.getParentView() || !this.app.app)\r\n                    slot.view = this;\r\n                else {\r\n                    // when we have subapp, set whole app as a view\r\n                    // so on destruction, the whole app will be destroyed\r\n                    slot.view = this.app;\r\n                }\r\n            }\r\n            if (current.isNew) {\r\n                current.view = this;\r\n                current.isNew = false;\r\n            }\r\n            response = Promise.resolve(this._init(this._root, url)).then(() => {\r\n                return this._urlChange().then(() => {\r\n                    this._initUrl = null;\r\n                    return this.ready(this._root, url.suburl());\r\n                });\r\n            });\r\n        }\r\n        catch (e) {\r\n            response = Promise.reject(e);\r\n        }\r\n        return response.catch(err => this._initError(this, err));\r\n    }\r\n    _init(view, url) {\r\n        return this.init(view, url.suburl());\r\n    }\r\n    _urlChange() {\r\n        this.app.callEvent(\"app:urlchange\", [this, this._segment]);\r\n        const waits = [];\r\n        for (const key in this._subs) {\r\n            const frame = this._subs[key];\r\n            const wait = this._renderFrameLock(key, frame, null);\r\n            if (wait) {\r\n                waits.push(wait);\r\n            }\r\n        }\r\n        return Promise.all(waits).then(() => {\r\n            return this.urlChange(this._root, this._segment.suburl());\r\n        });\r\n    }\r\n    _renderFrameLock(key, frame, path) {\r\n        // if subview is not occupied by some rendering yet\r\n        if (!frame.lock) {\r\n            // retreive and store rendering end promise\r\n            const lock = this._renderFrame(key, frame, path);\r\n            if (lock) {\r\n                // clear lock after frame rendering\r\n                // as promise.finally is not supported by  Webix lesser than 6.2\r\n                // using a more verbose notation\r\n                frame.lock = lock.then(() => frame.lock = null, () => frame.lock = null);\r\n            }\r\n        }\r\n        // return rendering end promise\r\n        return frame.lock;\r\n    }\r\n    _renderFrame(key, frame, path) {\r\n        //default route\r\n        if (key === \"default\") {\r\n            if (this._segment.next()) {\r\n                // we have a next segment in url, render it\r\n                let params = path ? path.params : null;\r\n                if (frame.params) {\r\n                    params = this.webix.extend(params || {}, frame.params);\r\n                }\r\n                return this._createSubView(frame, this._segment.shift(params));\r\n            }\r\n            else if (frame.view && frame.popup) {\r\n                // there is no next segment, delete the existing sub-view\r\n                frame.view.destructor();\r\n                frame.view = null;\r\n            }\r\n        }\r\n        //if new path provided, set it to the frame\r\n        if (path !== null) {\r\n            frame.url = path.url;\r\n            if (frame.params) {\r\n                path.params = this.webix.extend(path.params || {}, frame.params);\r\n            }\r\n        }\r\n        // in case of routed sub-view\r\n        if (frame.route) {\r\n            // we have a new path for sub-view\r\n            if (path !== null) {\r\n                return frame.route.show(path, frame.view).then(() => {\r\n                    return this._createSubView(frame, frame.route);\r\n                });\r\n            }\r\n            // do not trigger onChange for isolated sub-views\r\n            if (frame.branch) {\r\n                return;\r\n            }\r\n        }\r\n        let view = frame.view;\r\n        // if view doesn't exists yet, init it\r\n        if (!view && frame.url) {\r\n            if (typeof frame.url === \"string\") {\r\n                // string, so we have isolated subview url\r\n                frame.route = new Route(frame.url, 0);\r\n                if (path)\r\n                    frame.route.setParams(frame.route.route.url, path.params, 0);\r\n                if (frame.params)\r\n                    frame.route.setParams(frame.route.route.url, frame.params, 0);\r\n                return this._createSubView(frame, frame.route);\r\n            }\r\n            else {\r\n                // object, so we have an embeded subview\r\n                if (typeof frame.url === \"function\" && !(view instanceof frame.url)) {\r\n                    view = new (this.app._override(frame.url))(this.app, \"\");\r\n                }\r\n                if (!view) {\r\n                    view = frame.url;\r\n                }\r\n            }\r\n        }\r\n        // trigger onChange for already existed view\r\n        if (view) {\r\n            return view.render(frame, (frame.route || this._segment), this);\r\n        }\r\n    }\r\n    _initError(view, err) {\r\n        /*\r\n            if view is destroyed, ignore any view related errors\r\n        */\r\n        if (this.app) {\r\n            this.app.error(\"app:error:initview\", [err, view]);\r\n        }\r\n        return true;\r\n    }\r\n    _createSubView(sub, suburl) {\r\n        return this.app.createFromURL(suburl.current()).then(view => {\r\n            return view.render(sub, suburl, this);\r\n        });\r\n    }\r\n    _destroyKids() {\r\n        // destroy child views\r\n        const uis = this._children;\r\n        for (let i = uis.length - 1; i >= 0; i--) {\r\n            if (uis[i] && uis[i].destructor) {\r\n                uis[i].destructor();\r\n            }\r\n        }\r\n        // reset vars for better GC processing\r\n        this._children = [];\r\n    }\r\n}\n\n// wrapper for raw objects and Jet 1.x structs\r\nclass JetViewRaw extends JetView {\r\n    constructor(app, config) {\r\n        super(app, config);\r\n        this._ui = config.ui;\r\n    }\r\n    config() {\r\n        return this._ui;\r\n    }\r\n}\n\nclass SubRouter {\r\n    constructor(cb, config, app) {\r\n        this.path = \"\";\r\n        this.app = app;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        const a = this.app;\r\n        a.app.getRouter().set(a._segment.append(this.path), { silent: true });\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nlet _once = true;\r\nclass JetAppBase extends JetBase {\r\n    constructor(config) {\r\n        const webix = (config || {}).webix || window.webix;\r\n        config = webix.extend({\r\n            name: \"App\",\r\n            version: \"1.0\",\r\n            start: \"/home\"\r\n        }, config, true);\r\n        super(webix, config);\r\n        this.config = config;\r\n        this.app = this.config.app;\r\n        this.ready = Promise.resolve();\r\n        this._services = {};\r\n        this.webix.extend(this, this.webix.EventSystem);\r\n    }\r\n    getUrl() {\r\n        return this._subSegment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._subSegment.toString();\r\n    }\r\n    getService(name) {\r\n        let obj = this._services[name];\r\n        if (typeof obj === \"function\") {\r\n            obj = this._services[name] = obj(this);\r\n        }\r\n        return obj;\r\n    }\r\n    setService(name, handler) {\r\n        this._services[name] = handler;\r\n    }\r\n    destructor() {\r\n        this.getSubView().destructor();\r\n        super.destructor();\r\n    }\r\n    // copy object and collect extra handlers\r\n    copyConfig(obj, target, config) {\r\n        // raw ui config\r\n        if (obj instanceof JetBase ||\r\n            (typeof obj === \"function\" && obj.prototype instanceof JetBase)) {\r\n            obj = { $subview: obj };\r\n        }\r\n        // subview placeholder\r\n        if (typeof obj.$subview != \"undefined\") {\r\n            return this.addSubView(obj, target, config);\r\n        }\r\n        // process sub-properties\r\n        const isArray = obj instanceof Array;\r\n        target = target || (isArray ? [] : {});\r\n        for (const method in obj) {\r\n            let point = obj[method];\r\n            // view class\r\n            if (typeof point === \"function\" && point.prototype instanceof JetBase) {\r\n                point = { $subview: point };\r\n            }\r\n            if (point && typeof point === \"object\" &&\r\n                !(point instanceof this.webix.DataCollection) && !(point instanceof RegExp) && !(point instanceof Map)) {\r\n                if (point instanceof Date) {\r\n                    target[method] = new Date(point);\r\n                }\r\n                else {\r\n                    const copy = this.copyConfig(point, (point instanceof Array ? [] : {}), config);\r\n                    if (copy !== null) {\r\n                        if (isArray)\r\n                            target.push(copy);\r\n                        else\r\n                            target[method] = copy;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                target[method] = point;\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n    getRouter() {\r\n        return this.$router;\r\n    }\r\n    clickHandler(e, target) {\r\n        if (e) {\r\n            target = target || (e.target || e.srcElement);\r\n            if (target && target.getAttribute) {\r\n                const trigger = target.getAttribute(\"trigger\");\r\n                if (trigger) {\r\n                    this._forView(target, view => view.app.trigger(trigger));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n                const route = target.getAttribute(\"route\");\r\n                if (route) {\r\n                    this._forView(target, view => view.show(route));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n            }\r\n        }\r\n        const parent = target.parentNode;\r\n        if (parent) {\r\n            this.clickHandler(e, parent);\r\n        }\r\n    }\r\n    getRoot() {\r\n        return this.getSubView().getRoot();\r\n    }\r\n    refresh() {\r\n        if (!this._subSegment) {\r\n            return Promise.resolve(null);\r\n        }\r\n        return this.getSubView().refresh().then(view => {\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return view;\r\n        });\r\n    }\r\n    loadView(url) {\r\n        const views = this.config.views;\r\n        let result = null;\r\n        if (url === \"\") {\r\n            return Promise.resolve(this._loadError(\"\", new Error(\"Webix Jet: Empty url segment\")));\r\n        }\r\n        try {\r\n            if (views) {\r\n                if (typeof views === \"function\") {\r\n                    // custom loading strategy\r\n                    result = views(url);\r\n                }\r\n                else {\r\n                    // predefined hash\r\n                    result = views[url];\r\n                }\r\n                if (typeof result === \"string\") {\r\n                    url = result;\r\n                    result = null;\r\n                }\r\n            }\r\n            if (!result) {\r\n                if (url === \"_hidden\") {\r\n                    result = { hidden: true };\r\n                }\r\n                else if (url === \"_blank\") {\r\n                    result = {};\r\n                }\r\n                else {\r\n                    url = url.replace(/\\./g, \"/\");\r\n                    result = this.require(\"jet-views\", url);\r\n                }\r\n            }\r\n        }\r\n        catch (e) {\r\n            result = this._loadError(url, e);\r\n        }\r\n        // custom handler can return view or its promise\r\n        if (!result.then) {\r\n            result = Promise.resolve(result);\r\n        }\r\n        // set error handler\r\n        result = result\r\n            .then(module => module.__esModule ? module.default : module)\r\n            .catch(err => this._loadError(url, err));\r\n        return result;\r\n    }\r\n    _forView(target, handler) {\r\n        const view = this.webix.$$(target);\r\n        if (view) {\r\n            handler(view.$scope);\r\n        }\r\n    }\r\n    _loadViewDynamic(url) {\r\n        return null;\r\n    }\r\n    createFromURL(chunk) {\r\n        let view;\r\n        if (chunk.isNew || !chunk.view) {\r\n            view = this.loadView(chunk.page)\r\n                .then(ui => this.createView(ui, name, chunk.params));\r\n        }\r\n        else {\r\n            view = Promise.resolve(chunk.view);\r\n        }\r\n        return view;\r\n    }\r\n    _override(ui) {\r\n        const over = this.config.override;\r\n        if (over) {\r\n            let dv;\r\n            while (ui) {\r\n                dv = ui;\r\n                ui = over.get(ui);\r\n            }\r\n            return dv;\r\n        }\r\n        return ui;\r\n    }\r\n    createView(ui, name, params) {\r\n        ui = this._override(ui);\r\n        let obj;\r\n        if (typeof ui === \"function\") {\r\n            if (ui.prototype instanceof JetAppBase) {\r\n                // UI class\r\n                return new ui({ app: this, name, params, router: SubRouter });\r\n            }\r\n            else if (ui.prototype instanceof JetBase) {\r\n                // UI class\r\n                return new ui(this, { name, params });\r\n            }\r\n            else {\r\n                // UI factory functions\r\n                ui = ui(this);\r\n            }\r\n        }\r\n        if (ui instanceof JetBase) {\r\n            obj = ui;\r\n        }\r\n        else {\r\n            // UI object\r\n            obj = new JetViewRaw(this, { name, ui });\r\n        }\r\n        return obj;\r\n    }\r\n    // show view path\r\n    show(url, config) {\r\n        if (url && this.app && url.indexOf(\"//\") == 0)\r\n            return this.app.show(url.substr(1), config);\r\n        return this.render(this._container, url || this.config.start, config);\r\n    }\r\n    // event helpers\r\n    trigger(name, ...rest) {\r\n        this.apply(name, rest);\r\n    }\r\n    apply(name, data) {\r\n        this.callEvent(name, data);\r\n    }\r\n    action(name) {\r\n        return this.webix.bind(function (...rest) {\r\n            this.apply(name, rest);\r\n        }, this);\r\n    }\r\n    on(name, handler) {\r\n        this.attachEvent(name, handler);\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this, null, config);\r\n    }\r\n    error(name, er) {\r\n        this.callEvent(name, er);\r\n        this.callEvent(\"app:error\", er);\r\n        /* tslint:disable */\r\n        if (this.config.debug) {\r\n            for (var i = 0; i < er.length; i++) {\r\n                console.error(er[i]);\r\n                if (er[i] instanceof Error) {\r\n                    let text = er[i].message;\r\n                    if (text.indexOf(\"Module build failed\") === 0) {\r\n                        text = text.replace(/\\x1b\\[[0-9;]*m/g, \"\");\r\n                        document.body.innerHTML = `<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>${text}</pre>`;\r\n                    }\r\n                    else {\r\n                        text += \"<br><br>Check console for more details\";\r\n                        this.webix.message({ type: \"error\", text: text, expire: -1 });\r\n                    }\r\n                }\r\n            }\r\n            debugger;\r\n        }\r\n        /* tslint:enable */\r\n    }\r\n    // renders top view\r\n    render(root, url, config) {\r\n        this._container = (typeof root === \"string\") ?\r\n            this.webix.toNode(root) :\r\n            (root || document.body);\r\n        const firstInit = !this.$router;\r\n        let path = null;\r\n        if (firstInit) {\r\n            if (_once && \"tagName\" in this._container) {\r\n                this.webix.event(document.body, \"click\", e => this.clickHandler(e));\r\n                _once = false;\r\n            }\r\n            if (typeof url === \"string\") {\r\n                url = new Route(url, 0);\r\n            }\r\n            this._subSegment = this._first_start(url);\r\n            this._subSegment.route.linkRouter = true;\r\n        }\r\n        else {\r\n            if (typeof url === \"string\") {\r\n                path = url;\r\n            }\r\n            else {\r\n                if (this.app) {\r\n                    path = url.split().route.path || this.config.start;\r\n                }\r\n                else {\r\n                    path = url.toString();\r\n                }\r\n            }\r\n        }\r\n        const params = config ? config.params : this.config.params || null;\r\n        const top = this.getSubView();\r\n        const segment = this._subSegment;\r\n        const ready = segment\r\n            .show({ url: path, params }, top)\r\n            .then(() => this.createFromURL(segment.current()))\r\n            .then(view => view.render(root, segment))\r\n            .then(base => {\r\n            this.$router.set(segment.route.path, { silent: true });\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return base;\r\n        });\r\n        this.ready = this.ready.then(() => ready);\r\n        return ready;\r\n    }\r\n    getSubView() {\r\n        if (this._subSegment) {\r\n            const view = this._subSegment.current().view;\r\n            if (view)\r\n                return view;\r\n        }\r\n        return new JetView(this, {});\r\n    }\r\n    require(type, url) { return null; }\r\n    _first_start(route) {\r\n        this._segment = route;\r\n        const cb = (a) => setTimeout(() => {\r\n            this.show(a).catch(e => {\r\n                if (!(e instanceof NavigationBlocked))\r\n                    throw e;\r\n            });\r\n        }, 1);\r\n        this.$router = new (this.config.router)(cb, this.config, this);\r\n        // start animation for top-level app\r\n        if (this._container === document.body && this.config.animation !== false) {\r\n            const node = this._container;\r\n            this.webix.html.addCss(node, \"webixappstart\");\r\n            setTimeout(() => {\r\n                this.webix.html.removeCss(node, \"webixappstart\");\r\n                this.webix.html.addCss(node, \"webixapp\");\r\n            }, 10);\r\n        }\r\n        if (!route) {\r\n            // if no url defined, check router first\r\n            let urlString = this.$router.get();\r\n            if (!urlString) {\r\n                urlString = this.config.start;\r\n                this.$router.set(urlString, { silent: true });\r\n            }\r\n            route = new Route(urlString, 0);\r\n        }\r\n        else if (this.app) {\r\n            const now = route.current().view;\r\n            route.current().view = this;\r\n            if (route.next()) {\r\n                route.refresh();\r\n                route = route.split();\r\n            }\r\n            else {\r\n                route = new Route(this.config.start, 0);\r\n            }\r\n            route.current().view = now;\r\n        }\r\n        return route;\r\n    }\r\n    // error during view resolving\r\n    _loadError(url, err) {\r\n        this.error(\"app:error:resolve\", [err, url]);\r\n        return { template: \" \" };\r\n    }\r\n    addSubView(obj, target, config) {\r\n        const url = obj.$subview !== true ? obj.$subview : null;\r\n        const name = obj.name || (url ? this.webix.uid() : \"default\");\r\n        target.id = obj.id || \"s\" + this.webix.uid();\r\n        const view = config[name] = {\r\n            id: target.id,\r\n            url,\r\n            branch: obj.branch,\r\n            popup: obj.popup,\r\n            params: obj.params\r\n        };\r\n        return view.popup ? null : target;\r\n    }\r\n}\n\nclass HashRouter {\r\n    constructor(cb, config) {\r\n        this.config = config || {};\r\n        this._detectPrefix();\r\n        this.cb = cb;\r\n        window.onpopstate = () => this.cb(this.get());\r\n    }\r\n    set(path, config) {\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            for (const key in this.config.routes) {\r\n                if (this.config.routes[key] === compare[0]) {\r\n                    path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (this.get() !== path) {\r\n            window.history.pushState(null, null, this.prefix + this.sufix + path);\r\n        }\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        let path = this._getRaw().replace(this.prefix, \"\").replace(this.sufix, \"\");\r\n        path = (path !== \"/\" && path !== \"#\") ? path : \"\";\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            const key = this.config.routes[compare[0]];\r\n            if (key) {\r\n                path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n            }\r\n        }\r\n        return path;\r\n    }\r\n    _detectPrefix() {\r\n        // use \"#!\" for backward compatibility\r\n        const sufix = this.config.routerPrefix;\r\n        this.sufix = \"#\" + ((typeof sufix === \"undefined\") ? \"!\" : sufix);\r\n        this.prefix = document.location.href.split(\"#\", 2)[0];\r\n    }\r\n    _getRaw() {\r\n        return document.location.href;\r\n    }\r\n}\n\nlet isPatched = false;\r\nfunction patch(w) {\r\n    if (isPatched || !w) {\r\n        return;\r\n    }\r\n    isPatched = true;\r\n    // custom promise for IE8\r\n    const win = window;\r\n    if (!win.Promise) {\r\n        win.Promise = w.promise;\r\n    }\r\n    const version = w.version.split(\".\");\r\n    // will be fixed in webix 5.3\r\n    if (version[0] * 10 + version[1] * 1 < 53) {\r\n        w.ui.freeze = function (handler) {\r\n            // disabled because webix jet 5.0 can't handle resize of scrollview correctly\r\n            // w.ui.$freeze = true;\r\n            const res = handler();\r\n            if (res && res.then) {\r\n                res.then(function (some) {\r\n                    w.ui.$freeze = false;\r\n                    w.ui.resize();\r\n                    return some;\r\n                });\r\n            }\r\n            else {\r\n                w.ui.$freeze = false;\r\n                w.ui.resize();\r\n            }\r\n            return res;\r\n        };\r\n    }\r\n    // adding views as classes\r\n    const baseAdd = w.ui.baselayout.prototype.addView;\r\n    const baseRemove = w.ui.baselayout.prototype.removeView;\r\n    const config = {\r\n        addView(view, index) {\r\n            // trigger logic only for widgets inside of jet-view\r\n            // ignore case when addView used with already initialized widget\r\n            if (this.$scope && this.$scope.webixJet && !view.queryView) {\r\n                const jview = this.$scope;\r\n                const subs = {};\r\n                view = jview.app.copyConfig(view, {}, subs);\r\n                baseAdd.apply(this, [view, index]);\r\n                for (const key in subs) {\r\n                    jview._renderFrame(key, subs[key], null).then(() => {\r\n                        jview._subs[key] = subs[key];\r\n                    });\r\n                }\r\n                return view.id;\r\n            }\r\n            else {\r\n                return baseAdd.apply(this, arguments);\r\n            }\r\n        },\r\n        removeView() {\r\n            baseRemove.apply(this, arguments);\r\n            if (this.$scope && this.$scope.webixJet) {\r\n                const subs = this.$scope._subs;\r\n                // check all sub-views, destroy and clean the removed one\r\n                for (const key in subs) {\r\n                    const test = subs[key];\r\n                    if (!w.$$(test.id)) {\r\n                        test.view.destructor();\r\n                        delete subs[key];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    w.extend(w.ui.layout.prototype, config, true);\r\n    w.extend(w.ui.baselayout.prototype, config, true);\r\n    // wrapper for using Jet Apps as views\r\n    w.protoUI({\r\n        name: \"jetapp\",\r\n        $init(cfg) {\r\n            this.$app = new this.app(cfg);\r\n            const id = w.uid().toString();\r\n            cfg.body = { id };\r\n            this.$ready.push(function () {\r\n                this.callEvent(\"onInit\", [this.$app]);\r\n                this.$app.render({ id });\r\n            });\r\n        }\r\n    }, w.ui.proxy, w.EventSystem);\r\n}\n\nclass JetApp extends JetAppBase {\r\n    constructor(config) {\r\n        config.router = config.router || HashRouter;\r\n        super(config);\r\n        patch(this.webix);\r\n    }\r\n    require(type, url) {\r\n        return require(type + \"/\" + url);\r\n    }\r\n}\n\nclass StoreRouter {\r\n    constructor(cb, config, app) {\r\n        this.storage = config.storage || app.webix.storage.session;\r\n        this.name = (config.storeName || config.id + \":route\");\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.storage.put(this.name, path);\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.storage.get(this.name);\r\n    }\r\n}\n\nclass UrlRouter extends HashRouter {\r\n    _detectPrefix() {\r\n        this.prefix = \"\";\r\n        this.sufix = this.config.routerPrefix || \"\";\r\n    }\r\n    _getRaw() {\r\n        return document.location.pathname + (document.location.search || \"\");\r\n    }\r\n}\n\nclass EmptyRouter {\r\n    constructor(cb, _$config) {\r\n        this.path = \"\";\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nfunction UnloadGuard(app, view, config) {\r\n    view.on(app, `app:guard`, function (_$url, point, promise) {\r\n        if (point === view || point.contains(view)) {\r\n            const res = config();\r\n            if (res === false) {\r\n                promise.confirm = Promise.reject(new NavigationBlocked());\r\n            }\r\n            else {\r\n                promise.confirm = promise.confirm.then(() => res);\r\n            }\r\n        }\r\n    });\r\n}\n\n//     (c) 2012-2018 Airbnb, Inc.\n\n// var has = require('has');\nfunction has(store, key) {\n  return Object.prototype.hasOwnProperty.call(store, key);\n}\n// var forEach = require('for-each');\nfunction forEach(obj, handler, context) {\n  for (var key in obj) {\n    if (has(obj, key)) {\n      handler.call((context || obj), obj[key], key, obj);\n    }\n  }\n}\n// var trim = require('string.prototype.trim');\nfunction trim(str) {\n  return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n}\n// var warning = require('warning');\nfunction warn(message) {\n  message = 'Warning: ' + message;\n  if (typeof console !== 'undefined') {\n    console.error(message);\n  }\n\n  try { throw new Error(message); } catch (x) {}\n}\n\nvar replace = String.prototype.replace;\nvar split = String.prototype.split;\n\n// #### Pluralization methods\n// The string that separates the different phrase possibilities.\nvar delimiter = '||||';\n\nvar russianPluralGroups = function (n) {\n  var end = n % 10;\n  if (n !== 11 && end === 1) {\n    return 0;\n  }\n  if (2 <= end && end <= 4 && !(n >= 12 && n <= 14)) {\n    return 1;\n  }\n  return 2;\n};\n\n// Mapping from pluralization group plural logic.\nvar pluralTypes = {\n  arabic: function (n) {\n    // http://www.arabeyes.org/Plural_Forms\n    if (n < 3) { return n; }\n    var lastTwo = n % 100;\n    if (lastTwo >= 3 && lastTwo <= 10) return 3;\n    return lastTwo >= 11 ? 4 : 5;\n  },\n  bosnian_serbian: russianPluralGroups,\n  chinese: function () { return 0; },\n  croatian: russianPluralGroups,\n  french: function (n) { return n > 1 ? 1 : 0; },\n  german: function (n) { return n !== 1 ? 1 : 0; },\n  russian: russianPluralGroups,\n  lithuanian: function (n) {\n    if (n % 10 === 1 && n % 100 !== 11) { return 0; }\n    return n % 10 >= 2 && n % 10 <= 9 && (n % 100 < 11 || n % 100 > 19) ? 1 : 2;\n  },\n  czech: function (n) {\n    if (n === 1) { return 0; }\n    return (n >= 2 && n <= 4) ? 1 : 2;\n  },\n  polish: function (n) {\n    if (n === 1) { return 0; }\n    var end = n % 10;\n    return 2 <= end && end <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n  },\n  icelandic: function (n) { return (n % 10 !== 1 || n % 100 === 11) ? 1 : 0; },\n  slovenian: function (n) {\n    var lastTwo = n % 100;\n    if (lastTwo === 1) {\n      return 0;\n    }\n    if (lastTwo === 2) {\n      return 1;\n    }\n    if (lastTwo === 3 || lastTwo === 4) {\n      return 2;\n    }\n    return 3;\n  }\n};\n\n\n// Mapping from pluralization group to individual language codes/locales.\n// Will look up based on exact match, if not found and it's a locale will parse the locale\n// for language code, and if that does not exist will default to 'en'\nvar pluralTypeToLanguages = {\n  arabic: ['ar'],\n  bosnian_serbian: ['bs-Latn-BA', 'bs-Cyrl-BA', 'srl-RS', 'sr-RS'],\n  chinese: ['id', 'id-ID', 'ja', 'ko', 'ko-KR', 'lo', 'ms', 'th', 'th-TH', 'zh'],\n  croatian: ['hr', 'hr-HR'],\n  german: ['fa', 'da', 'de', 'en', 'es', 'fi', 'el', 'he', 'hi-IN', 'hu', 'hu-HU', 'it', 'nl', 'no', 'pt', 'sv', 'tr'],\n  french: ['fr', 'tl', 'pt-br'],\n  russian: ['ru', 'ru-RU'],\n  lithuanian: ['lt'],\n  czech: ['cs', 'cs-CZ', 'sk'],\n  polish: ['pl'],\n  icelandic: ['is'],\n  slovenian: ['sl-SL']\n};\n\nfunction langToTypeMap(mapping) {\n  var ret = {};\n  forEach(mapping, function (langs, type) {\n    forEach(langs, function (lang) {\n      ret[lang] = type;\n    });\n  });\n  return ret;\n}\n\nfunction pluralTypeName(locale) {\n  var langToPluralType = langToTypeMap(pluralTypeToLanguages);\n  return langToPluralType[locale]\n    || langToPluralType[split.call(locale, /-/, 1)[0]]\n    || langToPluralType.en;\n}\n\nfunction pluralTypeIndex(locale, count) {\n  return pluralTypes[pluralTypeName(locale)](count);\n}\n\nfunction escape(token) {\n  return token.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction constructTokenRegex(opts) {\n  var prefix = (opts && opts.prefix) || '%{';\n  var suffix = (opts && opts.suffix) || '}';\n\n  if (prefix === delimiter || suffix === delimiter) {\n    throw new RangeError('\"' + delimiter + '\" token is reserved for pluralization');\n  }\n\n  return new RegExp(escape(prefix) + '(.*?)' + escape(suffix), 'g');\n}\n\nvar dollarRegex = /\\$/g;\nvar dollarBillsYall = '$$';\nvar defaultTokenRegex = /%\\{(.*?)\\}/g;\n\n// ### transformPhrase(phrase, substitutions, locale)\n//\n// Takes a phrase string and transforms it by choosing the correct\n// plural form and interpolating it.\n//\n//     transformPhrase('Hello, %{name}!', {name: 'Spike'});\n//     // \"Hello, Spike!\"\n//\n// The correct plural form is selected if substitutions.smart_count\n// is set. You can pass in a number instead of an Object as `substitutions`\n// as a shortcut for `smart_count`.\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 1}, 'en');\n//     // \"1 new message\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 2}, 'en');\n//     // \"2 new messages\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', 5, 'en');\n//     // \"5 new messages\"\n//\n// You should pass in a third argument, the locale, to specify the correct plural type.\n// It defaults to `'en'` with 2 plural forms.\nfunction transformPhrase(phrase, substitutions, locale, tokenRegex) {\n  if (typeof phrase !== 'string') {\n    throw new TypeError('Polyglot.transformPhrase expects argument #1 to be string');\n  }\n\n  if (substitutions == null) {\n    return phrase;\n  }\n\n  var result = phrase;\n  var interpolationRegex = tokenRegex || defaultTokenRegex;\n\n  // allow number as a pluralization shortcut\n  var options = typeof substitutions === 'number' ? { smart_count: substitutions } : substitutions;\n\n  // Select plural form: based on a phrase text that contains `n`\n  // plural forms separated by `delimiter`, a `locale`, and a `substitutions.smart_count`,\n  // choose the correct plural form. This is only done if `count` is set.\n  if (options.smart_count != null && result) {\n    var texts = split.call(result, delimiter);\n    result = trim(texts[pluralTypeIndex(locale || 'en', options.smart_count)] || texts[0]);\n  }\n\n  // Interpolate: Creates a `RegExp` object for each interpolation placeholder.\n  result = replace.call(result, interpolationRegex, function (expression, argument) {\n    if (!has(options, argument) || options[argument] == null) { return expression; }\n    // Ensure replacement value is escaped to prevent special $-prefixed regex replace tokens.\n    return replace.call(options[argument], dollarRegex, dollarBillsYall);\n  });\n\n  return result;\n}\n\n// ### Polyglot class constructor\nfunction Polyglot(options) {\n  var opts = options || {};\n  this.phrases = {};\n  this.extend(opts.phrases || {});\n  this.currentLocale = opts.locale || 'en';\n  var allowMissing = opts.allowMissing ? transformPhrase : null;\n  this.onMissingKey = typeof opts.onMissingKey === 'function' ? opts.onMissingKey : allowMissing;\n  this.warn = opts.warn || warn;\n  this.tokenRegex = constructTokenRegex(opts.interpolation);\n}\n\n// ### polyglot.locale([locale])\n//\n// Get or set locale. Internally, Polyglot only uses locale for pluralization.\nPolyglot.prototype.locale = function (newLocale) {\n  if (newLocale) this.currentLocale = newLocale;\n  return this.currentLocale;\n};\n\n// ### polyglot.extend(phrases)\n//\n// Use `extend` to tell Polyglot how to translate a given key.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The key can be any string.  Feel free to call `extend` multiple times;\n// it will override any phrases with the same key, but leave existing phrases\n// untouched.\n//\n// It is also possible to pass nested phrase objects, which get flattened\n// into an object with the nested keys concatenated using dot notation.\n//\n//     polyglot.extend({\n//       \"nav\": {\n//         \"hello\": \"Hello\",\n//         \"hello_name\": \"Hello, %{name}\",\n//         \"sidebar\": {\n//           \"welcome\": \"Welcome\"\n//         }\n//       }\n//     });\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}',\n//     //   'nav.sidebar.welcome': 'Welcome'\n//     // }\n//\n// `extend` accepts an optional second argument, `prefix`, which can be used\n// to prefix every key in the phrases object with some string, using dot\n// notation.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     }, \"nav\");\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}'\n//     // }\n//\n// This feature is used internally to support nested phrase objects.\nPolyglot.prototype.extend = function (morePhrases, prefix) {\n  forEach(morePhrases, function (phrase, key) {\n    var prefixedKey = prefix ? prefix + '.' + key : key;\n    if (typeof phrase === 'object') {\n      this.extend(phrase, prefixedKey);\n    } else {\n      this.phrases[prefixedKey] = phrase;\n    }\n  }, this);\n};\n\n// ### polyglot.unset(phrases)\n// Use `unset` to selectively remove keys from a polyglot instance.\n//\n//     polyglot.unset(\"some_key\");\n//     polyglot.unset({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The unset method can take either a string (for the key), or an object hash with\n// the keys that you would like to unset.\nPolyglot.prototype.unset = function (morePhrases, prefix) {\n  if (typeof morePhrases === 'string') {\n    delete this.phrases[morePhrases];\n  } else {\n    forEach(morePhrases, function (phrase, key) {\n      var prefixedKey = prefix ? prefix + '.' + key : key;\n      if (typeof phrase === 'object') {\n        this.unset(phrase, prefixedKey);\n      } else {\n        delete this.phrases[prefixedKey];\n      }\n    }, this);\n  }\n};\n\n// ### polyglot.clear()\n//\n// Clears all phrases. Useful for special cases, such as freeing\n// up memory if you have lots of phrases but no longer need to\n// perform any translation. Also used internally by `replace`.\nPolyglot.prototype.clear = function () {\n  this.phrases = {};\n};\n\n// ### polyglot.replace(phrases)\n//\n// Completely replace the existing phrases with a new set of phrases.\n// Normally, just use `extend` to add more phrases, but under certain\n// circumstances, you may want to make sure no old phrases are lying around.\nPolyglot.prototype.replace = function (newPhrases) {\n  this.clear();\n  this.extend(newPhrases);\n};\n\n\n// ### polyglot.t(key, options)\n//\n// The most-used method. Provide a key, and `t` will return the\n// phrase.\n//\n//     polyglot.t(\"hello\");\n//     => \"Hello\"\n//\n// The phrase value is provided first by a call to `polyglot.extend()` or\n// `polyglot.replace()`.\n//\n// Pass in an object as the second argument to perform interpolation.\n//\n//     polyglot.t(\"hello_name\", {name: \"Spike\"});\n//     => \"Hello, Spike\"\n//\n// If you like, you can provide a default value in case the phrase is missing.\n// Use the special option key \"_\" to specify a default.\n//\n//     polyglot.t(\"i_like_to_write_in_language\", {\n//       _: \"I like to write in %{language}.\",\n//       language: \"JavaScript\"\n//     });\n//     => \"I like to write in JavaScript.\"\n//\nPolyglot.prototype.t = function (key, options) {\n  var phrase, result;\n  var opts = options == null ? {} : options;\n  if (typeof this.phrases[key] === 'string') {\n    phrase = this.phrases[key];\n  } else if (typeof opts._ === 'string') {\n    phrase = opts._;\n  } else if (this.onMissingKey) {\n    var onMissingKey = this.onMissingKey;\n    result = onMissingKey(key, opts, this.currentLocale, this.tokenRegex);\n  } else {\n    this.warn('Missing translation for key: \"' + key + '\"');\n    result = key;\n  }\n  if (typeof phrase === 'string') {\n    result = transformPhrase(phrase, opts, this.currentLocale, this.tokenRegex);\n  }\n  return result;\n};\n\n\n// ### polyglot.has(key)\n//\n// Check if polyglot has a translation for given key\nPolyglot.prototype.has = function (key) {\n  return has(this.phrases, key);\n};\n\n// export transformPhrase\nPolyglot.transformPhrase = function transform(phrase, substitutions, locale) {\n  return transformPhrase(phrase, substitutions, locale);\n};\n\nvar webixPolyglot = Polyglot;\n\nfunction Locale(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let lang = storage ? (storage.get(\"lang\") || \"en\") : (config.lang || \"en\");\r\n    function setLangData(name, data, silent) {\r\n        if (data.__esModule) {\r\n            data = data.default;\r\n        }\r\n        const pconfig = { phrases: data };\r\n        if (config.polyglot) {\r\n            app.webix.extend(pconfig, config.polyglot);\r\n        }\r\n        const poly = service.polyglot = new webixPolyglot(pconfig);\r\n        poly.locale(name);\r\n        service._ = app.webix.bind(poly.t, poly);\r\n        lang = name;\r\n        if (storage) {\r\n            storage.put(\"lang\", lang);\r\n        }\r\n        if (config.webix) {\r\n            const locName = config.webix[name];\r\n            if (locName) {\r\n                app.webix.i18n.setLocale(locName);\r\n            }\r\n        }\r\n        if (!silent) {\r\n            return app.refresh();\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    function getLang() { return lang; }\r\n    function setLang(name, silent) {\r\n        // ignore setLang if loading by path is disabled\r\n        if (config.path === false) {\r\n            return;\r\n        }\r\n        const path = (config.path ? config.path + \"/\" : \"\") + name;\r\n        const data = app.require(\"jet-locales\", path);\r\n        setLangData(name, data, silent);\r\n    }\r\n    const service = {\r\n        getLang, setLang, setLangData, _: null, polyglot: null\r\n    };\r\n    app.setService(\"locale\", service);\r\n    setLang(lang, true);\r\n}\n\nfunction show(view, config, value) {\r\n    if (config.urls) {\r\n        value = config.urls[value] || value;\r\n    }\r\n    else if (config.param) {\r\n        value = { [config.param]: value };\r\n    }\r\n    view.show(value);\r\n}\r\nfunction Menu(app, view, config) {\r\n    const frame = view.getSubViewInfo().parent;\r\n    const ui = view.$$(config.id || config);\r\n    let silent = false;\r\n    ui.attachEvent(\"onchange\", function () {\r\n        if (!silent) {\r\n            show(frame, config, this.getValue());\r\n        }\r\n    });\r\n    ui.attachEvent(\"onafterselect\", function () {\r\n        if (!silent) {\r\n            let id = null;\r\n            if (ui.setValue) {\r\n                id = this.getValue();\r\n            }\r\n            else if (ui.getSelectedId) {\r\n                id = ui.getSelectedId();\r\n            }\r\n            show(frame, config, id);\r\n        }\r\n    });\r\n    view.on(app, `app:route`, function () {\r\n        let name = \"\";\r\n        if (config.param) {\r\n            name = view.getParam(config.param, true);\r\n        }\r\n        else {\r\n            const segment = frame.getUrl()[1];\r\n            if (segment) {\r\n                name = segment.page;\r\n            }\r\n        }\r\n        if (name) {\r\n            silent = true;\r\n            if (ui.setValue && ui.getValue() !== name) {\r\n                ui.setValue(name);\r\n            }\r\n            else if (ui.select && ui.exists(name) && ui.getSelectedId() !== name) {\r\n                ui.select(name);\r\n            }\r\n            silent = false;\r\n        }\r\n    });\r\n}\n\nconst baseicons = {\r\n    good: \"check\",\r\n    error: \"warning\",\r\n    saving: \"refresh fa-spin\"\r\n};\r\nconst basetext = {\r\n    good: \"Ok\",\r\n    error: \"Error\",\r\n    saving: \"Connecting...\"\r\n};\r\nfunction Status(app, view, config) {\r\n    let status = \"good\";\r\n    let count = 0;\r\n    let iserror = false;\r\n    let expireDelay = config.expire;\r\n    if (!expireDelay && expireDelay !== false) {\r\n        expireDelay = 2000;\r\n    }\r\n    const texts = config.texts || basetext;\r\n    const icons = config.icons || baseicons;\r\n    if (typeof config === \"string\") {\r\n        config = { target: config };\r\n    }\r\n    function refresh(content) {\r\n        const area = view.$$(config.target);\r\n        if (area) {\r\n            if (!content) {\r\n                content = \"<div class='status_\" +\r\n                    status +\r\n                    \"'><span class='webix_icon fa-\" +\r\n                    icons[status] + \"'></span> \" + texts[status] + \"</div>\";\r\n            }\r\n            area.setHTML(content);\r\n        }\r\n    }\r\n    function success() {\r\n        count--;\r\n        setStatus(\"good\");\r\n    }\r\n    function fail(err) {\r\n        count--;\r\n        setStatus(\"error\", err);\r\n    }\r\n    function start(promise) {\r\n        count++;\r\n        setStatus(\"saving\");\r\n        if (promise && promise.then) {\r\n            promise.then(success, fail);\r\n        }\r\n    }\r\n    function getStatus() {\r\n        return status;\r\n    }\r\n    function hideStatus() {\r\n        if (count === 0) {\r\n            refresh(\" \");\r\n        }\r\n    }\r\n    function setStatus(mode, err) {\r\n        if (count < 0) {\r\n            count = 0;\r\n        }\r\n        if (mode === \"saving\") {\r\n            status = \"saving\";\r\n            refresh();\r\n        }\r\n        else {\r\n            iserror = (mode === \"error\");\r\n            if (count === 0) {\r\n                status = iserror ? \"error\" : \"good\";\r\n                if (iserror) {\r\n                    app.error(\"app:error:server\", [err.responseText || err]);\r\n                }\r\n                else {\r\n                    if (expireDelay) {\r\n                        setTimeout(hideStatus, expireDelay);\r\n                    }\r\n                }\r\n                refresh();\r\n            }\r\n        }\r\n    }\r\n    function track(data) {\r\n        const dp = app.webix.dp(data);\r\n        if (dp) {\r\n            view.on(dp, \"onAfterDataSend\", start);\r\n            view.on(dp, \"onAfterSaveError\", (_id, _obj, response) => fail(response));\r\n            view.on(dp, \"onAfterSave\", success);\r\n        }\r\n    }\r\n    app.setService(\"status\", {\r\n        getStatus,\r\n        setStatus,\r\n        track\r\n    });\r\n    if (config.remote) {\r\n        view.on(app.webix, \"onRemoteCall\", start);\r\n    }\r\n    if (config.ajax) {\r\n        view.on(app.webix, \"onBeforeAjax\", (_mode, _url, _data, _request, _headers, _files, promise) => {\r\n            start(promise);\r\n        });\r\n    }\r\n    if (config.data) {\r\n        track(config.data);\r\n    }\r\n}\n\nfunction Theme(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let theme = storage ?\r\n        (storage.get(\"theme\") || \"flat-default\")\r\n        :\r\n            (config.theme || \"flat-default\");\r\n    const service = {\r\n        getTheme() { return theme; },\r\n        setTheme(name, silent) {\r\n            const parts = name.split(\"-\");\r\n            const links = document.getElementsByTagName(\"link\");\r\n            for (let i = 0; i < links.length; i++) {\r\n                const lname = links[i].getAttribute(\"title\");\r\n                if (lname) {\r\n                    if (lname === name || lname === parts[0]) {\r\n                        links[i].disabled = false;\r\n                    }\r\n                    else {\r\n                        links[i].disabled = true;\r\n                    }\r\n                }\r\n            }\r\n            app.webix.skin.set(parts[0]);\r\n            // remove old css\r\n            app.webix.html.removeCss(document.body, \"theme-\" + theme);\r\n            // add new css\r\n            app.webix.html.addCss(document.body, \"theme-\" + name);\r\n            theme = name;\r\n            if (storage) {\r\n                storage.put(\"theme\", name);\r\n            }\r\n            if (!silent) {\r\n                app.refresh();\r\n            }\r\n        }\r\n    };\r\n    app.setService(\"theme\", service);\r\n    service.setTheme(theme, true);\r\n}\n\nfunction copyParams(data, url, route) {\r\n    for (let i = 0; i < route.length; i++) {\r\n        data[route[i]] = url[i + 1] ? url[i + 1].page : \"\";\r\n    }\r\n}\r\nfunction UrlParam(app, view, config) {\r\n    const route = config.route || config;\r\n    const data = {};\r\n    view.on(app, \"app:urlchange\", function (subview, segment) {\r\n        if (view === subview) {\r\n            copyParams(data, segment.suburl(), route);\r\n            segment.size(route.length + 1);\r\n        }\r\n    });\r\n    const os = view.setParam;\r\n    const og = view.getParam;\r\n    view.setParam = function (name, value, show) {\r\n        const index = route.indexOf(name);\r\n        if (index >= 0) {\r\n            data[name] = value;\r\n            this._segment.update(\"\", value, index + 1);\r\n            if (show) {\r\n                return view.show(null);\r\n            }\r\n        }\r\n        else {\r\n            return os.call(this, name, value, show);\r\n        }\r\n    };\r\n    view.getParam = function (key, mode) {\r\n        const val = data[key];\r\n        if (typeof val !== \"undefined\") {\r\n            return val;\r\n        }\r\n        return og.call(this, key, mode);\r\n    };\r\n    copyParams(data, view.getUrl(), route);\r\n}\n\nfunction User(app, _view, config) {\r\n    config = config || {};\r\n    const login = config.login || \"/login\";\r\n    const logout = config.logout || \"/logout\";\r\n    const afterLogin = config.afterLogin || app.config.start;\r\n    const afterLogout = config.afterLogout || \"/login\";\r\n    const ping = config.ping || 5 * 60 * 1000;\r\n    const model = config.model;\r\n    let user = config.user;\r\n    const service = {\r\n        getUser() {\r\n            return user;\r\n        },\r\n        getStatus(server) {\r\n            if (!server) {\r\n                return user !== null;\r\n            }\r\n            return model.status().catch(() => null).then(data => {\r\n                user = data;\r\n            });\r\n        },\r\n        login(name, pass) {\r\n            return model.login(name, pass).then(data => {\r\n                user = data;\r\n                if (!data) {\r\n                    throw new Error(\"Access denied\");\r\n                }\r\n                app.callEvent(\"app:user:login\", [user]);\r\n                app.show(afterLogin);\r\n            });\r\n        },\r\n        logout() {\r\n            user = null;\r\n            return model.logout().then(res => {\r\n                app.callEvent(\"app:user:logout\", []);\r\n                return res;\r\n            });\r\n        }\r\n    };\r\n    function canNavigate(url, obj) {\r\n        if (url === logout) {\r\n            service.logout();\r\n            obj.redirect = afterLogout;\r\n        }\r\n        else if (url !== login && !service.getStatus()) {\r\n            obj.redirect = login;\r\n        }\r\n    }\r\n    app.setService(\"user\", service);\r\n    app.attachEvent(`app:guard`, function (url, _$root, obj) {\r\n        if (config.public && config.public(url)) {\r\n            return true;\r\n        }\r\n        if (typeof user === \"undefined\") {\r\n            obj.confirm = service.getStatus(true).then(() => canNavigate(url, obj));\r\n        }\r\n        return canNavigate(url, obj);\r\n    });\r\n    if (ping) {\r\n        setInterval(() => service.getStatus(true), ping);\r\n    }\r\n}\n\n/*\r\nMIT License\r\nCopyright (c) 2019 XB Software\r\n*/\r\nlet webix = window.webix;\r\nif (webix) {\r\n    patch(webix);\r\n}\r\nconst plugins = {\r\n    UnloadGuard, Locale, Menu, Theme, User, Status, UrlParam\r\n};\r\nconst errors = { NavigationBlocked };\r\nconst w = window;\r\nif (!w.Promise) {\r\n    w.Promise = w.webix.promise;\r\n}\n\nexport { plugins, errors, JetApp, JetView, HashRouter, StoreRouter, UrlRouter, EmptyRouter, SubRouter };\n//# sourceMappingURL=jet.js.map\n","var index = 1;\nfunction uid() {\n\treturn index++;\n}\n\nvar empty = undefined;\n\nexport function ignoreInitial(code) {\n\tlet init = false;\n\treturn function() {\n\t\tif (init) return code.apply(this, arguments);\n\t\telse init = true;\n\t};\n}\n\nvar context = null;\nexport function withContext(value, code) {\n\tcontext = value;\n\tcode();\n\tcontext = null;\n}\n\nexport function filter(rule, handler) {\n\treturn function(v, o, obj, meta) {\n\t\tif (rule(v, meta)) handler.apply(this, arguments);\n\t};\n}\n\nexport function link(source, target, key) {\n\tObject.defineProperty(target, key, {\n\t\tget: () => source[key],\n\t\tset: value => (source[key] = value),\n\t});\n}\n\nexport function debounce(handler, delay) {\n\tdelay = delay || 200;\n\tlet timer = null;\n\tlet data = null;\n\treturn function() {\n\t\tdata = arguments;\n\t\tif (!timer) {\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttimer = null;\n\n\t\t\t\thandler.apply(this, data);\n\t\t\t}, delay);\n\t\t}\n\t};\n}\n\nexport function createState(data, config) {\n\tconfig = config || {};\n\tconst handlers = {};\n\tconst out = {};\n\n\tconst observe = function(mask, handler) {\n\t\tconst key = uid();\n\t\thandlers[key] = { mask, handler };\n\t\tif (mask === \"*\") handler(out, empty, mask);\n\t\telse handler(out[mask], empty, mask);\n\n\t\treturn key;\n\t};\n\n\tconst extend = function(data, sconfig){\n\t\tsconfig = sconfig || config;\n\t\t// normal js object\n\t\tfor (const key in data) {\n\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\tconst test = data[key];\n\t\t\t\tif (sconfig.nested && typeof test === \"object\" && test) {\n\t\t\t\t\tout[key] = createState(test, sconfig);\n\t\t\t\t} else {\n\t\t\t\t\treactive(out, test, key, notify);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tconst observeEnd = function(id) {\n\t\tdelete handlers[id];\n\t};\n\n\tconst queue = [];\n\tlet waitInQueue = false;\n\n\tvar batch = function(code) {\n\t\tif (typeof code !== \"function\") {\n\t\t\tconst values = code;\n\t\t\tcode = () => {\n\t\t\t\tfor (const key in values) out[key] = values[key];\n\t\t\t};\n\t\t}\n\n\t\twaitInQueue = true;\n\t\tcode(out);\n\t\twaitInQueue = false;\n\t\twhile (queue.length) {\n\t\t\tconst obj = queue.shift();\n\t\t\tnotify.apply(this, obj);\n\t\t}\n\t};\n\n\tconst notify = function(key, old, value, meta) {\n\t\tif (waitInQueue) {\n\t\t\tqueue.push([key, old, value, meta]);\n\t\t\treturn;\n\t\t}\n\n\t\tconst list = Object.keys(handlers);\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tconst obj = handlers[list[i]];\n\t\t\tif (!obj) continue;\n\t\t\tif (obj.mask === \"*\" || obj.mask === key) {\n\t\t\t\tobj.handler(value, old, key, meta);\n\t\t\t}\n\t\t}\n\t};\n\n\tObject.defineProperty(out, \"$changes\", {\n\t\tvalue: {\n\t\t\tattachEvent: observe,\n\t\t\tdetachEvent: observeEnd,\n\t\t},\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$observe\", {\n\t\tvalue: observe,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$batch\", {\n\t\tvalue: batch,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$extend\", {\n\t\tvalue: extend,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\n\tout.$extend(data, config);\n\treturn out;\n}\n\nfunction reactive(obj, val, key, notify) {\n\tObject.defineProperty(obj, key, {\n\t\tget: function() {\n\t\t\treturn val;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar changed = false;\n\t\t\tif (val === null || value === null) {\n\t\t\t\tchanged = val !== value;\n\t\t\t} else {\n\t\t\t\tchanged = val.valueOf() != value.valueOf();\n\t\t\t}\n\n\t\t\tif (changed) {\n\t\t\t\tvar old = val;\n\t\t\t\tval = value;\n\t\t\t\tnotify(key, old, value, context);\n\t\t\t}\n\t\t},\n\t\tenumerable: true,\n\t\tconfigurable: false,\n\t});\n}","import { JetView } from \"webix-jet\";\n\nexport default class AddView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst cals = this.app.config.calendars;\n\n\t\tconst ui = {\n\t\t\tview: compact ? \"icon\" : \"button\",\n\t\t\ttype: \"icon\",\n\t\t\ticon: \"wxi-plus\",\n\t\t\tcss: \"webix_primary\",\n\t\t\tlabel: _(\"Create\"),\n\t\t\twidth: compact ? 50 : cals ? 185 : 100,\n\t\t\theight: compact ? 50 : webix.skin.$active.inputHeight,\n\t\t\ton: {\n\t\t\t\tonItemClick: () => this.AddEvent(),\n\t\t\t},\n\t\t};\n\n\t\treturn { view: \"align\", body: ui, align: \"middle\" };\n\t}\n\n\tAddEvent() {\n\t\tthis.app.getState().selected = { id: \"0\" };\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class DateView extends JetView {\n\tconfig() {\n\t\tconst toolbar = [\n\t\t\t{\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-angle-left\",\n\t\t\t\ttooltip: () => this.NavLabel(-1),\n\t\t\t\talign: \"left\",\n\t\t\t\ton: { onItemClick: () => this.ChangeDate(-1) },\n\t\t\t},\n\t\t\t{ view: \"label\", localId: \"title\", align: \"center\", width: 160 },\n\t\t\t{\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-angle-right\",\n\t\t\t\ttooltip: () => this.NavLabel(1),\n\t\t\t\talign: \"right\",\n\t\t\t\ton: { onItemClick: () => this.ChangeDate(1) },\n\t\t\t},\n\t\t];\n\n\t\treturn {\n\t\t\tcols: toolbar,\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.on(this.State.$changes, \"date\", () => this.DateLabel());\n\t\tthis.on(this.State.$changes, \"mode\", () => this.DateLabel());\n\t}\n\n\tChangeDate(dir) {\n\t\tconst state = this.State;\n\t\tconst step = state.mode == \"agenda\" ? \"month\" : state.mode;\n\t\tconst next = webix.Date.add(state.date, dir, step, true);\n\n\t\t// fix navigation in month mode when last day of month is selected\n\t\tif (state.mode === \"month\") {\n\t\t\tconst diff = Math.abs(state.date.getMonth() - next.getMonth());\n\t\t\tif (diff != 1 && diff < 6) next.setDate(0);\n\t\t}\n\n\t\tstate.$batch({\n\t\t\tdate: next,\n\t\t\tselected: null,\n\t\t});\n\t}\n\n\tDateLabel() {\n\t\tconst date = this.State.date;\n\t\tconst label =\n\t\t\tthis.State.mode == \"day\"\n\t\t\t\t? webix.i18n.longDateFormatStr(date)\n\t\t\t\t: webix.Date.dateToStr(\"%F %Y\")(date);\n\n\t\tthis.$$(\"title\").setHTML(label);\n\t}\n\n\tNavLabel(dir) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst modes = [\"month\", \"week\", \"day\"];\n\t\tlet mode = this.State.mode;\n\t\tmode = modes.indexOf(mode) !== -1 ? ` ${mode}` : \"\";\n\n\t\tdir = dir > 0 ? \"Next\" : \"Previous\";\n\n\t\treturn _(dir + mode);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class NavBarView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\n\t\tconst toolbar = {\n\t\t\thidden: compact,\n\t\t\tview: \"tabbar\",\n\t\t\tbottomOffset: 0,\n\t\t\tlocalId: \"buttons\",\n\t\t\tborderless: true,\n\t\t\twidth: 320,\n\t\t\toptionWidth: 80,\n\t\t\toptions: [\n\t\t\t\t{ id: \"day\", value: _(\"Day\") },\n\t\t\t\t{ id: \"week\", value: _(\"Week\") },\n\t\t\t\t{ id: \"month\", value: _(\"Month\") },\n\t\t\t\t{ id: \"agenda\", value: _(\"Agenda\") },\n\t\t\t],\n\t\t};\n\n\t\tif (!compact) {\n\t\t\ttoolbar.on = { onChange: val => this.SetMode(val) };\n\t\t}\n\n\t\treturn toolbar;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.on(this.State.$changes, \"mode\", val => {\n\t\t\tthis.$$(\"buttons\").setValue(val);\n\t\t});\n\t}\n\tSetMode(val) {\n\t\tthis.State.$batch({\n\t\t\tmode: val,\n\t\t\tselected: null,\n\t\t});\n\t}\n}\n","export default function getPalette() {\n\tconst aSkin = webix.skin.$active;\n\treturn {\n\t\tview: \"colorboard\",\n\t\tcss: \"webix_scheduler_palette\",\n\t\theight: aSkin.optionHeight * 3 + 4,\n\t\twidth: aSkin.optionHeight * 7 + 4,\n\t\tpalette: [\n\t\t\t[\n\t\t\t\t\"#61AEE6\",\n\t\t\t\t\"#01C2A5\",\n\t\t\t\t\"#E88DD9\",\n\t\t\t\t\"#D2FB9E\",\n\t\t\t\t\"#6BA8CB\",\n\t\t\t\t\"#61BBA5\",\n\t\t\t\t\"#CF89D5\",\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"#EF9C80\",\n\t\t\t\t\"#8289EE\",\n\t\t\t\t\"#74B1A7\",\n\t\t\t\t\"#DD89AF\",\n\t\t\t\t\"#E48882\",\n\t\t\t\t\"#997CEB\",\n\t\t\t\t\"#ADD579\",\n\t\t\t],\n\t\t\t[\n\t\t\t\t\"#F68896\",\n\t\t\t\t\"#FFE999\",\n\t\t\t\t\"#6D4BCE\",\n\t\t\t\t\"#99CA58\",\n\t\t\t\t\"#D352BE\",\n\t\t\t\t\"#F7CC34\",\n\t\t\t\t\"#DA5C53\",\n\t\t\t],\n\t\t],\n\t};\n}\n","import { JetView } from \"webix-jet\";\nimport getPalette from \"helpers/palette\";\n\nexport default class SidePopupView extends JetView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst save = {\n\t\t\tview: \"button\",\n\t\t\tvalue: _(\"Save\"),\n\t\t\talign: \"right\",\n\t\t\tinputWidth: 100,\n\t\t\tcss: \"webix_primary\",\n\t\t\tclick: () => this.Save(),\n\t\t};\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst compactBar = {\n\t\t\tview: \"toolbar\",\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: aSkin.layoutPadding.form,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{ view: \"icon\", icon: \"wxi-close\", click: () => this.getRoot().hide() },\n\t\t\t\t{},\n\t\t\t\tsave,\n\t\t\t],\n\t\t};\n\n\t\tconst controls = [\n\t\t\t{\n\t\t\t\tview: \"button\",\n\t\t\t\tlocalId: \"removeBtn\",\n\t\t\t\tvalue: _(\"Delete\"),\n\t\t\t\tcss: \"webix_danger webix_scheduler_danger\",\n\t\t\t\thidden: true,\n\t\t\t\talign: compact ? \"center\" : \"left\",\n\t\t\t\tinputWidth: compact ? 330 : 100,\n\t\t\t\tclick: () => this.Delete(),\n\t\t\t},\n\t\t];\n\n\t\tif (!compact) controls.push(save);\n\n\t\tconst ui = {\n\t\t\tview: \"window\",\n\t\t\twidth: 400,\n\t\t\tmodal: true,\n\t\t\tclose: true,\n\t\t\tposition: \"center\",\n\t\t\tborderless: compact,\n\t\t\tfullscreen: compact,\n\t\t\tcss: \"webix_scheduler_cal_popup\",\n\t\t\thead: compact ? compactBar : _(\"Edit calendar\"),\n\t\t\tbody: {\n\t\t\t\tview: \"form\",\n\t\t\t\tlocalId: \"calendars:form\",\n\t\t\t\telements: [\n\t\t\t\t\t{ view: \"text\", label: _(\"Title\"), name: \"text\" },\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"colorpicker\",\n\t\t\t\t\t\tlabel: _(\"Color\"),\n\t\t\t\t\t\tname: \"color\",\n\t\t\t\t\t\tsuggest: {\n\t\t\t\t\t\t\ttype: \"colorboard\",\n\t\t\t\t\t\t\tpadding: 3,\n\t\t\t\t\t\t\tbody: getPalette(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\t{ view: \"checkbox\", label: _(\"Active\"), name: \"active\" },\n\t\t\t\t\t{ cols: controls },\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => {\n\t\t\t\t\tthis.Form.clear();\n\t\t\t\t\tthis.$$(\"removeBtn\").hide();\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tif (compact) ui.body.elements.splice(3, 0, {});\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.Cals = this.app.getService(\"local\").calendars(true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tthis.Form = this.$$(\"calendars:form\");\n\t}\n\n\tShow(id) {\n\t\tif (id) {\n\t\t\tconst obj = this.Cals.getItem(id);\n\t\t\tthis.Form.setValues(obj);\n\t\t\tthis.$$(\"removeBtn\").show();\n\t\t} else {\n\t\t\tthis.Form.setValues({\n\t\t\t\tcolor: \"#997CEB\",\n\t\t\t\tactive: 1,\n\t\t\t});\n\t\t}\n\t\tthis.getRoot().show();\n\t\tthis.Form.focus();\n\t}\n\n\tSave() {\n\t\tconst obj = this.Form.getValues();\n\t\tif (obj.id) this.Ops.updateCalendar(obj.id, obj);\n\t\telse this.Ops.addCalendar(obj);\n\t\tthis.getRoot().hide();\n\t}\n\n\tDelete() {\n\t\tconst obj = this.Form.getValues();\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\twebix.confirm(_(\"Do you really want to remove this calendar?\")).then(() => {\n\t\t\tthis.Ops.removeCalendar(obj.id);\n\t\t\tthis.getRoot().hide();\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport EditorView from \"./editor\";\nimport getPalette from \"helpers/palette\";\n\nexport default class SidePopupView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst ui = {\n\t\t\tview: \"popup\",\n\t\t\trelative: \"right\",\n\t\t\tbody: {\n\t\t\t\trows: [\n\t\t\t\t\twebix.extend(getPalette(), {\n\t\t\t\t\t\tlocalId: \"colors\",\n\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\tonItemClick: val => this.UpdateColor(val),\n\t\t\t\t\t\t},\n\t\t\t\t\t}),\n\t\t\t\t\t{\n\t\t\t\t\t\tcss: \"webix_scheduler_settings\",\n\t\t\t\t\t\ttemplate: _(\"Settings\"),\n\t\t\t\t\t\theight: webix.skin.$active.inputHeight,\n\t\t\t\t\t\tonClick: {\n\t\t\t\t\t\t\twebix_template: () => this.ShowEditor(),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => this.app.callEvent(\"side:popup:hide\", []),\n\t\t\t},\n\t\t};\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tthis.Editor = this.ui(EditorView);\n\t}\n\n\tShow(id, node, color) {\n\t\tthis.Cid = id;\n\t\tthis.getRoot().show(node);\n\t\tthis.$$(\"colors\").setValue(color);\n\t}\n\n\tShowEditor() {\n\t\tthis.Editor.Show(this.Cid);\n\t\tthis.getRoot().hide();\n\t}\n\n\tUpdateColor(val) {\n\t\tthis.app.getService(\"operations\").updateCalendar(this.Cid, {\n\t\t\tcolor: val,\n\t\t});\n\t\tthis.getRoot().hide();\n\t}\n\n\tHide() {\n\t\tthis.getRoot().hide();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport PopupView from \"./popup\";\nimport EditorView from \"./editor\";\n\nexport default class SideView extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst state = this.app.getState();\n\n\t\tconst calendar = {\n\t\t\tview: \"calendar\",\n\t\t\tlocalId: \"calendar\",\n\t\t\theight: 276,\n\t\t\tmonthSelect: false,\n\t\t\ton: {\n\t\t\t\tonDateSelect: date => {\n\t\t\t\t\tstate.date = webix.Date.dayStart(date);\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tconst list = {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"calendars\",\n\t\t\ttype: this.ListType(_, state),\n\t\t\tborderless: true,\n\t\t\tautoheight: true,\n\t\t\tyCount: 5,\n\t\t\teditable: true,\n\t\t\teditValue: \"text\",\n\t\t\teditaction: \"custom\",\n\t\t\teditor: \"text\",\n\t\t\tcss: \"webix_scheduler_cal_list\",\n\t\t\ttooltip: () => \"\",\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_cal_edit: (e, id) => this.ShowPopup(e, id),\n\t\t\t\twebix_scheduler_cal_title: (e, id) => this.ToggleCalendar(id),\n\t\t\t\twebix_scheduler_active: (e, id) => this.ToggleCalendar(id),\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonBeforeEditStop: (v, editor) => this.SetTitle(editor.id, v.value),\n\t\t\t},\n\t\t};\n\n\t\tconst rows = [\n\t\t\t{ maxHeight: 100 },\n\t\t\tlist,\n\t\t\t{\n\t\t\t\tview: \"button\",\n\t\t\t\tlocalId: \"add\",\n\t\t\t\tvalue: _(\"Add calendar\"),\n\t\t\t\thidden: !state.readonly,\n\t\t\t\tinputWidth: 190,\n\t\t\t\talign: \"center\",\n\t\t\t\tclick: () => this.AddCalendar(),\n\t\t\t},\n\t\t\t{},\n\t\t];\n\n\t\tlet side = {\n\t\t\ttype: \"form\",\n\t\t\tpadding: { top: 8 },\n\t\t\trows: rows,\n\t\t};\n\n\t\tif (!this.Compact) {\n\t\t\tlist.on.onAfterScroll = () => this.Popup.Hide();\n\t\t\tside = {\n\t\t\t\tview: \"scrollview\",\n\t\t\t\tbody: {\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\trows: [calendar, side],\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\treturn side;\n\t}\n\n\tinit() {\n\t\tthis.Cals = this.$$(\"calendars\");\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tthis.Ops = this.app.getService(\"operations\");\n\n\t\tthis.Popup = this.Compact ? this.ui(EditorView) : this.ui(PopupView);\n\t\twebix.extend(this.Cals, webix.EditAbility);\n\n\t\tthis.Data.calendars().then(data => this.Cals.parse(data));\n\n\t\tconst state = this.app.getState();\n\n\t\tif (!this.Compact) {\n\t\t\tthis.on(state.$changes, \"date\", value => {\n\t\t\t\tthis.$$(\"calendar\").setValue(value);\n\t\t\t});\n\t\t\tthis.on(this.app, \"side:popup:hide\", () => {\n\t\t\t\tthis.Cals.unselectAll();\n\t\t\t});\n\t\t}\n\n\t\tthis.on(state.$changes, \"readonly\", value => this.ToggleState(value));\n\t}\n\n\tListType(_, state) {\n\t\treturn {\n\t\t\tcheckbox: function(obj) {\n\t\t\t\tconst icon =\n\t\t\t\t\tobj.active * 1 ? \"wxi-checkbox-marked\" : \"wxi-checkbox-blank\";\n\t\t\t\treturn `<span style=\"color:${obj.color};\" \n\t\t\t\t\trole=\"checkbox\" tabindex=\"-1\" \n\t\t\t\t\taria-checked=\"${obj.active ? \"true\" : \"false\"}\" \n\t\t\t\t\tclass=\"webix_icon webix_scheduler_active ${icon}\">\n\t\t\t\t</span>`;\n\t\t\t},\n\t\t\ttemplate: (obj, common) => {\n\t\t\t\tconst edit = `\n\t\t\t\t\t<span\n\t\t\t\t\t\twebix_tooltip=\"${_(\"Edit calendar\")}\" \n\t\t\t\t\t\tclass=\"webix_icon wxi-dots webix_scheduler_cal_edit \n\t\t\t\t\t\t\t${webix.env.touch ? \" webix_scheduler_cal_visible\" : \"\"}\n\t\t\t\t\t\t\">\n\t\t\t\t\t</span>\n\t\t\t\t`;\n\n\t\t\t\treturn `\n\t\t\t\t\t${common.checkbox(obj)}\n\t\t\t\t\t<span class=\"webix_scheduler_cal_title\">${obj.text || _(\"(no title)\")}</span>\n\t\t\t\t\t${state.readonly ? \"\" : edit}\n\t\t\t\t`;\n\t\t\t},\n\t\t};\n\t}\n\n\tAddCalendar() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Ops.addCalendar().then(id => {\n\t\t\tthis.Cals.edit(id);\n\t\t\tthis.Cals.getEditor()\n\t\t\t\t.getInputNode()\n\t\t\t\t.setAttribute(\"placeholder\", _(\"(no title)\"));\n\t\t});\n\t}\n\n\tShowPopup(e, id) {\n\t\tif (!this.Compact) {\n\t\t\tthis.Cals.select(id);\n\n\t\t\tconst color = this.Cals.getItem(id).color;\n\t\t\tthis.Popup.Show(id, this.Cals.getItemNode(id), color);\n\t\t} else this.Popup.Show(id);\n\t}\n\n\tToggleCalendar(id) {\n\t\tconst obj = this.Cals.getItem(id);\n\t\tthis.Ops.updateCalendar(id, { active: obj.active ^ 1 });\n\t}\n\n\tToggleState(value) {\n\t\tconst add = this.$$(\"add\");\n\t\tif (value) add.hide();\n\t\telse add.show();\n\n\t\tthis.Cals.refresh();\n\t}\n\n\tSetTitle(id, text) {\n\t\tthis.Ops.updateCalendar(id, { text }).then(\n\t\t\t() => this.EditStopSilent(),\n\t\t\t() => this.EditStopSilent(true)\n\t\t);\n\t\treturn false;\n\t}\n\n\tEditStopSilent(fail) {\n\t\tthis.Cals.blockEvent();\n\t\tif (fail) this.Cals.editCancel();\n\t\telse this.Cals.editStop();\n\t\tthis.Cals.unblockEvent();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport side from \"views/side\";\n\nexport default class NavPopupView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst list = {\n\t\t\tview: \"list\",\n\t\t\tcss: \"webix_scheduler_navlist\",\n\t\t\tlocalId: \"modes\",\n\t\t\tautoheight: true,\n\t\t\tdata: [\n\t\t\t\t{ id: \"day\", value: _(\"Day\"), icon: \"shi-day\" },\n\t\t\t\t{ id: \"week\", value: _(\"Week\"), icon: \"shi-week\" },\n\t\t\t\t{ id: \"month\", value: _(\"Month\"), icon: \"shi-month\" },\n\t\t\t\t{ id: \"agenda\", value: _(\"Agenda\"), icon: \"shi-agenda\" },\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.SetMode(id),\n\t\t\t},\n\t\t};\n\n\t\tconst ui = {\n\t\t\tview: \"sidemenu\",\n\t\t\tborderless: true,\n\t\t\tcss: \"webix_scheduler_sidemenu\",\n\t\t\twidth: 300,\n\t\t\tstate: state => {\n\t\t\t\tconst tHeight = webix.skin.$active.tabbarHeight + 10;\n\t\t\t\tstate.top = tHeight + 2;\n\t\t\t\tstate.height -= tHeight - 2;\n\t\t\t},\n\t\t\tbody: list,\n\t\t};\n\n\t\tif (this.app.config.calendars)\n\t\t\tui.body = {\n\t\t\t\tview: \"scrollview\",\n\t\t\t\tbody: {\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\trows: [list, side],\n\t\t\t\t},\n\t\t\t};\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t}\n\tShow() {\n\t\tconst win = this.getRoot();\n\t\tif (!win.isVisible()) {\n\t\t\tthis.$$(\"modes\").select(this.State.mode);\n\t\t\twin.show();\n\t\t}\n\t}\n\tSetMode(value) {\n\t\tthis.getRoot().hide();\n\n\t\t//wait until hide animation is complete\n\t\tsetTimeout(() => this.State.$batch({ mode: value, selected: null }), 500);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport NavBarView from \"views/bars/nav\";\nimport DateView from \"views/bars/date\";\nimport AddView from \"views/bars/add\";\nimport NavPopupView from \"views/bars/navpopup\";\n\nexport default class TopBarView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tconst todayIcon = {\n\t\t\tview: \"icon\",\n\t\t\ticon: \"wxi-calendar\",\n\t\t\tbatch: \"compact\",\n\t\t\ttooltip: _(\"Today\"),\n\t\t\tclick: () => this.SetToday(),\n\t\t};\n\t\tconst todayBtn = {\n\t\t\tview: \"align\",\n\t\t\talign: \"middle\",\n\t\t\tbatch: \"full\",\n\t\t\tbody: {\n\t\t\t\twidth: 80,\n\t\t\t\tview: \"button\",\n\t\t\t\tcss: \"webix_transparent\",\n\t\t\t\tvalue: _(\"Today\"),\n\t\t\t\tclick: () => this.SetToday(),\n\t\t\t},\n\t\t};\n\n\t\tconst ui = {\n\t\t\tview: \"toolbar\",\n\t\t\tcss: \"webix_scheduler_toolbar webix_dark\",\n\t\t\tresponsive: true,\n\t\t\tpaddingY: 0,\n\t\t\tpaddingX: 4,\n\t\t\theight: webix.skin.$active.tabbarHeight + 10,\n\t\t\tvisibleBatch: this.Compact ? \"compact\" : \"full\",\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"shi-menu\",\n\t\t\t\t\tclick: () => this.ShowNav(),\n\t\t\t\t\thidden: !this.Compact && !this.app.config.calendars,\n\t\t\t\t\tresponsiveCell: false,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tlocalId: \"add\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tbody: AddView,\n\t\t\t\t\tbatch: \"full\",\n\t\t\t\t\t//[ToDO] makes sence to hide it on medium screens to allows smaller compactWidth\n\t\t\t\t\t//in this case click-to-add behaviour for modes must be implemenetd\n\t\t\t\t\tresponsiveCell: false,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tbody: DateView,\n\t\t\t\t\tresponsiveCell: false,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\ttodayBtn,\n\t\t\t\tNavBarView,\n\t\t\t\ttodayIcon,\n\t\t\t],\n\t\t};\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\n\t\tif (this.Compact) this.NavPopup = this.ui(NavPopupView);\n\n\t\tthis.on(this.State.$changes, \"readonly\", value => {\n\t\t\tthis.ToggleAdd(value);\n\t\t});\n\t}\n\tSetToday() {\n\t\tthis.State.date = webix.Date.dayStart(new Date());\n\t}\n\tShowNav() {\n\t\tif (this.Compact) this.NavPopup.Show();\n\t\telse this.app.callEvent(\"show:panel\");\n\t}\n\tToggleAdd(value) {\n\t\tconst add = this.$$(\"add\");\n\t\tif (value) add.hide();\n\t\telse if (!this.Compact) add.show();\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class EventActionMenu extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"popup\",\n\t\t\tbody: {\n\t\t\t\tview: \"menu\",\n\t\t\t\tlayout: \"y\",\n\t\t\t\twidth: 220,\n\t\t\t\tautoheight: true,\n\t\t\t\tdata: [\n\t\t\t\t\t{ id: \"this\", value: _(\"This event\") },\n\t\t\t\t\t{ id: \"next\", value: _(\"This event and the following\") },\n\t\t\t\t\t{ id: \"all\", value: _(\"All events\") },\n\t\t\t\t],\n\t\t\t\ton: {\n\t\t\t\t\tonMenuItemClick: id => {\n\t\t\t\t\t\tif (this.Result) this.Result.resolve(id);\n\t\t\t\t\t\tthis.Result = null;\n\t\t\t\t\t\tthis.Root.hide();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => {\n\t\t\t\t\tif (this.Result) this.Result.reject();\n\t\t\t\t\tthis.Result = null;\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.Root = view;\n\t}\n\n\tShow(node, promise) {\n\t\tthis.Result = promise;\n\t\tthis.Root.show(node);\n\t}\n}\n","const icalFormat = webix.Date.dateToStr(\"%Y%m%dT000000Z\");\n\nexport function parse(string) {\n\t//FREQ=DAILY;INTERVAL=2\n\tconst parts = string.split(\";\");\n\tconst config = {};\n\tfor (let i = 0; i < parts.length; i++) {\n\t\tconst [code, name] = parts[i].split(\"=\");\n\t\tconfig[code] = name;\n\t}\n\n\tif (config.UNTIL) config.UNTIL = strToDate(config.UNTIL);\n\tif (config.EXDATE) {\n\t\tconfig.EXDATE = config.EXDATE.split(\",\").map(d => strToDate(d));\n\t}\n\n\treturn config;\n}\n\nfunction strToDate(str) {\n\treturn new Date(\n\t\tstr.substr(0, 4) * 1,\n\t\tstr.substr(4, 2) * 1 - 1,\n\t\tstr.substr(6, 2) * 1\n\t);\n}\n\nexport function serialize(config) {\n\tconst str = [];\n\tfor (let key in config) {\n\t\tlet value = config[key];\n\t\tif (key === \"UNTIL\") value = icalFormat(value);\n\n\t\tif (key === \"EXDATE\") {\n\t\t\tvalue = value.map(d => icalFormat(d));\n\t\t\tvalue = value.join(\",\");\n\t\t}\n\t\tif (value) str.push(`${key}=${value}`);\n\t}\n\n\treturn str.join(\";\");\n}\n","import { serialize } from \"helpers/ical\";\nexport const WEEKDAYS = [\"SU\", \"MO\", \"TU\", \"WE\", \"TH\", \"FR\", \"SA\"];\n\nexport const FREQUENCE = {\n\tDAILY: \"day\",\n\tWEEKLY: \"week\",\n\tMONTHLY: \"month\",\n\tYEARLY: \"year\",\n};\n\nexport function explodeEvent(sdate, edate, ev) {\n\tconst mode = ev.$recurring;\n\n\t// when exact date not configured, fill recurring config\n\tif (mode.FREQ === \"WEEKLY\" && !mode.BYDAY)\n\t\tmode.BYDAY = WEEKDAYS[ev.start_date.getDay()];\n\tif (\n\t\t(mode.FREQ === \"MONTHLY\" || mode.FREQ === \"YEARLY\") &&\n\t\t!mode.BYSETPOS &&\n\t\t!mode.BYMONTHDAY\n\t)\n\t\tmode.BYMONTHDAY = ev.start_date.getDate();\n\tif (mode.FREQ === \"YEARLY\" && !mode.BYMONTH)\n\t\tmode.BYMONTH = ev.start_date.getMonth();\n\n\tconst consts = {};\n\tconst res = [];\n\n\t// when we use week-days in recurring mode, convert structure\n\t// list of days => list of steps to the next allowed day\n\tfillWdays(mode, consts);\n\n\tconst xdate = new Date(ev.start_date);\n\tconst length = ev.end_date - ev.start_date;\n\n\t// occurrences before active window\n\tlet count = 1;\n\twhile (\n\t\t(sdate - xdate >= (length || 1) &&\n\t\t\t(!mode.UNTIL || xdate < mode.UNTIL) &&\n\t\t\t(!mode.COUNT || count <= mode.COUNT)) ||\n\t\tfindDate(mode.EXDATE, xdate)\n\t) {\n\t\t++count;\n\t\tnext(xdate, mode, consts);\n\t}\n\n\t// occurrences inside of window\n\twhile (\n\t\tedate > xdate &&\n\t\t(!mode.UNTIL || xdate < mode.UNTIL) &&\n\t\t(!mode.COUNT || count <= mode.COUNT)\n\t) {\n\t\t// make copy of recurring event\n\t\tif (!findDate(mode.EXDATE, xdate)) {\n\t\t\tconst copy = webix.copy(ev);\n\n\t\t\txdate.setHours(ev.start_date.getHours());\n\t\t\tcopy.start_date = new Date(xdate);\n\t\t\tcopy.end_date = new Date(xdate * 1 + length);\n\n\t\t\tcopy.$id = ev.id;\n\t\t\tcopy.id = copy.start_date.valueOf() + \"_\" + ev.id;\n\t\t\tres.push(copy);\n\t\t}\n\t\tcount++;\n\n\t\tnext(xdate, mode, consts);\n\t}\n\treturn res;\n}\n\n// IE\nfunction findDate(arr, date) {\n\tif (!arr) return false;\n\n\tfor (let i = 0; i < arr.length; ++i) {\n\t\tif (webix.Date.equal(webix.Date.dayStart(date), arr[i])) return true;\n\t}\n\treturn false;\n}\n\nexport function fillWdays(mode, consts) {\n\tif (mode.BYDAY) {\n\t\tconst diff = (consts.wdays = [0, 0, 0, 0, 0, 0, 0]);\n\t\tconst line = mode.BYDAY.split(\",\")\n\t\t\t.map(a => WEEKDAYS.indexOf(a))\n\t\t\t.sort();\n\n\t\t// for each allowed day, fill range with steps\n\t\tfor (let i = 0; i < line.length; i++) {\n\t\t\tconst s = line[i];\n\t\t\tconst e = line[i + 1] || line[0] + 7;\n\n\t\t\tfor (let j = s; j < e; j++) {\n\t\t\t\tdiff[j % 7] = e - j;\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport function next(date, mode, consts) {\n\tlet interval = (mode.INTERVAL || 1) * 1;\n\tif (mode.FREQ == \"YEARLY\") interval *= 12;\n\n\tlet now, step;\n\tswitch (mode.FREQ) {\n\t\tcase \"DAILY\":\n\t\t\tdate.setDate(date.getDate() + interval);\n\t\t\tbreak;\n\t\tcase \"WEEKLY\":\n\t\t\tnow = date.getDay();\n\t\t\tstep = consts.wdays ? consts.wdays[now] : 7;\n\t\t\tif (step + now > 6 && interval > 1) {\n\t\t\t\t// when new day is on the different week\n\t\t\t\t// add week interval as well\n\t\t\t\tstep += 7 * (interval - 1);\n\t\t\t}\n\t\t\tdate.setDate(date.getDate() + step);\n\t\t\tbreak;\n\t\tcase \"YEARLY\":\n\t\tcase \"MONTHLY\":\n\t\t\tnow = date.getMonth();\n\t\t\tdate.setDate(1);\n\t\t\tdate.setMonth(now + interval);\n\t\t\tif (mode.BYMONTHDAY) {\n\t\t\t\tdate.setDate(mode.BYMONTHDAY);\n\t\t\t\t// when date is outside of month bounds, switch to last day of month\n\t\t\t\tif ((now + interval) % 12 != date.getMonth()) date.setDate(0);\n\t\t\t} else if (mode.BYSETPOS) {\n\t\t\t\t// go to last day of month before one in question\n\t\t\t\tdate.setDate(0);\n\t\t\t\t// find the matching day\n\t\t\t\tfor (let i = 0; i < mode.BYSETPOS; i++) {\n\t\t\t\t\tstep = consts.wdays[date.getDay()];\n\t\t\t\t\tdate.setDate(date.getDate() + step);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t}\n\n\treturn date;\n}\n\nfunction checkDay(sdate, mode) {\n\tconst start = new Date(sdate);\n\tconst days = mode.BYDAY.split(\",\");\n\tconst oldDay = WEEKDAYS[start.getDay()];\n\tconst result = days.includes(oldDay);\n\n\treturn { result, start, days, oldDay };\n}\n\nexport function datesToRec(sdate, edate, mode) {\n\tif (mode.FREQ === \"WEEKLY\") {\n\t\tconst { result, start, days } = checkDay(sdate, mode);\n\t\tif (result) {\n\t\t\treturn [null, null];\n\t\t}\n\n\t\tconst diff = WEEKDAYS.indexOf(days[0]) - start.getDay();\n\t\tstart.setDate(start.getDate() + diff);\n\n\t\tconst end = new Date(edate);\n\t\tend.setDate(end.getDate() + diff);\n\n\t\treturn [start, end];\n\t}\n\n\treturn [null, null];\n}\n\nexport function recToDate(sdate, mode) {\n\tlet { result, days, oldDay } = checkDay(sdate, mode);\n\tif (result) {\n\t\treturn mode.BYDAY;\n\t}\n\n\tif (mode.FREQ === \"WEEKLY\") {\n\t\tdays.splice(WEEKDAYS.indexOf(days[0]), 0, oldDay);\n\t} else {\n\t\tdays = [oldDay];\n\t}\n\treturn days.join(\",\");\n}\n\nexport function getParams(obj) {\n\treturn { id: obj.$id || obj.id, date: obj.$recurring ? obj.id : null };\n}\n\nexport function extractDate(sdate) {\n\treturn webix.Date.dayStart(\n\t\tsdate.getDate ? sdate : new Date(sdate.split(\"_\")[0] * 1)\n\t);\n}\n\nexport function clipSequence(sdate, ev, block) {\n\tconst date = extractDate(sdate);\n\n\tif (!block || (!ev.$recurring.UNTIL || ev.$recurring.UNTIL > date))\n\t\tev.$recurring.UNTIL = date;\n\n\tif (ev.$recurring.COUNT) delete ev.$recurring.COUNT;\n\n\tif (ev.$recurring.EXDATE) {\n\t\tev.$recurring.EXDATE = ev.$recurring.EXDATE.filter(d => d < date);\n\t}\n\n\treturn serialize(ev.$recurring);\n}\n\nexport function cutOccurrence(sdate, ev) {\n\tconst date = extractDate(sdate);\n\n\tif (!ev.$recurring.EXDATE) ev.$recurring.EXDATE = [];\n\tev.$recurring.EXDATE.push(date);\n\n\treturn serialize(ev.$recurring);\n}\n\nexport function separateSequence(obj, sdate) {\n\tconst start_date =\n\t\ttypeof sdate === \"string\"\n\t\t\t? new Date(sdate.split(\"_\")[0] * 1)\n\t\t\t: new Date(sdate);\n\tconst len = (obj.end_date - obj.start_date) / 1000 / 60; // mins\n\tconst end_date = webix.Date.add(start_date, len, \"minute\", true);\n\treturn { start_date, end_date };\n}\n\nexport function isFirstOccurrence(sdate, evStart) {\n\t// editing 'this' event as next\n\tif (!sdate) return false;\n\n\tconst od = sdate.getDate ? sdate : new Date(sdate.split(\"_\")[0] * 1);\n\treturn od <= evStart;\n}\n\nexport function correctMode(obj, mode) {\n\tif (!obj.origin_id || !obj.recurring) {\n\t\tmode = \"all\";\n\t} else {\n\t\t// if this is 1st occ in 'next' which is the last part of 'all'\n\t\tif (this.app.getService(\"local\").isLastPart(obj)) {\n\t\t\tmode = \"\";\n\t\t}\n\t}\n\treturn mode;\n}\n\nexport function movePattern(rec, newEvent, obj) {\n\tlet days =\n\t\twebix.Date.dayStart(newEvent.start_date) -\n\t\twebix.Date.dayStart(obj.start_date);\n\tif (days) days /= 1000 * 60 * 60 * 24;\n\n\tif (rec.UNTIL && days) {\n\t\trec.UNTIL = webix.Date.add(rec.UNTIL, days, \"day\", true);\n\t}\n\n\t// day of start_date changed and pattern doesn't have in anymore\n\tif (rec.BYDAY && days) {\n\t\tdays %= 7;\n\t\tif (days < 0) days += 7;\n\t\trec.BYDAY = rec.BYDAY.split(\",\")\n\t\t\t.map(d => WEEKDAYS[(WEEKDAYS.indexOf(d) + days) % 7])\n\t\t\t.join(\",\");\n\t}\n\n\t// in case day of start_date changed in monthly or yearly\n\tif (rec.BYMONTHDAY && days) {\n\t\tconst nmd = newEvent.start_date.getDate();\n\t\tif (nmd != rec.BYMONTHDAY) {\n\t\t\trec.BYMONTHDAY = nmd;\n\t\t}\n\t}\n\n\t// week number of start_date changed in yearly or monthly\n\tif (rec.BYSETPOS) {\n\t\tconst nwn = getWeekNum(newEvent.start_date);\n\t\tif (rec.BYSETPOS != nwn) rec.BYSETPOS = nwn;\n\t}\n\n\t// month of start_date changed in a yearly event\n\tif (rec.BYMONTH) {\n\t\tconst nm = newEvent.start_date.getMonth() + 1;\n\t\tif (nm != rec.BYMONTH) rec.BYMONTH = nm;\n\t}\n\n\treturn rec;\n}\n\nfunction getWeekNum(date) {\n\tconst day = date.getDate();\n\treturn Math.floor(day / 7) + (day % 7 ? 1 : 0);\n}\n","import { JetView } from \"webix-jet\";\nimport { WEEKDAYS, fillWdays, next } from \"helpers/recurring\";\n\nexport default class RecurringFormView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"recurringForm\",\n\t\t\thidden: true,\n\t\t\telementsConfig: { labelPosition: \"left\" },\n\t\t\tpadding: {\n\t\t\t\ttop: aSkin.layoutPadding.form,\n\t\t\t\tbottom: 0,\n\t\t\t\tleft: compact ? aSkin.layoutPadding.form : 0,\n\t\t\t\tright: compact ? 14 : 0,\n\t\t\t},\n\t\t\tborderless: true,\n\t\t\trows: [\n\t\t\t\tthis.CreateIntervalControls(_),\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"customRecControls\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\trows: [this.CreateCheckboxes(_), this.CreateSelect()],\n\t\t\t\t},\n\t\t\t\tthis.CreateRadio(_),\n\t\t\t],\n\t\t};\n\n\t\tif (!compact) {\n\t\t\tform.on = {\n\t\t\t\tonChange: () => this.UpdateEvent(),\n\t\t\t};\n\t\t}\n\n\t\treturn form;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.Form = this.$$(\"recurringForm\");\n\t\tthis.Events = this.app.getService(\"local\").events(true);\n\n\t\t// commonly called controls\n\t\tthis.CheckBoxContainer = this.$$(\"weekly\");\n\t\tthis.Checkboxes = this.CheckBoxContainer.getChildViews().slice(1);\n\t\tthis.Checkboxes.pop();\n\t\tthis.PatternSelect = this.$$(\"patternSelect\");\n\t\tthis.UntilDateContainer = this.$$(\"untilDate\");\n\t\tthis.UntilDateCalendar = this.Form.elements.untilDate.getPopup().getBody();\n\t\tthis.UntilNumContainer = this.$$(\"untilCount\");\n\t\tthis.UntilNum = this.UntilNumContainer.getBody();\n\t\tthis.CustomRecControls = this.$$(\"customRecControls\");\n\t}\n\n\t// methods of main controls: counter of INTERVAL and richselect of FREQ\n\tCreateIntervalControls(_) {\n\t\treturn {\n\t\t\tmargin: 8,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"counter\",\n\t\t\t\t\tlabel: _(\"Every\"),\n\t\t\t\t\tlabelWidth: 50,\n\t\t\t\t\tmin: 1,\n\t\t\t\t\tname: \"INTERVAL\",\n\t\t\t\t\tcss: \"webix_scheduler_counter\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\tname: \"FREQ\",\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ id: \"DAILY\", value: _(\"day\") },\n\t\t\t\t\t\t{ id: \"WEEKLY\", value: _(\"week\") },\n\t\t\t\t\t\t{ id: \"MONTHLY\", value: _(\"month\") },\n\t\t\t\t\t\t{ id: \"YEARLY\", value: _(\"year\") },\n\t\t\t\t\t],\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: v => this.ChangeControls(v),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tChangeControls(v) {\n\t\tthis._freq = v;\n\t\tif (v === \"DAILY\") {\n\t\t\tthis.CustomRecControls.hide();\n\t\t} else {\n\t\t\tthis.CustomRecControls.show();\n\t\t\tif (v === \"WEEKLY\") {\n\t\t\t\tthis.CheckBoxContainer.show();\n\t\t\t\tthis.PatternSelect.hide();\n\t\t\t} else {\n\t\t\t\tthis.CheckBoxContainer.hide();\n\t\t\t\tthis.PatternSelect.show();\n\t\t\t\tthis.PatternSelect.refresh();\n\t\t\t}\n\t\t}\n\t}\n\n\t// methods of checkboxes for WEEKLY\n\tCreateCheckboxes(_) {\n\t\tconst days = [];\n\t\tfor (let i = 0; i < 7; ++i) {\n\t\t\tdays.push({\n\t\t\t\tview: \"checkbox\",\n\t\t\t\tlabel: webix.i18n.calendar.dayShort[i],\n\t\t\t\tlabelPosition: \"top\",\n\t\t\t\tlabelAlign: \"center\",\n\t\t\t\tcss: \"webix_scheduler_day_checkbox\",\n\t\t\t\tinputWidth: 26,\n\t\t\t\twidth: 45,\n\t\t\t\talign: \"center\",\n\t\t\t\tname: WEEKDAYS[i],\n\t\t\t\ton: {\n\t\t\t\t\tonChange(v, o) {\n\t\t\t\t\t\tif (!webix.isUndefined(o) && !v && !this.$scope.GetBYDAY()) {\n\t\t\t\t\t\t\tthis.$scope.SetSilently(this, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\treturn {\n\t\t\tlocalId: \"weekly\",\n\t\t\tcols: [\n\t\t\t\t{ view: \"label\", label: _(\"on\"), width: 45 },\n\t\t\t\t...days,\n\t\t\t\t{ gravity: 0.00001 },\n\t\t\t],\n\t\t};\n\t}\n\n\tSetBYDAY(values) {\n\t\tconst days = values.BYDAY.split(\",\");\n\t\tthis.Checkboxes.forEach(check => {\n\t\t\tvalues[check.config.name] = !!days.find(d => d == check.config.name);\n\t\t});\n\t}\n\n\tGetBYDAY() {\n\t\tconst BYDAY = [];\n\t\tthis.Checkboxes.forEach(check => {\n\t\t\tif (check.getValue()) {\n\t\t\t\tBYDAY.push(check.config.name);\n\t\t\t}\n\t\t});\n\t\treturn BYDAY.join(\",\");\n\t}\n\n\t// methods of richselect with MONTHLY and YEARLY patterns\n\tCreateSelect() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"richselect\",\n\t\t\tlocalId: \"patternSelect\",\n\t\t\tname: \"rec_pattern\",\n\t\t\tsuggest: {\n\t\t\t\tdata: [],\n\t\t\t\tbody: {\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\tconst byDay = [];\n\t\t\t\t\t\tif (obj.BYDAY) {\n\t\t\t\t\t\t\tobj.BYDAY.forEach(d =>\n\t\t\t\t\t\t\t\tbyDay.push(webix.i18n.calendar.dayFull[d])\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn `${_(\"Every\")} ${obj.BYMONTHDAY || obj.BYSETPOS} ${\n\t\t\t\t\t\t\tobj.BYDAY ? byDay.join(\", \") : \"\"\n\t\t\t\t\t\t} ${\n\t\t\t\t\t\t\tthis._freq === \"YEARLY\"\n\t\t\t\t\t\t\t\t? webix.i18n.calendar.monthFull[obj.BYMONTH - 1]\n\t\t\t\t\t\t\t\t: \"\"\n\t\t\t\t\t\t}`;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tSetPatternOptions(ev, calculated) {\n\t\tlet byDay;\n\t\tif (ev.BYDAY) {\n\t\t\tbyDay = ev.BYDAY.split(\",\").map(d => WEEKDAYS.indexOf(d));\n\t\t} else {\n\t\t\tbyDay = [calculated.weekday];\n\t\t}\n\t\tthis.PatternSelect.getList().parse([\n\t\t\t{\n\t\t\t\tid: 1,\n\t\t\t\tBYMONTH: ev.BYMONTH || calculated.month + 1,\n\t\t\t\tBYMONTHDAY: ev.BYMONTHDAY || calculated.day,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: 2,\n\t\t\t\tBYSETPOS: ev.BYSETPOS || calculated.weekNum,\n\t\t\t\tBYDAY: byDay,\n\t\t\t\tBYMONTH: ev.BYMONTH || calculated.month + 1,\n\t\t\t},\n\t\t]);\n\t\tthis._freq = ev.FREQ;\n\n\t\tev.rec_pattern = ev.BYSETPOS ? 2 : 1;\n\t}\n\n\tGetRecPattern(values) {\n\t\tconst data = webix.copy(\n\t\t\tthis.PatternSelect.getList().getItem(values.rec_pattern)\n\t\t);\n\n\t\tif (this._freq === \"MONTHLY\") delete data.BYMONTH;\n\t\tif (data.BYDAY) data.BYDAY = data.BYDAY.map(d => WEEKDAYS[d]);\n\t\tdelete data.id;\n\n\t\treturn data;\n\t}\n\n\t// methods of radio for UNTIL\n\tCreateRadio(_) {\n\t\tconst selectors = {\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"untilDate\",\n\t\t\t\t\talign: \"middle\",\n\t\t\t\t\tview: \"align\",\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\tname: \"untilDate\",\n\t\t\t\t\t\ticons: false,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"untilCount\",\n\t\t\t\t\tview: \"align\",\n\t\t\t\t\talign: \"bottom\",\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tname: \"untilCount\",\n\t\t\t\t\t\tview: \"counter\",\n\t\t\t\t\t\tcss: \"webix_scheduler_counter\",\n\t\t\t\t\t\tmin: 1,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn {\n\t\t\trows: [\n\t\t\t\t{ view: \"label\", label: _(\"End repeat\") },\n\t\t\t\t{\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"radio\",\n\t\t\t\t\t\t\tname: \"until\",\n\t\t\t\t\t\t\tlocalId: \"until\",\n\t\t\t\t\t\t\tvertical: true,\n\t\t\t\t\t\t\tgravity: 1.5,\n\t\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t\t{ id: 1, value: _(\"never\") },\n\t\t\t\t\t\t\t\t{ id: 2, value: _(\"date\") },\n\t\t\t\t\t\t\t\t{ id: 3, value: _(\"after several occurrences\") },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\tonChange: v => this.ChangeSelectors(v),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\tselectors,\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tChangeSelectors(v) {\n\t\tthis.UntilDateContainer[v === \"2\" ? \"show\" : \"hide\"]();\n\t\tthis.UntilNumContainer[v === \"3\" ? \"show\" : \"hide\"]();\n\t}\n\n\tSetUNTIL(start, values) {\n\t\tvalues.until = values.COUNT ? 3 : values.UNTIL ? 2 : 1;\n\t\tvalues.untilDate = values.UNTIL || webix.Date.add(start, 1, \"year\", true);\n\t\tvalues.untilCount = values.COUNT || this.CountNum(start, values);\n\t\tthis.UntilDateCalendar.define({ minDate: start });\n\t}\n\n\tCountNum(start, values) {\n\t\tlet res = 0;\n\n\t\tif (values.UNTIL) {\n\t\t\tconst consts = {};\n\t\t\tfillWdays(values, consts);\n\t\t\tlet date = webix.Date.copy(start);\n\n\t\t\twhile (date <= values.UNTIL) {\n\t\t\t\tdate = next(date, values, consts);\n\t\t\t\tres++;\n\t\t\t}\n\t\t} else {\n\t\t\tres = 3;\n\t\t}\n\n\t\treturn res;\n\t}\n\n\t// subform methods\n\tSetValues(event, calculated, silent) {\n\t\tthis._StartDate = event.start_date;\n\t\tlet values = event.$recurring;\n\n\t\tif (!values) {\n\t\t\tvalues = { FREQ: \"DAILY\" };\n\t\t}\n\n\t\tif (!values.INTERVAL) values.INTERVAL = 1;\n\t\tif (!values.BYDAY) {\n\t\t\tvalues.BYDAY = WEEKDAYS[calculated.weekday];\n\t\t}\n\n\t\t// for a reset\n\t\tif (!values.EXDATE) values.EXDATE = [];\n\n\t\tthis.SetUNTIL(event.start_date, values);\n\t\tthis.SetBYDAY(values);\n\t\tthis.SetPatternOptions(values, calculated);\n\t\tthis.Form.setValues(values, true);\n\t\tif (silent) this.Form.setDirty();\n\t}\n\n\tGetValues() {\n\t\tlet values = this.Form.getValues();\n\n\t\tlet res = {\n\t\t\tFREQ: values.FREQ,\n\t\t\tINTERVAL: values.INTERVAL,\n\t\t\tUNTIL: values.until == 2 ? values.untilDate : null,\n\t\t\tCOUNT: values.until == 3 ? values.untilCount : null,\n\t\t\tEXDATE: values.EXDATE || [],\n\t\t};\n\n\t\tif (values.FREQ === \"WEEKLY\") {\n\t\t\tres.BYDAY = this.GetBYDAY(values);\n\t\t} else if (values.FREQ === \"MONTHLY\" || values.FREQ === \"YEARLY\") {\n\t\t\tres = webix.extend(res, this.GetRecPattern(values));\n\t\t}\n\n\t\tthis.Form.setDirty();\n\n\t\treturn res;\n\t}\n\n\tUpdateEvent() {\n\t\tif (this.IsDirty()) {\n\t\t\tconst change = this.GetValues();\n\t\t\tthis.app.callEvent(\"form:update:recurring\", [{ $recurring: change }]);\n\t\t\tthis.Form.setDirty();\n\t\t}\n\t}\n\n\tIsDirty() {\n\t\treturn this.Form.isDirty();\n\t}\n\n\tShow() {\n\t\tthis.getRoot().show();\n\t}\n\n\tHide() {\n\t\tthis.getRoot().hide();\n\t}\n\n\t// applies changes in values made by code to form\n\tSetSilently(control, value) {\n\t\tcontrol.blockEvent();\n\t\tcontrol.setValue(value);\n\t\tcontrol.unblockEvent();\n\t}\n\n\tUpdateSilently(values) {\n\t\tthis.Form.blockEvent();\n\t\tthis.Form.setValues(values, true);\n\t\tthis.Form.unblockEvent();\n\t}\n}\n","import {\n\tisFirstOccurrence,\n\tcorrectMode,\n\textractDate,\n\tFREQUENCE,\n\tfillWdays,\n\tnext,\n} from \"./recurring\";\n\n/* public functions */\n\n/**\n * Changes the mode if the user selected the 1st occurrence in whole sequence or in 'next'\n * @param {string} mode - the mode of editing a recurring event (\"all\", \"next\", \"this\")\n * @param {object} obj - the event object\n * @param {Date} start - the start date of the event\n * @param {Date, string} date_id - the ID of an occurrence of a repeated event or the date of this occurrence\n */\nfunction changeMode(mode, obj, start, date_id) {\n\tif (mode && mode === \"next\" && isFirstOccurrence(date_id, start)) {\n\t\tmode = correctMode.call(this, obj, mode);\n\t}\n\n\treturn mode;\n}\n\n/**\n * Corrects recurring.COUNT or recurring.UNTIL based on all sub-events that are included in the edited range\n * @param {Object} obj - the event data\n * @param {string} mode - the mode of recurring editing (\"all\", \"next\")\n * @param {Date} sdate - the date of the currently selected event occurrence\n * @param {Object} collection - DataCollection of events\n */\nfunction correctCountUntil(obj, mode, sdate, collection) {\n\tconst oid = obj.origin_id || obj.$id || obj.id;\n\tconst parts = collection\n\t\t.find(e => {\n\t\t\treturn oid == e.origin_id && sdate < e.start_date;\n\t\t})\n\t\t.sort((a, b) => {\n\t\t\tif (a.start_date > b.start_date) return -1;\n\t\t\tif (a.start_date < b.start_date) return 1;\n\t\t\treturn 0;\n\t\t});\n\n\tconst rec = webix.copy(obj.$recurring);\n\n\tfor (let i = 0, last; i < parts.length; ++i) {\n\t\tlast = parts[i];\n\n\t\tif (last.$recurring) {\n\t\t\tif (last.$recurring.COUNT) {\n\t\t\t\tif (rec.COUNT && obj.$id != last.id) {\n\t\t\t\t\trec.COUNT = rec.COUNT * 1 + last.$recurring.COUNT * 1;\n\t\t\t\t} else {\n\t\t\t\t\trec.UNTIL = countToUntil(last);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trec.UNTIL = last.$recurring.UNTIL;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (mode === \"next\" && !parts.length) {\n\t\tif (rec.COUNT) {\n\t\t\trec.COUNT = cutCount(obj, sdate);\n\t\t} else if (rec.UNTIL && obj.start_date >= rec.UNTIL) {\n\t\t\trec.UNTIL = webix.Date.add(\n\t\t\t\twebix.Date.dayStart(obj.start_date),\n\t\t\t\t1,\n\t\t\t\tFREQUENCE[rec.FREQ],\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t}\n\n\treturn rec;\n}\n\n/**\n * Checks if the selected repeating event has only 1 occurrence\n * @param {Object} obj - the event data\n */\nfunction hasOneOccurrence(obj) {\n\t// as this a 'this' event\n\tif (!obj.recurring) return true;\n\n\t// as 'this' any occurrence in unedited sequence\n\tif (!obj.$recurring.UNTIL) return false;\n\n\tconst end = webix.Date.dayStart(webix.Date.add(obj.end_date, 1, \"day\", true));\n\treturn webix.Date.equal(end, obj.$recurring.UNTIL);\n}\n\n/* EO public functions */\n\n/* private functions */\nfunction countToUntil(last) {\n\tconst lr = last.$recurring;\n\tlet step = lr.COUNT * 1; // !\n\tif (lr.FREQ === \"WEEKLY\") {\n\t\tstep = Math.floor((lr.BYDAY.split(\",\").length / 7) * lr.COUNT);\n\t}\n\treturn webix.Date.add(last.start_date, step, FREQUENCE[lr.FREQ], true);\n}\n\nfunction cutCount(obj, sdate) {\n\tconst date = extractDate(sdate);\n\n\tconst consts = {};\n\tfillWdays(obj.$recurring, consts);\n\tlet nexto = webix.Date.dayStart(obj.start_date);\n\tlet count = 0;\n\twhile (nexto < date) {\n\t\tcount++;\n\t\tnexto = next(nexto, obj.$recurring, consts);\n\t}\n\treturn obj.$recurring.COUNT - count;\n}\n/* EO private functions */\n\nexport default function EditRecurringMixin(child) {\n\tchild.ChangeMode = changeMode;\n\tchild.CorrectCountUntil = correctCountUntil;\n\tchild.HasOneOccurrence = hasOneOccurrence;\n}\n","import { JetView } from \"webix-jet\";\nimport getPalette from \"helpers/palette\";\n\nimport {\n\tWEEKDAYS,\n\tfillWdays,\n\tnext,\n\tdatesToRec,\n\trecToDate,\n\tclipSequence,\n\tcutOccurrence,\n\tseparateSequence,\n} from \"helpers/recurring\";\nimport { serialize } from \"helpers/ical\";\nimport RecurringFormView from \"./recurringform\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\n\nexport default class EventFormView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst toolbar = {\n\t\t\tview: \"toolbar\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: 14,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\ttooltip: _(\"Close\"),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => this.Close(),\n\t\t\t\t},\n\t\t\t\t{ view: \"label\", label: _(\"Edit event\") },\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\twidth: 130,\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tvalue: _(\"Done\"),\n\t\t\t\t\thotkey: \"Ctrl+Enter\",\n\t\t\t\t\tclick: () => this.Done(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"form\",\n\t\t\tscroll: true,\n\t\t\tborderless: true,\n\t\t\tpadding: { right: 14 },\n\t\t\telementsConfig: { labelPosition: \"top\" },\n\t\t\telements: [\n\t\t\t\t{ view: \"text\", label: _(\"Event\"), name: \"text\" },\n\t\t\t\t{\n\t\t\t\t\tmargin: 8,\n\t\t\t\t\trows: [\n\t\t\t\t\t\tthis.GetDateTime(\"start\", _, aSkin),\n\t\t\t\t\t\tthis.GetDateTime(\"end\", _, aSkin),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"checkbox\",\n\t\t\t\t\tname: \"all_day\",\n\t\t\t\t\tlabelPosition: \"left\",\n\t\t\t\t\tlabelWidth: 0,\n\t\t\t\t\tlabelRight: _(\"labelAllday\"),\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: v => this.ToggleTimeControls(v),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tthis.CreateCalendarColor(_),\n\t\t\t\t{\n\t\t\t\t\tview: \"textarea\",\n\t\t\t\t\tlabel: _(\"Notes\"),\n\t\t\t\t\tname: \"details\",\n\t\t\t\t\theight: 150,\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t],\n\t\t\ton: {},\n\t\t};\n\n\t\tif (this.app.config.recurring)\n\t\t\tform.elements.splice(3, 0, this.CreateRepeat(_, aSkin));\n\n\t\tif (!this.Compact) {\n\t\t\tform.on.onChange = (v, o) => {\n\t\t\t\tthis.Wait(() => this.UpdateEvent(this.Form.getDirtyValues(), o));\n\t\t\t};\n\t\t}\n\n\t\tconst config = {\n\t\t\tview: \"proxy\", // for borders\n\t\t\tbody: {\n\t\t\t\tmargin: 0,\n\t\t\t\trows: [toolbar, form],\n\t\t\t},\n\t\t};\n\n\t\treturn config;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.Form = this.$$(\"form\");\n\t\tthis.Local = this.app.getService(\"local\").events(true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\n\t\t// extending this class with common methods for editing of recurring events\n\t\tEditRecurringMixin(this);\n\n\t\t// most commonly called controls\n\t\tthis.RecurringOptions = this.$$(\"recOption\");\n\t\tthis.StartTime = this.$$(\"startTime\");\n\t\tthis.EndTime = this.$$(\"endTime\");\n\n\t\tthis.on(this.State.$changes, \"readonly\", (_v, o) => {\n\t\t\tif (!webix.isUndefined(o)) this.Close();\n\t\t});\n\n\t\tthis.on(this.app, \"form:update:recurring\", update => {\n\t\t\t// 'update' as imitated dirty value\n\t\t\tthis.UpdateEvent(update);\n\t\t});\n\n\t\t// parse lists that are not data dependable\n\t\tif (this.app.config.calendars) {\n\t\t\tthis.Calendars = this.app.getService(\"local\").calendars(true);\n\t\t\tthis.$$(\"calendar\")\n\t\t\t\t.getList()\n\t\t\t\t.parse(this.Calendars);\n\t\t}\n\t}\n\n\tready() {\n\t\tthis.SubForm = this.getSubView(\"recurringForm\");\n\t\tthis.on(this.State.$changes, \"selected\", v => {\n\t\t\tif (v) {\n\t\t\t\tthis.ClearTempEvent(); // support double clicks and 'Create' at any moment\n\t\t\t\tthis.Wait(() => this.FillForm(v));\n\t\t\t}\n\t\t});\n\t}\n\n\tdestroy() {\n\t\tthis.ClearTempEvent();\n\t}\n\n\t/**\n\t * Returns the config controls for editing recurring patterns of events\n\t * @param {function} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t * @param {Object} aSkin - stores sizes and colors of a currently active Webix skin\n\t */\n\tCreateRepeat(_, aSkin) {\n\t\tconst rows = [\n\t\t\t{ view: \"label\", label: _(\"Repeat\"), height: aSkin.labelTopHeight },\n\t\t\t{\n\t\t\t\tmargin: 4,\n\t\t\t\tcols: [\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\t\tlocalId: \"recOption\",\n\t\t\t\t\t\tname: \"rec_option\",\n\t\t\t\t\t\tsuggest: {\n\t\t\t\t\t\t\tdata: [\n\t\t\t\t\t\t\t\t{ id: \"none\", value: _(\"never\") },\n\t\t\t\t\t\t\t\t{ id: \"daily\", value: _(\"daily\") },\n\t\t\t\t\t\t\t\t{ id: \"weekly\" },\n\t\t\t\t\t\t\t\t{ id: \"monthly\" },\n\t\t\t\t\t\t\t\t{ id: \"yearly\" },\n\t\t\t\t\t\t\t\t{ id: \"work\", value: _(\"every working day\") },\n\t\t\t\t\t\t\t\t{ id: \"custom\", value: _(\"custom\") },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\tonChange: (v, o) => this.ToggleSubform(v, o),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t];\n\n\t\tif (this.Compact) {\n\t\t\trows[1].cols.push({\n\t\t\t\tlocalId: \"editCustomRec\",\n\t\t\t\tview: \"icon\",\n\t\t\t\ticon: \"wxi-pencil\",\n\t\t\t\ttooltip: _(\"Change recurring pattern\"),\n\t\t\t\thidden: true,\n\t\t\t\tclick: () => this.ShowSubForm(),\n\t\t\t});\n\t\t}\n\n\t\trows.push({ $subview: RecurringFormView, name: \"recurringForm\" });\n\n\t\treturn { localId: \"repeatControls\", rows: rows };\n\t}\n\n\t/**\n\t * Hides or shows time selectors\n\t * @param {number} v - the value of 'all day' checkbox (1 or 0)\n\t */\n\tToggleTimeControls(v) {\n\t\tif (v == 1) {\n\t\t\tthis.StartTime.hide();\n\t\t\tthis.EndTime.hide();\n\t\t} else {\n\t\t\tthis.StartTime.show();\n\t\t\tthis.EndTime.show();\n\t\t}\n\t}\n\n\t/**\n\t * Shows or hides the subform for editing recurring pattern; the subform is shown when v is 'custom'\n\t * @param {string} v - the new recurring pattern option\n\t * @param {string} o  - the new recurring pattern option\n\t */\n\tToggleSubform(v, o) {\n\t\tif (v === \"custom\") {\n\t\t\tif (this.Compact) {\n\t\t\t\tthis.$$(\"editCustomRec\").show();\n\t\t\t\tif (o) this.ShowSubForm();\n\t\t\t} else {\n\t\t\t\tthis.SubForm.Show();\n\t\t\t}\n\t\t} else {\n\t\t\tthis.SubForm.Hide();\n\t\t\tif (this.Compact) this.$$(\"editCustomRec\").hide();\n\t\t}\n\t}\n\n\t/**\n\t * Returns the config of two controls: a selector of calendar and event color\n\t * @param {function} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t */\n\tCreateCalendarColor(_) {\n\t\tconst ui = {\n\t\t\tmargin: 8,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"colorpicker\",\n\t\t\t\t\tlabel: _(\"Color\"),\n\t\t\t\t\tname: \"color\",\n\t\t\t\t\tvalue: \"#1abc9c\",\n\t\t\t\t\tsuggest: {\n\t\t\t\t\t\ttype: \"colorboard\",\n\t\t\t\t\t\tpadding: 3,\n\t\t\t\t\t\tbody: getPalette(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t\tif (this.app.config.calendars) {\n\t\t\tui.cols.unshift({\n\t\t\t\tview: \"richselect\",\n\t\t\t\tlocalId: \"calendar\",\n\t\t\t\tlabel: _(\"Calendar\"),\n\t\t\t\tname: \"calendar\",\n\t\t\t\tcss: \"webix_scheduler_cal_color\",\n\t\t\t\toptions: {\n\t\t\t\t\tcss: \"webix_scheduler_cal_color_suggest\",\n\t\t\t\t\tdata: [],\n\t\t\t\t\tbody: {\n\t\t\t\t\t\ttooltip: () => \"\",\n\t\t\t\t\t\ttemplate: function(obj) {\n\t\t\t\t\t\t\tconst active = obj.active * 1;\n\t\t\t\t\t\t\tconst css = active ? \"\" : \"class='webix_scheduler_cal_disabled'\";\n\t\t\t\t\t\t\tconst tooltip = active\n\t\t\t\t\t\t\t\t? \"\"\n\t\t\t\t\t\t\t\t: `webix_tooltip=\"${_(\"Inactive calendar\")}\"`;\n\n\t\t\t\t\t\t\treturn `<div style=\"overflow: hidden;\" ${tooltip} ${css}>${obj.text ||\n\t\t\t\t\t\t\t\t_(\"(no title)\")}\n\t\t\t\t\t\t\t\t<span class=\"webix_scheduler_cal_marker\" style=\"background-color:${obj.color};\">\n\t\t\t\t\t\t\t</span></div>`;\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\treturn ui;\n\t}\n\n\t/**\n\t * Returns the config of controls for selecting date and time\n\t * @param {string} type - \"start\" or \"end\"\n\t * @param {function*} _ - the method of the Locale plugin used to translate labels according to the current locale\n\t * @param {Object} aSkin - stores sizes and colors of a currently active Webix skin\n\t */\n\tGetDateTime(type, _, aSkin) {\n\t\treturn {\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tview: \"label\",\n\t\t\t\t\theight: aSkin.labelTopHeight,\n\t\t\t\t\tlabel: type === \"start\" ? _(\"Start\") : _(\"End\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tmargin: 8,\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\t\tname: `${type}_date`,\n\t\t\t\t\t\t\tsuggest: {\n\t\t\t\t\t\t\t\ttype: \"calendar\",\n\t\t\t\t\t\t\t\ticons: false,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\t\tlocalId: `${type}Time`,\n\t\t\t\t\t\t\tname: `${type}_time`,\n\t\t\t\t\t\t\ttype: \"time\",\n\t\t\t\t\t\t\tformat: \"%H:%i\",\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\t// general form tasks\n\n\t/**\n\t * Fills the form with relevant values for editing of a selected event or adding a new event\n\t * @param {Object} ev - the current state.selected\n\t */\n\tFillForm(ev) {\n\t\tthis.Form.focus();\n\n\t\tthis.Id = ev.id;\n\n\t\tthis.Form.focus();\n\t\tthis.Date = ev.date;\n\t\tif (typeof this.Date === \"string\") {\n\t\t\tthis.Date = new Date(this.Date.slice(0, this.Date.indexOf(\"_\")) * 1);\n\t\t}\n\n\t\tlet obj;\n\n\t\t// new record\n\t\tif (ev.id == \"0\") {\n\t\t\tobj = this.NewEvent();\n\t\t\tif (obj.then) {\n\t\t\t\treturn obj.then(res => {\n\t\t\t\t\tthis.Local.add({ id: ev.id, ...webix.copy(res) });\n\t\t\t\t\tthis.FillFormContinue(res);\n\t\t\t\t});\n\t\t\t} else this.Local.add({ id: ev.id, ...webix.copy(obj) });\n\t\t} else {\n\t\t\tobj = webix.copy(this.Local.getItem(ev.id));\n\n\t\t\tconst mode = this.getParam(\"mode\", true);\n\t\t\tif (mode) obj = this.AdaptObjToMode(mode, obj);\n\t\t}\n\n\t\tthis.FillFormContinue(obj);\n\t}\n\n\t/**\n\t * Fills the event object with relevant values according to the mode of editing\n\t * @param {string} mode - mode in which a recurring event will be edited (\"all\", \"next\", \"this\")\n\t * @param {Object} obj - event data\n\t */\n\tAdaptObjToMode(mode, obj) {\n\t\tmode = this.ChangeMode(\n\t\t\tmode,\n\t\t\tobj,\n\t\t\tobj.recurring\n\t\t\t\t? obj.start_date\n\t\t\t\t: this.Local.getItem(obj.origin_id).start_date,\n\t\t\tobj.recurring ? this.State.selected.date : obj.start_date\n\t\t);\n\t\tthis.setParam(\"mode\", mode, true);\n\n\t\tif (mode === \"all\" || mode === \"next\") {\n\t\t\tif (mode === \"all\" && obj.origin_id) {\n\t\t\t\tobj = webix.copy(this.Local.getItem(obj.origin_id));\n\t\t\t}\n\n\t\t\t// if this is a \"this\" sub-event\n\t\t\tif (!obj.$recurring)\n\t\t\t\tobj.$recurring = webix.copy(\n\t\t\t\t\tthis.Local.getItem(obj.origin_id).$recurring\n\t\t\t\t);\n\n\t\t\tif (obj.$recurring.COUNT || obj.$recurring.UNTIL) {\n\t\t\t\t// [FIXME] maybe need to store total UNTIL/COUNT on backend (mostly for dynamic loading)\n\t\t\t\tobj.$recurring = this.CorrectCountUntil(\n\t\t\t\t\tobj,\n\t\t\t\t\tmode,\n\t\t\t\t\tobj.start_date,\n\t\t\t\t\tthis.Local\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (mode === \"this\" || mode === \"next\") {\n\t\t\t// split event sequence or cut out an occurrence\n\t\t\tif (this.State.selected.date)\n\t\t\t\tobj = { ...obj, ...separateSequence(obj, this.State.selected.date) };\n\n\t\t\tif (mode === \"this\") {\n\t\t\t\tobj.$recurring = null;\n\t\t\t\tobj.recurring = \"\";\n\t\t\t\tthis.$$(\"repeatControls\").hide();\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Splits start and end dates into date and time parts and fills the form with values\n\t * @param {Object} obj - the event data\n\t */\n\tFillFormContinue(obj) {\n\t\tobj.start_time = webix.Date.copy(obj.start_date);\n\t\tobj.end_time = webix.Date.copy(obj.end_date);\n\n\t\tobj.start_date = webix.Date.datePart(obj.start_date);\n\t\tobj.end_date = webix.Date.datePart(obj.end_date);\n\n\t\tif (this.app.config.recurring) this.SetRecurring(obj);\n\n\t\tthis.Form.setValues(obj);\n\t}\n\n\t/**\n\t * Calculates constants related to the start date of an event\n\t * @param {Date} start - the start date of an event\n\t */\n\tGetFromStartDate(start) {\n\t\tconst res = {\n\t\t\tweekday: start.getDay(),\n\t\t\tday: start.getDate(),\n\t\t\tmonth: start.getMonth(),\n\t\t};\n\t\tres.weekNum = Math.floor(res.day / 7) + (res.day % 7 ? 1 : 0);\n\t\treturn res;\n\t}\n\n\t/**\n\t * Sets controls and their values for recurring patterns\n\t * @param {Object} obj - the event data\n\t */\n\tSetRecurring(obj) {\n\t\tconst today = this.GetFromStartDate(obj.start_date);\n\t\tconst roptions = this.ResetRecurringOptions(today);\n\t\tthis.RecurringOptions.getList().parse(roptions);\n\n\t\tthis.SubForm.SetValues(webix.copy(obj), today, true);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (!obj.$recurring) {\n\t\t\tobj.rec_option = _(\"none\");\n\t\t} else if (obj.$recurring.BYDAY === \"MO,TU,WE,TH,FR\") {\n\t\t\tobj.rec_option = \"work\";\n\t\t} else if (\n\t\t\t!obj.$recurring.UNTIL &&\n\t\t\t!obj.$recurring.COUNT &&\n\t\t\t(!obj.$recurring.INTERVAL || obj.$recurring.INTERVAL == 1) &&\n\t\t\t(obj.$recurring.FREQ === \"DAILY\" ||\n\t\t\t\t(obj.$recurring.FREQ === \"WEEKLY\" &&\n\t\t\t\t\tobj.$recurring.BYDAY == WEEKDAYS[today.weekday]) ||\n\t\t\t\t(obj.$recurring.FREQ === \"MONTHLY\" &&\n\t\t\t\t\tobj.$recurring.BYSETPOS &&\n\t\t\t\t\tobj.$recurring.BYSETPOS == today.weekNum &&\n\t\t\t\t\tobj.$recurring.BYDAY == WEEKDAYS[today.weekday]) ||\n\t\t\t\t(obj.$recurring.FREQ === \"YEARLY\" &&\n\t\t\t\t\tobj.$recurring.BYMONTH == today.month + 1 &&\n\t\t\t\t\tobj.$recurring.BYMONTHDAY == today.day))\n\t\t) {\n\t\t\tobj.rec_option = _(obj.$recurring.FREQ.toLowerCase());\n\t\t} else {\n\t\t\tobj.rec_option = _(\"custom\");\n\t\t}\n\t}\n\n\t/**\n\t * Returns date-dependent options for recurring pattern select list\n\t * @param {Date} start - the start date of an event\n\t */\n\tResetRecurringOptions(start) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn [\n\t\t\t{\n\t\t\t\tid: \"weekly\",\n\t\t\t\tvalue: `${_(\"weekly, every\")} ${\n\t\t\t\t\twebix.i18n.calendar.dayFull[start.weekday]\n\t\t\t\t}`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"monthly\",\n\t\t\t\tvalue: `${_(\"monthly, every\")} ${start.weekNum} ${_(\"week on\")} ${\n\t\t\t\t\twebix.i18n.calendar.dayFull[start.weekday]\n\t\t\t\t}`,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"yearly\",\n\t\t\t\tvalue: `${_(\"yearly, every\")} ${\n\t\t\t\t\twebix.i18n.calendar.monthFull[start.month]\n\t\t\t\t} ${start.day}`,\n\t\t\t},\n\t\t];\n\t}\n\n\t/**\n\t * Joins date and time into one Date object\n\t * @param {Date} date - a date without a time part\n\t * @param {Date} time - a date with a time part\n\t */\n\tJoin(date, time) {\n\t\treturn webix.Date.add(date, webix.Date.timePart(time) / 60, \"minute\", true);\n\t}\n\n\t/**\n\t * Returns an object with values for adding a new event\n\t */\n\tNewEvent() {\n\t\tconst start = this.GetStartDate();\n\t\tconst end = webix.Date.add(start, 1, \"hour\", true);\n\n\t\tconst obj = {\n\t\t\tstart_date: start,\n\t\t\tend_date: end,\n\t\t\ttext: \"\",\n\t\t};\n\t\tif (this.app.config.recurring) obj.recurring = \"\";\n\t\tif (this.app.config.calendars) {\n\t\t\tlet active = this.State.active[0];\n\t\t\tif (!active) {\n\t\t\t\tconst first = this.Calendars.getFirstId();\n\t\t\t\tconst wait = first\n\t\t\t\t\t? this.Ops.updateCalendar(first, { active: 1 })\n\t\t\t\t\t: this.Ops.addCalendar();\n\n\t\t\t\treturn wait.then(() => {\n\t\t\t\t\tobj.calendar = this.State.active[0];\n\t\t\t\t\tobj.$color = this.Calendars.getItem(obj.calendar).color;\n\t\t\t\t\treturn obj;\n\t\t\t\t});\n\t\t\t}\n\t\t\tobj.calendar = active;\n\t\t\tobj.$color = this.Calendars.getItem(obj.calendar).color;\n\t\t} else obj.$color = \"#01C2A5\"; //same for default color in datacollection\n\n\t\treturn obj;\n\t}\n\n\t/**\n\t * Returns a start date of a new object based on:\n\t * 1) the origin of the double click of the user\n\t * 2) the current date and time\n\t */\n\tGetStartDate() {\n\t\tif (this.Date) {\n\t\t\treturn webix.Date.copy(this.Date);\n\t\t} else {\n\t\t\tconst date = new Date();\n\t\t\tconst minutes = Math.ceil(date.getMinutes() / 30) * 30;\n\t\t\tconst res = webix.Date.copy(this.State.date);\n\t\t\tres.setHours(date.getHours(), minutes);\n\t\t\treturn res;\n\t\t}\n\t}\n\n\t/**\n\t * Launches saving of changes made in the form\n\t * @param {Object} change - an object with changed values\n\t * @param {any} prev - an old value\n\t */\n\tUpdateEvent(change, prev) {\n\t\t// some fields need preprocessing\n\t\tif (Object.keys(change).length)\n\t\t\tthis.PrepareChange(change, this.Form.getValues(), prev);\n\n\t\t// clear 'dirty' flag so that next change will definitely be 'dirty'\n\t\tthis.Form.setDirty();\n\n\t\tlet sid = this.Id;\n\t\tif (sid === \"0\") {\n\t\t\tthis._inProgress = this.Ops.addEvent(this.PrepareOut(change), sid);\n\t\t} else if (Object.keys(change).length) {\n\t\t\tlet mode = this.getParam(\"mode\", true);\n\t\t\tconst obj = this.Local.getItem(sid);\n\n\t\t\tif ((mode === \"this\" && !this.HasOneOccurrence(obj)) || mode === \"next\") {\n\t\t\t\t// cut out occurrence or split event sequence and save as separate events\n\t\t\t\tchange.origin_id = obj.origin_id || obj.id;\n\t\t\t\tconst newEvent = this.PrepareOut(change);\n\n\t\t\t\tlet recurring = \"\";\n\t\t\t\tif (mode === \"this\") {\n\t\t\t\t\trecurring = cutOccurrence(this.State.selected.date, obj);\n\t\t\t\t} else {\n\t\t\t\t\tlet params;\n\t\t\t\t\tif (obj.recurring) {\n\t\t\t\t\t\tparams = [this.State.selected.date, obj];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsid = obj.origin_id;\n\t\t\t\t\t\tparams = [newEvent.start_date, this.Local.getItem(sid)];\n\t\t\t\t\t}\n\t\t\t\t\trecurring = clipSequence(...params);\n\t\t\t\t}\n\n\t\t\t\tthis._inProgress = this.Ops.updateEvent(\n\t\t\t\t\tsid,\n\t\t\t\t\t{ recurring },\n\t\t\t\t\tmode,\n\t\t\t\t\twebix.Date.dayStart(newEvent.start_date)\n\t\t\t\t).then(() => {\n\t\t\t\t\tif (change.rec_option === \"none\") this.State.selected.date = null;\n\t\t\t\t\treturn this.Ops.addEvent(newEvent);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// non-recurring and recurring in mode \"all\"\n\n\t\t\t\tif (mode === \"all\") {\n\t\t\t\t\tconst recVals = this.Form.getValues().$recurring;\n\t\t\t\t\tif (recVals && webix.isUndefined(change.recurring)) {\n\t\t\t\t\t\tdelete recVals.EXDATE;\n\t\t\t\t\t\tchange.recurring = serialize(recVals); // plus all that's been updated in form silently in FillForm\n\n\t\t\t\t\t\t// [QUESTION] maybe change should become a local reactive state of form and passed to SubForm?\n\t\t\t\t\t\tthis.SetFormSilently({\n\t\t\t\t\t\t\t$recurring: recVals,\n\t\t\t\t\t\t\trecurring: change.recurring,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.SubForm.UpdateSilently({ EXDATE: null });\n\t\t\t\t\t}\n\n\t\t\t\t\tif (obj.origin_id) this.Id = this.State.selected.id = obj.origin_id;\n\t\t\t\t}\n\n\t\t\t\tthis._inProgress = this.Ops.updateEvent(this.Id, change, mode).then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tif (change.rec_option === \"none\") this.State.selected.date = null;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (this._inProgress) {\n\t\t\tthis.app.callEvent(\"backend:operation\", [this._inProgress]);\n\t\t\tthis._inProgress\n\t\t\t\t.then(id => {\n\t\t\t\t\tif (id) this.State.selected.id = this.Id = id;\n\t\t\t\t\tif (!id || change.recurring)\n\t\t\t\t\t\tthis.ChangeDate(change, this.Form.getValues(), prev);\n\n\t\t\t\t\t// continue editing in simple mode\n\t\t\t\t\tthis.setParam(\"mode\", \"\", true);\n\t\t\t\t})\n\t\t\t\t.finally(() => {\n\t\t\t\t\tthis._inProgress = null;\n\t\t\t\t});\n\t\t}\n\n\t\treturn this._inProgress || webix.promise.resolve();\n\t}\n\n\t/**\n\t * Processes changes made in the form and prepares values for saving to the server\n\t * @param {Object} change - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t * @param {any} prev - an old value from the control where a value was changed\n\t */\n\tPrepareChange(change, fvals, prev) {\n\t\tif (change.rec_option) {\n\t\t\tif (change.rec_option === \"custom\") {\n\t\t\t\tif (fvals.$recurring) {\n\t\t\t\t\tthis.SubForm.SetValues(\n\t\t\t\t\t\t{ ...fvals, ...change },\n\t\t\t\t\t\tthis.GetFromStartDate(fvals.start_date)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tchange.$recurring = this.SubForm.GetValues();\n\n\t\t\t\tif (!fvals.$recurring) {\n\t\t\t\t\tthis.SetFormSilently({ $recurring: change.$recurring });\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.GetRecurring(change.rec_option, change, fvals);\n\t\t\t}\n\n\t\t\tdelete change.rec_option;\n\t\t}\n\n\t\t// $recurring change comes from subform or from above\n\t\tif (!webix.isUndefined(change.$recurring)) {\n\t\t\tif (change.$recurring) {\n\t\t\t\tconst recurring = serialize(change.$recurring);\n\t\t\t\tconst old = this.Local.getItem(fvals.id);\n\t\t\t\tif (!old || recurring !== old.recurring) {\n\t\t\t\t\tchange.recurring = recurring;\n\n\t\t\t\t\tconst [ns, es] = datesToRec(\n\t\t\t\t\t\tfvals.start_date,\n\t\t\t\t\t\tfvals.end_date,\n\t\t\t\t\t\tchange.$recurring\n\t\t\t\t\t);\n\t\t\t\t\tif (ns && es) {\n\t\t\t\t\t\t[change.start_date, change.end_date] = [ns, es];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.SetFormSilently(change);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdelete change.$recurring;\n\t\t}\n\n\t\tif (\n\t\t\tchange.start_date ||\n\t\t\tchange.end_date ||\n\t\t\tchange.start_time ||\n\t\t\tchange.end_time\n\t\t) {\n\t\t\tthis.SumupDateTime(change, fvals);\n\t\t} else if (change.all_day == 1) {\n\t\t\tchange.start_date = fvals.start_date;\n\t\t\tchange.end_date = fvals.end_date;\n\t\t} else if (change.all_day == 0) {\n\t\t\tchange.start_date = this.Join(fvals.start_date, fvals.start_time);\n\t\t\tchange.end_date = this.Join(fvals.end_date, fvals.end_time);\n\t\t}\n\n\t\tif (change.start_date || change.end_date) {\n\t\t\tthis.CorrectDateTime(change, fvals);\n\n\t\t\tif (change.start_time) delete change.start_time;\n\t\t\tif (change.end_time) delete change.end_time;\n\n\t\t\tthis.ApplyDatechangeToRecurring(change, fvals);\n\t\t}\n\n\t\tthis.ProcessText(change, \"text\", prev);\n\t\tthis.ProcessText(change, \"details\", prev);\n\t}\n\n\t/**\n\t *\n\t * @param {Object} change - an object with changed values\n\t * @param {string} field - the name of a text field ('text', 'details')\n\t * @param {string} prev - an old value from the control where a value was changed\n\t */\n\tProcessText(change, field, prev) {\n\t\tif (change[field]) {\n\t\t\tchange[field] = webix.template.escape(change[field].trim());\n\t\t\tif (!prev) prev = this.Local.getItem(this.State.selected.id)[field];\n\t\t\tif (change[field] === prev.trim()) delete change[field];\n\t\t}\n\t}\n\n\t/**\n\t * Changes recurring pattern if start date was changed and the pattern no longer fits it\n\t * @param {Object} change - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t */\n\tApplyDatechangeToRecurring(change, fvals) {\n\t\tif (this.app.config.recurring && change.start_date) {\n\t\t\tconst today = this.GetFromStartDate(change.start_date);\n\t\t\t// if date was changed after subform change, ignore\n\t\t\tif (!change.recurring) {\n\t\t\t\tif (fvals.rec_option === \"custom\") {\n\t\t\t\t\tconst recurring = fvals.$recurring;\n\n\t\t\t\t\tif (recurring.BYMONTH) {\n\t\t\t\t\t\trecurring.BYMONTH = today.month + 1;\n\t\t\t\t\t}\n\t\t\t\t\tif (recurring.BYMONTHDAY) {\n\t\t\t\t\t\trecurring.BYMONTHDAY = today.day;\n\t\t\t\t\t}\n\t\t\t\t\tif (recurring.BYSETPOS) {\n\t\t\t\t\t\trecurring.BYSETPOS = today.weekNum;\n\t\t\t\t\t}\n\t\t\t\t\tif (recurring.BYDAY) {\n\t\t\t\t\t\trecurring.BYDAY = recToDate(change.start_date, fvals.$recurring);\n\t\t\t\t\t}\n\t\t\t\t\tif (recurring.UNTIL && recurring.UNTIL < change.start_date) {\n\t\t\t\t\t\tconst oldStart = this.Local.getItem(this.State.selected.id)\n\t\t\t\t\t\t\t.start_date;\n\t\t\t\t\t\tconst length = (fvals.$recurring.UNTIL - oldStart) / 1000 / 60; // minutes\n\t\t\t\t\t\trecurring.UNTIL = webix.Date.add(\n\t\t\t\t\t\t\tchange.start_date,\n\t\t\t\t\t\t\tlength,\n\t\t\t\t\t\t\t\"minute\",\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tchange.recurring = serialize(recurring);\n\n\t\t\t\t\tthis.SubForm.SetValues({ ...fvals, ...change }, today);\n\t\t\t\t} else {\n\t\t\t\t\tthis.GetRecurring(fvals.rec_option, change, fvals);\n\t\t\t\t\tdelete change.$recurring;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.RecurringOptions.getList().parse(this.ResetRecurringOptions(today));\n\t\t\tthis.RecurringOptions.refresh();\n\t\t}\n\t}\n\n\t/**\n\t * Switches Scheduler to another date if the event after change is no longer visible\n\t * @param {Object} dirty - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t * @param {any} prev - an old value from the control where a value was changed\n\t */\n\tChangeDate(dirty, fvals, prev) {\n\t\t// start date of non-repeating event changed or repeating event became non-repeating\n\t\tif ((dirty.start_date && !fvals.$recurring) || dirty.recurring === \"\") {\n\t\t\tthis.UpdateStateDate(\n\t\t\t\twebix.Date.datePart(dirty.start_date || fvals.start_date, true)\n\t\t\t);\n\t\t} else if (dirty.start_date || dirty.recurring) {\n\t\t\t/* start date of repeating event or recurring pattern of a repeating event changed */\n\n\t\t\t// no need to change date if day was changed in BYDAY\n\t\t\t// and current day was not removed or if current occurrence is 1st in sequence\n\t\t\tif (\n\t\t\t\tdirty.recurring &&\n\t\t\t\t(((fvals.$recurring.FREQ === \"WEEKLY\" ||\n\t\t\t\t\tfvals.$recurring.FREQ === \"DAILY\") &&\n\t\t\t\t\t(!fvals.$recurring.INTERVAL || fvals.$recurring.INTERVAL == 1)) ||\n\t\t\t\t\t(this.Date &&\n\t\t\t\t\t\twebix.Date.equal(\n\t\t\t\t\t\t\tthis.Date,\n\t\t\t\t\t\t\tthis.Join(fvals.start_date, fvals.start_time)\n\t\t\t\t\t\t)))\n\t\t\t) {\n\t\t\t\tconst wday = (this.Date || fvals.start_date).getDay();\n\t\t\t\tif (\n\t\t\t\t\t!fvals.$recurring.BYDAY ||\n\t\t\t\t\tfvals.$recurring.BYDAY.split(\",\").includes(WEEKDAYS[wday])\n\t\t\t\t) {\n\t\t\t\t\tif (prev === \"none\") {\n\t\t\t\t\t\tthis.State.selected.date =\n\t\t\t\t\t\t\tthis.Join(fvals.start_date, fvals.start_time).valueOf() +\n\t\t\t\t\t\t\t\"_\" +\n\t\t\t\t\t\t\tthis.State.selected.id;\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst consts = {};\n\t\t\tfillWdays(fvals.$recurring, consts);\n\n\t\t\tlet date = webix.Date.copy(\n\t\t\t\tdirty.start_date || this.Join(fvals.start_date, fvals.start_time)\n\t\t\t);\n\t\t\tlet { end } = this.GetModeBounds();\n\t\t\twhile (date >= end) {\n\t\t\t\tend = webix.Date.add(end, 1, this.State.mode, true);\n\t\t\t}\n\n\t\t\tlet start;\n\t\t\tconst sdate = new Date(this.State.selected.date.split(\"_\")[0] * 1);\n\t\t\tif (fvals.$recurring.UNTIL && fvals.$recurring.UNTIL < end) {\n\t\t\t\tend = fvals.$recurring.UNTIL;\n\t\t\t}\n\t\t\twhile (date < end) {\n\t\t\t\tstart = webix.Date.copy(date);\n\t\t\t\tif (webix.Date.equal(start, sdate)) break;\n\t\t\t\tdate = next(date, fvals.$recurring, consts);\n\t\t\t}\n\n\t\t\tthis.State.selected.date = start.valueOf() + \"_\" + this.State.selected.id;\n\n\t\t\tthis.UpdateStateDate(start);\n\t\t}\n\t}\n\n\t/**\n\t * Updates state.date according to state.mode\n\t * @param {Date} date - new state.date\n\t */\n\tUpdateStateDate(date) {\n\t\tconst state = this.State;\n\t\tif (state.mode === \"day\") {\n\t\t\tconst sdate = webix.Date.datePart(state.date, true);\n\t\t\tif (!webix.Date.equal(date, sdate)) {\n\t\t\t\tstate.date = webix.Date.dayStart(date);\n\t\t\t}\n\t\t} else if (state.mode === \"week\" || state.mode === \"month\") {\n\t\t\tconst { start, end } = this.GetModeBounds();\n\t\t\tif (date < start || date >= end) {\n\t\t\t\tstate.date = webix.Date.dayStart(date);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Returns start and end dates of a currently displayed period\n\t */\n\tGetModeBounds() {\n\t\tconst state = this.State;\n\t\tconst start = webix.Date[state.mode + \"Start\"](state.date);\n\t\tconst end = webix.Date.add(start, 1, state.mode, true);\n\t\treturn { start, end };\n\t}\n\n\t/**\n\t * Assigns recurring pattern according to a preset\n\t * @param {string} r the ID of a recurring pattern option\n\t * @param {Object} change - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t */\n\tGetRecurring(r, change, fvals) {\n\t\tconst weekday = WEEKDAYS[fvals.start_date.getDay()];\n\t\tconst day = fvals.start_date.getDate();\n\n\t\tlet rObj = null;\n\t\tswitch (r) {\n\t\t\tcase \"daily\":\n\t\t\t\trObj = { FREQ: \"DAILY\", INTERVAL: 1 };\n\t\t\t\tbreak;\n\t\t\tcase \"weekly\":\n\t\t\t\trObj = {\n\t\t\t\t\tFREQ: \"WEEKLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYDAY: weekday,\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase \"work\":\n\t\t\t\trObj = {\n\t\t\t\t\tFREQ: \"WEEKLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYDAY: \"MO,TU,WE,TH,FR\",\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase \"monthly\":\n\t\t\t\trObj = {\n\t\t\t\t\tFREQ: \"MONTHLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYSETPOS: Math.floor(day / 7) + (day % 7 ? 1 : 0),\n\t\t\t\t\tBYDAY: weekday,\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t\tcase \"yearly\":\n\t\t\t\trObj = {\n\t\t\t\t\tFREQ: \"YEARLY\",\n\t\t\t\t\tINTERVAL: 1,\n\t\t\t\t\tBYMONTH: fvals.start_date.getMonth() + 1,\n\t\t\t\t\tBYMONTHDAY: day,\n\t\t\t\t};\n\t\t\t\tbreak;\n\t\t}\n\n\t\tif (r === \"work\" && change.start_date) {\n\t\t\tconst BYDAY = recToDate(change.start_date, rObj);\n\t\t\tif (rObj.BYDAY !== BYDAY) {\n\t\t\t\trObj.BYDAY = BYDAY;\n\t\t\t\tr = \"custom\";\n\t\t\t}\n\t\t}\n\n\t\tconst recurring = rObj ? serialize(rObj) : \"\";\n\t\tconst old = this.Local.getItem(fvals.id);\n\t\tif (!old || recurring !== old.recurring) {\n\t\t\tchange.$recurring = rObj;\n\t\t\tchange.recurring = recurring;\n\t\t\tthis.SetFormSilently({\n\t\t\t\t$recurring: change.$recurring,\n\t\t\t\trecurring,\n\t\t\t\trec_option: r,\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Unites changed and unchanged fields into 1 object for saving newly added events\n\t * @param {Object} change - an object with changed values\n\t */\n\tPrepareOut(change) {\n\t\tlet obj = this.Form.getValues();\n\n\t\tif (!obj.all_day) {\n\t\t\tobj.start_date = this.Join(obj.start_date, obj.start_time);\n\t\t\tobj.end_date = this.Join(obj.end_date, obj.end_time);\n\t\t}\n\n\t\tobj = webix.extend(obj, change || {}, true);\n\n\t\tif (!(change && change.recurring) && obj.$recurring) {\n\t\t\tobj.$recurring.EXDATE = [];\n\t\t\tobj.recurring = serialize(obj.$recurring);\n\t\t}\n\n\t\tconst res = {\n\t\t\torigin_id: obj.origin_id || 0,\n\t\t\ttext: webix.template.escape(obj.text),\n\t\t\tstart_date: obj.start_date,\n\t\t\tend_date: obj.end_date,\n\t\t\tall_day: obj.all_day,\n\t\t\tcalendar: obj.calendar,\n\t\t\tcolor: obj.color,\n\t\t\tdetails: webix.template.escape(obj.details),\n\t\t\trecurring: obj.recurring,\n\t\t};\n\n\t\treturn res;\n\t}\n\n\t/**\n\t * Applies change in one of the date-time fields to all of them\n\t * @param {Object} change - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t */\n\tSumupDateTime(change, fvals) {\n\t\tconst type = change.start_date || change.start_time ? \"start\" : \"end\";\n\t\tconst dateField = type + \"_date\";\n\t\tconst timeField = type + \"_time\";\n\n\t\tchange[dateField] = this.Join(\n\t\t\tchange[dateField] || fvals[dateField],\n\t\t\tchange[timeField] || fvals[timeField]\n\t\t);\n\t}\n\n\t/**\n\t * Corrects the unchanged field if start > end or end < start\n\t * @param {Object} change - an object with changed values\n\t * @param {Object} fvals - an object with all current form values\n\t */\n\tCorrectDateTime(change, fvals) {\n\t\tconst old = this.Local.getItem(this.State.selected.id);\n\t\tconst ev_length = (old.end_date - old.start_date) / 1000 / 60; // minutes\n\n\t\tconst type = change.start_date ? \"start\" : \"end\";\n\t\tconst opposite = type === \"start\" ? \"end\" : \"start\";\n\n\t\tif (\n\t\t\t(change.start_date >= old.end_date && !fvals.all_day) ||\n\t\t\tchange.start_date > old.end_date ||\n\t\t\t(old.start_date >= change.end_date && !fvals.all_day) ||\n\t\t\told.start_date > change.end_date\n\t\t) {\n\t\t\tchange[opposite + \"_date\"] = webix.Date.add(\n\t\t\t\tchange[type + \"_date\"],\n\t\t\t\t(type === \"start\" ? 1 : -1) * (ev_length || 60),\n\t\t\t\t\"minute\",\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\t// apply also to form\n\t\t\tthis.SetFormSilently({\n\t\t\t\tstart_date: webix.Date.datePart(change.start_date, true),\n\t\t\t\tend_date: webix.Date.datePart(change.end_date, true),\n\t\t\t\tstart_time: change.start_time || webix.Date.copy(change.start_date),\n\t\t\t\tend_time: change.end_time || webix.Date.copy(change.end_date),\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Applies changes in values made by code to form\n\t * @param {Object} change - an object with changed values\n\t */\n\tSetFormSilently(change) {\n\t\tthis.Form.blockEvent();\n\t\tthis.Form.setValues(change, true);\n\t\tthis.Form.unblockEvent();\n\t}\n\n\t/**\n\t * Removes a temporary local event\n\t */\n\tClearTempEvent() {\n\t\tconst sid = this.Id;\n\t\tif (sid === \"0\" && this.Local.exists(sid)) {\n\t\t\tthis.Local.remove(sid);\n\t\t}\n\t}\n\n\t/**\n\t * Closes the form and either the whole right panel with it or returns to Info\n\t * @param {boolean} close - if true, the right panel is closed\n\t */\n\tBack(close) {\n\t\tthis.Form.clear();\n\n\t\tif (close || this.State.selected.id === \"0\") {\n\t\t\tthis.State.selected = null;\n\t\t} else {\n\t\t\tconst path = this.Compact ? \"event.formpopup/\" : \"../\";\n\t\t\tthis.show(path + \"event.info\", { target: \"edit\" });\n\t\t}\n\t}\n\n\t/**\n\t * Closes the right panel\n\t */\n\tClose() {\n\t\tif (this._inProgress) {\n\t\t\tthis._inProgress.then(() => {\n\t\t\t\tthis.Back(true);\n\t\t\t});\n\t\t} else {\n\t\t\tconst dirty =\n\t\t\t\tthis.Form.isDirty() || (this.Subform && this.SubForm.IsDirty());\n\t\t\tif (this.Compact && dirty) {\n\t\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\t\twebix\n\t\t\t\t\t.confirm({\n\t\t\t\t\t\ttext: _(\"Save changes?\"),\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => this.Done(true))\n\t\t\t\t\t.catch(() => this.Back(true));\n\t\t\t} else this.Back(true);\n\t\t}\n\t}\n\n\t/**\n\t * Closes the form\n\t * @param {boolean} close\n\t */\n\tDone(close) {\n\t\tif (this._inProgress) {\n\t\t\tthis._inProgress.then(() => {\n\t\t\t\tthis.Back();\n\t\t\t});\n\t\t} else if (this.State.selected.id === \"0\" || this.Compact) {\n\t\t\tlet change = {};\n\t\t\tif (this.Compact) {\n\t\t\t\tchange = this.Form.getDirtyValues();\n\t\t\t\tif (this.SubForm.IsDirty()) {\n\t\t\t\t\tchange.$recurring = this.SubForm.GetValues();\n\t\t\t\t\tdelete change.rec_option;\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.UpdateEvent(change).then(() => this.Back(close));\n\t\t} else {\n\t\t\tthis.Back();\n\t\t}\n\t}\n\n\t/**\n\t * Waits until some asynchronous operation finishes (if there's any) and then executes 'handler'\n\t * @param {function} handler - the code that will be executed\n\t */\n\tWait(handler) {\n\t\tif (this._inProgress) {\n\t\t\tthis._inProgress.then(handler);\n\t\t} else {\n\t\t\thandler.call();\n\t\t}\n\t}\n\n\t// compact\n\n\t/**\n\t * Shows a subform with controls for editing recurring pattern in a window\n\t */\n\tShowSubForm() {\n\t\tthis.SubForm.Show();\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst subform = this.SubForm.getRoot();\n\n\t\tconst aSkin = webix.skin.$active;\n\t\twebix.fullscreen.set(subform, {\n\t\t\thead: {\n\t\t\t\tview: \"toolbar\",\n\t\t\t\tpadding: {\n\t\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\t\tright: 14,\n\t\t\t\t},\n\t\t\t\telements: [\n\t\t\t\t\t{ view: \"icon\", icon: \"shi-back\", click: () => this.HideSubPop() },\n\t\t\t\t\t{ view: \"label\", label: _(\"Change recurring pattern\") },\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\tvalue: _(\"Done\"),\n\t\t\t\t\t\twidth: 130,\n\t\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\t\tclick: () => this.HideSubPop(),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t});\n\n\t\tconst win = subform.getTopParentView();\n\t\twin.define({ css: \"webix_scheduler_subform_popup\" });\n\t}\n\n\t/**\n\t * Hides the window with the subform\n\t */\n\tHideSubPop() {\n\t\tthis.SubForm.Hide();\n\t\twebix.fullscreen.exit();\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class FormPopup extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"window\",\n\t\t\tfullscreen: true,\n\t\t\thead: false,\n\t\t\tbody: { $subview: true },\n\t\t};\n\t}\n}\n","/* eslint-disable indent */\nimport { JetView } from \"webix-jet\";\nimport { FREQUENCE, WEEKDAYS, separateSequence } from \"../../helpers/recurring\";\n\nimport EventActionMenu from \"./actionmenu\";\n\nexport default class EventView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst bar = {\n\t\t\tview: \"toolbar\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: 14,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => this.Back(),\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\twidth: 130,\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tlocalId: \"edit\",\n\t\t\t\t\tlabel: _(\"Edit\"),\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tclick: function() {\n\t\t\t\t\t\tthis.$scope.StartAction(\"Edit\", this.$view);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst info = {\n\t\t\tlocalId: \"text\",\n\t\t\tview: \"template\",\n\t\t\tcss: \"webix_scheduler_info\",\n\t\t\ttemplate: obj => (obj.start_date ? this.InfoTemplate(obj) : \"\"),\n\t\t\tborderless: true,\n\t\t};\n\n\t\tconst deleteButton = {\n\t\t\tview: \"button\",\n\t\t\tlocalId: \"remove\",\n\t\t\tlabel: _(\"Delete event\"),\n\t\t\tcss: \"webix_danger webix_scheduler_danger\",\n\t\t\talign: \"center\",\n\t\t\tinputWidth: 330,\n\t\t\tclick: function() {\n\t\t\t\tthis.$scope.StartAction(\"Delete\", this.$view);\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tview: \"proxy\", // for borders\n\t\t\tbody: {\n\t\t\t\tmargin: 0,\n\t\t\t\trows: [\n\t\t\t\t\tbar,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: \"form\",\n\t\t\t\t\t\tpadding: { right: 14 + 2 },\n\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\trows: [info, deleteButton],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\n\t\tthis.on(this.State.$changes, \"readonly\", v => {\n\t\t\tconst action = v ? \"hide\" : \"show\";\n\t\t\tthis.$$(\"edit\")[action]();\n\t\t\tthis.$$(\"remove\")[action]();\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"selected\", v => {\n\t\t\tif (v) {\n\t\t\t\tthis.EventObj = this.app\n\t\t\t\t\t.getService(\"local\")\n\t\t\t\t\t.events(true)\n\t\t\t\t\t.getItem(v.id);\n\t\t\t\tthis.$$(\"text\").setValues(this.EventObj);\n\t\t\t}\n\t\t});\n\n\t\tthis.Menu = this.ui(EventActionMenu);\n\t}\n\n\tStartAction(mode, node) {\n\t\tif (\n\t\t\tthis.app.config.recurring &&\n\t\t\t(typeof this.State.selected.date === \"string\" || this.EventObj.origin_id)\n\t\t) {\n\t\t\tthis._waitMenu = webix.promise.defer();\n\t\t\tthis._waitMenu\n\t\t\t\t.then(o =>\n\t\t\t\t\tmode === \"Delete\" ? this.DeleteEvent(o) : this.EditEvent(o)\n\t\t\t\t)\n\t\t\t\t.finally(() => (this._waitMenu = null));\n\t\t\tthis.Menu.Show(node, this._waitMenu);\n\t\t} else {\n\t\t\tif (mode === \"Delete\") this.DeleteEvent();\n\t\t\telse this.EditEvent();\n\t\t}\n\t}\n\n\tEditEvent(o) {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst path = compact ? \"event.formpopup/\" : \"../\";\n\t\tthis.show(path + \"event.form\", { target: \"edit\", params: { mode: o } });\n\t}\n\n\tDeleteEvent(mode) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\twebix\n\t\t\t.confirm({\n\t\t\t\ttitle: _(\"Delete event\"),\n\t\t\t\ttext: _(\"The event will be deleted permanently, are you sure?\"),\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tconst obj = this.EventObj;\n\t\t\t\tlet sdate = \"\";\n\t\t\t\tif (mode && mode !== \"all\") {\n\t\t\t\t\tif (this.State.selected) sdate = this.State.selected.date;\n\t\t\t\t\telse if (obj.$id) sdate = obj.id;\n\t\t\t\t}\n\t\t\t\tthis.app\n\t\t\t\t\t.getService(\"operations\")\n\t\t\t\t\t.removeEvent(mode, this.EventObj, sdate);\n\t\t\t\tthis.Back();\n\t\t\t});\n\t}\n\n\tBack() {\n\t\tthis.State.selected = null;\n\t}\n\n\tInfoTemplate(obj) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (this.app.config.recurring && this.State.selected.date) {\n\t\t\tobj = { ...obj, ...separateSequence(obj, this.State.selected.date) };\n\t\t}\n\t\tconst [start, end] = [obj.start_date, obj.end_date];\n\n\t\tconst oneday = webix.Date.equal(\n\t\t\twebix.Date.datePart(start, true),\n\t\t\twebix.Date.datePart(end, true)\n\t\t);\n\n\t\tconst allday =\n\t\t\twebix.Date.equal(webix.Date.datePart(start, true), start) &&\n\t\t\twebix.Date.equal(webix.Date.datePart(end, true), end) &&\n\t\t\tobj.all_day;\n\n\t\tconst time = webix.i18n.timeFormatStr;\n\t\tconst date = webix.i18n.longDateFormatStr;\n\n\t\tconst title = `<div class=\"webix_scheduler_event_title\">${obj.text ||\n\t\t\t_(\"(No title)\")}</div>`;\n\n\t\tconst startDate = date(start);\n\t\tconst endDate = date(end);\n\t\tconst startTime = `${time(start)}`;\n\t\tconst endTime = `${time(end)}`;\n\n\t\tlet fromTo = \"\";\n\t\tif (oneday) {\n\t\t\tfromTo = `<div class=\"webix_scheduler_event_text\">${startDate}</div><div class=\"webix_scheduler_event_text\">${_(\n\t\t\t\t\"from\"\n\t\t\t)} ${startTime} ${_(\"to\")} ${endTime}</div>`;\n\t\t} else {\n\t\t\tfromTo = `<div class=\"webix_scheduler_event_text\">${_(\"from\")} ${\n\t\t\t\t!allday ? startTime : \"\"\n\t\t\t} ${startDate}</div><div class=\"webix_scheduler_event_text\">${_(\"to\")} ${\n\t\t\t\t!allday ? endTime : \"\"\n\t\t\t} ${endDate}</div>`;\n\t\t}\n\n\t\tlet recurring = \"\";\n\t\tif (obj.recurring) {\n\t\t\tconst interval =\n\t\t\t\tobj.$recurring.INTERVAL && obj.$recurring.INTERVAL > 1\n\t\t\t\t\t? obj.$recurring.INTERVAL\n\t\t\t\t\t: \"\";\n\t\t\tconst pattern =\n\t\t\t\t(obj.$recurring.BYDAY\n\t\t\t\t\t? ` ${_(\"on\")} ${obj.$recurring.BYDAY.split(\",\")\n\t\t\t\t\t\t\t.map(d => webix.i18n.calendar.dayFull[WEEKDAYS.indexOf(d)])\n\t\t\t\t\t\t\t.join(\", \")}`\n\t\t\t\t\t: \"\") +\n\t\t\t\t(obj.$recurring.BYMONTHDAY ? ` ${_(\"on\")} ` : \"\") +\n\t\t\t\t(obj.$recurring.BYMONTH\n\t\t\t\t\t? ` ${webix.i18n.calendar.monthFull[obj.$recurring.BYMONTH - 1]}`\n\t\t\t\t\t: \"\") +\n\t\t\t\t(obj.$recurring.BYMONTHDAY ? ` ${obj.$recurring.BYMONTHDAY}` : \"\");\n\n\t\t\trecurring = `${_(\"Repeats each\")} ${interval} ${_(\n\t\t\t\tFREQUENCE[obj.$recurring.FREQ] + (interval ? \"s\" : \"\")\n\t\t\t)} ${pattern}${\n\t\t\t\tobj.$recurring.COUNT\n\t\t\t\t\t? `, ${obj.$recurring.COUNT} ${_(\"times\")}`\n\t\t\t\t\t: obj.$recurring.UNTIL\n\t\t\t\t\t? ` ${_(\"till\")} ${date(obj.$recurring.UNTIL)}`\n\t\t\t\t\t: \"\"\n\t\t\t}`;\n\t\t}\n\n\t\tlet details = \"\";\n\t\tif (obj.details)\n\t\t\tdetails = `<div class=\"webix_scheduler_event_details_title\">${_(\n\t\t\t\t\"Notes\"\n\t\t\t)}</div>\n\t\t\t\t<div class=\"webix_scheduler_event_text\">${obj.details.replace(\n\t\t\t\t\t/(?:\\r\\n|\\r|\\n)/g,\n\t\t\t\t\t\"<br>\"\n\t\t\t\t)}</div>`;\n\n\t\treturn `${title}\n\t\t\t<div class='webix_scheduler_event_from_to'>${fromTo}</div>\n\t\t\t<div class='webix_scheduler_event_recurring_pattern'>${recurring}</div>${details}`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class EventActionPopup extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst buttons = {\n\t\t\tmargin: webix.skin.$active.layoutMargin.form,\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tvalue: _(\"Cancel\"),\n\t\t\t\t\thotkey: \"esc\",\n\t\t\t\t\tclick: () => this.Cancel(),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\tvalue: _(\"Apply\"),\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\thotkey: \"enter\",\n\t\t\t\t\tclick: () => this.Done(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn {\n\t\t\tview: \"window\",\n\t\t\tmodal: true,\n\t\t\thead: _(\"Edit recurring event\"),\n\t\t\tposition: \"center\",\n\t\t\tautoheight: true,\n\t\t\tcss: \"webix_scheduler_action_popup\",\n\t\t\tbody: {\n\t\t\t\ttype: \"form\",\n\t\t\t\tpadding: { top: 0 },\n\t\t\t\twidth: 340,\n\t\t\t\trows: [\n\t\t\t\t\t{\n\t\t\t\t\t\tview: \"radio\",\n\t\t\t\t\t\tlocalId: \"option\",\n\t\t\t\t\t\tvertical: true,\n\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t{ id: \"this\", value: _(\"This event\") },\n\t\t\t\t\t\t\t{ id: \"next\", value: _(\"This event and the following\") },\n\t\t\t\t\t\t\t{ id: \"all\", value: _(\"All events\") },\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tbuttons,\n\t\t\t\t],\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonHide: () => (this.Result = null),\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.Root = view;\n\t}\n\n\tShow(promise) {\n\t\tthis.Result = promise;\n\t\tthis.$$(\"option\").setValue(\"this\");\n\t\tthis.Root.show();\n\t}\n\n\tDone() {\n\t\tconst id = this.$$(\"option\").getValue();\n\t\tif (this.Result) this.Result.resolve(id);\n\t\tthis.Root.hide();\n\t}\n\n\tCancel() {\n\t\tif (this.Result) this.Result.reject();\n\t\tthis.Root.hide();\n\t}\n}\n","webix.protoUI(\n\t{\n\t\tname: \"r-layout\",\n\t\tsizeTrigger(width, handler, value) {\n\t\t\tthis._compactValue = value;\n\t\t\tthis._compactWidth = width;\n\t\t\tthis._compactHandler = handler;\n\n\t\t\tthis._checkTrigger(this.$view.width, value);\n\t\t},\n\t\t_checkTrigger(x, value) {\n\t\t\tif (this._compactWidth) {\n\t\t\t\tif (\n\t\t\t\t\t(x <= this._compactWidth && !value) ||\n\t\t\t\t\t(x > this._compactWidth && value)\n\t\t\t\t) {\n\t\t\t\t\tthis._compactWidth = null;\n\t\t\t\t\tthis._compactHandler(!value);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t$setSize(x, y) {\n\t\t\tif (this._checkTrigger(x, this._compactValue))\n\t\t\t\treturn webix.ui.layout.prototype.$setSize.call(this, x, y);\n\t\t},\n\t},\n\twebix.ui.layout\n);\n","import { JetView } from \"webix-jet\";\nimport topbar from \"views/bars\";\nimport add from \"views/bars/add\";\nimport side from \"./side\";\n\nimport EventActionPopup from \"./modes/common/actionpopup\";\n\nimport \"../helpers/responsive\";\n\nexport default class MainView extends JetView {\n\tconfig() {\n\t\tthis.fCompact = this.getParam(\"forceCompact\");\n\t\tif (!webix.isUndefined(this.fCompact))\n\t\t\tthis.setParam(\"compact\", this.fCompact);\n\t\tthis.Compact = this.getParam(\"compact\");\n\t\tthis.Calendars = !this.Compact && this.app.config.calendars;\n\n\t\tconst rows = [\n\t\t\ttopbar,\n\t\t\t{\n\t\t\t\tview: webix.isUndefined(this.fCompact) ? \"r-layout\" : \"layout\",\n\t\t\t\tlocalId: \"main\",\n\t\t\t\tcols: [{ $subview: true }],\n\t\t\t},\n\t\t];\n\n\t\tif (this.Compact) {\n\t\t\trows.push({\n\t\t\t\t$subview: true,\n\t\t\t\tname: \"edit\",\n\t\t\t\tpopup: true,\n\t\t\t});\n\t\t} else {\n\t\t\trows[1].cols.push({\n\t\t\t\tview: \"proxy\",\n\t\t\t\twidth: 400,\n\t\t\t\tlocalId: \"edit\",\n\t\t\t\tcss: \"webix_shadow_medium\",\n\t\t\t\tborderless: true,\n\t\t\t\thidden: true,\n\t\t\t\tbody: { $subview: true, name: \"edit\" },\n\t\t\t});\n\t\t}\n\n\t\tif (this.Calendars)\n\t\t\trows[1].cols.unshift({\n\t\t\t\tview: \"proxy\",\n\t\t\t\tlocalId: \"side\",\n\t\t\t\tborderless: true,\n\t\t\t\tbody: side,\n\t\t\t\thidden: true,\n\t\t\t});\n\n\t\tconst config = {\n\t\t\tcss: \"webix_scheduler\",\n\t\t\tview: \"abslayout\",\n\t\t\tcells: [\n\t\t\t\t{\n\t\t\t\t\trelative: true,\n\t\t\t\t\tmargin: 0,\n\t\t\t\t\trows: rows,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tcss: \"webix_scheduler_absbutton\",\n\t\t\t\t\tbody: add,\n\t\t\t\t\tlocalId: \"add\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\tright: 20,\n\t\t\t\t\tbottom: 20,\n\t\t\t\t\thidden: !this.Compact,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn config;\n\t}\n\n\tinit(view) {\n\t\tif (!this.fCompact)\n\t\t\tthis.$$(\"main\").sizeTrigger(\n\t\t\t\tthis.app.config.compactWidth,\n\t\t\t\tmode => this.SetCompactMode(mode),\n\t\t\t\t!!this.Compact\n\t\t\t);\n\n\t\twebix.extend(view, webix.ProgressBar);\n\t\tthis.on(this.app, \"backend:operation\", res => {\n\t\t\tview.showProgress({ type: \"top\", delay: 2000 });\n\t\t\tres.finally(() => {\n\t\t\t\tview.hideProgress();\n\t\t\t});\n\t\t});\n\n\t\tif (this.Calendars) this.$$(\"side\").show();\n\n\t\tconst state = this.app.getState();\n\t\tthis.on(state.$changes, \"mode\", value => {\n\t\t\tthis.show(`./modes.${value}`);\n\t\t});\n\t\tthis.on(state.$changes, \"readonly\", value => {\n\t\t\tthis.ToggleAdd(value);\n\t\t});\n\n\t\tthis.on(state.$changes, \"selected\", (v, o) => this.ToggleEvent(v, o));\n\t\tthis.on(this.app, \"show:panel\", () => this.ToggleSidePanel());\n\n\t\tthis.app._dndActionPopup = this.ui(EventActionPopup);\n\t}\n\n\tToggleEvent(ev, old) {\n\t\tif (ev) {\n\t\t\tthis.ShowEvent(ev, old);\n\t\t} else if (old) {\n\t\t\tthis.HideEvent();\n\t\t}\n\t}\n\n\tShowEvent(ev, old) {\n\t\tconst sameEvent = old && old.id == ev.id;\n\t\tconst edit = this.getSubView(\"edit\");\n\t\tconst path =\n\t\t\tedit && sameEvent\n\t\t\t\t? edit.getUrl()[0].page\n\t\t\t\t: `event.${ev.id === \"0\" ? \"form\" : \"info\"}`;\n\n\t\tif (this.Compact) {\n\t\t\tthis.show(`event.formpopup/${path}`, {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t} else {\n\t\t\tthis.ToggleSidePanel(\"hide\");\n\t\t\tthis.$$(\"edit\").show();\n\t\t\tthis.show(path, {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t}\n\t}\n\n\tHideEvent() {\n\t\t// we need to destroy the view inside first\n\t\tthis.show(\"_blank\", { target: \"edit\" });\n\n\t\tif (!this.Compact) {\n\t\t\tthis.$$(\"edit\").hide();\n\t\t\tthis.ToggleSidePanel(\"show\");\n\t\t}\n\t}\n\n\tSetCompactMode(mode) {\n\t\t//let it render, then recreate\n\t\twebix.delay(() => {\n\t\t\tthis.setParam(\"compact\", mode);\n\t\t\tif (!mode) webix.fullscreen.exit();\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\tToggleSidePanel(state) {\n\t\tconst side = this.$$(\"side\");\n\t\tif (side) {\n\t\t\tif (state !== \"show\" && side.isVisible()) {\n\t\t\t\tthis._sidePanel = state === \"hide\";\n\t\t\t\tside.hide();\n\t\t\t} else if (!state || (this._sidePanel && state !== \"hide\")) {\n\t\t\t\tside.show();\n\t\t\t\tthis._sidePanel = false;\n\t\t\t}\n\t\t}\n\t}\n\n\tToggleAdd(value) {\n\t\tconst add = this.$$(\"add\");\n\t\tif (value) add.hide();\n\t\telse if (this.Compact) add.show();\n\t}\n}\n","export function marker(obj) {\n\treturn `<div class=\"webix_event_marker\"><div class=\"webix_event_marker_inner\" style=\"background-color:${obj.color ||\n\t\tobj.$color};\"></div></div>`;\n}\n\nexport function events(_) {\n\treturn function(obj, common) {\n\t\treturn `<div class=\"webix_event_overall\"><div class=\"webix_event_time\">${common.timeStart(\n\t\t\tobj\n\t\t)}</div>${marker(obj, common)}<div class=\"webix_event_text\">${obj.text ||\n\t\t\t_(\"(No title)\")}</div></div>`;\n\t};\n}\n\nexport function dayEventColor(obj) {\n\treturn `border-color:${obj.$color}; background-color:${obj.color ||\n\t\tobj.$color}; color:${obj.$textColor};`;\n}\n\nexport function timeStart(start, end) {\n\treturn `<div class=\"start\">${webix.i18n.timeFormatStr(\n\t\tstart\n\t)}</div><div class=\"end\">${webix.i18n.timeFormatStr(end)}</div>`;\n}\n\nfunction fill(obj, common, size) {\n\tconst v = common.master;\n\treturn (\n\t\tv[\"$\" + size] -\n\t\t(v.config[size == \"width\" ? \"xCount\" : \"yCount\"] - 1) * common[size]\n\t);\n}\n\nexport function templateStart(obj, common, marks) {\n\tlet { width, height } = common;\n\tif (obj.right) width = fill(obj, common, \"width\");\n\tif (obj.bottom) height = fill(obj, common, \"height\");\n\treturn (\n\t\t\"<div \" +\n\t\t/*@attr*/ \"webix_l_id\" +\n\t\t`=\"${obj.id}\" class=\"${common.classname(obj, common, marks)}\" ${common.aria(\n\t\t\tobj,\n\t\t\tcommon,\n\t\t\tmarks\n\t\t)} style=\"width:${width}px; height:${height}px; float:left; overflow:hidden;\">`\n\t);\n}\n","export function shrinkTo(start, end) {\n\treturn ev => {\n\t\tconst before = ev.start_date <= start;\n\t\tconst after = ev.end_date >= end;\n\n\t\tif (before || after) {\n\t\t\tconst t = webix.copy(ev);\n\t\t\tif (before) t.start_date = start;\n\t\t\tif (after) t.end_date = end;\n\t\t\treturn t;\n\t\t}\n\n\t\treturn ev;\n\t};\n}\n\nexport function isToday(date) {\n\treturn webix.Date.equal(\n\t\twebix.Date.datePart(date),\n\t\twebix.Date.datePart(new Date())\n\t);\n}\n\nexport function isMultiDay(ev) {\n\treturn (\n\t\tev.all_day ||\n\t\t(ev.start_date.getDate() != ev.end_date.getDate() &&\n\t\t\tev.end_date - ev.start_date >= 1000 * 60 * 60 * 24 * 1)\n\t);\n}\n\nexport function daysBetweenInclusive(start, end) {\n\tconst millisecondsPerDay = 24 * 60 * 60 * 1000;\n\treturn Math.round(\n\t\t(webix.Date.dayStart(end) - webix.Date.dayStart(start)) / millisecondsPerDay\n\t);\n}\n","import { JetView } from \"webix-jet\";\nimport { events, timeStart } from \"helpers/templates\";\nimport { isMultiDay } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class UnitListView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"unitlist\",\n\t\t\tlocalId: \"list\",\n\t\t\tuniteBy: () => \"custom\",\n\t\t\ttype: {\n\t\t\t\ttemplate: events(_),\n\t\t\t\ttemplateHeader: obj => this.TemplateHeader(obj),\n\t\t\t\ttimeStart: obj => this.TimeStart(obj),\n\t\t\t\theight: 50,\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonUnits: () => this.SetUnits(),\n\t\t\t\tonItemClick: (id, node) => this.ShowEvent(id, node),\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.List = this.$$(\"list\");\n\t\twebix.extend(this.List, webix.OverlayBox);\n\t}\n\n\tShowEvent(id, node) {\n\t\tconst obj = this.List.getItem(id);\n\t\tconst sel = getParams(obj);\n\t\tsel.node = node;\n\t\tthis.State.selected = sel;\n\t}\n\n\tToggleOverlay() {\n\t\tif (!this.List.count()) {\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.List.showOverlay(_(\"No Events\"));\n\t\t} else {\n\t\t\tthis.List.hideOverlay();\n\t\t}\n\t}\n\n\tSetUnits() {\n\t\tlet units = this.List.units;\n\t\tconst data = this.data.all;\n\n\t\t// ignore clearAll\n\t\tif (Object.keys(units).length) {\n\t\t\tthis.List.units = {};\n\t\t\tlet start = this.data.start;\n\t\t\tconst end = this.data.end;\n\n\t\t\twhile (start < end) {\n\t\t\t\tconst next = webix.Date.add(start, 1, \"day\", true);\n\n\t\t\t\tlet result = data\n\t\t\t\t\t.filter(\n\t\t\t\t\t\td =>\n\t\t\t\t\t\t\td.start_date < next &&\n\t\t\t\t\t\t\t(d.end_date > start || (d.end_date >= start && d.all_day))\n\t\t\t\t\t)\n\t\t\t\t\t.map(ev => ev.id);\n\t\t\t\tif (result.length) {\n\t\t\t\t\tthis.List.units[start.valueOf()] = result;\n\t\t\t\t}\n\n\t\t\t\tstart = webix.Date.add(start, 1, \"day\", true);\n\t\t\t}\n\t\t}\n\t}\n\n\tTimeStart(ev) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (isMultiDay(ev)) return _(\"All Day\");\n\t\telse return timeStart(ev.start_date, ev.end_date);\n\t}\n}\n","import UnitListView from \"../common/unitlist\";\nimport { shrinkTo, isToday } from \"helpers/dates\";\n\nexport default class AgendaView extends UnitListView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst ui = super.config();\n\t\tui.css = \"webix_scheduler_agenda\";\n\n\t\twebix.extend(\n\t\t\tui.type,\n\t\t\t{\n\t\t\t\theight: \"auto\",\n\t\t\t\theaderHeight: 50,\n\t\t\t\tclassname: obj => this.TemplateCss(obj),\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\twebix.extend(\n\t\t\tui.on,\n\t\t\t{\n\t\t\t\tonItemRender: obj => {\n\t\t\t\t\tif (obj.$unit) this.CurrentUnit = obj.$unit;\n\t\t\t\t},\n\t\t\t\tonItemClick: (id, e, node) => {\n\t\t\t\t\tnode = node.firstChild;\n\t\t\t\t\tthis.ShowEvent(id, node);\n\t\t\t\t\tif (!compact) this.SelectEvent(node);\n\t\t\t\t},\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tsuper.init();\n\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tconst events = this.Data.events(true);\n\n\t\tthis.on(this.State.$changes, \"date\", () => this.RefreshData());\n\t\tthis.on(this.State.$changes, \"active\", () => this.RefreshData());\n\t\tthis.on(this.State.$changes, \"selected\", v => {\n\t\t\tif (!v) this.SelectEvent(); //remove selection\n\t\t});\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData());\n\n\t\t// updates made in full mode by form\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData()\n\t\t);\n\t}\n\n\tRefreshData() {\n\t\tlet start = webix.Date.monthStart(this.State.date);\n\t\tlet end = webix.Date.add(start, 1, \"month\", true);\n\n\t\tthis.Data.getEvents(start, end).then(data => {\n\t\t\tthis.data = { all: data, start: start, end: end };\n\t\t\tif (this.app) {\n\t\t\t\tthis.List.clearAll();\n\t\t\t\tthis.List.parse(data.map(shrinkTo(start, end)));\n\t\t\t\tthis.ToggleOverlay();\n\t\t\t}\n\t\t});\n\t}\n\n\tSelectEvent(node) {\n\t\tif (node == this._selected) return;\n\n\t\tconst name = \"webix_agenda_selected\";\n\t\tif (this._selected) webix.html.removeCss(this._selected, name);\n\t\tif (node) webix.html.addCss(node, name);\n\n\t\tthis._selected = node;\n\t}\n\n\tTemplateHeader(datestring) {\n\t\tconst date = new Date(datestring * 1);\n\t\tconst today = isToday(date);\n\n\t\tconst fstring = `%F <span class='webix_scheduler_monthday${\n\t\t\ttoday ? \" webix_scheduler_today\" : \"\"\n\t\t}'>%j</span><br><span class='webix_scheduler_dayofweek'>%l</span>`;\n\n\t\treturn webix.Date.dateToStr(fstring)(date);\n\t}\n\n\tTemplateCss(obj) {\n\t\tconst ids = this.List.getUnitList(this.CurrentUnit);\n\n\t\tlet css = \"webix_list_item\";\n\t\tif (obj.id == ids[ids.length - 1]) css += \" webix_event_last\";\n\t\tif (obj.id == ids[0]) css += \" webix_event_first\";\n\n\t\treturn css;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class HourscaleView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tborderless: true,\n\t\t\tlocalId: \"scale\",\n\t\t\tcss: \"webix_scheduler_scale\",\n\t\t\ttype: {\n\t\t\t\theight: 42,\n\t\t\t\theightSize: (obj, common) => {\n\t\t\t\t\tconst ind = this.List.getIndexById(obj.id);\n\t\t\t\t\treturn common.height - (ind === 0 ? 17 : 0) + \"px\";\n\t\t\t\t},\n\t\t\t},\n\t\t\tscroll: false,\n\t\t\tautoheight: true,\n\t\t\twidth: 51,\n\t\t\ttemplate: obj => this.HourScaleItem(obj),\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.List = this.$$(\"scale\");\n\t\tthis.ParseHours();\n\t}\n\n\tParseHours() {\n\t\tconst data = [];\n\t\tfor (let h = 0; h < 24; h++) {\n\t\t\tdata.push({ id: h + \"\" });\n\t\t}\n\t\tthis.List.parse(data);\n\t}\n\n\tHourScaleItem(obj) {\n\t\tif (this.List.getIndexById(obj.id) === 0) return \"\";\n\t\telse return `${(obj.id < 10 ? \"0\" : \"\") + obj.id}:00`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class MultiMoreView extends JetView {\n\tconfig() {\n\t\tconst more = {\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"more\",\n\t\t\twidth: 50,\n\t\t\tcss: \"webix_scheduler_multi_space\",\n\t\t\ttooltip: () => \"\",\n\t\t\tonClick: {\n\t\t\t\t\"wxi-angle-down\": () => this.ExpandData(),\n\t\t\t\t\"wxi-angle-up\": () => this.WrapData(),\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tcols: [more, {}],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.List = this.$$(\"multiDayList\");\n\t\tthis.MoreIcon = this.$$(\"more\");\n\n\t\tthis._expandState = \"down\";\n\t\tthis.maxVisibleLines = 3;\n\t}\n\n\tSetMoreIcon(mode) {\n\t\tif (!mode) {\n\t\t\tthis.MoreIcon.setHTML(\"\");\n\t\t} else {\n\t\t\tconst tooltip = mode === \"up\" ? \"Collapse\" : \"Expand\";\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.MoreIcon.setHTML(\n\t\t\t\t`<div class=\"webix_scheduler_more_icon webix_icon wxi-angle-${mode}\" webix_tooltip=\"${_(\n\t\t\t\t\t`${tooltip} all-day events`\n\t\t\t\t)}\"><div>`\n\t\t\t);\n\t\t}\n\t}\n\n\t// height change and delay for animation\n\tAnimate(mode, height, handler) {\n\t\tthis.List.$view.style.transition = \"height 150ms\";\n\t\tif (height) this.List.$view.style.height = `${height}px`;\n\n\t\tsetTimeout(() => {\n\t\t\tif (handler) handler();\n\n\t\t\tthis.List.$view.style.transition = \"\";\n\t\t\tthis._inAnimation = false;\n\t\t\tthis.SetMoreIcon(mode);\n\t\t}, 150);\n\t}\n}\n","function _select(id, functor) {\n\tconst trgs = this.LocateSelected(id);\n\tif (trgs) {\n\t\tfor (let i = 0; i < trgs.length; i++)\n\t\t\tfunctor(trgs[i], \"webix_scheduler_event_selected\");\n\t}\n}\n\nfunction Select(id) {\n\treturn _select.call(this, id, webix.html.addCss);\n}\n\nfunction Unselect(id) {\n\treturn _select.call(this, id, webix.html.removeCss);\n}\n\nfunction HandleSelection() {\n\tconst mode = this._SelectionMode;\n\tthis.State = this.app.getState();\n\n\tthis.on(this.State.$changes, \"selected\", (v, o) => {\n\t\tif (o) this.Unselect(o.date && typeof o.date === \"string\" ? o.date : o.id);\n\n\t\tif (v) {\n\t\t\tconst id = v.id === \"0\" || !v.date ? v.id : v.date;\n\t\t\tsetTimeout(\n\t\t\t\t() => this.Select(id),\n\t\t\t\tmode !== \"multi\" && id === \"0\" ? 150 : 0\n\t\t\t);\n\t\t}\n\t});\n\n\t// reapply selection to a saved new event\n\tif (mode !== \"multi\") {\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(events.data, \"onStoreUpdated\", (id, o, operation) => {\n\t\t\tif (\n\t\t\t\toperation === \"add\" &&\n\t\t\t\tid != \"0\" &&\n\t\t\t\tthis.State.selected &&\n\t\t\t\tthis.State.selected.id === \"0\"\n\t\t\t) {\n\t\t\t\tthis.State.selected.id = id;\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction locate(inner) {\n\treturn function LocateSelected(id) {\n\t\tif (this._DataObj) {\n\t\t\treturn Array.prototype.map.call(\n\t\t\t\tthis._DataObj.querySelectorAll(\n\t\t\t\t\t`[webix_${inner ? \"l\" : \"e\"}_id=\"${id}\"]`\n\t\t\t\t),\n\t\t\t\tel => (inner ? el.firstElementChild : el)\n\t\t\t);\n\t\t}\n\t\treturn null;\n\t};\n}\n\nexport default function SelectionMixin(child, mode, inner) {\n\tchild._SelectionMode = mode;\n\n\tchild.Select = Select;\n\tchild.Unselect = Unselect;\n\tchild.HandleSelection = HandleSelection;\n\tchild.LocateSelected = locate(inner);\n\n\tchild.HandleSelection();\n}\n","export const Resizer = {\n\t$dragIn: function() {\n\t\tconst ctx = this.getContext();\n\n\t\tif (ctx.from.mode !== this.mode) return false;\n\t\treturn true;\n\t},\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\n\t\tconst box = webix.html.offset(ctx.target);\n\t\tlet y = pos.y - box.y;\n\n\t\tif (y < ctx.y_diff) y = ctx.y_diff;\n\t\telse if (y > box.height) y = box.height;\n\n\t\tconst height = y - ctx.y_diff;\n\t\tResizer.updateNodeHeight.call(this, height);\n\n\t\tif (ctx.duration !== height) {\n\t\t\tctx.duration = height;\n\t\t\tthis.updateText(ctx);\n\t\t}\n\n\t\tpos.x = ctx.x_diff;\n\t\tpos.y = ctx.y_diff;\n\t},\n\tupdateNodeHeight: function(height) {\n\t\tconst node = webix.DragControl.getNode();\n\t\tnode.style.height = Math.max(this.master.minEventHeight, height) + \"px\";\n\t},\n\tgetActualDate: function(master, any) {\n\t\tconst ctx = this.getContext();\n\n\t\tconst date = webix.Date.copy(ctx.event.start_date);\n\t\tconst minutes =\n\t\t\t(Math.round((ctx.duration * 60) / master.List.type.height / 5) || 1) * 5;\n\n\t\twebix.Date.add(date, minutes, \"minute\");\n\n\t\tif (!any && webix.Date.equal(date, ctx.event.end_date)) return null;\n\n\t\treturn {\n\t\t\tstart_date: webix.Date.copy(ctx.event.start_date),\n\t\t\tend_date: date,\n\t\t};\n\t},\n};\n","import { Resizer } from \"./resizer\";\nimport {\n\tgetParams,\n\tcutOccurrence,\n\tclipSequence,\n\tmovePattern,\n} from \"./recurring\";\nimport { serialize } from \"./ical\";\n\nexport function initDnD(view, mode, dragOnly) {\n\tconst ctrl = webix.copy(modes[mode]);\n\n\tctrl.view = view;\n\tctrl.master = this;\n\tctrl.State = this.app.getState();\n\tctrl.Local = this.app.getService(\"local\").events(true);\n\tctrl.Ops = this.app.getService(\"operations\");\n\n\twebix.DragControl.addDrag(view.$view, ctrl);\n\tif (!dragOnly) webix.DragControl.addDrop(view.$view, ctrl, true);\n}\n\nexport function locateEvent(e, view) {\n\tlet target = e.target;\n\tlet id, node;\n\n\tdo {\n\t\tid = target.getAttribute(\"webix_e_id\");\n\t\tnode = id ? target : null;\n\t\ttarget = target.parentNode;\n\t} while (!id && target !== view);\n\n\treturn { id, node };\n}\n\nfunction updateSelection(prev, date) {\n\tif (this.State.selected) {\n\t\tconst selection = getParams(prev);\n\t\tif (prev.$recurring)\n\t\t\tselection.date = date.start_date.valueOf() + \"_\" + prev.$id;\n\n\t\tthis.State.selected = selection;\n\t}\n}\n\nfunction editRecurring(mode, obj, change) {\n\tlet id = obj.$id || obj.id;\n\n\t/* special cases */\n\t// if 'this' edited as 'this'\n\tif (mode === \"this\" && this.master.HasOneOccurrence(obj)) {\n\t\treturn this.Ops.updateEvent(id, change);\n\t}\n\t// if 1st occurrence in whole sequence or in 'next'\n\tmode = this.master.ChangeMode(\n\t\tmode,\n\t\tobj,\n\t\tthis.Local.getItem(obj.recurring ? id : obj.origin_id).start_date,\n\t\tobj.recurring ? obj.id : obj.start_date\n\t);\n\tif (!mode) {\n\t\t// if date was changed\n\t\tobj.$recurring = movePattern(obj.$recurring, change, obj);\n\t\tchange.recurring = serialize(obj.$recurring);\n\t\treturn this.Ops.updateEvent(id, change);\n\t}\n\n\tif (mode === \"this\" || mode === \"next\") {\n\t\t// cut out occurrence or split event sequence and save as separate events\n\t\tlet recurring = \"\";\n\t\tlet parent;\n\t\tif (mode === \"this\") {\n\t\t\trecurring = cutOccurrence(obj.id, obj);\n\t\t} else {\n\t\t\tif (obj.recurring) {\n\t\t\t\trecurring = clipSequence(obj.id, webix.copy(obj));\n\t\t\t} else {\n\t\t\t\t// if 'this' edited as 'next'\n\t\t\t\tid = obj.origin_id;\n\t\t\t\tparent = webix.copy(this.Local.getItem(id));\n\t\t\t\trecurring = clipSequence(change.start_date, webix.copy(parent), true);\n\t\t\t}\n\t\t}\n\n\t\tconst newEvent = newSubEvent.call(this, id, mode, obj, change, parent);\n\n\t\treturn this.Ops.updateEvent(\n\t\t\tid,\n\t\t\t{ recurring },\n\t\t\tmode,\n\t\t\twebix.Date.dayStart(change.start_date)\n\t\t).then(() => {\n\t\t\treturn this.Ops.addEvent(newEvent);\n\t\t});\n\t}\n\n\tif (mode === \"all\") {\n\t\t// [FIXME] maybe need to store total UNTIL/COUNT on backend (mostly for dynamic loading)\n\t\tconst oid = obj.origin_id || obj.$id;\n\t\tconst all = webix.copy(this.Local.getItem(oid));\n\t\tlet rec = all.$recurring;\n\t\tif (rec.COUNT || rec.UNTIL) {\n\t\t\trec = this.master.CorrectCountUntil(\n\t\t\t\tall,\n\t\t\t\tmode,\n\t\t\t\tchange.start_date,\n\t\t\t\tthis.Local\n\t\t\t);\n\t\t}\n\t\trec = movePattern(rec, change, all); // if date was changed\n\t\tif (rec.EXDATE) delete rec.EXDATE;\n\n\t\tchange.recurring = serialize(rec);\n\n\t\treturn this.Ops.updateEvent(obj.origin_id || id, change, mode);\n\t}\n}\n\nfunction newSubEvent(id, mode, obj, change, parent) {\n\tconst newEvent = {\n\t\ttext: obj.text,\n\t\tdetails: obj.details,\n\t\tcolor: obj.color,\n\t\tall_day: obj.all_day,\n\t\tstart_date: change.start_date,\n\t\tend_date: change.end_date,\n\t\torigin_id: obj.origin_id || id,\n\t};\n\n\tif (mode === \"next\") {\n\t\t// [FIXME] maybe need to store total UNTIL/COUNT on backend (mostly for dynamic loading)\n\t\tlet rec = webix.copy(obj.recurring ? obj.$recurring : parent.$recurring);\n\t\tif (rec.COUNT || rec.UNTIL) {\n\t\t\trec = this.master.CorrectCountUntil(\n\t\t\t\t{ ...this.Local.getItem(id), $recurring: rec },\n\t\t\t\tmode,\n\t\t\t\tnewEvent.start_date,\n\t\t\t\tthis.Local\n\t\t\t);\n\t\t}\n\t\trec = movePattern(rec, newEvent, obj); // if date was changed\n\t\trec.EXDATE = [];\n\n\t\tnewEvent.recurring = serialize(rec);\n\t}\n\n\tif (this.master.app.config.calendars) {\n\t\tnewEvent.calendar = obj.calendar;\n\t}\n\n\treturn newEvent;\n}\n\nconst common = {\n\tmode: \"common\",\n\t$dragDestroy: function(target, node) {\n\t\tconst ctx = this.getContext();\n\n\t\tif (!ctx.$waitUpdate) ctx.node.style.visibility = \"visible\";\n\t\tif (ctx.$resize) webix.html.removeCss(document.body, \"webix_active_resize\");\n\n\t\twebix.html.remove(node);\n\n\t\treturn false;\n\t},\n\tgetContext: function() {\n\t\treturn webix.DragControl.getContext();\n\t},\n\tsetDragOffset: function(node, target, e) {\n\t\tconst ctx = this.getContext();\n\t\tconst pos = webix.html.pos(e);\n\t\tconst offset = webix.html.offset(node);\n\n\t\tctx.width = offset.width;\n\t\tctx.height = offset.height;\n\t\tctx.x_offset = offset.x - pos.x;\n\t\tctx.y_offset = offset.y - pos.y;\n\t},\n\tupdateEvent: function(event, data, ctx) {\n\t\tif (ctx.event.$id || ctx.event.origin_id) {\n\t\t\tthis.master._waitPopup = webix.promise.defer();\n\t\t\tthis.master._waitPopup\n\t\t\t\t.then(o => {\n\t\t\t\t\tconst res = editRecurring.call(this, o, ctx.event, data);\n\n\t\t\t\t\tres.then(() => updateSelection.call(this, event, data));\n\t\t\t\t\tthis.master.app.callEvent(\"backend:operation\", [res]);\n\t\t\t\t})\n\t\t\t\t.finally(() => (this.master._waitPopup = null));\n\t\t\tthis.master.app._dndActionPopup.Show(this.master._waitPopup);\n\t\t} else {\n\t\t\tconst res = this.Ops.updateEvent(event.$id || event.id, data);\n\t\t\tthis.finishOperation(res, event, data, ctx);\n\t\t}\n\t},\n\taddEvent: function(event, data, ctx) {\n\t\tconst newEvent = {\n\t\t\ttext: event.text,\n\t\t\tstart_date: data.start_date,\n\t\t\tend_date: data.end_date,\n\t\t\tdetails: \"\",\n\t\t};\n\t\tif (this.master.app.config.calendars) {\n\t\t\tnewEvent.calendar = event.calendar;\n\t\t}\n\n\t\tconst res = this.Ops.addEvent(newEvent);\n\t\tthis.finishOperation(res, newEvent, data, ctx);\n\t},\n\n\tfinishOperation(res, event, data, ctx) {\n\t\tres.then(id =>\n\t\t\tupdateSelection.call(this, id ? { ...event, id } : event, data)\n\t\t);\n\t\tthis.master.app.callEvent(\"backend:operation\", [res]);\n\t\tctx[\"$waitUpdate\"] = true;\n\t},\n};\n\nconst day = webix.extend(\n\t{\n\t\tmode: \"day\",\n\t\t$dragIn: function(source, target) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$resize) return Resizer.$dragIn.apply(this, arguments);\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tif (ctx.target != target) {\n\t\t\t\tconst node = webix.DragControl.getNode();\n\n\t\t\t\ttarget.firstChild.appendChild(node);\n\t\t\t\tctx.target = target;\n\t\t\t}\n\t\t\treturn true;\n\t\t},\n\t\t$drop: function() {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tconst date = this.getActualDate(this.master);\n\t\t\tif (date) {\n\t\t\t\tif (ctx.event.id == \"0\") {\n\t\t\t\t\tthis.addEvent(ctx.event, date, ctx);\n\t\t\t\t} else this.updateEvent(ctx.event, date, ctx);\n\t\t\t}\n\t\t},\n\t\t$dragPos: function(pos) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$resize) return Resizer.$dragPos.apply(this, arguments);\n\n\t\t\tconst box = webix.html.offset(ctx.target);\n\t\t\tconst max = box.height - ctx.height;\n\n\t\t\tpos.x = ctx.x_diff;\n\t\t\tpos.y += ctx.y_offset - box.y;\n\n\t\t\tif (pos.y < 0) pos.y = 0;\n\t\t\telse if (pos.y > max) pos.y = max;\n\n\t\t\twebix.extend(ctx, pos, true);\n\n\t\t\tif (ctx.$last_y !== pos.y) {\n\t\t\t\tthis.updateText(ctx);\n\t\t\t\tctx.$last_y = pos.y;\n\t\t\t}\n\t\t},\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst event = locateEvent(e, target);\n\t\t\tif (event.id) {\n\t\t\t\tconst ctx = this.getContext();\n\t\t\t\twebix.extend(ctx, event, true);\n\t\t\t\twebix.extend(ctx, { from: this, target }, true);\n\n\t\t\t\tctx.event = this.master.GetEvent(event.id);\n\t\t\t\tthis.setDragOffset(event.node, target, e);\n\n\t\t\t\tif (e.target.getAttribute(\"webix_resizer\")) {\n\t\t\t\t\twebix.html.addCss(document.body, \"webix_active_resize\", true);\n\t\t\t\t\tctx[\"$resize\"] = true;\n\t\t\t\t}\n\n\t\t\t\tconst html = event.node.cloneNode(true);\n\n\t\t\t\thtml.className += ` webix_drag_zone webix_${\n\t\t\t\t\tctx.$resize ? \"resize\" : \"drag\"\n\t\t\t\t}_event`;\n\t\t\t\ttarget.firstChild.appendChild(html);\n\n\t\t\t\tevent.node.style.visibility = \"hidden\";\n\t\t\t\treturn html;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tgetActualDate: function(master, any) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$resize) return Resizer.getActualDate.apply(this, arguments);\n\n\t\t\tconst date = webix.Date.copy(master.Day);\n\t\t\t//scale start correction\n\t\t\tconst delta = master.List.getFirstId() * master.List.type.height;\n\t\t\tconst minutes =\n\t\t\t\tMath.round(((ctx.y + delta) * 60) / master.List.type.height / 5) * 5;\n\n\t\t\twebix.Date.add(date, minutes, \"minute\");\n\n\t\t\tif (!any && webix.Date.equal(date, ctx.event.start_date)) return null;\n\n\t\t\tconst duration = ctx.event.end_date - ctx.event.start_date;\n\t\t\treturn {\n\t\t\t\tstart_date: date,\n\t\t\t\tend_date: new Date(date.valueOf() + duration),\n\t\t\t};\n\t\t},\n\t\tupdateText: function(ctx) {\n\t\t\tconst node = webix.DragControl.getNode();\n\t\t\tconst ctrl = webix.DragControl.getMaster(ctx.target);\n\n\t\t\tconst event = this.getActualDate(ctrl.master, true);\n\t\t\tevent.text = ctx.event.text;\n\n\t\t\tnode.innerHTML = \"\";\n\t\t\tnode.innerHTML = ctrl.master.EventTemplate(event);\n\t\t},\n\t\tsetDragOffset: function(node, target, e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst pos = webix.html.pos(e);\n\t\t\tconst noff = webix.html.offset(node);\n\n\t\t\tctx.height = noff.height;\n\t\t\tctx.x_offset = noff.x - pos.x;\n\t\t\tctx.y_offset = noff.y - pos.y;\n\n\t\t\tconst toff = webix.html.offset(target);\n\t\t\tctx.x_diff = noff.x - toff.x - 1; // 1px border\n\t\t\tctx.y_diff = noff.y - toff.y;\n\t\t},\n\t},\n\tcommon\n);\n\nconst month = webix.extend(\n\t{\n\t\tmode: \"month\",\n\t\t$dragIn: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tctx.offset = ctx.offset || webix.html.offset(target);\n\n\t\t\tconst index = this.locate(e);\n\t\t\tconst id = this.view.getIdByIndex(index);\n\t\t\tconst node = this.view.getItemNode(id);\n\n\t\t\tif (ctx.$marked !== id) this.markDropArea(id);\n\n\t\t\treturn node;\n\t\t},\n\t\t$dragOut: function(source, target, drop) {\n\t\t\tif (target !== drop) this.markDropArea();\n\t\t\treturn null;\n\t\t},\n\t\t$drop: function(source, target, e) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.from.mode !== this.mode) return false;\n\n\t\t\tthis.markDropArea();\n\n\t\t\tconst date = this.getActualDate(e);\n\t\t\tif (date) {\n\t\t\t\tif (ctx.event.id == \"0\") {\n\t\t\t\t\tthis.addEvent(ctx.event, date, ctx);\n\t\t\t\t} else this.updateEvent(ctx.event, date, ctx);\n\t\t\t}\n\t\t},\n\t\t$dragPos: function(pos) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tpos.x += ctx.x_offset;\n\t\t\tpos.y += ctx.y_offset;\n\t\t},\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst event = locateEvent(e, target);\n\t\t\tif (event.id && event.id != \"$wsh_multi_more\") {\n\t\t\t\tconst ctx = this.getContext();\n\t\t\t\twebix.extend(ctx, event, true);\n\t\t\t\twebix.extend(\n\t\t\t\t\tctx,\n\t\t\t\t\t{ from: this, offset: webix.html.offset(target) },\n\t\t\t\t\ttrue\n\t\t\t\t);\n\n\t\t\t\tctx.event = this.master.Events.getItem(event.id);\n\t\t\t\tctx.start = this.view.getIdByIndex(this.locate(e));\n\n\t\t\t\tthis.setDragOffset(event.node, target, e);\n\n\t\t\t\tconst drag_container = document.createElement(\"DIV\");\n\t\t\t\tconst html = event.node.cloneNode(true);\n\n\t\t\t\thtml.style.position = \"static\";\n\t\t\t\tdrag_container.appendChild(html);\n\t\t\t\tdrag_container.className =\n\t\t\t\t\ttarget.className + \" webix_drag_zone webix_drag_event\";\n\t\t\t\tdocument.body.appendChild(drag_container);\n\n\t\t\t\tevent.node.style.visibility = \"hidden\";\n\n\t\t\t\twebix.callEvent(\"onClick\", [e]);\n\t\t\t\treturn drag_container;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\tgetActualDate: function(e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst diff = this.locate(e) - this.view.getIndexById(ctx.start);\n\n\t\t\tif (!diff) return null;\n\n\t\t\treturn {\n\t\t\t\tstart_date: webix.Date.add(ctx.event.start_date, diff, \"day\", true),\n\t\t\t\tend_date: webix.Date.add(ctx.event.end_date, diff, \"day\", true),\n\t\t\t};\n\t\t},\n\t\tmarkDropArea: function(id) {\n\t\t\tconst ctx = this.getContext();\n\n\t\t\tif (ctx.$marked && ctx.$marked != id) {\n\t\t\t\tthis.view.removeCss(ctx.$marked, \"webix_drag_over\");\n\t\t\t\tctx.$marked = null;\n\n\t\t\t\tif (ctx.$extra) {\n\t\t\t\t\twebix.html.removeCss(this.view.$view, ctx.$extra);\n\t\t\t\t\tctx.$extra = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!ctx.$marked && id) {\n\t\t\t\tthis.view.addCss(id, \"webix_drag_over\");\n\t\t\t\tctx.$marked = id;\n\n\t\t\t\tlet extra;\n\t\t\t\tif (this.view.getFirstId() == id) extra = \"webix_scheduler_dnd_1\";\n\t\t\t\telse if (this.view.getLastId() == id) extra = \"webix_scheduler_dnd_n\";\n\n\t\t\t\tif (extra) {\n\t\t\t\t\twebix.html.addCss(this.view.$view, extra, true);\n\t\t\t\t\tctx.$extra = extra;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tlocate: function(e) {\n\t\t\tconst ctx = this.getContext();\n\t\t\tconst pos = webix.html.pos(e);\n\n\t\t\tpos.x -= ctx.offset.x;\n\t\t\tpos.y -= ctx.offset.y;\n\n\t\t\treturn (\n\t\t\t\tMath.min(\n\t\t\t\t\tMath.floor(pos.y / this.view.type.height),\n\t\t\t\t\tthis.view.config.yCount - 1\n\t\t\t\t) *\n\t\t\t\t\tthis.view.config.xCount +\n\t\t\t\tMath.min(\n\t\t\t\t\tMath.floor(pos.x / this.view.type.width),\n\t\t\t\t\tthis.view.config.xCount - 1\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t},\n\tcommon\n);\n\nconst multiday = webix.extend(\n\t{\n\t\tmode: \"multiday\",\n\t},\n\tmonth\n);\n\nconst more = webix.extend(\n\t{\n\t\t$dragCreate: function(target, e) {\n\t\t\tif (this.State.readonly) return false;\n\n\t\t\tconst id = this.view.locate(e);\n\t\t\tif (id) {\n\t\t\t\tconst ctx = this.getContext();\n\t\t\t\tconst node = this.view.getItemNode(id).children[0];\n\t\t\t\twebix.extend(ctx, { from: this, id }, true);\n\n\t\t\t\tctx.event = this.master.Events.getItem(id);\n\t\t\t\tctx.start = this.master.ID;\n\n\t\t\t\tthis.setDragOffset(node, target, e);\n\n\t\t\t\tconst drag_container = document.createElement(\"DIV\");\n\n\t\t\t\tdrag_container.style.width = ctx.width + \"px\";\n\t\t\t\tdrag_container.style.height = ctx.height + \"px\";\n\n\t\t\t\tdrag_container.appendChild(node.cloneNode(true));\n\t\t\t\tdrag_container.className =\n\t\t\t\t\ttarget.className + \" webix_drag_zone webix_drag_event\";\n\n\t\t\t\tdocument.body.appendChild(drag_container);\n\n\t\t\t\tthis.master.HideWindow();\n\t\t\t\treturn drag_container;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t$dragDestroy: function(target, node) {\n\t\t\twebix.html.remove(node);\n\t\t\treturn false;\n\t\t},\n\t},\n\tmonth\n);\n\nconst modes = {\n\tday,\n\tmonth,\n\tmore,\n\tmultiday,\n};\n","import HourscaleView from \"../common/hourscale\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { initDnD, locateEvent } from \"helpers/dnd\";\nimport { shrinkTo, isToday } from \"helpers/dates\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class DayEventsView extends HourscaleView {\n\tconstructor(app, name, config) {\n\t\tsuper(app, name);\n\n\t\t// when dayevents is a part of week\n\t\tif (config) {\n\t\t\tthis.WeekDayNum = config.day;\n\t\t}\n\t}\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"dayList\",\n\t\t\tcss: \"webix_scheduler_day_events\",\n\t\t\tscroll: false,\n\t\t\tautoheight: true,\n\t\t\ttemplate: \"\",\n\t\t\ttype: {\n\t\t\t\theight: 42,\n\t\t\t\tcss: \"webix_scheduler_day_scale_item\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_day_event: e => this.ShowEvent(e),\n\t\t\t},\n\t\t\tonDblClick: {\n\t\t\t\twebix_scheduler_day_scale_item: (_e, h) => this.ShowNew(h),\n\t\t\t},\n\t\t};\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tthis.List = this.$$(\"dayList\");\n\n\t\tSelectionMixin(this, \"scale\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.List.$setSize = function(x, y) {\n\t\t\tif (webix.ui.view.prototype.$setSize.call(this, x, y)) {\n\t\t\t\tthis.render();\n\t\t\t}\n\t\t};\n\n\t\tthis.minEventHeight = 62;\n\t\tthis.ParseHours();\n\n\t\tthis.on(this.State.$changes, \"readonly\", () => this.List.render());\n\n\t\tthis.List.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.List, \"day\");\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.Day = webix.Date.datePart(this.State.date, true);\n\n\t\t\tif (this.WeekDayNum > -1) {\n\t\t\t\tconst weekStart = this.data.start;\n\t\t\t\tthis.Day = webix.Date.add(weekStart, this.WeekDayNum, \"day\", true);\n\t\t\t}\n\n\t\t\tconst to = webix.Date.add(this.Day, 1, \"day\", true);\n\t\t\tthis.Events = this.FilterToday(this.Day, to);\n\n\t\t\tif (this._marker_update_interval)\n\t\t\t\tthis._marker_update_interval = clearInterval(\n\t\t\t\t\tthis._marker_update_interval\n\t\t\t\t);\n\n\t\t\tif (isToday(this.Day))\n\t\t\t\tthis._marker_update_interval = setInterval(() => {\n\t\t\t\t\tif (isToday(this.Day)) this.UpdateMarkerPosition();\n\t\t\t\t\telse {\n\t\t\t\t\t\twebix.html.remove(this._Marker);\n\t\t\t\t\t\tthis._Marker = this._marker_update_interval = clearInterval(\n\t\t\t\t\t\t\tthis._marker_update_interval\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}, 5 * 60 * 1000); // 5 minutes\n\n\t\t\tthis.List.render();\n\t\t}\n\t}\n\n\tGetEvent(id) {\n\t\tfor (let i = 0; i < this.Events.length; i++)\n\t\t\tif (this.Events[i].id == id) return this.Events[i];\n\t\treturn null;\n\t}\n\n\tFilterToday(value, to) {\n\t\tif (this.WeekDayNum > -1) {\n\t\t\treturn this.data.single.filter(ev => {\n\t\t\t\tif (ev.start_date < to && ev.end_date > value) return true;\n\t\t\t});\n\t\t}\n\t\treturn this.data.single;\n\t}\n\n\tMarkToday() {\n\t\tif (this.Day && isToday(this.Day)) {\n\t\t\tconst marker = webix.html.create(\"div\", {\n\t\t\t\tclass: \"webix_scheduler_today_marker\",\n\t\t\t});\n\t\t\tthis._Marker = this.List.$view.firstChild.appendChild(marker);\n\t\t\tthis.UpdateMarkerPosition();\n\t\t} else {\n\t\t\tthis._Marker = null;\n\t\t}\n\t}\n\n\tUpdateMarkerPosition() {\n\t\tif (this._Marker) {\n\t\t\tconst current = new Date();\n\t\t\tconst time = current.getHours() * 60 + current.getMinutes();\n\t\t\tthis._Marker.style.top =\n\t\t\t\tMath.round((time * this.List.type.height) / 60) + \"px\";\n\t\t}\n\t}\n\n\tRenderEvents() {\n\t\tconst evs = this.Events;\n\t\tif (evs && evs.length) {\n\t\t\tthis.PrepareEvents();\n\t\t\tconst container = webix.html.create(\"div\", {\n\t\t\t\trole: \"presentation\",\n\t\t\t});\n\t\t\tcontainer.innerHTML = evs.map(i => this.ToHTML(i)).join(\"\");\n\t\t\tthis._DataObj = this.List.$view.firstChild.appendChild(container);\n\t\t}\n\t\tthis.MarkToday();\n\t}\n\n\tPrepareEvents() {\n\t\tconst evs = this.Events;\n\t\tlet stack = [];\n\n\t\tfor (let i = 0; i < evs.length; i++) {\n\t\t\tconst ev = evs[i];\n\t\t\tev.$inner = false;\n\n\t\t\tlet orderSet = this.PruneStack(ev, stack);\n\n\t\t\tif (stack.length) {\n\t\t\t\tstack[stack.length - 1].$inner = true;\n\t\t\t}\n\n\t\t\tif (!orderSet) {\n\t\t\t\tif (stack.length) {\n\t\t\t\t\tev.$sorder = stack[stack.length - 1].$sorder + 1;\n\t\t\t\t\tev.$inner = false;\n\t\t\t\t} else {\n\t\t\t\t\tev.$sorder = 0;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// insert new event into stack\n\t\t\tstack.splice(ev.$sorder, 0, ev);\n\t\t\tif (stack.length > (stack.max_count || 0)) {\n\t\t\t\tstack.max_count = stack.length;\n\t\t\t}\n\t\t}\n\n\t\tthis.SetPosition(stack, evs);\n\t}\n\n\t// returns true if new event was marked for inserting;\n\t// false if stack is empty or there is no suitable place for new event inside\n\tPruneStack(newEvent, stack) {\n\t\t// clean events from top of stack if new event starts after they end\n\t\twhile (\n\t\t\tstack.length &&\n\t\t\tthis.GetEventEndDate(stack[stack.length - 1]) <= newEvent.start_date\n\t\t) {\n\t\t\tstack.splice(stack.length - 1, 1);\n\t\t}\n\n\t\t// clean 1 event from within remaining stack if this event ends before new event starts\n\t\tfor (let j = 0; j < stack.length; j++) {\n\t\t\tif (this.GetEventEndDate(stack[j]) <= newEvent.start_date) {\n\t\t\t\tnewEvent.$sorder = stack[j].$sorder; // mark new event for this place in stack\n\t\t\t\tstack.splice(j, 1);\n\t\t\t\tnewEvent.$inner = true;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tSetPosition(stack, evs) {\n\t\t//scale start correction\n\t\tconst delta = this.List.getFirstId() * this.List.type.height;\n\n\t\tfor (let i = 0; i < evs.length; i++) {\n\t\t\tconst ev = evs[i];\n\n\t\t\tev.$count = stack.max_count;\n\t\t\tlet temp_width = Math.floor(this.List.$width / ev.$count);\n\t\t\tev.$left = ev.$sorder * temp_width;\n\t\t\tif (!ev.$inner) temp_width = temp_width * (ev.$count - ev.$sorder);\n\t\t\tev.$width = temp_width - 8;\n\n\t\t\tconst evCorrectedCopy = shrinkTo(\n\t\t\t\tthis.Day,\n\t\t\t\twebix.Date.add(this.Day, 1, \"day\", true)\n\t\t\t)(ev);\n\t\t\tconst sm =\n\t\t\t\tevCorrectedCopy.start_date.getHours() * 60 +\n\t\t\t\tevCorrectedCopy.start_date.getMinutes();\n\t\t\tconst em =\n\t\t\t\tevCorrectedCopy.end_date.getHours() * 60 +\n\t\t\t\t\tevCorrectedCopy.end_date.getMinutes() || 24 * 60;\n\n\t\t\tev.$top = Math.round((sm * this.List.type.height) / 60) - delta;\n\t\t\tev.$height = Math.max(\n\t\t\t\tthis.minEventHeight,\n\t\t\t\t((em - sm) * this.List.type.height) / 60\n\t\t\t);\n\t\t}\n\t}\n\n\tToHTML(obj) {\n\t\tconst content = this.EventTemplate(obj);\n\t\treturn this.EventTemplateStart(obj) + content + \"</div>\";\n\t}\n\n\tGetEventEndDate(ev) {\n\t\tlet end_date = ev.end_date;\n\t\tconst duration =\n\t\t\t(((ev.end_date - ev.start_date) / 60000) * this.List.type.height) / 60;\n\n\t\tif (duration < this.minEventHeight) {\n\t\t\tend_date = webix.Date.add(\n\t\t\t\tev.start_date,\n\t\t\t\tMath.ceil((this.minEventHeight / this.List.type.height) * 60),\n\t\t\t\t\"minute\",\n\t\t\t\ttrue\n\t\t\t);\n\t\t}\n\t\treturn end_date;\n\t}\n\n\tEventTemplateStart(obj) {\n\t\tconst css = `class=\"webix_scheduler_day_event ${\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \"webix_scheduler_event_selected\"\n\t\t\t\t: \"\"\n\t\t}\"`;\n\n\t\treturn `<div webix_e_id='${obj.id}' ${css} style='left:${\n\t\t\tobj.$left\n\t\t}px; top:${obj.$top}px; width:${obj.$width}px; height:${\n\t\t\tobj.$height\n\t\t}px; ${dayEventColor(obj)}'>`;\n\t}\n\n\tEventTemplate(obj) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst resizer = this.State.readonly\n\t\t\t? \"\"\n\t\t\t: \"<div class='webix_icon webix_scheduler_resizer' webix_resizer='true'></div>\";\n\n\t\treturn `<div class=\"webix_scheduler_inner_day\"><span class=\"webix_scheduler_event_name\">${obj.text ||\n\t\t\t_(\n\t\t\t\t\"(No title)\"\n\t\t\t)}</span><div class=\"webix_scheduler_event_time\">${webix.i18n.timeFormatStr(\n\t\t\tobj.start_date\n\t\t)} - ${webix.i18n.timeFormatStr(obj.end_date)}</div></div>${resizer}`;\n\t}\n\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.List.$view);\n\t\tif (event.id && event.id != \"0\") {\n\t\t\tconst obj = this.GetEvent(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tShowNew(h) {\n\t\tconst date = webix.Date.copy(this.Day || this.State.date);\n\t\tdate.setHours(h);\n\t\tthis.State.selected = { id: \"0\", date };\n\t}\n}\n","import MultiMoreView from \"../common/multimore\";\nimport SelectionMixin from \"helpers/selection\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MultidayEventList extends MultiMoreView {\n\tconfig() {\n\t\tconst ui = super.config();\n\n\t\tui.cols[1] = {\n\t\t\tview: \"list\",\n\t\t\tlocalId: \"multiDayList\",\n\t\t\tautoheight: true,\n\t\t\tscroll: false,\n\t\t\tcss: \"webix_scheduler_multilist\",\n\t\t\ttype: {\n\t\t\t\theight: 32,\n\t\t\t\ttemplate: (obj, common) => this.EventTemplate(obj, common),\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_multiday_event: (e, id, node) =>\n\t\t\t\t\tthis.ShowEvent(id, node),\n\t\t\t},\n\t\t};\n\n\t\treturn ui;\n\t}\n\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tsuper.init();\n\n\t\tthis._DataObj = this.List.$view.firstChild;\n\t\tSelectionMixin(this, \"multi\", true);\n\n\t\tthis.MoreIcon = this.$$(\"more\");\n\t\tthis._moreBtn = {\n\t\t\tid: \"$wsh_multi_more\",\n\t\t\t$css: \"webix_scheduler_multi_more\",\n\t\t};\n\t}\n\n\turlChange() {\n\t\tconst data = this.getParam(\"data\");\n\t\tif (data) {\n\t\t\tthis.LimitData(data.multi);\n\t\t\tthis.List.clearAll();\n\t\t\tthis.List.parse(data.multi);\n\t\t}\n\t}\n\n\tEventTemplate(obj, common) {\n\t\tconst height = common.height - 4;\n\t\tconst size = `height:${height}px; line-height:${height}px; width:calc(100% - 5px);`;\n\t\tconst color = obj.id !== \"$wsh_multi_more\" ? dayEventColor(obj) : \"\";\n\t\tconst css = this.GetStyle(obj);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"${size} ${color}\">\n\t\t\t\t\t${obj.text || _(\"(No title)\")}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj) {\n\t\tconst date = this.State.date;\n\t\tconst end =\n\t\t\t!obj.all_day && !webix.Date.timePart(obj.end_date)\n\t\t\t\t? webix.Date.add(obj.end_date, -1, \"day\", true)\n\t\t\t\t: obj.end_date;\n\n\t\tlet css = \"webix_scheduler_multiday_event\";\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (obj.start_date < date) css += \" webix_scheduler_event_break_left\";\n\t\tif (end >= webix.Date.add(date, 1, \"day\", true))\n\t\t\tcss += \" webix_scheduler_event_break_right\";\n\n\t\treturn css;\n\t}\n\n\tLimitData(data) {\n\t\tif (data.length > this.maxVisibleLines) {\n\t\t\tconst excess = data.length - 2;\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis._moreBtn.text = `${excess} ${_(\"more\")}`;\n\n\t\t\tif (this._expandState === \"down\") {\n\t\t\t\tthis._reserve = data.splice(2, excess, this._moreBtn);\n\t\t\t} else {\n\t\t\t\tthis._reserve = data.slice(2);\n\t\t\t}\n\n\t\t\tthis.SetMoreIcon(this._expandState);\n\t\t\tthis._reserveIds = this._reserve.map(d => d.id);\n\t\t} else {\n\t\t\tthis.SetMoreIcon();\n\t\t}\n\t}\n\n\tWrapData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\t\t\tthis._expandState = \"down\";\n\n\t\t\tconst height =\n\t\t\t\tthis.List.$height -\n\t\t\t\t(this._reserveIds.length - 1) * this.List.type.height;\n\t\t\tthis.Animate(\"down\", height, () => {\n\t\t\t\tthis.List.add(this._moreBtn);\n\t\t\t\tthis.List.remove(this._reserveIds);\n\t\t\t});\n\t\t}\n\t}\n\n\tExpandData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\t\t\tthis._expandState = \"up\";\n\n\t\t\tthis.Animate(\"up\");\n\n\t\t\tthis.List.remove(\"$wsh_multi_more\");\n\t\t\tthis.List.parse(this._reserve);\n\t\t}\n\t}\n\n\t// height change and delay for animation\n\tAnimate(mode, height, handler) {\n\t\tthis.List.$view.style.transition = \"height 150ms\";\n\t\tif (height) this.List.$view.style.height = `${height}px`;\n\n\t\tsetTimeout(() => {\n\t\t\tif (handler) handler();\n\n\t\t\tthis.List.$view.style.transition = \"\";\n\t\t\tthis._inAnimation = false;\n\t\t\tthis.SetMoreIcon(mode);\n\t\t}, 150);\n\t}\n\n\tSetMoreIcon(mode) {\n\t\tif (!mode) {\n\t\t\tthis.MoreIcon.setHTML(\"\");\n\t\t} else {\n\t\t\tthis._expandState = mode;\n\n\t\t\tconst tooltip = mode === \"up\" ? \"Collapse\" : \"Expand\";\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.MoreIcon.setHTML(\n\t\t\t\t`<div class=\"webix_scheduler_more_icon webix_icon wxi-angle-${mode}\" webix_tooltip=\"${_(\n\t\t\t\t\t`${tooltip} all-day events`\n\t\t\t\t)}\"><div>`\n\t\t\t);\n\t\t}\n\t}\n\n\tShowEvent(id, node) {\n\t\tif (id === \"$wsh_multi_more\") {\n\t\t\tthis.ExpandData();\n\t\t} else {\n\t\t\tconst obj = this.List.getItem(id);\n\t\t\tconst sel = getParams(obj);\n\t\t\tsel.node = node;\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport MultidayEventList from \"./multiday\";\nimport DayEventsView from \"./events\";\nimport HourscaleView from \"../common/hourscale\";\nimport { isMultiDay } from \"helpers/dates\";\n\nexport default class DayView extends JetView {\n\tconfig() {\n\t\tconst header = {\n\t\t\tview: \"template\",\n\t\t\tlocalId: \"header\",\n\t\t\tcss: \"webix_scheduler_day_header\",\n\t\t\theight: 32,\n\t\t\ttemplate: obj => {\n\t\t\t\treturn obj.date ? webix.Date.dateToStr(\"%l\")(obj.date) : \"\";\n\t\t\t},\n\t\t};\n\n\t\tconst config = {\n\t\t\tcss: \"webix_scheduler_day\",\n\t\t\trows: [\n\t\t\t\theader,\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"multi\",\n\t\t\t\t\thidden: true,\n\t\t\t\t\tcols: [MultidayEventList],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlocalId: \"scroll\",\n\t\t\t\t\tview: \"scrollview\",\n\t\t\t\t\tcss: \"webix_scheduler_day_scroll\",\n\t\t\t\t\tbody: {\n\t\t\t\t\t\tcols: [HourscaleView, DayEventsView],\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn config;\n\t}\n\n\tinit() {\n\t\tconst state = this.app.getState();\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\n\t\tthis.on(state.$changes, \"selected\", v => v && this.ScrollScale(v));\n\t}\n\n\tRefreshData(value) {\n\t\tthis.$$(\"header\").setValues({ date: value });\n\n\t\tthis.GetDay(value).then(data => {\n\t\t\t// this.app will be null if compact trigger was called in main.js\n\t\t\tif (this.app) this.setParam(\"data\", data, true);\n\n\t\t\tif (data.multi.length) {\n\t\t\t\tthis.$$(\"multi\").show();\n\t\t\t} else this.$$(\"multi\").hide();\n\t\t});\n\t}\n\n\tGetDay(date) {\n\t\tconst end = webix.Date.add(date, 1, \"day\", true);\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(date, end)\n\t\t\t.then(evs => {\n\t\t\t\tconst multi = [],\n\t\t\t\t\tsingle = [];\n\t\t\t\tevs.forEach(ev => {\n\t\t\t\t\tif (isMultiDay(ev)) {\n\t\t\t\t\t\tmulti.push(ev);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsingle.push(ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn { multi, single };\n\t\t\t});\n\t}\n\n\tScrollScale(v) {\n\t\tif (v.id === \"0\" && !v.date) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst y = (new Date().getHours() + 2) * 40;\n\t\t\t\tthis.$$(\"scroll\").scrollTo(0, y);\n\t\t\t}, 100);\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class CalendarView extends JetView {\n\tconfig() {\n\t\tthis.Events = {};\n\n\t\treturn {\n\t\t\tview: \"calendar\",\n\t\t\tlocalId: \"calendar\",\n\t\t\tevents: (day, isOutside) => this.MarkEvent(day, isOutside),\n\t\t\ticons: false,\n\t\t\tnavigation: false,\n\t\t\tmonthHeader: false,\n\t\t\tskipEmptyWeeks: true,\n\t\t\twidth: 0,\n\t\t\theight: 410,\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.Calendar = this.getRoot();\n\t\tthis.Calendar.attachEvent(\"onDateSelect\", date => {\n\t\t\tthis.app.getState().date = webix.Date.dayStart(date);\n\t\t});\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) this.RefreshData();\n\t}\n\n\tRefreshData() {\n\t\tlet { start, weeks, data } = this.data;\n\t\tconst end = webix.Date.add(start, weeks, \"week\", true);\n\n\t\tthis.Events = {};\n\n\t\twhile (start < end) {\n\t\t\tconst next = webix.Date.add(start, 1, \"day\", true);\n\t\t\tfor (let i = 0; i < data.length; i++)\n\t\t\t\tif (\n\t\t\t\t\t(data[i].all_day\n\t\t\t\t\t\t? data[i].end_date >= start\n\t\t\t\t\t\t: data[i].end_date > start) &&\n\t\t\t\t\tdata[i].start_date < next\n\t\t\t\t)\n\t\t\t\t\tthis.Events[start.valueOf()] = true;\n\t\t\tstart = next;\n\t\t}\n\n\t\tthis.Calendar.setValue(this.app.getState().date);\n\t}\n\n\t// adds dots to days with events\n\tMarkEvent(day, isOutside) {\n\t\tlet css = \"\";\n\n\t\tif (!isOutside) css += webix.Date.isHoliday(day) || \"\";\n\t\tif (this.Events[day.valueOf()]) css += \" webix_cal_day_with_event\";\n\n\t\treturn css;\n\t}\n}\n","/* eslint-disable indent */\n\nimport { JetView } from \"webix-jet\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { daysBetweenInclusive } from \"helpers/dates\";\nimport { marker, dayEventColor } from \"helpers/templates\";\nimport { getParams } from \"helpers/recurring\";\nimport { initDnD } from \"helpers/dnd\";\n\nexport default class MoreWindowView extends JetView {\n\tconstructor(app, name, c) {\n\t\tsuper(app, name);\n\t\tthis.Events = c.events;\n\t}\n\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn {\n\t\t\tview: \"popup\",\n\t\t\twidth: 266,\n\t\t\tpadding: 8,\n\t\t\tminHeight: 70,\n\t\t\trelative: \"right\",\n\t\t\tbody: {\n\t\t\t\tview: \"list\",\n\t\t\t\tcss: \"webix_scheduler_more_list\",\n\t\t\t\tborderless: true,\n\t\t\t\tautoheight: true,\n\t\t\t\tyCount: 3,\n\t\t\t\ttooltip: {\n\t\t\t\t\ttemplate: \"\",\n\t\t\t\t},\n\t\t\t\tonClick: {\n\t\t\t\t\twebix_scheduler_month_event: (e, id) => this.ShowEvent(id),\n\t\t\t\t\twebix_scheduler_month_event_single: (e, id) => this.ShowEvent(id),\n\t\t\t\t},\n\t\t\t\ttype: {\n\t\t\t\t\theight: 56,\n\t\t\t\t\ttemplate: (o, c) => this.MoreTemplate(o, c, _),\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.Win = view;\n\n\t\tEditRecurringMixin(this);\n\n\t\tinitDnD.call(this, view.getBody(), \"more\", true);\n\t}\n\n\tMoreTemplate(obj, _c, _) {\n\t\tconst i18n = webix.i18n;\n\t\tconst single = !daysBetweenInclusive(obj.start_date, obj.end_date);\n\t\tconst style = single ? \"\" : dayEventColor(obj);\n\n\t\treturn `\n\t\t\t<div\n\t\t\t\tclass=\"webix_scheduler_month_event${single ? \"_single\" : \"\"}\"\n\t\t\t\tstyle=\"${style}\"\n\t\t\t>\n\t\t\t\t${single ? marker(obj) : \"\"}\n\t\t\t\t<div webix_tooltip=\"${obj.text}\" class=\"webix_event_text\">${obj.text ||\n\t\t\t_(\"(No title)\")}</div>\n\t\t\t\t<div class=\"webix_event_time\">\n\t\t\t\t\t${this.DayFormatStr(obj.start_date)}\n\t\t\t\t\t${i18n.timeFormatStr(obj.start_date)} -\n\t\t\t\t\t${single ? \"\" : \" \" + this.DayFormatStr(obj.end_date)}\n\t\t\t\t\t${i18n.timeFormatStr(obj.end_date)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tDayFormatStr(date) {\n\t\treturn webix.Date.dateToStr(\"%F %j\")(date);\n\t}\n\n\tShowEvent(id) {\n\t\tconst obj = this.Events.getItem(id);\n\t\tthis.app.getState().selected = getParams(obj);\n\t}\n\n\tShowWindow(id, node, data) {\n\t\tif (this.ID === id && this.Win.isVisible()) return this.Win.hide();\n\n\t\tthis.ID = id;\n\t\tdata = data.map(v => this.Events.getItem(v));\n\n\t\tconst list = this.Win.getBody();\n\t\tlist.clearAll();\n\t\tlist.parse(data);\n\n\t\tthis.Win.show(node);\n\t}\n\n\tHideWindow() {\n\t\tthis.Win.hide();\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport MoreWindowView from \"./more\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { marker, dayEventColor, templateStart } from \"helpers/templates\";\nimport { initDnD, locateEvent } from \"helpers/dnd\";\nimport { daysBetweenInclusive, isToday } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MonthEventsView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"dataview\",\n\t\t\tcss: \"webix_scheduler_calendar\",\n\t\t\tprerender: true,\n\t\t\txCount: 7,\n\t\t\tyCount: 5,\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tscroll: false,\n\t\t\ttooltip: {\n\t\t\t\ttemplate: \"\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_cal_date: (_ev, id) => this.ShowDay(id),\n\t\t\t\twebix_scheduler_month_event: ev => this.ShowEvent(ev),\n\t\t\t\twebix_scheduler_month_event_single: ev => this.ShowEvent(ev),\n\t\t\t\twebix_scheduler_more: (_ev, id) => this.ShowMore(id),\n\t\t\t},\n\t\t\tonDblClick: {\n\t\t\t\twebix_cal_day: (_e, id) => this.ShowNew(id),\n\t\t\t},\n\t\t\ttype: {\n\t\t\t\theight: \"auto\",\n\t\t\t\twidth: \"auto\",\n\t\t\t\ttemplate: (o, c) => this.CalendarTemplate(o, c),\n\t\t\t\ttemplateStart,\n\t\t\t\theaderHeight: 32,\n\t\t\t\teventHeight: 28,\n\t\t\t\tpadding: 8,\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tthis.State = this.app.getState();\n\t\tthis.Calendar = view;\n\t\tview.type.master = this.Calendar;\n\n\t\tSelectionMixin(this, \"month\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.Events = new webix.DataCollection({});\n\t\tthis.MoreWindow = this.ui(\n\t\t\tnew (this.app.dynamic(MoreWindowView))(this.app, \"\", {\n\t\t\t\tevents: this.Events,\n\t\t\t})\n\t\t);\n\n\t\tview.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.Calendar, \"month\");\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) this.RefreshData();\n\t}\n\n\tCalendarTemplate(obj) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tlet html = `<span class=\"webix_cal_date\">${obj.date.getDate()}</span>`;\n\t\tif (obj.$more && obj.$more.length) {\n\t\t\thtml += `<div class=\"webix_scheduler_more\">${obj.$more.length} ${_(\n\t\t\t\t\"more\"\n\t\t\t)}</div>`;\n\t\t}\n\t\treturn html;\n\t}\n\n\tGetDayCss(day, month) {\n\t\tlet css = \"webix_cal_day\";\n\t\tif (isToday(day)) css += \" webix_cal_today\";\n\t\tif (day.getMonth() != month) css += \" webix_cal_outside\";\n\t\telse css += \" \" + (webix.Date.isHoliday(day) || \"\");\n\t\treturn css;\n\t}\n\n\tGetMonthData() {\n\t\tconst data = [];\n\t\tconst { start, weeks } = this.data;\n\t\tconst month = webix.Date.add(start, 1, \"week\", true).getMonth();\n\n\t\tlet day = webix.Date.copy(start);\n\t\tfor (let i = 0; i < weeks * 7; i++) {\n\t\t\tconst obj = {\n\t\t\t\tdate: webix.Date.copy(day),\n\t\t\t\t$css: this.GetDayCss(day, month),\n\t\t\t};\n\n\t\t\tif ((i + 1) % 7 === 0) obj.right = true;\n\t\t\tif (i >= (weeks - 1) * 7) obj.bottom = true;\n\n\t\t\tdata.push(obj);\n\t\t\twebix.Date.add(day, 1, \"day\");\n\t\t}\n\t\treturn data;\n\t}\n\n\tRenderEvents() {\n\t\t// No Events, No Render\n\t\tif (!this.Events.count() || !this.Calendar.count()) return;\n\n\t\tconst container = webix.html.create(\"div\", {\n\t\t\trole: \"presentation\",\n\t\t\tclass: \"webix_scheduler_month_events\",\n\t\t});\n\n\t\tconst { start } = this.data;\n\t\tconst type = this.Calendar.type;\n\t\tconst maxLines = Math.floor(\n\t\t\t(type.height - type.headerHeight + type.padding - 2) /\n\t\t\t\t(type.eventHeight + type.padding)\n\t\t);\n\n\t\tlet wStart = webix.Date.copy(start);\n\t\tlet wEnd = webix.Date.add(wStart, 1, \"week\", true);\n\n\t\tlet html = \"\";\n\t\tlet cache = {};\n\t\tconst me = this.Calendar.getItem(this.Calendar.getLastId()).date;\n\t\tconst ms = this.Calendar.getItem(this.Calendar.getFirstId()).date;\n\t\tthis.Calendar.data.each(function(day, dayIndex) {\n\t\t\t// next week\n\t\t\tif (day.date >= wEnd) {\n\t\t\t\tcache = {};\n\t\t\t\twStart = wEnd;\n\t\t\t\twEnd = webix.Date.add(wStart, 1, \"week\", true);\n\t\t\t}\n\n\t\t\tconst more = [];\n\t\t\tconst dayHTML = [];\n\t\t\tthis.Events.data.each(function(ev) {\n\t\t\t\tconst id = ev.id;\n\n\t\t\t\t// will not be this week\n\t\t\t\tif (\n\t\t\t\t\tev.start_date >= wEnd ||\n\t\t\t\t\tev.end_date < wStart ||\n\t\t\t\t\t(!ev.all_day && webix.Date.equal(ev.end_date, wStart))\n\t\t\t\t)\n\t\t\t\t\treturn;\n\n\t\t\t\t// if already processed - check and skip\n\t\t\t\tif (!webix.isUndefined(cache[id])) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t(day.date <= ev.end_date && ev.all_day) ||\n\t\t\t\t\t\tday.date < ev.end_date\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (cache[id] >= maxLines) {\n\t\t\t\t\t\t\tmore.push(id);\n\t\t\t\t\t\t} else dayHTML[cache[id]] = \"\";\n\t\t\t\t\t} else delete cache[id];\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// today\n\t\t\t\tif (\n\t\t\t\t\tev.start_date < webix.Date.add(day.date, 1, \"day\", true) &&\n\t\t\t\t\tev.end_date >= day.date\n\t\t\t\t) {\n\t\t\t\t\tlet index = 0;\n\t\t\t\t\t// search for the first available index\n\t\t\t\t\twhile (!webix.isUndefined(dayHTML[index])) index++;\n\n\t\t\t\t\tcache[id] = index;\n\t\t\t\t\tif (index >= maxLines) return more.push(id);\n\n\t\t\t\t\tconst config = { ms, me };\n\t\t\t\t\tconfig.single = !daysBetweenInclusive(\n\t\t\t\t\t\tev.start_date,\n\t\t\t\t\t\tev.all_day\n\t\t\t\t\t\t\t? webix.Date.add(ev.end_date, 1, \"day\", true)\n\t\t\t\t\t\t\t: ev.end_date\n\t\t\t\t\t);\n\n\t\t\t\t\tconfig.length = 1;\n\t\t\t\t\tif (!config.single) {\n\t\t\t\t\t\tconfig.es = ev.start_date;\n\t\t\t\t\t\tconfig.ee =\n\t\t\t\t\t\t\t!ev.all_day && !webix.Date.timePart(ev.end_date)\n\t\t\t\t\t\t\t\t? webix.Date.add(ev.end_date, -1, \"day\", true)\n\t\t\t\t\t\t\t\t: ev.end_date;\n\n\t\t\t\t\t\tconfig.length += daysBetweenInclusive(\n\t\t\t\t\t\t\t(config.ls = new Date(Math.max(wStart, config.es))),\n\t\t\t\t\t\t\t(config.le = new Date(Math.min(wEnd - 1, config.ee)))\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tconfig.index = dayIndex;\n\t\t\t\t\tdayHTML[index] = this.ToHTML(ev, index, config);\n\t\t\t\t}\n\t\t\t}, this);\n\n\t\t\tconst prevLength = day.$more && day.$more.length;\n\t\t\tday.$more = more;\n\t\t\tif (prevLength != more.length) this.Calendar.render(day.id, day, \"paint\");\n\n\t\t\thtml += dayHTML.join(\"\");\n\t\t}, this);\n\n\t\tcontainer.innerHTML = html;\n\t\tthis._DataObj = this.Calendar.$view.firstChild.appendChild(container);\n\t}\n\n\tToHTML(obj, index, c) {\n\t\tconst type = this.Calendar.type;\n\t\tconst style = c.single ? \"\" : dayEventColor(obj);\n\t\tconst width = c.length * type.width - type.padding;\n\t\tconst height = type.eventHeight;\n\t\tconst pos = this.GetPosition(type, index, c.index);\n\n\t\tlet extra = \"\";\n\t\tif (c.single) {\n\t\t\textra =\n\t\t\t\tmarker(obj) +\n\t\t\t\t`<span class=\"webix_event_time\">${webix.i18n.timeFormatStr(\n\t\t\t\t\tobj.start_date\n\t\t\t\t)}</span>`;\n\t\t}\n\t\tconst css = this.GetStyle(obj, c);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\twebix_tooltip=\"${obj.text}\"\n\t\t\t\twebix_e_id=\"${obj.id}\"\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"height:${height}px;line-height:${height}px; width:${width}px; ${pos +\n\t\t\tstyle}\">\n\t\t\t\t\t${extra + (obj.text || _(\"(No title)\"))}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj, c) {\n\t\tlet css = `webix_scheduler_month_event${c.single ? \"_single\" : \"\"}`;\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (!c.single) {\n\t\t\tif (c.es < c.ms && webix.Date.equal(c.ms, webix.Date.dayStart(c.ls)))\n\t\t\t\tcss += \" webix_scheduler_event_break_left\";\n\t\t\telse if (\n\t\t\t\tc.ee >= webix.Date.add(c.me, 1, \"day\", true) &&\n\t\t\t\twebix.Date.equal(c.me, webix.Date.dayStart(c.le))\n\t\t\t)\n\t\t\t\tcss += \" webix_scheduler_event_break_right\";\n\t\t}\n\t\treturn css;\n\t}\n\n\tGetPosition(type, index, dayIndex) {\n\t\tconst row = Math.floor(dayIndex / this.Calendar.config.xCount);\n\t\tconst col = dayIndex % this.Calendar.config.xCount;\n\n\t\treturn `\n\t\t\ttop:${row * type.height +\n\t\t\t\ttype.headerHeight +\n\t\t\t\tindex * (type.eventHeight + type.padding)}px;\n\t\t\tleft:${col * type.width}px;\n\t\t`;\n\t}\n\n\tRefreshData() {\n\t\tconst { data, weeks } = this.data;\n\n\t\tthis.Events.clearAll();\n\t\tthis.Events.parse(data);\n\t\tthis.Events.sort(function(a, b) {\n\t\t\tconst start_a = webix.Date.dayStart(a.start_date);\n\t\t\tconst start_b = webix.Date.dayStart(b.start_date);\n\n\t\t\tif (webix.Date.equal(start_a, start_b)) {\n\t\t\t\tconst days_a = daysBetweenInclusive(a.start_date, a.end_date);\n\t\t\t\tconst days_b = daysBetweenInclusive(b.start_date, b.end_date);\n\t\t\t\treturn days_b - days_a || a.start_date - b.start_date;\n\t\t\t}\n\t\t\treturn start_a - start_b;\n\t\t});\n\n\t\tconst monthData = this.GetMonthData();\n\n\t\tthis.Calendar.clearAll();\n\t\tif (this.Calendar.config.yCount != weeks) {\n\t\t\tthis.Calendar.define(\"yCount\", weeks);\n\t\t\tthis.Calendar.resize();\n\t\t}\n\t\tthis.Calendar.parse(monthData);\n\t}\n\n\tShowMore(id) {\n\t\tthis.MoreWindow.ShowWindow(\n\t\t\tid,\n\t\t\tthis.Calendar.getItemNode(id),\n\t\t\tthis.Calendar.getItem(id).$more || []\n\t\t);\n\t\treturn false;\n\t}\n\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.Calendar.$view);\n\t\tif (event.id && event.id != \"0\") {\n\t\t\tconst obj = this.Events.getItem(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tShowNew(id) {\n\t\tconst date = this.Calendar.getItem(id).date;\n\t\tthis.State.selected = { id: \"0\", date };\n\t}\n\n\tShowDay(id) {\n\t\tconst state = this.app.getState();\n\n\t\tstate.$batch({\n\t\t\tdate: this.Calendar.getItem(id).date,\n\t\t\tmode: \"day\",\n\t\t});\n\n\t\treturn false;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { templateStart } from \"helpers/templates\";\n\nexport default class MonthHeaderView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\tview: \"dataview\",\n\t\t\tcss: \"webix_scheduler_calendar_header\",\n\t\t\txCount: 7,\n\t\t\tyCount: 1,\n\t\t\twidth: 0,\n\t\t\theight: 32,\n\t\t\tscroll: false,\n\t\t\ttype: {\n\t\t\t\theight: \"auto\",\n\t\t\t\twidth: \"auto\",\n\t\t\t\ttemplateStart,\n\t\t\t},\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tview.type.master = view;\n\t\tview.parse(this.GetHeaderData());\n\t}\n\n\tGetHeaderData() {\n\t\tconst data = [];\n\t\tconst k = webix.Date.startOnMonday ? 1 : 0;\n\n\t\tfor (let i = 0; i < 7; i++)\n\t\t\tdata.push({ value: webix.i18n.calendar.dayShort[(k + i) % 7] });\n\n\t\tdata[data.length - 1][\"right\"] = true;\n\t\treturn data;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { events, timeStart } from \"helpers/templates\";\nimport { shrinkTo, isMultiDay } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MonthListView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst config = {\n\t\t\tview: \"list\",\n\t\t\ttype: {\n\t\t\t\theight: 50,\n\t\t\t\ttemplate: events(_),\n\t\t\t\ttimeStart: ev => this.TimeStart(ev),\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonItemClick: id => this.ShowEvent(id),\n\t\t\t},\n\t\t};\n\n\t\treturn config;\n\t}\n\tinit() {\n\t\tthis.List = this.getRoot();\n\t\tthis.State = this.app.getState();\n\n\t\twebix.extend(this.List, webix.OverlayBox);\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) this.RefreshData();\n\t}\n\n\tRefreshData() {\n\t\tconst start = webix.Date.datePart(this.State.date, true);\n\t\tconst end = webix.Date.add(start, 1, \"day\", true);\n\t\tthis.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(start, end)\n\t\t\t.then(evs => {\n\t\t\t\tthis.List.clearAll();\n\t\t\t\tthis.List.parse(evs.map(shrinkTo(start, end)));\n\t\t\t\tthis.ToggleOverlay();\n\t\t\t});\n\t}\n\n\tToggleOverlay() {\n\t\tif (!this.List.count()) {\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\tthis.List.showOverlay(_(\"No Events\"));\n\t\t} else {\n\t\t\tthis.List.hideOverlay();\n\t\t}\n\t}\n\n\tShowEvent(id) {\n\t\tconst obj = this.List.getItem(id);\n\t\tthis.State.selected = getParams(obj);\n\t}\n\n\tTimeStart(ev) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tif (isMultiDay(ev)) return _(\"All Day\");\n\t\telse return timeStart(ev.start_date, ev.end_date);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport MonthListView from \"./list\";\nimport CalendarView from \"./compact\";\nimport MonthEventsView from \"./events\";\nimport MonthHeaderView from \"./header\";\n\nexport default class MonthView extends JetView {\n\tconfig() {\n\t\tconst compact = this.getParam(\"compact\", true);\n\t\tconst views = compact\n\t\t\t? [CalendarView, MonthListView]\n\t\t\t: [MonthHeaderView, MonthEventsView];\n\n\t\treturn {\n\t\t\trows: views,\n\t\t};\n\t}\n\tinit() {\n\t\tthis.Data = this.app.getService(\"local\");\n\t\tconst state = this.app.getState();\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\t}\n\tRefreshData(value) {\n\t\tlet start = webix.Date.monthStart(value);\n\t\tlet end = webix.Date.add(start, 1, \"month\", true);\n\n\t\tstart = webix.Date.weekStart(\n\t\t\tnew Date(start.getFullYear(), start.getMonth(), 1)\n\t\t);\n\t\tconst weeks = Math.ceil((end - start) / (24 * 60 * 60 * 1000) / 7);\n\t\tend = webix.Date.add(end, weeks, \"week\", true);\n\n\t\tthis.Data.getEvents(start, end).then(data => {\n\t\t\tif (this.app) this.setParam(\"data\", { start, weeks, data }, true);\n\t\t});\n\t}\n}\n","import UnitListView from \"../common/unitlist\";\nimport { isToday } from \"helpers/dates\";\n\nexport default class WeekEventsView extends UnitListView {\n\tconfig() {\n\t\tconst ui = super.config();\n\t\tui.css = \"webix_scheduler_week\";\n\t\tui.type.headerHeight = 28;\n\n\t\treturn ui;\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.List.clearAll();\n\t\t\tthis.List.parse(this.data.all);\n\t\t\tthis.ToggleOverlay();\n\t\t}\n\t}\n\n\tTemplateHeader(datestring) {\n\t\tconst date = new Date(datestring * 1);\n\t\tconst today = isToday(date);\n\n\t\tconst fstring = `%l, %F <span class='webix_scheduler_monthday${\n\t\t\ttoday ? \" webix_scheduler_today\" : \"\"\n\t\t}'>%j</span>`;\n\n\t\treturn `<span class=\"webix_unit_header_inner\">${webix.Date.dateToStr(\n\t\t\tfstring\n\t\t)(date)}</span>`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { isToday } from \"helpers/dates\";\n\nexport default class WeekHeaderView extends JetView {\n\tconfig() {\n\t\treturn {\n\t\t\ttype: \"clean\",\n\t\t\tcols: [\n\t\t\t\t{ borderless: false, width: 51 },\n\t\t\t\t{\n\t\t\t\t\tview: \"dataview\",\n\t\t\t\t\tlocalId: \"header\",\n\t\t\t\t\tcss: \"webix_scheduler_day_header\",\n\t\t\t\t\txCount: 7,\n\t\t\t\t\tyCount: 1,\n\t\t\t\t\twidth: 0,\n\t\t\t\t\theight: 32,\n\t\t\t\t\tscroll: false,\n\t\t\t\t\ttype: {\n\t\t\t\t\t\theight: \"auto\",\n\t\t\t\t\t\twidth: \"auto\",\n\t\t\t\t\t},\n\t\t\t\t\ttemplate: obj => {\n\t\t\t\t\t\treturn `<span class=\"webix_scheduler_weekday\">${obj.day}</span> <span class=\"webix_scheduler_monthday\">${obj.date}</span>`;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.RefreshData();\n\t\t}\n\t}\n\n\tRefreshData() {\n\t\tlet start = this.data.start;\n\t\tconst data = [];\n\t\twhile (start < this.data.end) {\n\t\t\tconst obj = {\n\t\t\t\tday: webix.i18n.calendar.dayShort[start.getDay()],\n\t\t\t\tdate: start.getDate(),\n\t\t\t};\n\t\t\tif (isToday(start)) {\n\t\t\t\tobj.$css = \"webix_scheduler_list_today\";\n\t\t\t}\n\t\t\tdata.push(obj);\n\t\t\tstart = webix.Date.add(start, 1, \"day\", true);\n\t\t}\n\n\t\tconst header = this.$$(\"header\");\n\t\theader.clearAll();\n\t\theader.parse(data);\n\t}\n}\n","import MultiMoreView from \"../common/multimore\";\nimport SelectionMixin from \"helpers/selection\";\nimport EditRecurringMixin from \"helpers/editrecurring\";\nimport { dayEventColor } from \"helpers/templates\";\nimport { initDnD, locateEvent } from \"helpers/dnd\";\nimport { daysBetweenInclusive } from \"helpers/dates\";\nimport { getParams } from \"helpers/recurring\";\n\nexport default class MultiDayEventsView extends MultiMoreView {\n\tconfig() {\n\t\tconst ui = super.config();\n\n\t\tui.cols[1] = {\n\t\t\tview: \"dataview\",\n\t\t\tlocalId: \"multiDayList\",\n\t\t\tcss: \"webix_scheduler_multidays\",\n\t\t\tscroll: false,\n\t\t\theight: 32,\n\t\t\txCount: 7,\n\t\t\tyCount: 1,\n\t\t\twidth: 0,\n\t\t\ttype: {\n\t\t\t\twidth: \"auto\",\n\t\t\t\theight: \"auto\",\n\t\t\t\titemHeight: 32,\n\t\t\t},\n\t\t\ttemplate: \"\",\n\t\t\ttooltip: {\n\t\t\t\ttemplate: \"\",\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_scheduler_multiday_event: e => this.ShowEvent(e),\n\t\t\t},\n\t\t};\n\n\t\treturn ui;\n\t}\n\tinit() {\n\t\tthis.State = this.app.getState();\n\t\tsuper.init();\n\n\t\tSelectionMixin(this, \"multi\");\n\t\tEditRecurringMixin(this);\n\n\t\tthis.Events = new webix.DataCollection({});\n\n\t\tthis.List.attachEvent(\"onAfterRender\", () => this.RenderEvents());\n\t\tinitDnD.call(this, this.List, \"multiday\");\n\t}\n\n\turlChange() {\n\t\tthis.data = this.getParam(\"data\");\n\t\tif (this.data) {\n\t\t\tthis.ParseDays(this.data.multi);\n\t\t}\n\t}\n\n\tParseDays(events) {\n\t\tif (!events.length) return;\n\n\t\tthis.Events.clearAll();\n\t\tthis.Events.parse(events);\n\n\t\tconst days = [];\n\t\tfor (let d = 0; d < 7; d++) {\n\t\t\tdays.push({\n\t\t\t\tid: d + 1,\n\t\t\t\tdate: webix.Date.add(this.data.start, d, \"day\", true),\n\t\t\t});\n\t\t}\n\t\tthis.BreakEventsByDay(days);\n\n\t\tthis.SetMoreIcon(\n\t\t\tthis._maxEvents > this.maxVisibleLines ? this._expandState : null\n\t\t);\n\n\t\tthis.List.blockEvent();\n\t\tthis.List.parse(days);\n\t\tthis.ResetListHeight();\n\t\tthis.List.unblockEvent();\n\n\t\tthis.RenderEvents();\n\t}\n\n\tBreakEventsByDay(data) {\n\t\tthis.Days = [];\n\t\tconst processed = {};\n\t\tthis._maxEvents = 0;\n\n\t\tdata.forEach((day, dayIndex) => {\n\t\t\tconst today = day.date;\n\t\t\tthis.Days.push([]);\n\n\t\t\tthis.Events.data.each(ev => {\n\t\t\t\tif (!webix.isUndefined(processed[ev.id])) {\n\t\t\t\t\tif ((today <= ev.end_date && ev.all_day) || today < ev.end_date) {\n\t\t\t\t\t\tthis.Days[dayIndex][processed[ev.id]] = \"\";\n\t\t\t\t\t} else delete processed[ev.id];\n\t\t\t\t} else if (\n\t\t\t\t\tev.start_date < webix.Date.add(today, 1, \"day\", true) &&\n\t\t\t\t\tev.end_date >= today\n\t\t\t\t) {\n\t\t\t\t\tlet index = 0;\n\t\t\t\t\t// search for the first available index\n\t\t\t\t\twhile (!webix.isUndefined(this.Days[dayIndex][index])) index++;\n\n\t\t\t\t\tprocessed[ev.id] = index;\n\n\t\t\t\t\tconst config = {};\n\t\t\t\t\tconfig.es = ev.start_date;\n\t\t\t\t\tconfig.ee =\n\t\t\t\t\t\t!ev.all_day && !webix.Date.timePart(ev.end_date)\n\t\t\t\t\t\t\t? webix.Date.add(ev.end_date, -1, \"day\", true)\n\t\t\t\t\t\t\t: ev.end_date;\n\n\t\t\t\t\tconfig.length =\n\t\t\t\t\t\t1 +\n\t\t\t\t\t\tdaysBetweenInclusive(\n\t\t\t\t\t\t\t(config.ls = new Date(Math.max(this.data.start, config.es))),\n\t\t\t\t\t\t\t(config.le = new Date(Math.min(this.data.end - 1, config.ee)))\n\t\t\t\t\t\t);\n\n\t\t\t\t\tev.$config = config;\n\t\t\t\t\tthis.Days[dayIndex][index] = ev;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (this.Days[dayIndex].length > this._maxEvents)\n\t\t\t\tthis._maxEvents = this.Days[dayIndex].length;\n\t\t});\n\t}\n\n\tRenderEvents() {\n\t\tconst allEvents = this.Events.count();\n\n\t\tif (!allEvents) return;\n\n\t\tconst container = webix.html.create(\"div\", {\n\t\t\trole: \"presentation\",\n\t\t});\n\n\t\tlet html = \"\";\n\t\tlet renderedEvents = 0;\n\t\tconst toHide =\n\t\t\tthis._expandState === \"down\" && this._maxEvents > this.maxVisibleLines;\n\n\t\tthis.List.data.each((_day, dayIndex) => {\n\t\t\tconst dayHTML = [];\n\t\t\tconst visible = toHide\n\t\t\t\t? this.maxVisibleLines - 1\n\t\t\t\t: this.Days[dayIndex].length;\n\n\t\t\tfor (let i = 0; i < visible; ++i) {\n\t\t\t\tdayHTML[i] = this.Days[dayIndex][i];\n\n\t\t\t\tif (dayHTML[i]) {\n\t\t\t\t\tdayHTML[i] = this.ToHTML(dayHTML[i], dayIndex, i);\n\t\t\t\t\trenderedEvents++;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\thtml += dayHTML.join(\"\");\n\t\t});\n\n\t\tif (toHide) {\n\t\t\thtml += this.MoreOption(allEvents - renderedEvents);\n\t\t}\n\n\t\tcontainer.innerHTML = html;\n\t\tthis._DataObj = this.List.$view.firstChild.appendChild(container);\n\t}\n\n\tToHTML(obj, cIndex, rIndex) {\n\t\tconst style = dayEventColor(obj);\n\t\tconst size = this.GetSizePosition(obj.$config.length, cIndex, rIndex);\n\t\tconst css = this.GetStyle(obj, obj.$config);\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\treturn `\n\t\t\t<div\n\t\t\t\twebix_tooltip=\"${obj.text || _(\"(No title)\")}\"\n\t\t\t\twebix_e_id=\"${obj.id}\"\n\t\t\t\tclass=\"${css}\"\n\t\t\t\tstyle=\"${size} ${style}\">\n\t\t\t\t\t${obj.text || _(\"(No title)\")}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tGetStyle(obj, c) {\n\t\tconst { start, end } = this.data;\n\t\tlet css = \"webix_scheduler_multiday_event\";\n\t\tcss +=\n\t\t\tthis.State.selected &&\n\t\t\t(obj.id == this.State.selected.id || obj.id == this.State.selected.date)\n\t\t\t\t? \" webix_scheduler_event_selected\"\n\t\t\t\t: \"\";\n\n\t\tif (c.es < start && webix.Date.equal(start, webix.Date.dayStart(c.ls)))\n\t\t\tcss += \" webix_scheduler_event_break_left\";\n\t\tif (\n\t\t\tc.ee >= end &&\n\t\t\twebix.Date.equal(\n\t\t\t\twebix.Date.add(end, -1, \"day\", true),\n\t\t\t\twebix.Date.dayStart(c.le)\n\t\t\t)\n\t\t)\n\t\t\tcss += \" webix_scheduler_event_break_right\";\n\n\t\treturn css;\n\t}\n\n\tMoreOption(excess) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst size = this.GetSizePosition(\n\t\t\tthis.List.config.xCount,\n\t\t\t0,\n\t\t\tthis.maxVisibleLines - 1\n\t\t);\n\n\t\treturn `<div webix_e_id=\"$wsh_multi_more\" class=\"webix_scheduler_multiday_event webix_scheduler_multi_more\" style=\"${size}\">${excess} ${_(\n\t\t\t\"more\"\n\t\t)}</div>`;\n\t}\n\n\tGetSizePosition(length, cIndex, rIndex) {\n\t\t// numbers are for space between events and borders of component\n\t\tconst width = length * this.List.type.width - 4;\n\t\tconst height = this.List.type.itemHeight - 4;\n\t\tconst left = this.List.type.width * cIndex + 1;\n\t\tconst top = rIndex * this.List.type.itemHeight + 1;\n\n\t\treturn `width:${width}px; height:${height}px; line-height:${height}px; left:${left}px; top:${top}px;`;\n\t}\n\n\tShowEvent(e) {\n\t\tconst event = locateEvent(e, this.List.$view);\n\t\tif (event.id) {\n\t\t\tif (event.id === \"$wsh_multi_more\") return this.ExpandData();\n\n\t\t\tconst obj = this.Events.getItem(event.id);\n\t\t\tconst sel = webix.extend(event, getParams(obj), true);\n\t\t\tthis.State.selected = sel;\n\t\t}\n\t\treturn false;\n\t}\n\n\tExpandData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\n\t\t\tthis._expandState = \"up\";\n\t\t\tthis.Animate(\"up\");\n\n\t\t\tthis.ResetListHeight(this._maxEvents);\n\t\t}\n\t}\n\n\tWrapData() {\n\t\tif (!this._inAnimation) {\n\t\t\tthis._inAnimation = true;\n\t\t\tthis._expandState = \"down\";\n\n\t\t\tconst height =\n\t\t\t\tthis.List.$height -\n\t\t\t\t(this._maxEvents - this.maxVisibleLines) * this.List.type.height;\n\t\t\tthis.Animate(\"down\", height, () => {\n\t\t\t\tthis.ResetListHeight(this.maxVisibleLines);\n\t\t\t});\n\t\t}\n\t}\n\n\tResetListHeight(count) {\n\t\tif (!count)\n\t\t\tcount =\n\t\t\t\tthis._expandState === \"down\"\n\t\t\t\t\t? Math.min(this._maxEvents, this.maxVisibleLines)\n\t\t\t\t\t: this._maxEvents;\n\n\t\tconst height = count * this.List.type.itemHeight;\n\t\tif (this.List.type.height !== height) {\n\t\t\tthis.List.type.height = height;\n\t\t\tthis.List.define(\"height\", height);\n\t\t\tthis.List.resize();\n\t\t}\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport DayEventsView from \"../day/events\";\nimport WeekHeaderView from \"./header\";\nimport WeekEventsView from \"./compact\";\nimport HourscaleView from \"../common/hourscale\";\nimport MultiDayEventsView from \"./multiday\";\n\nimport { isMultiDay } from \"helpers/dates\";\n\nexport default class WeekView extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\n\t\tif (this.Compact) {\n\t\t\treturn {\n\t\t\t\trows: [WeekEventsView],\n\t\t\t};\n\t\t} else {\n\t\t\tconst days = {\n\t\t\t\tlocalId: \"scroll\",\n\t\t\t\tview: \"scrollview\",\n\t\t\t\tscroll: \"y\",\n\t\t\t\tcss: \"webix_scheduler_week_days\",\n\t\t\t\tbody: {\n\t\t\t\t\tcols: [HourscaleView],\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tconst weekLength = 7;\n\t\t\tfor (let i = 0; i < weekLength; ++i) {\n\t\t\t\tdays.body.cols.push(\n\t\t\t\t\tnew (this.app.dynamic(DayEventsView))(this.app, \"\", {\n\t\t\t\t\t\tday: i,\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\trows: [\n\t\t\t\t\tWeekHeaderView,\n\t\t\t\t\t{ localId: \"multi\", hidden: true, cols: [MultiDayEventsView] },\n\t\t\t\t\tdays,\n\t\t\t\t],\n\t\t\t};\n\t\t}\n\t}\n\tinit() {\n\t\tconst state = this.app.getState();\n\n\t\tthis.on(state.$changes, \"date\", value => this.RefreshData(value));\n\t\tthis.on(state.$changes, \"active\", () => this.RefreshData(state.date));\n\t\tthis.on(this.app, \"events:refresh\", () => this.RefreshData(state.date));\n\n\t\t// updates made in form\n\t\tconst events = this.app.getService(\"local\").events(true);\n\t\tthis.on(\n\t\t\tevents.data,\n\t\t\t\"onStoreUpdated\",\n\t\t\t(_i, _o, mode) => mode && this.RefreshData(state.date)\n\t\t);\n\n\t\tif (!this.Compact) {\n\t\t\tthis.on(state.$changes, \"selected\", v => v && this.ScrollScale(v));\n\t\t}\n\t}\n\n\tRefreshData(date) {\n\t\tconst start = webix.Date.weekStart(date);\n\t\tconst end = webix.Date.add(start, 1, \"week\", true);\n\t\tthis.GetWeek(start, end).then(data => {\n\t\t\t// this.app will be null if compact trigger was called in main.js\n\t\t\tif (this.app) this.setParam(\"data\", data, true);\n\n\t\t\tif (data.multi.length) {\n\t\t\t\tthis.$$(\"multi\").show();\n\t\t\t} else this.$$(\"multi\").hide();\n\t\t});\n\t}\n\n\tGetWeek(start, end) {\n\t\treturn this.app\n\t\t\t.getService(\"local\")\n\t\t\t.getEvents(start, end)\n\t\t\t.then(evs => {\n\t\t\t\tif (this.Compact) {\n\t\t\t\t\treturn { start, end, all: evs };\n\t\t\t\t}\n\n\t\t\t\tconst multi = [],\n\t\t\t\t\tsingle = [];\n\n\t\t\t\tevs.forEach(ev => {\n\t\t\t\t\tif (isMultiDay(ev)) {\n\t\t\t\t\t\tmulti.push(ev);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsingle.push(ev);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn { start, end, multi, single };\n\t\t\t});\n\t}\n\n\tScrollScale(v) {\n\t\tif (v.id === \"0\" && !v.date) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tconst y = (new Date().getHours() + 2) * 40;\n\t\t\t\tthis.$$(\"scroll\").scrollTo(0, y);\n\t\t\t}, 100);\n\t\t}\n\t}\n}\n","import m0 from \"views/bars/add\";\nimport m1 from \"views/bars/date\";\nimport m2 from \"views/bars/index.js\";\nimport m3 from \"views/bars/nav\";\nimport m4 from \"views/bars/navpopup\";\nimport m5 from \"views/event/actionmenu\";\nimport m6 from \"views/event/form\";\nimport m7 from \"views/event/formpopup\";\nimport m8 from \"views/event/info\";\nimport m9 from \"views/event/recurringform\";\nimport m10 from \"views/main\";\nimport m11 from \"views/modes/agenda/index.js\";\nimport m12 from \"views/modes/common/actionpopup\";\nimport m13 from \"views/modes/common/hourscale\";\nimport m14 from \"views/modes/common/multimore\";\nimport m15 from \"views/modes/common/unitlist\";\nimport m16 from \"views/modes/day/events\";\nimport m17 from \"views/modes/day/index.js\";\nimport m18 from \"views/modes/day/multiday\";\nimport m19 from \"views/modes/month/compact\";\nimport m20 from \"views/modes/month/events\";\nimport m21 from \"views/modes/month/header\";\nimport m22 from \"views/modes/month/index.js\";\nimport m23 from \"views/modes/month/list\";\nimport m24 from \"views/modes/month/more\";\nimport m25 from \"views/modes/week/compact\";\nimport m26 from \"views/modes/week/header\";\nimport m27 from \"views/modes/week/index.js\";\nimport m28 from \"views/modes/week/multiday\";\nimport m29 from \"views/side/editor\";\nimport m30 from \"views/side/index.js\";\nimport m31 from \"views/side/popup\";\nimport { JetView } from \"webix-jet\";\n\nconst views = { JetView };\nviews[\"bars/add\"] = m0;\nviews[\"bars/date\"] = m1;\nviews[\"bars\"] = m2;\nviews[\"bars/nav\"] = m3;\nviews[\"bars/navpopup\"] = m4;\nviews[\"event/actionmenu\"] = m5;\nviews[\"event/form\"] = m6;\nviews[\"event/formpopup\"] = m7;\nviews[\"event/info\"] = m8;\nviews[\"event/recurringform\"] = m9;\nviews[\"main\"] = m10;\nviews[\"modes/agenda\"] = m11;\nviews[\"modes/common/actionpopup\"] = m12;\nviews[\"modes/common/hourscale\"] = m13;\nviews[\"modes/common/multimore\"] = m14;\nviews[\"modes/common/unitlist\"] = m15;\nviews[\"modes/day/events\"] = m16;\nviews[\"modes/day\"] = m17;\nviews[\"modes/day/multiday\"] = m18;\nviews[\"modes/month/compact\"] = m19;\nviews[\"modes/month/events\"] = m20;\nviews[\"modes/month/header\"] = m21;\nviews[\"modes/month\"] = m22;\nviews[\"modes/month/list\"] = m23;\nviews[\"modes/month/more\"] = m24;\nviews[\"modes/week/compact\"] = m25;\nviews[\"modes/week/header\"] = m26;\nviews[\"modes/week\"] = m27;\nviews[\"modes/week/multiday\"] = m28;\nviews[\"side/editor\"] = m29;\nviews[\"side\"] = m30;\nviews[\"side/popup\"] = m31;\n\nexport default views;\n","import { parse } from \"helpers/ical\";\nimport { explodeEvent } from \"helpers/recurring\";\n\nexport default class LocalData {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t */\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.store = this.createEvents();\n\t\tthis.events_ready = null;\n\n\t\tif (app.config.calendars !== false) {\n\t\t\tthis.cals = this.createCalendars();\n\t\t\tthis.cals_ready = null;\n\t\t}\n\n\t\tconst utc = app.config.serverUTC; //load and save dates as UTC\n\t\tthis.strToDate = webix.Date.strToDate(webix.i18n.parseFormat, utc);\n\t\tthis.dateToStr = webix.Date.dateToStr(webix.i18n.parseFormat, utc);\n\t\tthis.dateToLocalStr = webix.Date.dateToStr(webix.i18n.parseFormat);\n\n\t\tthis.loaded_ranges = {}; //cached date bounds in dyn. mode\n\t}\n\t/**\n\t * Creates events collection\n\t * @returns {Object} events Data Collection\n\t */\n\tcreateEvents() {\n\t\treturn new webix.DataCollection({\n\t\t\tscheme: {\n\t\t\t\t$change: data => {\n\t\t\t\t\tif (typeof data.start_date === \"string\")\n\t\t\t\t\t\tdata.start_date = this.strToDate(data.start_date);\n\t\t\t\t\tif (typeof data.end_date === \"string\")\n\t\t\t\t\t\tdata.end_date = this.strToDate(data.end_date);\n\n\t\t\t\t\tif (this.app.config.recurring) {\n\t\t\t\t\t\tdata.$recurring = data.recurring ? parse(data.recurring) : null;\n\n\t\t\t\t\t\tif (typeof data.origin_id === \"string\" && !isNaN(data.origin_id)) {\n\t\t\t\t\t\t\tdata.origin_id *= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof data.all_day === \"string\") data.all_day *= 1;\n\n\t\t\t\t\tthis.getColor(data, this.cals && this.cals.getItem(data.calendar));\n\t\t\t\t},\n\t\t\t\t$serialize: data => this.eventOut(data),\n\t\t\t\t$export: data => this.eventOut(data),\n\t\t\t},\n\t\t});\n\t}\n\t/**\n\t * Loads events and populates events Data Collection\n\t * @param {boolean} sync - if true, Data Collection will be returned outside a promise\n\t * @param {boolean} force - if true, events will be reloaded\n\t * @returns {Promise} promise that resolves with events collection\n\t */\n\tevents(sync, force) {\n\t\tconst store = this.store;\n\t\tif (sync) return store;\n\n\t\treturn this.calendars().then(() => {\n\t\t\t//data will be filled by getEvents\n\t\t\tif (this.app.config.dynamic) {\n\t\t\t\tif (!this.events_ready)\n\t\t\t\t\tthis.events_ready = webix.promise.resolve(this.store);\n\t\t\t} else if (!this.events_ready || force) {\n\t\t\t\tthis.events_ready = this.app\n\t\t\t\t\t.getService(\"backend\")\n\t\t\t\t\t.events()\n\t\t\t\t\t.then(data => {\n\t\t\t\t\t\tstore.clearAll();\n\t\t\t\t\t\tstore.parse(data);\n\n\t\t\t\t\t\treturn store;\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn this.events_ready;\n\t\t});\n\t}\n\t/**\n\t * Gets or loads events for the stated date range\n\t * @param {Date} start - start date\n\t * @param {Date} end - end date\n\t * @returns {Promise} promise that resolves with events array\n\t */\n\tgetEvents(start, end) {\n\t\tconst mode = this.app.config.dynamic;\n\t\tlet evs;\n\n\t\tif (mode) {\n\t\t\tconst params = this.getParams(mode);\n\n\t\t\tif (params.then) {\n\t\t\t\t// loading now\n\t\t\t\tevs = params.then(() => {\n\t\t\t\t\treturn this.getLocal(start, end);\n\t\t\t\t});\n\t\t\t} else if (params === true) {\n\t\t\t\t//already loaded\n\t\t\t\tevs = this.getLocal(start, end);\n\t\t\t} else {\n\t\t\t\tevs = this.loaded_ranges[params.from] = this.getDynamic(params).then(\n\t\t\t\t\t() => {\n\t\t\t\t\t\treturn this.getLocal(start, end);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tevs = this.getLocal(start, end);\n\t\t}\n\t\treturn evs;\n\t}\n\t/**\n\t * Finds already loaded events for the stated date range\n\t * @param {Date} start - start date\n\t * @param {Date} end - end date\n\t * @returns {Promise} promise that resolves with events array\n\t */\n\tgetLocal(start, end) {\n\t\treturn this.events().then(store => {\n\t\t\tconst config = this.app.config;\n\t\t\tconst active = this.app.getState().active;\n\t\t\tlet evs = [];\n\n\t\t\tstore.data.each(ev => {\n\t\t\t\tif (\n\t\t\t\t\t(!config.calendars || findCalendar(active, ev.calendar)) &&\n\t\t\t\t\tev.start_date < end &&\n\t\t\t\t\t(ev.end_date > start ||\n\t\t\t\t\t\t(ev.end_date >= start && ev.all_day) ||\n\t\t\t\t\t\t(ev.$recurring &&\n\t\t\t\t\t\t\t(!ev.$recurring.UNTIL || ev.$recurring.UNTIL > start)))\n\t\t\t\t) {\n\t\t\t\t\tif (this.app.config.recurring && ev.recurring) {\n\t\t\t\t\t\tevs = evs.concat(explodeEvent(start, end, ev));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete ev.recurring;\n\t\t\t\t\t\tevs.push(ev);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tev.start_date = this.roundTime(ev.start_date);\n\t\t\t\tev.end_date = this.roundTime(ev.end_date);\n\t\t\t});\n\n\t\t\tevs.sort(function(a, b) {\n\t\t\t\ta = a.start_date;\n\t\t\t\tb = b.start_date;\n\t\t\t\treturn a > b ? 1 : a < b ? -1 : 0;\n\t\t\t});\n\n\t\t\treturn evs;\n\t\t});\n\t}\n\t/**\n\t * Loads events portion\n\t * @param {Object} params - dynamic loading settings\n\t * @returns {Promise} promise that resolves with events array\n\t */\n\tgetDynamic(params) {\n\t\treturn this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.events(params)\n\t\t\t.then(data => {\n\t\t\t\tthis.store.parse(data);\n\t\t\t\tthis.loaded_ranges[params.from] = true;\n\n\t\t\t\treturn data;\n\t\t\t});\n\t}\n\t/**\n\t * Gets dynamic loading parameters\n\t * @param {string} mode - dynamic loading mode, \"day\", \"week\", \"month\" or \"year\"\n\t * @returns {Object} object with parameters\n\t */\n\tgetParams(mode) {\n\t\tconst state = this.app.getState();\n\t\tconst format = webix.i18n.parseFormatStr;\n\n\t\tconst from = webix.Date[mode + \"Start\"](state.date);\n\t\tconst fromStr = format(from);\n\n\t\tlet res;\n\n\t\tif (!this.loaded_ranges[fromStr]) {\n\t\t\tres = {\n\t\t\t\tfrom: fromStr,\n\t\t\t\tto: format(webix.Date.add(from, 1, mode, true)),\n\t\t\t};\n\t\t} else res = this.loaded_ranges[fromStr];\n\n\t\treturn res;\n\t}\n\t/**\n\t * Creates calendars collection\n\t * @returns {Object} calendars Data Collection\n\t */\n\tcreateCalendars() {\n\t\treturn new webix.DataCollection({\n\t\t\tscheme: {\n\t\t\t\t$sort: {\n\t\t\t\t\tdir: \"desc\",\n\t\t\t\t\tby: \"active\",\n\t\t\t\t\tas: sortCalendars,\n\t\t\t\t},\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonAfterDelete: () => this.setActive(),\n\t\t\t\tonAfterAdd: () => this.setActive(),\n\t\t\t\t\"data->onDataUpdate\": (id, data, old) => {\n\t\t\t\t\tif (old) {\n\t\t\t\t\t\tif (data.color !== old.color) {\n\t\t\t\t\t\t\tthis.store.data.each(obj => {\n\t\t\t\t\t\t\t\tif (obj.calendar == id) this.getColor(obj, data);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.app.callEvent(\"events:refresh\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (data.active !== old.active) {\n\t\t\t\t\t\t\tthis.setActive();\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tthis.cals.sort(\"#active#\", \"desc\", sortCalendars);\n\t\t\t\t\t\t\t}, 400);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\t/**\n\t * Loads calendars and populates calendars Data Collection\n\t * @param {boolean} sync - if true, Data Collection will be returned outside a promise\n\t * @param {boolean} force - if true, calendars will be reloaded\n\t * @returns {Promise} promise that resolves with calendars collection\n\t */\n\tcalendars(sync, force) {\n\t\tif (this.app.config.calendars == false) {\n\t\t\tif (sync) return false;\n\t\t\treturn webix.promise.resolve();\n\t\t}\n\n\t\tconst cals = this.cals;\n\t\tif (sync) return cals;\n\t\tif (this.cals_ready && !force) return this.cals_ready;\n\n\t\tthis.cals_ready = this.app\n\t\t\t.getService(\"backend\")\n\t\t\t.calendars()\n\t\t\t.then(data => {\n\t\t\t\tcals.clearAll();\n\t\t\t\tcals.parse(data);\n\n\t\t\t\tthis.setActive();\n\n\t\t\t\treturn cals;\n\t\t\t});\n\n\t\treturn this.cals_ready;\n\t}\n\t/**\n\t * Processes event item before saving, serializing or exporting it\n\t * @param {Object} data - event item\n\t * @param {boolean} save - true, if called for saving operation\n\t * @returns {Object} events object\n\t */\n\teventOut(data, save) {\n\t\tdata = webix.copy(data);\n\n\t\t// export and serialize: there's no need to convert date to UTC\n\t\tconst format = save ? this.dateToStr : this.dateToLocalStr;\n\t\tif (data.start_date) data.start_date = format(data.start_date);\n\t\tif (data.end_date) data.end_date = format(data.end_date);\n\n\t\tif (!save) {\n\t\t\tdelete data.$recurring;\n\t\t\tdelete data.$textColor;\n\t\t\tdelete data.$color;\n\t\t}\n\n\t\treturn data;\n\t}\n\t/** Sets an array of active calendars IDs to app state */\n\tsetActive() {\n\t\tlet active = [];\n\t\tthis.cals.data.each(d => {\n\t\t\tif (d.active * 1) active.push(d.id);\n\t\t});\n\t\tthis.app.getState().active = active;\n\t}\n\t/**\n\t * Assigns colors to event item\n\t * @param {Object} data - event object\n\t * @param {Object} force - calendar object\n\t */\n\tgetColor(data, calendar) {\n\t\tdata.$color = calendar ? calendar.color : data.color || \"#01C2A5\"; //same for new event in form\n\t\tdata.$textColor = getContrastingColor(data.color || data.$color);\n\t}\n\t/**\n\t * Rounds time for start and end dates of event item to 5 minutes to match Webix Timepicker\n\t * @param {Date} date - Date object\n\t * @returns {Date} Date object with rounded minutes\n\t */\n\troundTime(date) {\n\t\tconst res = webix.Date.copy(date);\n\t\tres.setMinutes(Math.round(res.getMinutes() / 5) * 5);\n\t\treturn res;\n\t}\n\t/**\n\t * Checks if there are sub-events after the start date of the stated occurrence of a recurring event\n\t * @param {Object} event - event object\n\t * @returns {boolean} result of the check\n\t */\n\tisLastPart(event) {\n\t\tconst hasParts = this.store.find(\n\t\t\te =>\n\t\t\t\tevent.origin_id == e.origin_id &&\n\t\t\t\t(event.$id || event.id) != e.id && // in dnd events have $id, in info they do not\n\t\t\t\tevent.start_date < e.start_date,\n\t\t\ttrue\n\t\t);\n\t\treturn !hasParts;\n\t}\n}\n\n/**\n * Gets contrasting text color for the event backgrounf color\n * @param {string} color - background color\n * @returns {string} text color\n */\nfunction getContrastingColor(color) {\n\tconst rgb = webix.color.toRgb(color);\n\tconst brightness = Math.round(\n\t\t(rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000\n\t);\n\treturn brightness > 180 ? \"#475466\" : \"#ffffff\";\n}\n/**\n * Checks whether the stated calendar is active\n * @param {Array} arr - array of IDs of active calendars\n * @param {string|number} arr - ID of the searched calendar\n * @returns {boolean} result of the check\n */\nfunction findCalendar(arr, c) {\n\tfor (let i = 0; i < arr.length; ++i) {\n\t\tif (arr[i] == c) return true;\n\t}\n\treturn false;\n}\n/**\n * Compares active state of calendars\n * @param {string} a - value of the 'active' field\n * @param {string} b - value of the 'active' field\n * @returns {boolean} result of the comparison\n */\nfunction sortCalendars(a, b) {\n\treturn a * 1 > b * 1 ? 1 : -1;\n}\n","import {\n\tisFirstOccurrence,\n\tcutOccurrence,\n\tclipSequence,\n\tcorrectMode,\n} from \"../helpers/recurring\";\n\nexport default class Operations {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t */\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.Back = app.getService(\"backend\");\n\n\t\tconst local = (this.Local = app.getService(\"local\"));\n\t\tthis.Events = local.events(true);\n\t\tthis.Cals = local.calendars(true);\n\t\tthis.State = app.getState();\n\t}\n\t/**\n\t * Adds event\n\t * @param {Object} obj - object with event fields\n\t * @param {string} temp - ID of the temporary task\n\t * @returns {promise} promise that resolves with event id\n\t */\n\taddEvent(obj, temp) {\n\t\tconst tosave = this.Local.eventOut(obj, true);\n\t\treturn this.Back.addEvent(tosave).then(res => {\n\t\t\tif (temp) this.Events.remove(temp);\n\t\t\tobj.id = res.id;\n\t\t\treturn this.Events.add(obj);\n\t\t});\n\t}\n\t/**\n\t * Updates event\n\t * @param {string|number} id - event ID\n\t * @param {Object} obj - object with event fields\n\t * @param {string} mode - update mode: \"unite\" or \"next\"\n\t * @returns {promise} promise\n\t */\n\tupdateEvent(id, obj, mode, date) {\n\t\tconst tosave = this.Local.eventOut(obj, true);\n\t\treturn this.Back.updateEvent(id, tosave, mode, date).then(() => {\n\t\t\tthis.Events.updateItem(id, obj);\n\n\t\t\tif (mode === \"all\") {\n\t\t\t\tconst parts = this.Events.find(e => e.origin_id == id).map(e => e.id);\n\t\t\t\tthis.Events.remove(parts);\n\t\t\t} else if (mode === \"next\" && date) {\n\t\t\t\t// in case update came for a sub-event, find master\n\t\t\t\tconst cev = this.Events.getItem(id);\n\t\t\t\tif (cev.origin_id) id = cev.origin_id;\n\n\t\t\t\tconst parts = this.Events.find(\n\t\t\t\t\te => e.origin_id == id && e.start_date >= date\n\t\t\t\t).map(e => e.id);\n\t\t\t\tthis.Events.remove(parts);\n\t\t\t}\n\t\t});\n\t}\n\t/**\n\t * Removes event\n\t * @param {string} mode - edit mode: \"this\", \"next\" or \"all\"\n\t * @param {Object} obj - object with event fields\n\t * @param {number} date_id - ID of event occurrence, for custom calls\n\t * @returns {promise} promise\n\t */\n\tremoveEvent(mode, obj, date_id) {\n\t\tlet id = this.State.selected ? this.State.selected.id : obj.$id || obj.id;\n\n\t\t// non-recurring and special cases of recurring\n\t\tconst isFirst = mode ? isFirstOccurrence(date_id, obj.start_date) : false;\n\t\tif (mode === \"next\" && isFirst) {\n\t\t\tmode = correctMode.call(this, obj, mode);\n\t\t}\n\n\t\tif (\n\t\t\t!mode ||\n\t\t\tmode === \"all\" ||\n\t\t\t(mode === \"this\" && !date_id) ||\n\t\t\t(mode === \"next\" && obj.origin_id && isFirst)\n\t\t) {\n\t\t\tif (mode === \"all\" && obj.origin_id) id = obj.origin_id;\n\n\t\t\tthis.Back.removeEvent(id).then(() => {\n\t\t\t\tthis.Events.remove(id);\n\n\t\t\t\tconst parts = this.Events.find(e => e.origin_id == id).map(e => e.id);\n\t\t\t\tthis.Events.remove(parts);\n\t\t\t});\n\t\t} else {\n\t\t\t// recurring events...\n\t\t\tif (mode === \"this\" || mode === \"next\") {\n\t\t\t\tif (!date_id) {\n\t\t\t\t\tid = obj.origin_id;\n\t\t\t\t\tobj = this.Events.getItem(id);\n\t\t\t\t}\n\n\t\t\t\tconst date = webix.Date.dayStart(\n\t\t\t\t\tdate_id ? new Date(date_id.split(\"_\")[0] * 1) : obj.start_date\n\t\t\t\t);\n\t\t\t\tconst recurring =\n\t\t\t\t\tmode === \"this\" ? cutOccurrence(date, obj) : clipSequence(date, obj);\n\n\t\t\t\t// [fixme] if all occ-s were removed, remove the whole event instead of update\n\t\t\t\t// or do this in PUT on backend - otherwise an 'empty' 'all' event will hang in db, unavailable for calendar\n\n\t\t\t\tthis.updateEvent(id, { recurring }, mode, date);\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Adds calendar\n\t * @param {Object} obj - object with calendar fields\n\t * @returns {promise} promise that resolves with calendar id\n\t */\n\taddCalendar(obj) {\n\t\tif (!obj) obj = { text: \"\", color: \"#997CEB\", active: 1 };\n\n\t\treturn this.Back.addCalendar(obj).then(res => {\n\t\t\tobj.id = res.id;\n\t\t\tthis.Cals.add(obj, 0);\n\t\t\treturn obj.id;\n\t\t});\n\t}\n\t/**\n\t * Updates calendar\n\t * @param {string|number} id - calendar ID\n\t * @param {Object} obj - object with calendar fields\n\t * @returns {promise} promise\n\t */\n\tupdateCalendar(id, obj) {\n\t\tif (!this.app.getState().readonly)\n\t\t\treturn this.Back.updateCalendar(id, obj).then(() => {\n\t\t\t\treturn this.Cals.updateItem(id, obj);\n\t\t\t});\n\t\telse return webix.promise.resolve(this.Cals.updateItem(id, obj));\n\t}\n\n\tremoveCalendar(id) {\n\t\tthis.Back.removeCalendar(id).then(() => {\n\t\t\tthis.Cals.remove(id);\n\t\t});\n\t}\n}\n","export default class Backend {\n\tconstructor(app, url) {\n\t\tthis.app = app;\n\t\tthis._url = url;\n\t}\n\n\turl(path) {\n\t\treturn this._url + path;\n\t}\n\n\tevents(params) {\n\t\treturn webix.ajax(this.url(\"events\"), params).then(res => res.json());\n\t}\n\n\taddEvent(obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"events\"), obj)\n\t\t\t.then(res => res.json());\n\t}\n\n\tupdateEvent(id, obj, mode, date) {\n\t\tconst params = obj;\n\t\tif (mode) params.recurring_update_mode = mode;\n\t\tif (date) params.recurring_update_date = date;\n\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"events/\" + id), params)\n\t\t\t.then(res => res.json());\n\t}\n\n\tremoveEvent(id) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"events/\" + id))\n\t\t\t.then(res => res.json());\n\t}\n\n\tcalendars() {\n\t\treturn webix.ajax(this.url(\"calendars\")).then(res => res.json());\n\t}\n\n\taddCalendar(obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"calendars\"), obj)\n\t\t\t.then(res => res.json());\n\t}\n\n\tupdateCalendar(id, obj) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"calendars/\" + id), obj)\n\t\t\t.then(res => res.json());\n\t}\n\n\tremoveCalendar(id) {\n\t\treturn webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"calendars/\" + id))\n\t\t\t.then(res => res.json());\n\t}\n}\n","import { JetApp, plugins, EmptyRouter } from \"webix-jet\";\nimport { createState, link, ignoreInitial } from \"jet-restate\";\n\nimport views from \"./export_views\";\nimport en from \"locales/en\";\n\nimport LocalData from \"models/LocalData\";\nimport Operations from \"./models/Operations\";\nimport Backend from \"./models/Backend\";\n\nexport class App extends JetApp {\n\tconstructor(config) {\n\t\tconst state = createState({\n\t\t\tmode: config.mode || \"month\",\n\t\t\tdate: webix.Date.dayStart(config.date || new Date()),\n\t\t\treadonly: config.readonly || false,\n\t\t\tactive: [],\n\t\t\tselected: null,\n\t\t});\n\n\t\tconfig = config || {};\n\n\t\tconst defaults = webix.extend(\n\t\t\t{\n\t\t\t\trouter: EmptyRouter,\n\t\t\t\tversion: VERSION,\n\t\t\t\tdebug: DEBUG,\n\t\t\t\tstart: \"/main\",\n\t\t\t\tparams: { state, forceCompact: config.compact },\n\t\t\t\tcompactWidth: 780,\n\t\t\t\trecurring:\n\t\t\t\t\ttypeof config.recurring != \"undefined\" ? config.recurring : true,\n\t\t\t\tcalendars:\n\t\t\t\t\ttypeof config.calendars != \"undefined\" ? config.calendars : true,\n\t\t\t},\n\t\t\tconfig\n\t\t);\n\n\t\tsuper({ ...defaults });\n\n\t\t// order matters!\n\t\tthis.setService(\n\t\t\t\"backend\",\n\t\t\tnew (this.dynamic(Backend))(this, this.config.url)\n\t\t);\n\t\tthis.setService(\"local\", new (this.dynamic(LocalData))(this, config));\n\t\tthis.setService(\"operations\", new (this.dynamic(Operations))(this));\n\n\t\tthis.use(\n\t\t\tplugins.Locale,\n\t\t\tthis.config.locale || {\n\t\t\t\tlang: \"en\",\n\t\t\t\twebix: {\n\t\t\t\t\ten: \"en-US\",\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\tdynamic(obj) {\n\t\treturn this.config.override ? this.config.override.get(obj) || obj : obj;\n\t}\n\n\trequire(type, name) {\n\t\tif (type === \"jet-views\") return views[name];\n\t\telse if (type === \"jet-locales\") return locales[name];\n\n\t\treturn null;\n\t}\n\n\tgetState() {\n\t\treturn this.config.params.state;\n\t}\n}\n\nwebix.protoUI(\n\t{\n\t\tname: \"scheduler\",\n\t\tapp: App,\n\t\tdefaults: {\n\t\t\tborderless: true,\n\t\t},\n\t\t$init: function() {\n\t\t\tthis.name = \"scheduler\";\n\n\t\t\tconst state = this.$app.getState();\n\n\t\t\tfor (let key in state) {\n\t\t\t\tlink(state, this.config, key);\n\t\t\t}\n\n\t\t\tstate.$changes.attachEvent(\"date\", () => {\n\t\t\t\tignoreInitial((v, o) => this.callEvent(\"onChange\", v, o));\n\t\t\t});\n\t\t},\n\t\t$exportView: function() {\n\t\t\treturn this.$app.getService(\"local\").events(true);\n\t\t},\n\t\tgetState() {\n\t\t\treturn this.$app.getState();\n\t\t},\n\t\tgetService(name) {\n\t\t\treturn this.$app.getService(name);\n\t\t},\n\t},\n\twebix.ui.jetapp\n);\n\n// re-export for customization\nconst services = { Backend, LocalData, Operations };\nconst locales = { en };\nexport { views, services, locales };\n","export default {\n\t//navigation\n\tWeek: \"Week\",\n\tDay: \"Day\",\n\tMonth: \"Month\",\n\tAgenda: \"Agenda\",\n\tToday: \"Today\",\n\tCreate: \"Create\",\n\tNext: \"Next\",\n\tPrevious: \"Previous\",\n\t\"Next day\": \"Next day\",\n\t\"Previous day\": \"Previous day\",\n\t\"Next week\": \"Next week\",\n\t\"Previous week\": \"Previous week\",\n\t\"Next month\": \"Next month\",\n\t\"Previous month\": \"Previous month\",\n\n\t// managing calendars\n\t\"Add calendar\": \"Add calendar\",\n\t\"Do you really want to remove this calendar?\":\n\t\t\"Do you really want to remove this calendar?\",\n\t\"Edit calendar\": \"Edit calendar\",\n\tDelete: \"Delete\",\n\tSave: \"Save\",\n\tTitle: \"Title\",\n\tColor: \"Color\",\n\tActive: \"Active\",\n\tSettings: \"Settings\",\n\t\"(no title)\": \"(no title)\",\n\t\"Inactive calendar\": \"Inactive calendar\",\n\n\t// modes\n\t\"No Events\": \"No Events\",\n\t\"All Day\": \"All Day\",\n\tmore: \"more\",\n\t\"Expand all-day events\": \"Expand all-day events\",\n\t\"Collapse all-day events\": \"Collapse all-day events\",\n\n\t// info and form\n\t\"The event will be deleted permanently, are you sure?\":\n\t\t\"The event will be deleted permanently, are you sure?\",\n\tDone: \"Done\",\n\t\"Delete event\": \"Delete event\",\n\tClose: \"Close\",\n\tEdit: \"Edit\",\n\t\"(No title)\": \"(No title)\",\n\tEvent: \"Event\",\n\tStart: \"Start\",\n\tEnd: \"End\",\n\tCalendar: \"Calendar\",\n\tNotes: \"Notes\",\n\tfrom: \"from\",\n\tto: \"to\",\n\tlabelAllday: \"All day\",\n\tlabelTime: \"Time\",\n\t\"Edit event\": \"Edit event\",\n\n\t//recurring\n\tnever: \"never\",\n\tnone: \"none\",\n\tdaily: \"daily\",\n\tday: \"day\",\n\tdays: \"days\",\n\tevery: \"Every\",\n\tweekly: \"weekly\",\n\tweek: \"week\",\n\tweeks: \"weeks\",\n\teach: \"Every\",\n\tmonthly: \"monthly\",\n\tmonth: \"month\",\n\tmonths: \"months\",\n\tyearly: \"yearly\",\n\tyear: \"year\",\n\tyears: \"years\",\n\tRepeat: \"Repeat\",\n\t\"End repeat\": \"End repeat\",\n\t\"Repeats each\": \"Repeats each\",\n\ttill: \"till\",\n\ttimes: \"times\",\n\t\"weekly, every\": \"weekly, every\",\n\t\"monthly, every\": \"monthly, every\",\n\t\"yearly, every\": \"yearly, every\",\n\t\"every working day\": \"every working day\",\n\tcustom: \"custom\",\n\tEvery: \"Every\",\n\ton: \"on\",\n\t\"after several occurrences\": \"after several occurrences\",\n\tdate: \"date\",\n\t\"week on\": \"week on\",\n\t\"Change recurring pattern\": \"Change recurring pattern\",\n\t\"Save changes?\": \"Save changes?\",\n\n\t// menus for edit and delete\n\t\"All events\": \"All events\",\n\t\"This event\": \"This event\",\n\t\"This event and the following\": \"This event and the following\",\n\tCancel: \"Cancel\",\n\tApply: \"Apply\",\n\t\"Edit recurring event\": \"Edit recurring event\",\n};\n"],"names":["webix","config","this","webixJet","_events","_subs","_data","params","extend","JetBase","_root","_detachEvents","_destroySubs","_container","app","_parent","id","value","url","_segment","update","show","parent","view","getParentView","getParam","suburl","toString","root_1","getRoot","queryView","obj","localId","$scope","name","code","attachEvent","push","key","kid","contains","sub","getSubViewInfo","subview","popup","events","i","length","detachEvent","subView","destructor","current","default","branch","child","_getDefaultSub","_routed_view","parse","substr","parts","split","chunks","test","result","pos","indexOf","params_1","_i","dchunk","decodeURIComponent","page","isNew","url2str","stack","stack_1","chunk","obj2str","join","str","encodeURIComponent","route","index","_next","path","Route","slice","setParams","old","kids","reset","concat","_join","Promise","res","rej","redirect","confirm","resolve","callEvent","NavigationBlocked","catch","err","then","_this","n","_super","_children","__extends","JetView","ui","container","jetview","createView","render","setParam","parent_1","target","_renderFrameLock","_show","segment","_init_url_data","_urlChange","linkRouter","getRouter","set","silent","_$view","_$","_$url","message","destroy","_destroyKids","plugin","getUrl","tagName","refresh","_render","root","document","body","toNode","cfg","_render_final","response","slot","$$","reject","copyConfig","oldui","parent_2","asWin","setPosition","isVisible","_init","_initUrl","ready","e","_initError","init","waits","frame","wait","all","urlChange","lock","_renderFrame","next","_createSubView","shift","_override","error","createFromURL","uis","_ui","JetViewRaw","cb","SubRouter","a","append","_once","window","version","start","_services","EventSystem","JetAppBase","_subSegment","handler","getSubView","prototype","$subview","addSubView","isArray","Array","method","point","DataCollection","RegExp","Map","Date","copy","$router","srcElement","getAttribute","trigger_1","_forView","trigger","cancelBubble","preventDefault","route_1","parentNode","clickHandler","views","_loadError","Error","hidden","replace","require","module","__esModule","loadView","over","override","dv","get","router","rest","apply","data","bind","er","debug","console","text","innerHTML","type","expire","event","_first_start","top","base","setTimeout","animation","node_1","html","addCss","removeCss","now","urlString","template","uid","_detectPrefix","onpopstate","HashRouter","routes","compare","history","pushState","prefix","sufix","_getRaw","routerPrefix","location","href","isPatched","patch","w","win","promise","freeze","some","$freeze","resize","baseAdd","baselayout","addView","baseRemove","removeView","jview_1","subs_1","arguments","subs","layout","protoUI","$init","$app","$ready","proxy","JetApp","UrlRouter","pathname","search","_$config","EmptyRouter","has","store","Object","hasOwnProperty","call","forEach","context","warn","x","String","russianPluralGroups","end","pluralTypes","arabic","lastTwo","bosnian_serbian","chinese","croatian","french","german","russian","lithuanian","czech","polish","icelandic","slovenian","pluralTypeToLanguages","pluralTypeName","locale","ret","langToPluralType","langs","lang","en","escape","token","dollarRegex","defaultTokenRegex","transformPhrase","phrase","substitutions","tokenRegex","TypeError","interpolationRegex","options","smart_count","texts","count","pluralTypeIndex","expression","argument","Polyglot","opts","phrases","currentLocale","allowMissing","onMissingKey","suffix","RangeError","constructTokenRegex","interpolation","newLocale","morePhrases","prefixedKey","unset","clear","newPhrases","t","_","webixPolyglot","plugins","_view","storage","setLangData","pconfig","polyglot","poly","service","put","locName","i18n","setLocale","setLang","getLang","setService","link","source","defineProperty","createState","handlers","out","observe","mask","undefined","queue","waitInQueue","notify","meta","list","keys","enumerable","configurable","values_1","sconfig","nested","reactive","$extend","val","valueOf","AddView","getService","compact","cals","calendars","icon","css","label","width","height","skin","$active","inputHeight","on","onItemClick","AddEvent","align","getState","selected","DateView","cols","tooltip","NavLabel","ChangeDate","State","$changes","DateLabel","dir","state","step","mode","add","date","diff","Math","abs","getMonth","setDate","$batch","longDateFormatStr","dateToStr","setHTML","NavBarView","toolbar","bottomOffset","borderless","optionWidth","onChange","SetMode","setValue","getPalette","aSkin","optionHeight","palette","SidePopupView","save","inputWidth","click","Save","compactBar","padding","left","layoutPadding","form","right","elements","hide","controls","Delete","modal","close","position","fullscreen","head","suggest","onHide","Form","splice","Cals","Ops","getItem","setValues","color","active","focus","getValues","updateCalendar","addCalendar","removeCalendar","relative","rows","UpdateColor","onClick","webix_template","ShowEditor","Editor","EditorView","node","Cid","Show","SideView","Compact","calendar","monthSelect","onDateSelect","dayStart","ListType","autoheight","yCount","editable","editValue","editaction","editor","webix_scheduler_cal_edit","ShowPopup","webix_scheduler_cal_title","ToggleCalendar","webix_scheduler_active","onBeforeEditStop","v","SetTitle","side","maxHeight","readonly","AddCalendar","onAfterScroll","Popup","Hide","Data","PopupView","EditAbility","unselectAll","ToggleState","checkbox","common","edit","env","touch","getEditor","getInputNode","setAttribute","select","getItemNode","EditStopSilent","fail","blockEvent","editCancel","editStop","unblockEvent","NavPopupView","tHeight","tabbarHeight","TopBarView","todayIcon","batch","SetToday","todayBtn","responsive","paddingY","paddingX","visibleBatch","ShowNav","responsiveCell","NavPopup","ToggleAdd","EventActionMenu","onMenuItemClick","Result","Root","icalFormat","strToDate","serialize","map","d","WEEKDAYS","FREQUENCE","DAILY","WEEKLY","MONTHLY","YEARLY","findDate","arr","equal","fillWdays","consts","BYDAY","wdays","line","sort","s","j","interval","INTERVAL","FREQ","getDate","getDay","setMonth","BYMONTHDAY","BYSETPOS","checkDay","sdate","days","oldDay","includes","recToDate","_a","getParams","$id","$recurring","extractDate","clipSequence","ev","block","UNTIL","COUNT","EXDATE","filter","cutOccurrence","separateSequence","start_date","len","end_date","isFirstOccurrence","evStart","correctMode","origin_id","recurring","isLastPart","movePattern","rec","newEvent","nmd","nwn","day","floor","getWeekNum","BYMONTH","nm","RecurringFormView","elementsConfig","labelPosition","bottom","CreateIntervalControls","CreateCheckboxes","CreateSelect","CreateRadio","UpdateEvent","Events","CheckBoxContainer","Checkboxes","getChildViews","pop","PatternSelect","UntilDateContainer","UntilDateCalendar","untilDate","getPopup","getBody","UntilNumContainer","UntilNum","CustomRecControls","margin","labelWidth","min","ChangeControls","_freq","dayShort","labelAlign","o","isUndefined","GetBYDAY","SetSilently","gravity","values","check","find","getValue","byDay","dayFull","monthFull","calculated","weekday","getList","month","weekNum","rec_pattern","vertical","ChangeSelectors","icons","until","untilCount","CountNum","define","minDate","_StartDate","SetUNTIL","SetBYDAY","SetPatternOptions","setDirty","GetRecPattern","IsDirty","change","GetValues","isDirty","control","changeMode","date_id","correctCountUntil","collection","oid","b","last","countToUntil","nexto","cutCount","hasOneOccurrence","lr","EditRecurringMixin","ChangeMode","CorrectCountUntil","HasOneOccurrence","EventFormView","hotkey","Close","Done","scroll","GetDateTime","labelRight","ToggleTimeControls","CreateCalendarColor","CreateRepeat","Wait","getDirtyValues","Local","RecurringOptions","StartTime","EndTime","_v","Calendars","SubForm","ClearTempEvent","FillForm","labelTopHeight","ToggleSubform","ShowSubForm","unshift","format","Id","NewEvent","FillFormContinue","AdaptObjToMode","start_time","end_time","datePart","SetRecurring","today","GetFromStartDate","roptions","ResetRecurringOptions","SetValues","rec_option","toLowerCase","time","timePart","GetStartDate","first","getFirstId","$color","minutes","ceil","getMinutes","setHours","getHours","prev","PrepareChange","sid","_inProgress","addEvent","PrepareOut","newEvent_1","updateEvent","recVals","SetFormSilently","UpdateSilently","finally","fvals","GetRecurring","_b","edate","datesToRec","ns","es","SumupDateTime","all_day","Join","CorrectDateTime","ApplyDatechangeToRecurring","ProcessText","field","trim","oldStart","length_1","dirty","UpdateStateDate","wday","GetModeBounds","r","rObj","details","dateField","timeField","ev_length","opposite","exists","remove","Back","Subform","subform","HideSubPop","getTopParentView","exit","FormPopup","EventView","StartAction","$view","InfoTemplate","action","EventObj","Menu","_waitMenu","defer","DeleteEvent","EditEvent","title","removeEvent","oneday","allday","timeFormatStr","startDate","endDate","startTime","endTime","fromTo","pattern","EventActionPopup","buttons","layoutMargin","Cancel","sizeTrigger","_compactValue","_compactWidth","_compactHandler","_checkTrigger","$setSize","y","MainView","fCompact","topbar","cells","compactWidth","SetCompactMode","ProgressBar","showProgress","delay","hideProgress","ToggleEvent","ToggleSidePanel","_dndActionPopup","ShowEvent","HideEvent","sameEvent","_sidePanel","marker","timeStart","dayEventColor","$textColor","fill","size","master","templateStart","marks","classname","aria","shrinkTo","before","after","isToday","isMultiDay","daysBetweenInclusive","round","UnitListView","uniteBy","templateHeader","TemplateHeader","TimeStart","onUnits","SetUnits","List","OverlayBox","sel","hideOverlay","showOverlay","units","start_1","this_1","AgendaView","headerHeight","TemplateCss","onItemRender","$unit","CurrentUnit","firstChild","SelectEvent","RefreshData","_o","monthStart","getEvents","clearAll","ToggleOverlay","_selected","datestring","fstring","ids","getUnitList","HourscaleView","heightSize","ind","getIndexById","HourScaleItem","ParseHours","h","MultiMoreView","wxi-angle-down","ExpandData","wxi-angle-up","WrapData","MoreIcon","_expandState","maxVisibleLines","style","transition","_inAnimation","SetMoreIcon","_select","functor","trgs","LocateSelected","Select","Unselect","HandleSelection","_SelectionMode","id_1","operation","SelectionMixin","inner","_DataObj","querySelectorAll","el","firstElementChild","locate","Resizer","$dragIn","getContext","from","$dragPos","ctx","box","offset","y_diff","updateNodeHeight","duration","updateText","x_diff","DragControl","getNode","max","minEventHeight","getActualDate","any","initDnD","dragOnly","ctrl","modes","addDrag","addDrop","locateEvent","updateSelection","selection","editRecurring","newSubEvent","$dragDestroy","$waitUpdate","visibility","$resize","setDragOffset","x_offset","y_offset","_waitPopup","finishOperation","appendChild","$drop","$last_y","$dragCreate","GetEvent","cloneNode","className","Day","delta","getMaster","EventTemplate","noff","toff","getIdByIndex","$marked","markDropArea","$dragOut","drop","drag_container","createElement","$extra","extra","getLastId","xCount","multiday","more","children","ID","HideWindow","WeekDayNum","DayEventsView","webix_scheduler_day_event","onDblClick","webix_scheduler_day_scale_item","_e","ShowNew","RenderEvents","weekStart","to","FilterToday","_marker_update_interval","clearInterval","setInterval","UpdateMarkerPosition","_Marker","single","create","class","evs","PrepareEvents","role","ToHTML","MarkToday","$inner","orderSet","PruneStack","$sorder","max_count","SetPosition","GetEventEndDate","$count","temp_width","$width","$left","evCorrectedCopy","sm","em","$top","$height","content","EventTemplateStart","resizer","MultidayEventList","webix_scheduler_multiday_event","_moreBtn","$css","LimitData","multi","GetStyle","excess","_reserve","_reserveIds","Animate","DayView","ScrollScale","GetDay","scrollTo","CalendarView","isOutside","MarkEvent","navigation","monthHeader","skipEmptyWeeks","Calendar","weeks","isHoliday","c","MoreWindowView","minHeight","webix_scheduler_month_event","webix_scheduler_month_event_single","MoreTemplate","Win","_c","DayFormatStr","MonthEventsView","prerender","webix_cal_date","_ev","ShowDay","webix_scheduler_more","ShowMore","webix_cal_day","CalendarTemplate","eventHeight","MoreWindow","dynamic","$more","GetDayCss","maxLines","wStart","wEnd","cache","me","ms","each","dayIndex","dayHTML","ee","ls","le","prevLength","GetPosition","row","col","start_a","start_b","days_a","monthData","GetMonthData","ShowWindow","MonthHeaderView","GetHeaderData","k","startOnMonday","MonthListView","MonthView","getFullYear","WeekEventsView","WeekHeaderView","header","MultiDayEventsView","itemHeight","ParseDays","BreakEventsByDay","_maxEvents","ResetListHeight","Days","processed","$config","allEvents","renderedEvents","toHide","_day","visible","MoreOption","cIndex","rIndex","GetSizePosition","WeekView","GetWeek","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","m13","m14","m15","m16","m17","m18","m19","m20","m21","m22","m23","m24","m25","m26","m27","m28","m29","m30","m31","createEvents","events_ready","createCalendars","cals_ready","utc","serverUTC","parseFormat","dateToLocalStr","loaded_ranges","LocalData","scheme","$change","string","name_1","isNaN","getColor","$serialize","eventOut","$export","sync","force","getLocal","getDynamic","findCalendar","xdate","explodeEvent","roundTime","parseFormatStr","fromStr","$sort","by","as","sortCalendars","onAfterDelete","setActive","onAfterAdd","data->onDataUpdate","rgb","toRgb","setMinutes","local","Operations","temp","tosave","updateItem","cev","isFirst","_url","Backend","ajax","json","post","recurring_update_mode","recurring_update_date","del","defaults","forceCompact","use","App","locales","$exportView","jetapp","services","Week","Month","Agenda","Today","Create","Next","Previous","Next day","Previous day","Next week","Previous week","Next month","Previous month","Add calendar","Do you really want to remove this calendar?","Edit calendar","Title","Color","Active","Settings","(no title)","Inactive calendar","No Events","All Day","Expand all-day events","Collapse all-day events","The event will be deleted permanently, are you sure?","Delete event","Edit","(No title)","Event","Start","End","Notes","labelAllday","labelTime","Edit event","never","none","daily","every","weekly","week","monthly","months","yearly","year","years","Repeat","End repeat","Repeats each","till","times","weekly, every","monthly, every","yearly, every","every working day","custom","Every","after several occurrences","week on","Change recurring pattern","Save changes?","All events","This event","This event and the following","Apply","Edit recurring event"],"mappings":"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"}