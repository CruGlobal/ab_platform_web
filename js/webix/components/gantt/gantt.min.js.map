{"version":3,"file":"gantt.min.js","sources":["../node_modules/webix-jet/dist/es6/jet.js","../node_modules/@xbs/jet-helpers/rLayout.js","../node_modules/@xbs/jet-helpers/jetWin.js","../node_modules/jet-restate/index.js","../sources/helpers/dragscroll.js","../sources/helpers/dnd.js","../sources/views/chart/bars.js","../sources/views/chart/scale.js","../sources/views/chart/index.js","../sources/views/rdiagram/diagram.js","../sources/helpers/common.js","../sources/views/rdiagram/tree.js","../sources/views/rdiagram/index.js","../sources/views/task/baseline.js","../sources/views/task/links.js","../sources/helpers/numeditor.js","../sources/views/task/resources.js","../sources/views/task/form.js","../sources/views/task/info.js","../sources/views/task/popup.js","../sources/views/tree.js","../sources/views/top.js","../sources/export_views.js","../sources/models/Local.js","../sources/models/Backend.js","../sources/models/Operations.js","../node_modules/@xbs/webix-gantt-lib/dist/wgantt.es6.js","../sources/models/Helpers.js","../sources/models/Grouping.js","../sources/app.js","../sources/locales/en.js"],"sourcesContent":["class NavigationBlocked {\r\n}\n\nclass JetBase {\r\n    constructor(webix, config) {\r\n        this.webixJet = true;\r\n        this.webix = webix;\r\n        this._events = [];\r\n        this._subs = {};\r\n        this._data = {};\r\n        if (config && config.params)\r\n            webix.extend(this._data, config.params);\r\n    }\r\n    getRoot() {\r\n        return this._root;\r\n    }\r\n    destructor() {\r\n        this._detachEvents();\r\n        this._destroySubs();\r\n        this._events = this._container = this.app = this._parent = this._root = null;\r\n    }\r\n    setParam(id, value, url) {\r\n        if (this._data[id] !== value) {\r\n            this._data[id] = value;\r\n            this._segment.update(id, value, 0);\r\n            if (url) {\r\n                return this.show(null);\r\n            }\r\n        }\r\n    }\r\n    getParam(id, parent) {\r\n        const value = this._data[id];\r\n        if (typeof value !== \"undefined\" || !parent) {\r\n            return value;\r\n        }\r\n        const view = this.getParentView();\r\n        if (view) {\r\n            return view.getParam(id, parent);\r\n        }\r\n    }\r\n    getUrl() {\r\n        return this._segment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._segment.toString();\r\n    }\r\n    getParentView() {\r\n        return this._parent;\r\n    }\r\n    $$(id) {\r\n        if (typeof id === \"string\") {\r\n            const root = this.getRoot();\r\n            return root.queryView((obj => (obj.config.id === id || obj.config.localId === id) &&\r\n                (obj.$scope === root.$scope)), \"self\");\r\n        }\r\n        else {\r\n            return id;\r\n        }\r\n    }\r\n    on(obj, name, code) {\r\n        const id = obj.attachEvent(name, code);\r\n        this._events.push({ obj, id });\r\n        return id;\r\n    }\r\n    contains(view) {\r\n        for (const key in this._subs) {\r\n            const kid = this._subs[key].view;\r\n            if (kid === view || kid.contains(view)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    getSubView(name) {\r\n        const sub = this.getSubViewInfo(name);\r\n        if (sub) {\r\n            return sub.subview.view;\r\n        }\r\n    }\r\n    getSubViewInfo(name) {\r\n        const sub = this._subs[name || \"default\"];\r\n        if (sub) {\r\n            return { subview: sub, parent: this };\r\n        }\r\n        if (name === \"_top\") {\r\n            this._subs[name] = { url: \"\", id: null, popup: true };\r\n            return this.getSubViewInfo(name);\r\n        }\r\n        // when called from a child view, searches for nearest parent with subview\r\n        if (this._parent) {\r\n            return this._parent.getSubViewInfo(name);\r\n        }\r\n        return null;\r\n    }\r\n    _detachEvents() {\r\n        const events = this._events;\r\n        for (let i = events.length - 1; i >= 0; i--) {\r\n            events[i].obj.detachEvent(events[i].id);\r\n        }\r\n    }\r\n    _destroySubs() {\r\n        // destroy sub views\r\n        for (const key in this._subs) {\r\n            const subView = this._subs[key].view;\r\n            // it possible that subview was not loaded with any content yet\r\n            // so check on null\r\n            if (subView) {\r\n                subView.destructor();\r\n            }\r\n        }\r\n        // reset to prevent memory leaks\r\n        this._subs = {};\r\n    }\r\n    _init_url_data() {\r\n        const url = this._segment.current();\r\n        this._data = {};\r\n        this.webix.extend(this._data, url.params, true);\r\n    }\r\n    _getDefaultSub() {\r\n        if (this._subs.default) {\r\n            return this._subs.default;\r\n        }\r\n        for (const key in this._subs) {\r\n            const sub = this._subs[key];\r\n            if (!sub.branch && sub.view && key !== \"_top\") {\r\n                const child = sub.view._getDefaultSub();\r\n                if (child) {\r\n                    return child;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    _routed_view() {\r\n        const parent = this.getParentView();\r\n        if (!parent) {\r\n            return true;\r\n        }\r\n        const sub = parent._getDefaultSub();\r\n        if (!sub && sub !== this) {\r\n            return false;\r\n        }\r\n        return parent._routed_view();\r\n    }\r\n}\n\nfunction parse(url) {\r\n    // remove starting /\r\n    if (url[0] === \"/\") {\r\n        url = url.substr(1);\r\n    }\r\n    // split url by \"/\"\r\n    const parts = url.split(\"/\");\r\n    const chunks = [];\r\n    // for each page in url\r\n    for (let i = 0; i < parts.length; i++) {\r\n        const test = parts[i];\r\n        const result = {};\r\n        // detect params\r\n        // support old \t\t\tsome:a=b:c=d\r\n        // and new notation\t\tsome?a=b&c=d\r\n        let pos = test.indexOf(\":\");\r\n        if (pos === -1) {\r\n            pos = test.indexOf(\"?\");\r\n        }\r\n        if (pos !== -1) {\r\n            const params = test.substr(pos + 1).split(/[\\:\\?\\&]/g);\r\n            // create hash of named params\r\n            for (const param of params) {\r\n                const dchunk = param.split(\"=\");\r\n                result[dchunk[0]] = decodeURIComponent(dchunk[1]);\r\n            }\r\n        }\r\n        // store parsed values\r\n        chunks[i] = {\r\n            page: (pos > -1 ? test.substr(0, pos) : test),\r\n            params: result,\r\n            isNew: true\r\n        };\r\n    }\r\n    // return array of page objects\r\n    return chunks;\r\n}\r\nfunction url2str(stack) {\r\n    const url = [];\r\n    for (const chunk of stack) {\r\n        url.push(\"/\" + chunk.page);\r\n        const params = obj2str(chunk.params);\r\n        if (params) {\r\n            url.push(\"?\" + params);\r\n        }\r\n    }\r\n    return url.join(\"\");\r\n}\r\nfunction obj2str(obj) {\r\n    const str = [];\r\n    for (const key in obj) {\r\n        if (typeof obj[key] === \"object\")\r\n            continue;\r\n        if (str.length) {\r\n            str.push(\"&\");\r\n        }\r\n        str.push(key + \"=\" + encodeURIComponent(obj[key]));\r\n    }\r\n    return str.join(\"\");\r\n}\n\nclass Route {\r\n    constructor(route, index) {\r\n        this._next = 1;\r\n        if (typeof route === \"string\") {\r\n            this.route = {\r\n                url: parse(route),\r\n                path: route\r\n            };\r\n        }\r\n        else {\r\n            this.route = route;\r\n        }\r\n        this.index = index;\r\n    }\r\n    current() {\r\n        return this.route.url[this.index];\r\n    }\r\n    next() {\r\n        return this.route.url[this.index + this._next];\r\n    }\r\n    suburl() {\r\n        return this.route.url.slice(this.index);\r\n    }\r\n    shift(params) {\r\n        const route = new Route(this.route, this.index + this._next);\r\n        route.setParams(route.route.url, params, route.index);\r\n        return route;\r\n    }\r\n    setParams(url, params, index) {\r\n        if (params) {\r\n            const old = url[index].params;\r\n            for (var key in params)\r\n                old[key] = params[key];\r\n        }\r\n    }\r\n    refresh() {\r\n        const url = this.route.url;\r\n        for (let i = this.index + 1; i < url.length; i++) {\r\n            url[i].isNew = true;\r\n        }\r\n    }\r\n    toString() {\r\n        const str = url2str(this.suburl());\r\n        return str ? str.substr(1) : \"\";\r\n    }\r\n    _join(path, kids) {\r\n        let url = this.route.url;\r\n        if (path === null) { // change of parameters, route elements are not affected\r\n            return url;\r\n        }\r\n        const old = this.route.url;\r\n        let reset = true;\r\n        url = old.slice(0, this.index + (kids ? this._next : 0));\r\n        if (path) {\r\n            url = url.concat(parse(path));\r\n            for (let i = 0; i < url.length; i++) {\r\n                if (old[i]) {\r\n                    url[i].view = old[i].view;\r\n                }\r\n                if (reset && old[i] && url[i].page === old[i].page) {\r\n                    url[i].isNew = false;\r\n                }\r\n                else if (url[i].isNew) {\r\n                    // if some segment was marked as new, all subsegments must be updated as well\r\n                    reset = false;\r\n                }\r\n            }\r\n        }\r\n        return url;\r\n    }\r\n    append(path) {\r\n        const url = this._join(path, true);\r\n        this.route.path = url2str(url);\r\n        this.route.url = url;\r\n        return this.route.path;\r\n    }\r\n    show(path, view, kids) {\r\n        const url = this._join(path.url, kids);\r\n        this.setParams(url, path.params, this.index + (kids ? this._next : 0));\r\n        return new Promise((res, rej) => {\r\n            const redirect = url2str(url);\r\n            const obj = {\r\n                url,\r\n                redirect,\r\n                confirm: Promise.resolve()\r\n            };\r\n            const app = view ? view.app : null;\r\n            // when creating a new route, it possible that it will not have any content\r\n            // guard is not necessary in such case\r\n            if (app) {\r\n                const result = app.callEvent(\"app:guard\", [obj.redirect, view, obj]);\r\n                if (!result) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n            }\r\n            obj.confirm.catch(err => rej(err)).then(() => {\r\n                if (obj.redirect === null) {\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                if (obj.redirect !== redirect) {\r\n                    app.show(obj.redirect);\r\n                    rej(new NavigationBlocked());\r\n                    return;\r\n                }\r\n                this.route.path = redirect;\r\n                this.route.url = url;\r\n                res();\r\n            });\r\n        });\r\n    }\r\n    size(n) {\r\n        this._next = n;\r\n    }\r\n    split() {\r\n        const route = {\r\n            url: this.route.url.slice(this.index + 1),\r\n            path: \"\"\r\n        };\r\n        if (route.url.length) {\r\n            route.path = url2str(route.url);\r\n        }\r\n        return new Route(route, 0);\r\n    }\r\n    update(name, value, index) {\r\n        const chunk = this.route.url[this.index + (index || 0)];\r\n        if (!chunk) {\r\n            this.route.url.push({ page: \"\", params: {} });\r\n            return this.update(name, value, index);\r\n        }\r\n        if (name === \"\") {\r\n            chunk.page = value;\r\n        }\r\n        else {\r\n            chunk.params[name] = value;\r\n        }\r\n        this.route.path = url2str(this.route.url);\r\n    }\r\n}\n\nclass JetView extends JetBase {\r\n    constructor(app, config) {\r\n        super(app.webix);\r\n        this.app = app;\r\n        //this.$config = config;\r\n        this._children = [];\r\n    }\r\n    ui(ui, config) {\r\n        config = config || {};\r\n        const container = config.container || ui.container;\r\n        const jetview = this.app.createView(ui);\r\n        this._children.push(jetview);\r\n        jetview.render(container, this._segment, this);\r\n        if (typeof ui !== \"object\" || (ui instanceof JetBase)) {\r\n            // raw webix UI\r\n            return jetview;\r\n        }\r\n        else {\r\n            return jetview.getRoot();\r\n        }\r\n    }\r\n    show(path, config) {\r\n        config = config || {};\r\n        // convert parameters object to url\r\n        if (typeof path === \"object\") {\r\n            for (const key in path) {\r\n                this.setParam(key, path[key]);\r\n            }\r\n            path = null;\r\n        }\r\n        else {\r\n            // deligate to app in case of root prefix\r\n            if (path.substr(0, 1) === \"/\") {\r\n                return this.app.show(path, config);\r\n            }\r\n            // local path, do nothing\r\n            if (path.indexOf(\"./\") === 0) {\r\n                path = path.substr(2);\r\n            }\r\n            // parent path, call parent view\r\n            if (path.indexOf(\"../\") === 0) {\r\n                const parent = this.getParentView();\r\n                if (parent) {\r\n                    return parent.show(path.substr(3), config);\r\n                }\r\n                else {\r\n                    return this.app.show(\"/\" + path.substr(3));\r\n                }\r\n            }\r\n            const sub = this.getSubViewInfo(config.target);\r\n            if (sub) {\r\n                if (sub.parent !== this) {\r\n                    return sub.parent.show(path, config);\r\n                }\r\n                else if (config.target && config.target !== \"default\") {\r\n                    return this._renderFrameLock(config.target, sub.subview, {\r\n                        url: path,\r\n                        params: config.params,\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                if (path) {\r\n                    return this.app.show(\"/\" + path, config);\r\n                }\r\n            }\r\n        }\r\n        return this._show(this._segment, { url: path, params: config.params }, this);\r\n    }\r\n    _show(segment, path, view) {\r\n        return segment.show(path, view, true).then(() => {\r\n            this._init_url_data();\r\n            return this._urlChange();\r\n        }).then(() => {\r\n            if (segment.route.linkRouter) {\r\n                this.app.getRouter().set(segment.route.path, { silent: true });\r\n                this.app.callEvent(\"app:route\", [segment.route.path]);\r\n            }\r\n        });\r\n    }\r\n    init(_$view, _$) {\r\n        // stub\r\n    }\r\n    ready(_$view, _$url) {\r\n        // stub\r\n    }\r\n    config() {\r\n        this.app.webix.message(\"View:Config is not implemented\");\r\n    }\r\n    urlChange(_$view, _$url) {\r\n        // stub\r\n    }\r\n    destroy() {\r\n        // stub\r\n    }\r\n    destructor() {\r\n        this.destroy();\r\n        this._destroyKids();\r\n        // destroy actual UI\r\n        if (this._root) {\r\n            this._root.destructor();\r\n            super.destructor();\r\n        }\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this.app, this, config);\r\n    }\r\n    refresh() {\r\n        const url = this.getUrl();\r\n        this.destroy();\r\n        this._destroyKids();\r\n        this._destroySubs();\r\n        this._detachEvents();\r\n        if (this._container.tagName) {\r\n            this._root.destructor();\r\n        }\r\n        this._segment.refresh();\r\n        return this._render(this._segment);\r\n    }\r\n    render(root, url, parent) {\r\n        if (typeof url === \"string\") {\r\n            url = new Route(url, 0);\r\n        }\r\n        this._segment = url;\r\n        this._parent = parent;\r\n        this._init_url_data();\r\n        root = root || document.body;\r\n        const _container = (typeof root === \"string\") ? this.webix.toNode(root) : root;\r\n        if (this._container !== _container) {\r\n            this._container = _container;\r\n            return this._render(url);\r\n        }\r\n        else {\r\n            return this._urlChange().then(() => this.getRoot());\r\n        }\r\n    }\r\n    _render(url) {\r\n        const config = this.config();\r\n        if (config.then) {\r\n            return config.then(cfg => this._render_final(cfg, url));\r\n        }\r\n        else {\r\n            return this._render_final(config, url);\r\n        }\r\n    }\r\n    _render_final(config, url) {\r\n        // get previous view in the same slot\r\n        let slot = null;\r\n        let container = null;\r\n        let show = false;\r\n        if (!this._container.tagName) {\r\n            slot = this._container;\r\n            if (slot.popup) {\r\n                container = document.body;\r\n                show = true;\r\n            }\r\n            else {\r\n                container = this.webix.$$(slot.id);\r\n            }\r\n        }\r\n        else {\r\n            container = this._container;\r\n        }\r\n        // view already destroyed\r\n        if (!this.app || !container) {\r\n            return Promise.reject(null);\r\n        }\r\n        let response;\r\n        const current = this._segment.current();\r\n        // using wrapper object, so ui can be changed from app:render event\r\n        const result = { ui: {} };\r\n        this.app.copyConfig(config, result.ui, this._subs);\r\n        this.app.callEvent(\"app:render\", [this, url, result]);\r\n        result.ui.$scope = this;\r\n        /* destroy old HTML attached views before creating new one */\r\n        if (!slot && current.isNew && current.view) {\r\n            current.view.destructor();\r\n        }\r\n        try {\r\n            // special handling for adding inside of multiview - preserve old id\r\n            if (slot && !show) {\r\n                const oldui = container;\r\n                const parent = oldui.getParentView();\r\n                if (parent && parent.name === \"multiview\" && !result.ui.id) {\r\n                    result.ui.id = oldui.config.id;\r\n                }\r\n            }\r\n            this._root = this.app.webix.ui(result.ui, container);\r\n            const asWin = this._root;\r\n            // check for url added to ignore this.ui calls\r\n            if (show && asWin.setPosition && !asWin.isVisible()) {\r\n                asWin.show();\r\n            }\r\n            // check, if we are replacing some older view\r\n            if (slot) {\r\n                if (slot.view && slot.view !== this && slot.view !== this.app) {\r\n                    slot.view.destructor();\r\n                }\r\n                slot.id = this._root.config.id;\r\n                if (this.getParentView() || !this.app.app)\r\n                    slot.view = this;\r\n                else {\r\n                    // when we have subapp, set whole app as a view\r\n                    // so on destruction, the whole app will be destroyed\r\n                    slot.view = this.app;\r\n                }\r\n            }\r\n            if (current.isNew) {\r\n                current.view = this;\r\n                current.isNew = false;\r\n            }\r\n            response = Promise.resolve(this._init(this._root, url)).then(() => {\r\n                return this._urlChange().then(() => {\r\n                    this._initUrl = null;\r\n                    return this.ready(this._root, url.suburl());\r\n                });\r\n            });\r\n        }\r\n        catch (e) {\r\n            response = Promise.reject(e);\r\n        }\r\n        return response.catch(err => this._initError(this, err));\r\n    }\r\n    _init(view, url) {\r\n        return this.init(view, url.suburl());\r\n    }\r\n    _urlChange() {\r\n        this.app.callEvent(\"app:urlchange\", [this, this._segment]);\r\n        const waits = [];\r\n        for (const key in this._subs) {\r\n            const frame = this._subs[key];\r\n            const wait = this._renderFrameLock(key, frame, null);\r\n            if (wait) {\r\n                waits.push(wait);\r\n            }\r\n        }\r\n        return Promise.all(waits).then(() => {\r\n            return this.urlChange(this._root, this._segment.suburl());\r\n        });\r\n    }\r\n    _renderFrameLock(key, frame, path) {\r\n        // if subview is not occupied by some rendering yet\r\n        if (!frame.lock) {\r\n            // retreive and store rendering end promise\r\n            const lock = this._renderFrame(key, frame, path);\r\n            if (lock) {\r\n                // clear lock after frame rendering\r\n                // as promise.finally is not supported by  Webix lesser than 6.2\r\n                // using a more verbose notation\r\n                frame.lock = lock.then(() => frame.lock = null, () => frame.lock = null);\r\n            }\r\n        }\r\n        // return rendering end promise\r\n        return frame.lock;\r\n    }\r\n    _renderFrame(key, frame, path) {\r\n        //default route\r\n        if (key === \"default\") {\r\n            if (this._segment.next()) {\r\n                // we have a next segment in url, render it\r\n                let params = path ? path.params : null;\r\n                if (frame.params) {\r\n                    params = this.webix.extend(params || {}, frame.params);\r\n                }\r\n                return this._createSubView(frame, this._segment.shift(params));\r\n            }\r\n            else if (frame.view && frame.popup) {\r\n                // there is no next segment, delete the existing sub-view\r\n                frame.view.destructor();\r\n                frame.view = null;\r\n            }\r\n        }\r\n        //if new path provided, set it to the frame\r\n        if (path !== null) {\r\n            frame.url = path.url;\r\n            if (frame.params) {\r\n                path.params = this.webix.extend(path.params || {}, frame.params);\r\n            }\r\n        }\r\n        // in case of routed sub-view\r\n        if (frame.route) {\r\n            // we have a new path for sub-view\r\n            if (path !== null) {\r\n                return frame.route.show(path, frame.view).then(() => {\r\n                    return this._createSubView(frame, frame.route);\r\n                });\r\n            }\r\n            // do not trigger onChange for isolated sub-views\r\n            if (frame.branch) {\r\n                return;\r\n            }\r\n        }\r\n        let view = frame.view;\r\n        // if view doesn't exists yet, init it\r\n        if (!view && frame.url) {\r\n            if (typeof frame.url === \"string\") {\r\n                // string, so we have isolated subview url\r\n                frame.route = new Route(frame.url, 0);\r\n                if (path)\r\n                    frame.route.setParams(frame.route.route.url, path.params, 0);\r\n                if (frame.params)\r\n                    frame.route.setParams(frame.route.route.url, frame.params, 0);\r\n                return this._createSubView(frame, frame.route);\r\n            }\r\n            else {\r\n                // object, so we have an embeded subview\r\n                if (typeof frame.url === \"function\" && !(view instanceof frame.url)) {\r\n                    view = new (this.app._override(frame.url))(this.app, \"\");\r\n                }\r\n                if (!view) {\r\n                    view = frame.url;\r\n                }\r\n            }\r\n        }\r\n        // trigger onChange for already existed view\r\n        if (view) {\r\n            return view.render(frame, (frame.route || this._segment), this);\r\n        }\r\n    }\r\n    _initError(view, err) {\r\n        /*\r\n            if view is destroyed, ignore any view related errors\r\n        */\r\n        if (this.app) {\r\n            this.app.error(\"app:error:initview\", [err, view]);\r\n        }\r\n        return true;\r\n    }\r\n    _createSubView(sub, suburl) {\r\n        return this.app.createFromURL(suburl.current()).then(view => {\r\n            return view.render(sub, suburl, this);\r\n        });\r\n    }\r\n    _destroyKids() {\r\n        // destroy child views\r\n        const uis = this._children;\r\n        for (let i = uis.length - 1; i >= 0; i--) {\r\n            if (uis[i] && uis[i].destructor) {\r\n                uis[i].destructor();\r\n            }\r\n        }\r\n        // reset vars for better GC processing\r\n        this._children = [];\r\n    }\r\n}\n\n// wrapper for raw objects and Jet 1.x structs\r\nclass JetViewRaw extends JetView {\r\n    constructor(app, config) {\r\n        super(app, config);\r\n        this._ui = config.ui;\r\n    }\r\n    config() {\r\n        return this._ui;\r\n    }\r\n}\n\nclass SubRouter {\r\n    constructor(cb, config, app) {\r\n        this.path = \"\";\r\n        this.app = app;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        const a = this.app;\r\n        a.app.getRouter().set(a._segment.append(this.path), { silent: true });\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nlet _once = true;\r\nclass JetAppBase extends JetBase {\r\n    constructor(config) {\r\n        const webix = (config || {}).webix || window.webix;\r\n        config = webix.extend({\r\n            name: \"App\",\r\n            version: \"1.0\",\r\n            start: \"/home\"\r\n        }, config, true);\r\n        super(webix, config);\r\n        this.config = config;\r\n        this.app = this.config.app;\r\n        this.ready = Promise.resolve();\r\n        this._services = {};\r\n        this.webix.extend(this, this.webix.EventSystem);\r\n    }\r\n    getUrl() {\r\n        return this._subSegment.suburl();\r\n    }\r\n    getUrlString() {\r\n        return this._subSegment.toString();\r\n    }\r\n    getService(name) {\r\n        let obj = this._services[name];\r\n        if (typeof obj === \"function\") {\r\n            obj = this._services[name] = obj(this);\r\n        }\r\n        return obj;\r\n    }\r\n    setService(name, handler) {\r\n        this._services[name] = handler;\r\n    }\r\n    destructor() {\r\n        this.getSubView().destructor();\r\n        super.destructor();\r\n    }\r\n    // copy object and collect extra handlers\r\n    copyConfig(obj, target, config) {\r\n        // raw ui config\r\n        if (obj instanceof JetBase ||\r\n            (typeof obj === \"function\" && obj.prototype instanceof JetBase)) {\r\n            obj = { $subview: obj };\r\n        }\r\n        // subview placeholder\r\n        if (typeof obj.$subview != \"undefined\") {\r\n            return this.addSubView(obj, target, config);\r\n        }\r\n        // process sub-properties\r\n        const isArray = obj instanceof Array;\r\n        target = target || (isArray ? [] : {});\r\n        for (const method in obj) {\r\n            let point = obj[method];\r\n            // view class\r\n            if (typeof point === \"function\" && point.prototype instanceof JetBase) {\r\n                point = { $subview: point };\r\n            }\r\n            if (point && typeof point === \"object\" &&\r\n                !(point instanceof this.webix.DataCollection) && !(point instanceof RegExp) && !(point instanceof Map)) {\r\n                if (point instanceof Date) {\r\n                    target[method] = new Date(point);\r\n                }\r\n                else {\r\n                    const copy = this.copyConfig(point, (point instanceof Array ? [] : {}), config);\r\n                    if (copy !== null) {\r\n                        if (isArray)\r\n                            target.push(copy);\r\n                        else\r\n                            target[method] = copy;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                target[method] = point;\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n    getRouter() {\r\n        return this.$router;\r\n    }\r\n    clickHandler(e, target) {\r\n        if (e) {\r\n            target = target || (e.target || e.srcElement);\r\n            if (target && target.getAttribute) {\r\n                const trigger = target.getAttribute(\"trigger\");\r\n                if (trigger) {\r\n                    this._forView(target, view => view.app.trigger(trigger));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n                const route = target.getAttribute(\"route\");\r\n                if (route) {\r\n                    this._forView(target, view => view.show(route));\r\n                    e.cancelBubble = true;\r\n                    return e.preventDefault();\r\n                }\r\n            }\r\n        }\r\n        const parent = target.parentNode;\r\n        if (parent) {\r\n            this.clickHandler(e, parent);\r\n        }\r\n    }\r\n    getRoot() {\r\n        return this.getSubView().getRoot();\r\n    }\r\n    refresh() {\r\n        if (!this._subSegment) {\r\n            return Promise.resolve(null);\r\n        }\r\n        return this.getSubView().refresh().then(view => {\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return view;\r\n        });\r\n    }\r\n    loadView(url) {\r\n        const views = this.config.views;\r\n        let result = null;\r\n        if (url === \"\") {\r\n            return Promise.resolve(this._loadError(\"\", new Error(\"Webix Jet: Empty url segment\")));\r\n        }\r\n        try {\r\n            if (views) {\r\n                if (typeof views === \"function\") {\r\n                    // custom loading strategy\r\n                    result = views(url);\r\n                }\r\n                else {\r\n                    // predefined hash\r\n                    result = views[url];\r\n                }\r\n                if (typeof result === \"string\") {\r\n                    url = result;\r\n                    result = null;\r\n                }\r\n            }\r\n            if (!result) {\r\n                if (url === \"_hidden\") {\r\n                    result = { hidden: true };\r\n                }\r\n                else if (url === \"_blank\") {\r\n                    result = {};\r\n                }\r\n                else {\r\n                    url = url.replace(/\\./g, \"/\");\r\n                    result = this.require(\"jet-views\", url);\r\n                }\r\n            }\r\n        }\r\n        catch (e) {\r\n            result = this._loadError(url, e);\r\n        }\r\n        // custom handler can return view or its promise\r\n        if (!result.then) {\r\n            result = Promise.resolve(result);\r\n        }\r\n        // set error handler\r\n        result = result\r\n            .then(module => module.__esModule ? module.default : module)\r\n            .catch(err => this._loadError(url, err));\r\n        return result;\r\n    }\r\n    _forView(target, handler) {\r\n        const view = this.webix.$$(target);\r\n        if (view) {\r\n            handler(view.$scope);\r\n        }\r\n    }\r\n    _loadViewDynamic(url) {\r\n        return null;\r\n    }\r\n    createFromURL(chunk) {\r\n        let view;\r\n        if (chunk.isNew || !chunk.view) {\r\n            view = this.loadView(chunk.page)\r\n                .then(ui => this.createView(ui, name, chunk.params));\r\n        }\r\n        else {\r\n            view = Promise.resolve(chunk.view);\r\n        }\r\n        return view;\r\n    }\r\n    _override(ui) {\r\n        const over = this.config.override;\r\n        if (over) {\r\n            let dv;\r\n            while (ui) {\r\n                dv = ui;\r\n                ui = over.get(ui);\r\n            }\r\n            return dv;\r\n        }\r\n        return ui;\r\n    }\r\n    createView(ui, name, params) {\r\n        ui = this._override(ui);\r\n        let obj;\r\n        if (typeof ui === \"function\") {\r\n            if (ui.prototype instanceof JetAppBase) {\r\n                // UI class\r\n                return new ui({ app: this, name, params, router: SubRouter });\r\n            }\r\n            else if (ui.prototype instanceof JetBase) {\r\n                // UI class\r\n                return new ui(this, { name, params });\r\n            }\r\n            else {\r\n                // UI factory functions\r\n                ui = ui(this);\r\n            }\r\n        }\r\n        if (ui instanceof JetBase) {\r\n            obj = ui;\r\n        }\r\n        else {\r\n            // UI object\r\n            obj = new JetViewRaw(this, { name, ui });\r\n        }\r\n        return obj;\r\n    }\r\n    // show view path\r\n    show(url, config) {\r\n        if (url && this.app && url.indexOf(\"//\") == 0)\r\n            return this.app.show(url.substr(1), config);\r\n        return this.render(this._container, url || this.config.start, config);\r\n    }\r\n    // event helpers\r\n    trigger(name, ...rest) {\r\n        this.apply(name, rest);\r\n    }\r\n    apply(name, data) {\r\n        this.callEvent(name, data);\r\n    }\r\n    action(name) {\r\n        return this.webix.bind(function (...rest) {\r\n            this.apply(name, rest);\r\n        }, this);\r\n    }\r\n    on(name, handler) {\r\n        this.attachEvent(name, handler);\r\n    }\r\n    use(plugin, config) {\r\n        plugin(this, null, config);\r\n    }\r\n    error(name, er) {\r\n        this.callEvent(name, er);\r\n        this.callEvent(\"app:error\", er);\r\n        /* tslint:disable */\r\n        if (this.config.debug) {\r\n            for (var i = 0; i < er.length; i++) {\r\n                console.error(er[i]);\r\n                if (er[i] instanceof Error) {\r\n                    let text = er[i].message;\r\n                    if (text.indexOf(\"Module build failed\") === 0) {\r\n                        text = text.replace(/\\x1b\\[[0-9;]*m/g, \"\");\r\n                        document.body.innerHTML = `<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>${text}</pre>`;\r\n                    }\r\n                    else {\r\n                        text += \"<br><br>Check console for more details\";\r\n                        this.webix.message({ type: \"error\", text: text, expire: -1 });\r\n                    }\r\n                }\r\n            }\r\n            debugger;\r\n        }\r\n        /* tslint:enable */\r\n    }\r\n    // renders top view\r\n    render(root, url, config) {\r\n        this._container = (typeof root === \"string\") ?\r\n            this.webix.toNode(root) :\r\n            (root || document.body);\r\n        const firstInit = !this.$router;\r\n        let path = null;\r\n        if (firstInit) {\r\n            if (_once && \"tagName\" in this._container) {\r\n                this.webix.event(document.body, \"click\", e => this.clickHandler(e));\r\n                _once = false;\r\n            }\r\n            if (typeof url === \"string\") {\r\n                url = new Route(url, 0);\r\n            }\r\n            this._subSegment = this._first_start(url);\r\n            this._subSegment.route.linkRouter = true;\r\n        }\r\n        else {\r\n            if (typeof url === \"string\") {\r\n                path = url;\r\n            }\r\n            else {\r\n                if (this.app) {\r\n                    path = url.split().route.path || this.config.start;\r\n                }\r\n                else {\r\n                    path = url.toString();\r\n                }\r\n            }\r\n        }\r\n        const params = config ? config.params : this.config.params || null;\r\n        const top = this.getSubView();\r\n        const segment = this._subSegment;\r\n        const ready = segment\r\n            .show({ url: path, params }, top)\r\n            .then(() => this.createFromURL(segment.current()))\r\n            .then(view => view.render(root, segment))\r\n            .then(base => {\r\n            this.$router.set(segment.route.path, { silent: true });\r\n            this.callEvent(\"app:route\", [this.getUrl()]);\r\n            return base;\r\n        });\r\n        this.ready = this.ready.then(() => ready);\r\n        return ready;\r\n    }\r\n    getSubView() {\r\n        if (this._subSegment) {\r\n            const view = this._subSegment.current().view;\r\n            if (view)\r\n                return view;\r\n        }\r\n        return new JetView(this, {});\r\n    }\r\n    require(type, url) { return null; }\r\n    _first_start(route) {\r\n        this._segment = route;\r\n        const cb = (a) => setTimeout(() => {\r\n            this.show(a).catch(e => {\r\n                if (!(e instanceof NavigationBlocked))\r\n                    throw e;\r\n            });\r\n        }, 1);\r\n        this.$router = new (this.config.router)(cb, this.config, this);\r\n        // start animation for top-level app\r\n        if (this._container === document.body && this.config.animation !== false) {\r\n            const node = this._container;\r\n            this.webix.html.addCss(node, \"webixappstart\");\r\n            setTimeout(() => {\r\n                this.webix.html.removeCss(node, \"webixappstart\");\r\n                this.webix.html.addCss(node, \"webixapp\");\r\n            }, 10);\r\n        }\r\n        if (!route) {\r\n            // if no url defined, check router first\r\n            let urlString = this.$router.get();\r\n            if (!urlString) {\r\n                urlString = this.config.start;\r\n                this.$router.set(urlString, { silent: true });\r\n            }\r\n            route = new Route(urlString, 0);\r\n        }\r\n        else if (this.app) {\r\n            const now = route.current().view;\r\n            route.current().view = this;\r\n            if (route.next()) {\r\n                route.refresh();\r\n                route = route.split();\r\n            }\r\n            else {\r\n                route = new Route(this.config.start, 0);\r\n            }\r\n            route.current().view = now;\r\n        }\r\n        return route;\r\n    }\r\n    // error during view resolving\r\n    _loadError(url, err) {\r\n        this.error(\"app:error:resolve\", [err, url]);\r\n        return { template: \" \" };\r\n    }\r\n    addSubView(obj, target, config) {\r\n        const url = obj.$subview !== true ? obj.$subview : null;\r\n        const name = obj.name || (url ? this.webix.uid() : \"default\");\r\n        target.id = obj.id || \"s\" + this.webix.uid();\r\n        const view = config[name] = {\r\n            id: target.id,\r\n            url,\r\n            branch: obj.branch,\r\n            popup: obj.popup,\r\n            params: obj.params\r\n        };\r\n        return view.popup ? null : target;\r\n    }\r\n}\n\nclass HashRouter {\r\n    constructor(cb, config) {\r\n        this.config = config || {};\r\n        this._detectPrefix();\r\n        this.cb = cb;\r\n        window.onpopstate = () => this.cb(this.get());\r\n    }\r\n    set(path, config) {\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            for (const key in this.config.routes) {\r\n                if (this.config.routes[key] === compare[0]) {\r\n                    path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (this.get() !== path) {\r\n            window.history.pushState(null, null, this.prefix + this.sufix + path);\r\n        }\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        let path = this._getRaw().replace(this.prefix, \"\").replace(this.sufix, \"\");\r\n        path = (path !== \"/\" && path !== \"#\") ? path : \"\";\r\n        if (this.config.routes) {\r\n            const compare = path.split(\"?\", 2);\r\n            const key = this.config.routes[compare[0]];\r\n            if (key) {\r\n                path = key + (compare.length > 1 ? \"?\" + compare[1] : \"\");\r\n            }\r\n        }\r\n        return path;\r\n    }\r\n    _detectPrefix() {\r\n        // use \"#!\" for backward compatibility\r\n        const sufix = this.config.routerPrefix;\r\n        this.sufix = \"#\" + ((typeof sufix === \"undefined\") ? \"!\" : sufix);\r\n        this.prefix = document.location.href.split(\"#\", 2)[0];\r\n    }\r\n    _getRaw() {\r\n        return document.location.href;\r\n    }\r\n}\n\nlet isPatched = false;\r\nfunction patch(w) {\r\n    if (isPatched || !w) {\r\n        return;\r\n    }\r\n    isPatched = true;\r\n    // custom promise for IE8\r\n    const win = window;\r\n    if (!win.Promise) {\r\n        win.Promise = w.promise;\r\n    }\r\n    const version = w.version.split(\".\");\r\n    // will be fixed in webix 5.3\r\n    if (version[0] * 10 + version[1] * 1 < 53) {\r\n        w.ui.freeze = function (handler) {\r\n            // disabled because webix jet 5.0 can't handle resize of scrollview correctly\r\n            // w.ui.$freeze = true;\r\n            const res = handler();\r\n            if (res && res.then) {\r\n                res.then(function (some) {\r\n                    w.ui.$freeze = false;\r\n                    w.ui.resize();\r\n                    return some;\r\n                });\r\n            }\r\n            else {\r\n                w.ui.$freeze = false;\r\n                w.ui.resize();\r\n            }\r\n            return res;\r\n        };\r\n    }\r\n    // adding views as classes\r\n    const baseAdd = w.ui.baselayout.prototype.addView;\r\n    const baseRemove = w.ui.baselayout.prototype.removeView;\r\n    const config = {\r\n        addView(view, index) {\r\n            // trigger logic only for widgets inside of jet-view\r\n            // ignore case when addView used with already initialized widget\r\n            if (this.$scope && this.$scope.webixJet && !view.queryView) {\r\n                const jview = this.$scope;\r\n                const subs = {};\r\n                view = jview.app.copyConfig(view, {}, subs);\r\n                baseAdd.apply(this, [view, index]);\r\n                for (const key in subs) {\r\n                    jview._renderFrame(key, subs[key], null).then(() => {\r\n                        jview._subs[key] = subs[key];\r\n                    });\r\n                }\r\n                return view.id;\r\n            }\r\n            else {\r\n                return baseAdd.apply(this, arguments);\r\n            }\r\n        },\r\n        removeView() {\r\n            baseRemove.apply(this, arguments);\r\n            if (this.$scope && this.$scope.webixJet) {\r\n                const subs = this.$scope._subs;\r\n                // check all sub-views, destroy and clean the removed one\r\n                for (const key in subs) {\r\n                    const test = subs[key];\r\n                    if (!w.$$(test.id)) {\r\n                        test.view.destructor();\r\n                        delete subs[key];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n    w.extend(w.ui.layout.prototype, config, true);\r\n    w.extend(w.ui.baselayout.prototype, config, true);\r\n    // wrapper for using Jet Apps as views\r\n    w.protoUI({\r\n        name: \"jetapp\",\r\n        $init(cfg) {\r\n            this.$app = new this.app(cfg);\r\n            const id = w.uid().toString();\r\n            cfg.body = { id };\r\n            this.$ready.push(function () {\r\n                this.callEvent(\"onInit\", [this.$app]);\r\n                this.$app.render({ id });\r\n            });\r\n        }\r\n    }, w.ui.proxy, w.EventSystem);\r\n}\n\nclass JetApp extends JetAppBase {\r\n    constructor(config) {\r\n        config.router = config.router || HashRouter;\r\n        super(config);\r\n        patch(this.webix);\r\n    }\r\n    require(type, url) {\r\n        return require(type + \"/\" + url);\r\n    }\r\n}\n\nclass StoreRouter {\r\n    constructor(cb, config, app) {\r\n        this.storage = config.storage || app.webix.storage.session;\r\n        this.name = (config.storeName || config.id + \":route\");\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.storage.put(this.name, path);\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.storage.get(this.name);\r\n    }\r\n}\n\nclass UrlRouter extends HashRouter {\r\n    _detectPrefix() {\r\n        this.prefix = \"\";\r\n        this.sufix = this.config.routerPrefix || \"\";\r\n    }\r\n    _getRaw() {\r\n        return document.location.pathname + (document.location.search || \"\");\r\n    }\r\n}\n\nclass EmptyRouter {\r\n    constructor(cb, _$config) {\r\n        this.path = \"\";\r\n        this.cb = cb;\r\n    }\r\n    set(path, config) {\r\n        this.path = path;\r\n        if (!config || !config.silent) {\r\n            setTimeout(() => this.cb(path), 1);\r\n        }\r\n    }\r\n    get() {\r\n        return this.path;\r\n    }\r\n}\n\nfunction UnloadGuard(app, view, config) {\r\n    view.on(app, `app:guard`, function (_$url, point, promise) {\r\n        if (point === view || point.contains(view)) {\r\n            const res = config();\r\n            if (res === false) {\r\n                promise.confirm = Promise.reject(new NavigationBlocked());\r\n            }\r\n            else {\r\n                promise.confirm = promise.confirm.then(() => res);\r\n            }\r\n        }\r\n    });\r\n}\n\n//     (c) 2012-2018 Airbnb, Inc.\n\n// var has = require('has');\nfunction has(store, key) {\n  return Object.prototype.hasOwnProperty.call(store, key);\n}\n// var forEach = require('for-each');\nfunction forEach(obj, handler, context) {\n  for (var key in obj) {\n    if (has(obj, key)) {\n      handler.call((context || obj), obj[key], key, obj);\n    }\n  }\n}\n// var trim = require('string.prototype.trim');\nfunction trim(str) {\n  return str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n}\n// var warning = require('warning');\nfunction warn(message) {\n  message = 'Warning: ' + message;\n  if (typeof console !== 'undefined') {\n    console.error(message);\n  }\n\n  try { throw new Error(message); } catch (x) {}\n}\n\nvar replace = String.prototype.replace;\nvar split = String.prototype.split;\n\n// #### Pluralization methods\n// The string that separates the different phrase possibilities.\nvar delimiter = '||||';\n\nvar russianPluralGroups = function (n) {\n  var end = n % 10;\n  if (n !== 11 && end === 1) {\n    return 0;\n  }\n  if (2 <= end && end <= 4 && !(n >= 12 && n <= 14)) {\n    return 1;\n  }\n  return 2;\n};\n\n// Mapping from pluralization group plural logic.\nvar pluralTypes = {\n  arabic: function (n) {\n    // http://www.arabeyes.org/Plural_Forms\n    if (n < 3) { return n; }\n    var lastTwo = n % 100;\n    if (lastTwo >= 3 && lastTwo <= 10) return 3;\n    return lastTwo >= 11 ? 4 : 5;\n  },\n  bosnian_serbian: russianPluralGroups,\n  chinese: function () { return 0; },\n  croatian: russianPluralGroups,\n  french: function (n) { return n > 1 ? 1 : 0; },\n  german: function (n) { return n !== 1 ? 1 : 0; },\n  russian: russianPluralGroups,\n  lithuanian: function (n) {\n    if (n % 10 === 1 && n % 100 !== 11) { return 0; }\n    return n % 10 >= 2 && n % 10 <= 9 && (n % 100 < 11 || n % 100 > 19) ? 1 : 2;\n  },\n  czech: function (n) {\n    if (n === 1) { return 0; }\n    return (n >= 2 && n <= 4) ? 1 : 2;\n  },\n  polish: function (n) {\n    if (n === 1) { return 0; }\n    var end = n % 10;\n    return 2 <= end && end <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n  },\n  icelandic: function (n) { return (n % 10 !== 1 || n % 100 === 11) ? 1 : 0; },\n  slovenian: function (n) {\n    var lastTwo = n % 100;\n    if (lastTwo === 1) {\n      return 0;\n    }\n    if (lastTwo === 2) {\n      return 1;\n    }\n    if (lastTwo === 3 || lastTwo === 4) {\n      return 2;\n    }\n    return 3;\n  }\n};\n\n\n// Mapping from pluralization group to individual language codes/locales.\n// Will look up based on exact match, if not found and it's a locale will parse the locale\n// for language code, and if that does not exist will default to 'en'\nvar pluralTypeToLanguages = {\n  arabic: ['ar'],\n  bosnian_serbian: ['bs-Latn-BA', 'bs-Cyrl-BA', 'srl-RS', 'sr-RS'],\n  chinese: ['id', 'id-ID', 'ja', 'ko', 'ko-KR', 'lo', 'ms', 'th', 'th-TH', 'zh'],\n  croatian: ['hr', 'hr-HR'],\n  german: ['fa', 'da', 'de', 'en', 'es', 'fi', 'el', 'he', 'hi-IN', 'hu', 'hu-HU', 'it', 'nl', 'no', 'pt', 'sv', 'tr'],\n  french: ['fr', 'tl', 'pt-br'],\n  russian: ['ru', 'ru-RU'],\n  lithuanian: ['lt'],\n  czech: ['cs', 'cs-CZ', 'sk'],\n  polish: ['pl'],\n  icelandic: ['is'],\n  slovenian: ['sl-SL']\n};\n\nfunction langToTypeMap(mapping) {\n  var ret = {};\n  forEach(mapping, function (langs, type) {\n    forEach(langs, function (lang) {\n      ret[lang] = type;\n    });\n  });\n  return ret;\n}\n\nfunction pluralTypeName(locale) {\n  var langToPluralType = langToTypeMap(pluralTypeToLanguages);\n  return langToPluralType[locale]\n    || langToPluralType[split.call(locale, /-/, 1)[0]]\n    || langToPluralType.en;\n}\n\nfunction pluralTypeIndex(locale, count) {\n  return pluralTypes[pluralTypeName(locale)](count);\n}\n\nfunction escape(token) {\n  return token.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n}\n\nfunction constructTokenRegex(opts) {\n  var prefix = (opts && opts.prefix) || '%{';\n  var suffix = (opts && opts.suffix) || '}';\n\n  if (prefix === delimiter || suffix === delimiter) {\n    throw new RangeError('\"' + delimiter + '\" token is reserved for pluralization');\n  }\n\n  return new RegExp(escape(prefix) + '(.*?)' + escape(suffix), 'g');\n}\n\nvar dollarRegex = /\\$/g;\nvar dollarBillsYall = '$$';\nvar defaultTokenRegex = /%\\{(.*?)\\}/g;\n\n// ### transformPhrase(phrase, substitutions, locale)\n//\n// Takes a phrase string and transforms it by choosing the correct\n// plural form and interpolating it.\n//\n//     transformPhrase('Hello, %{name}!', {name: 'Spike'});\n//     // \"Hello, Spike!\"\n//\n// The correct plural form is selected if substitutions.smart_count\n// is set. You can pass in a number instead of an Object as `substitutions`\n// as a shortcut for `smart_count`.\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 1}, 'en');\n//     // \"1 new message\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', {smart_count: 2}, 'en');\n//     // \"2 new messages\"\n//\n//     transformPhrase('%{smart_count} new messages |||| 1 new message', 5, 'en');\n//     // \"5 new messages\"\n//\n// You should pass in a third argument, the locale, to specify the correct plural type.\n// It defaults to `'en'` with 2 plural forms.\nfunction transformPhrase(phrase, substitutions, locale, tokenRegex) {\n  if (typeof phrase !== 'string') {\n    throw new TypeError('Polyglot.transformPhrase expects argument #1 to be string');\n  }\n\n  if (substitutions == null) {\n    return phrase;\n  }\n\n  var result = phrase;\n  var interpolationRegex = tokenRegex || defaultTokenRegex;\n\n  // allow number as a pluralization shortcut\n  var options = typeof substitutions === 'number' ? { smart_count: substitutions } : substitutions;\n\n  // Select plural form: based on a phrase text that contains `n`\n  // plural forms separated by `delimiter`, a `locale`, and a `substitutions.smart_count`,\n  // choose the correct plural form. This is only done if `count` is set.\n  if (options.smart_count != null && result) {\n    var texts = split.call(result, delimiter);\n    result = trim(texts[pluralTypeIndex(locale || 'en', options.smart_count)] || texts[0]);\n  }\n\n  // Interpolate: Creates a `RegExp` object for each interpolation placeholder.\n  result = replace.call(result, interpolationRegex, function (expression, argument) {\n    if (!has(options, argument) || options[argument] == null) { return expression; }\n    // Ensure replacement value is escaped to prevent special $-prefixed regex replace tokens.\n    return replace.call(options[argument], dollarRegex, dollarBillsYall);\n  });\n\n  return result;\n}\n\n// ### Polyglot class constructor\nfunction Polyglot(options) {\n  var opts = options || {};\n  this.phrases = {};\n  this.extend(opts.phrases || {});\n  this.currentLocale = opts.locale || 'en';\n  var allowMissing = opts.allowMissing ? transformPhrase : null;\n  this.onMissingKey = typeof opts.onMissingKey === 'function' ? opts.onMissingKey : allowMissing;\n  this.warn = opts.warn || warn;\n  this.tokenRegex = constructTokenRegex(opts.interpolation);\n}\n\n// ### polyglot.locale([locale])\n//\n// Get or set locale. Internally, Polyglot only uses locale for pluralization.\nPolyglot.prototype.locale = function (newLocale) {\n  if (newLocale) this.currentLocale = newLocale;\n  return this.currentLocale;\n};\n\n// ### polyglot.extend(phrases)\n//\n// Use `extend` to tell Polyglot how to translate a given key.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The key can be any string.  Feel free to call `extend` multiple times;\n// it will override any phrases with the same key, but leave existing phrases\n// untouched.\n//\n// It is also possible to pass nested phrase objects, which get flattened\n// into an object with the nested keys concatenated using dot notation.\n//\n//     polyglot.extend({\n//       \"nav\": {\n//         \"hello\": \"Hello\",\n//         \"hello_name\": \"Hello, %{name}\",\n//         \"sidebar\": {\n//           \"welcome\": \"Welcome\"\n//         }\n//       }\n//     });\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}',\n//     //   'nav.sidebar.welcome': 'Welcome'\n//     // }\n//\n// `extend` accepts an optional second argument, `prefix`, which can be used\n// to prefix every key in the phrases object with some string, using dot\n// notation.\n//\n//     polyglot.extend({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     }, \"nav\");\n//\n//     console.log(polyglot.phrases);\n//     // {\n//     //   'nav.hello': 'Hello',\n//     //   'nav.hello_name': 'Hello, %{name}'\n//     // }\n//\n// This feature is used internally to support nested phrase objects.\nPolyglot.prototype.extend = function (morePhrases, prefix) {\n  forEach(morePhrases, function (phrase, key) {\n    var prefixedKey = prefix ? prefix + '.' + key : key;\n    if (typeof phrase === 'object') {\n      this.extend(phrase, prefixedKey);\n    } else {\n      this.phrases[prefixedKey] = phrase;\n    }\n  }, this);\n};\n\n// ### polyglot.unset(phrases)\n// Use `unset` to selectively remove keys from a polyglot instance.\n//\n//     polyglot.unset(\"some_key\");\n//     polyglot.unset({\n//       \"hello\": \"Hello\",\n//       \"hello_name\": \"Hello, %{name}\"\n//     });\n//\n// The unset method can take either a string (for the key), or an object hash with\n// the keys that you would like to unset.\nPolyglot.prototype.unset = function (morePhrases, prefix) {\n  if (typeof morePhrases === 'string') {\n    delete this.phrases[morePhrases];\n  } else {\n    forEach(morePhrases, function (phrase, key) {\n      var prefixedKey = prefix ? prefix + '.' + key : key;\n      if (typeof phrase === 'object') {\n        this.unset(phrase, prefixedKey);\n      } else {\n        delete this.phrases[prefixedKey];\n      }\n    }, this);\n  }\n};\n\n// ### polyglot.clear()\n//\n// Clears all phrases. Useful for special cases, such as freeing\n// up memory if you have lots of phrases but no longer need to\n// perform any translation. Also used internally by `replace`.\nPolyglot.prototype.clear = function () {\n  this.phrases = {};\n};\n\n// ### polyglot.replace(phrases)\n//\n// Completely replace the existing phrases with a new set of phrases.\n// Normally, just use `extend` to add more phrases, but under certain\n// circumstances, you may want to make sure no old phrases are lying around.\nPolyglot.prototype.replace = function (newPhrases) {\n  this.clear();\n  this.extend(newPhrases);\n};\n\n\n// ### polyglot.t(key, options)\n//\n// The most-used method. Provide a key, and `t` will return the\n// phrase.\n//\n//     polyglot.t(\"hello\");\n//     => \"Hello\"\n//\n// The phrase value is provided first by a call to `polyglot.extend()` or\n// `polyglot.replace()`.\n//\n// Pass in an object as the second argument to perform interpolation.\n//\n//     polyglot.t(\"hello_name\", {name: \"Spike\"});\n//     => \"Hello, Spike\"\n//\n// If you like, you can provide a default value in case the phrase is missing.\n// Use the special option key \"_\" to specify a default.\n//\n//     polyglot.t(\"i_like_to_write_in_language\", {\n//       _: \"I like to write in %{language}.\",\n//       language: \"JavaScript\"\n//     });\n//     => \"I like to write in JavaScript.\"\n//\nPolyglot.prototype.t = function (key, options) {\n  var phrase, result;\n  var opts = options == null ? {} : options;\n  if (typeof this.phrases[key] === 'string') {\n    phrase = this.phrases[key];\n  } else if (typeof opts._ === 'string') {\n    phrase = opts._;\n  } else if (this.onMissingKey) {\n    var onMissingKey = this.onMissingKey;\n    result = onMissingKey(key, opts, this.currentLocale, this.tokenRegex);\n  } else {\n    this.warn('Missing translation for key: \"' + key + '\"');\n    result = key;\n  }\n  if (typeof phrase === 'string') {\n    result = transformPhrase(phrase, opts, this.currentLocale, this.tokenRegex);\n  }\n  return result;\n};\n\n\n// ### polyglot.has(key)\n//\n// Check if polyglot has a translation for given key\nPolyglot.prototype.has = function (key) {\n  return has(this.phrases, key);\n};\n\n// export transformPhrase\nPolyglot.transformPhrase = function transform(phrase, substitutions, locale) {\n  return transformPhrase(phrase, substitutions, locale);\n};\n\nvar webixPolyglot = Polyglot;\n\nfunction Locale(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let lang = storage ? (storage.get(\"lang\") || \"en\") : (config.lang || \"en\");\r\n    function setLangData(name, data, silent) {\r\n        if (data.__esModule) {\r\n            data = data.default;\r\n        }\r\n        const pconfig = { phrases: data };\r\n        if (config.polyglot) {\r\n            app.webix.extend(pconfig, config.polyglot);\r\n        }\r\n        const poly = service.polyglot = new webixPolyglot(pconfig);\r\n        poly.locale(name);\r\n        service._ = app.webix.bind(poly.t, poly);\r\n        lang = name;\r\n        if (storage) {\r\n            storage.put(\"lang\", lang);\r\n        }\r\n        if (config.webix) {\r\n            const locName = config.webix[name];\r\n            if (locName) {\r\n                app.webix.i18n.setLocale(locName);\r\n            }\r\n        }\r\n        if (!silent) {\r\n            return app.refresh();\r\n        }\r\n        return Promise.resolve();\r\n    }\r\n    function getLang() { return lang; }\r\n    function setLang(name, silent) {\r\n        // ignore setLang if loading by path is disabled\r\n        if (config.path === false) {\r\n            return;\r\n        }\r\n        const path = (config.path ? config.path + \"/\" : \"\") + name;\r\n        const data = app.require(\"jet-locales\", path);\r\n        setLangData(name, data, silent);\r\n    }\r\n    const service = {\r\n        getLang, setLang, setLangData, _: null, polyglot: null\r\n    };\r\n    app.setService(\"locale\", service);\r\n    setLang(lang, true);\r\n}\n\nfunction show(view, config, value) {\r\n    if (config.urls) {\r\n        value = config.urls[value] || value;\r\n    }\r\n    else if (config.param) {\r\n        value = { [config.param]: value };\r\n    }\r\n    view.show(value);\r\n}\r\nfunction Menu(app, view, config) {\r\n    const frame = view.getSubViewInfo().parent;\r\n    const ui = view.$$(config.id || config);\r\n    let silent = false;\r\n    ui.attachEvent(\"onchange\", function () {\r\n        if (!silent) {\r\n            show(frame, config, this.getValue());\r\n        }\r\n    });\r\n    ui.attachEvent(\"onafterselect\", function () {\r\n        if (!silent) {\r\n            let id = null;\r\n            if (ui.setValue) {\r\n                id = this.getValue();\r\n            }\r\n            else if (ui.getSelectedId) {\r\n                id = ui.getSelectedId();\r\n            }\r\n            show(frame, config, id);\r\n        }\r\n    });\r\n    view.on(app, `app:route`, function () {\r\n        let name = \"\";\r\n        if (config.param) {\r\n            name = view.getParam(config.param, true);\r\n        }\r\n        else {\r\n            const segment = frame.getUrl()[1];\r\n            if (segment) {\r\n                name = segment.page;\r\n            }\r\n        }\r\n        if (name) {\r\n            silent = true;\r\n            if (ui.setValue && ui.getValue() !== name) {\r\n                ui.setValue(name);\r\n            }\r\n            else if (ui.select && ui.exists(name) && ui.getSelectedId() !== name) {\r\n                ui.select(name);\r\n            }\r\n            silent = false;\r\n        }\r\n    });\r\n}\n\nconst baseicons = {\r\n    good: \"check\",\r\n    error: \"warning\",\r\n    saving: \"refresh fa-spin\"\r\n};\r\nconst basetext = {\r\n    good: \"Ok\",\r\n    error: \"Error\",\r\n    saving: \"Connecting...\"\r\n};\r\nfunction Status(app, view, config) {\r\n    let status = \"good\";\r\n    let count = 0;\r\n    let iserror = false;\r\n    let expireDelay = config.expire;\r\n    if (!expireDelay && expireDelay !== false) {\r\n        expireDelay = 2000;\r\n    }\r\n    const texts = config.texts || basetext;\r\n    const icons = config.icons || baseicons;\r\n    if (typeof config === \"string\") {\r\n        config = { target: config };\r\n    }\r\n    function refresh(content) {\r\n        const area = view.$$(config.target);\r\n        if (area) {\r\n            if (!content) {\r\n                content = \"<div class='status_\" +\r\n                    status +\r\n                    \"'><span class='webix_icon fa-\" +\r\n                    icons[status] + \"'></span> \" + texts[status] + \"</div>\";\r\n            }\r\n            area.setHTML(content);\r\n        }\r\n    }\r\n    function success() {\r\n        count--;\r\n        setStatus(\"good\");\r\n    }\r\n    function fail(err) {\r\n        count--;\r\n        setStatus(\"error\", err);\r\n    }\r\n    function start(promise) {\r\n        count++;\r\n        setStatus(\"saving\");\r\n        if (promise && promise.then) {\r\n            promise.then(success, fail);\r\n        }\r\n    }\r\n    function getStatus() {\r\n        return status;\r\n    }\r\n    function hideStatus() {\r\n        if (count === 0) {\r\n            refresh(\" \");\r\n        }\r\n    }\r\n    function setStatus(mode, err) {\r\n        if (count < 0) {\r\n            count = 0;\r\n        }\r\n        if (mode === \"saving\") {\r\n            status = \"saving\";\r\n            refresh();\r\n        }\r\n        else {\r\n            iserror = (mode === \"error\");\r\n            if (count === 0) {\r\n                status = iserror ? \"error\" : \"good\";\r\n                if (iserror) {\r\n                    app.error(\"app:error:server\", [err.responseText || err]);\r\n                }\r\n                else {\r\n                    if (expireDelay) {\r\n                        setTimeout(hideStatus, expireDelay);\r\n                    }\r\n                }\r\n                refresh();\r\n            }\r\n        }\r\n    }\r\n    function track(data) {\r\n        const dp = app.webix.dp(data);\r\n        if (dp) {\r\n            view.on(dp, \"onAfterDataSend\", start);\r\n            view.on(dp, \"onAfterSaveError\", (_id, _obj, response) => fail(response));\r\n            view.on(dp, \"onAfterSave\", success);\r\n        }\r\n    }\r\n    app.setService(\"status\", {\r\n        getStatus,\r\n        setStatus,\r\n        track\r\n    });\r\n    if (config.remote) {\r\n        view.on(app.webix, \"onRemoteCall\", start);\r\n    }\r\n    if (config.ajax) {\r\n        view.on(app.webix, \"onBeforeAjax\", (_mode, _url, _data, _request, _headers, _files, promise) => {\r\n            start(promise);\r\n        });\r\n    }\r\n    if (config.data) {\r\n        track(config.data);\r\n    }\r\n}\n\nfunction Theme(app, _view, config) {\r\n    config = config || {};\r\n    const storage = config.storage;\r\n    let theme = storage ?\r\n        (storage.get(\"theme\") || \"flat-default\")\r\n        :\r\n            (config.theme || \"flat-default\");\r\n    const service = {\r\n        getTheme() { return theme; },\r\n        setTheme(name, silent) {\r\n            const parts = name.split(\"-\");\r\n            const links = document.getElementsByTagName(\"link\");\r\n            for (let i = 0; i < links.length; i++) {\r\n                const lname = links[i].getAttribute(\"title\");\r\n                if (lname) {\r\n                    if (lname === name || lname === parts[0]) {\r\n                        links[i].disabled = false;\r\n                    }\r\n                    else {\r\n                        links[i].disabled = true;\r\n                    }\r\n                }\r\n            }\r\n            app.webix.skin.set(parts[0]);\r\n            // remove old css\r\n            app.webix.html.removeCss(document.body, \"theme-\" + theme);\r\n            // add new css\r\n            app.webix.html.addCss(document.body, \"theme-\" + name);\r\n            theme = name;\r\n            if (storage) {\r\n                storage.put(\"theme\", name);\r\n            }\r\n            if (!silent) {\r\n                app.refresh();\r\n            }\r\n        }\r\n    };\r\n    app.setService(\"theme\", service);\r\n    service.setTheme(theme, true);\r\n}\n\nfunction copyParams(data, url, route) {\r\n    for (let i = 0; i < route.length; i++) {\r\n        data[route[i]] = url[i + 1] ? url[i + 1].page : \"\";\r\n    }\r\n}\r\nfunction UrlParam(app, view, config) {\r\n    const route = config.route || config;\r\n    const data = {};\r\n    view.on(app, \"app:urlchange\", function (subview, segment) {\r\n        if (view === subview) {\r\n            copyParams(data, segment.suburl(), route);\r\n            segment.size(route.length + 1);\r\n        }\r\n    });\r\n    const os = view.setParam;\r\n    const og = view.getParam;\r\n    view.setParam = function (name, value, show) {\r\n        const index = route.indexOf(name);\r\n        if (index >= 0) {\r\n            data[name] = value;\r\n            this._segment.update(\"\", value, index + 1);\r\n            if (show) {\r\n                return view.show(null);\r\n            }\r\n        }\r\n        else {\r\n            return os.call(this, name, value, show);\r\n        }\r\n    };\r\n    view.getParam = function (key, mode) {\r\n        const val = data[key];\r\n        if (typeof val !== \"undefined\") {\r\n            return val;\r\n        }\r\n        return og.call(this, key, mode);\r\n    };\r\n    copyParams(data, view.getUrl(), route);\r\n}\n\nfunction User(app, _view, config) {\r\n    config = config || {};\r\n    const login = config.login || \"/login\";\r\n    const logout = config.logout || \"/logout\";\r\n    const afterLogin = config.afterLogin || app.config.start;\r\n    const afterLogout = config.afterLogout || \"/login\";\r\n    const ping = config.ping || 5 * 60 * 1000;\r\n    const model = config.model;\r\n    let user = config.user;\r\n    const service = {\r\n        getUser() {\r\n            return user;\r\n        },\r\n        getStatus(server) {\r\n            if (!server) {\r\n                return user !== null;\r\n            }\r\n            return model.status().catch(() => null).then(data => {\r\n                user = data;\r\n            });\r\n        },\r\n        login(name, pass) {\r\n            return model.login(name, pass).then(data => {\r\n                user = data;\r\n                if (!data) {\r\n                    throw new Error(\"Access denied\");\r\n                }\r\n                app.callEvent(\"app:user:login\", [user]);\r\n                app.show(afterLogin);\r\n            });\r\n        },\r\n        logout() {\r\n            user = null;\r\n            return model.logout().then(res => {\r\n                app.callEvent(\"app:user:logout\", []);\r\n                return res;\r\n            });\r\n        }\r\n    };\r\n    function canNavigate(url, obj) {\r\n        if (url === logout) {\r\n            service.logout();\r\n            obj.redirect = afterLogout;\r\n        }\r\n        else if (url !== login && !service.getStatus()) {\r\n            obj.redirect = login;\r\n        }\r\n    }\r\n    app.setService(\"user\", service);\r\n    app.attachEvent(`app:guard`, function (url, _$root, obj) {\r\n        if (config.public && config.public(url)) {\r\n            return true;\r\n        }\r\n        if (typeof user === \"undefined\") {\r\n            obj.confirm = service.getStatus(true).then(() => canNavigate(url, obj));\r\n        }\r\n        return canNavigate(url, obj);\r\n    });\r\n    if (ping) {\r\n        setInterval(() => service.getStatus(true), ping);\r\n    }\r\n}\n\n/*\r\nMIT License\r\nCopyright (c) 2019 XB Software\r\n*/\r\nlet webix = window.webix;\r\nif (webix) {\r\n    patch(webix);\r\n}\r\nconst plugins = {\r\n    UnloadGuard, Locale, Menu, Theme, User, Status, UrlParam\r\n};\r\nconst errors = { NavigationBlocked };\r\nconst w = window;\r\nif (!w.Promise) {\r\n    w.Promise = w.webix.promise;\r\n}\n\nexport { plugins, errors, JetApp, JetView, HashRouter, StoreRouter, UrlRouter, EmptyRouter, SubRouter };\n//# sourceMappingURL=jet.js.map\n","let once = false;\n\nexport function initRLayout(){\n    if (once) return;\n    once = true;\n\n    webix.protoUI(\n        {\n            name: \"r-layout\",\n            sizeTrigger(app, handler, value) {\n                this._compactValue = value;\n                this._compactHandler = handler;\n                this._app = app;\n\n                const config = app.config;\n                this._forceCompact = typeof config.params.forceCompact !== \"undefined\";\n                this._compactWidth = config.compactWidth;\n\n                if (!this._forceCompact) this._checkTrigger(this.$view.width, value);\n            },\n            _checkTrigger(x, value) {\n                if (this._compactWidth) {\n                    if (\n                        (x <= this._compactWidth && !value) ||\n                        (x > this._compactWidth && value)\n                    ) {\n                        this._compactWidth = null;\n                        this._compactHandler(!value);\n                        return false;\n                    }\n                }\n                return true;\n            },\n            $setSize(x, y) {\n                if (this._forceCompact || this._checkTrigger(x, this._compactValue))\n                    webix.ui.layout.prototype.$setSize.call(this, x, y);\n                if (this._app) this._app.callEvent(\"view:resize\", []); //edit popup resize\n            },\n        },\n        webix.ui.layout\n    );\n}\n","export function initJetWin(app) {\n\tlet appId;\n\n\tconst service = {\n\t\tupdateConfig(config){\n\t\t\tconst appView = app.getRoot();\n\t\t\tconst appNode = appView.$view;\n\n\t\t\tif(!appId){\n\t\t\t\tif(appNode.id)\n\t\t\t\t\tappId = appNode.id;\n\t\t\t\telse \n\t\t\t\t\tappNode.id = appId = \"webix_\" + webix.uid();\n\n\t\t\t\twebix.html.addStyle(`.webix_win_inside *:not(.webix_modal_box):not(.webix_modal_cover){ z-index: 0; }`);\n\t\t\t\twebix.html.addStyle(`#${appId}{ position: relative; }`);\n\t\t\t\twebix.html.addStyle(`#${appId} .webix_window{ z-index:2 !important; }`);\n\t\t\t\twebix.html.addStyle(`#${appId} .webix_disabled{ z-index:1 !important; }`);\n\t\t\t}\n\t\t\telse if(appId && !appNode.id) //app refresh\n\t\t\t\tappNode.id = appId;\n\n\t\t\tconfig.container = appId;\n\n\t\t\tif(config.fullscreen){\n\t\t\t\tconfig._fillApp = true;\n\t\t\t\tdelete config.fullscreen;\n\t\t\t}\n\n\t\t\tif(!config.on)\n\t\t\t\tconfig.on = {};\n\n\t\t\tlet firstShow = true;\n\t\t\tconst defaultHandler = config.on.onShow;\n\n\t\t\tconfig.on.onShow = function(){\n\t\t\t\tif(defaultHandler)\n\t\t\t\t\tdefaultHandler.apply(this, arguments);\n\n\t\t\t\tif(firstShow){\n\t\t\t\t\tthis.$setSize = (x, y) => {\n\t\t\t\t\t\tsetSize(this, appView, true);\n\t\t\t\t\t\twebix.ui.window.prototype.$setSize.apply(this, [x, y]);\n\t\t\t\t\t};\n\t\t\t\t\tsetHandlers(this, app);\n\t\t\t\t\tfirstShow = null;\n\t\t\t\t}\n\n\t\t\t\twebix.callEvent(\"onClick\", []);\n\t\t\t\twebix.html.addCss(appNode, \"webix_win_inside\");\n\t\t\t\tappView.disable();\n\n\t\t\t\tsetSize(this, appView);\n\t\t\t}\n\n\t\t\treturn config;\n\t\t}\n\t};\n\n\tapp.setService(\"jet-win\", service);\n}\n\nfunction setSize(win, appView, silent){\n\tconst appWidth = appView.$width;\n\tconst appHeight = appView.$height;\n\n\tif(win.config._fillApp)\n\t\twin.define({\n\t\t\twidth: appWidth,\n\t\t\theight: appHeight,\n\t\t});\n\telse {\n\t\twin.define({\n\t\t\tleft: (appWidth - win.$width) / 2,\n\t\t\ttop: (appHeight - win.$height) / 2,\n\t\t});\n\t}\n\n\tif(!silent)\n\t\twin.resize();\n}\n\nfunction setHandlers(win, app){\n\tconst appView = app.getRoot();\n\n\twin.attachEvent(\"onHide\", ()=> {\n\t\tif(!appView.$destructed){\n\t\t\twebix.html.removeCss(appView.$view, \"webix_win_inside\");\n\t\t\tappView.enable();\n\t\t}\n\t});\n\n\tconst resizeEv = app.attachEvent(\"view:resize\", ()=> {\n\t\tsetSize(win, appView);\n\t});\n\n\twin.attachEvent(\"onDestruct\", ()=> {\n\t\tapp.detachEvent(resizeEv);\n\t});\n}\n","var index = 1;\nfunction uid() {\n\treturn index++;\n}\n\nvar empty = undefined;\n\nexport function ignoreInitial(code) {\n\tlet init = false;\n\treturn function() {\n\t\tif (init) return code.apply(this, arguments);\n\t\telse init = true;\n\t};\n}\n\nvar context = null;\nexport function withContext(value, code) {\n\tcontext = value;\n\tcode();\n\tcontext = null;\n}\n\nexport function filter(rule, handler) {\n\treturn function(v, o, obj, meta) {\n\t\tif (rule(v, meta)) handler.apply(this, arguments);\n\t};\n}\n\nexport function link(source, target, key) {\n\tObject.defineProperty(target, key, {\n\t\tget: () => source[key],\n\t\tset: value => (source[key] = value),\n\t});\n}\n\nexport function debounce(handler, delay) {\n\tdelay = delay || 200;\n\tlet timer = null;\n\tlet data = null;\n\treturn function() {\n\t\tdata = arguments;\n\t\tif (!timer) {\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tclearTimeout(timer);\n\t\t\t\ttimer = null;\n\n\t\t\t\thandler.apply(this, data);\n\t\t\t}, delay);\n\t\t}\n\t};\n}\n\nexport function createState(data, config) {\n\tconfig = config || {};\n\tconst handlers = {};\n\tconst out = {};\n\n\tconst observe = function(mask, handler) {\n\t\tconst key = uid();\n\t\thandlers[key] = { mask, handler };\n\t\tif (mask === \"*\") handler(out, empty, mask);\n\t\telse handler(out[mask], empty, mask);\n\n\t\treturn key;\n\t};\n\n\tconst extend = function(data, sconfig){\n\t\tsconfig = sconfig || config;\n\t\t// normal js object\n\t\tfor (const key in data) {\n\t\t\tif (data.hasOwnProperty(key)) {\n\t\t\t\tconst test = data[key];\n\t\t\t\tif (sconfig.nested && typeof test === \"object\" && test) {\n\t\t\t\t\tout[key] = createState(test, sconfig);\n\t\t\t\t} else {\n\t\t\t\t\treactive(out, test, key, notify);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tconst observeEnd = function(id) {\n\t\tdelete handlers[id];\n\t};\n\n\tconst queue = [];\n\tlet waitInQueue = false;\n\n\tvar batch = function(code) {\n\t\tif (typeof code !== \"function\") {\n\t\t\tconst values = code;\n\t\t\tcode = () => {\n\t\t\t\tfor (const key in values) out[key] = values[key];\n\t\t\t};\n\t\t}\n\n\t\twaitInQueue = true;\n\t\tcode(out);\n\t\twaitInQueue = false;\n\t\twhile (queue.length) {\n\t\t\tconst obj = queue.shift();\n\t\t\tnotify.apply(this, obj);\n\t\t}\n\t};\n\n\tconst notify = function(key, old, value, meta) {\n\t\tif (waitInQueue) {\n\t\t\tqueue.push([key, old, value, meta]);\n\t\t\treturn;\n\t\t}\n\n\t\tconst list = Object.keys(handlers);\n\t\tfor (let i = 0; i < list.length; i++) {\n\t\t\tconst obj = handlers[list[i]];\n\t\t\tif (!obj) continue;\n\t\t\tif (obj.mask === \"*\" || obj.mask === key) {\n\t\t\t\tobj.handler(value, old, key, meta);\n\t\t\t}\n\t\t}\n\t};\n\n\tObject.defineProperty(out, \"$changes\", {\n\t\tvalue: {\n\t\t\tattachEvent: observe,\n\t\t\tdetachEvent: observeEnd,\n\t\t},\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$observe\", {\n\t\tvalue: observe,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$batch\", {\n\t\tvalue: batch,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(out, \"$extend\", {\n\t\tvalue: extend,\n\t\tenumerable: false,\n\t\tconfigurable: false,\n\t});\n\n\tout.$extend(data, config);\n\treturn out;\n}\n\nfunction reactive(obj, val, key, notify) {\n\tObject.defineProperty(obj, key, {\n\t\tget: function() {\n\t\t\treturn val;\n\t\t},\n\t\tset: function(value) {\n\t\t\tvar changed = false;\n\t\t\tif (val === null || value === null) {\n\t\t\t\tchanged = val !== value;\n\t\t\t} else {\n\t\t\t\tchanged = val.valueOf() != value.valueOf();\n\t\t\t}\n\n\t\t\tif (changed) {\n\t\t\t\tvar old = val;\n\t\t\t\tval = value;\n\t\t\t\tnotify(key, old, value, context);\n\t\t\t}\n\t\t},\n\t\tenumerable: true,\n\t\tconfigurable: false,\n\t});\n}","function updateDragPos(e, pos) {\n\tif (webix.DragControl.active) {\n\t\tconst node = webix.DragControl.getNode();\n\n\t\tpos = webix.copy(pos);\n\t\twebix.DragControl.$dragPos(pos, e);\n\n\t\tnode.style.top = pos.y + webix.DragControl.top + \"px\";\n\t\tnode.style.left = pos.x + webix.DragControl.left + \"px\";\n\t}\n}\n\nconst DragScroll = {\n\tstart(ctx, e) {\n\t\tctx._auto_scroll_delay = webix.delay(\n\t\t\tDragScroll.autoScroll,\n\t\t\tctx,\n\t\t\t[e, webix.html.pos(e)],\n\t\t\t250\n\t\t);\n\t},\n\n\treset(ctx) {\n\t\tif (ctx._auto_scroll_delay)\n\t\t\tctx._auto_scroll_delay = window.clearTimeout(ctx._auto_scroll_delay);\n\t},\n\n\tautoScroll(e, pos) {\n\t\tconst yScroll = this.direction.indexOf(\"y\") !== -1;\n\t\tconst xScroll = this.direction.indexOf(\"x\") !== -1;\n\t\tconst box = webix.html.offset(this.from.$view);\n\n\t\tlet reset = false;\n\t\tif (yScroll && DragScroll.autoYScroll.call(this, pos, box, this.senseY))\n\t\t\treset = true;\n\t\tif (xScroll && DragScroll.autoXScroll.call(this, pos, box, this.senseX))\n\t\t\treset = true;\n\n\t\tif (reset) {\n\t\t\tupdateDragPos(e, pos);\n\t\t\tthis._auto_scroll_delay = webix.delay(\n\t\t\t\tDragScroll.autoScroll,\n\t\t\t\tthis,\n\t\t\t\t[e, pos],\n\t\t\t\t100\n\t\t\t);\n\t\t}\n\t},\n\n\tautoYScroll(pos, box, sense) {\n\t\tconst scroll = this.from.getScrollState();\n\n\t\tif (pos.y < box.y + sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x,\n\t\t\t\tscroll.y - sense,\n\t\t\t\t\"y\"\n\t\t\t);\n\t\t} else if (pos.y > box.y + box.height - sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x,\n\t\t\t\tscroll.y + sense,\n\t\t\t\t\"y\"\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t},\n\n\tautoXScroll(pos, box, sense) {\n\t\tconst scroll = this.from.getScrollState();\n\n\t\tif (pos.x < box.x + sense) {\n\t\t\treturn DragScroll.autoScrollTo.call(\n\t\t\t\tthis,\n\t\t\t\tscroll.x - sense,\n\t\t\t\tscroll.y,\n\t\t\t\t\"x\"\n\t\t\t);\n\t\t} else if (pos.x > box.x + box.width - sense) {\n\t\t\tconst x = this.snode\n\t\t\t\t? Math.min(scroll.x + sense, this.snode.scrollWidth - box.width)\n\t\t\t\t: scroll.x + sense;\n\t\t\treturn x == scroll.x\n\t\t\t\t? false\n\t\t\t\t: DragScroll.autoScrollTo.call(this, x, scroll.y, \"x\");\n\t\t}\n\t\treturn false;\n\t},\n\n\tautoScrollTo(x, y, mode) {\n\t\tthis.from.scrollTo(x, y);\n\t\tthis.from.callEvent(\"onAfterAutoScroll\", []);\n\n\t\tconst scroll = this.from.getScrollState();\n\t\treturn Math.abs((mode === \"x\" ? x : y) - scroll[mode]) < 1;\n\t},\n};\n\nexport default DragScroll;\n","import DragScroll from \"./dragscroll\";\n\nexport function initDnD(view) {\n\tconst ctrl = webix.copy(DragControl);\n\n\tctrl.view = view;\n\tctrl.master = this;\n\n\tctrl.Local = this.app.getService(\"local\");\n\n\twebix.DragControl.addDrag(view.$view, ctrl);\n\twebix.DragControl.addDrop(view.$view, ctrl, true);\n}\n\nexport function switchCursor(e, view) {\n\tif (webix.DragControl.active) return;\n\n\tconst id = webix.html.locate(e, \"webix_l_id\");\n\tif (id && view.getItem(id).type == \"task\") {\n\t\tconst node = view.getItemNode(id);\n\t\tconst mode = getMoveMode(node, e.clientX);\n\t\tnode.style.cursor = mode == \"move\" ? \"pointer\" : \"ew-resize\";\n\t}\n}\n\nfunction getMoveMode(node, x) {\n\tconst rect = node.getBoundingClientRect();\n\tconst p = (x - rect.left) / rect.width;\n\tconst minWidth = webix.env.touch ? 400 : 200;\n\tconst delta = 0.2 / (rect.width > minWidth ? rect.width / minWidth : 1);\n\n\tif (p < delta) return \"start\";\n\tif (p > 1 - delta) return \"end\";\n\treturn \"move\";\n}\n\nfunction updateDragScrollConfig(ds) {\n\tconst scales = this.Local.getScales();\n\tds.senseX = Math.round(scales.cellWidth * (webix.env.touch ? 1 : 0.5));\n\tds.senseY = Math.round(scales.cellHeight * (webix.env.touch ? 3 : 1));\n\treturn ds;\n}\n\nfunction isProgressDrag(t, node) {\n\twhile (t != node) {\n\t\tif (t.classList.contains(\"webix_gantt_progress_drag\")) return true;\n\t\tt = t.parentNode;\n\t}\n\treturn false;\n}\n\nconst DragControl = {\n\t$longTouchLimit: true,\n\t$dragCreate: function(t, e, pointer) {\n\t\tif (this.master.State.readonly) return false;\n\n\t\tconst ctx = this.getContext();\n\t\tctx.$touch = pointer === \"touch\";\n\n\t\tconst id = this.locateEvent(e);\n\t\tif (id) {\n\t\t\tconst item = this.view.getItem(id);\n\t\t\tif (item.$group) return false;\n\n\t\t\tconst target = e.target;\n\n\t\t\tif (target.classList.contains(\"webix_gantt_link\")) {\n\t\t\t\tctx.mode = \"links\";\n\t\t\t\treturn Modes[ctx.mode].$dragCreate.call(this, t, e, id);\n\t\t\t}\n\n\t\t\tconst node = this.view.getItemNode(id);\n\t\t\tif (!ctx.$touch && isProgressDrag(target, node)) {\n\t\t\t\tctx.mode = \"progress\";\n\t\t\t\treturn Modes[ctx.mode].$dragCreate.call(this, t, e, id);\n\t\t\t}\n\n\t\t\tconst scroll = this.view.getScrollState();\n\t\t\tconst evContext = this.getEventContext(e, ctx);\n\n\t\t\tlet mode = getMoveMode(node, evContext.x);\n\t\t\tif (item.type != \"task\" && (mode == \"start\" || mode == \"end\"))\n\t\t\t\tmode = \"move\";\n\n\t\t\tconst scales = this.Local.getScales();\n\t\t\tlet step = scales.cellWidth;\n\t\t\tif (scales.precise) {\n\t\t\t\tconst nsc = this.master.app\n\t\t\t\t\t.getService(\"helpers\")\n\t\t\t\t\t.getSmallerCount(scales.minUnit);\n\t\t\t\tstep = Math.round(step / (typeof nsc === \"number\" ? nsc : nsc()));\n\t\t\t}\n\n\t\t\twebix.extend(\n\t\t\t\tctx,\n\t\t\t\t{\n\t\t\t\t\tid,\n\t\t\t\t\tmode,\n\t\t\t\t\tnode,\n\t\t\t\t\tstep,\n\t\t\t\t\tdx: 0,\n\t\t\t\t\tfrom: this.view,\n\t\t\t\t\tsnode: t.querySelector(\".webix_scroll_cont\"),\n\t\t\t\t\tx: evContext.x,\n\t\t\t\t\tscroll: scroll,\n\t\t\t\t\tt: parseInt(node.style.top),\n\t\t\t\t\tl: parseInt(node.style.left),\n\t\t\t\t\tw: parseInt(node.style.width),\n\t\t\t\t},\n\t\t\t\ttrue\n\t\t\t);\n\n\t\t\tif (!this.master.app.callEvent(\"bars:beforedrag\", [item, ctx]))\n\t\t\t\treturn false;\n\n\t\t\tif (Modes[ctx.mode].dragScroll)\n\t\t\t\twebix.extend(\n\t\t\t\t\tctx,\n\t\t\t\t\tupdateDragScrollConfig.call(this, Modes[ctx.mode].dragScroll)\n\t\t\t\t);\n\n\t\t\tconst html = node.cloneNode(true);\n\t\t\thtml.className += \" webix_drag_zone webix_gantt_mode_\" + mode;\n\n\t\t\tnode.style.visibility = \"hidden\";\n\t\t\twebix.html.addCss(t, \"webix_gantt_in_action\", true);\n\n\t\t\tt.style.cursor = mode == \"move\" ? \"move\" : \"ew-resize\";\n\t\t\tt.appendChild(html);\n\t\t\treturn html;\n\t\t} else if (\n\t\t\tthis.master.app.config.split &&\n\t\t\tthis.master.State.display !== \"resources\" &&\n\t\t\te.target == t\n\t\t) {\n\t\t\tctx.mode = \"split\";\n\t\t\treturn Modes[ctx.mode].$dragCreate.call(this, t, e);\n\t\t}\n\n\t\treturn false;\n\t},\n\t$dragDestroy: function(t, node) {\n\t\tconst ctx = this.getContext();\n\n\t\tif (Modes[ctx.mode].dragScroll) DragScroll.reset(ctx);\n\n\t\tif (ctx.mode && Modes[ctx.mode].$dragDestroy)\n\t\t\treturn Modes[ctx.mode].$dragDestroy.call(this, t, node);\n\n\t\tif (ctx.$waitUpdate) {\n\t\t\tctx.$waitUpdate.catch(() => {\n\t\t\t\tthis.master.Action({ action: \"update-task-time\", id: ctx.id });\n\t\t\t});\n\t\t} else\n\t\t\tctx.$waitUpdate = this.master.Action({\n\t\t\t\taction: \"update-task-time\",\n\t\t\t\tid: ctx.id,\n\t\t\t});\n\n\t\tctx.$waitUpdate.finally(() => {\n\t\t\tctx.node.style.visibility = \"\";\n\t\t\twebix.html.remove(node);\n\n\t\t\tif (this.master.app.config.split && ctx.id)\n\t\t\t\tthis.master.Action({\n\t\t\t\t\taction: \"split-resize\",\n\t\t\t\t\tid: ctx.id,\n\t\t\t\t});\n\t\t});\n\n\t\tt.style.cursor = \"\";\n\t\twebix.html.removeCss(t, \"webix_gantt_in_action\");\n\t\treturn false;\n\t},\n\t$dragIn: function(s, t, e) {\n\t\tconst ctx = this.getContext();\n\t\tif (!ctx.mode) return false;\n\n\t\tif (Modes[ctx.mode].dragScroll) {\n\t\t\tDragScroll.reset(ctx);\n\t\t\tDragScroll.start(ctx, e);\n\t\t}\n\n\t\tif (Modes[ctx.mode].$dragIn)\n\t\t\treturn Modes[ctx.mode].$dragIn.call(this, s, t, e);\n\t\treturn true;\n\t},\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\t\treturn Modes[ctx.mode].$dragPos.call(this, pos);\n\t},\n\t$dragOut: function(s, t, n, e) {\n\t\tconst ctx = this.getContext();\n\t\tif (Modes[ctx.mode].$dragOut)\n\t\t\treturn Modes[ctx.mode].$dragOut.call(this, s, t, n, e);\n\t\treturn null;\n\t},\n\t$drop: function(s, t, e) {\n\t\tconst ctx = this.getContext();\n\t\tif (!ctx.mode) return false;\n\n\t\tif (Modes[ctx.mode].$drop) return Modes[ctx.mode].$drop.call(this, s, t, e);\n\n\t\tconst { id, mode, dx, step } = ctx;\n\t\tconst time = Math.round(dx / step);\n\t\tctx.timeShift = time;\n\t\tif (\n\t\t\t!this.master.app.callEvent(\"bars:beforedrop\", [\n\t\t\t\tthis.view.getItem(ctx.id),\n\t\t\t\tctx,\n\t\t\t])\n\t\t)\n\t\t\treturn false;\n\n\t\tctx[\"$waitUpdate\"] = this.master.Action({\n\t\t\taction: \"update-task-time\",\n\t\t\tmode,\n\t\t\ttime,\n\t\t\tid,\n\t\t});\n\t},\n\tlocateEvent: function(ev, context) {\n\t\tif (context) {\n\t\t\tev = document.elementFromPoint(context.x, context.y);\n\t\t}\n\t\treturn webix.html.locate(ev, \"webix_l_id\");\n\t},\n\tgetEventContext: function(e, ctx) {\n\t\tif (ctx.$touch) {\n\t\t\tif (e.changedTouches && !(e.touches && e.touches[0])) {\n\t\t\t\tconst t = e.changedTouches[0];\n\t\t\t\treturn { x: t.pageX, y: t.pageY };\n\t\t\t}\n\t\t\treturn e.time ? e : webix.env.touch.context(e);\n\t\t}\n\t\treturn { x: e.clientX, y: e.clientY };\n\t},\n\tgetContext: function() {\n\t\treturn webix.DragControl.getContext();\n\t},\n\tsetDragOffset: function(node, target, e) {\n\t\tconst ctx = this.getContext();\n\t\tconst pos = webix.html.pos(e);\n\t\tconst offset = webix.html.offset(node);\n\n\t\tctx.width = offset.width;\n\t\tctx.height = offset.height;\n\t\tctx.x_offset = offset.x - pos.x;\n\t\tctx.y_offset = offset.y - pos.y;\n\t},\n};\n\nconst links = {\n\tdragScroll: {\n\t\tdirection: \"xy\",\n\t},\n\t$dragCreate: function(t, e, id) {\n\t\tconst ctx = this.getContext();\n\t\tconst link = e.target;\n\t\tconst node = this.view.getItemNode(id);\n\t\tconst scroll = this.view.getScrollState();\n\t\tconst offset = webix.html.offset(link);\n\t\tconst css = link.classList;\n\n\t\twebix.extend(\n\t\t\tctx,\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\tfrom: this.view,\n\t\t\t\tnode,\n\t\t\t\tlink,\n\t\t\t\tfromStart: css.contains(\"webix_gantt_link_left\"),\n\t\t\t\tstart: {\n\t\t\t\t\tx: offset.x + offset.width / 2 + scroll.x,\n\t\t\t\t\ty: offset.y + offset.height / 2 + scroll.y,\n\t\t\t\t},\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\tif (\n\t\t\t!this.master.app.callEvent(\"bars:beforedrag\", [\n\t\t\t\tthis.view.getItem(id),\n\t\t\t\tctx,\n\t\t\t])\n\t\t)\n\t\t\treturn false;\n\n\t\tif (Modes[ctx.mode].dragScroll)\n\t\t\twebix.extend(\n\t\t\t\tctx,\n\t\t\t\tupdateDragScrollConfig.call(this, Modes[ctx.mode].dragScroll)\n\t\t\t);\n\n\t\tlink.style.opacity = 1;\n\t\twebix.html.addCss(node, \"webix_gantt_task_in_action\", true);\n\n\t\tconst html = webix.html.create(\"div\", { visibility: \"hidden\" });\n\t\tdocument.body.appendChild(html);\n\t\treturn html;\n\t},\n\t$dragDestroy: function(t, node) {\n\t\tconst ctx = this.getContext();\n\n\t\tthis.master.Action({ action: \"temp-link\" });\n\n\t\tif (ctx.target) {\n\t\t\tconst node = this.view.getItemNode(ctx.target);\n\t\t\twebix.html.removeCss(node, \"webix_gantt_link_visible\");\n\t\t}\n\n\t\tctx.link.style.opacity = \"\";\n\t\twebix.html.removeCss(ctx.node, \"webix_gantt_task_in_action\");\n\t\twebix.html.remove(node);\n\n\t\treturn false;\n\t},\n\t$dragIn: function(s, t, e) {\n\t\tconst ctx = this.getContext();\n\t\tconst evContext = this.getEventContext(e, ctx);\n\t\tconst id = this.locateEvent(e, ctx.$touch ? evContext : null);\n\n\t\tif (!id) return false;\n\n\t\tconst node = this.view.getItemNode(id);\n\t\tif (id != ctx.target) {\n\t\t\twebix.html.addCss(node, \"webix_gantt_link_visible\", true);\n\t\t\tctx.target = id;\n\t\t}\n\t\treturn node;\n\t},\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\t\tconst nscroll = this.view.getScrollState();\n\n\t\tctx.end = {\n\t\t\tx: pos.x + nscroll.x,\n\t\t\ty: pos.y + nscroll.y,\n\t\t};\n\n\t\tthis.master.Action({ action: \"temp-link\", start: ctx.start, end: ctx.end });\n\t},\n\t$dragOut: function(s, t, n, e) {\n\t\tconst ctx = this.getContext();\n\t\tconst evContext = this.getEventContext(e, ctx);\n\t\tconst id = this.locateEvent(e, ctx.$touch ? evContext : null);\n\n\t\tif (ctx.target && id != ctx.target) {\n\t\t\tconst node = this.view.getItemNode(ctx.target);\n\t\t\twebix.html.removeCss(node, \"webix_gantt_link_visible\");\n\t\t\tctx.target = null;\n\t\t}\n\t\treturn null;\n\t},\n\t$drop: function(s, t, e) {\n\t\tconst ctx = this.getContext();\n\t\tconst source = ctx.id;\n\t\tconst evContext = this.getEventContext(e, ctx);\n\t\tconst target = this.locateEvent(e, ctx.$touch ? evContext : null);\n\n\t\tif (!target || source == target) return false;\n\n\t\tconst node = this.view.getItemNode(target);\n\t\tconst rect = node.getBoundingClientRect();\n\t\tconst toStart = evContext.x - rect.left < rect.width / 2;\n\n\t\tconst type = (ctx.linkType = (ctx.fromStart ? 1 : 0) + (toStart ? 0 : 2));\n\t\tctx.targetId = target;\n\t\tif (\n\t\t\tthis.master.app.callEvent(\"bars:beforedrop\", [\n\t\t\t\tthis.view.getItem(source),\n\t\t\t\tctx,\n\t\t\t])\n\t\t)\n\t\t\tthis.master.Action({ action: \"add-link\", source, target, type });\n\t},\n};\n\nconst resize = {\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\t\tconst nscroll = this.view.getScrollState();\n\t\tconst node = webix.DragControl.getNode();\n\t\tconst { mode, l, t, w, x, id, scroll, step } = ctx;\n\t\tconst dx = (ctx.dx = pos.x - x - scroll.x + nscroll.x);\n\n\t\tif (mode === \"start\") {\n\t\t\tpos.x = Math.min(l + dx, l + w - step);\n\t\t\tnode.style.width = `${Math.max(w - dx, step)}px`;\n\t\t} else if (mode === \"end\") {\n\t\t\tpos.x = l;\n\t\t\tnode.style.width = `${Math.max(w + dx, step)}px`;\n\t\t}\n\t\tpos.y = t;\n\n\t\tthis.master.Action({\n\t\t\taction: \"drag-task\",\n\t\t\tid,\n\t\t\tleft: pos.x,\n\t\t\twidth: parseInt(node.style.width),\n\t\t});\n\n\t\tif (this.master.app.config.split)\n\t\t\tthis.master.Action({\n\t\t\t\taction: \"split-resize\",\n\t\t\t\tid,\n\t\t\t});\n\t},\n};\n\nconst move = {\n\tdragScroll: {\n\t\tdirection: \"x\",\n\t},\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\t\tconst { node, l, t, x, id, scroll } = ctx;\n\t\tconst nscroll = this.view.getScrollState();\n\t\tconst dx = (ctx.dx = pos.x - x - scroll.x + nscroll.x);\n\n\t\tpos.x = l + dx;\n\t\tpos.y = t;\n\n\t\tthis.master.Action({\n\t\t\taction: \"drag-task\",\n\t\t\tid,\n\t\t\tleft: pos.x,\n\t\t\twidth: parseInt(node.style.width),\n\t\t});\n\n\t\tif (this.master.app.config.split)\n\t\t\tthis.master.Action({\n\t\t\t\taction: \"split-resize\",\n\t\t\t\tid,\n\t\t\t});\n\t},\n};\n\nconst progress = {\n\t$dragCreate: function(t, e, id) {\n\t\tconst ctx = this.getContext();\n\t\tconst node = this.view.getItemNode(id);\n\t\tconst prevProgress = this.view.getItem(id).progress;\n\t\tconst progressNode = node.querySelector(\".webix_gantt_progress\");\n\t\tconst evContext = this.getEventContext(e, ctx);\n\t\tconst scroll = this.view.getScrollState();\n\n\t\twebix.extend(\n\t\t\tctx,\n\t\t\t{\n\t\t\t\tid,\n\t\t\t\tnode,\n\t\t\t\tprevProgress,\n\t\t\t\tprogressNode,\n\t\t\t\tfrom: this.view,\n\t\t\t\tx: evContext.x,\n\t\t\t\tw: parseInt(node.style.width),\n\t\t\t\tscroll,\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\tif (\n\t\t\t!this.master.app.callEvent(\"bars:beforedrag\", [\n\t\t\t\tthis.view.getItem(id),\n\t\t\t\tctx,\n\t\t\t])\n\t\t)\n\t\t\treturn false;\n\n\t\tt.style.cursor = \"ew-resize\";\n\t\twebix.html.addCss(t, \"webix_gantt_in_action\", true);\n\t\twebix.html.addCss(node, \"webix_gantt_mode_progress\", true);\n\n\t\tconst html = webix.html.create(\"div\", { visibility: \"hidden\" });\n\t\tdocument.body.appendChild(html);\n\t\treturn html;\n\t},\n\t$dragPos: function(pos) {\n\t\tconst ctx = this.getContext();\n\t\tconst { x, scroll, w, node } = ctx;\n\t\tconst nscroll = this.view.getScrollState();\n\n\t\tconst dx = pos.x - x - scroll.x + nscroll.x;\n\t\tconst progress = Math.min(\n\t\t\tMath.max(ctx.prevProgress + Math.round((dx * 100) / w), 0),\n\t\t\t100\n\t\t);\n\n\t\tif (ctx.progress != progress) {\n\t\t\tctx.progress = progress;\n\t\t\tModes[ctx.mode].updateTaskTemplate.call(this, ctx, progress);\n\t\t}\n\n\t\tconst colors = { contrast: \"#393939\", dark: \"#20262B\" };\n\t\tnode.style.zIndex = \"3\";\n\t\tnode.style.boxShadow = `${\n\t\t\tcolors[webix.skin.$name || \"#ffffff\"]\n\t\t} -1px 0px 0px`;\n\t},\n\t$drop: function() {\n\t\tconst ctx = this.getContext();\n\t\tconst { id, progress, prevProgress } = ctx;\n\n\t\tif (\n\t\t\t!webix.isUndefined(progress) &&\n\t\t\tprogress != prevProgress &&\n\t\t\tthis.master.app.callEvent(\"bars:beforedrop\", [this.view.getItem(id), ctx])\n\t\t)\n\t\t\tctx[\"$waitUpdate\"] = this.master.Action({\n\t\t\t\taction: \"update-task-progress\",\n\t\t\t\tprogress,\n\t\t\t\tid,\n\t\t\t});\n\t},\n\t$dragDestroy: function(t, node) {\n\t\tconst ctx = this.getContext();\n\n\t\tif (ctx.$waitUpdate) {\n\t\t\tctx.$waitUpdate.catch(() => {\n\t\t\t\tthis.master.Action({ action: \"update-task-progress\", id: ctx.id });\n\t\t\t});\n\t\t} else\n\t\t\tctx.$waitUpdate = this.master.Action({\n\t\t\t\taction: \"update-task-progress\",\n\t\t\t\tid: ctx.id,\n\t\t\t});\n\n\t\tt.style.cursor = \"\";\n\t\twebix.html.removeCss(t, \"webix_gantt_in_action\");\n\t\twebix.html.removeCss(ctx.node, \"webix_gantt_mode_progress\");\n\n\t\twebix.html.remove(node);\n\t\treturn false;\n\t},\n\tupdateTaskTemplate(ctx, progress) {\n\t\tconst node = ctx.progressNode;\n\t\tnode.style.width = progress + \"%\";\n\t\tnode.innerHTML = this.master.DragProgressTemplate(progress);\n\t},\n};\n\nconst split = {\n\t$dragCreate: function(t, e) {\n\t\tconst selection = webix.html.create(\"DIV\", {\n\t\t\tclass: \"webix_gantt_split_selection\",\n\t\t});\n\n\t\tconst scales = this.Local.getScales();\n\t\tconst scroll = this.view.getScrollState();\n\n\t\tconst tb = e.target.getBoundingClientRect();\n\t\tconst index = Math.floor((e.y - tb.y + scroll.y) / scales.cellHeight);\n\t\tconst offsetX = e.x - tb.x;\n\n\t\tselection.style.top = index * scales.cellHeight + 6 + \"px\";\n\t\tselection.style.left = offsetX + scroll.x + \"px\";\n\t\tselection.style.height = scales.cellHeight - 14 + \"px\";\n\t\tselection.style.width = \"0px\";\n\n\t\tlet step = scales.cellWidth;\n\t\tif (scales.precise) {\n\t\t\tconst nsc = this.master.app\n\t\t\t\t.getService(\"helpers\")\n\t\t\t\t.getSmallerCount(scales.minUnit);\n\t\t\tstep = Math.round(step / (typeof nsc === \"number\" ? nsc : nsc()));\n\t\t}\n\n\t\tconst ctx = this.getContext();\n\t\twebix.extend(\n\t\t\tctx,\n\t\t\t{\n\t\t\t\tfrom: this.view,\n\t\t\t\tnode: selection,\n\t\t\t\tstart: { offsetX, clientX: e.clientX },\n\t\t\t\tindex,\n\t\t\t\tstep,\n\t\t\t\tscroll,\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\n\t\tt.appendChild(selection);\n\n\t\tconst html = webix.html.create(\"div\", { visibility: \"hidden\" });\n\t\tdocument.body.appendChild(html);\n\t\treturn html;\n\t},\n\t$dragPos(pos) {\n\t\tconst ctx = this.getContext();\n\t\tconst width = (ctx.dx = pos.x - ctx.start.clientX);\n\t\tif (pos.x < ctx.start.clientX) {\n\t\t\tctx.node.style.left = ctx.start.offsetX + ctx.scroll.x + width + \"px\";\n\t\t\tctx.node.style.width = -width + \"px\";\n\t\t} else {\n\t\t\tctx.node.style.left = ctx.start.offsetX + ctx.scroll.x + \"px\";\n\t\t\tctx.node.style.width = pos.x - ctx.start.clientX + \"px\";\n\t\t}\n\t},\n\t$drop() {\n\t\tconst ctx = this.getContext();\n\t\tconst id = this.view.getIdByIndex(ctx.index);\n\n\t\tlet start = Math.round((ctx.start.offsetX + ctx.scroll.x) / ctx.step);\n\t\tlet end = Math.round(ctx.dx / ctx.step);\n\t\tif (end < 0) {\n\t\t\tstart = start + end;\n\t\t\tend *= -1;\n\t\t}\n\n\t\tthis.master.Action({ action: \"add-task\", id, dates: { start, end } });\n\t},\n\t$dragDestroy(t, node) {\n\t\tconst ctx = this.getContext();\n\n\t\twebix.html.remove(node);\n\t\twebix.html.remove(ctx.node);\n\n\t\treturn false;\n\t},\n};\n\nconst Modes = {\n\tlinks,\n\tmove,\n\tprogress,\n\tstart: resize,\n\tend: resize,\n\tsplit,\n};\n","import { JetView } from \"webix-jet\";\nimport { initDnD, switchCursor } from \"../../helpers/dnd\";\n\nexport default class BarsView extends JetView {\n\tconfig() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\treturn {\n\t\t\tview: \"abslayout\",\n\t\t\tcss:\n\t\t\t\tthis.State.readonly || !this.app.config.links\n\t\t\t\t\t? \"webix_gantt_readonly\"\n\t\t\t\t\t: \"\",\n\t\t\tborderless: true,\n\t\t\tcells: [\n\t\t\t\t{\n\t\t\t\t\tview: \"template\",\n\t\t\t\t\tcss: \"webix_gantt_holidays\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\trelative: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"template\",\n\t\t\t\t\tcss: \"webix_gantt_links\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\trelative: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"list\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\ttype: this.BarsType(_),\n\t\t\t\t\tcss: `webix_gantt${webix.env.touch ? \"_touch\" : \"\"}_bars`,\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonItemClick: id => this.ItemClickHandler(id),\n\t\t\t\t\t},\n\t\t\t\t\ttooltip: obj => this.GetTooltip(obj, _),\n\t\t\t\t\tscroll: \"xy\",\n\t\t\t\t\trelative: true,\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tconst [holidays, links, bars] = view.getChildViews();\n\t\tthis.Holidays = holidays;\n\t\tthis.Links = links;\n\t\tthis.Bars = bars;\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tthis.Helpers = this.app.getService(\"helpers\");\n\n\t\tconst local = (this.Local = this.app.getService(\"local\"));\n\t\tconst scales = local.getScales();\n\t\tconst linkCollection = local.links();\n\t\tconst ldata = (this.LinksData = linkCollection.data);\n\t\tthis.Calendars = this.app.config.resourceCalendars;\n\n\t\tthis.HandleScroll();\n\t\tthis.HandleDrag(scales);\n\t\tthis.HandleSelection(scales);\n\t\tthis.InitMarkers();\n\t\tthis.HandleHolidays(scales);\n\n\t\tthis.on(this.State.$changes, \"display\", (v, old) => {\n\t\t\t// if the selected task type was changed, the form not closed and the display mode changed, we need to close the form and remove selection layer\n\t\t\tthis.SyncData(true);\n\t\t\tif (old) {\n\t\t\t\tthis.Local.refreshLinks();\n\t\t\t\tthis.RefreshLinks();\n\t\t\t\tif (this.Calendars) this.RenderResourceHolidays();\n\t\t\t}\n\t\t});\n\n\t\t// leave here for app.refresh() calls (inc. from Locale plugin)\n\t\tthis.DrawGrid(view, scales);\n\t\tif (this.Calendars) this.RenderResourceHolidays(scales);\n\n\t\tthis.on(this.app, \"onScalesUpdate\", scales => {\n\t\t\tthis.DrawGrid(view, scales);\n\t\t\tthis.Bars.refresh();\n\t\t\tthis.RefreshLinks();\n\t\t});\n\n\t\tthis.on(this.VisibleTasks.data, \"onStoreUpdated\", (id, data, action) => {\n\t\t\tthis.RefreshLinks();\n\t\t\tif (action !== \"update\") this.ApplySelection();\n\t\t\tif (!action && this.Calendars) this.RenderResourceHolidays();\n\t\t});\n\t\tthis.on(ldata, \"onStoreUpdated\", () => {\n\t\t\tthis.RefreshLinks();\n\t\t});\n\t\tthis.on(this.State.$changes, \"criticalPath\", (v, o) => {\n\t\t\tif (!webix.isUndefined(o)) {\n\t\t\t\tthis.Local.showCriticalPath(!v);\n\t\t\t\tthis.RefreshLinks();\n\t\t\t}\n\t\t});\n\t\tthis.on(this.State.$changes, \"compact\", () => {\n\t\t\tthis.RefreshLinks();\n\t\t});\n\t\tif (this.Calendars)\n\t\t\tthis.on(\n\t\t\t\tthis.Local.assignments().data,\n\t\t\t\t\"onStoreUpdated\",\n\t\t\t\t(id, data, action) => {\n\t\t\t\t\tthis.RenderResourceHolidays();\n\t\t\t\t\tif (this.app.config.excludeHolidays && action) {\n\t\t\t\t\t\tconst task = this.Local.tasks().getItem(data.task);\n\t\t\t\t\t\tif (task) this.Ops.updateAssignedTaskDates(task);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t);\n\t\tthis.on(this.State.$changes, \"baseline\", (v, o) => {\n\t\t\tif (!webix.isUndefined(o))\n\t\t\t\tthis.Local.updateScaleMinMax(this.VisibleTasks);\n\t\t});\n\t}\n\n\t/**\n\t * Sets action ot bar item click\n\t * @param {(string|number)} id  - ID of the clicked item\n\t */\n\tItemClickHandler(id) {\n\t\tif (!this.Bars.getItem(id).$group)\n\t\t\tthis.State.$batch({\n\t\t\t\tparent: null,\n\t\t\t\tselected: id,\n\t\t\t});\n\t}\n\n\t/**\n\t * Paints a grid\n\t * @param {view} Object - Webix view of bars chart\n\t * @param {scales} Object - scales object as returned by this.Local.getScales()\n\t */\n\tDrawGrid(view, scales) {\n\t\tconst colors = { contrast: \"#808080\", dark: \"#384047\" };\n\t\tview.$view.style.backgroundImage = `url(${this.app\n\t\t\t.getService(\"helpers\")\n\t\t\t.drawGridInner(\n\t\t\t\tscales.cellWidth,\n\t\t\t\tscales.cellHeight,\n\t\t\t\tcolors[webix.skin.$name] || \"#ccc\"\n\t\t\t)})`;\n\t\tview.$view.style.marginTop = \"0px\";\n\n\t\t// sync grid to scroll position\n\t\tconst state = this.app.getState();\n\t\tview.$view.style.backgroundPosition = `-${state.left}px -${state.top}px`;\n\n\t\tthis.Resize(scales.width);\n\t}\n\n\t/**\n\t * Loads data to the chart\n\t * @param {Boolean} unselect - passed on 'display' change; if the selected task is not found on chart and this param is true, State.selected will be nulled in ApplySelection\n\t */\n\tSyncData(unselect) {\n\t\tthis.Bars.clearAll();\n\t\tthis.VisibleTasks = this.Local.getVisibleTasksCollection();\n\t\tif (this.Calendars) {\n\t\t\tthis.Local.taskCalendarMap().then(() => {\n\t\t\t\tthis.Bars.sync(this.VisibleTasks);\n\t\t\t});\n\t\t} else this.Bars.sync(this.VisibleTasks);\n\t\tthis.ApplySelection(unselect);\n\t}\n\n\t/**\n\t * Returns a string with HTML of a task node content\n\t * @param {Object} obj - task data\n\t * @param {function} _ - the translator function of jet locale plugin, see https://webix.gitbook.io/webix-jet/part-ii-webix-jet-in-details/plugins#applying-the-locale\n\t * @returns {string}\n\t */\n\tBarsTemplate(obj, _) {\n\t\tconst text = obj.text || (obj.$group ? _(\"Unassigned\") : _(\"(no title)\"));\n\t\treturn obj.type == \"milestone\" ? `<span>${text}</span>` : text;\n\t}\n\n\t/**\n\t * Returns all templates for bars\n\t * @param {function} _ - the translator function of jet locale plugin, see https://webix.gitbook.io/webix-jet/part-ii-webix-jet-in-details/plugins#applying-the-locale\n\t * @returns {Object} all templates for bars\n\t */\n\tBarsType(_) {\n\t\treturn {\n\t\t\ttemplate: obj => {\n\t\t\t\tif (\n\t\t\t\t\tthis.State.display === \"tasks\" &&\n\t\t\t\t\tobj.type === \"split\" &&\n\t\t\t\t\tobj.$data &&\n\t\t\t\t\tobj.$data.length\n\t\t\t\t) {\n\t\t\t\t\tconst { height, width, left, top } = this.GetSplitBox(obj);\n\t\t\t\t\tlet html = `<div class=\"webix_gantt_split_container\" webix_s_id=\"${obj.id}\" style=\"top:${top}px;left:${left}px;height:${height}px;width:${width}px;\"></div>`;\n\n\t\t\t\t\t// split kids are not in the order\n\t\t\t\t\tconst order = this.VisibleTasks.data.order;\n\t\t\t\t\tconst isLast = order.length > 1 && obj.id == order[order.length - 1];\n\t\t\t\t\tobj.$data.forEach(kid => {\n\t\t\t\t\t\thtml +=\n\t\t\t\t\t\t\tthis.TemplateStart(kid, isLast, true) +\n\t\t\t\t\t\t\tthis.BarsTemplate(kid, _) +\n\t\t\t\t\t\t\tthis.TemplateEnd(kid);\n\t\t\t\t\t});\n\t\t\t\t\treturn html;\n\t\t\t\t} else return this.BarsTemplate(obj, _);\n\t\t\t},\n\t\t\ttemplateStart: task => {\n\t\t\t\tif (\n\t\t\t\t\tthis.State.display === \"tasks\" &&\n\t\t\t\t\ttask.type === \"split\" &&\n\t\t\t\t\ttask.$data &&\n\t\t\t\t\ttask.$data.length\n\t\t\t\t)\n\t\t\t\t\treturn \"\";\n\t\t\t\tconst order = this.VisibleTasks.data.order;\n\t\t\t\tconst isLast = order.length > 1 && task.id == order[order.length - 1];\n\t\t\t\treturn this.TemplateStart(task, isLast);\n\t\t\t},\n\t\t\ttemplateEnd: task => {\n\t\t\t\tif (\n\t\t\t\t\tthis.State.display === \"tasks\" &&\n\t\t\t\t\ttask.type === \"split\" &&\n\t\t\t\t\ttask.$data &&\n\t\t\t\t\ttask.$data.length\n\t\t\t\t)\n\t\t\t\t\treturn \"\";\n\t\t\t\treturn this.TemplateEnd();\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Gets the size and position parameters for a decorative div-element behind a split task\n\t * @param {Object} obj - data of a split task\n\t * @returns {Object} an object with top, left, height, and width of an element\n\t */\n\tGetSplitBox(obj) {\n\t\tconst last = obj.$data[0];\n\t\tconst first = obj.$data[obj.$data.length - 1];\n\t\tconst left =\n\t\t\tfirst.$x + (first.type == \"milestone\" ? Math.floor(first.$w / 2) : 0);\n\t\tconst rwidth = last.type == \"milestone\" ? Math.floor(last.$w / 2) : last.$w;\n\n\t\treturn {\n\t\t\ttop: last.$y,\n\t\t\tleft,\n\t\t\theight: last.$h,\n\t\t\twidth: last.$x - left + rwidth,\n\t\t};\n\t}\n\n\t/**\n\t * Returns the html for the first part of a task\n\t * @param {Object} task - a task data object\n\t * @param {Boolean} last - a flag that indicates that this task is in the last line of gantt\n\t * @param {Boolean} split - a flag that indicates that this task is a child of a parent with \"split\" type\n\t * @returns {string} HTML that defines how a task is displayed\n\t */\n\tTemplateStart(task, last, split) {\n\t\tlet w = task.$w,\n\t\t\th = task.$h,\n\t\t\tdiff = 0,\n\t\t\tprogress = \"\";\n\t\tconst css = this.BarCSS(task, last);\n\t\tconst contentCss = this.ContentCss(task);\n\t\tif (task.type == \"milestone\") {\n\t\t\tw = h = Math.ceil(Math.sqrt(Math.pow(task.$w, 2) / 2));\n\t\t\tdiff = Math.ceil((task.$w - w) / 2);\n\t\t} else {\n\t\t\tconst drag =\n\t\t\t\ttask.type == \"task\" ? this.DragProgressTemplate(task.progress) : \"\";\n\t\t\tprogress = `<div class=\"webix_gantt_progress\" style=\"width:${task.progress}%;\">${drag}</div>`;\n\t\t}\n\n\t\tlet baseline = \"\";\n\t\tif (\n\t\t\tthis.State.baseline &&\n\t\t\ttask.type !== \"milestone\" &&\n\t\t\ttask.planned_start &&\n\t\t\t!split\n\t\t)\n\t\t\tbaseline = this.TemplateBaseline(task);\n\n\t\treturn (\n\t\t\tbaseline +\n\t\t\t`<div webix_l_id=\"${task.id}\" class=\"${css}\" \n\t\t\tstyle=\"left:${task.$x + diff}px;top:${task.$y +\n\t\t\t\tdiff -\n\t\t\t\t(baseline ? 1 : 0)}px;width:${w}px;height:${h}px;\" \n\t\t\tdata-id=\"${task.id}\">\n\t\t\t\t<div class=\"webix_gantt_link webix_gantt_link_left\"></div>\n\t\t\t\t${progress}\n\t\t\t\t<div class=\"webix_gantt_content ${contentCss}\">`\n\t\t);\n\t}\n\n\tTemplateBaseline(t) {\n\t\treturn `<div  \n\t\t\tclass=\"webix_gantt_baseline_${t.type}\" \n\t\t\tstyle=\"left:${t.$x0}px;top:${t.$y + t.$h - 2}px;width:${t.$w0}px; \" \n\t\t\tdata-baseid=\"${t.id}\"></div>`;\n\t}\n\n\t/**\n\t * Get task classname\n\t * @param {Object} task - a task data object\n\t * @param {Boolean} last - a flag that indicates that this task is in the last line of gantt\n\t * @returns {string} a classname\n\t */\n\tBarCSS(task, last) {\n\t\tlet css = `webix_gantt_task_base webix_gantt_${\n\t\t\ttask.type === \"split\" ? \"task\" : task.type\n\t\t}`;\n\t\tif (task.$critical) css += \" webix_gantt_critical\";\n\t\tif (task.$group) css += \" webix_gantt_group\";\n\t\tif (last) css += \" webix_gantt_last\";\n\t\tif (task.css && task.type != \"milestone\") css += \" \" + task.css;\n\t\treturn css;\n\t}\n\tContentCss(task) {\n\t\treturn task.css && task.type == \"milestone\" ? \" \" + task.css : \"\";\n\t}\n\t/**\n\t * Returns the html for the last part of a task\n\t * @returns {string} HTML that defines how a task is displayed\n\t */\n\tTemplateEnd() {\n\t\treturn `</div><div class=\"webix_gantt_link webix_gantt_link_right\"></div></div>`;\n\t}\n\n\t/**\n\t * Returns a string with HTML of the progress drag marker\n\t * @param {number} progress - the progress of a task (number from 0 to 100)\n\t * @returns {string}\n\t */\n\tDragProgressTemplate(progress) {\n\t\treturn `<div class=\"webix_gantt_progress_drag\" style=\"left:${progress}%\">\n\t\t\t<span class=\"webix_gantt_progress_percent\">${progress}</span>\n\t\t</div>`;\n\t}\n\n\t/**\n\t * Extends the class with methods for DnD and handles cursor change for bars\n\t */\n\tHandleDrag() {\n\t\tinitDnD.call(this, this.Bars);\n\n\t\tthis._mousemove_handler = webix.event(this.Bars.$view, \"pointermove\", e => {\n\t\t\tif (e.pointerType == \"mouse\") switchCursor(e, this.Bars);\n\t\t});\n\t}\n\n\tdestroy() {\n\t\tthis._mousemove_handler = webix.eventRemove(this._mousemove_handler);\n\t\tthis._scroll_handler = webix.eventRemove(this._scroll_handler);\n\n\t\tconst markers = this.app.config.markers;\n\t\tif (markers)\n\t\t\tfor (let i = 0; i < markers.length; i++) {\n\t\t\t\tconst m = markers[i];\n\t\t\t\tif (m.$interval) m.$interval = clearInterval(m.$interval);\n\t\t\t}\n\t}\n\n\t/**\n\t * Finds and returns the SVG element with all links or the temp link that is rendered while the user is linking two tasks\n\t * @param {Boolean} temp - if true, the method looks for the temp link\n\t * @returns {SVGElement}\n\t */\n\tGetLinks(temp) {\n\t\treturn this.Links.$view.querySelector(\n\t\t\t`.webix_gantt_${temp ? \"temp_line\" : \"lines\"}`\n\t\t);\n\t}\n\n\t/**\n\t * Handles scrolling\n\t */\n\tHandleScroll() {\n\t\tthis._scroll_handler = webix.event(this.Bars.$view, \"scroll\", ev => {\n\t\t\tconst bars = ev.target;\n\t\t\tconst top = Math.round(bars.scrollTop);\n\t\t\tconst left = Math.round(bars.scrollLeft);\n\n\t\t\tthis.holidaysContainer.style.height = 0 + \"px\";\n\t\t\tthis.containerForMarkers.style.height = 0 + \"px\";\n\n\t\t\tif (this.app.config.links) {\n\t\t\t\tconst lines = this.GetLinks();\n\t\t\t\tconst temp = this.GetLinks(true);\n\t\t\t\tconst attrs = {\n\t\t\t\t\tviewBox: `${left} ${top} ${bars.scrollWidth} ${bars.scrollHeight}`,\n\t\t\t\t\twidth: bars.scrollWidth,\n\t\t\t\t\theight: bars.scrollHeight,\n\t\t\t\t};\n\n\t\t\t\tfor (let key in attrs) {\n\t\t\t\t\tlines.setAttribute(key, attrs[key]);\n\t\t\t\t\ttemp.setAttribute(key, attrs[key]);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.SetHolidaysScroll(bars.scrollHeight, left, top);\n\n\t\t\tthis.containerForMarkers.style.height = bars.scrollHeight + \"px\";\n\n\t\t\tthis.getRoot().$view.style.backgroundPosition = `-${left}px -${top}px`;\n\t\t\tthis.State.$batch({ top, left });\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"top\", y => {\n\t\t\tthis.Bars.scrollTo(this.State.left, y);\n\t\t});\n\n\t\tif (this.app.config.resources) {\n\t\t\tthis.on(this.State.$changes, \"left\", v => {\n\t\t\t\tif (this.State.resourcesDiagram) this.Bars.scrollTo(v, this.State.top);\n\t\t\t});\n\n\t\t\tthis.on(this.app, \"rdiagram:resize\", () => {\n\t\t\t\tthis.holidaysContainer.style.height =\n\t\t\t\t\tthis.Bars.$view.scrollHeight + \"px\";\n\t\t\t\tthis.containerForMarkers.style.height =\n\t\t\t\t\tthis.Bars.$view.scrollHeight + \"px\";\n\t\t\t});\n\t\t}\n\t}\n\n\tSetHolidaysScroll(height, x, y) {\n\t\tthis.holidaysContainer.style.height = height + \"px\";\n\t\tthis.holidaysContainer.style.left = -x + \"px\";\n\t\tthis.holidaysContainer.style.top = -y + \"px\";\n\t\tif (this.Calendars) {\n\t\t\tthis.resHolidaysContainer.style.height = height + \"px\";\n\t\t\tthis.resHolidaysContainer.style.left = -x + \"px\";\n\t\t\tthis.resHolidaysContainer.style.top = -y + \"px\";\n\t\t}\n\t}\n\n\t/**\n\t * Handles selection\n\t * @param {Object} scales - the current scales\n\t */\n\tHandleSelection(scales) {\n\t\tthis.selLine = webix.html.create(\"DIV\", {\n\t\t\tclass: \"webix_gantt_bar_selection\",\n\t\t\tstyle: `height:${scales.cellHeight}px;width:${scales.width}px`,\n\t\t});\n\t\tthis.Bars.$view.insertBefore(this.selLine, this.Bars.$view.firstChild);\n\n\t\tthis.on(this.State.$changes, \"selected\", () => this.ApplySelection());\n\t}\n\n\t/**\n\t * Highlights the selected task\n\t * @param {Boolean} unselect - passed by SyncData call on 'display' change; if the selected task is not found in current collection and this param is true, State.selected will be nulled\n\t */\n\tApplySelection(unselect) {\n\t\tconst id = this.State.selected;\n\t\tlet top = -100;\n\t\tif (id && this.Bars.data.order.length) {\n\t\t\tlet ind = (top = this.Bars.getIndexById(id));\n\t\t\tconst task = this.Bars.getItem(id);\n\t\t\tif (ind < 0) {\n\t\t\t\t// split subtasks will not be found in datastore order\n\t\t\t\tif (\n\t\t\t\t\tthis.State.display == \"tasks\" &&\n\t\t\t\t\ttask &&\n\t\t\t\t\ttask.parent != 0 &&\n\t\t\t\t\tthis.Bars.getItem(task.parent).type === \"split\"\n\t\t\t\t) {\n\t\t\t\t\tind = this.Bars.getIndexById(task.parent);\n\t\t\t\t} else if (unselect && !this.Bars.exists(id)) {\n\t\t\t\t\tthis.State.selected = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttop = ind * this.Local.getScales().cellHeight;\n\n\t\t\tthis.ScrollToTask(task);\n\t\t}\n\t\tthis.selLine.style.top = top + \"px\";\n\t}\n\n\t/**\n\t * Scrolls the chart to make the task visible\n\t * @param {Object} task - the data object of a task\n\t */\n\tScrollToTask(task) {\n\t\tif (task) {\n\t\t\tconst bars = this.Bars;\n\t\t\tif (\n\t\t\t\ttask.$x > bars.$width - this.Local.getScales().cellWidth ||\n\t\t\t\ttask.$x < bars.$view.scrollLeft\n\t\t\t) {\n\t\t\t\t// to make it visible, -30px for better looks - not sticking to the tree\n\t\t\t\tthis.State.left = task.$x - 30;\n\t\t\t}\n\t\t}\n\t\tthis.Bars.scrollTo(this.State.left, this.State.top);\n\t}\n\n\t/**\n\t * Creates and renders markers (today and custom ones if they are provided)\n\t */\n\tInitMarkers() {\n\t\tthis.containerForMarkers = webix.html.create(\"DIV\", {\n\t\t\tclass: \"webix_gantt_markers\",\n\t\t\tstyle: `height:${this.Bars.$view.scrollHeight}px`,\n\t\t});\n\t\tthis.Bars.$view.insertBefore(\n\t\t\tthis.containerForMarkers,\n\t\t\tthis.Bars.$view.firstChild\n\t\t);\n\n\t\tthis.RenderMarkers(this.app.config.markers);\n\t\tthis.on(this.app, \"onScalesUpdate\", () =>\n\t\t\tthis.RenderMarkers(this.app.config.markers)\n\t\t);\n\t}\n\n\t/**\n\t * Renders markers (today and custom ones if they are provided)\n\t * @param {Array} markers - all markers\n\t */\n\tRenderMarkers(markers) {\n\t\tif (!markers) return;\n\n\t\tconst html = [];\n\t\tfor (let i = 0; i < markers.length; i++) {\n\t\t\tconst m = markers[i];\n\t\t\tif (m.now) {\n\t\t\t\tm.start_date = new Date();\n\t\t\t\tif (!m.$interval)\n\t\t\t\t\tm.$interval = setInterval(\n\t\t\t\t\t\titem => {\n\t\t\t\t\t\t\tconst node = this.containerForMarkers.querySelector(\n\t\t\t\t\t\t\t\t`[gantt_now=\"${item.$interval}\"]`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tnode.style.left = this.GetMarkerPosition(new Date()) + \"px\";\n\t\t\t\t\t\t},\n\t\t\t\t\t\t5 * 60 * 1000,\n\t\t\t\t\t\tm\n\t\t\t\t\t);\n\t\t\t}\n\t\t\thtml.push(this.MarkerTemplate(markers[i]));\n\t\t}\n\t\tthis.containerForMarkers.innerHTML = html.join(\"\");\n\t}\n\n\t/**\n\t * Returns a string with HTML content of a marker\n\t * @param {Object} obj - marker settings\n\t * @returns {string}\n\t */\n\tMarkerTemplate(obj) {\n\t\tconst text = obj.text\n\t\t\t? `<span class=\"webix_gantt_marker_text\">${obj.text}</span>`\n\t\t\t: \"\";\n\n\t\treturn `<div\n\t\t\tgantt_now=\"${obj.$interval}\"\n\t\t\tclass=\"webix_gantt_marker ${obj.css || \"\"}\"\n\t\t\tstyle=\"left:${this.GetMarkerPosition(obj.start_date)}px\">${text}</div>`;\n\t}\n\n\t/**\n\t * Calculates new X position of a marker based on its date\n\t * @param {Date} date - the date from marker settings\n\t * @returns {number}\n\t */\n\tGetMarkerPosition(date) {\n\t\tconst { start, end, cellWidth, diff, minUnit } = this.Local.getScales();\n\t\tconst astart = this.Helpers.getUnitStart(minUnit, start);\n\n\t\treturn date < start || date > end\n\t\t\t? -100\n\t\t\t: Math.round(\n\t\t\t\t\tdiff(date, astart, webix.Date.startOnMonday, true) * cellWidth\n\t\t\t  );\n\t}\n\n\t/**\n\t * Returns a string with SVG with all links or a temp link\n\t * @param {string} lines - all lines as SVG polylines\n\t * @param {string} css - the name of CSS class for SVG (by default 'webix_gantt_lines' or 'webix_gantt_temp_line')\n\t * @returns {string}\n\t */\n\tLinksTemplate(lines, css) {\n\t\tconst bars = this.Bars.$view;\n\n\t\treturn `<svg\n\t\t\tclass=\"${css}\"\n\t\t\tviewBox=\"${this.State.left} ${this.State.top} ${bars.scrollWidth} ${bars.scrollHeight}\"\n\t\t\twidth=\"${bars.scrollWidth}\"\n\t\t\theight=\"${bars.scrollHeight}\"\n\t\t>${lines}</svg>`;\n\t}\n\n\t/**\n\t * Re-renders links\n\t */\n\tRefreshLinks() {\n\t\tconst lines = [];\n\t\t// check to skip multiple re-rendering initially\n\t\tif (this.LinksData.count() && this.VisibleTasks.count()) {\n\t\t\tconst links = this.LinksData;\n\t\t\tlinks.order.each(id => {\n\t\t\t\tconst link = links.getItem(id);\n\t\t\t\tif (link.$p) {\n\t\t\t\t\tlet critical =\n\t\t\t\t\t\tthis.State.criticalPath && this.Local.isLinkCritical(link);\n\t\t\t\t\tlines.push(\n\t\t\t\t\t\t`<polyline data-id=\"${id}\" ${\n\t\t\t\t\t\t\tcritical ? \"class='webix_gantt_line_critical'\" : \"\"\n\t\t\t\t\t\t} points=\"${link.$p}\" />`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst html =\n\t\t\tthis.LinksTemplate(lines.join(\"\"), \"webix_gantt_lines\") +\n\t\t\tthis.LinksTemplate('<polyline points=\"\" />', \"webix_gantt_temp_line\");\n\t\tthis.Links.setHTML(html);\n\t}\n\n\t/**\n\t * Refreshes links of a task\n\t * @param {string, number} tid - the ID of a task\n\t */\n\tRefreshTaskLinks(tid) {\n\t\tthis.LinksData.find(a => a.source == tid || a.target == tid).forEach(\n\t\t\tobj => {\n\t\t\t\tconst l = this.Links.$view.querySelector(`[data-id=\"${obj.id}\"]`);\n\t\t\t\tif (l) {\n\t\t\t\t\tconst s = this.VisibleTasks.getItem(obj.source);\n\t\t\t\t\tconst e = this.VisibleTasks.getItem(obj.target);\n\t\t\t\t\tthis.Helpers.updateLink(obj, s, e);\n\t\t\t\t\tl.setAttribute(\"points\", obj.$p);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t/**\n\t * Changes the width of the root component (list with bars)\n\t * @param {number} width\n\t */\n\tResize(width) {\n\t\tconst area = this.Bars.$view.querySelector(\".webix_scroll_cont\");\n\t\tarea.style.width = width + \"px\";\n\t\tarea.style.minHeight = \"1px\";\n\n\t\tif (this.selLine) this.selLine.style.width = width + \"px\";\n\t}\n\n\t/**\n\t * Handles actions with tasks\n\t * @param {Object} obj - settings of an action\n\t * @returns {Promise} - the result of asynchronous operations or an empty promise\n\t */\n\tAction(obj) {\n\t\tconst ops = this.app.getService(\"operations\");\n\t\t/**\n\t\t * Some actions invoke server-side request\n\t\t * therefore we need show progress bar for them\n\t\t */\n\t\tlet inProgress = null;\n\n\t\tif (obj.action === \"update-task-time\") {\n\t\t\tif (obj.time) {\n\t\t\t\tinProgress = ops.updateTaskTime(obj.id, obj.mode, obj.time);\n\t\t\t} else {\n\t\t\t\tthis.Local.refreshTasks(obj.id);\n\t\t\t\tif (this.State.display === \"resources\") {\n\t\t\t\t\tthis.VisibleTasks.refresh(obj.id);\n\t\t\t\t}\n\t\t\t\tthis.RefreshTaskLinks(obj.id);\n\t\t\t}\n\t\t} else if (obj.action === \"update-task-progress\") {\n\t\t\tif (!webix.isUndefined(obj.progress)) {\n\t\t\t\tinProgress = ops.updateTask(obj.id, { progress: obj.progress });\n\t\t\t} else {\n\t\t\t\tconst task = this.VisibleTasks.getItem(obj.id);\n\t\t\t\tthis.Bars.render(obj.id, task, \"paint\");\n\t\t\t}\n\t\t} else if (obj.action === \"drag-task\") {\n\t\t\tconst task = this.VisibleTasks.getItem(obj.id);\n\t\t\ttask.$x = parseInt(obj.left);\n\t\t\ttask.$w = parseInt(obj.width);\n\n\t\t\tthis.RefreshTaskLinks(obj.id);\n\t\t} else if (obj.action === \"add-link\") {\n\t\t\tconst { source, target, type } = obj;\n\t\t\tinProgress = ops.addLink({ source, target, type });\n\t\t} else if (obj.action === \"temp-link\") {\n\t\t\tconst { start, end } = obj;\n\t\t\tconst link = this.GetLinks(true).firstChild;\n\n\t\t\tif (!start) {\n\t\t\t\tlink.setAttribute(\"points\", \"\");\n\t\t\t} else {\n\t\t\t\tconst { left, top, p } = this.app\n\t\t\t\t\t.getService(\"helpers\")\n\t\t\t\t\t.newLink(this.Links.$view.getBoundingClientRect(), start, end);\n\t\t\t\tconst shift = [left, top];\n\t\t\t\tconst points = p\n\t\t\t\t\t.split(\",\")\n\t\t\t\t\t.map((a, i) => a * 1 + shift[i % 2])\n\t\t\t\t\t.join(\",\");\n\n\t\t\t\tlink.setAttribute(\"points\", points);\n\t\t\t}\n\t\t} else if (obj.action === \"add-task\") {\n\t\t\tconst scales = this.Local.getScales();\n\t\t\tconst unit = scales.precise\n\t\t\t\t? this.Helpers.getSmallerUnit(scales.minUnit)\n\t\t\t\t: scales.minUnit;\n\t\t\tconst start = this.Helpers.addUnit(unit, scales.start, obj.dates.start);\n\t\t\tconst end = this.Helpers.addUnit(unit, start, obj.dates.end);\n\t\t\tthis.app.callEvent(\"task:add\", [obj.id, { start, end }]);\n\t\t} else if (\n\t\t\tobj.action === \"split-resize\" &&\n\t\t\tthis.State.display !== \"resources\"\n\t\t) {\n\t\t\tconst task = this.VisibleTasks.getItem(obj.id);\n\t\t\tif (task.parent != 0) {\n\t\t\t\tconst parent = this.VisibleTasks.getItem(task.parent);\n\t\t\t\tif (parent.type === \"split\") {\n\t\t\t\t\tconst splitCont = this.Bars.$view.querySelector(\n\t\t\t\t\t\t`[webix_s_id=\"${task.parent}\"]`\n\t\t\t\t\t);\n\t\t\t\t\tparent.$data.sort((a, b) => b.$x - a.$x);\n\t\t\t\t\tconst { width, left } = this.GetSplitBox(parent);\n\t\t\t\t\tsplitCont.style.width = `${width}px`;\n\t\t\t\t\tsplitCont.style.left = `${left}px`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn inProgress || webix.promise.resolve();\n\t}\n\n\t/**\n\t * Adds the layer for holiday highlighting and renders it\n\t * @param {Object} scales - current scales\n\t */\n\tHandleHolidays(scales) {\n\t\tlet html =\n\t\t\t\"<div class='webix_gantt_bar_holidays' style='height:\" +\n\t\t\tthis.Bars.$view.scrollHeight +\n\t\t\t\"px'></div>\";\n\t\tif (this.Calendars)\n\t\t\thtml +=\n\t\t\t\t\"<div class='webix_gantt_bar_resource_holidays' style='height:\" +\n\t\t\t\tthis.Bars.$view.scrollHeight +\n\t\t\t\t\"px'></div>\";\n\t\tthis.Holidays.setHTML(html);\n\t\tthis.holidaysContainer = this.Holidays.$view.querySelector(\n\t\t\t\".webix_gantt_bar_holidays\"\n\t\t);\n\t\tthis.resHolidaysContainer = this.Holidays.$view.querySelector(\n\t\t\t\".webix_gantt_bar_resource_holidays\"\n\t\t);\n\t\tthis.RenderHolidays(scales);\n\n\t\tthis.on(this.app, \"onScalesUpdate\", scales => this.RenderHolidays(scales));\n\t\tthis.on(this.app.getRoot(), \"onViewShow\", () => {\n\t\t\tthis.refresh();\n\t\t});\n\t}\n\n\tEachScaleDate(scales, func) {\n\t\tif (scales.minUnit === \"day\" || scales.minUnit === \"hour\") {\n\t\t\tlet date = webix.Date.copy(scales.start);\n\n\t\t\tlet end = webix.Date.dayStart(scales.end);\n\t\t\tif (!(scales.end - end)) {\n\t\t\t\tend = webix.Date.add(end, -1, \"day\", true);\n\t\t\t}\n\n\t\t\tlet hourOffset = scales.start.getHours();\n\n\t\t\twhile (date <= end) {\n\t\t\t\tfunc.call(this, date, hourOffset);\n\t\t\t\tdate = webix.Date.add(webix.Date.dayStart(date), 1, \"day\", true);\n\t\t\t\thourOffset = webix.Date.equal(date, end)\n\t\t\t\t\t? 24 - Math.ceil(webix.Date.timePart(scales.end) / 60 / 60)\n\t\t\t\t\t: 0;\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Renders holiday highlighting\n\t * @param {Object} scales - current scales\n\t */\n\tRenderHolidays(scales) {\n\t\tif (this.holidaysContainer) {\n\t\t\tlet html = \"\";\n\t\t\tthis.EachScaleDate(scales, (date, hourOffset) => {\n\t\t\t\tif (scales.isHoliday(date)) {\n\t\t\t\t\thtml += this.HolidayTemplate(scales, date, hourOffset);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.holidaysContainer.innerHTML = html;\n\n\t\t\tif (this.Calendars) this.RenderResourceHolidays(scales);\n\t\t}\n\t}\n\tMarkResourceHolidays(scales, id, calendar) {\n\t\tlet index = this.Bars.getIndexById(id);\n\t\tif (index < 0) return \"\";\n\t\tlet html = \"\",\n\t\t\tn = 0,\n\t\t\tdateStart = null;\n\n\t\tthis.EachScaleDate(scales, (date, hourOffset) => {\n\t\t\tconst isHoliday = scales.isHoliday(date);\n\t\t\tif (this.Helpers.isResourceHoliday(date, calendar)) {\n\t\t\t\tif (!isHoliday) {\n\t\t\t\t\tif (!n) dateStart = date;\n\t\t\t\t\tn++;\n\t\t\t\t} else if (n) {\n\t\t\t\t\thtml += this.ResourceHolidayTemplate(\n\t\t\t\t\t\tscales,\n\t\t\t\t\t\tdateStart,\n\t\t\t\t\t\thourOffset,\n\t\t\t\t\t\tindex,\n\t\t\t\t\t\tn\n\t\t\t\t\t);\n\t\t\t\t\tn = 0;\n\t\t\t\t}\n\t\t\t} else if (isHoliday) {\n\t\t\t\tif (n) {\n\t\t\t\t\thtml += this.ResourceHolidayTemplate(\n\t\t\t\t\t\tscales,\n\t\t\t\t\t\tdateStart,\n\t\t\t\t\t\thourOffset,\n\t\t\t\t\t\tindex,\n\t\t\t\t\t\tn\n\t\t\t\t\t);\n\t\t\t\t\tn = 0;\n\t\t\t\t}\n\t\t\t\thtml += this.ResourceWorkDayTemplate(scales, date, hourOffset, index);\n\t\t\t}\n\t\t});\n\t\treturn html;\n\t}\n\tRenderResourceHolidays(scales) {\n\t\tif (this.resHolidaysContainer) {\n\t\t\tscales = scales || this.Local.getScales();\n\t\t\tthis.Local.taskCalendarMap().then(data => {\n\t\t\t\tlet html = \"\";\n\t\t\t\tif (data)\n\t\t\t\t\tfor (let taskId in data)\n\t\t\t\t\t\thtml += this.MarkResourceHolidays(scales, taskId, data[taskId]);\n\t\t\t\tthis.resHolidaysContainer.innerHTML = html;\n\t\t\t});\n\t\t}\n\t}\n\t/**\n\t * Returns a size and position of a date column / cell\n\t * @param {Object} scales - the current scales\n\t * @param {Date} date - the date\n\t * @param {number} hourOffset - the hours of the scale start date\n\t * @param {number} i - a task / row index ( optional )\n\t * @returns {object}\n\t */\n\tGetDateBox(scales, date, hourOffset, i) {\n\t\tconst astart = this.Helpers.getUnitStart(scales.minUnit, scales.start);\n\t\tconst x = Math.round(scales.diff(date, astart) * scales.cellWidth);\n\t\tconst w =\n\t\t\t(scales.minUnit === \"hour\" ? 24 - hourOffset : 1) * scales.cellWidth;\n\t\tlet box = { x, w };\n\t\tif (i || i === 0) {\n\t\t\tbox.y = scales.cellHeight * i;\n\t\t\tbox.h = scales.cellHeight;\n\t\t}\n\t\treturn box;\n\t}\n\t/**\n\t * Returns a string with HTML of 1 holiday highlight element\n\t * @param {Object} scales - the current scales\n\t * @param {Date} date - the date of this element\n\t * @param {number} hourOffset - the hours of the scale start date\n\t * @returns {string}\n\t */\n\tHolidayTemplate(scales, date, hourOffset) {\n\t\tconst { x, w } = this.GetDateBox(scales, date, hourOffset);\n\t\tconst style = `left:${x}px;width:${w}px;`;\n\t\treturn \"<div class='webix_gantt_holiday' style='\" + style + \"'></div>\";\n\t}\n\t/**\n\t * Returns a string with HTML of holiday unit\n\t * @param {Object} scales - the current scales\n\t * @param {Date} date - the start date of this element\n\t * @param {number} hourOffset - the hours of the scale start date\n\t * @param {number} i - a task index\n\t * @param {number} n - a number of holiday dates to include\n\t * @returns {string}\n\t */\n\tResourceHolidayTemplate(scales, date, hourOffset, i, n) {\n\t\tconst { x, y, w, h } = this.GetDateBox(scales, date, hourOffset, i);\n\t\tconst style = `left:${x}px;width:${w * n}px;top:${y}px;height:${h}px;`;\n\t\treturn \"<div class='webix_gantt_holiday' style='\" + style + \"'></div>\";\n\t}\n\t/**\n\t * Returns a string with HTML of work day unit\n\t * @param {Object} scales - the current scales\n\t * @param {Date} date - the date of this element\n\t * @param {number} hourOffset - the hours of the scale start date\n\t * @param {number} i - a task index\n\t * @returns {string}\n\t */\n\tResourceWorkDayTemplate(scales, date, hourOffset, i) {\n\t\tconst { x, y, w, h } = this.GetDateBox(scales, date, hourOffset, i);\n\t\tconst style = `left:${x + 0.2}px;width:${w - 1.2}px;top:${y}px;height:${h -\n\t\t\t1}px;`;\n\t\treturn \"<div class='webix_gantt_work_day' style='\" + style + \"'></div>\";\n\t}\n\t/**\n\t * Returns a string with HTML content of a tooltip for tasks\n\t * @param {Object} obj - task data\n\t * @param {function} _ - the translator function of jet locale plugin, see https://webix.gitbook.io/webix-jet/part-ii-webix-jet-in-details/plugins#applying-the-locale\n\t * @returns {string}\n\t */\n\tGetTooltip(obj, _) {\n\t\tconst parser = webix.i18n.longDateFormatStr;\n\t\tlet tip = `${obj.text || _(\"(no title)\")}<br>\n\t\t\t<br>${_(\"Start date\")}: ${parser(obj.start_date)}`;\n\n\t\tif (obj.type != \"milestone\") {\n\t\t\ttip += `<br>${_(\"End date\")}: ${parser(obj.end_date)}\n\t\t\t<br>${_(\"Lasts\")} ${obj.duration} ${obj.duration > 1 ? _(\"days\") : _(\"day\")}`;\n\t\t}\n\t\treturn tip;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class ScalesView extends JetView {\n\tconfig() {\n\t\treturn { view: \"template\", height: 20, css: \"webix_gantt_scale\" };\n\t}\n\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tconst scales = this.Local.getScales();\n\t\tthis.RenderScales(scales);\n\n\t\tthis.on(this.app, \"onScalesUpdate\", scales => this.RenderScales(scales));\n\t}\n\n\tready() {\n\t\tconst view = this.getRoot();\n\t\tthis.on(this.State.$changes, \"left\", x => view.scrollTo(x, null));\n\t}\n\n\t/**\n\t * Renders gantt scales\n\t * @param {Object} s - the object that stores the data of current scales\n\t */\n\tRenderScales(s) {\n\t\tconst view = this.getRoot();\n\t\tconst html = s.rows\n\t\t\t.map(line => {\n\t\t\t\tconst canMarkHolidays =\n\t\t\t\t\t(line.type === \"hour\" || line.type === \"day\") && line.step === 1;\n\t\t\t\treturn (\n\t\t\t\t\t`<div class=\"webix_gantt_scale_row\" style='height:${line.height}px;width:${s.width}px'>` +\n\t\t\t\t\tline.cells\n\t\t\t\t\t\t.map(cell => this.CellTemplate(cell, canMarkHolidays))\n\t\t\t\t\t\t.join(\"\") +\n\t\t\t\t\t\"</div>\"\n\t\t\t\t);\n\t\t\t})\n\t\t\t.join(\"\");\n\n\t\tview.config.height = s.height;\n\t\tview.setHTML(html);\n\t\tview.resize();\n\t}\n\n\t/**\n\t * Returns the template string for a scale unit\n\t * @param {Object} cell - a scale unit\n\t * @param {boolean} canMarkHolidays - signals whether to add styling for holidays\n\t * @returns {string} - the template string of the scale cell\n\t */\n\tCellTemplate(cell, canMarkHolidays) {\n\t\treturn `<div class=\"webix_gantt_scale_cell ${cell.css +\n\t\t\t(canMarkHolidays && this.app.config.isHoliday(cell.date)\n\t\t\t\t? \"webix_gantt_holiday_scale\"\n\t\t\t\t: \"\")}\" style=\"width:${cell.width}px;\">${this.FormatDate(\n\t\t\tcell.date,\n\t\t\tcell.format\n\t\t)}</div>`;\n\t}\n\n\tFormatDate(date, format) {\n\t\tif (typeof format === \"string\") format = webix.Date.dateToStr(format);\n\t\treturn format(date);\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nimport ScaleView from \"./scale\";\nimport BarsView from \"./bars\";\n\nexport default class ChartView extends JetView {\n\tconfig() {\n\t\treturn { rows: [ScaleView, BarsView] };\n\t}\n\tinit() {\n\t\tthis.on(this.app, \"bars:toggle\", v => {\n\t\t\tif (v) this.getRoot().show();\n\t\t\telse this.getRoot().hide();\n\t\t});\n\t}\n}\n","import BarsView from \"../chart/bars\";\n\nexport default class DiagramView extends BarsView {\n\tconfig() {\n\t\tthis.State = this.getParam(\"state\", true);\n\n\t\treturn {\n\t\t\tview: \"abslayout\",\n\t\t\tcss: \" webix_gantt_readonly\",\n\t\t\tcells: [\n\t\t\t\t{\n\t\t\t\t\tview: \"template\",\n\t\t\t\t\tcss: \"webix_gantt_holidays\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\trelative: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"tree\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\ttype: this.WorkloadMarkersType(),\n\t\t\t\t\tcss: `webix_gantt${\n\t\t\t\t\t\twebix.env.touch ? \"_touch\" : \"\"\n\t\t\t\t\t}_bars webix_gantt_resdiagram_chart`,\n\t\t\t\t\tscroll: \"xy\",\n\t\t\t\t\trelative: true,\n\t\t\t\t\tfilterMode: {\n\t\t\t\t\t\tshowSubItems: false,\n\t\t\t\t\t\tlevel: 0,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit(view) {\n\t\tconst [holidays, bars] = view.getChildViews();\n\t\tthis.Holidays = holidays;\n\t\tthis.Bars = bars;\n\t\tthis.LocalState = this.getParam(\"localState\");\n\t\tthis.Unit = \"hours\";\n\n\t\tconst local = (this.Local = this.app.getService(\"local\"));\n\t\tconst scales = (this.Scales = local.getScales());\n\t\tthis.RDCollection = this.app.getService(\"grouping\").getRDCollection();\n\t\tthis.Helpers = this.app.getService(\"helpers\");\n\n\t\tthis.on(this.Bars.data, \"onSyncApply\", () => {\n\t\t\tthis.Scales = this.Local.getScales();\n\t\t\tthis.RestoreTreeState();\n\t\t\tif (this.Calendars) this.RenderResourceHolidays();\n\t\t});\n\n\t\tthis.Bars.sync(this.RDCollection, function() {\n\t\t\tthis.filter(t => t.$group);\n\t\t});\n\n\t\tthis.Calendars = this.app.config.resourceCalendars;\n\n\t\t// leave here for app.refresh() calls (inc. from Locale plugin)\n\t\tthis.DrawGrid(view, scales);\n\n\t\t// the order of DrawGrid-HandleScroll and HandleHolidays is important for the case when\n\t\t// main gantt chart is scrolled x and the diagram is empty or has something only in the\n\t\t// beginning of x-axis\n\t\tthis.HandleScroll();\n\t\tthis.HandleHolidays(scales);\n\n\t\tthis.on(this.app, \"onScalesUpdate\", scales => {\n\t\t\tthis.DrawGrid(view, scales);\n\t\t});\n\n\t\tthis.on(this.app, \"rdiagram:branch:toggle\", (id, v) => {\n\t\t\tthis.ToggleBranch(id, v);\n\t\t});\n\n\t\tthis.on(this.app, \"rdiagram:resize\", () => {\n\t\t\tthis.holidaysContainer.style.height = this.Bars.$view.scrollHeight + \"px\";\n\t\t});\n\n\t\tthis.on(this.app, \"rdiagram:sort\", (by, dir, as) => {\n\t\t\tif (by) this.Bars.sort(by, dir, as);\n\t\t\telse this.Bars.sort(as, dir);\n\t\t});\n\n\t\tif (this.Calendars)\n\t\t\tthis.on(this.Local.assignments().data, \"onStoreUpdated\", () => {\n\t\t\t\tthis.RenderResourceHolidays();\n\t\t\t});\n\t}\n\n\t/**\n\t * Opens or closes a branch of the diagram\n\t * @param {number} id - the id of a branch\n\t * @param {Boolean} v - if true, the branch will be opened; false - closed\n\t */\n\tToggleBranch(id, v) {\n\t\tif (v) this.Bars.open(id);\n\t\telse this.Bars.close(id);\n\n\t\tconst root = this.Bars.data.getBranch(\"0\");\n\t\tconst opened = this.Bars.getState().open.filter(i => {\n\t\t\treturn root.find(o => o.id == i);\n\t\t});\n\n\t\tthis._treeOpened = opened.map(id => this.Bars.getIndexById(id));\n\n\t\tthis.holidaysContainer.style.height = this.Bars.$view.clientHeight + \"px\";\n\t\tif (this.Calendars) {\n\t\t\tthis.resHolidaysContainer.style.height =\n\t\t\t\tthis.Bars.$view.clientHeight + \"px\";\n\t\t\tthis.RenderResourceHolidays();\n\t\t}\n\t}\n\n\t/**\n\t * Restores opened/closed branches after diagram update and regroup\n\t */\n\tRestoreTreeState() {\n\t\tif (this._treeOpened && this._treeOpened.length) {\n\t\t\tconst t = this._treeOpened;\n\t\t\tconst root = this.Bars.data.getBranch(\"0\");\n\t\t\troot.forEach(b => {\n\t\t\t\tconst ind = root.indexOf(b);\n\t\t\t\tb.open = !t.indexOf(ind);\n\t\t\t\tthis.Bars.data.callEvent(\"onStoreUpdated\", [b.id, 0, \"branch\"]);\n\t\t\t});\n\t\t} else this.Bars.openAll();\n\t}\n\n\t/**\n\t * Handles scrolling\n\t */\n\tHandleScroll() {\n\t\tthis._scroll_handler = webix.event(this.Bars.$view, \"scroll\", ev => {\n\t\t\tconst bars = ev.target;\n\t\t\tconst top = Math.round(bars.scrollTop);\n\t\t\tconst left = Math.round(bars.scrollLeft);\n\t\t\tthis.getRoot().$view.style.backgroundPosition = `-${left}px -${top}px`;\n\t\t\tthis.State.left = left;\n\t\t\tthis.LocalState.top = top;\n\t\t\tthis.SetHolidaysScroll(bars.scrollHeight, left, top);\n\t\t});\n\n\t\tthis.on(this.LocalState.$changes, \"top\", y => {\n\t\t\tthis.Bars.scrollTo(this.State.left, y);\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"left\", v => {\n\t\t\tthis.Bars.scrollTo(v, this.LocalState.top);\n\t\t});\n\n\t\tthis.on(this.app, \"rdiagram:unit:change\", u => {\n\t\t\tthis.Unit = u;\n\t\t\tthis.Bars.render();\n\t\t});\n\t}\n\n\t/**\n\t * Returns all templates for bars\n\t * @param {function} _ - the translator function of jet locale plugin, see https://webix.gitbook.io/webix-jet/part-ii-webix-jet-in-details/plugins#applying-the-locale\n\t * @returns {Object} - all templates for bars\n\t */\n\tWorkloadMarkersType() {\n\t\treturn {\n\t\t\ttemplate: task => this.MarkerTemplate(task),\n\t\t\ttemplateStart: (task, common) => this.MarkerStartTemplate(task, common),\n\t\t\ttemplateEnd: () => \"</div>\",\n\t\t};\n\t}\n\n\t/**\n\t * Defines the html of the data item of the diagram tree\n\t * @param {Object} task - data object\n\t * @returns {string} with HTML\n\t */\n\tMarkerStartTemplate(task, common) {\n\t\treturn `<div webix_tm_id=\"${task.id}\" style=\"height:${this.Scales\n\t\t\t.cellHeight - 8}px; padding: 4px;\" class=\"${common.classname(\n\t\t\ttask,\n\t\t\tcommon\n\t\t)} webix_gantt_diagram_line\" ${common.aria(task)}>`;\n\t}\n\n\t/**\n\t * Defines the looks and contents of a diagram workload marker\n\t * @param {Object} task - data object\n\t * @returns {string} with HTML\n\t */\n\tMarkerTemplate(task) {\n\t\tif (task.$level === 2) {\n\t\t\tconst markers = this.GetMarkerData(task);\n\n\t\t\tconst html = [];\n\t\t\tfor (const x in markers) {\n\t\t\t\thtml.push(this.MarkerToHTML(markers[x]));\n\t\t\t}\n\n\t\t\treturn html.join(\"\");\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tCheckResourceHoliday(date, id) {\n\t\tif (this.Calendars) {\n\t\t\tconst resId = this.Bars.getItem(id).resource_id;\n\t\t\tif (resId) {\n\t\t\t\tconst calendarId = this.Local.resources().getItem(resId).calendar_id;\n\t\t\t\tif (calendarId) {\n\t\t\t\t\tconst calendar = this.Local.calendars().getItem(calendarId);\n\t\t\t\t\treturn this.Helpers.isResourceHoliday(date, calendar);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn this.app.config.isHoliday(date);\n\t}\n\t/**\n\t * Calculates work load per unit and prepares the result for display on the diagram\n\t * @param {Object} task - the data object of the data collection\n\t * @returns {Object} an object with x coordinates as keys and marker data objects and values (hours, count of tasks)\n\t */\n\tGetMarkerData(task) {\n\t\tconst markers = {};\n\t\tfor (let a = 0; a < task.duration.length; ++a) {\n\t\t\tlet d = task.duration[a];\n\t\t\tconst hourParts = task.units[a];\n\t\t\tconst delta = task.$x[a] - Math.min(...task.$x);\n\n\t\t\tconst markerWidth = this.Scales.cellHeight > 40 ? 28 : 20;\n\t\t\tconst step = this.Scales.cellWidth - markerWidth;\n\t\t\tconst halfStep = Math.round(step / 2);\n\t\t\tlet x = delta ? -2 : halfStep;\n\t\t\tlet date = webix.Date.copy(task.start_date[a]);\n\t\t\tfor (let i = 0; i < d; ++i, x += step) {\n\t\t\t\tif (\n\t\t\t\t\tthis.app.config.excludeHolidays &&\n\t\t\t\t\tthis.CheckResourceHoliday(date, task.id)\n\t\t\t\t) {\n\t\t\t\t\t++d;\n\t\t\t\t} else {\n\t\t\t\t\tlet hours = 0;\n\t\t\t\t\tif (this.Scales.minUnit !== \"hour\")\n\t\t\t\t\t\thours =\n\t\t\t\t\t\t\t(i === d - 1 ? hourParts[1] : i ? hourParts[2] : hourParts[0]) ||\n\t\t\t\t\t\t\thourParts[2];\n\t\t\t\t\telse {\n\t\t\t\t\t\thours = hourParts[2];\n\t\t\t\t\t}\n\n\t\t\t\t\tconst cell = task.$x[a] + i * this.Scales.cellWidth - 2;\n\t\t\t\t\tif (!markers[cell]) {\n\t\t\t\t\t\tmarkers[cell] = { hours, x: cell + halfStep, count: 1 };\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmarkers[cell].hours += hours;\n\t\t\t\t\t\tmarkers[cell].count += 1;\n\t\t\t\t\t}\n\t\t\t\t\tmarkers[cell].overloaded = this.CheckOverload(markers[cell], task);\n\t\t\t\t}\n\t\t\t\twebix.Date.add(date, 1, this.Scales.minUnit);\n\t\t\t}\n\t\t}\n\n\t\treturn markers;\n\t}\n\n\t/**\n\t * Checks if a resource is overloaded during this unit of time\n\t * @param {Object} marker - the data of a diagram marker for one unit\n\t * @returns {boolean} true if during this unit resource is overloaded with work\n\t */\n\tCheckOverload(marker) {\n\t\tif (this.Scales.minUnit === \"hour\") {\n\t\t\t// temp until full support for hourly duration is done\n\t\t\treturn Math.round(marker.hours * 24) > this.Helpers.unitLoadNorm.day;\n\t\t}\n\t\treturn marker.hours > this.Helpers.unitLoadNorm[this.Scales.minUnit];\n\t}\n\n\t/**\n\t * Returns the html of a marker\n\t * @param {Object} marker - an object with data for a marker (hours, count of tasks)\n\t */\n\tMarkerToHTML(marker) {\n\t\tconst over = marker.overloaded ? \"webix_gantt_overload\" : \"\";\n\t\tconst number =\n\t\t\tthis.Unit === \"hours\"\n\t\t\t\t? marker.hours >= 1\n\t\t\t\t\t? marker.hours\n\t\t\t\t\t: \" \"\n\t\t\t\t: marker.count;\n\t\treturn `<div class=\"webix_gantt_diagram_marker ${over}\" style=\"left:${marker.x}px;\">${number}</div>`;\n\t}\n\n\tRenderResourceHolidays(scales) {\n\t\tscales = scales || this.Local.getScales();\n\t\tlet html = \"\";\n\t\tthis.Bars.data.each(data => {\n\t\t\tif (data.resource_id) {\n\t\t\t\tconst calendarId = this.Local.resources().getItem(data.resource_id)\n\t\t\t\t\t.calendar_id;\n\t\t\t\tif (calendarId)\n\t\t\t\t\thtml += this.MarkResourceHolidays(\n\t\t\t\t\t\tscales,\n\t\t\t\t\t\tdata.id,\n\t\t\t\t\t\tthis.Local.calendars().getItem(calendarId)\n\t\t\t\t\t);\n\t\t\t}\n\t\t});\n\t\tthis.resHolidaysContainer.innerHTML = html;\n\t}\n}\n","/**\n * Prepares a sorting function with locale-based comparison\n * @param {string} by - column ID\n * @returns {function} sorting function\n */\nexport function sort(by) {\n\treturn (a, b) =>\n\t\ta[by].localeCompare(b[by], undefined, {\n\t\t\tignorePunctuation: true,\n\t\t\tnumeric: true,\n\t\t});\n}\n\n/**\n * Check if two arrays contain same elements\n * @param {array} a - an array\n * @param {array} b - an array\n * @returns {boolean} true if two arrays contain same elements\n */\nexport function arrayEquals(a, b) {\n\treturn a && a.length == b.length && a.every(item => b.includes(item));\n}\n","import { JetView } from \"webix-jet\";\nimport { sort } from \"../../helpers/common\";\n\nexport default class TreeView extends JetView {\n\tconfig() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tconst scales = this.app.getService(\"local\").getScales();\n\t\tconst _ = (this._ = this.app.getService(\"locale\")._);\n\t\tconst compact = (this.Compact = this.getParam(\"compact\", true));\n\n\t\tconst columns = [\n\t\t\t{\n\t\t\t\tid: \"name\",\n\t\t\t\tcss: \"webix_gantt_title\",\n\t\t\t\theader: compact ? \"<span class='webix_icon gti-menu'>\" : _(\"Name\"),\n\t\t\t\ttemplate: (obj, common) => this.TreeTemplate(obj, common),\n\t\t\t\tfillspace: true,\n\t\t\t\tsort: compact ? \"\" : sort(\"name\"),\n\t\t\t\tminWidth: compact ? 44 : 150,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"load\",\n\t\t\t\theader: _(\"Hours\"),\n\t\t\t\thidden: compact,\n\t\t\t\tbatch: \"hours\",\n\t\t\t\tsort: \"int\",\n\t\t\t\tminWidth: 50,\n\t\t\t\tresize: false,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"count\",\n\t\t\t\theader: _(\"Tasks\"),\n\t\t\t\tbatch: \"tasks\",\n\t\t\t\tsort: \"int\",\n\t\t\t\tminWidth: 50,\n\t\t\t\thidden: true,\n\t\t\t\tresize: false,\n\t\t\t},\n\t\t];\n\n\t\tconst skin = webix.skin.$name;\n\t\tconst headerCss =\n\t\t\tskin == \"material\" || skin == \"mini\" ? \"webix_header_border\" : \"\";\n\t\tconst tree = {\n\t\t\tview: \"treetable\",\n\t\t\tcss: \"webix_gantt_resdiagram_tree \" + headerCss,\n\t\t\tprerender: true,\n\t\t\tborderless: skin === \"contrast\",\n\t\t\twidth: compact ? 44 : this.State.treeWidth,\n\t\t\trowHeight: scales.cellHeight,\n\t\t\theaderRowHeight: scales.height,\n\t\t\tscroll: \"xy\",\n\t\t\tscrollAlignY: false,\n\t\t\tsort: true,\n\t\t\tresizeColumn: {\n\t\t\t\theaderOnly: true,\n\t\t\t\tsize: 10,\n\t\t\t},\n\t\t\tcolumns,\n\t\t\ttooltip: () => \"\",\n\t\t\ton: {\n\t\t\t\tonViewResize: () => {\n\t\t\t\t\tthis.State.treeWidth = this.Tree.$width;\n\t\t\t\t},\n\t\t\t\tonAfterOpen: id => this.ToggleBranch(id, 1),\n\t\t\t\tonAfterClose: id => this.ToggleBranch(id, 0),\n\t\t\t\tonAfterSort: (by, dir, as) => this.SortTasks(by, dir, as),\n\t\t\t\tonColumnResize: (id, v, o, user) => this.NormalizeColumns(id, user),\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\t\"gti-menu\": () => this.ToggleColumns(),\n\t\t\t},\n\t\t\tfilterMode: {\n\t\t\t\tshowSubItems: false,\n\t\t\t\tlevel: 0,\n\t\t\t},\n\t\t};\n\n\t\tconst ls = (this.LocalState = this.getParam(\"localState\"));\n\t\ttree.on[\"onScrollY\"] = tree.on[\"onSyncScroll\"] = tree.on[\n\t\t\t\"onAfterScroll\"\n\t\t] = function() {\n\t\t\tls.top = this.getScrollState().y;\n\t\t};\n\t\treturn tree;\n\t}\n\n\tinit(view) {\n\t\tthis.Tree = view;\n\t\tthis.Helpers = this.app.getService(\"helpers\");\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tthis.RDCollection = this.app.getService(\"grouping\").getRDCollection();\n\t\tthis._unit = \"hours\";\n\t\tthis._collapsed = true;\n\n\t\tthis.on(this.LocalState.$changes, \"top\", y => {\n\t\t\tthis.Tree.scrollTo(null, y);\n\t\t});\n\n\t\tthis.on(this.Tree.data, \"onSyncApply\", () => this.RestoreTreeState());\n\n\t\tview.sync(this.RDCollection, function() {\n\t\t\tthis.filter(t => t.$group);\n\t\t});\n\n\t\tthis.on(this.State.$changes, \"treeWidth\", v => {\n\t\t\tif (!this.Compact && view.$width !== v) {\n\t\t\t\tview.define({ width: v });\n\t\t\t\tview.resize();\n\t\t\t}\n\t\t});\n\n\t\tthis.on(this.app, \"rdiagram:unit:change\", u => this.ShowInUnits(u));\n\n\t\t// resetting headerRowHeight\n\t\tthis.on(this.app, \"onScalesUpdate\", scales => {\n\t\t\tconst col = this.Tree.columnId(0);\n\t\t\tthis.Tree.getColumnConfig(col).header[0].height = scales.height;\n\t\t\tthis.Tree.refreshColumns();\n\t\t});\n\t}\n\n\t/**\n\t * Opens/closes same branches as were opened/closed before updates\n\t */\n\tRestoreTreeState() {\n\t\tif (this._treeOpened && this._treeOpened.length) {\n\t\t\tconst t = this._treeOpened;\n\t\t\tconst root = this.Tree.data.getBranch(\"0\");\n\t\t\troot.forEach(b => {\n\t\t\t\tconst ind = root.indexOf(b);\n\t\t\t\tb.open = !t.indexOf(ind);\n\t\t\t\tthis.Tree.data.callEvent(\"onStoreUpdated\", [b.id, 0, \"branch\"]);\n\t\t\t});\n\t\t} else this.Tree.openAll();\n\t}\n\n\t/**\n\t * Defines the look of a tree item\n\t * @param {Object} obj - data object of a tree item\n\t * @param {Object} common - type object of tree\n\t */\n\tTreeTemplate(obj, common) {\n\t\tconst compact = this.Compact && this._collapsed;\n\t\tif (obj.$level == 1)\n\t\t\treturn compact\n\t\t\t\t? common.icon(obj)\n\t\t\t\t: common.treetable(obj, common) + obj.category;\n\n\t\tif (compact) return this.Helpers.resourceAvatar(obj);\n\t\treturn common.space(obj) + this.Helpers.resourceAvatar(obj) + obj.name;\n\t}\n\n\t/**\n\t * Shows total workload in tasks or hours\n\t * @param {string} u - \"tasks\" or \"hours\"\n\t */\n\tShowInUnits(u) {\n\t\tthis._unit = u;\n\t\tconst tree = this.Tree;\n\t\tconst cols = tree.config.columns;\n\t\tconst lastFillspace = cols[cols.length - 1].fillspace;\n\t\tif (!this.Compact || !this._collapsed) tree.showColumnBatch(u);\n\t\t// columns normalizing\n\t\tthis.SetColumns(0, lastFillspace);\n\t}\n\n\t/**\n\t * Adjusts columns after resizing\n\t * @param {string} id - ID of the column being resized\n\t * @param {boolean} user - defines whether resizing was triggered by user or API\n\t */\n\tNormalizeColumns(id, user) {\n\t\tif (!user) return;\n\t\tthis.SetColumns(this.Tree.getColumnIndex(id), true);\n\t}\n\n\tSetColumns(index, fillspace) {\n\t\tconst columns = this.Tree.config.columns;\n\t\tconst last = columns.length - 1;\n\t\tif (index === 0) {\n\t\t\tcolumns[last].fillspace = fillspace;\n\t\t\tcolumns[last].width = 0;\n\t\t\tcolumns[last].resize = false;\n\t\t} else if (index === last) {\n\t\t\tcolumns[0].fillspace = true;\n\t\t\tcolumns[0].width = 0;\n\t\t}\n\t\tthis.Tree.refreshColumns();\n\t}\n\n\t/** Shows and hides columns in a compact mode */\n\tToggleColumns() {\n\t\t// [todo] toggle tree in compact code\n\t\tconst tree = this.Tree;\n\t\tconst lv = tree.isColumnVisible(\"load\");\n\t\tconst cv = tree.isColumnVisible(\"count\");\n\t\tconst vis = (this._collapsed = lv || cv);\n\n\t\tif (vis) {\n\t\t\tif (lv) tree.hideColumn(\"load\");\n\t\t\tif (cv) tree.hideColumn(\"count\");\n\t\t} else {\n\t\t\tif (this._unit === \"hours\") tree.showColumn(\"load\");\n\t\t\telse tree.showColumn(\"count\");\n\t\t}\n\n\t\ttree.config.width = vis ? 44 : 0;\n\t\tconst nameCol = tree.config.columns[0];\n\t\tnameCol.minWidth = vis ? 44 : 150;\n\t\ttree.resize();\n\t\ttree.refreshColumns();\n\n\t\tthis.app.callEvent(\"rdiagram:tree:toggle\", [vis]);\n\t}\n\n\t/**\n\t * Hides/Shows the lines of the diagram for the closed/opened tree branch\n\t * @param {number} id - the ID of a branch\n\t * @param {Number} v - the state of a branch (1 - opened, 0 - closed)\n\t */\n\tToggleBranch(id, v) {\n\t\tconst root = this.Tree.data.getBranch(\"0\");\n\t\tconst opened = this.Tree.getState().open.filter(i => {\n\t\t\treturn root.find(o => o.id == i);\n\t\t});\n\t\tthis._treeOpened = opened.map(id => this.Tree.getIndexById(id));\n\n\t\tthis.app.callEvent(\"rdiagram:branch:toggle\", [id, v]);\n\t}\n\n\tSortTasks(by, dir, as) {\n\t\tthis.app.callEvent(\"rdiagram:sort\", [by, dir, as]);\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport TreeView from \"./tree\";\nimport ScalesView from \"../chart/scale\";\nimport DiagramView from \"./diagram\";\n\nimport { createState } from \"jet-restate\";\n\nexport default class RDiagramView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst compact = this.getParam(\"compact\", true);\n\n\t\tconst contrast = webix.skin.$name === \"contrast\";\n\t\tconst unit = this.app.getService(\"local\").getScales().minUnit;\n\t\treturn {\n\t\t\ttype: contrast ? \"clean\" : \"line\",\n\t\t\trows: [\n\t\t\t\t{\n\t\t\t\t\tview: \"toolbar\",\n\t\t\t\t\tborderless: contrast,\n\t\t\t\t\telements: [\n\t\t\t\t\t\t{},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"radio\",\n\t\t\t\t\t\t\twidth: 330,\n\t\t\t\t\t\t\tvalue: \"hours\",\n\t\t\t\t\t\t\tlocalId: \"radio\",\n\t\t\t\t\t\t\toptions: [\n\t\t\t\t\t\t\t\t{ id: \"hours\", value: `${_(\"Hours per\")} ${_(unit)}` },\n\t\t\t\t\t\t\t\t{ id: \"tasks\", value: `${_(\"Tasks per\")} ${_(unit)}` },\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\tonChange: v => {\n\t\t\t\t\t\t\t\t\tthis.app.callEvent(\"rdiagram:unit:change\", [v]);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\tcols: [\n\t\t\t\t\t\tTreeView,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: compact ? \"spacer\" : \"resizer\",\n\t\t\t\t\t\t\tcss: \"webix_gantt_resizer\",\n\t\t\t\t\t\t\twidth: compact ? 1 : 4,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlocalId: \"diagram\",\n\t\t\t\t\t\t\trows: [ScalesView, DiagramView],\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\t}\n\n\tinit() {\n\t\tconst localState = createState({\n\t\t\ttop: 0,\n\t\t});\n\t\tthis.setParam(\"localState\", localState);\n\n\t\tthis.on(this.app, \"rdiagram:tree:toggle\", v => {\n\t\t\tif (v) this.$$(\"diagram\").show();\n\t\t\telse this.$$(\"diagram\").hide();\n\t\t});\n\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tconst radio = this.$$(\"radio\");\n\t\tthis.on(this.app, \"onScalesUpdate\", (scales, old) => {\n\t\t\tif (scales.minUnit !== old.minUnit) {\n\t\t\t\tradio.config.options.map(o => {\n\t\t\t\t\tconst words = o.value.split(\" \");\n\t\t\t\t\twords[words.length - 1] = _(scales.minUnit);\n\t\t\t\t\to.value = words.join(\" \");\n\t\t\t\t});\n\t\t\t\tradio.refresh();\n\t\t\t}\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class BaselineView extends JetView {\n\tconfig() {\n\t\tconst _ = (this._ = this.app.getService(\"locale\")._);\n\t\tconst calendar = {\n\t\t\tcss: \"webix_gantt_datepicker\",\n\t\t\ttype: \"calendar\",\n\t\t\tbody: {\n\t\t\t\theight: 270,\n\t\t\t\twidth: 250,\n\t\t\t\ticons: true,\n\t\t\t\tevents: date => this.app.config.isHoliday(date) && \"webix_cal_event\",\n\t\t\t},\n\t\t};\n\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"form\",\n\t\t\tborderless: true,\n\t\t\tautoheight: true,\n\t\t\telementsConfig: {\n\t\t\t\tlabelPosition: \"top\",\n\t\t\t},\n\t\t\tpadding: {\n\t\t\t\tleft: 3,\n\t\t\t\tright: 3,\n\t\t\t},\n\t\t\tvisibleBatch: \"added\",\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tbatch: \"added\",\n\t\t\t\t\trows: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\t\tname: \"planned_start\",\n\t\t\t\t\t\t\tlabel: _(\"Start date\"),\n\t\t\t\t\t\t\tsuggest: webix.copy(calendar),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\t\t\tname: \"planned_end\",\n\t\t\t\t\t\t\tlabel: _(\"End date\"),\n\t\t\t\t\t\t\tsuggest: webix.copy(calendar),\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"counter\",\n\t\t\t\t\t\t\tname: \"planned_duration\",\n\t\t\t\t\t\t\tcss: \"webix_gantt_form_counter\",\n\t\t\t\t\t\t\tmin: 1,\n\t\t\t\t\t\t\tmax: 1000,\n\t\t\t\t\t\t\tlabel: _(\"Duration\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbatch: \"none\",\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\t\t\ticon: \"wxi-plus\",\n\t\t\t\t\t\t\tautowidth: true,\n\t\t\t\t\t\t\tlabel: _(\"Add dates\"),\n\t\t\t\t\t\t\tclick: () => this.AddBtnClickHandler(),\n\t\t\t\t\t\t\tcss: \"webix_transparent\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tbatch: \"added\",\n\t\t\t\t\tcols: [\n\t\t\t\t\t\t{},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"button\",\n\t\t\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\t\t\ticon: \"wxi-trash\",\n\t\t\t\t\t\t\tautowidth: true,\n\t\t\t\t\t\t\tlabel: _(\"Remove dates\"),\n\t\t\t\t\t\t\tclick: () => this.RemoveBtnClickHandler(),\n\t\t\t\t\t\t\tcss: \"webix_transparent\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonChange: (n, o, config) => {\n\t\t\t\t\tif (this.Compact) this.UpdateTaskTime();\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (config == \"user\") this.UpdateTask();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t\treturn form;\n\t}\n\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tthis.Form = this.$$(\"form\");\n\n\t\t// changing links via bars and dnd\n\t\tthis.Tasks = this.app.getService(\"local\").tasks();\n\t\tthis.on(this.State.$changes, \"selected\", id => {\n\t\t\tif (id) this.FillData(id);\n\t\t});\n\t\tthis.on(this.Tasks.data, \"onStoreUpdated\", (id, obj, mode) => {\n\t\t\tif (mode == \"update\" && id == this.State.selected) this.FillData(id);\n\t\t});\n\t}\n\n\tFillData(id) {\n\t\tconst task = this.Tasks.getItem(id);\n\t\tif (task.planned_start) this.$$(\"form\").showBatch(\"added\");\n\t\telse this.$$(\"form\").showBatch(\"none\");\n\t\tthis.Form.setValues(this.Tasks.getItem(id));\n\t}\n\n\t/**\n\t * Prepares task  object for processing with respect to date-related changes\n\t * @param {Object} vals - object with form values\n\t * @returns {boolean} flag that indicates whether dates were updated or not\n\t */\n\tPrepareDates(vals) {\n\t\tconst f = (this._eventSource = this.Form.$eventSource.config.name);\n\n\t\tlet updateDates = true;\n\t\tif (\n\t\t\tf == \"planned_duration\" ||\n\t\t\t(f == \"planned_start\" && vals.type == \"project\")\n\t\t)\n\t\t\tvals.planned_end = null;\n\t\telse if (f == \"planned_end\" || f == \"planned_start\")\n\t\t\tvals.planned_duration = null;\n\t\telse updateDates = false;\n\n\t\treturn updateDates;\n\t}\n\t/**\n\t * Update task time and duration on data change in compact form\n\t */\n\tUpdateTaskTime() {\n\t\tconst vals = this.Form.getValues();\n\t\tconst updateDates = this.PrepareDates(vals);\n\t\tif (updateDates) {\n\t\t\tlet mode = this._eventSource ? this._eventSource.split(\"_\")[1] : null;\n\t\t\tif (mode == \"duration\") mode = null;\n\n\t\t\tthis.Ops.updatePlannedTaskDuration(vals, mode);\n\n\t\t\tthis.Form.blockEvent();\n\t\t\tthis.Form.setValues(vals, true);\n\t\t\tthis.Form.unblockEvent();\n\t\t}\n\t}\n\t/**\n\t * Saves changes\n\t * @returns {Promise} the result of a data operation (adding new event or updating)\n\t */\n\tUpdateTask() {\n\t\tconst id = this.State.selected;\n\t\tconst vals = this.Form.getValues();\n\t\tif (!this.Compact) this.PrepareDates(vals);\n\n\t\tlet mode = this._eventSource ? this._eventSource.split(\"_\")[1] : null;\n\t\tif (mode == \"duration\") mode = null;\n\t\tthis.Ops.updateTask(id, vals, mode, false, true);\n\t}\n\tAddBtnClickHandler() {\n\t\tconst id = this.State.selected;\n\t\tconst vals = this.Form.getValues();\n\t\tconst obj = {\n\t\t\tplanned_start: vals.start_date,\n\t\t\tplanned_end: vals.end_date,\n\t\t\tplanned_duration: vals.duration,\n\t\t};\n\t\tthis.Ops.updateTask(id, obj, null, false, true);\n\t}\n\tRemoveBtnClickHandler() {\n\t\tconst id = this.State.selected;\n\t\twebix\n\t\t\t.confirm(this._(\"Planned dates will be removed, are you sure?\"))\n\t\t\t.then(() => {\n\t\t\t\tthis.Ops.updateTask(\n\t\t\t\t\tid,\n\t\t\t\t\t{ planned_start: null, planned_end: null, planned_duration: null },\n\t\t\t\t\tnull,\n\t\t\t\t\tfalse,\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class TableView extends JetView {\n\tconfig() {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tconst table = {\n\t\t\tview: \"treetable\",\n\t\t\tcss: \"webix_gantt_tree webix_gantt_form_tree\",\n\t\t\theader: false,\n\t\t\tborderless: true,\n\t\t\tlocalId: \"links\",\n\t\t\tautoheight: true,\n\t\t\teditable: true,\n\t\t\tscroll: false,\n\t\t\thover: \"webix_gantt_link_table_hover\",\n\t\t\tscheme: {\n\t\t\t\t$group: {\n\t\t\t\t\tby: \"ttype\",\n\t\t\t\t},\n\t\t\t},\n\t\t\tcolumns: [\n\t\t\t\t{\n\t\t\t\t\tid: \"task\",\n\t\t\t\t\tcss: \"webix_gantt_title\",\n\t\t\t\t\theader: _(\"Task\"),\n\t\t\t\t\tfillspace: true,\n\t\t\t\t\ttemplate: function(obj) {\n\t\t\t\t\t\tif (obj.$group)\n\t\t\t\t\t\t\treturn `<span class=\"webix_strong\">${_(\n\t\t\t\t\t\t\t\tobj.ttype == \"source\" ? _(\"Successors\") : _(\"Predecessors\")\n\t\t\t\t\t\t\t)}</span>`;\n\t\t\t\t\t\telse return obj.text || _(\"(no title)\");\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"type\",\n\t\t\t\t\tcss: \"webix_gantt_type\",\n\t\t\t\t\theader: _(\"Link\"),\n\t\t\t\t\twidth: 140,\n\t\t\t\t\ttemplate: function(obj, c, v, conf) {\n\t\t\t\t\t\tif (obj.$group) return \"\";\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tconst type = conf.collection.getItem(v).value;\n\t\t\t\t\t\t\treturn `${type}<span class=\"webix_icon wxi-menu-down\"></span>`;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\teditor: \"richselect\",\n\t\t\t\t\toptions: [\n\t\t\t\t\t\t{ id: \"0\", value: _(\"End to start\") },\n\t\t\t\t\t\t{ id: \"1\", value: _(\"Start to start\") },\n\t\t\t\t\t\t{ id: \"2\", value: _(\"End to end\") },\n\t\t\t\t\t\t{ id: \"3\", value: _(\"Start to end\") },\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\twidth: 30,\n\t\t\t\t\tcss: \"webix_gantt_action\",\n\t\t\t\t\ttemplate: function(obj) {\n\t\t\t\t\t\treturn obj.$group\n\t\t\t\t\t\t\t? \"\"\n\t\t\t\t\t\t\t: \"<span class='webix_icon wxi-trash'></span>\";\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonBeforeEditStart: function(id) {\n\t\t\t\t\treturn !this.getItem(id).$group;\n\t\t\t\t},\n\t\t\t\tonBeforeEditStop: (v, editor) => {\n\t\t\t\t\tif (v.value != v.old) {\n\t\t\t\t\t\tthis.UpdateLink(editor.row, { type: v.value * 1 });\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonAfterLoad: function() {\n\t\t\t\t\tthis.openAll();\n\t\t\t\t},\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\t\"wxi-trash\": (e, id) => {\n\t\t\t\t\twebix\n\t\t\t\t\t\t.confirm({\n\t\t\t\t\t\t\tcontainer: this.app.getRoot().$view,\n\t\t\t\t\t\t\ttitle: _(\"Delete link\"),\n\t\t\t\t\t\t\ttext: _(\"The link will be deleted permanently, are you sure?\"),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() => this.DeleteLink(id));\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tpadding: { top: webix.skin.$active.layoutMargin.form, bottom: 5 },\n\t\t\trows: [table],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tthis.Links = this.$$(\"links\");\n\n\t\tthis.on(this.State.$changes, \"selected\", id => {\n\t\t\tif (id) this.FillData(id);\n\t\t});\n\n\t\t// changing links via bars and dnd\n\t\tconst links = this.app.getService(\"local\").links();\n\t\tthis.on(links.data, \"onStoreUpdated\", (_id, obj) => {\n\t\t\tif (obj) {\n\t\t\t\tconst tid = this.State.selected;\n\t\t\t\tif (obj.target === tid || obj.source === tid) {\n\t\t\t\t\tthis.FillData(tid);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tFillData(id) {\n\t\tconst local = this.app.getService(\"local\");\n\t\tconst related = local\n\t\t\t.getLinks(id, \"target\")\n\t\t\t.concat(local.getLinks(id, \"source\"));\n\n\t\tthis.Links.clearAll();\n\t\tif (related.length) {\n\t\t\tthis.Links.parse(related);\n\t\t\tthis.getRoot().show();\n\t\t} else {\n\t\t\tthis.getRoot().hide();\n\t\t}\n\t}\n\n\tUpdateLink(id, obj) {\n\t\tthis.Ops.updateLink(id, obj).then(() => {\n\t\t\tthis.Links.blockEvent();\n\t\t\tthis.Links.editCancel();\n\t\t\tthis.Links.unblockEvent();\n\n\t\t\t// must not give 0 ID to dropdown list of column editor\n\t\t\tobj.type += \"\";\n\t\t\tthis.Links.updateItem(id, obj);\n\t\t});\n\t}\n\n\tDeleteLink(id) {\n\t\tthis.Ops.removeLink(id).then(() => {\n\t\t\tthis.FillData(this.State.selected);\n\t\t});\n\t}\n}\n","webix.editors.gantt_numeditor = webix.extend(\n\t{\n\t\trender: function() {\n\t\t\tconst node = webix.editors.text.render.call(this);\n\t\t\tconst inp = node.querySelector(\"input\");\n\t\t\tinp.type = \"number\";\n\t\t\tinp.min = 0;\n\t\t\treturn node;\n\t\t},\n\t},\n\twebix.editors.text\n);\n","import { JetView } from \"webix-jet\";\nimport \"../../helpers/numeditor\";\n\nexport default class ResourcesView extends JetView {\n\tconfig() {\n\t\tconst _ = (this._ = this.app.getService(\"locale\")._);\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tthis.Helpers = this.app.getService(\"helpers\");\n\t\tconst conf = this.app.config;\n\t\tconst single = (this.IsSingle =\n\t\t\tconf.resources == \"single\" || conf.resourceCalendars);\n\n\t\tconst button = {\n\t\t\tcols: [\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\ttype: \"icon\",\n\t\t\t\t\ticon: \"wxi-plus\",\n\t\t\t\t\tautowidth: true,\n\t\t\t\t\tlocalId: \"addBtn\",\n\t\t\t\t\tlabel: _(\"Add assignment\"),\n\t\t\t\t\tclick: () => this.AddBtnClickHandler(),\n\t\t\t\t\tcss: \"webix_transparent\",\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t],\n\t\t};\n\t\tconst table = {\n\t\t\tview: \"treetable\",\n\t\t\tcss: \"webix_gantt_resource_table webix_gantt_tree webix_gantt_form_tree\",\n\t\t\theader: false,\n\t\t\tborderless: true,\n\t\t\tlocalId: \"resources\",\n\t\t\tautoheight: true,\n\t\t\teditable: true,\n\t\t\teditaction: \"custom\",\n\t\t\tscroll: false,\n\t\t\thover: \"webix_gantt_table_hover\",\n\t\t\trowHeight: Math.max(webix.skin.$active.rowHeight, 32),\n\t\t\tcolumns: [\n\t\t\t\t{\n\t\t\t\t\tid: \"resource\",\n\t\t\t\t\tcss: \"webix_gantt_title\",\n\t\t\t\t\tfillspace: true,\n\t\t\t\t\ttemplate: obj => this.ResourceTemplate(obj),\n\t\t\t\t\teditor: \"richselect\",\n\t\t\t\t\tsuggest: {\n\t\t\t\t\t\twidth: 250,\n\t\t\t\t\t\tcss: \"webix_gantt_select_editor_popup\",\n\t\t\t\t\t\tpadding: 0,\n\t\t\t\t\t\tpoint: 0,\n\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\twidth: 250,\n\t\t\t\t\t\t\ttype: {\n\t\t\t\t\t\t\t\theight: Math.max(webix.skin.$active.listItemHeight, 32),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\ttemplate: r =>\n\t\t\t\t\t\t\t\tsingle ? this.OptionTemplate(r) : this.EditorOptionTemplate(r),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\n\t\t\t\t{\n\t\t\t\t\tid: \"value\",\n\t\t\t\t\twidth: 85,\n\t\t\t\t\tcss: \"webix_gantt_value\",\n\t\t\t\t\ttemplate: obj => this.ValueTemplate(obj),\n\t\t\t\t\teditFormat: function(v) {\n\t\t\t\t\t\treturn parseFloat(v);\n\t\t\t\t\t},\n\t\t\t\t\teditParse: function(v) {\n\t\t\t\t\t\tv = parseFloat(v);\n\t\t\t\t\t\treturn isNaN(v) ? 0 : v;\n\t\t\t\t\t},\n\t\t\t\t\teditor: \"gantt_numeditor\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: \"remove\",\n\t\t\t\t\twidth: 30,\n\t\t\t\t\tcss: \"webix_gantt_action\",\n\t\t\t\t\ttemplate: obj => this.DeleteIconTemplate(obj),\n\t\t\t\t},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonItemClick: id => {\n\t\t\t\t\tif (!this.Table.getItem(id).$group && id.column != \"remove\") {\n\t\t\t\t\t\tthis.Table.editRow(id);\n\t\t\t\t\t\tif (id.column == \"value\")\n\t\t\t\t\t\t\tthis.Table.getEditor(id.row, \"resource\")\n\t\t\t\t\t\t\t\t.getPopup()\n\t\t\t\t\t\t\t\t.hide();\n\t\t\t\t\t\tthis.Table.getEditor(id.row, id.column).focus();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonBeforeEditStart: id => {\n\t\t\t\t\tconst item = this.Table.getItem(id.row);\n\t\t\t\t\tif (item.$group) return false;\n\t\t\t\t\tif (id.column == \"resource\") {\n\t\t\t\t\t\tthis.Table.addCellCss(\n\t\t\t\t\t\t\tid.row,\n\t\t\t\t\t\t\tid.column,\n\t\t\t\t\t\t\t\"webix_gantt_select_editor\"\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst r = id && !single ? item.resource : null;\n\t\t\t\t\t\tthis.FilterOptions(r);\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tonAfterEditStart: id => {\n\t\t\t\t\tif (id.column == \"value\") {\n\t\t\t\t\t\tconst item = this.Table.getItem(id.row);\n\t\t\t\t\t\tconst node = this.Table.getEditor(id.row, \"value\").getInputNode();\n\t\t\t\t\t\tconst range = this.GetRange(item);\n\t\t\t\t\t\tif (range) this.ApplyEditorLimits(node, range);\n\t\t\t\t\t\tconst step = this.GetValueStep(item);\n\t\t\t\t\t\tif (step) this.ApplyEditorStep(node, step);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonBeforeEditStop: (state, editor) => {\n\t\t\t\t\tthis.Table.removeCellCss(\n\t\t\t\t\t\teditor.row,\n\t\t\t\t\t\t\"resource\",\n\t\t\t\t\t\t\"webix_gantt_select_editor\"\n\t\t\t\t\t);\n\t\t\t\t\tif (state.value != state.old) {\n\t\t\t\t\t\tlet obj = {};\n\t\t\t\t\t\tobj[editor.column] = state.value;\n\t\t\t\t\t\tif (editor.column == \"value\") {\n\t\t\t\t\t\t\tconst item = this.Table.getItem(editor.row);\n\t\t\t\t\t\t\tconst range = this.GetRange(item);\n\t\t\t\t\t\t\tif (range) this.ApplyValueRange(obj, range);\n\t\t\t\t\t\t\telse if (obj.value < 0) obj.value = 0;\n\t\t\t\t\t\t\teditor.getInputNode().value = obj.value;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.UpdateAssignment(editor.row, obj);\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tonAfterLoad: function() {\n\t\t\t\t\tthis.openAll();\n\t\t\t\t},\n\t\t\t},\n\t\t\tonClick: {\n\t\t\t\twebix_gantt_remove_icon: (e, id) => {\n\t\t\t\t\twebix\n\t\t\t\t\t\t.confirm({\n\t\t\t\t\t\t\tcontainer: this.app.getRoot().$view,\n\t\t\t\t\t\t\ttitle: _(\"Delete assignment\"),\n\t\t\t\t\t\t\ttext: _(\"Are you sure to delete this assignment?\"),\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.then(() => this.RemoveAssignment(id.row));\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t\tif (!single)\n\t\t\ttable.scheme = {\n\t\t\t\t$group: {\n\t\t\t\t\tby: \"category\",\n\t\t\t\t},\n\t\t\t};\n\n\t\treturn {\n\t\t\tmargin: webix.skin.$active.layoutMargin.form,\n\t\t\tpadding: { top: webix.skin.$active.layoutMargin.form, bottom: 5 },\n\t\t\trows: [table, button],\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tthis.Helpers = this.app.getService(\"helpers\");\n\t\tthis.Table = this.$$(\"resources\");\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tthis.Resources = this.Local.resources();\n\t\tif (!this.app.config.resources) return false;\n\t\tthis.on(this.State.$changes, \"selected\", id => {\n\t\t\tif (id) this.FillData(id);\n\t\t});\n\t}\n\n\t/**\n\t * Display assignments table\n\t * @param {string} id - a task id\n\t */\n\tFillData(id) {\n\t\tconst item = this.Local.tasks().getItem(id);\n\t\tif (item.type != \"task\") return false;\n\n\t\tconst loader = this.Local.getAssignments(id);\n\t\tloader.then(assignees => {\n\t\t\tif (!this.getRoot()) return false;\n\t\t\tthis.Table.clearAll();\n\t\t\tthis.Table.getColumnConfig(\"resource\").collection = this.Resources;\n\n\t\t\tif (assignees.length) {\n\t\t\t\tthis.Table.show();\n\t\t\t\tthis.Table.parse(this.GetData(assignees));\n\t\t\t\tif (this.IsSingle) this.$$(\"addBtn\").disable();\n\t\t\t} else {\n\t\t\t\tif (this.IsSingle) this.$$(\"addBtn\").enable();\n\t\t\t\tthis.Table.hide();\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Get treetable data\n\t * @param {array} assignments - an array of assignments data\n\t * @returns {array} data array\n\t */\n\n\tGetData(assignments) {\n\t\tassignments.sort(this.app.getService(\"operations\").sortResources);\n\t\treturn assignments;\n\t}\n\n\t/**\n\t * Filters an option collection\n\t * @param {string} id - the selected resource id\n\t */\n\tFilterOptions(id) {\n\t\tlet tableIds = [];\n\t\tconst category = id ? this.Resources.getItem(id)[\"category_id\"] : null;\n\t\tthis.Table.data.each(item => {\n\t\t\ttableIds.push(item.resource);\n\t\t});\n\n\t\tthis.Resources.filter(item => {\n\t\t\treturn (\n\t\t\t\t(!category || item[\"category_id\"] == category) &&\n\t\t\t\t(tableIds.indexOf(item.id) < 0 || (id && item.id == id))\n\t\t\t);\n\t\t});\n\t}\n\n\t/**\n\t * Updates an assignment\n\t * @param {string} id - an assignment id\n\t * @param {object} obj - a hash of new assignment properties\n\t */\n\tUpdateAssignment(id, obj) {\n\t\t// remove \"focus\" style for a richselect cell editor when\n\t\t// the editor is closed without event calls\n\t\tconst node = this.Table.$view.querySelector(\".webix_gantt_select_editor\");\n\t\tif (node) {\n\t\t\tconst rInd = node.getAttribute(\"aria-rowindex\") * 1;\n\t\t\tthis.Table.removeCellCss(\n\t\t\t\tthis.Table.data.getIdByIndex(rInd - 1),\n\t\t\t\t\"resource\",\n\t\t\t\t\"webix_gantt_select_editor\"\n\t\t\t);\n\t\t}\n\n\t\tthis.Ops.updateAssignment(id, obj).then(() => {\n\t\t\tthis.CloseEditor(id, obj);\n\t\t});\n\t}\n\n\t/**\n\t * Get range for unit values\n\t * @param {object} item - an assignment item object\n\t * @returns {array} an array with two numeric values [min,max]\n\t */\n\tGetRange(item) {\n\t\tconst resourceItem = this.Resources.getItem(item.resource);\n\t\treturn this.Helpers.getResourceValueRange(resourceItem);\n\t}\n\n\t/**\n\t * Apply limits to \"value\" property of a data object\n\t * @param {object} obj - an object with a value property to change\n\t * @param {array} range - a value range [min,max]\n\t */\n\tApplyValueRange(obj, range) {\n\t\tif (obj.value < range[0]) obj.value = range[0];\n\t\telse if (obj.value > range[1]) obj.value = range[1];\n\t}\n\t/**\n\t * Apply limits to editor value\n\t * @param {HTMLInputElement} node - an editor input\n\t * @param {array} range - a value range [min,max]\n\t */\n\tApplyEditorLimits(node, range) {\n\t\tnode.min = range[0];\n\t\tnode.max = range[1];\n\t}\n\t/**\n\t * Get set for unit values\n\t * @param {object} item - an assignment item object\n\t * @returns {number} a step value\n\t */\n\tGetValueStep(item) {\n\t\tconst resourceItem = this.Resources.getItem(item.resource);\n\t\treturn this.Helpers.getResourceValueStep(resourceItem);\n\t}\n\n\t/**\n\t * Apply changing step to editor value\n\t * @param {HTMLInputElement} node - an editor input\n\t * @param {number} step - changing step\n\t */\n\tApplyEditorStep(node, step) {\n\t\tnode.step = step;\n\t}\n\n\t/**\n\t * Closes editor and updated table row\n\t * @param {string} id - an assignment id\n\t * @param {object} obj - assignment properties\n\t */\n\tCloseEditor(id, obj) {\n\t\tthis.Table.blockEvent();\n\t\tthis.Table.editCancel();\n\t\tthis.Table.unblockEvent();\n\n\t\tthis.Table.updateItem(id, obj);\n\t}\n\n\t/**\n\t * Removes assignment\n\t * @param {string} id - assignment id\n\t */\n\tRemoveAssignment(id) {\n\t\tthis.Ops.removeAssignment(id).then(() => {\n\t\t\tthis.FillData(this.State.selected);\n\t\t});\n\t}\n\n\t/**\n\t *  \"Add\" button click handler\n\t */\n\tAddBtnClickHandler() {\n\t\tthis.FilterOptions();\n\t\twebix.delay(() => {\n\t\t\tthis.ShowPopup();\n\t\t});\n\t}\n\n\t/**\n\t * Adds an assignment and a new row to \"assignees\" table\n\t * @param {object} obj - assignment properties\n\t */\n\tAddAssignment(obj) {\n\t\tif (this.IsSingle) this.$$(\"addBtn\").disable();\n\t\tthis.Ops.addAssignment({\n\t\t\tresource: obj.id,\n\t\t\tvalue: this.Helpers.getDefaultResourceValue(obj),\n\t\t\ttask: this.State.selected,\n\t\t}).then(() => {\n\t\t\tthis.FillData(this.State.selected);\n\t\t});\n\t}\n\t/**\n\t * A template for a resource column\n\t * @param {object} obj - a data item\n\t * @returns {string} an html string of a column cell\n\t */\n\tResourceTemplate(obj) {\n\t\tif (obj.$group) return `<span class=\"webix_strong\">${obj.category}</span>`;\n\t\telse if (obj.resource) {\n\t\t\tconst item = this.Resources.getItem(obj.resource);\n\t\t\treturn this.EditorTemplate(item);\n\t\t}\n\t\treturn \"\";\n\t}\n\t/**\n\t * The template for value column\n\t * @param {object} obj - an assignment data object\n\t * @returns {string} html string\n\t */\n\tValueTemplate(obj) {\n\t\tif (obj.$group) return \"\";\n\t\tconst v = obj.value;\n\t\treturn (\n\t\t\t(isNaN(v) ? this.Helpers.getDefaultResourceValue(obj) : v) +\n\t\t\tthis.GetUnitName(obj)\n\t\t);\n\t}\n\n\t/**\n\t * Get a unit name for a resource\n\t * @param {object} obj - resource object\n\t * @returns {string} a unit name\n\t */\n\tGetUnitName(obj) {\n\t\treturn this._(this.Helpers.getResourceUnit(obj));\n\t}\n\n\t/**\n\t * The template for \"delete\" column\n\t * @param {object} obj - assignment data object\n\t * @returns {string} html string\n\t */\n\tDeleteIconTemplate(obj) {\n\t\tif (obj.$group) return \"\";\n\t\treturn \"<span class='webix_icon wxi-trash webix_gantt_remove_icon'></span>\";\n\t}\n\n\t/**\n\t * Get popup configuration\n\t * @returns {object} popup config\n\t */\n\tGetPopupConfig() {\n\t\treturn {\n\t\t\tview: \"suggest\",\n\t\t\tlocalId: \"popup\",\n\t\t\twidth: 320,\n\t\t\tpadding: 0,\n\t\t\tpoint: 0,\n\t\t\tfitMaster: false,\n\t\t\tborderless: true,\n\t\t\tcss: \"webix_gantt_select_editor_popup\",\n\t\t\tbody: {\n\t\t\t\tview: \"list\",\n\t\t\t\tminHeight: 28,\n\t\t\t\ttype: {\n\t\t\t\t\theight: Math.max(webix.skin.$active.listItemHeight, 32),\n\t\t\t\t},\n\t\t\t\tdata: this.Resources,\n\t\t\t\ttemplate: obj => this.OptionTemplate(obj),\n\t\t\t\ton: {\n\t\t\t\t\tonItemClick: id => {\n\t\t\t\t\t\tthis.AddAssignment(this.Resources.getItem(id));\n\t\t\t\t\t\tthis.Popup.hide();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\t/**\n\t * Show resources popup\n\t */\n\tShowPopup() {\n\t\tif (!this.Popup || !this.Popup.$view) {\n\t\t\tthis.Popup = this.ui(this.GetPopupConfig());\n\t\t\tthis.SetPopupPlaceholder();\n\t\t}\n\n\t\tthis.Popup.show(this.$$(\"addBtn\").$view, { x: 1 });\n\t}\n\n\t/**\n\t * Set a placeholder for the \"Add\" popup placeholder\n\t * @param {string} placeholder - a popup placeholder (optional)\n\t */\n\tSetPopupPlaceholder(placeholder) {\n\t\tconst list = this.Popup.getBody();\n\t\tlist.$view.firstChild.setAttribute(\n\t\t\t\"placeholder\",\n\t\t\tplaceholder || this._(\"No resources to add\")\n\t\t);\n\t}\n\n\t/**\n\t * A template for \"Add assignment\" popup options\n\t * @param {object} obj - a data item\n\t * @returns {string} an html string of an editor option\n\t */\n\tOptionTemplate(obj) {\n\t\tconst avatar = this.Helpers.resourceAvatar(obj);\n\t\tconst name =\n\t\t\t\"<div class='webix_gantt_editor_avatar_name'>\" + obj.name + \"</div>\";\n\t\tconst avatarStr = `<div class=\"webix_gantt_avatar_box_inline\">${avatar +\n\t\t\tname}</div>`;\n\t\tconst dpt = `<span class='webix_gantt_resource_section'>${obj.category}</span>`;\n\t\treturn (\n\t\t\t\"<div class='webix_gantt_avatar_option_box'>\" + avatarStr + dpt + \"</div>\"\n\t\t);\n\t}\n\n\t/**\n\t * Cell template\n\t * @param {object} obj - resource object\n\t * @returns {string} html string for resource editable cell\n\t */\n\tEditorTemplate(obj) {\n\t\tconst avatar = this.Helpers.resourceAvatar(obj);\n\t\tconst name =\n\t\t\t\"<div class='webix_gantt_editor_avatar_name'>\" + obj.name + \"</div>\";\n\t\tconst icon = \"<span class='webix_icon wxi-menu-down'></span>\";\n\t\treturn `<div class=\"webix_gantt_avatar_box\">${avatar} ${name}${icon}</div>`;\n\t}\n\n\t/**\n\t * Popup option template for resource editor\n\t * @param {object} obj - resource object\n\t * @returns {string} html string for an option\n\t */\n\tEditorOptionTemplate(obj) {\n\t\tconst avatar = this.Helpers.resourceAvatar(obj);\n\t\tconst name =\n\t\t\t\"<div class='webix_gantt_editor_avatar_name'>\" + obj.name + \"</div>\";\n\t\treturn `<div class=\"webix_gantt_avatar_box\">${avatar} ${name}</div>`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport TableView from \"./links\";\nimport ResourcesView from \"./resources\";\nimport BaselineView from \"./baseline\";\n\nexport default class FormView extends JetView {\n\tconfig() {\n\t\tthis.Compact = this.getParam(\"compact\", true);\n\t\tconst _ = this.app.getService(\"locale\")._;\n\t\tthis.isResources = this.app.config.resources;\n\t\tthis.State = this.getParam(\"state\", true);\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst bar = {\n\t\t\tview: \"toolbar\",\n\t\t\tcss: \"webix_subbar\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: aSkin.layoutPadding.form,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\tclick: () => this.Close(),\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tview: \"button\",\n\t\t\t\t\twidth: 130,\n\t\t\t\t\tcss: \"webix_primary\",\n\t\t\t\t\tvalue: _(\"Done\"),\n\t\t\t\t\tclick: () => this.Done(),\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\tconst calendar = {\n\t\t\tcss: \"webix_gantt_datepicker\",\n\t\t\ttype: \"calendar\",\n\t\t\t//localId: \"calendar\",\n\t\t\tbody: {\n\t\t\t\theight: 270,\n\t\t\t\twidth: 250,\n\t\t\t\ticons: true,\n\t\t\t\tevents: date => this.app.config.isHoliday(date) && \"webix_cal_event\",\n\t\t\t},\n\t\t};\n\n\t\tconst types = [\n\t\t\t{ id: \"task\", value: _(\"Task\") },\n\t\t\t{ id: \"milestone\", value: _(\"Milestone\") },\n\t\t];\n\t\tif (!this.app.config.projects) {\n\t\t\ttypes.splice(1, 0, { id: \"project\", value: _(\"Project\") });\n\t\t}\n\n\t\tlet accItems = [];\n\t\tif (this.app.config.links)\n\t\t\taccItems.push({\n\t\t\t\theader: _(\"Related tasks\"),\n\t\t\t\tbody: TableView,\n\t\t\t\tcollapsed: true,\n\t\t\t});\n\t\tif (this.isResources)\n\t\t\taccItems.push({\n\t\t\t\tlocalId: \"resourcesItem\",\n\t\t\t\theader:\n\t\t\t\t\tthis.isResources == \"single\" || this.app.config.resourceCalendars\n\t\t\t\t\t\t? _(\"Assignment\")\n\t\t\t\t\t\t: _(\"Assignments\"),\n\t\t\t\tbody: { $subview: ResourcesView, name: \"resources\" },\n\t\t\t\tcollapsed: true,\n\t\t\t\thidden: true,\n\t\t\t});\n\t\tif (this.State.baseline)\n\t\t\taccItems.push({\n\t\t\t\tlocalId: \"baselineItem\",\n\t\t\t\theader: _(\"Planned dates\"),\n\t\t\t\tbody: { $subview: BaselineView, name: \"baseline\" },\n\t\t\t\tcollapsed: true,\n\t\t\t\thidden: true,\n\t\t\t});\n\n\t\tconst accordion = {\n\t\t\tmulti: true,\n\t\t\tview: \"accordion\",\n\t\t\tborderless: true,\n\t\t\ttype: \"clean\",\n\t\t\tmargin: 10,\n\t\t\tcss: \"webix_gantt_accordion\",\n\t\t\trows: accItems,\n\t\t};\n\n\t\tconst form = {\n\t\t\tview: \"form\",\n\t\t\tlocalId: \"form\",\n\t\t\tborderless: true,\n\t\t\tautoheight: false,\n\t\t\tscroll: true,\n\t\t\telementsConfig: {\n\t\t\t\tlabelPosition: \"top\",\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{ view: \"text\", name: \"text\", label: _(\"Title\") },\n\t\t\t\t{\n\t\t\t\t\tview: \"richselect\",\n\t\t\t\t\tlocalId: \"types\",\n\t\t\t\t\tname: \"type\",\n\t\t\t\t\tlabel: _(\"Type\"),\n\t\t\t\t\toptions: types,\n\t\t\t\t\ton: {\n\t\t\t\t\t\tonChange: v => this.ToggleControls(v),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\tname: \"start_date\",\n\t\t\t\t\tlabel: _(\"Start date\"),\n\t\t\t\t\tsuggest: webix.copy(calendar),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"datepicker\",\n\t\t\t\t\tname: \"end_date\",\n\t\t\t\t\tlabel: _(\"End date\"),\n\t\t\t\t\tsuggest: webix.copy(calendar),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"counter\",\n\t\t\t\t\tname: \"duration\",\n\t\t\t\t\tcss: \"webix_gantt_form_counter\",\n\t\t\t\t\tmin: 1,\n\t\t\t\t\tmax: 1000,\n\t\t\t\t\tlabel: _(\"Duration\"),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tview: \"slider\",\n\t\t\t\t\tname: \"progress\",\n\t\t\t\t\ttitle: webix.template(\"#value#%\"),\n\t\t\t\t\tlabel: _(\"Progress\"),\n\t\t\t\t},\n\t\t\t\taccordion,\n\t\t\t\t{\n\t\t\t\t\tview: \"textarea\",\n\t\t\t\t\tname: \"details\",\n\t\t\t\t\tlabel: _(\"Notes\"),\n\t\t\t\t\theight: 150,\n\t\t\t\t},\n\t\t\t],\n\t\t\ton: {\n\t\t\t\tonChange: (n, o, config) => {\n\t\t\t\t\tif (this.Compact) this.UpdateTaskTime();\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (config == \"user\")\n\t\t\t\t\t\t\tthis.UpdateTask().then(() => {\n\t\t\t\t\t\t\t\t// redraw all bars because a branch may be closed or opened in tree\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tthis._eventSource === \"type\" &&\n\t\t\t\t\t\t\t\t\tconfig === \"user\" &&\n\t\t\t\t\t\t\t\t\t(n === \"split\" || o === \"split\")\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\tthis.Tasks.data.callEvent(\"onStoreUpdated\", []);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tview: \"proxy\", // for borders\n\t\t\tbody: {\n\t\t\t\tmargin: 0,\n\t\t\t\tpadding: { bottom: 14 },\n\t\t\t\trows: [bar, form],\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tthis.Tasks = this.Local.tasks();\n\t\tthis.Form = this.$$(\"form\");\n\n\t\t// fills form with data of selected and newly created task\n\t\tthis.on(this.State.$changes, \"selected\", id => {\n\t\t\tif (id) {\n\t\t\t\tthis.FillData(id);\n\t\t\t}\n\t\t});\n\n\t\t// updates for start and end dates of task while dnd happens and form is open\n\t\tthis.on(this.Tasks.data, \"onStoreUpdated\", (id, obj, mode) => {\n\t\t\tif (mode == \"update\" && id == this.State.selected)\n\t\t\t\tthis.FillData(this.State.selected);\n\t\t});\n\n\t\t// \"resources\" view shows only \"task\" items (disable \"type\" select for it)\n\t\tthis.on(this.State.$changes, \"display\", v => {\n\t\t\tconst typeSelect = this.$$(\"form\").elements[\"type\"];\n\t\t\tif (v == \"tasks\") typeSelect.enable();\n\t\t\telse if (v == \"resources\") typeSelect.disable();\n\t\t});\n\t\tif (this.app.config.resourceCalendars)\n\t\t\tthis.on(this.Local.assignments().data, \"onStoreUpdated\", () =>\n\t\t\t\tthis.SetResourceHolidays()\n\t\t\t);\n\t\tthis.on(this.State.$changes, \"baseline\", (v, old) => {\n\t\t\tif (!webix.isUndefined(old))\n\t\t\t\tthis.SetBaselineVisibility(this.Tasks.getItem(this.State.selected));\n\t\t});\n\t}\n\n\t/**\n\t * Applies task selection\n\t * @param {(string|number)} id - the ID of a task\n\t */\n\tFillData(id) {\n\t\tconst item = this.Tasks.getItem(id);\n\n\t\tconst typeList = this.$$(\"types\").getList();\n\t\tif (this.app.config.split && item.$count) {\n\t\t\tif (!typeList.exists(\"split\"))\n\t\t\t\ttypeList.add({\n\t\t\t\t\tid: \"split\",\n\t\t\t\t\tvalue: this.app.getService(\"locale\")._(\"Split task\"),\n\t\t\t\t});\n\t\t} else {\n\t\t\tif (typeList.exists(\"split\")) typeList.remove(\"split\");\n\t\t}\n\n\t\tif (this.app.config.projects) {\n\t\t\tthis.LimitTypeOptions(item);\n\t\t}\n\t\tif (this.app.config.resourceCalendars) this.SetResourceHolidays();\n\n\t\tif (this.isResources) this.SetResourcesVisibility(item);\n\t\tif (this.State.baseline) this.SetBaselineVisibility(item);\n\t\tthis.Form.setValues(item);\n\t\tthis.Form.focus();\n\t}\n\n\t/**\n\t * Hide/show the \"Assignments\" accordion item depending on a task type\n\t * @param {object} item - a task data object\n\t */\n\tSetResourcesVisibility(item) {\n\t\tconst layout = this.$$(\"resourcesItem\");\n\t\tif (item.type == \"task\") {\n\t\t\tif (!layout.isVisible()) {\n\t\t\t\tconst sub = this.getSubView(\"resources\");\n\t\t\t\tif (sub) sub.FillData(item.id);\n\t\t\t\tlayout.show();\n\t\t\t}\n\t\t} else if (layout.isVisible()) layout.hide();\n\t}\n\t/**\n\t * Hide/show the \"Assignments\" accordion item depending on a task type\n\t * @param {object} item - a task data object\n\t */\n\tSetBaselineVisibility(item) {\n\t\tconst layout = this.$$(\"baselineItem\");\n\t\tif (\n\t\t\tthis.State.baseline &&\n\t\t\t(item.type == \"task\" || item.type == \"project\")\n\t\t) {\n\t\t\tif (!layout.isVisible()) {\n\t\t\t\tconst sub = this.getSubView(\"baseline\");\n\t\t\t\tif (sub) sub.FillData(item.id);\n\t\t\t\tlayout.show();\n\t\t\t}\n\t\t} else if (layout.isVisible()) layout.hide();\n\t}\n\n\t/**\n\t * Prohibits the user from selecting the type incompatible with other data and relations of a task\n\t * @param {Object} item - the data object of a task\n\t */\n\tLimitTypeOptions(item) {\n\t\tconst typeSelect = this.Form.elements.type;\n\t\tif (item.type === \"project\") typeSelect.hide();\n\t\telse typeSelect.show();\n\t}\n\n\t/**\n\t * Prepares task  object for processing with respect to date-related changes\n\t * @param {Object} vals - object with form values\n\t * @returns {boolean} flag that indicates whether dates were updated or not\n\t */\n\tPrepareDates(vals) {\n\t\tconst f = (this._eventSource = this.Form.$eventSource.config.name);\n\n\t\tlet updateDates = true;\n\t\tif (f == \"duration\" || (f == \"start_date\" && vals.type == \"project\"))\n\t\t\tvals.end_date = null;\n\t\telse if (f == \"end_date\" || f == \"start_date\") vals.duration = null;\n\t\telse updateDates = false;\n\n\t\treturn updateDates;\n\t}\n\t/**\n\t * Update task time and duration on data change in compact form\n\t */\n\tUpdateTaskTime() {\n\t\tconst vals = this.Form.getValues();\n\t\tconst updateDates = this.PrepareDates(vals);\n\n\t\t// expand branches with subtasks that are not split anymore\n\t\tif (this._eventSource === \"type\" && vals.type !== \"split\")\n\t\t\tvals.open = vals.opened = 1;\n\n\t\tconst textUpdated = this.RemoveTagsFromText(vals);\n\t\tif (textUpdated) {\n\t\t\tthis.Form.blockEvent();\n\t\t\tthis.Form.setValues(vals, true);\n\t\t\tthis.Form.unblockEvent();\n\t\t}\n\n\t\tif (updateDates) {\n\t\t\tconst mode = this._eventSource ? this._eventSource.split(\"_\")[0] : null;\n\t\t\tthis.Ops.updateTaskDuration(vals, mode);\n\n\t\t\tthis.Form.blockEvent();\n\t\t\tthis.Form.setValues(vals, true);\n\t\t\tthis.Form.unblockEvent();\n\t\t}\n\t}\n\n\t/**\n\t * Removes HTML tags from text fields\n\t * @param {Object} vals - the changed values from the form\n\t * @returns {boolean} - true if there is a text field in the changed values, false otherwise\n\t */\n\tRemoveTagsFromText(vals) {\n\t\tif (this._eventSource === \"text\" || this._eventSource === \"details\") {\n\t\t\tvals[this._eventSource] = (vals[this._eventSource] || \"\").replace(\n\t\t\t\t/(<[^>]+>|^\\s+|\\s+$)/gi,\n\t\t\t\t\"\"\n\t\t\t);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\t/**\n\t * Saves changes\n\t * @returns {Promise} the result of a data operation (adding new event or updating)\n\t */\n\tUpdateTask() {\n\t\tconst id = this.State.selected;\n\t\tconst vals = this.Form.getValues();\n\t\tif (!this.Compact) {\n\t\t\tthis.PrepareDates(vals);\n\t\t\tthis.RemoveTagsFromText(vals);\n\t\t}\n\n\t\tconst mode = this._eventSource ? this._eventSource.split(\"_\")[0] : null;\n\n\t\t// expand branches with subtasks that are not split anymore\n\t\tif (this._eventSource === \"type\" && vals.type !== \"split\")\n\t\t\tvals.open = vals.opened = 1;\n\n\t\tthis._inProgress = this.Ops.updateTask(id, vals, mode);\n\n\t\tthis._inProgress.finally(() => (this._inProgress = null));\n\t\treturn this._inProgress;\n\t}\n\n\t/**\n\t * Switches end date, duration and progress controls and enables or disables them depending on the type of the task\n\t * @param {string} v - the option chosen in the type selector: \"project\", \"task\", \"milestone\"\n\t */\n\tToggleControls(v) {\n\t\tthis.Form.elements.end_date.show();\n\t\tthis.Form.elements.duration.show();\n\t\tthis.Form.elements.progress.show();\n\t\tthis.Form.elements.end_date.enable();\n\t\tthis.Form.elements.duration.enable();\n\t\tthis.Form.elements.progress.enable();\n\n\t\tif (v == \"project\" || v == \"milestone\") {\n\t\t\tconst action = v == \"project\" ? \"disable\" : \"hide\";\n\t\t\tthis.Form.elements.end_date[action]();\n\t\t\tthis.Form.elements.duration[action]();\n\t\t\tthis.Form.elements.progress[action]();\n\t\t}\n\t}\n\n\t/**\n\t * Handles clicks on the 'cross' icon and closes the form\n\t * if there are unsaved changes, initiates saving after confirmation from the user\n\t */\n\tClose() {\n\t\tif (this.Compact && this.Form.isDirty()) {\n\t\t\tconst _ = this.app.getService(\"locale\")._;\n\t\t\twebix\n\t\t\t\t.confirm({\n\t\t\t\t\tcontainer: this.app.getRoot().$view,\n\t\t\t\t\ttext: _(\"Save changes?\"),\n\t\t\t\t})\n\t\t\t\t.then(() => this.Done(true), () => this.Back(true));\n\t\t} else {\n\t\t\tthis.Back(true);\n\t\t}\n\t}\n\n\t/**\n\t * Closes the form and either closes the whole right panel or shows \"info\"\n\t * @param {Boolean} exit - if true, the right panel will be closed; otherwise, right panel stays, form closes, \"info\" shows up\n\t */\n\tBack(exit) {\n\t\tif (exit)\n\t\t\tthis.State.$batch({\n\t\t\t\tedit: null,\n\t\t\t\tselected: null,\n\t\t\t});\n\t\telse this.State.edit = null;\n\t}\n\n\t/**\n\t * Finishes task editing and closes the form\n\t * @param {Boolean} exit - if true, the right panel will be closed; otherwise, right panel stays, form closes, info shows up\n\t */\n\tDone(exit) {\n\t\tif (this.Compact && this.Form.isDirty()) {\n\t\t\tif (this._inProgress)\n\t\t\t\tthis._inProgress.then(() => {\n\t\t\t\t\tthis.Back(exit);\n\t\t\t\t});\n\t\t\telse this.UpdateTask().then(() => this.Back(exit));\n\t\t} else this.Back(exit);\n\t}\n\n\tSetResourceHolidays() {\n\t\tlet arr = [];\n\t\tconst els = this.Form.elements;\n\t\tconst h = this.app.getService(\"helpers\");\n\t\tarr.push(els[\"start_date\"], els[\"end_date\"]);\n\t\tconst calendar = this.Local.getTaskCalendar(this.State.selected);\n\t\tarr.forEach(el => {\n\t\t\tconst c = el.getPopup().getBody();\n\t\t\tc.config.events = date =>\n\t\t\t\t(calendar\n\t\t\t\t\t? h.isResourceHoliday(date, calendar)\n\t\t\t\t\t: this.app.config.isHoliday(date)) && \"webix_cal_event\";\n\t\t\tc.refresh();\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class TaskView extends JetView {\n\tconfig() {\n\t\tconst _ = (this._ = this.app.getService(\"locale\")._);\n\t\tconst state = (this.State = this.getParam(\"state\", true));\n\n\t\tconst editButton = {\n\t\t\tview: \"button\",\n\t\t\twidth: 130,\n\t\t\tlabel: _(\"Edit\"),\n\t\t\tcss: \"webix_primary\",\n\t\t\tclick: () => this.EditTask(),\n\t\t};\n\n\t\tconst aSkin = webix.skin.$active;\n\t\tconst bar = {\n\t\t\tview: \"toolbar\",\n\t\t\tcss: \"webix_subbar\",\n\t\t\tborderless: true,\n\t\t\tpadding: {\n\t\t\t\tleft: aSkin.layoutPadding.form - (aSkin.inputHeight - 20) / 2,\n\t\t\t\tright: aSkin.layoutPadding.form,\n\t\t\t},\n\t\t\telements: [\n\t\t\t\t{\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-close\",\n\t\t\t\t\tclick: () => this.Close(),\n\t\t\t\t},\n\t\t\t\t{},\n\t\t\t\t!state.readonly ? editButton : {},\n\t\t\t],\n\t\t};\n\n\t\tconst info = {\n\t\t\tlocalId: \"text\",\n\t\t\tview: \"template\",\n\t\t\tcss: \"webix_gantt_task_info\",\n\t\t\ttemplate: obj => this.InfoTemplate(obj),\n\t\t\tborderless: true,\n\t\t};\n\n\t\tconst deleteButton = {\n\t\t\tview: \"button\",\n\t\t\tlabel: _(\"Delete task\"),\n\t\t\tcss: \"webix_danger webix_gantt_danger\",\n\t\t\talign: \"center\",\n\t\t\tinputWidth: 330,\n\t\t\tclick: () => {\n\t\t\t\twebix\n\t\t\t\t\t.confirm({\n\t\t\t\t\t\tcontainer: this.app.getRoot().$view,\n\t\t\t\t\t\ttitle: _(\"Delete task\"),\n\t\t\t\t\t\ttext: _(\"The task will be deleted permanently, are you sure?\"),\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => this.DeleteTask());\n\t\t\t},\n\t\t};\n\n\t\treturn {\n\t\t\tview: \"proxy\", // for borders\n\t\t\tbody: {\n\t\t\t\tmargin: 0,\n\t\t\t\trows: [\n\t\t\t\t\tbar,\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: \"form\",\n\t\t\t\t\t\tborderless: true,\n\t\t\t\t\t\trows: [info, !state.readonly ? deleteButton : {}],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t},\n\t\t};\n\t}\n\n\tinit() {\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tthis.Tasks = this.Local.tasks();\n\t\tthis.Text = this.$$(\"text\");\n\t\tthis.isResources = this.app.config.resources;\n\n\t\tthis.on(this.State.$changes, \"selected\", id => {\n\t\t\tif (id) this.FillTemplate(id);\n\t\t});\n\n\t\tthis.on(this.Tasks.data, \"onStoreUpdated\", (id, obj, mode) => {\n\t\t\tif (mode == \"update\" && id == this.State.selected) {\n\t\t\t\tthis.FillTemplate(this.State.selected);\n\t\t\t}\n\t\t});\n\n\t\t// changing links via bars and dnd\n\t\tconst links = this.Local.links();\n\t\tthis.on(links.data, \"onStoreUpdated\", (_id, obj) => {\n\t\t\tif (obj) {\n\t\t\t\tconst tid = this.State.selected;\n\t\t\t\tif (obj.target === tid || obj.source === tid) {\n\t\t\t\t\tthis.FillTemplate(tid);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (this.isResources) {\n\t\t\tthis.on(this.Local.assignments().data, \"onStoreUpdated\", (id, obj) => {\n\t\t\t\tif (obj && obj.task == this.State.selected) this.FillTemplate(obj.task);\n\t\t\t});\n\t\t}\n\t\tthis.on(this.State.$changes, \"baseline\", (v, old) => {\n\t\t\tif (!webix.isUndefined(old)) this.FillTemplate(this.State.selected);\n\t\t});\n\t}\n\n\tFillTemplate(id) {\n\t\tconst item = webix.copy(this.Tasks.getItem(id));\n\t\titem.sources = this.Local.getLinks(id, \"source\");\n\t\titem.targets = this.Local.getLinks(id, \"target\");\n\t\tif (this.isResources && item.type == \"task\") {\n\t\t\tthis.Local.getAssignments(id).then(d => {\n\t\t\t\tif (!this.getRoot()) return false;\n\t\t\t\titem.resources = d.sort(\n\t\t\t\t\tthis.app.getService(\"operations\").sortResources\n\t\t\t\t);\n\t\t\t\tthis.Text.setValues(item);\n\t\t\t});\n\t\t} else this.Text.setValues(item);\n\t}\n\n\tEditTask() {\n\t\tthis.State.edit = true;\n\t}\n\n\tDeleteTask() {\n\t\tthis.app.getService(\"operations\").removeTask(this.State.selected);\n\t\tthis.Close();\n\t}\n\n\tClose() {\n\t\tthis.State.$batch({\n\t\t\tedit: null,\n\t\t\tselected: null,\n\t\t});\n\t}\n\n\tInfoTemplate(obj) {\n\t\tif (!obj.start_date) return \"\";\n\t\tconst _ = this._;\n\t\tlet html = `<span class=\"webix_gantt_task_title\">${obj.text ||\n\t\t\t_(\"(no title)\")}</span><br><br>`;\n\t\thtml += this.BaseTemplate(obj);\n\t\thtml += this.LinkTemplate(obj);\n\n\t\tif (this.State.baseline && obj.planned_start) {\n\t\t\thtml += this.BaselineTemplateChunk(obj, _(\"Planned dates\"));\n\t\t}\n\n\t\tif (obj.details) {\n\t\t\thtml += `<br><br><div class=\"webix_gantt_task_title\">${_(\"Notes\")}</div>\n\t\t\t\t<br><div class=\"webix_gantt_task_text\">${obj.details.replace(\n\t\t\t\t\t/(?:\\r\\n|\\r|\\n)/g,\n\t\t\t\t\t\"<br>\"\n\t\t\t\t)}</div>`;\n\t\t}\n\n\t\treturn html;\n\t}\n\n\tBaseTemplate(obj) {\n\t\tconst _ = this._;\n\t\tlet html = `<span class=\"webix_strong\">${_(\n\t\t\t\"Start date\"\n\t\t)}</span>: ${this.DateFormat(obj.start_date)}<br>`;\n\n\t\tif (obj.type !== \"milestone\")\n\t\t\thtml += `<span class=\"webix_strong\">${_(\n\t\t\t\t\"End date\"\n\t\t\t)}</span>: ${this.DateFormat(obj.end_date)}<br>\n\t\t\t<span class=\"webix_strong\">${_(\"Duration\")}</span>: ${obj.duration}<br>\n\t\t\t<span class=\"webix_strong\">${_(\"Progress\")}</span>: ${obj.progress}%\n\t\t<br>`;\n\t\treturn html;\n\t}\n\n\tLinkTemplate(obj) {\n\t\tlet html = \"\";\n\t\tconst _ = this._;\n\t\tif (obj.targets.length)\n\t\t\thtml += this.InfoTemplateChunk(obj.targets, _(\"Predecessors\"));\n\t\tif (obj.sources.length)\n\t\t\thtml += this.InfoTemplateChunk(obj.sources, _(\"Successors\"));\n\t\tif (obj.resources) {\n\t\t\tconst single =\n\t\t\t\tthis.isResources == \"single\" || this.app.config.resourceCalendars;\n\t\t\thtml += this.ResourcesTemplateChunk(\n\t\t\t\tobj.resources,\n\t\t\t\tsingle ? _(\"Assignment\") : _(\"Assignments\")\n\t\t\t);\n\t\t}\n\t\treturn html;\n\t}\n\n\tResourcesTemplateChunk(arr, label) {\n\t\tif (!arr || !arr.length) return \"\";\n\t\tlet maxWidth = 130;\n\t\tarr.forEach(r => {\n\t\t\tconst s0 = webix.html.getTextSize(r.name, \"webix_gantt_info_list_text\");\n\t\t\tconst s1 = webix.html.getTextSize(\n\t\t\t\tr.category,\n\t\t\t\t\"webix_gantt_info_list_text webix_gantt_resource_section\"\n\t\t\t);\n\t\t\tmaxWidth = Math.max(maxWidth, s0.width, s1.width);\n\t\t});\n\t\tmaxWidth = Math.min(200, maxWidth);\n\t\tlet list = arr\n\t\t\t.map(r => {\n\t\t\t\tconst h = this.app.getService(\"helpers\");\n\t\t\t\tconst avatar =\n\t\t\t\t\t\"<div>\" +\n\t\t\t\t\th.resourceAvatar(r, \"webix_gantt_person_avatar_big\") +\n\t\t\t\t\t\"</div>\";\n\t\t\t\tconst dpt =\n\t\t\t\t\t\"<div class=' webix_gantt_info_list_text webix_gantt_resource_section' style='min-width:\" +\n\t\t\t\t\tmaxWidth +\n\t\t\t\t\t\"px'>\" +\n\t\t\t\t\tr.category +\n\t\t\t\t\t\"</div>\";\n\t\t\t\tconst value =\n\t\t\t\t\t\"<div class='webix_gantt_resource_section'>\" +\n\t\t\t\t\tr.value +\n\t\t\t\t\tthis._(h.getResourceUnit(r)) +\n\t\t\t\t\t\"</div>\";\n\t\t\t\tconst top =\n\t\t\t\t\t\"<div class='webix_gantt_info_list_text_row'><div class='webix_gantt_info_list_text' style='min-width:\" +\n\t\t\t\t\tmaxWidth +\n\t\t\t\t\t\"px'>\" +\n\t\t\t\t\tr.name +\n\t\t\t\t\t\"</div>\" +\n\t\t\t\t\tvalue +\n\t\t\t\t\t\"</div>\";\n\t\t\t\tconst text = \"<div  >\" + top + dpt + \"</div>\";\n\n\t\t\t\treturn (\n\t\t\t\t\t\"<div class='webix_gantt_info_resource'>\" + avatar + text + \"</div>\"\n\t\t\t\t);\n\t\t\t})\n\t\t\t.join(\"\");\n\t\treturn `<br><span class=\"webix_strong\">${label}</span>:<br><ul class=\"webix_gantt_info_list_resources\">${list}</ul>`;\n\t}\n\n\tInfoTemplateChunk(arr, label) {\n\t\tlet res = arr\n\t\t\t.map(s => `<li>${s.text || this._(\"(no title)\")}</li>`)\n\t\t\t.join(\"\");\n\t\treturn `<br><span class=\"webix_strong\">${label}</span>:<br><ul>${res}</ul>`;\n\t}\n\n\tDateFormat(date) {\n\t\treturn webix.i18n.longDateFormatStr(date);\n\t}\n\tBaselineTemplateChunk(obj, label) {\n\t\tconst _ = this.app.getService(\"locale\")._;\n\n\t\tlet html =\n\t\t\t`${_(\"Start date\")}: ${this.DateFormat(obj.planned_start)}<br>` +\n\t\t\t`${_(\"End date\")}: ${this.DateFormat(obj.planned_end)}<br>` +\n\t\t\t`${_(\"Duration\")}: ${obj.planned_duration}<br>`;\n\t\treturn `<br><span class=\"webix_strong\">${label}</span><br><div class=\"webix_gantt_info_list_planned\">${html}</div>`;\n\t}\n}\n","import { JetView } from \"webix-jet\";\n\nexport default class TaskPopup extends JetView {\n\tconfig() {\n\t\treturn this.app.getService(\"jet-win\").updateConfig({\n\t\t\tview: \"window\",\n\t\t\tborderless: true,\n\t\t\tfullscreen: true,\n\t\t\thead: false,\n\t\t\tbody: { $subview: true },\n\t\t});\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport { sort } from \"../helpers/common\";\n\nexport default class TreeView extends JetView {\n\tconfig() {\n\t\tconst state = (this.State = this.getParam(\"state\", true));\n\t\tthis.Local = this.app.getService(\"local\");\n\t\tthis.Helpers = this.app.getService(\"helpers\");\n\t\tconst scales = this.Local.getScales();\n\t\tconst _ = (this._ = this.app.getService(\"locale\")._);\n\t\tconst compact = (this.Compact = this.getParam(\"compact\", true));\n\t\tthis.isResources = this.app.config.resources;\n\t\tthis.maxAvatarNumber = 3;\n\n\t\tconst action = {\n\t\t\tid: \"action\",\n\t\t\tcss: \"webix_gantt_action\",\n\t\t\theader: {\n\t\t\t\ttext: `<span webix_tooltip=\"${_(\n\t\t\t\t\t\"Add task\"\n\t\t\t\t)}\" class=\"webix_icon wxi-plus-circle\"></span>`,\n\t\t\t\tcss: \"webix_gantt_action\",\n\t\t\t},\n\t\t\ttemplate: () => {\n\t\t\t\treturn `<span webix_tooltip=\"${_(\n\t\t\t\t\t\"Add task\"\n\t\t\t\t)}\" class=\"webix_icon wxi-plus\"></span>`;\n\t\t\t},\n\t\t\twidth: 44,\n\t\t\tminWidth: 44,\n\t\t};\n\n\t\tlet columns = [\n\t\t\t{\n\t\t\t\tid: \"text\",\n\t\t\t\tcss: \"webix_gantt_title\",\n\t\t\t\theader: _(\"Title\"),\n\t\t\t\ttemplate: (obj, common) =>\n\t\t\t\t\tcommon.treetable(obj, common) + this.TitleTemplate(obj),\n\t\t\t\tfillspace: true,\n\t\t\t\thidden: compact,\n\t\t\t\tbatch: \"full\",\n\t\t\t\tsort: sort(\"text\"),\n\t\t\t\tminWidth: 150,\n\t\t\t},\n\t\t\t{\n\t\t\t\tid: \"start_date\",\n\t\t\t\theader: _(\"Start date\"),\n\t\t\t\tformat: webix.i18n.dateFormatStr,\n\t\t\t\thidden: compact,\n\t\t\t\tbatch: \"full\",\n\t\t\t\tsort: \"date\",\n\t\t\t\tminWidth: 100,\n\t\t\t},\n\t\t];\n\n\t\tif (this.isResources) {\n\t\t\tcolumns.push({\n\t\t\t\tid: \"resources\",\n\t\t\t\tcss: \"webix_gantt_tree_column_resources\",\n\t\t\t\theader: _(\"Assigned\"),\n\t\t\t\ttemplate: obj => this.ResourcesTemplate(obj),\n\t\t\t\tminWidth: 100,\n\t\t\t});\n\t\t}\n\n\t\tif (compact) {\n\t\t\taction.header.text = \"<span class='webix_icon gti-menu'>\";\n\t\t\tif (state.readonly) action.template = \"\";\n\t\t\tcolumns.unshift(action);\n\t\t} else if (!state.readonly) columns.push(action);\n\n\t\tcolumns[columns.length - 1].resize = false;\n\n\t\tconst skin = webix.skin.$name;\n\t\tconst headerCss =\n\t\t\tskin == \"material\" || skin == \"mini\" ? \"webix_header_border\" : \"\";\n\t\tconst tree = {\n\t\t\tview: \"treetable\",\n\t\t\tcss: \"webix_gantt_tree \" + headerCss,\n\t\t\tprerender: true,\n\t\t\twidth: compact ? 44 : state.treeWidth,\n\t\t\trowHeight: scales.cellHeight,\n\t\t\theaderRowHeight: scales.height,\n\t\t\tscroll: \"xy\",\n\t\t\tscrollAlignY: false,\n\t\t\tselect: \"row\",\n\t\t\tsort: \"multi\",\n\t\t\tresizeColumn: {\n\t\t\t\theaderOnly: true,\n\t\t\t\tsize: 10,\n\t\t\t},\n\t\t\tdrag: state.readonly ? false : \"order\",\n\t\t\tcolumns,\n\t\t\ttooltip: () => \"\",\n\t\t\tonClick: {\n\t\t\t\t\"wxi-plus\": (ev, id) => this.AddTask(id.row),\n\t\t\t\t\"wxi-plus-circle\": () => this.AddTask(\"0\"),\n\t\t\t\t\"gti-menu\": () => this.ToggleColumns(),\n\t\t\t},\n\t\t\ton: {\n\t\t\t\tonBeforeOpen: id => this.HandleToggle(id),\n\t\t\t\tonAfterOpen: id => {\n\t\t\t\t\tthis.ToggleBranch(id, 1);\n\t\t\t\t\tthis.ApplySelection();\n\t\t\t\t},\n\t\t\t\tonAfterClose: id => this.ToggleBranch(id, 0),\n\t\t\t\tonBeforeSelect: id => this.BeforeSelectHandler(id),\n\t\t\t\tonItemClick: id => this.ItemClickHandler(id),\n\t\t\t\tonAfterSort: (by, dir, as) => this.SortTasks(by, dir, as),\n\t\t\t\tonColumnResize: (id, v, o, user) => this.NormalizeColumns(id, user),\n\t\t\t\tonBeforeDrag: (ctx, e) => this.BeforeDragHandler(ctx, e),\n\t\t\t\tonBeforeDrop: ctx => this.BeforeDropHandler(ctx),\n\t\t\t\tonViewResize: () => {\n\t\t\t\t\tthis.State.treeWidth = this.Tree.$width;\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\ttree.on[\"onScrollY\"] = tree.on[\"onSyncScroll\"] = tree.on[\n\t\t\t\"onAfterScroll\"\n\t\t] = function() {\n\t\t\tstate.top = this.getScrollState().y;\n\t\t};\n\t\treturn tree;\n\t}\n\n\tinit(view) {\n\t\tthis.Tree = view;\n\t\tthis.State = this.getParam(\"state\", true);\n\t\tthis.Ops = this.app.getService(\"operations\");\n\t\tthis.Helpers = this.app.getService(\"helpers\");\n\t\tthis.Tasks = this.Local.tasks();\n\n\t\tthis.on(this.State.$changes, \"display\", v => {\n\t\t\tthis.Mode = v;\n\t\t\tthis.State.top = 0;\n\t\t\tthis.SyncData();\n\t\t});\n\t\tif (this.isResources) {\n\t\t\tthis.on(this.Assignments.data, \"onStoreUpdated\", () => {\n\t\t\t\tthis.Tree.refresh();\n\t\t\t});\n\t\t\tthis.on(this.Tree.data, \"onStoreUpdated\", id => {\n\t\t\t\tif (this.Mode == \"resources\" && !id) {\n\t\t\t\t\tthis.ApplySelection();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.on(this.State.$changes, \"top\", y => this.Tree.scrollTo(null, y));\n\t\tthis.on(this.State.$changes, \"selected\", id => {\n\t\t\tif (id) this.ApplySelection();\n\t\t\telse this.Tree.unselect();\n\t\t});\n\n\t\t// resetting headerRowHeight\n\t\tthis.on(this.app, \"onScalesUpdate\", scales => {\n\t\t\tconst col = this.Tree.columnId(0);\n\t\t\tthis.Tree.getColumnConfig(col).header[0].height = scales.height;\n\t\t\tthis.Tree.refreshColumns();\n\t\t});\n\n\t\t// compact button and dnd module\n\t\tthis.on(this.app, \"task:add\", (pid, dates) =>\n\t\t\tthis.AddTask(pid || \"0\", dates)\n\t\t);\n\n\t\tthis.on(this.State.$changes, \"treeWidth\", v => {\n\t\t\tif (!this.Compact && view.$width !== v) {\n\t\t\t\tview.define({ width: v });\n\t\t\t\tview.resize();\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Prevents split task branches from being opened\n\t * @param {(string|number)} id - the ID of a task branch\n\t * @returns {Boolean} return false to prevent branches from opening\n\t */\n\tHandleToggle(id) {\n\t\tconst obj = this.Tree.getItem(id);\n\t\tif (obj.type === \"split\" && obj.$data.length) return false;\n\t}\n\n\t/**\n\t * Selects a task\n\t * @param {(string|number)} id - the ID of a task\n\t */\n\tItemClickHandler(id) {\n\t\tif (!this.Tree.getItem(id).$group) {\n\t\t\tthis.State.$batch({\n\t\t\t\tparent: null,\n\t\t\t\tselected: id.row,\n\t\t\t});\n\t\t} else this.app.callEvent(\"edit:stop\");\n\t}\n\t/**\n\t * Checks whether selection is allowed\n\t * @param {string, number} id - task ID\n\t * @returns {boolean} returning false prevents selection\n\t */\n\tBeforeSelectHandler(id) {\n\t\treturn !this.Tree.getItem(id).$group;\n\t}\n\t/**\n\t * Checks whether drag-n-drop is allowed and defines the looks of the drag marker\n\t * @param {Object} ctx - the context object of DnD\n\t * @param {MouseEvent} e - native browser event\n\t * @returns {Boolean} returning false prevents Webix drag-n-drop logic\n\t */\n\tBeforeDragHandler(ctx, e) {\n\t\tif (this.Mode == \"tasks\") {\n\t\t\tconst obj = this.Tree.getItem(ctx.start);\n\t\t\tif (obj.type === \"split\" && obj.$data.length) {\n\t\t\t\tconst html = this.Tree.$dragHTML(this.Tree.getItem(ctx.start), e, ctx);\n\t\t\t\tctx.html = html.replace(\n\t\t\t\t\t\"webix_dd_drag\",\n\t\t\t\t\t\"webix_dd_drag webix_gantt_tree_no_icon\"\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\t/**\n\t * Saves task position\n\t * @param {Object} ctx - drag-n-drop context\n\t * @returns {boolean} returning false prevents Webix drop logic\n\t */\n\tBeforeDropHandler(ctx) {\n\t\tthis.Ops.moveTask(ctx.start, ctx.parent, ctx.index);\n\t\treturn false;\n\t}\n\t/** Fills tree width data */\n\tSyncData() {\n\t\tthis.Tree.clearAll();\n\t\tthis.VisibleTasks = this.Local.getVisibleTasksCollection();\n\t\tthis.resDisplayed = this.State.display === \"resources\";\n\n\t\t// for Resource view: always handle existing waitData of VisibleTasks\n\t\tif (this.resDisplayed && !this.clearEvID) {\n\t\t\tthis.clearEvID = this.on(this.VisibleTasks.data, \"onClearAll\", () => {\n\t\t\t\tif (this.resDisplayed) {\n\t\t\t\t\tthis.RefreshData();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.RefreshData();\n\t}\n\n\t/**\n\t * Returns waitData of all involved Collections\n\t * @returns {Array} of Promises\n\t */\n\tGetLoaders() {\n\t\tconst loaders = [this.VisibleTasks.waitData];\n\t\tif (this.isResources) {\n\t\t\tthis.Resources = this.Local.resources();\n\t\t\tthis.Assignments = this.Local.assignments();\n\t\t\tloaders.push(this.Resources.waitData, this.Assignments.waitData);\n\t\t}\n\t\treturn loaders;\n\t}\n\n\t/**\n\t * Waits for data before syncing with main collection and restoring state\n\t * @param {Array} loaders -\n\t */\n\tRefreshData() {\n\t\tconst loaders = this.GetLoaders();\n\t\twebix.promise.all(loaders).then(() => {\n\t\t\tthis.Tree.sync(this.VisibleTasks);\n\t\t\tthis.ApplySelection();\n\t\t\tthis.ApplySorting();\n\t\t});\n\t}\n\n\t/** Applies selection from state */\n\tApplySelection() {\n\t\tconst id = this.State.selected;\n\n\t\tif (id && this.Tree.exists(id) && this.Tree.getSelectedId() != id) {\n\t\t\tlet selected;\n\t\t\tconst task = this.Tree.getItem(id);\n\n\t\t\t// split subtasks are in the tree but they are never visible\n\t\t\tif (this.State.display === \"tasks\") {\n\t\t\t\tconst parent = task.parent;\n\t\t\t\tconst pdata = parent != 0 ? this.Tree.getItem(parent) : null;\n\t\t\t\tif (pdata && pdata.type === \"split\") {\n\t\t\t\t\tselected = parent;\n\t\t\t\t} else if (this.Local._isTaskVisible(task)) {\n\t\t\t\t\tselected = id;\n\t\t\t\t}\n\t\t\t} else if (this.Local._isTaskVisible(task)) {\n\t\t\t\tselected = id;\n\t\t\t}\n\n\t\t\tif (selected) {\n\t\t\t\tthis.Tree.select(selected);\n\t\t\t\tthis.Tree.showItem(selected);\n\t\t\t}\n\t\t}\n\t}\n\t/** Applies sorting from state */\n\tApplySorting() {\n\t\tif (this.State.sort) {\n\t\t\t// UI-only: no need to re-apply sorting on collection\n\t\t\tthis.Tree.data.blockEvent();\n\t\t\tthis.Tree.setState({ sort: this.State.sort });\n\t\t\tthis.Tree.data.unblockEvent();\n\t\t}\n\t}\n\n\t/**\n\t * Adds a new task\n\t * @param {string, number} pid - ID of parent task, can be \"0\" for root\n\t * @param {Object} dates - start and end of the new task in units (numbers)\n\t * @returns {boolean} returning false prevents selection of the parent task, if called from tree\n\t */\n\tAddTask(pid, dates) {\n\t\tthis.State.selected = null;\n\n\t\tconst row = this.Tree.getItem(pid);\n\t\tconst index = row ? 0 : -1;\n\t\tlet inProgress;\n\t\tconst newTask = this.GetNewTask(row, dates);\n\n\t\tif (this.Mode == \"resources\" && row) {\n\t\t\tinProgress = this.AddTaskWithAssignment(newTask, pid);\n\t\t} else {\n\t\t\t// row and dates come from drag-n-drop module\n\t\t\tif (row && dates) {\n\t\t\t\tlet assigned;\n\t\t\t\tif (this.app.config.resources) {\n\t\t\t\t\tassigned = this.Assignments.find(a => a.task == row.id);\n\t\t\t\t}\n\t\t\t\tif (assigned && assigned.length)\n\t\t\t\t\tinProgress = this.SplitTaskWithAssignment(\n\t\t\t\t\t\tnewTask,\n\t\t\t\t\t\tindex,\n\t\t\t\t\t\tpid,\n\t\t\t\t\t\trow,\n\t\t\t\t\t\tassigned\n\t\t\t\t\t);\n\t\t\t\telse inProgress = this.Ops.splitTaskWithDnd(newTask, index, pid, row);\n\t\t\t} else inProgress = this.Ops.addTask(newTask, index, row ? pid : 0);\n\t\t}\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\n\t\tinProgress.then(res => {\n\t\t\tif (row && this.Mode == \"tasks\" && row.type !== \"split\") {\n\t\t\t\tthis.Tree.open(pid);\n\t\t\t}\n\t\t\tthis.State.$batch({\n\t\t\t\tedit: true,\n\t\t\t\tselected: res.id,\n\t\t\t});\n\n\t\t\tthis.Tree.showItem(res.id);\n\t\t});\n\n\t\treturn false;\n\t}\n\t/**\n\t * Returns and object with new task data\n\t * @param {Object} row - the data object of parent task\n\t * @param {Object} dates - (optional) start and length of the new task in units (numbers)\n\t * @returns {Object} an object with default task fields\n\t */\n\tGetNewTask(row, dates) {\n\t\tconst { start, end } = this.GetDates(row, dates);\n\n\t\treturn {\n\t\t\tstart_date: new Date(start),\n\t\t\tend_date: end || webix.Date.add(start, 1, \"day\", true),\n\t\t\tprogress: 0,\n\t\t\ttext: \"\",\n\t\t};\n\t}\n\n\t/**\n\t * Gets start and end dates for a new task\n\t * @param {Object} row - (optional) the data object of a parent task\n\t * @param {Object} dates - (optional) start and length of the new task in units (numbers)\n\t * @returns {Object} with start and end dates\n\t */\n\tGetDates(row, dates) {\n\t\tif (dates) {\n\t\t\treturn dates;\n\t\t}\n\n\t\tlet start, end;\n\t\tif (row && row.type === \"split\") {\n\t\t\tconst date =\n\t\t\t\trow.$data && row.$data.length ? row.$data[0].end_date : row.end_date;\n\t\t\tstart = this.Helpers.addUnit(\"day\", date, 1);\n\t\t} else {\n\t\t\tif (row) {\n\t\t\t\tstart = row.start_date;\n\t\t\t} else {\n\t\t\t\tconst scales = this.Local.getScales();\n\t\t\t\tstart = webix.Date.add(scales.start, 1, scales.minUnit); //keep scale start\n\t\t\t}\n\t\t}\n\t\treturn { start, end };\n\t}\n\n\t/**\n\t * Adds a new task with assignment, if any is applicable\n\t * @param {Object} newTask - the data object of a new task\n\t * @param {(string|number)} pid - the ID of the parent task\n\t * @returns {Promise} server response with ID of the new task\n\t */\n\tAddTaskWithAssignment(newTask, pid) {\n\t\tthis.Tasks.data.blockEvent();\n\t\tthis.Assignments.data.blockEvent();\n\t\t// add task\n\t\tlet targetId = \"0\";\n\t\tif (pid) targetId = this.Tree.getItem(pid).$group ? \"0\" : pid;\n\t\tlet index = 0;\n\t\tif (this.Tasks.data.branch[targetId])\n\t\t\tindex = this.Tasks.data.branch[targetId].length;\n\n\t\treturn this.Ops.addTask(newTask, index, targetId)\n\t\t\t.then(obj => {\n\t\t\t\tnewTask.id = obj.id;\n\t\t\t\t// add assignments\n\t\t\t\tlet waitArr = [];\n\t\t\t\tlet resources = null;\n\t\t\t\twhile (pid != \"0\" && !resources) {\n\t\t\t\t\tresources = this.Tree.getItem(pid).resources;\n\t\t\t\t\tif (!resources) pid = this.Tree.getParentId(pid);\n\t\t\t\t}\n\t\t\t\tif (resources && resources.length) {\n\t\t\t\t\tresources.forEach(rId => {\n\t\t\t\t\t\tconst resource = this.Local.resources().getItem(rId);\n\t\t\t\t\t\twaitArr.push(\n\t\t\t\t\t\t\tthis.Ops.addAssignment({\n\t\t\t\t\t\t\t\tresource: rId,\n\t\t\t\t\t\t\t\tvalue: this.Helpers.getDefaultResourceValue(resource),\n\t\t\t\t\t\t\t\ttask: newTask.id,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif (!waitArr.length) return webix.promise.resolve(obj);\n\t\t\t\treturn webix.promise.all(waitArr).then(() => obj);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tthis.Tasks.data.unblockEvent();\n\t\t\t\tthis.Assignments.data.unblockEvent();\n\t\t\t\t//now we can refresh\n\t\t\t\tthis.Tasks.data.callEvent(\"onStoreUpdated\", [\n\t\t\t\t\tnewTask.id,\n\t\t\t\t\tnewTask,\n\t\t\t\t\t\"add\",\n\t\t\t\t]);\n\t\t\t});\n\t}\n\n\t/**\n\t * Splits a task and reassigns resources from original task to new kid if the original task was not split\n\t * @param {Object} newTask - data for a new split kid\n\t * @param {number} index - the index of the new kid\n\t * @param {(number|string)} pid - the ID of the original task\n\t * @param {Object} row - data of the original task\n\t * @param {Object} assignment - data of the assignment of the original task\n\t * @returns {Promise<Object>} server response with ID of the new task, it's 'sibling' ID\n\t */\n\tSplitTaskWithAssignment(newTask, index, pid, row, assignments) {\n\t\treturn this.Ops.splitTaskWithDnd(newTask, index, pid, row).then(res => {\n\t\t\tif (res.sibling) {\n\t\t\t\tconst aops = [];\n\t\t\t\tfor (let i = 0; i < assignments.length; ++i)\n\t\t\t\t\taops.push(\n\t\t\t\t\t\tthis.Ops.updateAssignment(assignments[i].id, {\n\t\t\t\t\t\t\ttask: res.sibling,\n\t\t\t\t\t\t}).then(() => res)\n\t\t\t\t\t);\n\t\t\t\treturn webix.promise.all(aops).then(() => res);\n\t\t\t}\n\t\t\treturn res;\n\t\t});\n\t}\n\n\t/** Invokes tasks painting in the chart */\n\tRefreshTasks() {\n\t\tthis.Tasks.data.callEvent(\"onStoreUpdated\", []);\n\t}\n\t/**\n\t * Sorts tasks according to current sorting config\n\t * @param {string, array} by - data field, can store an array of sorting configs in case of multiple sorting\n\t * @param {string, number} dir - sorting direction, \"asc\" or \"desc\"\n\t * @param {string, number} as - data type, \"string\" by default\n\t */\n\tSortTasks(by, dir, as) {\n\t\tconst dataSorter = webix.isArray(by) ? by : { by, dir, as };\n\t\tconst sortState = this.Tree.getState().sort;\n\n\t\t// sort the collection to affect task bars\n\t\tthis.VisibleTasks.sort(dataSorter);\n\t\t// save sorting state to restore it after app.refresh (switching from/to compact mode)\n\t\tthis.State.sort = sortState;\n\t}\n\t/** Shows and hides columns in a compact mode */\n\tToggleColumns() {\n\t\tconst vis = this.Tree.isColumnVisible(\"text\");\n\t\tthis.Tree.showColumnBatch(\"full\", !vis);\n\t\tthis.Tree.config.width = vis ? 44 : 0;\n\t\tthis.Tree.resize();\n\n\t\tthis.app.callEvent(\"bars:toggle\", [vis]);\n\t}\n\t/**\n\t * Adjusts columns after resizing\n\t * @param {string} id - ID of the column being resized\n\t * @param {boolean} user - defines whether resizing was triggered by user or API\n\t */\n\tNormalizeColumns(id, user) {\n\t\tif (!user) return;\n\t\tconst tree = this.Tree;\n\t\tconst columns = tree.config.columns;\n\t\tconst i = tree.getColumnIndex(id);\n\n\t\tlet last = columns.length - 1;\n\t\tif (columns[last].id === \"action\") last -= 1;\n\n\t\tif (i === 0) {\n\t\t\tcolumns[last].fillspace = true;\n\t\t\tcolumns[last].width = 0;\n\t\t} else if (i === last) {\n\t\t\tcolumns[0].fillspace = true;\n\t\t\tcolumns[0].width = 0;\n\t\t}\n\t\ttree.refreshColumns();\n\t}\n\t/**\n\t * Saves a task tree branch state (open or closed)\n\t * @param {number, string} id - the ID of the task (branch node)\n\t * @param {number} open - 1 if open, 0 if closed\n\t */\n\tToggleBranch(id, open) {\n\t\tif (this.State.display != \"resources\") {\n\t\t\tthis.RefreshTasks();\n\t\t\tif (!this.State.readonly) this.Ops.updateTask(id, { opened: open });\n\t\t} else {\n\t\t\tconst tree = this.VisibleTasks;\n\t\t\tconst item = tree.getItem(id);\n\t\t\titem.open = !!open;\n\t\t\t// need to update treestore order\n\t\t\ttree.data.callEvent(\"onStoreUpdated\", [id, 0, \"branch\"]);\n\t\t}\n\t}\n\n\t/**\n\t * Returns a string with the text label for item title\n\t * @param {Object} obj - the data object of a task\n\t * @returns {string} a string with the text label\n\t */\n\tTitleTemplate(obj) {\n\t\treturn (\n\t\t\tobj.text || (obj.$group ? this._(\"Unassigned\") : this._(\"(no title)\"))\n\t\t);\n\t}\n\n\t/**\n\t * Resources cell template\n\t * @param {object} obj - task data item\n\t * @returns {string} html string\n\t */\n\tResourcesTemplate(obj) {\n\t\tif (this.Assignments.count() && this.Resources.count()) {\n\t\t\tlet assigned = [];\n\t\t\tthis.Assignments.data.each(a => {\n\t\t\t\tif (a.task == obj.id) assigned.push(this.Resources.getItem(a.resource));\n\t\t\t});\n\t\t\tassigned.sort(this.Ops.sortResources);\n\t\t\treturn this.GetAssignmentsHTML(assigned);\n\t\t}\n\t\treturn \"\";\n\t}\n\n\t/**\n\t * Gets html content for assignments cell\n\t * @param {Array} assignedArr - an array of assignments\n\t * @returns {string} html string\n\t */\n\tGetAssignmentsHTML(assignedArr) {\n\t\tlet str = \"\";\n\t\tif (assignedArr.length > this.maxAvatarNumber) {\n\t\t\tconst num = assignedArr.length - this.maxAvatarNumber + 1;\n\t\t\tassignedArr = assignedArr.splice(0, this.maxAvatarNumber);\n\t\t\t// show remaining assignments as \"+[NUM]\" over the last avatar\n\t\t\tconst last = assignedArr.pop();\n\t\t\tconst lastStr = this.Helpers.resourceAvatar(last);\n\t\t\tconst numStr =\n\t\t\t\t\"<div class='webix_gantt_cell_remain_num'>+\" + num + \"</div>\";\n\t\t\tstr = assignedArr\n\t\t\t\t.map(r => `${this.Helpers.resourceAvatar(r, null, true)}`)\n\t\t\t\t.join(\"\");\n\t\t\tstr +=\n\t\t\t\t\"<div class='webix_gantt_cell_assigned_last'>\" +\n\t\t\t\tlastStr +\n\t\t\t\tnumStr +\n\t\t\t\t\"</div>\";\n\t\t} else {\n\t\t\tstr = assignedArr\n\t\t\t\t.map(r => `${this.Helpers.resourceAvatar(r, null, true)}`)\n\t\t\t\t.join(\"\");\n\t\t\t// show a name for single assignment\n\t\t\tif (assignedArr.length == 1) {\n\t\t\t\tlet arr = assignedArr[0].name.split(\" \");\n\t\t\t\tstr +=\n\t\t\t\t\t\"<span class='webix_gantt_cell_assigned_text'>\" + arr[0] + \"</span>\";\n\t\t\t}\n\t\t}\n\t\treturn \"<div class='webix_gantt_avatar_box'>\" + str + \"</div>\";\n\t}\n}\n","import { JetView } from \"webix-jet\";\nimport TreeView from \"./tree\";\nimport ChartView from \"./chart\";\nimport { initRLayout } from \"@xbs/jet-helpers\";\n\nexport default class TopView extends JetView {\n\tconfig() {\n\t\tinitRLayout();\n\t\tthis.fCompact = this.getParam(\"forceCompact\");\n\t\tif (!webix.isUndefined(this.fCompact))\n\t\t\tthis.setParam(\"compact\", this.fCompact);\n\t\tthis.Compact = this.getParam(\"compact\");\n\t\tthis.State = this.getParam(\"state\", true);\n\n\t\tconst edit = this.Compact\n\t\t\t? { $subview: true, name: \"edit\", popup: true }\n\t\t\t: {\n\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\tcss: \"webix_shadow_medium\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\twidth: 400,\n\t\t\t\t\thidden: true,\n\t\t\t\t\tlocalId: \"edit\",\n\t\t\t\t\tbody: { $subview: true, name: \"edit\" },\n\t\t\t  };\n\n\t\tlet cols = [\n\t\t\tTreeView,\n\t\t\t{\n\t\t\t\tview: this.Compact ? \"spacer\" : \"resizer\",\n\t\t\t\tcss: \"webix_gantt_resizer\",\n\t\t\t\twidth: this.Compact ? 1 : 4,\n\t\t\t},\n\t\t\tChartView,\n\t\t];\n\n\t\tif (this.app.config.resources) {\n\t\t\tcols = [\n\t\t\t\t{\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\trows: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\t\t\tcols,\n\t\t\t\t\t\t\ton: {\n\t\t\t\t\t\t\t\tonViewResize: () => {\n\t\t\t\t\t\t\t\t\tthis.app.callEvent(\"rdiagram:resize\", []);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"resizer\",\n\t\t\t\t\t\t\tcss: \"webix_gantt_resizer\",\n\t\t\t\t\t\t\tlocalId: \"rdResizer\",\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tview: \"proxy\",\n\t\t\t\t\t\t\tlocalId: \"rdiagram\",\n\t\t\t\t\t\t\theight: this.Compact ? 0 : 400,\n\t\t\t\t\t\t\tbody: { $subview: true, name: \"rdiagram\" },\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tedit,\n\t\t\t];\n\t\t} else {\n\t\t\tcols.push(edit);\n\t\t}\n\n\t\tconst main = {\n\t\t\tview: \"abslayout\",\n\t\t\tcss: \"webix_gantt\",\n\t\t\tcells: [\n\t\t\t\t{\n\t\t\t\t\tview: \"r-layout\",\n\t\t\t\t\tlocalId: \"main\",\n\t\t\t\t\tborderless: true,\n\t\t\t\t\trelative: true,\n\t\t\t\t\ttype: \"clean\",\n\t\t\t\t\tcols: cols,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcss: \"webix_gantt_absbutton\",\n\t\t\t\t\tview: \"icon\",\n\t\t\t\t\ticon: \"wxi-plus\",\n\t\t\t\t\tlocalId: \"add\",\n\t\t\t\t\thidden: !this.Compact || this.State.readonly,\n\t\t\t\t\twidth: 50,\n\t\t\t\t\theight: 50,\n\t\t\t\t\tright: 20,\n\t\t\t\t\tbottom: 20,\n\t\t\t\t\tclick: () => {\n\t\t\t\t\t\tthis.app.callEvent(\"task:add\", []);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t};\n\n\t\treturn main;\n\t}\n\n\tinit(view) {\n\t\tthis.$$(\"main\").sizeTrigger(\n\t\t\tthis.app,\n\t\t\tmode => this.SetCompactMode(mode),\n\t\t\t!!this.Compact\n\t\t);\n\n\t\tthis.on(this.State.$changes, \"selected\", (id, oid) => {\n\t\t\tif (id) this.ShowTask(this.State.edit ? \"form\" : \"info\");\n\t\t\telse if (oid) this.HideTask();\n\t\t});\n\t\tthis.on(this.State.$changes, \"edit\", v => {\n\t\t\tif (this.State.selected) this.ShowTask(v ? \"form\" : \"info\");\n\t\t});\n\n\t\twebix.extend(view, webix.ProgressBar);\n\t\tthis.on(this.app, \"backend:operation\", res => {\n\t\t\tview.showProgress({ type: \"top\", delay: 2000 });\n\t\t\tres.finally(() => {\n\t\t\t\tview.hideProgress();\n\t\t\t});\n\t\t});\n\n\t\tif (this.app.config.resources) {\n\t\t\tthis.on(this.State.$changes, \"resourcesDiagram\", v => {\n\t\t\t\tif (v) {\n\t\t\t\t\tthis.$$(\"rdiagram\").show();\n\t\t\t\t\tthis.$$(\"rdResizer\").show();\n\t\t\t\t\tthis.show(\"rdiagram\", { target: \"rdiagram\" });\n\t\t\t\t} else {\n\t\t\t\t\tthis.$$(\"rdiagram\").hide();\n\t\t\t\t\tthis.$$(\"rdResizer\").hide();\n\t\t\t\t\tthis.show(\"_blank\", { target: \"rdiagram\" }).then(() => {\n\t\t\t\t\t\tthis.app.callEvent(\"rdiagram:resize\", []);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tShowTask(path) {\n\t\tpath = `task.${path}`;\n\t\tif (this.Compact) {\n\t\t\tthis.show(`task.popup/${path}`, {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t} else {\n\t\t\tthis.$$(\"edit\").show();\n\t\t\tthis.show(path, {\n\t\t\t\ttarget: \"edit\",\n\t\t\t});\n\t\t}\n\t}\n\n\tHideTask() {\n\t\t// we need to destroy the view inside first\n\t\tthis.show(\"_blank\", { target: \"edit\" });\n\t\tif (!this.Compact) this.$$(\"edit\").hide();\n\t}\n\n\tSetCompactMode(mode) {\n\t\t//let it render, then recreate\n\t\twebix.delay(() => {\n\t\t\tthis.State.$batch({ top: 0, left: 0 });\n\t\t\tthis.setParam(\"compact\", mode);\n\t\t\tthis.refresh();\n\t\t});\n\t}\n}\n","import m0 from \"./views/chart/bars\";\nimport m1 from \"./views/chart/index.js\";\nimport m2 from \"./views/chart/scale\";\nimport m3 from \"./views/rdiagram/diagram\";\nimport m4 from \"./views/rdiagram/index.js\";\nimport m5 from \"./views/rdiagram/tree\";\nimport m6 from \"./views/task/baseline\";\nimport m7 from \"./views/task/form\";\nimport m8 from \"./views/task/info\";\nimport m9 from \"./views/task/links\";\nimport m10 from \"./views/task/popup\";\nimport m11 from \"./views/task/resources\";\nimport m12 from \"./views/top\";\nimport m13 from \"./views/tree\";\nimport { JetView } from \"webix-jet\";\n\nconst views = { JetView };\nviews[\"chart/bars\"] = m0;\nviews[\"chart\"] = m1;\nviews[\"chart/scale\"] = m2;\nviews[\"rdiagram/diagram\"] = m3;\nviews[\"rdiagram\"] = m4;\nviews[\"rdiagram/tree\"] = m5;\nviews[\"task/baseline\"] = m6;\nviews[\"task/form\"] = m7;\nviews[\"task/info\"] = m8;\nviews[\"task/links\"] = m9;\nviews[\"task/popup\"] = m10;\nviews[\"task/resources\"] = m11;\nviews[\"top\"] = m12;\nviews[\"tree\"] = m13;\n\nexport default views;\n","export default class Local {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t * @param {object} config - object with app settings\n\t */\n\tconstructor(app, config) {\n\t\tthis.app = app;\n\t\tthis.state = app.getState();\n\n\t\tthis.Helpers = this.app.getService(\"helpers\");\n\n\t\t// initial config of scales\n\t\tthis.resetScales(config);\n\n\t\tthis.dateToLocalStr = webix.Date.dateToStr(webix.i18n.parseFormat);\n\t}\n\n\t/**\n\t * Creates and paints scales\n\t * @param {Date} scaleStart - start date\n\t * @param {Date} scaleEnd - end date\n\t * @param {boolean} precise - flag that defines whether to round task position and width to a smaller unit\n\t * @param {number} width - width of smallest cell unit\n\t * @param {number} height - height of scale cell\n\t * @param {Array} scales - a set of scales (objects)\n\t */\n\tsetScales(scaleStart, scaleEnd, precise, width, height, scales) {\n\t\tconst oldScale = this._scales;\n\t\tif (width) {\n\t\t\tthis._scaleBase = { width, height, scales };\n\t\t\tscaleEnd = webix.Date.add(scaleEnd, 1, \"day\"); //inclusive\n\t\t} else {\n\t\t\twidth = this._scaleBase.width;\n\t\t\theight = this._scaleBase.height;\n\t\t\tscales = this._scaleBase.scales;\n\t\t}\n\n\t\tthis._scales = this.app\n\t\t\t.getService(\"helpers\")\n\t\t\t.setScales(scaleStart, scaleEnd, precise, width, height, scales);\n\t\tthis._taskHeight = this._scales.cellHeight - 12;\n\n\t\tconst tasks = this.getVisibleTasksCollection();\n\t\tif (tasks && tasks.data.order.length) {\n\t\t\tif (this.state.display === \"resources\") {\n\t\t\t\tthis.app.getService(\"grouping\").refreshResourceTasks();\n\t\t\t} else {\n\t\t\t\tthis.refreshTasks();\n\t\t\t}\n\t\t\tthis.refreshLinks();\n\t\t}\n\n\t\tthis.app.callEvent(\"onScalesUpdate\", [this._scales, oldScale]);\n\t}\n\t/**\n\t * returns scales\n\t * @returns {object} current scales object\n\t */\n\tgetScales() {\n\t\treturn this._scales;\n\t}\n\t/**\n\t * sets initial state of Gantt scales\n\t * @param {Object} config - scales configuration, by default from app config\n\t */\n\tresetScales(config) {\n\t\tconfig = config || this.app.config;\n\n\t\tconst active = webix.skin.$active;\n\t\tconst scaleStart = config.scaleStart || webix.Date.dayStart(new Date());\n\t\tconst scaleEnd =\n\t\t\tconfig.scaleEnd || webix.Date.add(scaleStart, 1, \"month\", true);\n\n\t\tthis.setScales(\n\t\t\tscaleStart,\n\t\t\tscaleEnd,\n\t\t\tconfig.preciseTimeUnit,\n\t\t\tconfig.scaleCellWidth || 80,\n\t\t\tactive.barHeight - active.borderWidth * 2,\n\t\t\tconfig.scales || [{ unit: \"day\", step: 1, format: \"%d\" }]\n\t\t);\n\t}\n\t/**\n\t * Get tasks height\n\t * @returns {number} tasks height\n\t */\n\tgetTaskHeight() {\n\t\treturn this._taskHeight;\n\t}\n\t/**\n\t * Adjusts scale to edited task\n\t * @param {object} task - task object\n\t */\n\tadjustScale(obj) {\n\t\tlet start = obj.start_date;\n\t\tlet end = obj.end_date;\n\t\tif (this.state.baseline && obj.planned_start && obj.planned_end) {\n\t\t\tif (start > obj.planned_start) start = obj.planned_start;\n\t\t\tif (end < obj.planned_end) end = obj.planned_end;\n\t\t}\n\t\tconst s = this.getScales();\n\n\t\t// add 1 unit space around\n\t\tstart = this.Helpers.addUnit(s.minUnit, start, -1);\n\t\tend = this.Helpers.addUnit(s.minUnit, end, 1);\n\n\t\tif ((s && s.start > start) || s.end < end) {\n\t\t\tthis.setScales(\n\t\t\t\ts.start > start ? start : s.start,\n\t\t\t\ts.end < end ? end : s.end,\n\t\t\t\ts.precise\n\t\t\t);\n\t\t}\n\t}\n\t/**\n\t * Fills and returns tasks collection\n\t * @returns {object} tasks Tree Collection\n\t */\n\ttasks(force) {\n\t\tif (this._tasks && !force) return this._tasks;\n\n\t\tif (!this._tasks) {\n\t\t\tthis._tasks = this.createTasks();\n\t\t} else {\n\t\t\tthis._tasks.clearAll();\n\t\t}\n\n\t\tconst waitArr = [this.app.getService(\"backend\").tasks()];\n\t\tif (this.app.config.resourceCalendars)\n\t\t\twaitArr.push(this.taskCalendarMap(false, force));\n\n\t\tthis._tasks.parse(\n\t\t\twebix.promise.all(waitArr).then(data => {\n\t\t\t\treturn this.app.getService(\"grouping\").getTreeData(data[0], 0);\n\t\t\t})\n\t\t);\n\t\treturn this._tasks;\n\t}\n\t/**\n\t * Creates tasks collection\n\t * @returns {object} empty tasks Tree Collection\n\t */\n\tcreateTasks() {\n\t\tconst ops = this.app.getService(\"operations\");\n\t\tconst tasks = new webix.TreeCollection({\n\t\t\ton: {\n\t\t\t\t\"data->onStoreLoad\": () => {\n\t\t\t\t\tif (!this.app.config.scaleStart) this.updateScaleMinMax(tasks);\n\t\t\t\t\ttasks.data.each(d => {\n\t\t\t\t\t\tif (this.app.config.projects && d.$count) d.type = \"project\";\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t\"data->onStoreUpdated\": (id, obj, mode) => {\n\t\t\t\t\tid = mode == \"update\" ? id : null;\n\t\t\t\t\tthis.refreshTasks(id);\n\t\t\t\t\tthis.refreshLinks();\n\n\t\t\t\t\tif (!mode && this.state.criticalPath) {\n\t\t\t\t\t\tif (this.app.config.links)\n\t\t\t\t\t\t\tthis._links.waitData.then(() => this.showCriticalPath());\n\t\t\t\t\t\telse this.showCriticalPath();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t\tscheme: {\n\t\t\t\t$change: obj => {\n\t\t\t\t\tobj.start_date = webix.i18n.parseFormatDate(obj.start_date);\n\t\t\t\t\tobj.end_date = webix.i18n.parseFormatDate(obj.end_date);\n\t\t\t\t\tobj.type = obj.type || \"task\";\n\t\t\t\t\tif (!this.app.config.split && obj.type === \"split\") obj.type = \"task\";\n\n\t\t\t\t\tops.updateTaskDuration(obj);\n\n\t\t\t\t\tif (obj.planned_start) {\n\t\t\t\t\t\tobj.planned_start = webix.i18n.parseFormatDate(obj.planned_start);\n\t\t\t\t\t\tobj.planned_end = webix.i18n.parseFormatDate(obj.planned_end);\n\t\t\t\t\t\tops.updatePlannedTaskDuration(obj);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (obj.type === \"split\") {\n\t\t\t\t\t\tobj.open = obj.opened = 0;\n\t\t\t\t\t\tobj.$css = \"webix_gantt_split_task\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete obj.$css;\n\t\t\t\t\t\tobj.open = (obj.open || obj.opened) * 1 || 0;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t$sort: {\n\t\t\t\t\tby: \"position\",\n\t\t\t\t\tdir: \"asc\",\n\t\t\t\t\tas: \"int\",\n\t\t\t\t},\n\t\t\t\t$serialize: data => this.taskOut(data),\n\t\t\t\t$export: data => this.taskOut(data),\n\t\t\t},\n\t\t});\n\n\t\treturn tasks;\n\t}\n\t/**\n\t * Re-paints all tasks in chart or, if theID is provided, a specific task\n\t * @param {string|number} updID - (optional) the ID of the task\n\t * @param {number} i - the index of the task\n\t */\n\trefreshTasks(updID, i) {\n\t\t// console.log(\"[x] render tasks\");\n\t\tif (!updID) {\n\t\t\tthis._tasks.data.order.forEach((id, i) => {\n\t\t\t\tthis.refreshTasks(id, i);\n\t\t\t});\n\t\t} else {\n\t\t\tconst t = this._tasks.getItem(updID);\n\t\t\ti = !webix.isUndefined(i) ? i : this._tasks.getIndexById(updID);\n\t\t\t// type:\"split\" results in split kids missing in datastore.order\n\t\t\tif (i < 0) i = this._tasks.getIndexById(t.parent);\n\n\t\t\tif (t.type === \"split\") {\n\t\t\t\tt.$data = this._tasks\n\t\t\t\t\t.find(k => k.parent == t.id)\n\t\t\t\t\t.sort(\n\t\t\t\t\t\t(a, b) => b.start_date - a.start_date || b.end_date - a.end_date\n\t\t\t\t\t);\n\t\t\t}\n\t\t\tthis.Helpers.updateTask(t, i);\n\n\t\t\tif (this.state.baseline && t.planned_start) this.refreshBaseline(t, i);\n\t\t}\n\t}\n\n\t/**\n\t * Arranges task baseline\n\t * @param task {object} task object\n\t * @param i {number} task index\n\n\t */\n\trefreshBaseline(task, i) {\n\t\tconst t = { ...task };\n\t\tt.start_date = task.planned_start;\n\t\tt.duration = task.planned_duration;\n\t\tt.end_date = task.planned_end;\n\t\tthis.Helpers.updateTask(t, i, this._scales, this._taskHeight);\n\t\ttask.$x0 = t.$x;\n\t\ttask.$w0 = t.$w;\n\t}\n\n\t/**\n\t * Fills and returns links collection\n\t * @returns {object} links Data Collection\n\t */\n\tlinks(force) {\n\t\tif (this._links && !force) return this._links;\n\n\t\tif (!this._links) {\n\t\t\tthis._links = this.createLinks();\n\t\t} else {\n\t\t\tthis._links.clearAll();\n\t\t}\n\n\t\tif (this.app.config.links)\n\t\t\tthis._links.parse(this.app.getService(\"backend\").links());\n\t\treturn this._links;\n\t}\n\t/**\n\t * Creates and returns links collection\n\t * @returns {object} empty links Data Collection\n\t */\n\tcreateLinks() {\n\t\treturn new webix.DataCollection({\n\t\t\ton: {\n\t\t\t\t\"data->onStoreUpdated\": (id, v, mode) => {\n\t\t\t\t\t// do not refresh for initial data parsing\n\t\t\t\t\tif (mode) this.refreshLinks(id);\n\t\t\t\t},\n\t\t\t},\n\t\t\tscheme: {\n\t\t\t\t$init: obj => {\n\t\t\t\t\tobj.type = obj.type * 1;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\t/**\n\t * Re-paints all links in chart\n\t * @param {(string|number)} id - (optional) the ID of a link\n\t */\n\trefreshLinks(id) {\n\t\tconst tasks = this.getVisibleTasksCollection();\n\t\tif (this._links && tasks) {\n\t\t\tthis._links.data.each(l => {\n\t\t\t\tconst s = tasks.getItem(l.source);\n\t\t\t\tconst e = tasks.getItem(l.target);\n\t\t\t\tif (!s || !e || !this._isTaskVisible(s) || !this._isTaskVisible(e))\n\t\t\t\t\tl.$p = \"\";\n\t\t\t\telse this.Helpers.updateLink(l, s, e);\n\t\t\t});\n\n\t\t\t// refresh the critical path if a link was added, updated or removed\n\t\t\tif (this.state.criticalPath && id) {\n\t\t\t\tthis.showCriticalPath();\n\t\t\t}\n\t\t}\n\t}\n\t/**\n\t * Returns all links of a particular type for the specified task\n\t * @param {string, number} id - task id\n\t * @param {type} type - link type, \"source\" or \"target\"\n\t * @returns {array} links array\n\t */\n\tgetLinks(id, type) {\n\t\tconst found = this._links.find(a => a[type] == id);\n\t\tconst res = [];\n\n\t\tfor (let i = 0; i < found.length; i++) {\n\t\t\tconst a = found[i];\n\t\t\tconst t = this._tasks.getItem(a[type == \"source\" ? \"target\" : \"source\"]);\n\t\t\tif (t)\n\t\t\t\tres.push({\n\t\t\t\t\tid: a.id,\n\t\t\t\t\ttype: a.type.toString(),\n\t\t\t\t\ttext: t.text,\n\t\t\t\t\tttype: type,\n\t\t\t\t});\n\t\t}\n\t\treturn res;\n\t}\n\n\t/**\n\t * Prepares task data object for serializing and export\n\t * @param {Object} data - incoming task data object\n\t * @returns {Object} - processed task data object\n\t */\n\ttaskOut(data) {\n\t\tdata = webix.copy(data);\n\n\t\tconst format = this.dateToLocalStr;\n\t\tif (data.start_date) data.start_date = format(data.start_date);\n\t\tif (data.end_date) data.end_date = format(data.end_date);\n\n\t\t// clean $-fields\n\t\tfor (let k in data) {\n\t\t\tif (k.indexOf(\"$\") === 0) delete data[k];\n\t\t}\n\n\t\treturn data;\n\t}\n\n\t/**\n\t * Checks whether the specified task is visible (all parents open)\n\t * @param {object} x - task object\n\t * @param {boolean} tcollection - if true, the method will return the main collection regardless of the current display mode\n\t * @returns {boolean} task visibility\n\t */\n\t_isTaskVisible(x, tcollection) {\n\t\t// display: \"resources\" case to hide projects\n\t\tconst tasks = this.getVisibleTasksCollection(tcollection);\n\n\t\tconst taskParent = x.$parent;\n\t\tconst taskSplit = x.type === \"split\" && !x.open;\n\n\t\tif (taskSplit && !taskParent) return false;\n\t\twhile (x.$parent) {\n\t\t\tx = tasks.getItem(x.$parent);\n\t\t\tif (\n\t\t\t\t!((taskParent == x.id && x.type == \"split\") || x.open) ||\n\t\t\t\t(x.open && taskSplit)\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\t/**\n\t * Creates, fills and returns resource categories collection\n\t * @returns {object} categories Data Collection\n\t */\n\tcategories(force) {\n\t\tif (this._categories && !force) return this._categories;\n\t\tif (!this._categories) {\n\t\t\tthis._categories = new webix.DataCollection({});\n\t\t} else {\n\t\t\tthis._categories.clearAll();\n\t\t}\n\n\t\tthis._categories.parse(this.app.getService(\"backend\").categories());\n\t\treturn this._categories;\n\t}\n\n\t/**\n\t * Creates, fills and returns resource collection\n\t * @returns {object} resources Data Collection\n\t */\n\tresources(force) {\n\t\tif (this._resources && !force) return this._resources;\n\n\t\tif (!this._resources) {\n\t\t\tthis._resources = new webix.DataCollection({});\n\t\t} else {\n\t\t\tthis._resources.clearAll();\n\t\t}\n\n\t\tlet waitArr = [\n\t\t\tthis.app.getService(\"backend\").resources(),\n\t\t\tthis.categories(force).waitData,\n\t\t];\n\t\tif (this.app.config.resourceCalendars)\n\t\t\twaitArr.push(this.calendars(force).waitData);\n\n\t\tthis._resources.parse(\n\t\t\twebix.promise.all(waitArr).then(arr => {\n\t\t\t\tlet rData = arr[0];\n\t\t\t\trData.forEach(resource => {\n\t\t\t\t\tif (resource[\"category_id\"]) {\n\t\t\t\t\t\tconst ctg = this.categories().getItem(resource[\"category_id\"]);\n\t\t\t\t\t\tresource.category = ctg.name;\n\t\t\t\t\t\tif (!resource.unit && ctg.unit) resource.unit = ctg.unit;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\trData.sort(this.app.getService(\"operations\").sortResources);\n\t\t\t\treturn rData;\n\t\t\t})\n\t\t);\n\t\treturn this._resources;\n\t}\n\n\t/**\n\t * Creates, fills and returns resource-task relation collection\n\t * @returns {object} assignments Data Collection\n\t */\n\tassignments(force) {\n\t\tif (this._assignments && !force) return this._assignments;\n\n\t\tif (!this._assignments) {\n\t\t\tthis._assignments = new webix.DataCollection({});\n\t\t} else {\n\t\t\tthis._assignments.clearAll();\n\t\t}\n\n\t\tthis._assignments.parse(this.app.getService(\"backend\").assignments());\n\t\treturn this._assignments;\n\t}\n\n\t/**\n\t * Returns all resource assignments for the specified task\n\t * @param {string, number} id - a task id\n\t * @returns {array} an array of assignments extended with resource properties\n\t */\n\tgetAssignments(id) {\n\t\treturn webix.promise\n\t\t\t.all([this.resources().waitData, this.assignments().waitData])\n\t\t\t.then(() => {\n\t\t\t\tconst resources = this.resources();\n\t\t\t\tconst assigned = this.assignments().data.find(a => a.task == id);\n\t\t\t\treturn assigned.map(a => {\n\t\t\t\t\tlet aCopy = Object.assign({}, a);\n\t\t\t\t\tlet resource = Object.assign({}, resources.getItem(a.resource));\n\t\t\t\t\tdelete resource.id;\n\t\t\t\t\treturn Object.assign(aCopy, resource);\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\t/**\n\t * Fills and returns calendars collection for resources\n\t * @returns {object} calendars Data Collection\n\t */\n\tcalendars(force) {\n\t\tif (this._calendars && !force) return this._calendars;\n\n\t\tif (!this._calendars) {\n\t\t\tthis._calendars = this.createCalendars();\n\t\t} else {\n\t\t\tthis._calendars.clearAll();\n\t\t}\n\n\t\tthis._calendars.parse(this.app.getService(\"backend\").calendars());\n\t\treturn this._calendars;\n\t}\n\t/**\n\t * Creates calendars collection for resources\n\t * @returns {object} calendars Data Collection\n\t */\n\tcreateCalendars() {\n\t\treturn new webix.DataCollection({\n\t\t\tscheme: {\n\t\t\t\t$change: obj => {\n\t\t\t\t\tif (typeof obj.weekDays == \"string\")\n\t\t\t\t\t\tobj.weekDays = obj.weekDays.split(\",\").map(a => 1 * a);\n\t\t\t\t\tif (obj.holidays) {\n\t\t\t\t\t\tif (typeof obj.holidays == \"string\")\n\t\t\t\t\t\t\tobj.holidays = obj.holidays.split(\",\");\n\t\t\t\t\t\tobj.holidays = obj.holidays.map(d =>\n\t\t\t\t\t\t\twebix.Date.datePart(new Date(d))\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n\n\t/**\n\t * Marks all tasks as critical or not\n\t * @param {Boolean} clean - pass true if you want to remove existing critical path markers\n\t */\n\tshowCriticalPath(clean) {\n\t\tif (clean) {\n\t\t\tthis._tasks.data.order.forEach(id => {\n\t\t\t\tconst task = this._tasks.getItem(id);\n\t\t\t\tdelete task.$critical;\n\t\t\t});\n\t\t} else {\n\t\t\tconst all = this._tasks.data.getRange().sort((a, b) => {\n\t\t\t\treturn (\n\t\t\t\t\tb.end_date - a.end_date ||\n\t\t\t\t\t(a.parent == b.id ? 1 : b.parent == a.id ? -1 : 0) ||\n\t\t\t\t\tb.start_date - a.start_date\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tlet latestDate = webix.Date.copy(all[0].end_date);\n\t\t\tall.forEach(task => {\n\t\t\t\ttask.$critical = this.isTaskCritical(task, latestDate);\n\t\t\t});\n\t\t}\n\t\tthis._tasks.data.callEvent(\"onStoreUpdated\", [null, null, \"paint\"]);\n\t}\n\t/**\n\t * Decides if a task is a part of the critical path\n\t * @param {Object} task - task data\n\t * @param {Date} latestDate - the date by which all tasks end\n\t * @returns {Boolean}\n\t */\n\tisTaskCritical(task, latestDate) {\n\t\tif (latestDate && webix.Date.equal(latestDate, task.end_date)) {\n\t\t\treturn true;\n\t\t} else {\n\t\t\tconst links = this._links.find(l => l.source == task.id && l.type == 0);\n\t\t\tfor (let i = 0; i < links.length; ++i) {\n\t\t\t\t// a task is critical if its end is linked to the start of a critical task\n\t\t\t\t// and there is no slack time between them\n\t\t\t\tconst dependent = this._tasks.getItem(links[i].target);\n\t\t\t\tif (\n\t\t\t\t\tdependent.$critical &&\n\t\t\t\t\tthis.isNoSlack(dependent.start_date, task.end_date, task.id)\n\t\t\t\t)\n\t\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (task.parent != 0) {\n\t\t\t\tconst parent = this._tasks.getItem(task.parent);\n\t\t\t\treturn parent.$critical && task.end_date >= parent.end_date;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\t}\n\n\t/**\n\t * Checks if there is slack between 2 linked tasks\n\t * @param {Date} nextStart - the start date of the next linked task\n\t * @param {Date} currentEnd - the end date of the currently checked task\n\t * @param {String} taskId - the id of the currently checked task (optional, resourceCalendar related)\n\t * @returns {Boolean} the result of the check; true if there is no slack\n\t */\n\tisNoSlack(nextStart, currentEnd, taskId) {\n\t\tif (this.app.config.excludeHolidays) {\n\t\t\tif (currentEnd >= nextStart) return true;\n\n\t\t\tfor (let date = webix.Date.copy(currentEnd); date < nextStart; ) {\n\t\t\t\tif (!this.isHoliday(date, taskId)) return false;\n\t\t\t\twebix.Date.add(date, 1, \"day\");\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\t\treturn currentEnd >= nextStart;\n\t}\n\n\t/**\n\t * Decides if a link is a part of the critical path\n\t * @param {Object} link - the data object of a link\n\t * @returns {Boolean} the result of the check; true if the link connects critical tasks\n\t */\n\tisLinkCritical(link) {\n\t\tlet critical = false;\n\t\tif (link.type == 0) {\n\t\t\tconst tasks = this.tasks();\n\t\t\tconst s = tasks.getItem(link.source);\n\t\t\tconst t = tasks.getItem(link.target);\n\t\t\tcritical = s && t && s.$critical && t.$critical;\n\t\t}\n\t\treturn critical;\n\t}\n\n\t/**\n\t * Gets visible tasks collection\n\t * @param {boolean} tasks - if true, the method will return the main collection regardless of the current display mode\n\t * @returns {object} webix.TreeCollection\n\t */\n\tgetVisibleTasksCollection(tasks) {\n\t\tif (!tasks && this.state.display == \"resources\") {\n\t\t\tconst g = this.app.getService(\"grouping\");\n\t\t\treturn g ? g.getResourceTree() : null;\n\t\t}\n\t\treturn this._tasks;\n\t}\n\n\ttaskCalendarMap(now, force) {\n\t\tif (now) return this._calendarMap || null;\n\n\t\tif (!this._calendarMap) {\n\t\t\tthis.assignments().data.attachEvent(\"onStoreUpdated\", () => {\n\t\t\t\tthis.refreshCalendarMap();\n\t\t\t});\n\t\t\tthis.resources().data.attachEvent(\"onStoreUpdated\", () => {\n\t\t\t\tthis.refreshCalendarMap();\n\t\t\t});\n\t\t\tthis.calendars().data.attachEvent(\"onStoreUpdated\", () => {\n\t\t\t\tthis.refreshCalendarMap();\n\t\t\t});\n\t\t}\n\n\t\tconst waitArr = [\n\t\t\tthis.assignments(force).waitData,\n\t\t\tthis.resources(force).waitData,\n\t\t];\n\n\t\t// forced from resources\n\t\tif (!force) {\n\t\t\twaitArr.push(this.calendars().waitData);\n\t\t}\n\n\t\treturn webix.promise.all(waitArr).then(() => {\n\t\t\tif (!this._calendarMap) this.refreshCalendarMap();\n\t\t\treturn this._calendarMap;\n\t\t});\n\t}\n\trefreshCalendarMap() {\n\t\tconst resources = this.resources();\n\t\tconst calendars = this.calendars();\n\t\tlet data = {};\n\t\tthis.assignments().data.each(obj => {\n\t\t\tconst resource = resources.getItem(obj.resource);\n\t\t\tif (resource) {\n\t\t\t\tconst id = resource.calendar_id;\n\t\t\t\tconst cal = id ? calendars.getItem(id) : null;\n\t\t\t\tif (cal && !data[obj.task]) data[obj.task] = cal;\n\t\t\t}\n\t\t});\n\t\treturn (this._calendarMap = data);\n\t}\n\n\tgetTaskCalendar(taskId) {\n\t\tconst map = this.taskCalendarMap(true);\n\t\treturn map ? map[taskId] : null;\n\t}\n\tisHoliday(date, taskId) {\n\t\tif (taskId && this._calendarMap) {\n\t\t\tconst calendar = this._calendarMap[taskId];\n\t\t\tif (calendar) return this.Helpers.isResourceHoliday(date, calendar);\n\t\t}\n\t\treturn this.app.config.isHoliday(date);\n\t}\n\n\t/**\n\t * Clears all existing data collections; resets aggregated data, state, and scales\n\t */\n\tclearAll() {\n\t\tconst grouping = this.app.getService(\"grouping\");\n\t\tconst collections = [\n\t\t\t\"tasks\",\n\t\t\t\"links\",\n\t\t\t\"resources\",\n\t\t\t\"categories\",\n\t\t\t\"assignments\",\n\t\t\t\"calendars\",\n\t\t];\n\n\t\tthis.state.$batch({\n\t\t\tedit: null,\n\t\t\tselected: null,\n\t\t\tsort: null,\n\t\t\ttop: 0,\n\t\t\tleft: 0,\n\t\t});\n\n\t\tif (this.app.config.resourcesDiagram) {\n\t\t\tconst rdCollection = grouping.getRDCollection();\n\t\t\trdCollection.clearAll();\n\t\t}\n\n\t\tif (this.app.config.resources) {\n\t\t\tconst rCollection = grouping.getResourceTree();\n\t\t\trCollection.clearAll();\n\t\t}\n\n\t\tcollections.forEach(name => {\n\t\t\tconst key = \"_\" + name;\n\t\t\tif (this[key]) this[key].clearAll();\n\t\t});\n\n\t\tthis.resetScales();\n\t}\n\n\t/**\n\t * Completely reloads data in the component; repaints application with new data\n\t */\n\treload() {\n\t\tthis.clearAll();\n\n\t\tconst grouping = this.app.getService(\"grouping\");\n\t\tconst collections = [\"tasks\", \"links\"];\n\t\tconst waitArr = [];\n\n\t\tif (this.app.config.resources && !this.app.config.resourceCalendars) {\n\t\t\tcollections.push(\"resources\", \"assignments\");\n\t\t}\n\n\t\tcollections.forEach(name => {\n\t\t\tconst collection = this[name](true);\n\t\t\twaitArr.push(collection.waitData);\n\t\t});\n\n\t\tif (this.app.config.resourcesDiagram) {\n\t\t\tgrouping.getRDCollection(true);\n\t\t}\n\n\t\twebix.promise.all(waitArr).then(() => {\n\t\t\tthis.app.refresh();\n\t\t});\n\t}\n\tupdateScaleMinMax(tasks) {\n\t\tlet min = Infinity;\n\t\tlet max = -Infinity;\n\t\ttasks.data.each(d => {\n\t\t\tif (d.start_date < min) min = d.start_date;\n\t\t\tif (d.end_date > max) max = d.end_date;\n\t\t\tif (this.state.baseline && d.planned_start && d.planned_end) {\n\t\t\t\tif (d.planned_start < min) min = d.planned_start;\n\t\t\t\tif (d.planned_end > max) max = d.planned_end;\n\t\t\t}\n\t\t});\n\t\tif (typeof min === \"object\") {\n\t\t\tconst s = this.getScales();\n\t\t\tthis.setScales(\n\t\t\t\tthis.Helpers.addUnit(s.minUnit, min, -1),\n\t\t\t\tthis.Helpers.addUnit(s.minUnit, max, 1),\n\t\t\t\ts.precise\n\t\t\t);\n\t\t}\n\t}\n}\n","export default class Backend {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t * @param {string} url - server url\n\t */\n\tconstructor(app, url) {\n\t\tthis.app = app;\n\t\tthis._url = url;\n\t}\n\t/**\n\t * Returns absolute url based on relative one\n\t * @param {string} path - relative url\n\t * @returns {string} absolute url\n\t */\n\turl(path) {\n\t\treturn this._url + path;\n\t}\n\t/**\n\t * Loads tasks\n\t * @returns {promise} promise that resolves with tasks array\n\t */\n\ttasks() {\n\t\treturn webix.ajax(this.url(\"tasks\")).then(res => res.json());\n\t}\n\t/**\n\t * Loads links\n\t * @returns {promise} promise that resolves with links array\n\t */\n\tlinks() {\n\t\treturn webix.ajax(this.url(\"links\")).then(res => res.json());\n\t}\n\t/**\n\t * Loads resources\n\t * @returns {promise} promise that resolves with resources array\n\t */\n\tresources() {\n\t\treturn webix.ajax(this.url(\"resources\")).then(res => res.json());\n\t}\n\t/**\n\t * Loads resource categories\n\t * @returns {promise} promise that resolves with categories data\n\t */\n\tcategories() {\n\t\treturn webix.ajax(this.url(\"categories\")).then(res => res.json());\n\t}\n\t/**\n\t * Loads task-resource data\n\t * @returns {promise} promise that resolves with array of task-resource assignments\n\t */\n\tassignments() {\n\t\treturn webix.ajax(this.url(\"assignments\")).then(res => res.json());\n\t}\n\t/**\n\t * Returns calendars collection for resources\n\t * @returns {object} calendars Data Collection\n\t */\n\tcalendars() {\n\t\treturn webix.ajax(this.url(\"calendars\")).then(res => res.json());\n\t}\n\t/**\n\t * Adds task\n\t * @param {object} obj - object with task fields\n\t * @param {string} mode - the relative position of the new task in a branch: \"first\", \"last\", \"after\"\n\t * @param {(string|number)} parent - parent task id, can be \"0\" for root\n\t * @returns {promise} promise that resolves with server response\n\t */\n\taddTask(obj, mode, parent) {\n\t\tconst inProgress = webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"tasks\"), { ...obj, mode, parent })\n\t\t\t.then(res => res.json());\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\treturn inProgress;\n\t}\n\t/**\n\t * Removes task\n\t * @param {string, number} id - task id\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tremoveTask(id) {\n\t\tconst inProgress = webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"tasks/\" + id))\n\t\t\t.then(res => res.json());\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\treturn inProgress;\n\t}\n\t/**\n\t * Updates task\n\t * @param {(string|number)} id - task id\n\t * @param {Object} obj - object with task fields\n\t * @param {Boolean} split - flag that indicates that this is a splitting of a task\n\t * @returns {Promise} promise that resolves with with server response\n\t */\n\tupdateTask(id, obj, split) {\n\t\tconst inProgress = webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"tasks/\" + id + (split ? \"/split\" : \"\")), obj)\n\t\t\t.then(res => res.json());\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\treturn inProgress;\n\t}\n\n\t/**\n\t * Changes order of tasks\n\t * @param {(string|number)} id - task id\n\t * @param {Object} obj - task position\n\t * @returns {Promise} promise that resolves with with server response\n\t */\n\treorderTask(id, obj) {\n\t\tconst inProgress = webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"tasks/\" + id + \"/position\"), obj)\n\t\t\t.then(res => res.json());\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\treturn inProgress;\n\t}\n\t/**\n\t * Adds link\n\t * @param {object} obj - object with link fields\n\t * @returns {promise} promise that resolves with server response\n\t */\n\taddLink(obj) {\n\t\tconst inProgress = webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"links\"), obj)\n\t\t\t.then(res => res.json());\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\treturn inProgress;\n\t}\n\t/**\n\t * Updates link\n\t * @param {string, number} id - link id\n\t * @param {object} obj - object with link fields\n\t * @returns {promise} promise that resolves with with server response\n\t */\n\tupdateLink(id, obj) {\n\t\tconst inProgress = webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"links/\" + id), obj)\n\t\t\t.then(res => res.json());\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\treturn inProgress;\n\t}\n\t/**\n\t * Removes link\n\t * @param {string, number} id - task id\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tremoveLink(id) {\n\t\tconst inProgress = webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"links/\" + id))\n\t\t\t.then(res => res.json());\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\treturn inProgress;\n\t}\n\t/**\n\t * Adds a new resource assignment to a task\n\t * @param {object} obj - an object with \"task\", \"resource\" and \"value\" fields\n\t * @returns {promise} a promise that is resolved with an object of a resource task\n\t */\n\taddAssignment(obj) {\n\t\tconst inProgress = webix\n\t\t\t.ajax()\n\t\t\t.post(this.url(\"assignments\"), obj)\n\t\t\t.then(res => res.json());\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\treturn inProgress;\n\t}\n\t/**\n\t * Updates resource assignment\n\t * @param {string, number} id -  an id of a task resource record\n\t * @param {object} obj - an object with record fields\n\t * @returns {promise} a promise that is resolved with server response\n\t */\n\tupdateAssignment(id, obj) {\n\t\tconst inProgress = webix\n\t\t\t.ajax()\n\t\t\t.put(this.url(\"assignments/\" + id), obj)\n\t\t\t.then(res => res.json());\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\treturn inProgress;\n\t}\n\t/**\n\t * Removes resource assignment\n\t * @param {string, number} id - an id of an assignment record\n\t * @returns {promise} a promise that is resolved with server response\n\t */\n\tremoveAssignment(id) {\n\t\tconst inProgress = webix\n\t\t\t.ajax()\n\t\t\t.del(this.url(\"assignments/\" + id))\n\t\t\t.then(res => res.json());\n\t\tthis.app.callEvent(\"backend:operation\", [inProgress]);\n\t\treturn inProgress;\n\t}\n}\n","export default class Operations {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t */\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis._local = this.app.getService(\"local\");\n\t\tthis._helpers = this.app.getService(\"helpers\");\n\t\tthis._back = this.app.getService(\"backend\");\n\t\tthis._state = this.app.getState();\n\t}\n\t/**\n\t * Adds task\n\t * @param {object} obj - object with task fields\n\t * @param {number} index - index within a parent branch, 0 or -1\n\t * @param {string, number} parent - parent task id, can be \"0\" for root\n\t * @param {string} mode - (optional) name of the change, \"move\", \"start\", \"end\" or \"duration\"\n\t * @returns {promise} promise that resolves with task object\n\t */\n\taddTask(obj, index, parent, mode) {\n\t\tthis.updateTaskDuration(obj, mode);\n\t\tif (obj.planned_start) this.updatePlannedTaskDuration(obj, mode);\n\n\t\tconst addMode = index == 0 ? \"first\" : \"last\";\n\t\treturn this._back\n\t\t\t.addTask(this.cleanData(obj), addMode, parent)\n\t\t\t.then(added => {\n\t\t\t\tthis._local.adjustScale(obj);\n\n\t\t\t\tconst tasks = this._local.tasks();\n\t\t\t\ttasks.add({ ...obj, id: added.id, parent }, index, parent);\n\n\t\t\t\treturn this.completeAdd(parent, added);\n\t\t\t});\n\t}\n\n\t/**\n\t * Splits a task via dnd (adds a subtask that will be rendered in the same line)\n\t * @param {Object} obj - data of a new subtask\n\t * @param {number} index - the index of a new subtask\n\t * @param {(string|number)} parent - the ID of the parent task\n\t * @param {Object} row - data of the parent task\n\t * @returns {Promise<Object>} a promise that resolves with server response (object like {id:\"some\", sibling:\"some\"} with task ids)\n\t */\n\tsplitTaskWithDnd(obj, index, parent, row) {\n\t\tthis.updateTaskDuration(obj);\n\t\treturn this._back\n\t\t\t.updateTask(parent, { ...obj, position: index, parent }, true)\n\t\t\t.then(res => {\n\t\t\t\tthis._local.adjustScale(obj);\n\n\t\t\t\tconst tasks = this._local.tasks();\n\t\t\t\ttasks.updateItem(parent, {\n\t\t\t\t\ttype: \"split\",\n\t\t\t\t\tduration: row.duration || 1,\n\t\t\t\t\tprogress: row.progress || 0,\n\t\t\t\t});\n\t\t\t\tif (\n\t\t\t\t\t(res.sibling && res.sibling != 0) ||\n\t\t\t\t\t!tasks.find(t => t.parent == parent, true)\n\t\t\t\t) {\n\t\t\t\t\ttasks.add(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t...row,\n\t\t\t\t\t\t\ttype: \"task\",\n\t\t\t\t\t\t\tparent,\n\t\t\t\t\t\t\tid: res.sibling,\n\t\t\t\t\t\t\tduration: row.duration || 1,\n\t\t\t\t\t\t\tprogress: row.progress || 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t0,\n\t\t\t\t\t\tparent\n\t\t\t\t\t);\n\t\t\t\t\t++index;\n\t\t\t\t}\n\n\t\t\t\ttasks.add(\n\t\t\t\t\t{ ...obj, id: res.id, parent, position: index },\n\t\t\t\t\tindex,\n\t\t\t\t\tparent\n\t\t\t\t);\n\n\t\t\t\treturn this.completeAdd(parent, res, res.sibling);\n\t\t\t});\n\t}\n\n\t/**\n\t * Runs some common logic for add and split operations (see comments inside the method)\n\t * @param {(string|number)} parent - the ID of a parent task\n\t * @param {Object} added - server response (object like {id:\"some\", sibling:\"some\"} with task ids, sib;ing is optional)\n\t * @param {id} sibling - (optional) the ID of a first sibling added to split task that was ordinary before splitting\n\t * @returns {Promise<Object>} a promise that resolves with server response (object like {id:\"some\", sibling:\"some\"} with task ids)\n\t */\n\tcompleteAdd(parent, added, sibling) {\n\t\tif (parent) {\n\t\t\treturn this.syncProject(parent).then(() => {\n\t\t\t\t// critical path update\n\t\t\t\tif (this._state.criticalPath) this._local.showCriticalPath();\n\n\t\t\t\tif (sibling) added.sibling = sibling;\n\t\t\t\treturn added;\n\t\t\t});\n\t\t} else return webix.promise.resolve(added);\n\t}\n\n\t/**\n\t * Updates task\n\t * @param {string, number} id - task id\n\t * @param {object} obj - object with task fields\n\t * @param {string} mode - (optional) name of the change, \"move\", \"start\", \"end\" or \"duration\"\n\t * @param {boolean} inner - (optional) flag to mark inner logic call\n\t * @returns {promise} promise that resolves with task fields\n\t */\n\tupdateTask(id, obj, mode, inner) {\n\t\tconst tasks = this._local.tasks();\n\t\tconst item = webix.copy(tasks.getItem(id));\n\t\tconst next = { ...item, ...obj };\n\n\t\tlet updateDates = !(\n\t\t\twebix.Date.equal(item.start_date, next.start_date) &&\n\t\t\twebix.Date.equal(item.end_date, next.end_date)\n\t\t);\n\t\tif (updateDates) {\n\t\t\tthis.updateTaskDuration(next, mode);\n\t\t}\n\t\tconst updatePlanned =\n\t\t\tnext.planned_start &&\n\t\t\t!(\n\t\t\t\twebix.Date.equal(item.planned_start, next.planned_start) &&\n\t\t\t\twebix.Date.equal(item.planned_end, next.planned_end)\n\t\t\t);\n\t\tif (updatePlanned) this.updatePlannedTaskDuration(next, mode);\n\n\t\tif (!inner && next.type == \"project\" && item.type != \"project\")\n\t\t\treturn this.syncProject(id, next);\n\n\t\treturn this._back.updateTask(id, this.cleanData(next)).then(() => {\n\t\t\t// scale must be updated before the task\n\t\t\tconst { start, end } = this._local.getScales();\n\t\t\tif (\n\t\t\t\tstart > next.start_date ||\n\t\t\t\tend < next.end_date ||\n\t\t\t\t(updatePlanned &&\n\t\t\t\t\t(start > next.planned_start || end < next.planned_end))\n\t\t\t)\n\t\t\t\tthis._local.adjustScale(next);\n\n\t\t\ttasks.updateItem(id, next);\n\n\t\t\tif (next.type != \"task\" && item.type == \"task\")\n\t\t\t\tthis.removeAssignments(next);\n\n\t\t\t//update dependent project or tasks\n\t\t\tif (\n\t\t\t\t!inner &&\n\t\t\t\t(updateDates ||\n\t\t\t\t\titem.progress != next.progress ||\n\t\t\t\t\titem.parent != next.parent)\n\t\t\t) {\n\t\t\t\tlet res;\n\t\t\t\tif (item.$count && item.type == \"project\")\n\t\t\t\t\tres = this.syncTasks(id, item.start_date, next.start_date).then(\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\treturn this.syncProject(item.parent);\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\telse {\n\t\t\t\t\tif (item.parent != next.parent) {\n\t\t\t\t\t\tres = webix.promise.all([\n\t\t\t\t\t\t\tthis.syncProject(next.parent),\n\t\t\t\t\t\t\tthis.syncProject(item.parent),\n\t\t\t\t\t\t]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tres = this.syncProject(next.parent);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// critical path update\n\t\t\t\tres.then(() => {\n\t\t\t\t\tif (this._state.criticalPath) {\n\t\t\t\t\t\ttasks.updateItem(id, { $critical: false });\n\t\t\t\t\t\tthis._local.showCriticalPath();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn next;\n\t\t});\n\t}\n\n\t/**\n\t * Normalizes task end_date and duration correspondence\n\t * @param {Object} task - a task\n\t * @param {string} mode - type of date data operation: \"move\", \"start\", \"end\", \"duration\", undefined\n\t */\n\tupdateTaskDuration(task, mode) {\n\t\tif (this.app.config.excludeHolidays) {\n\t\t\tlet dir;\n\t\t\tif (mode) {\n\t\t\t\tmode = mode == \"move\" ? \"start\" : mode;\n\t\t\t\tconst old = this._local.tasks().getItem(task.id);\n\t\t\t\tconst field =\n\t\t\t\t\tmode + (mode === \"start\" || mode === \"end\" ? \"_date\" : \"\");\n\t\t\t\tdir = old[field] > task[field] ? -1 : 1;\n\t\t\t\tif (mode != \"start\") mode = \"end\";\n\t\t\t}\n\t\t\tlet scales = webix.copy(this._local.getScales());\n\t\t\tscales.isHoliday = date => {\n\t\t\t\treturn this._local.isHoliday(date, task.id);\n\t\t\t};\n\t\t\tthis._helpers.updateTaskDuration(task, scales, mode, dir);\n\t\t} else this._helpers.updateTaskDuration(task);\n\t}\n\n\tupdatePlannedTaskDuration(task, mode) {\n\t\tif (this.app.config.excludeHolidays) {\n\t\t\tlet dir;\n\t\t\tif (mode) {\n\t\t\t\tconst old = this._local.tasks().getItem(task.id);\n\t\t\t\tconst field = \"planned_\" + mode;\n\t\t\t\tdir = old[field] > task[field] ? -1 : 1;\n\t\t\t}\n\t\t\tlet scales = webix.copy(this._local.getScales());\n\t\t\tscales.isHoliday = date => {\n\t\t\t\treturn this._local.isHoliday(date, task.id);\n\t\t\t};\n\t\t\tthis._updatePlannedTaskDuration(task, scales, mode, dir);\n\t\t} else this._updatePlannedTaskDuration(task);\n\t}\n\t_updatePlannedTaskDuration(task, scales, mode, dir) {\n\t\tconst t = { ...task };\n\t\tt.start_date = task.planned_start;\n\t\tt.duration = task.planned_duration;\n\t\tt.end_date = task.planned_end;\n\t\tthis._helpers.updateTaskDuration(t, scales, mode, dir);\n\t\ttask.planned_start = t.start_date;\n\t\ttask.planned_end = t.end_date;\n\t\ttask.planned_duration = t.duration;\n\t}\n\n\t/**\n\t * Updates related tasks when project start changes\n\t * @param {string, number} id - project id\n\t * @param {Date} old - old start date\n\t * @param {Date} change - current start date\n\t */\n\tsyncTasks(id, old, change) {\n\t\tlet diff = change - old;\n\n\t\tif (this.app.config.excludeHolidays)\n\t\t\tdiff = this.getWorkDateDiff(diff, old, id);\n\n\t\tif (diff) {\n\t\t\tconst p = [];\n\t\t\tthis._local.tasks().data.eachSubItem(id, kid => {\n\t\t\t\tlet newDate = kid.start_date.valueOf() + diff;\n\t\t\t\tif (this.app.config.excludeHolidays) {\n\t\t\t\t\tconst delta =\n\t\t\t\t\t\tdiff - this.getWorkDateDiff(diff, kid.start_date, kid.id);\n\t\t\t\t\tif (delta) newDate = newDate + delta;\n\t\t\t\t}\n\n\t\t\t\tconst changedKid = {\n\t\t\t\t\t...kid,\n\t\t\t\t\tstart_date: new Date(newDate),\n\t\t\t\t\tend_date: null,\n\t\t\t\t};\n\n\t\t\t\tp.push(this.updateTask(kid.id, changedKid, \"move\", true));\n\t\t\t});\n\t\t\treturn webix.promise.all(p);\n\t\t}\n\n\t\treturn webix.promise.resolve();\n\t}\n\t/**\n\t * Extracts working days from date difference\n\t * @param {number} diff - difference in days, milliseconds\n\t * @param {Date} old - the original date\n\t * @param {string} taskId - a task id (optional, resourceCalendars related)\n\t * @returns {number} difference in working days in milliseconds\n\t */\n\tgetWorkDateDiff(diff, old, taskId) {\n\t\tconst dir = Math.sign(diff);\n\t\tconst dayLen = 86400000;\n\t\tconst ad = dir * Math.floor(diff / dayLen);\n\t\tfor (let i = 0, date = old; i < ad; ++i) {\n\t\t\twebix.Date.add(date, dir, \"day\");\n\t\t\tif (this._local.isHoliday(date, taskId)) diff = diff - dir * dayLen;\n\t\t}\n\t\treturn diff;\n\t}\n\n\t/**\n\t * Updates related project when task start or end date changes\n\t * @param {string, number} id - task id\n\t * @param {object} item - task object, if it is converted to project\n\t * @returns {Promise}\n\t */\n\tsyncProject(id, item) {\n\t\tconst tasks = this._local.tasks();\n\n\t\tif (!item) {\n\t\t\titem = tasks.getItem(id);\n\t\t\tif (this.app.config.projects && item && item.type != \"split\") {\n\t\t\t\titem.type = item.$count ? \"project\" : \"task\";\n\t\t\t\tthis.removeAssignments(item);\n\t\t\t} else {\n\t\t\t\twhile (item && item.type != \"project\") {\n\t\t\t\t\tid = tasks.getParentId(id);\n\t\t\t\t\titem = tasks.getItem(id);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (item && item.$count) {\n\t\t\titem = this.setProjectData(item);\n\t\t}\n\t\tif (item) {\n\t\t\treturn this.updateTask(id, item, \"start\", true).then(() => {\n\t\t\t\tthis.syncProject(item.parent);\n\t\t\t\treturn item;\n\t\t\t});\n\t\t} else return webix.promise.resolve();\n\t}\n\t/**\n\t * Updates project with task-dependent data taken from tasks collection or an array of child items\n\t * @param {object} item - a project object\n\t * @param {Object} tasks collection (optional, local.tasks() by default)\n\t * @param {array} branch - an array of child items of a project (optional)\n\t */\n\tsetProjectData(item, tasks, branch) {\n\t\tif (!branch) item = webix.copy(item);\n\t\tlet min = Infinity,\n\t\t\tmax = 0,\n\t\t\tprogress = 0,\n\t\t\tduration = 0;\n\n\t\tconst handler = kid => {\n\t\t\tmin = kid.start_date < min ? kid.start_date : min;\n\t\t\tmax = kid.end_date > max ? kid.end_date : max;\n\t\t\tif (kid.duration && !(kid.type == \"project\" && kid.$count)) {\n\t\t\t\tprogress += kid.duration * kid.progress;\n\t\t\t\tduration += kid.duration * 1;\n\t\t\t}\n\t\t};\n\n\t\tif (branch) branch.forEach(handler);\n\t\telse {\n\t\t\tconst collection = tasks || this._local.tasks();\n\t\t\tcollection.data.eachSubItem(item.id, handler);\n\t\t}\n\n\t\tif (!webix.Date.equal(item.start_date, min)) {\n\t\t\titem.start_date = min;\n\t\t\titem.duration = null;\n\t\t}\n\t\tif (!webix.Date.equal(item.end_date, max)) {\n\t\t\titem.end_date = max;\n\t\t\titem.duration = null;\n\t\t}\n\t\titem.progress = progress ? Math.round(progress / duration) : progress;\n\t\treturn item;\n\t}\n\t/**\n\t * Updates task time after drag-n-drop\n\t * @param {string, number} id - task id\n\t * @param {string} mode - type of change: \"start\", \"end\" or \"move\"\n\t * @param {number} time - number of units by which task was shifted, can be negative\n\t * @returns {promise} promise that resolves with change object\n\t */\n\tupdateTaskTime(id, mode, time) {\n\t\tconst tasks = this._local.tasks();\n\t\tconst task = tasks.getItem(id);\n\n\t\tconst obj = {};\n\t\tconst s = this._local.getScales();\n\n\t\tconst unit = s.precise\n\t\t\t? this._helpers.getSmallerUnit(s.minUnit)\n\t\t\t: s.minUnit;\n\t\tif (mode === \"start\" || mode === \"move\") {\n\t\t\tconst offsetDate = s.precise\n\t\t\t\t? task.start_date\n\t\t\t\t: this._helpers.getUnitStart(unit, task.start_date);\n\t\t\tobj.start_date = this._helpers.addUnit(unit, offsetDate, time);\n\t\t\tif (mode === \"start\" && obj.start_date > task.end_date)\n\t\t\t\tobj.start_date = this._helpers.addUnit(unit, task.end_date, -1);\n\t\t} else if (mode === \"end\") {\n\t\t\tconst us = this._helpers.getUnitStart(unit, task.end_date);\n\t\t\tconst offsetDate =\n\t\t\t\ts.precise || webix.Date.equal(us, task.end_date)\n\t\t\t\t\t? task.end_date\n\t\t\t\t\t: this._helpers.addUnit(unit, us, 1);\n\t\t\tobj.end_date = this._helpers.addUnit(unit, offsetDate, time);\n\n\t\t\tif (obj.end_date < task.start_date)\n\t\t\t\tobj.end_date = this._helpers.addUnit(unit, task.start_date, 1);\n\t\t}\n\n\t\tif (mode === \"move\") obj.end_date = null;\n\t\telse obj.duration = 0;\n\n\t\treturn this.updateTask(id, obj, mode);\n\t}\n\t/**\n\t * Removes task\n\t * @param {string, number} id - task id\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tremoveTask(id) {\n\t\tconst tasks = this._local.tasks();\n\t\tconst links = this._local.links();\n\n\t\t// [FIXME] - multiple redraw calls\n\t\tconst toRemove = links.find(a => a.source == id || a.target == id);\n\t\ttoRemove.forEach(a => links.remove(a.id));\n\n\t\treturn this._back.removeTask(id).then(res => {\n\t\t\tconst parent = tasks.getItem(id).parent;\n\t\t\ttasks.remove(id);\n\n\t\t\tif (\n\t\t\t\tthis.app.config.split &&\n\t\t\t\tparent != 0 &&\n\t\t\t\ttasks.getItem(parent).type === \"split\" &&\n\t\t\t\t!tasks.find(k => k.parent == parent, true)\n\t\t\t) {\n\t\t\t\treturn this.updateTask(parent, { type: \"task\" }).then(() => {\n\t\t\t\t\treturn this.completeRemoval(res, parent);\n\t\t\t\t});\n\t\t\t} else return this.completeRemoval(res, parent);\n\t\t});\n\t}\n\t/**\n\t * Synchronizes project and updates critical path after a task is removed\n\t * @param {Object} res - server response\n\t * @param {(string|number)} parent - the ID of a parent task\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tcompleteRemoval(res, parent) {\n\t\treturn this.syncProject(parent).then(() => {\n\t\t\tif (this._state.criticalPath) this._local.showCriticalPath();\n\t\t\treturn res;\n\t\t});\n\t}\n\t/**\n\t * Adds a link\n\t * @param {object} obj - object with link fields\n\t * @returns {promise} promise that resolves with link object\n\t */\n\taddLink(obj) {\n\t\tif (!this.linkExists(obj)) {\n\t\t\treturn this._back.addLink(obj).then(added => {\n\t\t\t\tobj.id = added.id;\n\t\t\t\tthis._local.links().add(obj);\n\t\t\t\treturn obj;\n\t\t\t});\n\t\t}\n\t\treturn webix.promise.reject();\n\t}\n\n\t/**\n\t * Checks if two tasks are already connected by a link of the same type\n\t * @param {Object} obj - the data object of a link\n\t * @returns {Object, null} - the data object of the link that was found; null if nothing was found\n\t */\n\tlinkExists(obj) {\n\t\treturn this._local.links().find(l => {\n\t\t\treturn (\n\t\t\t\tl.target == obj.target && l.source == obj.source && l.type == obj.type\n\t\t\t);\n\t\t}, true);\n\t}\n\n\t/**\n\t * Updates a link\n\t * @param {string, number} id - link id\n\t * @param {object} obj - object with link fields\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tupdateLink(id, obj) {\n\t\treturn this._back.updateLink(id, obj).then(res => {\n\t\t\tconst links = this._local.links();\n\t\t\tconst duplicate = this.linkExists({ ...links.getItem(id), ...obj });\n\t\t\tlinks.updateItem(id, obj);\n\t\t\tif (duplicate) {\n\t\t\t\treturn this.removeLink(duplicate.id).then(() => res);\n\t\t\t} else return res;\n\t\t});\n\t}\n\t/**\n\t * Removes link\n\t * @param {string, number} id - link id\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tremoveLink(id) {\n\t\treturn this._back.removeLink(id).then(res => {\n\t\t\tthis._local.links().remove(id);\n\t\t\treturn res;\n\t\t});\n\t}\n\t/**\n\t * Moves the task to a new position within the task tree\n\t * @param {string, number} id - the ID of the task\n\t * @param {string, number} parent - the ID of the parent/branch (0 for root)\n\t * @param {number} index - the position within the target branch or root (starting from 0)\n\t * @returns {Promise} - the promise of data operation\n\t */\n\tmoveTask(id, parent, index) {\n\t\tparent = parent || 0;\n\n\t\tconst tasks = this._local.tasks();\n\t\tconst branch = tasks.data.branch[parent];\n\t\tconst oldParent = tasks.getItem(id).parent;\n\t\tconst oldIndex = tasks.data.getBranchIndex(id);\n\t\tif (\n\t\t\tparent == oldParent &&\n\t\t\t(index === oldIndex || (index === -1 && id === branch[branch.length - 1]))\n\t\t)\n\t\t\treturn webix.promise.reject();\n\n\t\ttasks.move(id, index, null, { parent });\n\n\t\treturn this._back\n\t\t\t.reorderTask(id, {\n\t\t\t\tparent,\n\t\t\t\tmode: index === 0 ? \"first\" : index === -1 ? \"last\" : \"after\",\n\t\t\t\ttarget: tasks.data.branch[parent][index - 1],\n\t\t\t})\n\t\t\t.then(res => {\n\t\t\t\tif (parent !== oldParent) {\n\t\t\t\t\ttasks.updateItem(id, { parent });\n\n\t\t\t\t\treturn webix.promise\n\t\t\t\t\t\t.all([this.syncProject(parent), this.syncProject(oldParent)])\n\t\t\t\t\t\t.then(() => {\n\t\t\t\t\t\t\tif (this._state.criticalPath) this._local.showCriticalPath();\n\t\t\t\t\t\t\treturn res;\n\t\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn res;\n\t\t\t});\n\t}\n\t/**\n\t * Updates a resource assignment\n\t * @param {string, number} id -  an id of a resource assignment\n\t * @param {object} obj - an object with updated fields\n\t * @returns {promise} a promise that is resolved with server response\n\t */\n\tupdateAssignment(id, obj) {\n\t\treturn this._back.updateAssignment(id, obj).then(res => {\n\t\t\tthis._local.assignments().updateItem(id, obj);\n\t\t\treturn res;\n\t\t});\n\t}\n\t/**\n\t * Assigns a resource assignment to a task\n\t * @param {object} obj - an object with \"task\", \"resource\" and \"value\" fields\n\t * @returns {promise} a promise that is resolved with an object of a resource assignment\n\t */\n\taddAssignment(obj) {\n\t\treturn this._back.addAssignment(obj).then(added => {\n\t\t\tobj.id = added.id;\n\t\t\tthis._local.assignments().add(obj);\n\t\t\treturn obj;\n\t\t});\n\t}\n\t/**\n\t * Removes a resource assignment\n\t * @param {string, number} id - an id of a resource assignment\n\t * @returns {promise} promise that resolves with server response\n\t */\n\tremoveAssignment(id) {\n\t\treturn this._back.removeAssignment(id).then(res => {\n\t\t\tthis._local.assignments().remove(id);\n\t\t\treturn res;\n\t\t});\n\t}\n\n\t/**\n\t * Sorts resources\n\t * @param {object} a - a resource to compare\n\t * @param {object} b - a resource to compare\n\t * @returns {number}\n\t */\n\tsortResources(a, b) {\n\t\tif (a.category == b.category) return a.name > b.name ? 1 : -1;\n\t\treturn a.category > b.category ? 1 : -1;\n\t}\n\n\t/**\n\t * Removes all assignments (if any) from a task\n\t * @param {object} task - task object\n\t * @returns {Promise}\n\t */\n\tremoveAssignments(task) {\n\t\tif (this.app.config.resources) {\n\t\t\tconst collection = this._local.assignments();\n\t\t\tlet waitArr = [];\n\t\t\treturn collection.waitData.then(() => {\n\t\t\t\tcollection.data.each(item => {\n\t\t\t\t\tif (item.task == task.id)\n\t\t\t\t\t\twaitArr.push(this.removeAssignment(item.id));\n\t\t\t\t});\n\t\t\t\tif (waitArr.length) return webix.promise.all(waitArr);\n\t\t\t\treturn webix.promise.resolve(false);\n\t\t\t});\n\t\t}\n\t\treturn webix.promise.resolve(false);\n\t}\n\n\t/**\n\t * Cleans task data from all $-fields, they are functional and locally used and should not be sent to backend\n\t * */\n\tcleanData(obj) {\n\t\tconst res = {};\n\t\tfor (let key in obj) {\n\t\t\tif (key.indexOf(\"$\") !== 0) res[key] = obj[key];\n\t\t}\n\t\treturn res;\n\t}\n\n\tupdateAssignedTaskDates(task) {\n\t\tconst obj = webix.copy(task);\n\t\tthis.updateTaskDuration(obj);\n\t\tconst updateDates = !(\n\t\t\twebix.Date.equal(task.start_date, obj.start_date) &&\n\t\t\twebix.Date.equal(task.end_date, obj.end_date)\n\t\t);\n\t\tif (updateDates) this.updateTask(task.id, obj, null, true);\n\t}\n}\n","function toInteger(dirtyNumber) {\n  if (dirtyNumber === null || dirtyNumber === true || dirtyNumber === false) {\n    return NaN;\n  }\n\n  var number = Number(dirtyNumber);\n\n  if (isNaN(number)) {\n    return number;\n  }\n\n  return number < 0 ? Math.ceil(number) : Math.floor(number);\n}\n\nfunction requiredArgs(required, args) {\n  if (args.length < required) {\n    throw new TypeError(required + ' argument' + (required > 1 ? 's' : '') + ' required, but only ' + args.length + ' present');\n  }\n}\n\n/**\n * @name toDate\n * @category Common Helpers\n * @summary Convert the given argument to an instance of Date.\n *\n * @description\n * Convert the given argument to an instance of Date.\n *\n * If the argument is an instance of Date, the function returns its clone.\n *\n * If the argument is a number, it is treated as a timestamp.\n *\n * If the argument is none of the above, the function returns Invalid Date.\n *\n * **Note**: *all* Date arguments passed to any *date-fns* function is processed by `toDate`.\n *\n * @param {Date|Number} argument - the value to convert\n * @returns {Date} the parsed date in the local time zone\n * @throws {TypeError} 1 argument required\n *\n * @example\n * // Clone the date:\n * const result = toDate(new Date(2014, 1, 11, 11, 30, 30))\n * //=> Tue Feb 11 2014 11:30:30\n *\n * @example\n * // Convert the timestamp to date:\n * const result = toDate(1392098430000)\n * //=> Tue Feb 11 2014 11:30:30\n */\n\nfunction toDate(argument) {\n  requiredArgs(1, arguments);\n  var argStr = Object.prototype.toString.call(argument); // Clone the date\n\n  if (argument instanceof Date || typeof argument === 'object' && argStr === '[object Date]') {\n    // Prevent the date to lose the milliseconds when passed to new Date() in IE10\n    return new Date(argument.getTime());\n  } else if (typeof argument === 'number' || argStr === '[object Number]') {\n    return new Date(argument);\n  } else {\n    if ((typeof argument === 'string' || argStr === '[object String]') && typeof console !== 'undefined') {\n      // eslint-disable-next-line no-console\n      console.warn(\"Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule\"); // eslint-disable-next-line no-console\n\n      console.warn(new Error().stack);\n    }\n\n    return new Date(NaN);\n  }\n}\n\n/**\n * @name addDays\n * @category Day Helpers\n * @summary Add the specified number of days to the given date.\n *\n * @description\n * Add the specified number of days to the given date.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the date to be changed\n * @param {Number} amount - the amount of days to be added. Positive decimals will be rounded using `Math.floor`, decimals less than zero will be rounded using `Math.ceil`.\n * @returns {Date} - the new date with the days added\n * @throws {TypeError} - 2 arguments required\n *\n * @example\n * // Add 10 days to 1 September 2014:\n * const result = addDays(new Date(2014, 8, 1), 10)\n * //=> Thu Sep 11 2014 00:00:00\n */\n\nfunction addDays(dirtyDate, dirtyAmount) {\n  requiredArgs(2, arguments);\n  var date = toDate(dirtyDate);\n  var amount = toInteger(dirtyAmount);\n\n  if (isNaN(amount)) {\n    return new Date(NaN);\n  }\n\n  if (!amount) {\n    // If 0 days, no-op to avoid changing times in the hour before end of DST\n    return date;\n  }\n\n  date.setDate(date.getDate() + amount);\n  return date;\n}\n\n/**\n * @name addMonths\n * @category Month Helpers\n * @summary Add the specified number of months to the given date.\n *\n * @description\n * Add the specified number of months to the given date.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the date to be changed\n * @param {Number} amount - the amount of months to be added. Positive decimals will be rounded using `Math.floor`, decimals less than zero will be rounded using `Math.ceil`.\n * @returns {Date} the new date with the months added\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // Add 5 months to 1 September 2014:\n * const result = addMonths(new Date(2014, 8, 1), 5)\n * //=> Sun Feb 01 2015 00:00:00\n */\n\nfunction addMonths(dirtyDate, dirtyAmount) {\n  requiredArgs(2, arguments);\n  var date = toDate(dirtyDate);\n  var amount = toInteger(dirtyAmount);\n\n  if (isNaN(amount)) {\n    return new Date(NaN);\n  }\n\n  if (!amount) {\n    // If 0 months, no-op to avoid changing times in the hour before end of DST\n    return date;\n  }\n\n  var dayOfMonth = date.getDate(); // The JS Date object supports date math by accepting out-of-bounds values for\n  // month, day, etc. For example, new Date(2020, 0, 0) returns 31 Dec 2019 and\n  // new Date(2020, 13, 1) returns 1 Feb 2021.  This is *almost* the behavior we\n  // want except that dates will wrap around the end of a month, meaning that\n  // new Date(2020, 13, 31) will return 3 Mar 2021 not 28 Feb 2021 as desired. So\n  // we'll default to the end of the desired month by adding 1 to the desired\n  // month and using a date of 0 to back up one day to the end of the desired\n  // month.\n\n  var endOfDesiredMonth = new Date(date.getTime());\n  endOfDesiredMonth.setMonth(date.getMonth() + amount + 1, 0);\n  var daysInMonth = endOfDesiredMonth.getDate();\n\n  if (dayOfMonth >= daysInMonth) {\n    // If we're already at the end of the month, then this is the correct date\n    // and we're done.\n    return endOfDesiredMonth;\n  } else {\n    // Otherwise, we now know that setting the original day-of-month value won't\n    // cause an overflow, so set the desired day-of-month. Note that we can't\n    // just set the date of `endOfDesiredMonth` because that object may have had\n    // its time changed in the unusual case where where a DST transition was on\n    // the last day of the month and its local time was in the hour skipped or\n    // repeated next to a DST transition.  So we use `date` instead which is\n    // guaranteed to still have the original time.\n    date.setFullYear(endOfDesiredMonth.getFullYear(), endOfDesiredMonth.getMonth(), dayOfMonth);\n    return date;\n  }\n}\n\n/**\n * @name addMilliseconds\n * @category Millisecond Helpers\n * @summary Add the specified number of milliseconds to the given date.\n *\n * @description\n * Add the specified number of milliseconds to the given date.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the date to be changed\n * @param {Number} amount - the amount of milliseconds to be added. Positive decimals will be rounded using `Math.floor`, decimals less than zero will be rounded using `Math.ceil`.\n * @returns {Date} the new date with the milliseconds added\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // Add 750 milliseconds to 10 July 2014 12:45:30.000:\n * const result = addMilliseconds(new Date(2014, 6, 10, 12, 45, 30, 0), 750)\n * //=> Thu Jul 10 2014 12:45:30.750\n */\n\nfunction addMilliseconds(dirtyDate, dirtyAmount) {\n  requiredArgs(2, arguments);\n  var timestamp = toDate(dirtyDate).getTime();\n  var amount = toInteger(dirtyAmount);\n  return new Date(timestamp + amount);\n}\n\nvar MILLISECONDS_IN_HOUR = 3600000;\n/**\n * @name addHours\n * @category Hour Helpers\n * @summary Add the specified number of hours to the given date.\n *\n * @description\n * Add the specified number of hours to the given date.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the date to be changed\n * @param {Number} amount - the amount of hours to be added. Positive decimals will be rounded using `Math.floor`, decimals less than zero will be rounded using `Math.ceil`.\n * @returns {Date} the new date with the hours added\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // Add 2 hours to 10 July 2014 23:00:00:\n * const result = addHours(new Date(2014, 6, 10, 23, 0), 2)\n * //=> Fri Jul 11 2014 01:00:00\n */\n\nfunction addHours(dirtyDate, dirtyAmount) {\n  requiredArgs(2, arguments);\n  var amount = toInteger(dirtyAmount);\n  return addMilliseconds(dirtyDate, amount * MILLISECONDS_IN_HOUR);\n}\n\n/**\n * @name startOfWeek\n * @category Week Helpers\n * @summary Return the start of a week for the given date.\n *\n * @description\n * Return the start of a week for the given date.\n * The result will be in the local timezone.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the original date\n * @param {Object} [options] - an object with options.\n * @param {Locale} [options.locale=defaultLocale] - the locale object. See [Locale]{@link https://date-fns.org/docs/Locale}\n * @param {0|1|2|3|4|5|6} [options.weekStartsOn=0] - the index of the first day of the week (0 - Sunday)\n * @returns {Date} the start of a week\n * @throws {TypeError} 1 argument required\n * @throws {RangeError} `options.weekStartsOn` must be between 0 and 6\n *\n * @example\n * // The start of a week for 2 September 2014 11:55:00:\n * const result = startOfWeek(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Sun Aug 31 2014 00:00:00\n *\n * @example\n * // If the week starts on Monday, the start of the week for 2 September 2014 11:55:00:\n * const result = startOfWeek(new Date(2014, 8, 2, 11, 55, 0), { weekStartsOn: 1 })\n * //=> Mon Sep 01 2014 00:00:00\n */\n\nfunction startOfWeek(dirtyDate, dirtyOptions) {\n  requiredArgs(1, arguments);\n  var options = dirtyOptions || {};\n  var locale = options.locale;\n  var localeWeekStartsOn = locale && locale.options && locale.options.weekStartsOn;\n  var defaultWeekStartsOn = localeWeekStartsOn == null ? 0 : toInteger(localeWeekStartsOn);\n  var weekStartsOn = options.weekStartsOn == null ? defaultWeekStartsOn : toInteger(options.weekStartsOn); // Test if weekStartsOn is between 0 and 6 _and_ is not NaN\n\n  if (!(weekStartsOn >= 0 && weekStartsOn <= 6)) {\n    throw new RangeError('weekStartsOn must be between 0 and 6 inclusively');\n  }\n\n  var date = toDate(dirtyDate);\n  var day = date.getDay();\n  var diff = (day < weekStartsOn ? 7 : 0) + day - weekStartsOn;\n  date.setDate(date.getDate() - diff);\n  date.setHours(0, 0, 0, 0);\n  return date;\n}\n\n/**\n * Google Chrome as of 67.0.3396.87 introduced timezones with offset that includes seconds.\n * They usually appear for dates that denote time before the timezones were introduced\n * (e.g. for 'Europe/Prague' timezone the offset is GMT+00:57:44 before 1 October 1891\n * and GMT+01:00:00 after that date)\n *\n * Date#getTimezoneOffset returns the offset in minutes and would return 57 for the example above,\n * which would lead to incorrect calculations.\n *\n * This function returns the timezone offset in milliseconds that takes seconds in account.\n */\nfunction getTimezoneOffsetInMilliseconds(date) {\n  var utcDate = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate(), date.getHours(), date.getMinutes(), date.getSeconds(), date.getMilliseconds()));\n  utcDate.setUTCFullYear(date.getFullYear());\n  return date.getTime() - utcDate.getTime();\n}\n\n/**\n * @name startOfDay\n * @category Day Helpers\n * @summary Return the start of a day for the given date.\n *\n * @description\n * Return the start of a day for the given date.\n * The result will be in the local timezone.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the original date\n * @returns {Date} the start of a day\n * @throws {TypeError} 1 argument required\n *\n * @example\n * // The start of a day for 2 September 2014 11:55:00:\n * const result = startOfDay(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Tue Sep 02 2014 00:00:00\n */\n\nfunction startOfDay(dirtyDate) {\n  requiredArgs(1, arguments);\n  var date = toDate(dirtyDate);\n  date.setHours(0, 0, 0, 0);\n  return date;\n}\n\nvar MILLISECONDS_IN_DAY = 86400000;\n/**\n * @name differenceInCalendarDays\n * @category Day Helpers\n * @summary Get the number of calendar days between the given dates.\n *\n * @description\n * Get the number of calendar days between the given dates. This means that the times are removed\n * from the dates and then the difference in days is calculated.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} dateLeft - the later date\n * @param {Date|Number} dateRight - the earlier date\n * @returns {Number} the number of calendar days\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // How many calendar days are between\n * // 2 July 2011 23:00:00 and 2 July 2012 00:00:00?\n * const result = differenceInCalendarDays(\n *   new Date(2012, 6, 2, 0, 0),\n *   new Date(2011, 6, 2, 23, 0)\n * )\n * //=> 366\n * // How many calendar days are between\n * // 2 July 2011 23:59:00 and 3 July 2011 00:01:00?\n * const result = differenceInCalendarDays(\n *   new Date(2011, 6, 3, 0, 1),\n *   new Date(2011, 6, 2, 23, 59)\n * )\n * //=> 1\n */\n\nfunction differenceInCalendarDays(dirtyDateLeft, dirtyDateRight) {\n  requiredArgs(2, arguments);\n  var startOfDayLeft = startOfDay(dirtyDateLeft);\n  var startOfDayRight = startOfDay(dirtyDateRight);\n  var timestampLeft = startOfDayLeft.getTime() - getTimezoneOffsetInMilliseconds(startOfDayLeft);\n  var timestampRight = startOfDayRight.getTime() - getTimezoneOffsetInMilliseconds(startOfDayRight); // Round the number of days to the nearest integer\n  // because the number of milliseconds in a day is not constant\n  // (e.g. it's different in the day of the daylight saving time clock shift)\n\n  return Math.round((timestampLeft - timestampRight) / MILLISECONDS_IN_DAY);\n}\n\nvar MILLISECONDS_IN_MINUTE = 60000;\n/**\n * @name addMinutes\n * @category Minute Helpers\n * @summary Add the specified number of minutes to the given date.\n *\n * @description\n * Add the specified number of minutes to the given date.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the date to be changed\n * @param {Number} amount - the amount of minutes to be added. Positive decimals will be rounded using `Math.floor`, decimals less than zero will be rounded using `Math.ceil`.\n * @returns {Date} the new date with the minutes added\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // Add 30 minutes to 10 July 2014 12:00:00:\n * const result = addMinutes(new Date(2014, 6, 10, 12, 0), 30)\n * //=> Thu Jul 10 2014 12:30:00\n */\n\nfunction addMinutes(dirtyDate, dirtyAmount) {\n  requiredArgs(2, arguments);\n  var amount = toInteger(dirtyAmount);\n  return addMilliseconds(dirtyDate, amount * MILLISECONDS_IN_MINUTE);\n}\n\n/**\n * @name addQuarters\n * @category Quarter Helpers\n * @summary Add the specified number of year quarters to the given date.\n *\n * @description\n * Add the specified number of year quarters to the given date.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the date to be changed\n * @param {Number} amount - the amount of quarters to be added. Positive decimals will be rounded using `Math.floor`, decimals less than zero will be rounded using `Math.ceil`.\n * @returns {Date} the new date with the quarters added\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // Add 1 quarter to 1 September 2014:\n * const result = addQuarters(new Date(2014, 8, 1), 1)\n * //=> Mon Dec 01 2014 00:00:00\n */\n\nfunction addQuarters(dirtyDate, dirtyAmount) {\n  requiredArgs(2, arguments);\n  var amount = toInteger(dirtyAmount);\n  var months = amount * 3;\n  return addMonths(dirtyDate, months);\n}\n\n/**\n * @name addWeeks\n * @category Week Helpers\n * @summary Add the specified number of weeks to the given date.\n *\n * @description\n * Add the specified number of week to the given date.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the date to be changed\n * @param {Number} amount - the amount of weeks to be added. Positive decimals will be rounded using `Math.floor`, decimals less than zero will be rounded using `Math.ceil`.\n * @returns {Date} the new date with the weeks added\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // Add 4 weeks to 1 September 2014:\n * const result = addWeeks(new Date(2014, 8, 1), 4)\n * //=> Mon Sep 29 2014 00:00:00\n */\n\nfunction addWeeks(dirtyDate, dirtyAmount) {\n  requiredArgs(2, arguments);\n  var amount = toInteger(dirtyAmount);\n  var days = amount * 7;\n  return addDays(dirtyDate, days);\n}\n\n/**\n * @name addYears\n * @category Year Helpers\n * @summary Add the specified number of years to the given date.\n *\n * @description\n * Add the specified number of years to the given date.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the date to be changed\n * @param {Number} amount - the amount of years to be added. Positive decimals will be rounded using `Math.floor`, decimals less than zero will be rounded using `Math.ceil`.\n * @returns {Date} the new date with the years added\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // Add 5 years to 1 September 2014:\n * const result = addYears(new Date(2014, 8, 1), 5)\n * //=> Sun Sep 01 2019 00:00:00\n */\n\nfunction addYears(dirtyDate, dirtyAmount) {\n  requiredArgs(2, arguments);\n  var amount = toInteger(dirtyAmount);\n  return addMonths(dirtyDate, amount * 12);\n}\n\n/**\n * @name compareAsc\n * @category Common Helpers\n * @summary Compare the two dates and return -1, 0 or 1.\n *\n * @description\n * Compare the two dates and return 1 if the first date is after the second,\n * -1 if the first date is before the second or 0 if dates are equal.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} dateLeft - the first date to compare\n * @param {Date|Number} dateRight - the second date to compare\n * @returns {Number} the result of the comparison\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // Compare 11 February 1987 and 10 July 1989:\n * const result = compareAsc(new Date(1987, 1, 11), new Date(1989, 6, 10))\n * //=> -1\n *\n * @example\n * // Sort the array of dates:\n * const result = [\n *   new Date(1995, 6, 2),\n *   new Date(1987, 1, 11),\n *   new Date(1989, 6, 10)\n * ].sort(compareAsc)\n * //=> [\n * //   Wed Feb 11 1987 00:00:00,\n * //   Mon Jul 10 1989 00:00:00,\n * //   Sun Jul 02 1995 00:00:00\n * // ]\n */\n\nfunction compareAsc(dirtyDateLeft, dirtyDateRight) {\n  requiredArgs(2, arguments);\n  var dateLeft = toDate(dirtyDateLeft);\n  var dateRight = toDate(dirtyDateRight);\n  var diff = dateLeft.getTime() - dateRight.getTime();\n\n  if (diff < 0) {\n    return -1;\n  } else if (diff > 0) {\n    return 1; // Return 0 if diff is 0; return NaN if diff is NaN\n  } else {\n    return diff;\n  }\n}\n\n/**\n * Days in 1 week.\n *\n * @name daysInWeek\n * @constant\n * @type {number}\n * @default\n */\n/**\n * Milliseconds in 1 minute\n *\n * @name millisecondsInMinute\n * @constant\n * @type {number}\n * @default\n */\n\nvar millisecondsInMinute = 60000;\n/**\n * Milliseconds in 1 hour\n *\n * @name millisecondsInHour\n * @constant\n * @type {number}\n * @default\n */\n\nvar millisecondsInHour = 3600000;\n\n/**\n * @name differenceInCalendarMonths\n * @category Month Helpers\n * @summary Get the number of calendar months between the given dates.\n *\n * @description\n * Get the number of calendar months between the given dates.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} dateLeft - the later date\n * @param {Date|Number} dateRight - the earlier date\n * @returns {Number} the number of calendar months\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // How many calendar months are between 31 January 2014 and 1 September 2014?\n * var result = differenceInCalendarMonths(\n *   new Date(2014, 8, 1),\n *   new Date(2014, 0, 31)\n * )\n * //=> 8\n */\n\nfunction differenceInCalendarMonths(dirtyDateLeft, dirtyDateRight) {\n  requiredArgs(2, arguments);\n  var dateLeft = toDate(dirtyDateLeft);\n  var dateRight = toDate(dirtyDateRight);\n  var yearDiff = dateLeft.getFullYear() - dateRight.getFullYear();\n  var monthDiff = dateLeft.getMonth() - dateRight.getMonth();\n  return yearDiff * 12 + monthDiff;\n}\n\nvar MILLISECONDS_IN_WEEK = 604800000;\n/**\n * @name differenceInCalendarWeeks\n * @category Week Helpers\n * @summary Get the number of calendar weeks between the given dates.\n *\n * @description\n * Get the number of calendar weeks between the given dates.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} dateLeft - the later date\n * @param {Date|Number} dateRight - the earlier date\n * @param {Object} [options] - an object with options.\n * @param {Locale} [options.locale=defaultLocale] - the locale object. See [Locale]{@link https://date-fns.org/docs/Locale}\n * @param {0|1|2|3|4|5|6} [options.weekStartsOn=0] - the index of the first day of the week (0 - Sunday)\n * @returns {Number} the number of calendar weeks\n * @throws {TypeError} 2 arguments required\n * @throws {RangeError} `options.weekStartsOn` must be between 0 and 6\n *\n * @example\n * // How many calendar weeks are between 5 July 2014 and 20 July 2014?\n * const result = differenceInCalendarWeeks(\n *   new Date(2014, 6, 20),\n *   new Date(2014, 6, 5)\n * )\n * //=> 3\n *\n * @example\n * // If the week starts on Monday,\n * // how many calendar weeks are between 5 July 2014 and 20 July 2014?\n * const result = differenceInCalendarWeeks(\n *   new Date(2014, 6, 20),\n *   new Date(2014, 6, 5),\n *   { weekStartsOn: 1 }\n * )\n * //=> 2\n */\n\nfunction differenceInCalendarWeeks(dirtyDateLeft, dirtyDateRight, dirtyOptions) {\n  requiredArgs(2, arguments);\n  var startOfWeekLeft = startOfWeek(dirtyDateLeft, dirtyOptions);\n  var startOfWeekRight = startOfWeek(dirtyDateRight, dirtyOptions);\n  var timestampLeft = startOfWeekLeft.getTime() - getTimezoneOffsetInMilliseconds(startOfWeekLeft);\n  var timestampRight = startOfWeekRight.getTime() - getTimezoneOffsetInMilliseconds(startOfWeekRight); // Round the number of days to the nearest integer\n  // because the number of milliseconds in a week is not constant\n  // (e.g. it's different in the week of the daylight saving time clock shift)\n\n  return Math.round((timestampLeft - timestampRight) / MILLISECONDS_IN_WEEK);\n}\n\n/**\n * @name differenceInCalendarYears\n * @category Year Helpers\n * @summary Get the number of calendar years between the given dates.\n *\n * @description\n * Get the number of calendar years between the given dates.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} dateLeft - the later date\n * @param {Date|Number} dateRight - the earlier date\n * @returns {Number} the number of calendar years\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // How many calendar years are between 31 December 2013 and 11 February 2015?\n * const result = differenceInCalendarYears(\n *   new Date(2015, 1, 11),\n *   new Date(2013, 11, 31)\n * )\n * //=> 2\n */\n\nfunction differenceInCalendarYears(dirtyDateLeft, dirtyDateRight) {\n  requiredArgs(2, arguments);\n  var dateLeft = toDate(dirtyDateLeft);\n  var dateRight = toDate(dirtyDateRight);\n  return dateLeft.getFullYear() - dateRight.getFullYear();\n}\n\n/**\n * @name differenceInMilliseconds\n * @category Millisecond Helpers\n * @summary Get the number of milliseconds between the given dates.\n *\n * @description\n * Get the number of milliseconds between the given dates.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} dateLeft - the later date\n * @param {Date|Number} dateRight - the earlier date\n * @returns {Number} the number of milliseconds\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // How many milliseconds are between\n * // 2 July 2014 12:30:20.600 and 2 July 2014 12:30:21.700?\n * const result = differenceInMilliseconds(\n *   new Date(2014, 6, 2, 12, 30, 21, 700),\n *   new Date(2014, 6, 2, 12, 30, 20, 600)\n * )\n * //=> 1100\n */\n\nfunction differenceInMilliseconds(dateLeft, dateRight) {\n  requiredArgs(2, arguments);\n  return toDate(dateLeft).getTime() - toDate(dateRight).getTime();\n}\n\nvar roundingMap = {\n  ceil: Math.ceil,\n  round: Math.round,\n  floor: Math.floor,\n  trunc: function (value) {\n    return value < 0 ? Math.ceil(value) : Math.floor(value);\n  } // Math.trunc is not supported by IE\n\n};\nvar defaultRoundingMethod = 'trunc';\nfunction getRoundingMethod(method) {\n  return method ? roundingMap[method] : roundingMap[defaultRoundingMethod];\n}\n\n/**\n * @name differenceInHours\n * @category Hour Helpers\n * @summary Get the number of hours between the given dates.\n *\n * @description\n * Get the number of hours between the given dates.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} dateLeft - the later date\n * @param {Date|Number} dateRight - the earlier date\n * @param {Object} [options] - an object with options.\n * @param {String} [options.roundingMethod='trunc'] - a rounding method (`ceil`, `floor`, `round` or `trunc`)\n * @returns {Number} the number of hours\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // How many hours are between 2 July 2014 06:50:00 and 2 July 2014 19:00:00?\n * const result = differenceInHours(\n *   new Date(2014, 6, 2, 19, 0),\n *   new Date(2014, 6, 2, 6, 50)\n * )\n * //=> 12\n */\n\nfunction differenceInHours(dateLeft, dateRight, options) {\n  requiredArgs(2, arguments);\n  var diff = differenceInMilliseconds(dateLeft, dateRight) / millisecondsInHour;\n  return getRoundingMethod(options === null || options === void 0 ? void 0 : options.roundingMethod)(diff);\n}\n\n/**\n * @name differenceInMinutes\n * @category Minute Helpers\n * @summary Get the number of minutes between the given dates.\n *\n * @description\n * Get the signed number of full (rounded towards 0) minutes between the given dates.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} dateLeft - the later date\n * @param {Date|Number} dateRight - the earlier date\n * @param {Object} [options] - an object with options.\n * @param {String} [options.roundingMethod='trunc'] - a rounding method (`ceil`, `floor`, `round` or `trunc`)\n * @returns {Number} the number of minutes\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // How many minutes are between 2 July 2014 12:07:59 and 2 July 2014 12:20:00?\n * const result = differenceInMinutes(\n *   new Date(2014, 6, 2, 12, 20, 0),\n *   new Date(2014, 6, 2, 12, 7, 59)\n * )\n * //=> 12\n *\n * @example\n * // How many minutes are between 10:01:59 and 10:00:00\n * const result = differenceInMinutes(\n *   new Date(2000, 0, 1, 10, 0, 0),\n *   new Date(2000, 0, 1, 10, 1, 59)\n * )\n * //=> -1\n */\n\nfunction differenceInMinutes(dateLeft, dateRight, options) {\n  requiredArgs(2, arguments);\n  var diff = differenceInMilliseconds(dateLeft, dateRight) / millisecondsInMinute;\n  return getRoundingMethod(options === null || options === void 0 ? void 0 : options.roundingMethod)(diff);\n}\n\n/**\n * @name endOfDay\n * @category Day Helpers\n * @summary Return the end of a day for the given date.\n *\n * @description\n * Return the end of a day for the given date.\n * The result will be in the local timezone.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the original date\n * @returns {Date} the end of a day\n * @throws {TypeError} 1 argument required\n *\n * @example\n * // The end of a day for 2 September 2014 11:55:00:\n * const result = endOfDay(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Tue Sep 02 2014 23:59:59.999\n */\n\nfunction endOfDay(dirtyDate) {\n  requiredArgs(1, arguments);\n  var date = toDate(dirtyDate);\n  date.setHours(23, 59, 59, 999);\n  return date;\n}\n\n/**\n * @name endOfMonth\n * @category Month Helpers\n * @summary Return the end of a month for the given date.\n *\n * @description\n * Return the end of a month for the given date.\n * The result will be in the local timezone.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the original date\n * @returns {Date} the end of a month\n * @throws {TypeError} 1 argument required\n *\n * @example\n * // The end of a month for 2 September 2014 11:55:00:\n * const result = endOfMonth(new Date(2014, 8, 2, 11, 55, 0))\n * //=> Tue Sep 30 2014 23:59:59.999\n */\n\nfunction endOfMonth(dirtyDate) {\n  requiredArgs(1, arguments);\n  var date = toDate(dirtyDate);\n  var month = date.getMonth();\n  date.setFullYear(date.getFullYear(), month + 1, 0);\n  date.setHours(23, 59, 59, 999);\n  return date;\n}\n\n/**\n * @name isLastDayOfMonth\n * @category Month Helpers\n * @summary Is the given date the last day of a month?\n *\n * @description\n * Is the given date the last day of a month?\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} date - the date to check\n * @returns {Boolean} the date is the last day of a month\n * @throws {TypeError} 1 argument required\n *\n * @example\n * // Is 28 February 2014 the last day of a month?\n * var result = isLastDayOfMonth(new Date(2014, 1, 28))\n * //=> true\n */\n\nfunction isLastDayOfMonth(dirtyDate) {\n  requiredArgs(1, arguments);\n  var date = toDate(dirtyDate);\n  return endOfDay(date).getTime() === endOfMonth(date).getTime();\n}\n\n/**\n * @name differenceInMonths\n * @category Month Helpers\n * @summary Get the number of full months between the given dates.\n *\n * @description\n * Get the number of full months between the given dates using trunc as a default rounding method.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} dateLeft - the later date\n * @param {Date|Number} dateRight - the earlier date\n * @returns {Number} the number of full months\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // How many full months are between 31 January 2014 and 1 September 2014?\n * const result = differenceInMonths(new Date(2014, 8, 1), new Date(2014, 0, 31))\n * //=> 7\n */\n\nfunction differenceInMonths(dirtyDateLeft, dirtyDateRight) {\n  requiredArgs(2, arguments);\n  var dateLeft = toDate(dirtyDateLeft);\n  var dateRight = toDate(dirtyDateRight);\n  var sign = compareAsc(dateLeft, dateRight);\n  var difference = Math.abs(differenceInCalendarMonths(dateLeft, dateRight));\n  var result; // Check for the difference of less than month\n\n  if (difference < 1) {\n    result = 0;\n  } else {\n    if (dateLeft.getMonth() === 1 && dateLeft.getDate() > 27) {\n      // This will check if the date is end of Feb and assign a higher end of month date\n      // to compare it with Jan\n      dateLeft.setDate(30);\n    }\n\n    dateLeft.setMonth(dateLeft.getMonth() - sign * difference); // Math.abs(diff in full months - diff in calendar months) === 1 if last calendar month is not full\n    // If so, result must be decreased by 1 in absolute value\n\n    var isLastMonthNotFull = compareAsc(dateLeft, dateRight) === -sign; // Check for cases of one full calendar month\n\n    if (isLastDayOfMonth(toDate(dirtyDateLeft)) && difference === 1 && compareAsc(dirtyDateLeft, dateRight) === 1) {\n      isLastMonthNotFull = false;\n    }\n\n    result = sign * (difference - Number(isLastMonthNotFull));\n  } // Prevent negative zero\n\n\n  return result === 0 ? 0 : result;\n}\n\n/**\n * @name differenceInQuarters\n * @category Quarter Helpers\n * @summary Get the number of quarters between the given dates.\n *\n * @description\n * Get the number of quarters between the given dates.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} dateLeft - the later date\n * @param {Date|Number} dateRight - the earlier date\n * @param {Object} [options] - an object with options.\n * @param {String} [options.roundingMethod='trunc'] - a rounding method (`ceil`, `floor`, `round` or `trunc`)\n * @returns {Number} the number of full quarters\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // How many full quarters are between 31 December 2013 and 2 July 2014?\n * const result = differenceInQuarters(new Date(2014, 6, 2), new Date(2013, 11, 31))\n * //=> 2\n */\n\nfunction differenceInQuarters(dateLeft, dateRight, options) {\n  requiredArgs(2, arguments);\n  var diff = differenceInMonths(dateLeft, dateRight) / 3;\n  return getRoundingMethod(options === null || options === void 0 ? void 0 : options.roundingMethod)(diff);\n}\n\n/**\n * @name differenceInYears\n * @category Year Helpers\n * @summary Get the number of full years between the given dates.\n *\n * @description\n * Get the number of full years between the given dates.\n *\n * ### v2.0.0 breaking changes:\n *\n * - [Changes that are common for the whole library](https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#Common-Changes).\n *\n * @param {Date|Number} dateLeft - the later date\n * @param {Date|Number} dateRight - the earlier date\n * @returns {Number} the number of full years\n * @throws {TypeError} 2 arguments required\n *\n * @example\n * // How many full years are between 31 December 2013 and 11 February 2015?\n * const result = differenceInYears(new Date(2015, 1, 11), new Date(2013, 11, 31))\n * //=> 1\n */\n\nfunction differenceInYears(dirtyDateLeft, dirtyDateRight) {\n  requiredArgs(2, arguments);\n  var dateLeft = toDate(dirtyDateLeft);\n  var dateRight = toDate(dirtyDateRight);\n  var sign = compareAsc(dateLeft, dateRight);\n  var difference = Math.abs(differenceInCalendarYears(dateLeft, dateRight)); // Set both dates to a valid leap year for accurate comparison when dealing\n  // with leap days\n\n  dateLeft.setFullYear(1584);\n  dateRight.setFullYear(1584); // Math.abs(diff in full years - diff in calendar years) === 1 if last calendar year is not full\n  // If so, result must be decreased by 1 in absolute value\n\n  var isLastYearNotFull = compareAsc(dateLeft, dateRight) === -sign;\n  var result = sign * (difference - Number(isLastYearNotFull)); // Prevent negative zero\n\n  return result === 0 ? 0 : result;\n}\n\nfunction getDatePart(date, copy) {\n    if (copy)\n        date = new Date(date.valueOf());\n    // workaround for non-existent hours\n    const d = new Date(date.valueOf());\n    d.setHours(0);\n    if (d.getDate() != date.getDate()) {\n        date.setHours(1);\n    }\n    else {\n        date.setHours(0);\n    }\n    date.setMinutes(0);\n    date.setSeconds(0);\n    date.setMilliseconds(0);\n    return date;\n}\nfunction getTimePart(date, copy) {\n    if (copy)\n        date = new Date(date.valueOf());\n    return (date.valueOf() / 1000 - date.getTimezoneOffset() * 60) % 86400;\n}\nfunction differenceInWeeks(a, b, startOnMonday) {\n    const weekStartsOn = startOnMonday ? 1 : 0;\n    return differenceInCalendarWeeks(a, b, { weekStartsOn });\n}\nfunction getDay(date, startOnMonday) {\n    let shift = date.getDay();\n    if (startOnMonday) {\n        if (shift === 0)\n            shift = 6;\n        else\n            shift--;\n    }\n    return shift;\n}\n\nconst diff = {\n    year: differenceInYears,\n    quarter: differenceInQuarters,\n    month: differenceInMonths,\n    week: differenceInWeeks,\n    day: differenceInCalendarDays,\n    hour: differenceInHours,\n    minute: differenceInMinutes,\n};\nfunction countDaysInMonth(date) {\n    if (!date)\n        return 30;\n    const m = date.getMonth();\n    if (m === 1) {\n        const y = date.getFullYear();\n        if (y % 4)\n            return 28;\n        if (y % 100)\n            return 29;\n        if (y % 400)\n            return 28;\n        return 29;\n    }\n    if ((m % 2 && m < 7) || (!(m % 2) && m > 7)) {\n        return 30;\n    }\n    return 31;\n}\nconst smallerCount = {\n    year: [\"quarter\", 4],\n    quarter: [\"month\", 3],\n    month: [\"day\", countDaysInMonth],\n    week: [\"day\", 7],\n    day: [\"hour\", 24],\n    hour: [\"minute\", 60],\n    minute: [\"minute\", 1],\n};\nconst add = {\n    year: addYears,\n    quarter: addQuarters,\n    month: addMonths,\n    week: addWeeks,\n    day: addDays,\n    hour: addHours,\n    minute: addMinutes,\n};\n/**\n * Calculates the difference between two dates in units\n * @param {string} unit - the minimal unit of the current scale (\"hour\"-\"year\")\n * @param {Date} next - a later date\n * @param {Date} prev - an earlier date\n * @param {boolean} startOnMonday - true if week starts on Monday, false otherwise\n * @param {boolean} precise - current precision setting of the scales (if true, diff will be counted for smallerCount)\n * @param {boolean} wt - shows that diff will be counted for the width of a task\n * @returns {number} - an int (if precise is false) or a float number\n */\nfunction innerDiff(unit, next, prev, startOnMonday, precise, wt) {\n    let minUnit = unit;\n    if (precise) {\n        const u = smallerCount[unit][0];\n        if (typeof u !== \"number\" && typeof u !== \"function\")\n            minUnit = u;\n    }\n    let start = prev;\n    let end = next;\n    if (wt) {\n        start = getUnitStart(minUnit, start, startOnMonday);\n        end = getUnitStart(minUnit, end, startOnMonday);\n        if (end < next)\n            end = addUnit(minUnit)(end, 1);\n    }\n    if (precise) {\n        const filled = diff[minUnit](end, start);\n        const count = smallerCount[unit][1];\n        let all = 0;\n        if (typeof count === \"function\")\n            all = count(prev);\n        else if (typeof count === \"number\")\n            all = count;\n        return filled / all;\n    }\n    else {\n        return diff[minUnit](end, start, startOnMonday);\n    }\n}\n/**\n * Returns a function for calculating the difference between two dates in units\n * @param {string} unit - the minimal unit of the current scale (\"hour\"-\"year\")\n * @returns {function} - details below\n */\nfunction getDiff(unit) {\n    /**\n     * the returned function calculates the difference between two dates based on passed parameters\n     * @param {Date} next - first date\n     * @param {Date} prev - second date\n     * @param {boolean} startOnMonday - true if week starts on Monday, false otherwise\n     * @param {boolean} precise false by default, true when used to count x-position\n     * and width of tasks with 'step-1' precision\n     * @param {boolean} wt - marker that diff is used to count width of a task;\n     * if diff returns 0, you have to add 1; otherwise tasks that are within 1 unit will have 0 width\n     * and will be displayed incorrectly\n     * @returns {number} - the difference between two dates in 'units'; if 'precise' is true, the number is float, otherwise int\n     */\n    return (next, prev, startOnMonday, precise, wt) => {\n        if (unit === \"month\" && precise) {\n            return getMonthDayDiff(next, prev, wt);\n        }\n        else {\n            return innerDiff(unit, next, prev, startOnMonday, precise, wt);\n        }\n    };\n}\n/**\n * Calculates the difference in months between two days for a scale with precision setting\n * This is a specific case of diff counting, because a month can have 28-31 days\n * @param {Date} end - a later date\n * @param {Date} start - an earlier date\n * @param {Boolean} wt - shows that diff will be counted for the width of a task\n * @returns {number} - a float number\n */\nfunction getMonthDayDiff(end, start, wt) {\n    if (sameMonth(start, end)) {\n        return innerDiff(\"month\", end, start, null, true, wt);\n    }\n    // if starts not on 1st day\n    let daysOfFirstMonth = 0;\n    if (start.getDate() > 1) {\n        const me = new Date(start.getFullYear(), start.getMonth() + 1, 1);\n        daysOfFirstMonth = innerDiff(\"month\", me, start, null, true);\n        start = me;\n    }\n    // if lasts 1+ whole months\n    let months = 0;\n    if (!sameMonth(start, end)) {\n        months = innerDiff(\"month\", getUnitStart(\"month\", end), start); // int part\n        start = addUnit(\"month\")(start, months);\n    }\n    // all above plus days of last month if any\n    return daysOfFirstMonth + months + innerDiff(\"month\", end, start, null, true);\n}\nfunction sameMonth(a, b) {\n    return (getUnitStart(\"month\", a).valueOf() === getUnitStart(\"month\", b).valueOf());\n}\nfunction addUnit(unit) {\n    return add[unit];\n}\nfunction getUnitStart(unit, start, startOnMonday) {\n    let t;\n    switch (unit) {\n        case \"year\":\n            return new Date(start.getFullYear(), 0, 1);\n        case \"quarter\":\n            return new Date(start.getFullYear(), Math.floor(start.getMonth() / 3) * 3, 1);\n        case \"month\":\n            return new Date(start.getFullYear(), start.getMonth(), 1);\n        case \"week\":\n            t = new Date(start.getFullYear(), start.getMonth(), start.getDate());\n            t.setDate(start.getDate() - getDay(start, startOnMonday));\n            return t;\n        case \"day\":\n            t = new Date(start.getFullYear(), start.getMonth(), start.getDate());\n            t.setHours(0, 0, 0, 0);\n            return t;\n        case \"hour\":\n            t = new Date(start.getFullYear(), start.getMonth(), start.getDate());\n            t.setHours(start.getHours(), 0, 0, 0);\n            return t;\n        default:\n            return new Date(start);\n    }\n}\n\nfunction getMinUnit(scales) {\n    const start = new Date();\n    return scales\n        .map(item => ({ item, len: addUnit(item.unit)(start, 1) }))\n        .sort((a, b) => (a.len < b.len ? -1 : 1))[0].item.unit;\n}\n/**\n * Resets scales to new parameters and returns the object that stores related constants and functions\n * @param {Date} start - start date\n * @param {Date} end - end date\n * @param {boolean} precise - flag that defines whether to round task position and width to a smaller unit\n * @param {number} width - width of smallest cell unit\n * @param {number} height - height of scale cell\n * @param {Array} scales - a set of scales (objects)\n * @param {function} isHoliday - the function that checks if a day is a holiday\n * @param {boolean} startOnMonday - flag that defines whether the week starts on Monday\n * @returns {Object} scales\n */\nfunction resetScales(start, end, precise, width, height, scales, isHoliday, startOnMonday) {\n    // console.log(\"[x] reset scales\");\n    const minUnit = getMinUnit(scales);\n    const diff = getDiff(minUnit);\n    const tempEnd = getUnitStart(minUnit, end, startOnMonday);\n    start = getUnitStart(minUnit, start, startOnMonday);\n    end = tempEnd < end ? addUnit(minUnit)(tempEnd, 1) : tempEnd;\n    const fullWidth = diff(end, start, startOnMonday) * width;\n    const fullHeight = height * scales.length;\n    const rows = scales.map(line => {\n        const cells = [];\n        const add = addUnit(line.unit);\n        const step = line.step || 1;\n        const countInWeeks = minUnit === \"week\" && line.unit !== \"week\";\n        let date = getUnitStart(line.unit, start, startOnMonday);\n        while (date < end) {\n            let next = add(date, step);\n            if (date < start)\n                date = start;\n            if (next > end)\n                next = end;\n            /**\n             * Special handling for counting width of greater units in weeks\n             * this code decides whether a week belongs to the current greater unit based on weekdays of this unit boundaries\n             * if start day is Thursday+, then this greater unit should not count this week as its own\n             * if end day is Thursday+, then this greater unit should count this week as its own\n             */\n            let cdate = date;\n            let cnext = next;\n            if (countInWeeks) {\n                if (getDay(date, startOnMonday) > 3) {\n                    cdate = addUnit(\"week\")(date, 1);\n                }\n                if (getDay(next, startOnMonday) > 3) {\n                    cnext = addUnit(\"week\")(next, 1);\n                }\n            }\n            const cellWidth = (diff(cnext, cdate, startOnMonday) || 1) * width;\n            let css = \"\";\n            if (line.css)\n                css += typeof line.css === \"function\" ? line.css(date) : line.css;\n            cells.push({\n                width: cellWidth,\n                css,\n                date,\n                format: line.format,\n            });\n            date = next;\n        }\n        return { cells, add, height, type: line.unit, step: line.step || 1 };\n    });\n    precise = !!(minUnit === \"day\" ? precise : precise != false);\n    return {\n        rows,\n        width: fullWidth,\n        height: fullHeight,\n        cellWidth: width,\n        cellHeight: height,\n        diff,\n        start,\n        end,\n        minUnit,\n        precise,\n        isHoliday,\n        startOnMonday,\n    };\n}\nfunction grid(width, height, color) {\n    const canvas = document.createElement(\"canvas\");\n    canvas.setAttribute(\"width\", width + \"\");\n    canvas.setAttribute(\"height\", height + \"\");\n    const ctx = canvas.getContext(\"2d\");\n    ctx.strokeStyle = color;\n    ctx.moveTo(0, height);\n    ctx.lineTo(width, height);\n    ctx.lineTo(width, 0);\n    ctx.stroke();\n    return canvas.toDataURL();\n}\n\n/**\n * Prepares dimensional coordinates for a task\n * @param {Object} task - task data object\n * @param {number} i - the index of the task\n * @param {Object} scales - the data for current scales; the return value of resetScales()\n * @param {number} taskHeight - the height of a task bar\n * @param {number} y - the top position of a task after which the current task will be placed (timeline mode)\n * @returns {Object} task data object\n */\nfunction updateTask(task, i, scales, taskHeight, y) {\n    if (task.type === \"split\" && task.$data && task.$data.length) {\n        task.$data.forEach(k => setSizes(k, i, scales, taskHeight));\n    }\n    else {\n        setSizes(task, i, scales, taskHeight, y);\n    }\n    return task;\n}\nfunction setSizes(task, i, scales, taskHeight, y) {\n    const { start, end, cellWidth, cellHeight, diff, minUnit, precise } = scales;\n    const startDate = task.start_date < start ? start : task.start_date;\n    const endDate = task.end_date > end ? end : task.end_date;\n    const astart = getUnitStart(minUnit, start, scales.startOnMonday);\n    const ms = task.type == \"milestone\";\n    task.$h = taskHeight;\n    task.$x =\n        Math.round(diff(startDate, astart, scales.startOnMonday, precise) * cellWidth) - (ms ? task.$h / 2 : 0);\n    task.$w = ms\n        ? task.$h\n        : Math.round(diff(endDate, startDate, scales.startOnMonday, precise, true) *\n            cellWidth);\n    task.$y =\n        typeof y === \"undefined\"\n            ? cellHeight * i + (cellHeight - taskHeight) / 2\n            : y;\n}\n/**\n * Updates start, end and duration fields of tasks during initial loading and updating\n * @param {Object} task - task data object\n * @param {Object} scales - (optional) the data for current scales; the return value of resetScales()\n * @param {string} mode - (optional) update mode, \"start\" or \"end\"\n * @param {number} dir - (optional) direction of change (-1 is the past, 1 is the future)\n */\nfunction updateTaskDuration(task, scales, mode, dir) {\n    if (task.start_date &&\n        task.end_date &&\n        task.start_date.valueOf() >= task.end_date.valueOf()) {\n        task.end_date = null;\n        task.duration = 1;\n        if (mode)\n            mode = \"move\";\n    }\n    if (scales) {\n        excludeHolidays(task, scales, mode, dir);\n    }\n    else {\n        if (task.type == \"milestone\") {\n            getMilestone(task);\n        }\n        else {\n            if (!task.duration) {\n                task.duration = getDuration(task);\n            }\n            if (!task.end_date) {\n                task.end_date = getEnd(task);\n            }\n        }\n    }\n}\n/**\n * Excludes holidays from start, end and duration of tasks (can't start or end on a holiday)\n * @param {Object} task - task data object\n * @param {Object} scales - the data for current scales; the return value of resetScales()\n * @param {string} mode - (optional) update mode, \"start\" or \"end\"\n * @param {number} dir - (optional) direction of change (-1 is the past, 1 is the future)\n */\nfunction excludeHolidays(task, scales, mode, dir) {\n    if (task.type == \"milestone\") {\n        task.start_date = mode\n            ? toWorkday(task.start_date, false, scales, dir)\n            : toClosestWorkday(task.start_date, scales); //on load\n        return getMilestone(task);\n    }\n    if (!mode) {\n        //on load\n        task.start_date = toClosestWorkday(task.start_date, scales);\n        task.end_date = getEndWorkday(task, scales);\n        task.duration = getDuration(task, scales);\n    }\n    else {\n        if (mode == \"start\" || mode == \"move\") {\n            task.start_date = toWorkday(task.start_date, false, scales, dir);\n            if (!task.duration)\n                task.duration = getDuration(task, scales);\n            if (!task.end_date)\n                task.end_date = getEndWorkday(task, scales);\n        }\n        else {\n            //end, duration\n            if (!task.end_date)\n                task.end_date = getEndWorkday(task, scales);\n            if (!task.duration) {\n                task.end_date = toWorkday(task.end_date, true, scales, dir);\n                task.duration = getDuration(task, scales);\n            }\n        }\n    }\n}\nfunction getMilestone(task) {\n    task.duration = 0;\n    task.end_date = task.start_date;\n}\n/**\n * Returns the end date of a task\n * @param {Object} task - task data object\n */\nfunction getEnd(task) {\n    if (task.duration < 1)\n        return addUnit(\"hour\")(task.start_date, Math.floor(24 * task.duration));\n    else\n        return addUnit(\"day\")(task.start_date, task.duration);\n}\n/**\n * Returns end date excluding holidays from duration\n * @param {Object} task - task data object\n * @param {Object} scales - the data for current scales; the return value of resetScales()\n * @returns {Date} end date\n */\nfunction getEndWorkday(task, scales) {\n    if (task.duration < 1)\n        return getEnd(task);\n    let date = getDatePart(task.start_date);\n    for (let w = 0, d = 0; w < task.duration;) {\n        if (!scales.isHoliday(date)) {\n            ++w;\n            d = 0;\n        }\n        else {\n            if (++d === 30)\n                holidayGuard();\n        }\n        date = addUnit(\"day\")(date, 1);\n    }\n    return date;\n}\n/**\n * Calculates the duration of a task\n * @param {Object} task - task data object\n * @param {Object} scales - the data for current scales; the return value of resetScales()\n * @returns {number} task duration\n */\nfunction getDuration(task, scales) {\n    const d = getDiff(\"day\")(task.end_date, task.start_date, true);\n    // allow float duration for tasks smaller than day\n    if (d < 1)\n        return parseFloat(d.toFixed(2));\n    if (!scales)\n        return Math.floor(d);\n    let date = task.start_date;\n    let duration = 0;\n    while (date < task.end_date) {\n        if (!scales.isHoliday(date))\n            ++duration;\n        date = addUnit(\"day\")(date, 1);\n    }\n    return duration;\n}\n/**\n * Moves a date from a holiday to the closest working day (priority to the future)\n * @param {Date} date - original date\n * @param {Object} scales - the data for current scales; the return value of resetScales()\n * @returns {Date} the date of a closest work day\n */\nfunction toClosestWorkday(date, scales) {\n    let left = date;\n    let right = date;\n    let notRight;\n    let d = 0;\n    while (d < 30 &&\n        (notRight = scales.isHoliday(right)) &&\n        scales.isHoliday(left)) {\n        left = addUnit(\"day\")(left, -1);\n        right = addUnit(\"day\")(right, 1);\n        d++;\n    }\n    if (d === 30)\n        holidayGuard();\n    return !notRight ? right : left;\n}\nfunction holidayGuard() {\n    alert(\"No work days found within 30 days, check your isHoliday function!\");\n    throw \"Wrong isHoliday function\";\n}\n/**\n * Moves a date from a holiday to a working day in the given direction\n * @param {Date} date - the current date\n * @param {Boolean} end - indicates if this is the end of a task\n * @param {Object} scales - the data for current scales; the return value of resetScales()\n * @param {number} dir - the direction in which nearest workday will be located; -1 is the past, 1 is the future\n * @returns {Date} the date of a working day\n */\nfunction toWorkday(date, end, scales, dir) {\n    let d = 0;\n    while (d < 30 && scales.isHoliday(getCheckDate(date, end))) {\n        date = addUnit(\"day\")(date, dir);\n        d++;\n    }\n    if (d === 30)\n        holidayGuard();\n    return date;\n}\n/**\n * Returns the date for a holiday check\n * @param {Date} date - the date\n * @param {Boolean} end - if true, means it's the end date (end dates are exclusive)\n * @returns {Date} the date that will be used for a check\n */\nfunction getCheckDate(date, end) {\n    return end && !getTimePart(date) ? addUnit(\"day\")(date, -1) : date;\n}\n\nconst delta = 20;\nfunction updateLink(link, startTask, endTask, height) {\n    const dy = Math.round(height / 2);\n    if (!startTask || !endTask) {\n        link.$p = \"\";\n        return link;\n    }\n    let s_start = false;\n    let e_start = false;\n    switch (link.type) {\n        case 0:\n            e_start = true;\n            break;\n        case 1:\n            s_start = true;\n            e_start = true;\n            break;\n        case 3:\n            s_start = true;\n            break;\n    }\n    const sx = s_start ? startTask.$x : startTask.$x + startTask.$w;\n    const sy = startTask.$y;\n    const ex = e_start ? endTask.$x : endTask.$x + endTask.$w;\n    const ey = endTask.$y;\n    if (differentX(startTask, endTask, sx, ex, height) || sy !== ey) {\n        const lineCoords = getLineCoords(sx, sy + dy, ex, ey + dy, s_start, e_start, 38 / 2);\n        const arrowCoords = getArrowCoords(ex, ey + dy, e_start);\n        link.$p = `${lineCoords},${arrowCoords}`;\n    }\n    else {\n        link.$p = \"\";\n    }\n    return link;\n}\nfunction differentX(startTask, endTask, sx, ex, height) {\n    if (startTask.type === \"milestone\" || endTask.type === \"milestone\")\n        return Math.abs(sx - ex) > height / 2;\n    return sx !== ex;\n}\nfunction getLineCoords(sx, sy, ex, ey, s_start, e_start, gapp) {\n    const shift = delta * (s_start ? -1 : 1);\n    const backshift = delta * (e_start ? -1 : 1);\n    const sx1 = sx + shift;\n    const ex1 = ex + backshift;\n    const line = [sx, sy, sx1, sy, 0, 0, 0, 0, ex1, ey, ex, ey];\n    const dx = ex1 - sx1;\n    let dy = ey - sy;\n    const same = e_start === s_start;\n    if (!same && ((ex1 <= sx + delta - 2 && e_start) || (ex1 > sx && !e_start))) {\n        dy -= gapp;\n    }\n    if ((same && e_start && sx1 > ex1) || (same && !e_start && sx1 < ex1)) {\n        line[4] = line[2] + dx;\n        line[5] = line[3];\n        line[6] = line[4];\n        line[7] = line[5] + dy;\n    }\n    else {\n        line[4] = line[2];\n        line[5] = line[3] + dy;\n        line[6] = line[4] + dx;\n        line[7] = line[5];\n    }\n    return line.join(\",\");\n}\nfunction getArrowCoords(x, y, start) {\n    if (start) {\n        return `${x - 5},${y - 3},${x - 5},${y + 3},${x},${y}`;\n    }\n    else {\n        return `${x + 5},${y + 3},${x + 5},${y - 3},${x},${y}`;\n    }\n}\nfunction newLink(box, start, end) {\n    if (start && end) {\n        const width = end.x - start.x;\n        const height = end.y - start.y;\n        const left = (width > 0 ? start.x : end.x) - box.left;\n        const top = (height > 0 ? start.y : end.y) - box.top;\n        const p = `${width > 0 ? 0 : -width},${height > 0 ? 0 : -height},${width > 0 ? width : 0},${height > 0 ? height : 0}`;\n        return { width: Math.abs(width), height: Math.abs(height), left, top, p };\n    }\n    else {\n        return null;\n    }\n}\n\nexport { addUnit, getDiff, getUnitStart, grid, newLink, resetScales, smallerCount, updateLink, updateTask, updateTaskDuration };\n//# sourceMappingURL=wgantt.es6.js.map\n","import {\n\taddUnit,\n\tgetDiff,\n\tgetUnitStart,\n\tgrid,\n\tnewLink,\n\tresetScales,\n\tsmallerCount,\n\tupdateLink,\n\tupdateTask,\n\tupdateTaskDuration,\n} from \"@xbs/webix-gantt-lib\";\n\nexport default class Helpers {\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.defaultResourceUnit = \"hour\";\n\t\tthis.defaultResourceValues = {\n\t\t\thour: 8,\n\t\t};\n\t\tthis.resourceValueRanges = {\n\t\t\thour: [0.5, 24],\n\t\t};\n\t\tthis.resourceValueSteps = {\n\t\t\thour: 0.5,\n\t\t};\n\t\tthis.unitLoadNorm = {\n\t\t\tday: 8,\n\t\t\tweek: 40,\n\t\t\tmonth: 170,\n\t\t\tquarter: 510,\n\t\t\tyear: 2040,\n\t\t};\n\t}\n\n\t/**\n\t * Get name initials\n\t * @param {string} name - resource name\n\t * @returns {string} name initials\n\t */\n\tinitials(name) {\n\t\tlet initials = name.match(/\\b\\w/g) || [];\n\t\tif (initials.length == 1)\n\t\t\treturn name.charAt(0).toUpperCase() + name.charAt(1);\n\t\treturn ((initials.shift() || \"\") + (initials.pop() || \"\")).toUpperCase();\n\t}\n\n\t/**\n\t * Get an additional css class for resource avatar\n\t * @param {string} name - a resource name\n\t * @returns {string} a css class\n\t */\n\tavatarCss(name) {\n\t\treturn (\n\t\t\t\" webix_gantt_person_avatar_\" +\n\t\t\t((name.charCodeAt(1) + (name.length % 10)) % 10)\n\t\t);\n\t}\n\n\t/**\n\t * A template for an assignment avatar\n\t * @param {object} resource - a resource object\n\t * @param {string} cssClass - an addition css class for the avatar\n\t * @param {boolean} withTooltip - specifies whether  an avatar should get tooltip\n\t * @returns {string} html string for assignment avatar\n\t */\n\tresourceAvatar(resource, cssClass, withTooltip) {\n\t\tlet css = \"webix_gantt_person_avatar\";\n\t\tif (typeof cssClass == \"string\") css += \" \" + cssClass;\n\t\tif (resource.avatar)\n\t\t\treturn `<img class=\"${css}\" src=\"${resource.avatar}\" webix_tooltip=\"${\n\t\t\t\twithTooltip ? resource.name : \"\"\n\t\t\t}\"/>`;\n\t\tconst txt = resource.name;\n\t\treturn `<div class='${css} ${\n\t\t\ttxt ? this.avatarCss(txt) : \"\"\n\t\t}' webix_tooltip=\"${withTooltip ? resource.name : \"\"}\">${\n\t\t\ttxt ? this.initials(txt) : \"\"\n\t\t}</div>`;\n\t}\n\n\t/**\n\t * Get the default value for the resource unit\n\t * @param {object} obj - a resource object\n\t * @returns {any} the default resource\n\t */\n\tgetDefaultResourceValue(obj) {\n\t\tconst unit = this.getResourceUnit(obj);\n\t\treturn this.defaultResourceValues[unit];\n\t}\n\n\t/**\n\t * Get a resource unit\n\t * @param {object} obj - a resource object\n\t * @returns {string} a resource unit\n\t */\n\tgetResourceUnit(obj) {\n\t\treturn obj.unit || this.defaultResourceUnit;\n\t}\n\t/**\n\t * Get a resource value range\n\t * @param {object} obj - a resource object\n\t * @returns {array} a resource value range\n\t */\n\tgetResourceValueRange(obj) {\n\t\tconst unit = this.getResourceUnit(obj);\n\t\treturn this.resourceValueRanges[unit] || [1, 100];\n\t}\n\t/**\n\t * Get a resource value step\n\t * @param {object} obj - a resource object\n\t * @returns {array} a resource value step\n\t */\n\tgetResourceValueStep(obj) {\n\t\tconst unit = this.getResourceUnit(obj);\n\t\treturn this.resourceValueSteps[unit] || null;\n\t}\n\t/**\n\t * Check if a date is a holiday for an assigned resource\n\t * @param {date} date - Date object\n\t * @param {object} cal - a calendar object of a resource\n\t * @returns {boolean} true if date is a holiday\n\t */\n\tisResourceHoliday(date, cal) {\n\t\tlet result = false;\n\t\tif (cal.holidays)\n\t\t\tresult = cal.holidays.find(d => d.getTime() == date.getTime());\n\t\tif (cal.weekDays)\n\t\t\tresult = result || cal.weekDays.indexOf(date.getDay()) == -1;\n\t\treturn result;\n\t}\n\n\t/* wrappers for gantt-lib functions */\n\n\taddUnit(unit, date, inc) {\n\t\treturn addUnit(unit)(date, inc);\n\t}\n\n\tgetDifference(unit, next, prev) {\n\t\treturn getDiff(unit)(next, prev, webix.Date.startOnMonday);\n\t}\n\n\tgetUnitStart(unit, date) {\n\t\treturn getUnitStart(unit, date, webix.Date.startOnMonday);\n\t}\n\n\tupdateTask(task, index) {\n\t\tconst local = this.app.getService(\"local\");\n\t\treturn updateTask(task, index, local.getScales(), local.getTaskHeight());\n\t}\n\n\tsetScales(start, end, precise, width, height, scales) {\n\t\treturn resetScales(\n\t\t\tstart,\n\t\t\tend,\n\t\t\tprecise,\n\t\t\twidth,\n\t\t\theight,\n\t\t\tscales,\n\t\t\tthis.app.config.isHoliday,\n\t\t\twebix.Date.startOnMonday\n\t\t);\n\t}\n\n\tupdateLink(link, start, end) {\n\t\tconst local = this.app.getService(\"local\");\n\t\treturn updateLink(link, start, end, local.getTaskHeight());\n\t}\n\n\tupdateTaskDuration(task, scales, mode, dir) {\n\t\treturn updateTaskDuration(task, scales, mode, dir);\n\t}\n\n\tgetSmallerUnit(unit) {\n\t\treturn smallerCount[unit][0];\n\t}\n\n\tgetSmallerCount(unit) {\n\t\treturn smallerCount[unit][1];\n\t}\n\n\tnewLink(box, start, end) {\n\t\treturn newLink(box, start, end);\n\t}\n\n\tdrawGridInner(width, height, color) {\n\t\treturn grid(width, height, color);\n\t}\n}\n","import { arrayEquals } from \"helpers/common\";\n\nexport default class Grouping {\n\t/**\n\t * @constructor\n\t * @param {App} app - Jet App instance\n\t */\n\tconstructor(app) {\n\t\tthis.app = app;\n\t\tthis.local = app.getService(\"local\");\n\t\tthis.helpers = app.getService(\"helpers\");\n\t\tthis.closedResources = null;\n\t}\n\n\t/* Grouping for Tasks View*/\n\n\t/***\n\t * Get tasks tree data (grouped by parent)\n\t * @param {array} data - a data array\n\t * @param {string} id - a branch id\n\t * @returns {array} a data array for webix.TreeCollection\n\t */\n\tgetTreeData(data, id) {\n\t\tconst tree = data.filter(a => a.parent == id);\n\t\ttree.forEach(a => {\n\t\t\tconst temp = this.getTreeData(data, a.id);\n\t\t\tif (temp) a.data = temp;\n\t\t});\n\n\t\treturn tree;\n\t}\n\n\t/* Grouping for Resource Diagram */\n\n\t/**\n\t * Webix TreeCollection\n\t * @typedef {Object} TreeCollection\n\t */\n\n\t/**\n\t * Collects data for resource diagram (hierarchical structure)\n\t * @returns {TreeCollection}\n\t */\n\tgetRDCollection(force) {\n\t\tif (this._rdCollection && !force) return this._rdCollection;\n\n\t\tconst tasks = this.local.tasks();\n\t\tconst assignments = this.local.assignments();\n\t\tconst resources = this.local.resources();\n\t\tif (!this._rdCollection) {\n\t\t\tthis._rdCollection = new webix.TreeCollection({});\n\t\t\twebix.extend(this._rdCollection, webix.Group);\n\n\t\t\tthis.syncRDWithData();\n\t\t} else {\n\t\t\tthis._rdCollection.clearAll();\n\t\t}\n\n\t\twebix.promise\n\t\t\t.all([tasks.waitData, assignments.waitData, resources.waitData])\n\t\t\t.then(() => {\n\t\t\t\tconst data = [];\n\t\t\t\tconst scales = this.local.getScales();\n\t\t\t\tassignments.data.each(obj => {\n\t\t\t\t\tconst res = this.getDiagramItemData(obj, scales);\n\t\t\t\t\tif (res) data.push(res);\n\t\t\t\t});\n\t\t\t\tthis._rdCollection.parse(data);\n\t\t\t\tthis.groupResourceDiagram();\n\t\t\t});\n\n\t\treturn this._rdCollection;\n\t}\n\n\t/**\n\t * Synchs RD collection with main collections and scale changes\n\t */\n\tsyncRDWithData() {\n\t\tthis.app.on(\"onScalesUpdate\", (v, o) => {\n\t\t\tif (this._rdCollection && this._rdCollection.data.order.length) {\n\t\t\t\tthis.refreshTaskDiagram();\n\n\t\t\t\tif (v.minUnit !== o.minUnit) {\n\t\t\t\t\tthis.updateUnitDurations();\n\t\t\t\t\tthis.groupResourceDiagram();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tconst tasks = this.local.tasks();\n\t\ttasks.data.attachEvent(\"onStoreUpdated\", (id, obj, mode) => {\n\t\t\tif (\n\t\t\t\tmode &&\n\t\t\t\tobj &&\n\t\t\t\t(mode == \"update\" ||\n\t\t\t\t\tmode == \"delete\" ||\n\t\t\t\t\tthis.local.assignments().find(a => a.task === obj.id, true))\n\t\t\t) {\n\t\t\t\tthis.updateTaskDiagram(obj, mode);\n\t\t\t\tthis.groupResourceDiagram();\n\t\t\t}\n\t\t});\n\t\tconst assignments = this.local.assignments();\n\t\tassignments.data.attachEvent(\"onStoreUpdated\", (id, obj, mode) => {\n\t\t\tif (id) {\n\t\t\t\tthis.refreshResourceDiagram(id, obj, mode);\n\t\t\t\tthis.groupResourceDiagram();\n\t\t\t}\n\t\t});\n\t}\n\n\tupdateUnitDurations() {\n\t\tconst tasks = this.local.tasks();\n\t\tconst assignments = this.local.assignments();\n\t\tconst scales = this.local.getScales();\n\t\tthis._rdCollection.data.each(obj => {\n\t\t\tif (obj.task) {\n\t\t\t\tconst task = tasks.getItem(obj.task);\n\t\t\t\tconst assignment = assignments.getItem(obj.id);\n\t\t\t\tif (task && assignment) {\n\t\t\t\t\tobj.duration = this.calculateUnitDuration(task, scales);\n\t\t\t\t\tobj.value = this.calculateLoad(\n\t\t\t\t\t\t{ ...task, ...assignment },\n\t\t\t\t\t\tscales.minUnit\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t *\n\t * @param {Object} task\n\t */\n\tcalculateUnitDuration(task, scales) {\n\t\treturn scales.minUnit === \"day\"\n\t\t\t? task.duration\n\t\t\t: scales.diff(\n\t\t\t\t\ttask.end_date,\n\t\t\t\t\ttask.start_date,\n\t\t\t\t\twebix.Date.startOnMonday,\n\t\t\t\t\tfalse,\n\t\t\t\t\ttrue\n\t\t\t  );\n\t}\n\n\t/**\n\t * Collects data on assignment from all related tables (tasks and resources) for resources diagram\n\t * @param {Object} obj - assignment data object\n\t * @returns {Object} all data about assignment\n\t */\n\tgetDiagramItemData(obj, scales) {\n\t\tconst task = this.local.tasks().getItem(obj.task);\n\n\t\tif (task) {\n\t\t\tif (!this.local._isTaskVisible(task, true)) {\n\t\t\t\tthis.helpers.updateTask(task, 0);\n\t\t\t}\n\n\t\t\tconst resource = this.local.resources().getItem(obj.resource);\n\t\t\tconst res = { ...task, ...resource, ...obj };\n\t\t\tres.duration = this.calculateUnitDuration(task, scales);\n\t\t\tres.value = this.calculateLoad(res, scales.minUnit);\n\n\t\t\t// diagram renders 1 workload markers per min unit\n\t\t\tres.$x = this.truncateX(res.$x, scales);\n\n\t\t\treturn res;\n\t\t}\n\n\t\treturn null;\n\t}\n\n\t/**\n\t * Calculates workload per current min scale unit\n\t * @param {Object} data - data object for resource diagram (at least must have values from tasks and resources)\n\t * @param {string} unit - the min scale unit of the current scale (\"day\", \"week\", etc)\n\t * @returns {Array} load per 1st and last units if they are not fully occupied, and a fully occupied unit load. e.g. [1,0,8]\n\t */\n\tcalculateLoad(data, unit) {\n\t\tconst num = this.getUnitLoad(data);\n\n\t\tif (unit === \"hour\") return [0, 0, num / 24];\n\n\t\tif (unit === \"day\") return [0, 0, num];\n\n\t\tconst load = [];\n\n\t\tlet start = webix.Date.copy(data.start_date);\n\t\tconst startUnitStart = this.helpers.getUnitStart(unit, start);\n\t\tlet end = webix.Date.copy(data.end_date);\n\t\tconst endUnitStart = this.helpers.getUnitStart(unit, end);\n\t\tlet startUnitEnd;\n\n\t\tif (webix.Date.datePart(start, true) > startUnitStart) {\n\t\t\tstartUnitEnd = this.helpers.addUnit(unit, startUnitStart, 1);\n\t\t\tif (end > startUnitEnd) {\n\t\t\t\t// find duration in days for the first not-fully occupied unit\n\t\t\t\tconst days = this.findUnitDuration(start, startUnitEnd, data);\n\t\t\t\tload.push(days);\n\t\t\t\tstart = startUnitEnd;\n\t\t\t} else load.push(0);\n\t\t} else load.push(0);\n\n\t\tif (\n\t\t\t!webix.Date.equal(startUnitStart, endUnitStart) &&\n\t\t\twebix.Date.datePart(end, true) >= endUnitStart\n\t\t) {\n\t\t\t// find duration in days for the last not fully-occupied unit\n\t\t\tconst days = this.findUnitDuration(endUnitStart, end, data);\n\t\t\tload.push(days);\n\t\t\tend = endUnitStart;\n\t\t} else load.push(0);\n\n\t\t// find duration in days for a fully-occupied unit\n\t\tconst plusUnit = this.helpers.addUnit(unit, start, 1);\n\t\tconst days = this.findUnitDuration(\n\t\t\tstart,\n\t\t\tnew Date(Math.min(plusUnit, end)),\n\t\t\tdata\n\t\t);\n\t\tload.push(days);\n\n\t\treturn load.map(l => l * num);\n\t}\n\n\t/**\n\t * Finds unit duration in days ( to calculate work load per init )\n\t * @param start {Date} start date\n\t * @param end {Date} end date\n\t * @param data {object} data object\n\t * @returns {number} days number\n\t */\n\tfindUnitDuration(start, end, data) {\n\t\tlet days = this.helpers.getDifference(\"day\", end, start);\n\t\tif (this.app.config.excludeHolidays) {\n\t\t\tlet i,\n\t\t\t\td = webix.Date.copy(start),\n\t\t\t\tn = days;\n\t\t\tfor (i = 0; i < n; i++) {\n\t\t\t\tif (this.checkHoliday(d, data)) days--;\n\t\t\t\twebix.Date.add(d, 1, \"day\");\n\t\t\t}\n\t\t}\n\t\treturn days;\n\t}\n\n\t/**\n\t * Check if date is a holiday\n\t * @param d {Date} date to check\n\t * @param data {object} data object (resource calendar check)\n\t * @returns {boolean} true if date is a holiday\n\t */\n\tcheckHoliday(d, data) {\n\t\tif (this.app.config.resourceCalendars) {\n\t\t\tconst calendarId = this.local.resources().getItem(data.resource)\n\t\t\t\t.calendar_id;\n\t\t\tif (calendarId) {\n\t\t\t\tconst calendar = this.local.calendars().getItem(calendarId);\n\t\t\t\treturn this.helpers.isResourceHoliday(d, calendar);\n\t\t\t}\n\t\t}\n\t\treturn this.app.config.isHoliday(d);\n\t}\n\n\t/**\n\t * Returns resource load per unit\n\t * @param {Object} data - data object from Resource Diagram collection\n\t * @returns {number} load per unit (by default hours, but can be anything)\n\t */\n\tgetUnitLoad(data) {\n\t\treturn data.value;\n\t}\n\n\t/**\n\t * Cuts X coordinate down to unit start if precision setting was set for the scale,\n\t * because diagram renders 1 workload marker per min unit in the middle\n\t * @param {number} x - the X coordinate of a task bar on a date scale\n\t * @param {Object} scales - the data object of current scales\n\t * @returns {number} altered X\n\t */\n\ttruncateX(x, scales) {\n\t\tif (scales.precise !== false) {\n\t\t\treturn Math.floor(x / scales.cellWidth) * scales.cellWidth;\n\t\t}\n\t\treturn x;\n\t}\n\n\t/**\n\t * Refreshes data in diagram collection if a resource was (un)assigned or load per day changed\n\t * @param {(string|number)} id - the ID of an assignment record\n\t * @param {Object} obj - data object of an assignment\n\t * @param {string} mode - operation mode (\"add\", \"update\", \"delete\")\n\t */\n\trefreshResourceDiagram(id, obj, mode) {\n\t\tconst data = this._rdCollection;\n\t\tconst scales = this.local.getScales();\n\t\tswitch (mode) {\n\t\t\tcase \"update\":\n\t\t\t\tif (data.exists(id)) {\n\t\t\t\t\tconst task = this.local.tasks().getItem(obj.task);\n\t\t\t\t\tconst resource = { ...this.local.resources().getItem(obj.resource) };\n\t\t\t\t\tdelete resource.id;\n\t\t\t\t\tconst value = this.calculateLoad({ ...task, ...obj }, scales.minUnit);\n\t\t\t\t\tdata.updateItem(id, { ...obj, ...resource, value });\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase \"add\":\n\t\t\t\tdata.add(this.getDiagramItemData(obj, scales));\n\t\t\t\tbreak;\n\t\t\tcase \"delete\":\n\t\t\t\tif (data.exists(id)) data.remove(id);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\t/**\n\t * Removed all related data records in diagram collection if an assigned task was removed\n\t * @param {Object} task - the ID of a task\n\t * @param {string} mode - operation type (add, delete, update)\n\t */\n\tupdateTaskDiagram(task, mode) {\n\t\tconst data = this._rdCollection;\n\t\tconst scales = this.local.getScales();\n\n\t\tif (mode === \"delete\") {\n\t\t\tthis.pruneDiagram();\n\t\t} else if (mode === \"add\") {\n\t\t\tconst rec = this.local.assignments().find(a => a.task === task.id, true);\n\t\t\tdata.add(this.getDiagramItemData(rec, scales));\n\t\t} else if (mode === \"update\") {\n\t\t\tconst assignments = data.find(a => a.task === task.id);\n\t\t\tassignments.forEach(a => {\n\t\t\t\tconst oa = this.local.assignments().getItem(a.id);\n\t\t\t\tdata.updateItem(a.id, {\n\t\t\t\t\tstart_date: task.start_date,\n\t\t\t\t\tid: a.id,\n\t\t\t\t\tduration: this.calculateUnitDuration(task, scales),\n\t\t\t\t\t$x: this.truncateX(task.$x, scales),\n\t\t\t\t\tvalue: this.calculateLoad({ ...task, ...oa }, scales.minUnit),\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Cleans removed tasks from resource diagram\n\t * (it's not enough to remove 1 removed task because the removed task can have kids,\n\t * and they go together with their parent and there is no event about each of them)\n\t */\n\tpruneDiagram() {\n\t\tconst tasks = this.local.tasks();\n\t\tconst toRemove = [];\n\t\tthis._rdCollection.data.eachLeaf(0, d => {\n\t\t\tif (!tasks.exists(d.task)) toRemove.push(d.id);\n\t\t});\n\t\tif (toRemove.length) this._rdCollection.remove(toRemove);\n\t}\n\n\t/**\n\t * Updates $x coordinates for tasks after scale changes\n\t */\n\trefreshTaskDiagram() {\n\t\tconst scales = this.local.getScales();\n\t\tthis._rdCollection.data.each(a => {\n\t\t\tconst task = this.local.tasks().getItem(a.task);\n\t\t\tif (task) a.$x = this.truncateX(task.$x, scales);\n\t\t});\n\t}\n\n\t/**\n\t * Groups data for resource diagram\n\t */\n\tgroupResourceDiagram() {\n\t\tconst collection = this._rdCollection;\n\t\tcollection.group({\n\t\t\tby: obj => obj.name + \"-\" + obj.category,\n\t\t\tmap: {\n\t\t\t\tresource_id: [\"resource\"],\n\t\t\t\tvalue: [\"name\"],\n\t\t\t\tname: [\"name\"],\n\t\t\t\tcategory: [\"category\"],\n\t\t\t\tavatar: [\"avatar\"],\n\t\t\t\tload: [\"value\", calculateLoad],\n\t\t\t\tduration: [\"duration\", collect], // num of workload markers\n\t\t\t\tunits: [\"value\", collect], // number on a workload marker\n\t\t\t\t$x: [\"$x\", collect], // start of a task\n\t\t\t\tcount: [\"value\", \"count\"],\n\t\t\t\tstart_date: [\"start_date\", collect],\n\t\t\t},\n\t\t});\n\t\tcollection.group(\n\t\t\t{\n\t\t\t\tby: \"category\",\n\t\t\t\tmap: {\n\t\t\t\t\tvalue: [\"category\"],\n\t\t\t\t\tname: [\"category\"],\n\t\t\t\t\tduration: [\"duration\", \"sum\"],\n\t\t\t\t\tload: [\"load\", \"sum\"],\n\t\t\t\t\tcount: [\"count\", \"sum\"],\n\t\t\t\t},\n\t\t\t},\n\t\t\t0\n\t\t);\n\t}\n\n\t/* Grouping for Resource View*/\n\n\t/**\n\t * Resource-task collection (shown when \"display\" state property equals \"resources\")\n\t * @returns {object} TreeCollection|webix.TreeCollection\n\t */\n\tgetResourceTree() {\n\t\tif (this._resourcesTree) return this._resourcesTree;\n\n\t\tthis._resourcesTree = new webix.TreeCollection({\n\t\t\ton: {\n\t\t\t\t\"data->onStoreUpdated\": (id, obj, mode) => {\n\t\t\t\t\tid = mode == \"update\" || mode == \"paint\" ? id : null;\n\t\t\t\t\tthis.refreshResourceTasks(id);\n\t\t\t\t\tthis.local.refreshLinks();\n\t\t\t\t},\n\t\t\t},\n\t\t\tscheme: {\n\t\t\t\t$sort: {\n\t\t\t\t\tby: \"start_date\",\n\t\t\t\t\tdir: \"asc\",\n\t\t\t\t\tas: \"int\",\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\n\t\tthis._resourcesTree.parse(\n\t\t\tthis.resourceTaskLoader().finally(() => {\n\t\t\t\tthis.syncResourceTree();\n\t\t\t})\n\t\t);\n\n\t\treturn this._resourcesTree;\n\t}\n\n\t/**\n\t * Load task data and extend each task item with the \"resources\" property -\n\t * an array of task resources or null\n\t * @returns {Promise} promise that is resolved with a data array\n\t */\n\ttasksWithResources() {\n\t\treturn webix.promise\n\t\t\t.all([this.local.tasks().waitData, this.local.assignments().waitData])\n\t\t\t.then(() => {\n\t\t\t\tlet data = [];\n\t\t\t\tthis.local.tasks().data.each(\n\t\t\t\t\tt => {\n\t\t\t\t\t\tif (t.type == \"task\" || !t.type) {\n\t\t\t\t\t\t\tlet task = Object.assign({}, t);\n\t\t\t\t\t\t\tconst result = this.local\n\t\t\t\t\t\t\t\t.assignments()\n\t\t\t\t\t\t\t\t.data.find(a => a.task == task.id);\n\t\t\t\t\t\t\ttask.resources = result.length\n\t\t\t\t\t\t\t\t? result.map(item => item.resource)\n\t\t\t\t\t\t\t\t: null;\n\t\t\t\t\t\t\tdata.push(task);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t\"\",\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t\treturn data;\n\t\t\t});\n\t}\n\n\t/**\n\t * tasks and resources loader\n\t * @returns {Promise<[]>} promise that is resolved with a data array\n\t * @private\n\t */\n\tresourceTaskLoader() {\n\t\tconst Ops = this.app.getService(\"operations\");\n\t\treturn webix.promise\n\t\t\t.all([this.tasksWithResources(), this.local.resources().waitData])\n\t\t\t.then(d => {\n\t\t\t\tlet data = this.getResourceTaskData(d[0]);\n\t\t\t\tdata.forEach(r => {\n\t\t\t\t\tOps.setProjectData(r, null, r.data);\n\t\t\t\t});\n\t\t\t\treturn data;\n\t\t\t});\n\t}\n\n\t/**\n\t * Updates Resource TreeCollection, called on tasks() TreeCollection update\n\t */\n\trefreshResourceTree() {\n\t\tif (this._resourcesTree.count()) {\n\t\t\t// get closed branches\n\t\t\tthis.closedResources = [];\n\t\t\tthis._resourcesTree.data.eachChild(\"0\", item => {\n\t\t\t\tif (!item.open) this.closedResources.push(item.resources);\n\t\t\t});\n\t\t} else this.closedResources = null;\n\t\tthis.resourceTaskLoader().then(data => {\n\t\t\t// reload data\n\t\t\tthis._resourcesTree.clearAll();\n\t\t\tthis._resourcesTree.parse(data);\n\t\t\treturn data;\n\t\t});\n\t}\n\n\tsyncResourceTree() {\n\t\tconst tree = this._resourcesTree;\n\t\tthis.local.tasks().data.attachEvent(\"onStoreUpdated\", (id, obj, mode) => {\n\t\t\tif (mode == \"update\") {\n\t\t\t\tconst inTree = tree.exists(id) && tree.getItem(id).type == \"task\";\n\t\t\t\tconst becomesTask = obj.type == \"task\";\n\n\t\t\t\tif (inTree && becomesTask) {\n\t\t\t\t\ttree.updateItem(id, {\n\t\t\t\t\t\ttext: obj.text,\n\t\t\t\t\t\tdetails: obj.details,\n\t\t\t\t\t\tstart_date: obj.start_date,\n\t\t\t\t\t\tend_date: obj.end_date,\n\t\t\t\t\t\tduration: obj.duration,\n\t\t\t\t\t\tprogress: obj.progress,\n\t\t\t\t\t});\n\t\t\t\t\tconst pId = tree.getParentId(id);\n\t\t\t\t\tlet item = tree.getItem(pId);\n\t\t\t\t\tif (item) {\n\t\t\t\t\t\titem = this.app.getService(\"operations\").setProjectData(item, tree);\n\t\t\t\t\t\ttree.updateItem(pId, item);\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t} else if (inTree ^ becomesTask) {\n\t\t\t\t\tthis.refreshResourceTree();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.refreshResourceTree();\n\t\t\t}\n\t\t});\n\t\tthis.local.assignments().data.attachEvent(\"onStoreUpdated\", () => {\n\t\t\tthis.refreshResourceTree();\n\t\t});\n\t}\n\n\t/**\n\t * Get data for resource Tree collection ( tasks grouped by resources )\n\t * @param {array} tasks - an tasks array where each item contains\n\t * \"resources\" property (an array of ids or null)\n\t * @returns {array} data array\n\t */\n\tgetResourceTaskData(tasks) {\n\t\tlet data = [];\n\t\tlet unassignedBranch = null;\n\t\tconst Ops = this.app.getService(\"operations\");\n\n\t\ttasks.forEach(t => {\n\t\t\tconst { resources } = t;\n\t\t\tlet item;\n\t\t\tif (!resources) item = unassignedBranch ? unassignedBranch : null;\n\t\t\telse item = data.find(item => arrayEquals(item.resources, resources));\n\t\t\tif (!item) {\n\t\t\t\titem = {\n\t\t\t\t\tid: resources ? webix.uid() : \"unassigned\",\n\t\t\t\t\ttype: \"project\",\n\t\t\t\t\ttext: \"\",\n\t\t\t\t\tdata: [],\n\t\t\t\t\t// $group needed for faster checks\n\t\t\t\t\t$group: true,\n\t\t\t\t\t// restore open/closed state\n\t\t\t\t\topen: this.checkResourceOpen(resources),\n\t\t\t\t};\n\t\t\t\titem.resources = resources;\n\t\t\t\tif (resources)\n\t\t\t\t\titem.text = resources\n\t\t\t\t\t\t.map(id => this.local.resources().getItem(id))\n\t\t\t\t\t\t.sort(Ops.sortResources)\n\t\t\t\t\t\t.map(item => item.name)\n\t\t\t\t\t\t.join(\", \");\n\n\t\t\t\tif (resources) data.push(item);\n\t\t\t\telse {\n\t\t\t\t\titem.id = \"unassigned\";\n\t\t\t\t\tunassignedBranch = item;\n\t\t\t\t}\n\t\t\t}\n\t\t\titem.data.push(webix.copy(t));\n\t\t});\n\t\tif (unassignedBranch) data.push(unassignedBranch);\n\t\treturn data;\n\t}\n\n\t/**\n\t * Set task(s) properties that are needed to define size and position\n\t * @param {string} updID - task id (optional)\n\t * @param {number} i - task index (optional)\n\t */\n\trefreshResourceTasks(updID, i) {\n\t\tconst tree = this._resourcesTree;\n\t\tif (!updID) {\n\t\t\ttree.data.order.forEach((id, i) => {\n\t\t\t\tthis.refreshResourceTasks(id, i);\n\t\t\t});\n\t\t} else {\n\t\t\tconst t = tree.getItem(updID);\n\t\t\ti = !webix.isUndefined(i) ? i : tree.getIndexById(updID);\n\t\t\tthis.helpers.updateTask(t, i);\n\t\t}\n\t}\n\t/**\n\t * Checks whether this resource group needs to be open\n\t * @param {array} resources - array of resources in the group or null for Unassigned\n\t * @returns {boolean} result of the check\n\t */\n\tcheckResourceOpen(resources) {\n\t\tif (!this.closedResources) return true;\n\t\tif (!resources) return this.closedResources.indexOf(null) == -1;\n\t\treturn this.closedResources.find(arr => arrayEquals(arr, resources))\n\t\t\t? false\n\t\t\t: true;\n\t}\n}\n\n/**\n * An aggregation function for data grouping that collects column values (any) into an array\n * @param {string} property - the name of the data field (column)\n * @param {Array} data - the data objects of the items from the data set\n * @returns {Array} the resulting array\n */\nfunction collect(property, data) {\n\tconst ws = [];\n\n\tfor (let i = 0; i < data.length; i++) {\n\t\tws.push(property(data[i]));\n\t}\n\n\treturn ws;\n}\n\n/**\n * @param {string} property - the name of the data field (column)\n * @param {Array} data - the data objects of the items from the data set\n * @returns {number}\n */\nfunction calculateLoad(property, data) {\n\tlet sum = 0;\n\n\tfor (let i = 0; i < data.length; i++) {\n\t\tconst units = property(data[i]);\n\t\tlet duration = parseInt(data[i].duration);\n\t\tconst last = units.length - 1;\n\t\tfor (let j = 0; j < units.length; ++j) {\n\t\t\tconst num = units[j];\n\t\t\tif (num) {\n\t\t\t\tsum += (j === last ? duration : 1) * num;\n\t\t\t\tduration--;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn sum;\n}\n","import { JetApp, plugins, EmptyRouter } from \"webix-jet\";\nimport { initJetWin } from \"@xbs/jet-helpers\";\nimport { createState, link } from \"jet-restate\";\n\nimport views from \"./export_views\";\nimport en from \"locales/en\";\n\n// services\nimport Local from \"./models/Local\";\nimport Backend from \"./models/Backend\";\nimport Operations from \"./models/Operations\";\nimport Helpers from \"./models/Helpers\";\nimport Grouping from \"models/Grouping\";\n\nexport class App extends JetApp {\n\tconstructor(config) {\n\t\t// widget state\n\t\tconst state = createState({\n\t\t\ttop: 0,\n\t\t\tleft: 0,\n\t\t\tselected: null,\n\t\t\tedit: null,\n\t\t\treadonly: config.readonly || false,\n\t\t\tsort: null,\n\t\t\tdisplay:\n\t\t\t\tconfig.resources && config.display == \"resources\"\n\t\t\t\t\t? \"resources\"\n\t\t\t\t\t: \"tasks\",\n\t\t\tcriticalPath: config.criticalPath || false,\n\t\t\tresourcesDiagram: !!(config.resources && config.resourcesDiagram),\n\t\t\ttreeWidth: config.treeWidth || (config.resources ? 400 : 500),\n\t\t\tbaseline: config.baseline || false,\n\t\t});\n\n\t\tconst isHoliday =\n\t\t\tconfig.isHoliday ||\n\t\t\tfunction(date) {\n\t\t\t\tconst d = date.getDay();\n\t\t\t\treturn d === 0 || d === 6;\n\t\t\t};\n\n\t\tconst defaults = {\n\t\t\trouter: EmptyRouter,\n\t\t\tversion: VERSION,\n\t\t\tdebug: DEBUG,\n\t\t\tstart: \"/top\",\n\t\t\tcompactWidth: 650,\n\t\t\tmarkers: [{ css: \"webix_gantt_today_marker\", now: true }],\n\t\t\tparams: { state, forceCompact: config.compact },\n\t\t\tlinks: true,\n\t\t\tisHoliday,\n\t\t};\n\n\t\tsuper({ ...defaults, ...config });\n\n\t\tconst dynamic = obj =>\n\t\t\tthis.config.override ? this.config.override.get(obj) || obj : obj;\n\n\t\t//order matters\n\t\tthis.setService(\"helpers\", new (dynamic(Helpers))(this, config));\n\t\tthis.setService(\"local\", new (dynamic(Local))(this, config));\n\t\tthis.setService(\"backend\", new (dynamic(Backend))(this, config.url));\n\t\tthis.setService(\"operations\", new (dynamic(Operations))(this));\n\t\tthis.setService(\"grouping\", new (dynamic(Grouping))(this));\n\t\tinitJetWin(this);\n\n\t\tthis.use(\n\t\t\tplugins.Locale,\n\t\t\tthis.config.locale || {\n\t\t\t\tlang: \"en\",\n\t\t\t\twebix: {\n\t\t\t\t\ten: \"en-US\",\n\t\t\t\t},\n\t\t\t}\n\t\t);\n\t}\n\n\trequire(type, name) {\n\t\tif (type === \"jet-views\") return views[name];\n\t\telse if (type === \"jet-locales\") return locales[name];\n\n\t\treturn null;\n\t}\n\n\t// for external users\n\tgetState() {\n\t\treturn this.config.params.state;\n\t}\n}\n\nwebix.protoUI(\n\t{\n\t\tname: \"gantt\",\n\t\tapp: App,\n\t\tgetState() {\n\t\t\treturn this.$app.getState();\n\t\t},\n\t\tgetService(name) {\n\t\t\treturn this.$app.getService(name);\n\t\t},\n\t\t$init() {\n\t\t\tconst state = this.$app.getState();\n\t\t\tfor (let key in state) {\n\t\t\t\tlink(state, this.config, key);\n\t\t\t}\n\n\t\t\tthis.$app.attachEvent(\"bars:beforedrag\", (item, ctx) =>\n\t\t\t\tthis.callEvent(\"onBeforeDrag\", [item, ctx])\n\t\t\t);\n\t\t\tthis.$app.attachEvent(\"bars:beforedrop\", (item, ctx) =>\n\t\t\t\tthis.callEvent(\"onBeforeDrop\", [item, ctx])\n\t\t\t);\n\t\t},\n\t\t$exportView: function(options) {\n\t\t\tif (\n\t\t\t\toptions.export_mode === \"png\" ||\n\t\t\t\t(options.export_mode === \"pdf\" && options.display === \"image\")\n\t\t\t)\n\t\t\t\treturn this.$app.getRoot();\n\t\t\treturn this.$app.getService(\"local\").tasks();\n\t\t},\n\t\tclearAll() {\n\t\t\tthis.$app.getService(\"local\").clearAll();\n\t\t},\n\t\treload() {\n\t\t\tthis.$app.getService(\"local\").reload();\n\t\t},\n\t},\n\twebix.ui.jetapp\n);\n\n// re-export for customization\nconst services = { Local, Backend, Operations, Helpers, Grouping };\nconst locales = { en };\nexport { views, locales, services };\n","export default {\n\tEdit: \"Edit\",\n\tDone: \"Done\",\n\t\"Delete task\": \"Delete task\",\n\t\"Delete link\": \"Delete link\",\n\t\"The task will be deleted permanently, are you sure?\":\n\t\t\"The task will be deleted permanently, are you sure?\",\n\t\"The link will be deleted permanently, are you sure?\":\n\t\t\"The link will be deleted permanently, are you sure?\",\n\tPredecessors: \"Predecessors\",\n\tSuccessors: \"Successors\",\n\n\tTitle: \"Title\",\n\t\"Start date\": \"Start date\",\n\t\"End date\": \"End date\",\n\tDuration: \"Duration\",\n\tProgress: \"Progress\",\n\tNotes: \"Notes\",\n\tType: \"Type\",\n\tProject: \"Project\",\n\tMilestone: \"Milestone\",\n\t\"Add task\": \"Add task\",\n\t\"Add project\": \"Add project\",\n\t\"(no title)\": \"(no title)\",\n\t\"Save changes?\": \"Save changes?\",\n\n\t\"Related tasks\": \"Related tasks\",\n\tTask: \"Task\",\n\tLink: \"Link\",\n\t\"End to start\": \"End to start\",\n\t\"Start to start\": \"Start to start\",\n\t\"End to end\": \"End to end\",\n\t\"Start to end\": \"Start to end\",\n\n\tLasts: \"Lasts\",\n\tday: \"day\",\n\tdays: \"days\",\n\n\t\"Add assignment\": \"Add assignment\",\n\tAssignment: \"Assignment\",\n\tAssignments: \"Assignments\",\n\tAssigned: \"Assigned\",\n\t\"Delete assignment\": \"Delete assignment\",\n\t\"Are you sure to delete this assignment?\":\n\t\t\"Are you sure to delete this assignment?\",\n\t\"No resources to add\": \"No resources to add\",\n\tUnassigned: \"Unassigned\",\n\n\thour: \"h\",\n\t\"Hours per\": \"Hours per\",\n\t\"Tasks per\": \"Tasks per\",\n\tName: \"Name\",\n\tHours: \"Hours\",\n\tTasks: \"Tasks\",\n\tmonth: \"month\",\n\tweek: \"week\",\n\tquarter: \"quarter\",\n\tyear: \"year\",\n\n\t\"Split task\": \"Split task\",\n\t\"Planned dates\": \"Planned dates\",\n\t\"Planned dates will be removed, are you sure?\":\n\t\t\"Planned dates will be removed, are you sure?\",\n\t\"Add dates\": \"Add dates\",\n\t\"Remove dates\": \"Remove dates\",\n};\n"],"names":["webix","config","this","webixJet","_events","_subs","_data","params","extend","JetBase","_root","_detachEvents","_destroySubs","_container","app","_parent","id","value","url","_segment","update","show","parent","view","getParentView","getParam","suburl","toString","root_1","getRoot","queryView","obj","localId","$scope","name","code","attachEvent","push","key","kid","contains","sub","getSubViewInfo","subview","popup","events","i","length","detachEvent","subView","destructor","current","default","branch","child","_getDefaultSub","_routed_view","parse","substr","parts","split","chunks","test","result","pos","indexOf","params_1","_i","dchunk","decodeURIComponent","page","isNew","url2str","stack","stack_1","chunk","obj2str","join","str","encodeURIComponent","route","index","_next","path","Route","slice","setParams","old","kids","reset","concat","_join","Promise","res","rej","redirect","confirm","resolve","callEvent","NavigationBlocked","catch","err","then","_this","n","_super","_children","__extends","JetView","ui","container","jetview","createView","render","setParam","parent_1","target","_renderFrameLock","_show","segment","_init_url_data","_urlChange","linkRouter","getRouter","set","silent","_$view","_$","_$url","message","destroy","_destroyKids","plugin","getUrl","tagName","refresh","_render","root","document","body","toNode","cfg","_render_final","response","slot","$$","reject","copyConfig","oldui","parent_2","asWin","setPosition","isVisible","_init","_initUrl","ready","e","_initError","init","waits","frame","wait","all","urlChange","lock","_renderFrame","next","_createSubView","shift","_override","error","createFromURL","uis","_ui","JetViewRaw","cb","SubRouter","a","append","_once","window","version","start","_services","EventSystem","JetAppBase","_subSegment","handler","getSubView","prototype","$subview","addSubView","isArray","Array","method","point","DataCollection","RegExp","Map","Date","copy","$router","srcElement","getAttribute","trigger_1","_forView","trigger","cancelBubble","preventDefault","route_1","parentNode","clickHandler","views","_loadError","Error","hidden","replace","require","module","__esModule","loadView","over","override","dv","get","router","rest","apply","data","bind","er","debug","console","text","innerHTML","type","expire","event","_first_start","top","base","setTimeout","animation","node_1","html","addCss","removeCss","now","urlString","template","uid","_detectPrefix","onpopstate","HashRouter","routes","compare","history","pushState","prefix","sufix","_getRaw","routerPrefix","location","href","isPatched","patch","w","win","promise","freeze","some","$freeze","resize","baseAdd","baselayout","addView","baseRemove","removeView","jview_1","subs_1","arguments","subs","layout","protoUI","$init","$app","$ready","proxy","JetApp","UrlRouter","pathname","search","_$config","EmptyRouter","has","store","Object","hasOwnProperty","call","forEach","context","warn","x","String","russianPluralGroups","end","pluralTypes","arabic","lastTwo","bosnian_serbian","chinese","croatian","french","german","russian","lithuanian","czech","polish","icelandic","slovenian","pluralTypeToLanguages","pluralTypeName","locale","ret","langToPluralType","langs","lang","en","escape","token","dollarRegex","defaultTokenRegex","transformPhrase","phrase","substitutions","tokenRegex","TypeError","interpolationRegex","options","smart_count","texts","count","pluralTypeIndex","expression","argument","Polyglot","opts","phrases","currentLocale","allowMissing","onMissingKey","suffix","RangeError","constructTokenRegex","interpolation","newLocale","morePhrases","prefixedKey","unset","clear","newPhrases","t","_","webixPolyglot","plugins","_view","storage","setLangData","pconfig","polyglot","poly","service","put","locName","i18n","setLocale","setLang","getLang","setService","once","setSize","appView","appWidth","$width","appHeight","$height","_fillApp","define","width","height","left","setHandlers","$destructed","$view","enable","resizeEv","link","source","defineProperty","createState","handlers","out","observe","mask","undefined","queue","waitInQueue","notify","meta","list","keys","enumerable","configurable","values_1","sconfig","nested","reactive","$extend","val","valueOf","DragScroll","ctx","_auto_scroll_delay","delay","autoScroll","clearTimeout","yScroll","direction","xScroll","box","offset","from","autoYScroll","senseY","autoXScroll","senseX","DragControl","active","node","getNode","$dragPos","style","y","updateDragPos","sense","scroll","getScrollState","autoScrollTo","snode","Math","min","scrollWidth","mode","scrollTo","abs","initDnD","ctrl","master","Local","getService","addDrag","addDrop","getMoveMode","rect","getBoundingClientRect","p","minWidth","env","touch","delta","updateDragScrollConfig","ds","scales","getScales","round","cellWidth","cellHeight","$longTouchLimit","$dragCreate","pointer","State","readonly","getContext","$touch","locateEvent","item","getItem","$group","classList","Modes","getItemNode","isProgressDrag","scroll_1","evContext","getEventContext","step","precise","nsc","getSmallerCount","minUnit","dx","querySelector","parseInt","l","dragScroll","cloneNode","className","visibility","cursor","appendChild","display","$dragDestroy","$waitUpdate","Action","action","finally","remove","$dragIn","s","$dragOut","$drop","time","timeShift","ev","elementFromPoint","locate","changedTouches","touches","pageX","pageY","clientX","clientY","setDragOffset","x_offset","y_offset","nscroll","max","links","css","fromStart","opacity","create","toStart","linkType","targetId","move","progress","prevProgress","progressNode","updateTaskTemplate","zIndex","boxShadow","contrast","dark","skin","$name","isUndefined","DragProgressTemplate","selection","class","tb","floor","offsetX","getIdByIndex","dates","BarsView","borderless","cells","relative","BarsType","on","onItemClick","ItemClickHandler","tooltip","GetTooltip","_a","getChildViews","holidays","bars","Holidays","Links","Bars","Ops","Helpers","local","linkCollection","ldata","LinksData","Calendars","resourceCalendars","HandleScroll","HandleDrag","HandleSelection","InitMarkers","HandleHolidays","$changes","v","SyncData","refreshLinks","RefreshLinks","RenderResourceHolidays","DrawGrid","VisibleTasks","ApplySelection","o","showCriticalPath","assignments","excludeHolidays","task","tasks","updateAssignedTaskDates","updateScaleMinMax","$batch","selected","backgroundImage","drawGridInner","marginTop","state","getState","backgroundPosition","Resize","unselect","clearAll","getVisibleTasksCollection","taskCalendarMap","sync","$data","GetSplitBox","top_1","html_1","order","isLast_1","TemplateStart","BarsTemplate","TemplateEnd","templateStart","isLast","templateEnd","last","first","$x","$w","rwidth","$y","$h","h","diff","BarCSS","contentCss","ContentCss","ceil","sqrt","pow","drag","baseline","planned_start","TemplateBaseline","$x0","$w0","$critical","_mousemove_handler","pointerType","switchCursor","eventRemove","_scroll_handler","markers","m","$interval","clearInterval","temp","scrollTop","scrollLeft","holidaysContainer","containerForMarkers","lines","GetLinks","attrs","viewBox","scrollHeight","setAttribute","SetHolidaysScroll","resources","resourcesDiagram","resHolidaysContainer","selLine","insertBefore","firstChild","ind","getIndexById","exists","ScrollToTask","RenderMarkers","start_date","setInterval","GetMarkerPosition","MarkerTemplate","date","astart","getUnitStart","startOnMonday","links_1","each","$p","critical","criticalPath","isLinkCritical","LinksTemplate","setHTML","tid","find","updateLink","area","minHeight","ops","inProgress","updateTaskTime","refreshTasks","RefreshTaskLinks","updateTask","addLink","newLink","top_2","shift_1","points","map","unit","getSmallerUnit","addUnit","splitCont","sort","b","_b","RenderHolidays","func","dayStart","add","hourOffset","getHours","equal","timePart","html_2","EachScaleDate","isHoliday","HolidayTemplate","calendar","dateStart","isResourceHoliday","ResourceHolidayTemplate","ResourceWorkDayTemplate","taskId","MarkResourceHolidays","GetDateBox","parser","longDateFormatStr","tip","end_date","duration","ScalesView","RenderScales","rows","line","canMarkHolidays","cell","CellTemplate","FormatDate","format","dateToStr","ChartView","ScaleView","hide","DiagramView","WorkloadMarkersType","filterMode","showSubItems","level","LocalState","Unit","Scales","RDCollection","getRDCollection","RestoreTreeState","filter","ToggleBranch","by","dir","as","open","close","getBranch","opened","_treeOpened","clientHeight","t_1","openAll","u","common","MarkerStartTemplate","classname","aria","$level","GetMarkerData","MarkerToHTML","resId","resource_id","calendarId","calendar_id","calendars","d","hourParts","units","markerWidth","halfStep","CheckResourceHoliday","hours","overloaded","CheckOverload","marker","unitLoadNorm","day","number","localeCompare","ignorePunctuation","numeric","arrayEquals","every","includes","TreeView","compact","Compact","columns","header","TreeTemplate","fillspace","batch","tree","prerender","treeWidth","rowHeight","headerRowHeight","scrollAlignY","resizeColumn","headerOnly","size","onViewResize","Tree","onAfterOpen","onAfterClose","onAfterSort","SortTasks","onColumnResize","user","NormalizeColumns","onClick","gti-menu","ToggleColumns","ls","_unit","_collapsed","ShowInUnits","col","columnId","getColumnConfig","refreshColumns","icon","treetable","category","resourceAvatar","space","cols","lastFillspace","showColumnBatch","SetColumns","getColumnIndex","lv","isColumnVisible","cv","vis","hideColumn","showColumn","RDiagramView","elements","onChange","localState","radio","words","BaselineView","icons","autoheight","elementsConfig","labelPosition","padding","right","visibleBatch","label","suggest","autowidth","click","AddBtnClickHandler","RemoveBtnClickHandler","UpdateTaskTime","UpdateTask","Form","Tasks","FillData","showBatch","setValues","vals","f","_eventSource","$eventSource","updateDates","planned_end","planned_duration","getValues","PrepareDates","updatePlannedTaskDuration","blockEvent","unblockEvent","TableView","table","editable","hover","scheme","ttype","c","conf","collection","editor","onBeforeEditStart","onBeforeEditStop","UpdateLink","row","onAfterLoad","wxi-trash","title","DeleteLink","$active","layoutMargin","form","bottom","_id","related","getLinks","editCancel","updateItem","removeLink","editors","gantt_numeditor","inp","ResourcesView","single","IsSingle","button","editaction","ResourceTemplate","listItemHeight","r","OptionTemplate","EditorOptionTemplate","ValueTemplate","editFormat","parseFloat","editParse","isNaN","DeleteIconTemplate","Table","column","editRow","getEditor","getPopup","focus","addCellCss","resource","FilterOptions","onAfterEditStart","getInputNode","range","GetRange","ApplyEditorLimits","GetValueStep","ApplyEditorStep","removeCellCss","ApplyValueRange","UpdateAssignment","webix_gantt_remove_icon","RemoveAssignment","margin","Resources","getAssignments","assignees","GetData","disable","sortResources","tableIds","rInd","updateAssignment","CloseEditor","resourceItem","getResourceValueRange","getResourceValueStep","removeAssignment","ShowPopup","addAssignment","getDefaultResourceValue","EditorTemplate","GetUnitName","getResourceUnit","fitMaster","AddAssignment","Popup","GetPopupConfig","SetPopupPlaceholder","placeholder","getBody","FormView","isResources","aSkin","bar","layoutPadding","inputHeight","Close","Done","types","projects","splice","accItems","collapsed","accordion","multi","ToggleControls","typeSelect","SetResourceHolidays","SetBaselineVisibility","typeList","getList","$count","LimitTypeOptions","SetResourcesVisibility","RemoveTagsFromText","updateTaskDuration","_inProgress","isDirty","Back","exit","edit","arr","els","getTaskCalendar","el","TaskView","editButton","EditTask","info","InfoTemplate","deleteButton","align","inputWidth","DeleteTask","Text","FillTemplate","sources","targets","removeTask","BaseTemplate","LinkTemplate","BaselineTemplateChunk","details","DateFormat","InfoTemplateChunk","ResourcesTemplateChunk","maxWidth","s0","getTextSize","s1","avatar","dpt","TaskPopup","updateConfig","fullscreen","head","maxAvatarNumber","TitleTemplate","dateFormatStr","ResourcesTemplate","unshift","select","wxi-plus","AddTask","wxi-plus-circle","onBeforeOpen","HandleToggle","onBeforeSelect","BeforeSelectHandler","onBeforeDrag","BeforeDragHandler","onBeforeDrop","BeforeDropHandler","Mode","Assignments","pid","$dragHTML","moveTask","resDisplayed","clearEvID","RefreshData","loaders","waitData","GetLoaders","ApplySorting","getSelectedId","pdata","_isTaskVisible","showItem","setState","newTask","GetNewTask","AddTaskWithAssignment","assigned","SplitTaskWithAssignment","splitTaskWithDnd","addTask","GetDates","waitArr","getParentId","rId","sibling","aops","dataSorter","sortState","RefreshTasks","assigned_1","GetAssignmentsHTML","assignedArr","num","pop","lastStr","numStr","TopView","sizeTrigger","_compactValue","_compactHandler","_app","_forceCompact","forceCompact","_compactWidth","compactWidth","_checkTrigger","$setSize","fCompact","SetCompactMode","oid","ShowTask","HideTask","ProgressBar","showProgress","hideProgress","m0","m1","m2","m3","m4","m5","m6","m7","m8","m9","m10","m11","m12","m13","resetScales","dateToLocalStr","parseFormat","scaleStart","scaleEnd","oldScale","_scales","_scaleBase","setScales","_taskHeight","refreshResourceTasks","preciseTimeUnit","scaleCellWidth","barHeight","borderWidth","force","_tasks","createTasks","getTreeData","TreeCollection","data->onStoreLoad","data->onStoreUpdated","_links","$change","parseFormatDate","$css","$sort","$serialize","taskOut","$export","updID","k","refreshBaseline","createLinks","found","tcollection","taskParent","$parent","taskSplit","_categories","categories","_resources","rData","ctg","_assignments","aCopy","assign","_calendars","createCalendars","weekDays","datePart","clean","getRange","latestDate_1","isTaskCritical","latestDate","dependent","isNoSlack","nextStart","currentEnd","g","getResourceTree","_calendarMap","refreshCalendarMap","cal","grouping","collections","Infinity","_url","Backend","ajax","json","post","del","_local","_helpers","_back","_state","Operations","addMode","cleanData","added","adjustScale","completeAdd","position","syncProject","inner","updatePlanned","removeAssignments","syncTasks","field","_updatePlannedTaskDuration","change","getWorkDateDiff","p_1","eachSubItem","newDate","changedKid","sign","ad","setProjectData","offsetDate","us","completeRemoval","linkExists","duplicate","oldParent","oldIndex","getBranchIndex","reorderTask","collection_1","waitArr_1","toInteger","dirtyNumber","NaN","Number","requiredArgs","required","args","toDate","argStr","getTime","addDays","dirtyDate","dirtyAmount","amount","setDate","getDate","addMonths","dayOfMonth","endOfDesiredMonth","setMonth","getMonth","daysInMonth","setFullYear","getFullYear","addMilliseconds","timestamp","startOfWeek","dirtyOptions","localeWeekStartsOn","weekStartsOn","defaultWeekStartsOn","getDay","setHours","getTimezoneOffsetInMilliseconds","utcDate","UTC","getMinutes","getSeconds","getMilliseconds","setUTCFullYear","startOfDay","compareAsc","dirtyDateLeft","dirtyDateRight","dateLeft","dateRight","differenceInCalendarMonths","yearDiff","monthDiff","differenceInCalendarYears","differenceInMilliseconds","roundingMap","trunc","getRoundingMethod","endOfDay","endOfMonth","month","isLastDayOfMonth","differenceInMonths","difference","isLastMonthNotFull","year","isLastYearNotFull","quarter","roundingMethod","week","startOfWeekLeft","startOfWeekRight","timestampLeft","timestampRight","differenceInCalendarWeeks","startOfDayLeft","startOfDayRight","hour","minute","smallerCount","months","days","innerDiff","prev","wt","filled","getDiff","sameMonth","daysOfFirstMonth","me","getMonthDayDiff","len","getMinUnit","tempEnd","fullWidth","fullHeight","countInWeeks","cdate","cnext","setSizes","taskHeight","startDate","endDate","ms","toWorkday","toClosestWorkday","getMilestone","getDuration","getEndWorkday","getEnd","setMinutes","setSeconds","setMilliseconds","getDatePart","holidayGuard","toFixed","notRight","alert","getCheckDate","getTimezoneOffset","getTimePart","startTask","endTask","dy","s_start","e_start","sx","sy","ex","ey","differentX","lineCoords","gapp","sx1","ex1","same","getLineCoords","arrowCoords","defaultResourceUnit","defaultResourceValues","resourceValueRanges","resourceValueSteps","initials","match","charAt","toUpperCase","charCodeAt","cssClass","withTooltip","txt","avatarCss","inc","getTaskHeight","color","canvas","createElement","strokeStyle","moveTo","lineTo","stroke","toDataURL","grid","helpers","closedResources","Grouping","_rdCollection","Group","syncRDWithData","getDiagramItemData","groupResourceDiagram","refreshTaskDiagram","updateUnitDurations","updateTaskDiagram","refreshResourceDiagram","assignment","calculateUnitDuration","calculateLoad","truncateX","getUnitLoad","startUnitEnd","load","startUnitStart","endUnitStart","days_1","findUnitDuration","days_2","plusUnit","getDifference","checkHoliday","pruneDiagram","rec","oa","toRemove","eachLeaf","group","collect","_resourcesTree","resourceTaskLoader","syncResourceTree","task_1","tasksWithResources","getResourceTaskData","eachChild","inTree","becomesTask","pId","refreshResourceTree","unassignedBranch","checkResourceOpen","property","ws","sum","j","appId","defaults","dynamic","appNode","addStyle","firstShow","defaultHandler","onShow","use","App","locales","$exportView","export_mode","reload","jetapp","services","Edit","Delete task","Delete link","The task will be deleted permanently, are you sure?","The link will be deleted permanently, are you sure?","Predecessors","Successors","Title","Start date","End date","Duration","Progress","Notes","Type","Project","Milestone","Add task","Add project","(no title)","Save changes?","Related tasks","Task","Link","End to start","Start to start","End to end","Start to end","Lasts","Add assignment","Assignment","Assigned","Delete assignment","Are you sure to delete this assignment?","No resources to add","Unassigned","Hours per","Tasks per","Name","Hours","Split task","Planned dates","Planned dates will be removed, are you sure?","Add dates","Remove dates"],"mappings":"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"}